<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Documentation for testing Firedancer, including system configuration, unit and fuzz tests, sanitizers, and best practices.

# Purpose
The document provides detailed instructions for configuring and running tests for the Firedancer software. It specifies the optimal system configuration, known as the "Golden Configuration," which includes specific kernel versions, operating systems, compilers, CPU types, and memory settings to ensure reliable test execution. The document outlines procedures for running unit tests and fuzz tests, including the necessary configurations in `Local.mk` files and the use of different fuzzing engines like `libFuzzer`, `AFL++`, and `Honggfuzz`. It also describes the use of sanitizers to detect runtime errors and provides best practices for test determinism, memory management, and input handling. The document emphasizes the importance of using static variables and shared memory for efficient memory allocation during tests.
# Content Summary
The document provides detailed instructions for configuring and testing the Firedancer software. It outlines the recommended system configuration, known as the "Golden Configuration," which includes specific versions of the Linux kernel, operating systems, compilers, and hardware requirements. This configuration is used internally by the Firedancer team to minimize system noise and ensure reliable test results.

The document also provides a "Quick Start" guide for running tests, which involves allocating memory with `fd_shmem_cfg`, compiling the code with `make`, and executing unit tests. It includes instructions for configuring large page and NUMA settings.

The "Test Configuration" section describes different types of tests, including unit tests and fuzz tests. Unit tests are C programs that test Firedancer modules and are located in the `/src` directory. They run automatically without command-line parameters and require 2 GiB of memory. Fuzz tests evaluate component behavior with arbitrary byte sequences and are effective for finding bugs in parsers. The document provides example configurations for both unit and fuzz tests using `Local.mk`.

The document also explains the use of fuzzing engines like libFuzzer, AFL++, and Honggfuzz, detailing the compile commands and installation steps for each. It notes that if no fuzzing engine is provided, a stub engine is used for regression testing.

Sanitizers are supported to perform runtime checks, and the document lists compile commands for AddressSanitizer, UndefinedBehaviorSanitizer, and MemorySanitizer. These tools help detect memory issues and undefined behavior.

The "Best Practices" section emphasizes the importance of test determinism, automatic configuration, and proper memory management. It advises against using `malloc()` in tests and recommends using static variables or shared memory for memory allocation. The document provides a code pattern for setting up memory allocation with specific flags for page size, count, and NUMA node.

Overall, the document serves as a comprehensive guide for developers to configure, run, and manage tests for the Firedancer software, ensuring reliability and consistency across different environments.

---
Made with ❤️ by [Driver](https://www.driver.ai/)