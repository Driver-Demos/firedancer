<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Wireshark plugin for dissecting Firedancer Tango messages, defining protocols and fields for network analysis.

# Purpose
The code is a Lua script designed to function as a plugin for Wireshark, a network protocol analyzer. This plugin is specifically tailored to dissect and analyze Firedancer Tango messages, which are part of the Solana blockchain protocol. The script defines several custom protocols and fields to interpret the data structures used in these messages, allowing Wireshark to display them in a human-readable format.

The script begins by setting up plugin information, including version, author, and license details. It then defines a primary protocol named `fd_tango` and several associated fields, such as sequence numbers, control flags, timestamps, and link hashes. These fields are used to parse and display specific parts of the Tango message structure. The script also includes a dissector function for the `fd_tango` protocol, which processes the message data and applies the appropriate sub-dissectors based on the message content.

Additionally, the script defines several other protocols, such as `fd_txn_t`, `fd_poh_shred`, `fd_pack_rebate_t`, and others, each with their own fields and dissector functions. These protocols handle different aspects of the Firedancer Tango messages, such as transaction structures, PoH (Proof of History) to shred messages, and CU (Compute Unit) rebate messages. The script also includes mappings for link hashes to human-readable names and integrates with existing Wireshark dissectors for further analysis of specific message components.
# Imports and Dependencies

---
- `Proto`
- `ProtoField`
- `Dissector`
- `DissectorTable`
- `NSTime`


# Data Structures

---
### tango
- **Type**: ``Proto``
- **Members**:
    - ``tango_seq``: Represents the sequence number as a 64-bit unsigned integer.
    - ``tango_sig``: Represents the signature as a 64-bit unsigned integer in hexadecimal format.
    - ``tango_chunk``: Represents the chunk as a 32-bit unsigned integer in hexadecimal format.
    - ``tango_sz``: Represents the size as a 16-bit unsigned integer in decimal format.
    - ``tango_ctl``: Represents the control field as a 16-bit unsigned integer in hexadecimal format.
    - ``tango_ctl_som``: Indicates the start-of-message as a 16-bit unsigned integer in decimal format.
    - ``tango_ctl_eom``: Indicates the end-of-message as a 16-bit unsigned integer in decimal format.
    - ``tango_ctl_err``: Indicates an error as a 16-bit unsigned integer in decimal format.
    - ``tango_ctl_orig``: Represents the origin as a 16-bit unsigned integer in decimal format.
    - ``tango_tsorig``: Represents the origin timestamp as a 32-bit unsigned integer in decimal format.
    - ``tango_tspub``: Represents the publish timestamp as a 32-bit unsigned integer in decimal format.
    - ``tango_link``: Represents the link hash as a 32-bit unsigned integer in hexadecimal format.
    - ``tango_link_name``: Represents the link name as a string.
    - ``tango_contents``: Represents the DCache contents as bytes.
    - ``tpu_payload_sz``: Represents the payload size as a 16-bit unsigned integer.
    - ``tpu_txn``: Represents the transaction as bytes.
    - ``tpu_requested_cus``: Represents the requested compute units as a 32-bit unsigned integer.
    - ``tpu_executed_cus``: Represents the executed compute units as a 32-bit unsigned integer.
    - ``sched_arrival_ns``: Represents the arrival time in nanoseconds as a 64-bit signed integer.
    - ``tpu_flags``: Represents the flags as a 32-bit unsigned integer.
    - ``tpu_simple_vote``: Indicates a simple vote as a 32-bit unsigned integer in decimal format.
    - ``tpu_bundle``: Indicates a bundle as a 32-bit unsigned integer in decimal format.
    - ``tpu_initializer``: Indicates an initializer bundle as a 32-bit unsigned integer in decimal format.
    - ``tpu_sanitized``: Indicates sanitize success as a 32-bit unsigned integer in decimal format.
    - ``tpu_executed``: Indicates execute success as a 32-bit unsigned integer in decimal format.
    - ``tpu_nonce``: Indicates a durable nonce as a 32-bit unsigned integer in decimal format.
    - ``tpu_status``: Represents the status as a 32-bit unsigned integer with status codes.
- **Description**: Represents the `fd_tango` protocol, which is a Wireshark dissector for Firedancer Tango messages. It defines various fields such as sequence number, signature, chunk, size, control, timestamps, link hash, and contents. The protocol also includes fields related to transaction processing, such as payload size, transaction data, requested and executed compute units, arrival time, and flags. The `tango` protocol is used to dissect and analyze network packets related to the Firedancer Tango system.


---
### p\_fd\_txn
- **Type**: ``Proto``
- **Members**:
    - ``transaction_version``: Represents the version of the transaction.
    - ``signature_cnt``: Indicates the number of signatures in the transaction.
    - ``signature_off``: Specifies the offset for the signature in the transaction.
    - ``message_off``: Specifies the offset for the message in the transaction.
    - ``readonly_signed_cnt``: Counts the number of readonly signed accounts.
    - ``readonly_unsigned_cnt``: Counts the number of readonly unsigned accounts.
    - ``acct_addr_cnt``: Indicates the number of account addresses.
    - ``acct_addr_off``: Specifies the offset for account addresses.
    - ``recent_blockhash_off``: Specifies the offset for the recent blockhash.
    - ``addr_table_lookup_cnt``: Counts the number of address table lookups.
    - ``addr_table_adtl_writable_cnt``: Counts additional writable addresses in the table.
    - ``addr_table_adtl_cnt``: Counts additional addresses in the table.
    - ``instr_cnt``: Indicates the number of instructions in the transaction.
    - ``instrs``: Represents the instructions in the transaction.
    - ``instr``: Represents a single instruction in the transaction.
    - ``program_id``: Indicates the program ID index for the instruction.
    - ``acct_cnt``: Counts the number of accounts in the instruction.
    - ``data_sz``: Specifies the size of the data in the instruction.
    - ``acct_off``: Specifies the offset for accounts in the instruction.
    - ``data_off``: Specifies the offset for data in the instruction.
    - ``alts``: Represents the address tables in the transaction.
    - ``alt``: Represents a single address table in the transaction.
    - ``addr_off``: Specifies the offset for addresses in the address table.
    - ``writable_cnt``: Counts the number of writable addresses in the address table.
    - ``readonly_cnt``: Counts the number of readonly addresses in the address table.
    - ``writable_off``: Specifies the offset for writable addresses in the address table.
    - ``readonly_off``: Specifies the offset for readonly addresses in the address table.
- **Description**: Represents the FD Transaction Struct, which is a protocol structure used to define and dissect transaction data in a network protocol. It includes fields for transaction version, signature details, message offsets, account address information, instruction counts, and address table lookups. The structure is used to parse and display transaction data in a network analysis tool, such as Wireshark, providing detailed insights into the transaction's components and their respective offsets and counts.


---
### poh\_shred
- **Type**: ``Proto``
- **Members**:
    - ``f_parent_offset``: Represents the parent offset as a 64-bit unsigned integer.
    - ``f_reference_tick``: Represents the reference tick as a 64-bit unsigned integer.
    - ``f_block_complete``: Indicates if the block is complete as a 32-bit integer.
    - ``f_parent_block_id``: Stores the parent block ID as a byte array.
    - ``f_parent_block_id_valid``: Indicates if the parent block ID is valid as a boolean.
    - ``f_hashcnt_delta``: Represents the hash count delta as a 64-bit unsigned integer.
    - ``f_hash``: Stores the hash as a byte array.
    - ``f_txn_cnt``: Represents the transaction count as a 64-bit unsigned integer.
    - ``f_txns``: Holds the transactions without a specific type.
    - ``f_slot_start_ns``: Represents the slot start time in nanoseconds as a 64-bit integer.
    - ``f_bank_ptr``: Represents the bank pointer as a 64-bit unsigned integer in hexadecimal format.
- **Description**: Represents the `fd_poh_shred` protocol, which is used to dissect messages related to Proof of History (PoH) and shreds in the Firedancer system. It defines several fields that capture various aspects of the PoH to shred messages, such as parent offset, reference tick, block completion status, parent block ID, hash count delta, hash, transaction count, and transactions. The protocol also includes fields for slot start time and bank pointer, which are used to manage and interpret the data within the context of the Firedancer system.


---
### rebate
- **Type**: ``Proto``
- **Members**:
    - ``f_total_cost_rebate``: Represents the total cost rebate as a 64-bit unsigned integer.
    - ``f_vote_cost_rebate``: Represents the vote cost rebate as a 64-bit unsigned integer.
    - ``f_data_bytes_rebate``: Represents the data bytes rebate as a 64-bit unsigned integer.
    - ``f_microblock_cnt_rebate``: Represents the microblock count rebate as a 64-bit unsigned integer.
    - ``f_ib_result``: Represents the IB result as a 32-bit signed integer.
    - ``f_writer_cnt``: Represents the writer count as a 32-bit unsigned integer.
    - ``f_writers``: Represents the collection of written pubkeys.
    - ``f_writer``: Represents a single written pubkey.
    - ``f_pubkey``: Represents the writer pubkey as a byte array.
    - ``f_rebate_cus``: Represents the rebate CUs as a 64-bit unsigned integer.
- **Description**: Defines the `rebate` protocol, which is a custom protocol for handling FD CU rebate messages. It includes fields for various types of rebates, such as total cost, vote cost, data bytes, and microblock count rebates. The protocol also tracks the number of writers and their associated pubkeys, along with the rebate CUs for each writer. The `rebate` protocol is used to dissect and analyze network packets that contain rebate information.


---
### fd\_shred34
- **Type**: ``Proto``
- **Members**:
    - ``f_shred_cnt``: Represents the number of shreds.
    - ``f_est_txn_cnt``: Represents the estimated number of transactions.
    - ``f_stride``: Represents the stride value for shreds.
    - ``f_offset``: Represents the offset value for shreds.
    - ``f_shred_sz``: Represents the size of each shred.
    - ``f_shred_payload``: Represents the payload data of the shred.
- **Description**: Represents a protocol for handling 'FD Shred to Store Message' in Wireshark, which includes fields for managing and processing shreds such as count, estimated transaction count, stride, offset, size, and payload.


---
### fd\_became\_leader
- **Type**: ``Proto``
- **Members**:
    - ``f_slot_start``: Represents the start time of the slot in UTC.
    - ``f_slot_end``: Represents the end time of the slot in UTC.
    - ``f_bank_ptr``: Stores the bank pointer as a 64-bit unsigned integer.
    - ``f_max_microblocks_in_slot``: Indicates the maximum number of microblocks allowed in a slot.
    - ``f_ticks_per_slot``: Specifies the number of ticks per slot.
- **Description**: Represents a protocol for handling messages related to the transition to a leader state in a distributed system. It includes fields for slot timing, bank reference, and configuration parameters for microblocks and ticks within a slot. This protocol is used to dissect and interpret data packets that signal the transition to a leader role, providing detailed timing and configuration information.


---
### fd\_done\_packing
- **Type**: ``Proto``
- **Members**:
    - ``f_microblocks_in_slot``: Represents the number of microblocks in a slot.
- **Description**: Represents a protocol for handling messages related to the completion of packing operations in the Firedancer system. It contains a single field, `f_microblocks_in_slot`, which indicates the number of microblocks processed in a slot. This protocol is used to communicate the completion of packing operations to the Proof of History (PoH) component.


---
### fd\_txnm
- **Type**: ``Proto``
- **Members**:
    - ``f_ref_slot``: Represents the reference slot as a 64-bit unsigned integer.
    - ``f_txn_t_sz``: Represents the size of `fd_txn_t` as a 16-bit unsigned integer.
    - ``f_source_ipv4``: Represents the source IPv4 address.
    - ``f_source_tpu``: Represents the source TPU with a predefined enumeration.
    - ``f_payload_sz``: Represents the size of the payload as a 16-bit unsigned integer.
    - ``f_bundle_id``: Represents the bundle ID as a 64-bit unsigned integer.
    - ``f_bundle_txn_cnt``: Represents the bundle transaction count as a 64-bit unsigned integer.
    - ``f_bundle_commission``: Represents the bundle commission as an 8-bit unsigned integer.
    - ``f_bundle_pubkey``: Represents the bundle commission public key as a byte array.
    - ``f_alt_entry``: Represents the address lookup table account address as a byte array.
- **Description**: Represents a protocol for handling transactions with payload and metadata, including fields for reference slot, transaction size, source information, payload size, bundle details, and address lookup table entries. The dissector function processes the buffer to extract and add these fields to the protocol tree, facilitating the analysis of transaction data in network packets.


# Functions

---
### tango\.dissector
Processes a given buffer to dissect and display Tango protocol messages in Wireshark.
- **Inputs**:
    - `tvb`: A `Tvb` object representing the buffer to dissect.
    - `pinfo`: A `Pinfo` object containing packet information.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which this dissector will add its information.
- **Logic and Control Flow**:
    - Add a subtree to the protocol tree for the Tango protocol.
    - Get the length of the packet from the `tvb` object.
    - If the packet length is zero, return immediately.
    - Extract the last 4 bytes of the packet to determine the `link_hash` and find the corresponding `link_name` from the `link_hashes` table.
    - Add the `link_hash` and `link_name` to the subtree.
    - Add various fields such as `tango_seq`, `tango_sig`, `tango_chunk`, `tango_sz`, and `tango_ctl` to the subtree.
    - Extract and add control flags (`tango_ctl_som`, `tango_ctl_eom`, `tango_ctl_err`, `tango_ctl_orig`) to the control node in the subtree.
    - Add timestamps `tango_tsorig` and `tango_tspub` to the subtree.
    - Extract the `dcache_contents` from the buffer and add it to the subtree.
    - Based on the `link_name`, call the appropriate dissector to further process the `dcache_contents`.
- **Output**: The function does not return a value; it modifies the `tree` to include the dissected protocol information.


---
### p\_fd\_txn\.dissector
Processes a buffer to dissect and display the fields of an FD Transaction Struct in a Wireshark tree.
- **Inputs**:
    - `buffer`: A `Tvb` object representing the packet buffer to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the tree to which dissected fields are added.
- **Logic and Control Flow**:
    - Set the protocol column in the packet info to the name of the protocol.
    - Create a subtree for the FD Transaction Protocol in the provided tree.
    - Initialize an offset variable to track the current position in the buffer.
    - Add various fields to the subtree by reading from the buffer and incrementing the offset accordingly.
    - Check if there are instructions to parse, and if so, add them to the tree and parse each instruction using the `parse_instr` function.
    - Check if there are address tables to parse, and if so, add them to the tree and parse each table using the `parse_alt` function.
- **Output**: The function does not return a value; it modifies the `tree` parameter to include the dissected fields.


---
### parse\_instr
Parses a buffer to extract and add instruction details to a protocol tree.
- **Inputs**:
    - `buffer`: A `ByteArray` containing the instruction data to parse.
    - `instr_tree`: A `TreeItem` where the parsed instruction details will be added.
- **Logic and Control Flow**:
    - Initialize `offset` to 0 to track the position in the buffer.
    - Add the `program_id` field from the buffer to `instr_tree` and increment `offset` by 2.
    - Add the `acct_cnt` field from the buffer to `instr_tree` and increment `offset` by 2.
    - Add the `data_sz` field from the buffer to `instr_tree` and increment `offset` by 2.
    - Add the `acct_off` field from the buffer to `instr_tree` and increment `offset` by 2.
    - Add the `data_off` field from the buffer to `instr_tree` and increment `offset` by 2.
- **Output**: The function does not return a value; it modifies `instr_tree` by adding parsed instruction fields.


---
### parse\_alt
Parses a buffer to extract and add address lookup table information to a protocol tree.
- **Inputs**:
    - `buffer`: A `ByteArray` containing the data to parse.
    - `alt_tree`: A `TreeItem` to which the parsed address lookup table information is added.
- **Logic and Control Flow**:
    - Initialize `offset` to 0.
    - Add the `addr_off` field to `alt_tree` using the first 2 bytes of `buffer`, then increment `offset` by 2.
    - Add the `writable_cnt` field to `alt_tree` using the next byte of `buffer`, then increment `offset` by 1.
    - Add the `readonly_cnt` field to `alt_tree` using the next byte of `buffer`, then increment `offset` by 1.
    - Add the `writable_off` field to `alt_tree` using the next 2 bytes of `buffer`, then increment `offset` by 2.
    - Add the `readonly_off` field to `alt_tree` using the next 2 bytes of `buffer`, then increment `offset` by 2.
- **Output**: The function does not return a value; it modifies the `alt_tree` by adding parsed fields.


---
### poh\_shred\.dissector
Processes a buffer to dissect and display fields of the 'FD PoH to Shred Messages' protocol in Wireshark.
- **Inputs**:
    - `buffer`: A `Tvb` object representing the packet buffer to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which dissected fields are added.
- **Logic and Control Flow**:
    - Check if the buffer length is less than 64 bytes; if true, set the tree text to 'Became Leader' and add 'Slot Start Time' and 'Bank' fields.
    - If the buffer length is 64 bytes or more, add fields such as 'Parent Offset', 'Reference Tick', 'Block Complete', 'Parent Block ID', 'Parent Block ID Valid', 'Hash Count Delta', 'Hash', and 'Transaction Count' to the tree.
    - If 'Transaction Count' is greater than 0, create a subtree for transactions and use the 'solana.tpu.udp' dissector to process each transaction in the buffer.
- **Output**: The function does not return a value; it modifies the `tree` parameter to include the dissected protocol fields.


---
### rebate\.dissector
Processes a buffer to extract and display rebate-related data fields in a Wireshark protocol tree.
- **Inputs**:
    - `buffer`: A `Tvb` object representing the packet buffer to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which dissected fields are added.
- **Logic and Control Flow**:
    - Get the writer count from the buffer at offset 36.
    - Add the `f_total_cost_rebate`, `f_vote_cost_rebate`, `f_data_bytes_rebate`, `f_microblock_cnt_rebate`, `f_ib_result`, and `f_writer_cnt` fields to the protocol tree using the buffer data.
    - If `writer_cnt` is greater than 0, create a subtree for writers and iterate over each writer.
    - For each writer, add a subtree with `f_writer`, `f_pubkey`, and `f_rebate_cus` fields using the buffer data.
- **Output**: The function does not return a value; it modifies the `tree` parameter to include the dissected fields.


---
### fd\_shred34\.dissector
Processes a buffer to dissect and display the contents of a Firedancer Tango message in Wireshark.
- **Inputs**:
    - `tvb`: A `Tvb` object representing the buffer containing the packet data to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which this dissector will add its information.
- **Logic and Control Flow**:
    - Add a subtree to the protocol tree for the `fd_tango` protocol.
    - Get the length of the packet from `tvb`.
    - If the packet length is zero, return immediately.
    - Extract the last 4 bytes of the packet to get the `link_hash` and determine the `link_name` using the `link_hashes` table.
    - Add the `link_hash` and `link_name` to the subtree.
    - Add various fields such as `tango_seq`, `tango_sig`, `tango_chunk`, `tango_sz`, and `tango_ctl` to the subtree.
    - Extract and add control flags (`tango_ctl_som`, `tango_ctl_eom`, `tango_ctl_err`, `tango_ctl_orig`) to the `ctl_node`.
    - Add timestamps `tango_tsorig` and `tango_tspub` to the subtree.
    - Extract the `dcache_contents` from the buffer and add it to the subtree.
    - Based on the `link_name`, select the appropriate dissector and call it with `dcache_contents`, `pinfo`, and `dcache_tree`.
    - For specific `link_name` values, iterate over the `dcache_contents` to dissect transactions and add them to the tree.
- **Output**: The function does not return a value; it modifies the `tree` to include the dissected protocol fields.


---
### fd\_became\_leader\.dissector
Processes a buffer to extract and display information about a 'Became Leader' message in a Wireshark dissector tree.
- **Inputs**:
    - `buffer`: A `Tvb` object representing the packet buffer to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which dissected fields are added.
- **Logic and Control Flow**:
    - Add a subtree to the protocol tree for the `fd_became_leader_t` protocol.
    - Extract the `slot_start` and `slot_end` times from the buffer and convert them to `NSTime` format.
    - Add the `slot_start` and `slot_end` times to the subtree with the converted `NSTime` values.
    - Add the `bank_ptr`, `max_microblocks_in_slot`, and `ticks_per_slot` fields to the subtree using little-endian format.
- **Output**: The function adds a subtree to the protocol tree with fields representing the 'Became Leader' message, including slot start and end times, bank pointer, maximum microblocks in slot, and ticks per slot.


---
### fd\_done\_packing\.dissector
Processes a buffer to extract and display information about the 'FD Pack to PoH Done Packing Message' protocol in a Wireshark tree.
- **Inputs**:
    - `buffer`: A `Tvb` object representing the packet buffer to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which this dissector will add its information.
- **Logic and Control Flow**:
    - Add a subtree to the provided `tree` for the `fd_done_packing_t` protocol.
    - Extract the `microblocks_in_slot` field from the `buffer` and add it to the subtree.
- **Output**: The function does not return a value; it modifies the `tree` to include protocol-specific information.


---
### fd\_txnm\.dissector
Processes a buffer to dissect and display the contents of a Firedancer Tango message in Wireshark.
- **Inputs**:
    - `tvb`: A `Tvb` object representing the buffer containing the packet data to dissect.
    - `pinfo`: A `Pinfo` object containing information about the packet being dissected.
    - `tree`: A `TreeItem` object representing the root of the protocol tree to which this dissector will add its information.
- **Logic and Control Flow**:
    - Add a subtree to the protocol tree for the `fd_tango` protocol.
    - Get the length of the packet from `tvb`.
    - If the packet length is zero, return immediately.
    - Extract the last 4 bytes of the packet as the `link_hash` and find the corresponding `link_name` from the `link_hashes` table.
    - Add the `link_hash` and `link_name` to the subtree.
    - Add various fields such as `tango_seq`, `tango_sig`, `tango_chunk`, `tango_sz`, and `tango_ctl` to the subtree.
    - Extract and add control flags (`tango_ctl_som`, `tango_ctl_eom`, `tango_ctl_err`, `tango_ctl_orig`) to the `ctl_node`.
    - Add timestamps `tango_tsorig` and `tango_tspub` to the subtree.
    - Extract the `dcache_contents` from the buffer and add it to the subtree.
    - Based on the `link_name`, call the appropriate dissector for further processing of `dcache_contents`.
    - If `link_name` matches certain patterns, call specific dissectors like `eth_withoutfcs`, `fd_txn_m_t`, `fd_poh_shred`, `fd_pack_rebate_t`, `solana.tpu.udp`, `fd_shred34_t`, `fd_became_leader_t`, or `fd_done_packing_t`.
- **Output**: The function does not return a value; it modifies the `tree` to include the dissected protocol fields and calls other dissectors as needed.



---
Made with ❤️ by [Driver](https://www.driver.ai/)