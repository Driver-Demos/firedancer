<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for setting up, deploying, invoking, upgrading, and closing Solana programs, and creating nonce accounts.

# Purpose
This Rust code provides a set of functions to manage and deploy programs on the Solana blockchain. It includes functionality for setting up buffer accounts, deploying programs, invoking programs, upgrading programs, closing programs, and creating nonce accounts. The code uses the Solana SDK and client libraries to interact with the blockchain, and it defines several public functions that return keypairs and instructions necessary for these operations.

The primary components of this code are functions that generate and send transactions to the Solana network. These functions include `set_up_buffer_account`, which prepares a buffer account for program deployment; `deploy_program_instructions`, which creates instructions to deploy a program; `invoke_program_instructions`, which generates instructions to invoke a deployed program; `upgrade_program_instructions`, which provides instructions to upgrade an existing program; and `close_program_instructions`, which creates instructions to close a program. Additionally, `create_nonce_account_instructions` is used to create and initialize nonce accounts. Each function is designed to work with the Solana blockchain's transaction and account model, utilizing keypairs and instructions to perform operations securely and efficiently.
# Imports and Dependencies

---
- `solana_sdk`
- `solana_client`
- `solana_cli`
- `std`


# Functions

---
### close\_program\_instructions
Generates instructions to close a Solana program account.
- **Inputs**:
    - `payer`: A `Keypair` representing the payer of the transaction.
    - `program_account`: A `Keypair` representing the program account to be closed.
- **Logic and Control Flow**:
    - Finds the program data address using the `program_account` public key and the `bpf_loader_upgradeable` program ID.
    - Creates a close instruction using `bpf_loader_upgradeable::close_any` with the program data address, payer's public key, and optionally the program account's public key.
    - Returns a vector containing the close instruction.
- **Output**: A vector of `Instruction` objects that contain the instructions to close the program account.


---
### create\_nonce\_account\_instructions
Creates and initializes a nonce account with specified lamports and returns the account keypair and instructions.
- **Inputs**:
    - `nonce_account`: An optional `Keypair` for the nonce account; if not provided, a new `Keypair` is created.
    - `payer`: A `Keypair` representing the payer of the transaction.
    - `lamports`: A `u64` value representing the amount of lamports to fund the nonce account.
- **Logic and Control Flow**:
    - Initialize an empty vector `nonce_account_instructions` to store instructions.
    - Check if `nonce_account` is provided; if not, create a new `Keypair`.
    - Create an account creation instruction using `system_instruction::create_account` with the payer's public key, nonce account's public key, specified lamports, and the size of the nonce state.
    - Add the account creation instruction to `nonce_account_instructions`.
    - Create an instruction to initialize the nonce account using `Instruction::new_with_bincode` with the system program ID, `InitializeNonceAccount` instruction, and required account metadata.
    - Add the initialize nonce account instruction to `nonce_account_instructions`.
    - Return the nonce account `Keypair` and the vector of instructions.
- **Output**: A tuple containing the `Keypair` of the nonce account and a `Vec<Instruction>` with the instructions to create and initialize the nonce account.


---
### deploy\_program\_instructions
Generates instructions to deploy a Solana program using a buffer account.
- **Inputs**:
    - `client`: An `RpcClient` reference used to interact with the Solana blockchain.
    - `payer`: A `Keypair` reference representing the payer of the transaction fees.
    - `program_keypair`: An optional `Keypair` for the program account; if not provided, a new `Keypair` is generated.
    - `buffer_account`: A `Keypair` reference for the buffer account containing the program data.
    - `program_length`: The length of the program data in bytes.
- **Logic and Control Flow**:
    - If `program_keypair` is `None`, generate a new `Keypair` for `program_account`.
    - Call `bpf_loader_upgradeable::deploy_with_max_program_len` to create deployment instructions using the payer's public key, program account's public key, buffer account's public key, and the minimum balance for rent exemption for the program.
    - Return the `program_account` and the generated `deploy_instructions`.
- **Output**: A tuple containing the `Keypair` for the program account and a `Vec<Instruction>` for deploying the program.


---
### invoke\_program\_instructions
Creates instructions to invoke a program on the Solana blockchain using a specified program account and account data.
- **Inputs**:
    - `client`: An `RpcClient` reference used to interact with the Solana blockchain.
    - `payer`: A `Keypair` reference representing the payer of the transaction fees.
    - `program_account`: A `Keypair` reference for the program account to be invoked.
    - `account_data`: A byte slice containing the data for the account to be used in the invocation.
- **Logic and Control Flow**:
    - Initialize an empty vector `invoke_instructions` to store the instructions.
    - Create a new `Keypair` for `run_account`.
    - Generate an `open_account_instruction` using `system_instruction::create_account` to create a new account with the necessary balance and size, and add it to `invoke_instructions`.
    - Create a vector `account_metas` containing `AccountMeta` for the `run_account`.
    - Generate an `invoke_instruction` using `Instruction::new_with_bytes` with the program account, account data, and account metas, and add it to `invoke_instructions`.
    - Return the `run_account` and `invoke_instructions` as a tuple.
- **Output**: A tuple containing a `Keypair` for the `run_account` and a vector of `Instruction` objects for invoking the program.


---
### set\_up\_buffer\_account
Sets up a buffer account to deploy a program on the Solana blockchain.
- **Inputs**:
    - `client`: An `Arc<RpcClient>` that interacts with the Solana blockchain.
    - `payer`: A `Keypair` representing the payer of the transaction fees.
    - `program_data`: A `Vec<u8>` containing the program data to be deployed.
- **Logic and Control Flow**:
    - Retrieve the latest blockhash from the `client`.
    - Create a new `Keypair` for the buffer account.
    - Calculate the minimum balance required for rent exemption for the program data size.
    - Create an instruction to create a buffer account using `bpf_loader_upgradeable::create_buffer`.
    - Create and sign a transaction with the buffer account creation instruction and send it using the `client`.
    - Define a closure `create_msg` to create a message for writing chunks of program data to the buffer account.
    - Calculate the maximum chunk size for the program data using `calculate_max_chunk_size`.
    - Iterate over the program data in chunks, creating messages for each chunk and adding them to a `messages` vector.
    - Initialize a QUIC connection cache and create a TPU client for sending transactions.
    - Send and confirm the transactions in parallel using `send_and_confirm_transactions_in_parallel_blocking`.
    - Print the public key of the buffer account.
- **Output**: Returns a `Keypair` representing the buffer account.


---
### upgrade\_program\_instructions
Generates instructions to upgrade a Solana program using a buffer account.
- **Inputs**:
    - `payer`: A `Keypair` representing the payer of the transaction.
    - `upgrade_buffer_account`: A `Keypair` representing the buffer account containing the upgraded program data.
    - `program_account`: A `Keypair` representing the program account to be upgraded.
- **Logic and Control Flow**:
    - Create an upgrade instruction using the `bpf_loader_upgradeable::upgrade` function with the public keys of the `program_account`, `upgrade_buffer_account`, and `payer`.
    - Return a vector containing the created upgrade instruction.
- **Output**: A vector of `Instruction` objects containing the upgrade instructions.



---
Made with ❤️ by [Driver](https://www.driver.ai/)