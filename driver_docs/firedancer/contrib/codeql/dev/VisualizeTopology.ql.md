<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines classes and functions to visualize network topology using JSON and Mermaid representations.

# Purpose
The code defines a set of classes and functions to model and visualize a network topology. It uses classes such as `Tile`, `InLink`, `OutLink`, and `Link` to represent different components and connections within the topology. The `Tile` class extends `FunctionCall` and represents a network tile, capturing its name and whether it is a multi-tile. The `InLink` and `OutLink` classes also extend `FunctionCall` and represent incoming and outgoing links for tiles, respectively. These classes extract relevant information from function calls, such as names and tile associations, and ensure that they are part of a specified topology.

The code provides methods to generate JSON and Mermaid representations of the topology. The `getJsonRepr` methods in the `Tile` and `Link` classes return JSON strings that describe the tiles and links. The `getMermaidRepr` methods provide Mermaid syntax for visualizing the topology in a flowchart format. The functions `allTiles`, `allLinks`, `getJson`, `allTilesMermaid`, `allLinksMermaid`, and `getMermaid` aggregate these representations to produce complete JSON and Mermaid outputs for the entire topology.

The code is intended to be used as a library for visualizing network topologies. It does not define a public API or external interfaces but provides internal methods for generating visual representations. The `inTopology` predicate is used to filter relevant locations within the source files, ensuring that only specific parts of the codebase are considered for visualization. The code is structured to facilitate the extraction and representation of network components and their relationships, enabling users to visualize complex network structures.
# Imports and Dependencies

---
- `cpp`


# Data Structures

---
### Tile
- **Type**: ``class``
- **Members**:
    - ``name``: Stores the name of the tile.
- **Description**: Represents a tile in a network topology, extending the `FunctionCall` class. It initializes by checking if the target has the name `fd_topob_tile`, assigns a name from the second argument, and verifies its location in the topology. The class provides methods to get a JSON representation of the tile, determine if it is a multi-tile, and generate a Mermaid diagram representation.


---
### InLink
- **Type**: ``class``
- **Members**:
    - ``name``: Stores the name of the link.
    - ``in_tile``: Stores the name of the input tile.
- **Description**: Represents a function call that identifies an input link in a network topology. It initializes by checking if the target function name is either `fd_topob_tile_in` or `fd_topos_tile_in_net`, and assigns the `name` and `in_tile` based on the arguments of the function call. The class also includes methods to retrieve the `name` and `in_tile` values.


---
### OutLink
- **Type**: ``class``
- **Members**:
    - ``name``: Stores the name of the `OutLink`.
    - ``out_tile``: Stores the name of the output tile associated with the `OutLink`.
- **Description**: Represents an outgoing link in a network topology, capturing the name and output tile of the link. The constructor initializes the `name` and `out_tile` based on specific function calls and checks if the location is within a defined topology. It provides methods to retrieve the `name` and `out_tile` values.


---
### Link
- **Type**: ``class``
- **Members**:
    - ``name``: Stores the name of the link.
    - ``out_tile``: Stores the name of the output tile.
    - ``in_tile``: Stores the name of the input tile.
- **Description**: Represents a link between tiles, with attributes for the link's name, output tile, and input tile. The constructor checks for the existence of an `OutLink` and an `InLink` with matching names to initialize these attributes. The class provides methods to get JSON and Mermaid representations of the link.


# Functions

---
### inTopology
Checks if a given `Location` object is part of a specific topology by verifying its file path.
- **Inputs**:
    - `loc`: A `Location` object that represents a specific location in the codebase.
- **Logic and Control Flow**:
    - Get the file associated with the `Location` object using `loc.getFile()`.
    - Retrieve the relative path of the file using `getRelativePath()`.
    - Check if the relative path is equal to either `"src/app/firedancer/topology.c"` or `"src/disco/net/fd_net_tile_topo.c"`.
    - Return true if the path matches either of the specified paths, otherwise return false.
- **Output**: A boolean value indicating whether the `Location` is part of the specified topology.


---
### Tile
Represents a function call to `fd_topob_tile` with specific conditions and provides JSON and Mermaid representations.
- **Inputs**:
    - `None`: The `Tile` class does not take any direct input parameters upon instantiation.
- **Logic and Control Flow**:
    - Checks if the target function call has the name `fd_topob_tile`.
    - Assigns the second argument of the function call to the `name` attribute if it is a `StringLiteral`.
    - Verifies that the location of the function call is within the specified topology using the `inTopology` predicate.
    - Ensures that the `name` is not equal to "sock".
    - Provides a JSON representation of the tile with the `getJsonRepr` method, which includes the name and whether it is a multi-tile.
    - Determines if the tile is a multi-tile by checking for the existence of a `ForStmt` that is a child of the current instance.
    - Provides a Mermaid shape representation based on whether the tile is a multi-tile or not.
    - Generates a Mermaid representation of the tile with the `getMermaidRepr` method, which includes the name and shape.
- **Output**: The `Tile` class outputs JSON and Mermaid representations of the tile, including its name and whether it is a multi-tile.


---
### Tile\.getJsonRepr
Provides a JSON representation of a `Tile` object with its name and multi-tile status.
- **Inputs**: None
- **Logic and Control Flow**:
    - Concatenates the string '{"name": "' with the `name` attribute of the `Tile` object.
    - Appends '", "isMultiTile": ' to the string.
    - Calls the `isMultiTile` method to determine if the tile is multi-tile and appends the result ('true' or 'false') to the string.
    - Completes the JSON string with a closing '}' and assigns it to `result`.
- **Output**: A JSON string representing the `Tile` object, including its name and whether it is a multi-tile.


---
### Tile\.isMultiTile
Determines if a `Tile` instance is associated with a `ForStmt` child, indicating it is a multi-tile.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if there exists a `ForStmt` instance `f` such that `f` is a child of the current `Tile` instance.
    - If such a `ForStmt` exists, the function returns the string "true".
    - If no such `ForStmt` exists, the function returns the string "false".
- **Output**: Returns a string "true" if the `Tile` instance is associated with a `ForStmt` child, otherwise returns "false".


---
### Tile\.getMermaidShape
Determines the shape type for a Mermaid diagram based on whether the tile is multi-tile or not.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the `isMultiTile` method to check if the tile is a multi-tile.
    - If `isMultiTile` returns "true", sets the result to "processes".
    - If `isMultiTile` returns anything other than "true", sets the result to "rect".
- **Output**: Returns a string that is either "processes" or "rect".


---
### Tile\.getMermaidRepr
Generates a Mermaid diagram representation of a `Tile` object.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `this.getMermaidShape()` to determine the shape of the tile in the diagram.
    - Concatenates the `name` of the tile with the shape information to form the Mermaid representation string.
- **Output**: A string representing the `Tile` object in Mermaid diagram format, including the tile's name and shape.


---
### InLink
Represents a function call to either `fd_topob_tile_in` or `fd_topos_tile_in_net` and extracts specific arguments if the location is within a defined topology.
- **Inputs**:
    - `name`: A string representing the name of the link, extracted from the function arguments.
    - `in_tile`: A string representing the input tile, extracted from the function arguments.
- **Logic and Control Flow**:
    - Checks if the target function name is `fd_topob_tile_in` and extracts the name from the 4th argument and the input tile from the 1st argument if the location is in the topology.
    - Alternatively, checks if the target function name is `fd_topos_tile_in_net` and extracts the name from the 2nd argument, setting the input tile to 'net' if the location is in the topology.
- **Output**: An instance of the `InLink` class with `name` and `in_tile` attributes set based on the function call arguments.


---
### InLink\.getName
Returns the name of the `InLink` instance.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of the `name` attribute of the `InLink` instance.
- **Output**: The function outputs a string representing the name of the `InLink` instance.


---
### InLink\.getInTile
Returns the `in_tile` value for an `InLink` object.
- **Inputs**: None
- **Logic and Control Flow**:
    - The method retrieves the value of the `in_tile` attribute from the `InLink` object.
- **Output**: The method returns a string representing the `in_tile` value.


---
### OutLink
Represents an outgoing link in a network topology, capturing the name and the associated output tile.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if the target function name is `fd_topob_tile_out` and assigns `name` and `out_tile` from the 3rd and 1st arguments respectively, if the location is in the topology.
    - Alternatively, checks if the target function name is `fd_topos_net_rx_link` and assigns `name` from the 1st argument and sets `out_tile` to `net`, if the location is in the topology.
- **Output**: An instance of the `OutLink` class with `name` and `out_tile` attributes set based on the function call arguments and conditions.


---
### OutLink\.getName
Returns the `name` attribute of an `OutLink` object.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of the `name` attribute of the `OutLink` class.
- **Output**: The function outputs a string that represents the `name` of the `OutLink`.


---
### OutLink\.getOutTile
Retrieves the `out_tile` value for an `OutLink` object.
- **Inputs**:
    - `self`: The instance of the `OutLink` class for which the `out_tile` is retrieved.
- **Logic and Control Flow**:
    - The method accesses the `out_tile` attribute of the `OutLink` instance.
    - It returns the value of the `out_tile` attribute.
- **Output**: Returns a string representing the `out_tile` value of the `OutLink` instance.


---
### Link
Generates a Mermaid diagram representation of the topology by concatenating Mermaid representations of all tiles and links.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `allTilesMermaid()` to get the Mermaid representation of all tiles.
    - Calls `allLinksMermaid()` to get the Mermaid representation of all links.
    - Concatenates the string 'flowchart LR\n' with the results from `allTilesMermaid()` and `allLinksMermaid()`.
- **Output**: A string representing the Mermaid diagram of the topology.


---
### Link\.getJsonRepr
Generates a JSON representation of a `Link` object with its name, output tile, and input tile.
- **Inputs**: None
- **Logic and Control Flow**:
    - Concatenates the `name`, `out_tile`, and `in_tile` properties of the `Link` object into a JSON formatted string.
    - Assigns the concatenated string to the `result` variable.
- **Output**: A JSON string representing the `Link` object with its `name`, `out_tile`, and `in_tile` properties.


---
### Link\.getMermaidRepr
Generates a Mermaid diagram representation of a link between tiles.
- **Inputs**: None
- **Logic and Control Flow**:
    - Concatenates the `out_tile`, `name`, and `in_tile` attributes of the `Link` object.
    - Formats the concatenated string to represent a Mermaid diagram link with the format `out_tile-->|name|in_tile`.
- **Output**: A string representing the Mermaid diagram link.


---
### truncate
Removes the last two characters from a given string.
- **Inputs**:
    - ``str``: The input string from which the function will remove the last two characters.
- **Logic and Control Flow**:
    - Calculate the length of the input string `str`.
    - Use the `prefix` method to get a substring of `str` that excludes the last two characters.
    - Assign the resulting substring to `result`.
- **Output**: A string that is the input string `str` without its last two characters.


---
### allTiles
Generates a JSON representation of all `Tile` objects.
- **Inputs**: None
- **Logic and Control Flow**:
    - Uses the `concat` function to iterate over all `Tile` objects.
    - Calls `getJsonRepr()` on each `Tile` object to get its JSON representation.
    - Concatenates the JSON representations of all `Tile` objects, separated by a comma and a space.
    - Orders the concatenated string by the JSON representation in descending order.
- **Output**: A string containing the JSON representation of all `Tile` objects, concatenated and ordered.


---
### allLinks
Generates a JSON representation of all unique links in the topology.
- **Inputs**: None
- **Logic and Control Flow**:
    - Uses the `concat` function to iterate over all `Link` objects.
    - For each `Link`, it calls `getJsonRepr()` to get the JSON representation of the link.
    - Ensures uniqueness by using the `unique` function on the JSON strings.
    - Concatenates the unique JSON strings with a comma and space separator.
- **Output**: A string containing the JSON representation of all unique links.


---
### getJson
Generates a JSON representation of all tiles and links.
- **Inputs**: None
- **Logic and Control Flow**:
    - Call `allTiles()` to get JSON representations of all `Tile` objects and concatenate them with a comma and space.
    - Call `truncate()` on the result of `allTiles()` to remove the trailing comma and space.
    - Call `allLinks()` to get JSON representations of all `Link` objects and concatenate them with a comma and space.
    - Call `truncate()` on the result of `allLinks()` to remove the trailing comma and space.
    - Concatenate the results of `truncate(allTiles())` and `truncate(allLinks())` into a JSON formatted string with keys `tiles` and `links`.
- **Output**: A JSON string containing arrays of tiles and links.


---
### allTilesMermaid
Generates a Mermaid diagram representation of all tiles.
- **Inputs**: None
- **Logic and Control Flow**:
    - Uses the `concat` function to iterate over each `Tile` object.
    - Calls `getMermaidRepr` on each `Tile` to get its Mermaid representation.
    - Orders the Mermaid representations in descending order.
    - Concatenates the ordered Mermaid representations with newline characters.
- **Output**: A string containing the Mermaid diagram representation of all tiles, separated by newline characters.


---
### allLinksMermaid
Generates a Mermaid diagram representation of all links.
- **Inputs**: None
- **Logic and Control Flow**:
    - Uses the `concat` function to iterate over each `Link` object.
    - For each `Link`, calls `getMermaidRepr` to get its Mermaid representation.
    - Ensures uniqueness of each Mermaid representation string using the `unique` function.
    - Concatenates all unique Mermaid representation strings with a newline character.
- **Output**: A string containing the Mermaid diagram representation of all links, each on a new line.


---
### getMermaid
Generates a Mermaid diagram representation of tiles and links in a flowchart format.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `allTilesMermaid()` to get the Mermaid representation of all tiles.
    - Calls `allLinksMermaid()` to get the Mermaid representation of all links.
    - Concatenates the string 'flowchart LR\n' with the results from `allTilesMermaid()` and `allLinksMermaid()` to form the complete Mermaid diagram.
- **Output**: A string representing the Mermaid diagram of the tiles and links in a flowchart format.



---
Made with ❤️ by [Driver](https://www.driver.ai/)