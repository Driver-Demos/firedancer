<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Identifies functions with a magic field that do not check or reset it, issuing a warning.

# Purpose
This code is a query script designed to analyze C++ source code for specific patterns related to memory safety. It identifies functions that manage objects with a `magic` field but do not perform necessary checks or resets on this field during destruction operations. The script is written using a domain-specific language for code analysis, likely intended for use with a static analysis tool.

The script defines several classes that extend base classes such as `FieldAccess`, `ComparisonOperation`, and `Assignment`. These classes, `MagicAccess`, `MagicCmp`, and `MagicNulling`, are used to detect access to the `magic` field, comparisons involving the `magic` field, and assignments that nullify the `magic` field, respectively. The `CheckFunction` class represents functions that should handle the `magic` field correctly. It includes predicates to determine if a function performs a comparison on the `magic` field (`hasMagicCmp`) and if it nullifies the `magic` field (`setsMagicNull`).

The script concludes with a query that selects functions which do not meet the criteria defined in the `valid` predicate of the `CheckFunction` class. These functions are flagged with a warning message indicating that they should check or nullify the `magic` field. This script is part of a static analysis toolchain aimed at improving code safety by enforcing best practices for handling memory-related fields.
# Imports and Dependencies

---
- `cpp`
- `filter`


# Data Structures

---
### MagicAccess
- **Type**: ``class``
- **Members**:
    - ``MagicAccess``: Represents a field access operation specifically targeting a field named 'magic'.
    - ``MagicCmp``: Represents a comparison operation that involves a 'magic' field access.
    - ``MagicNulling``: Represents an assignment operation that involves a 'magic' field access.
    - ``CheckFunction``: Represents a function that checks for the presence and handling of a 'magic' field within a specific parent type.
- **Description**: The `MagicAccess` class is a specialized field access operation that targets a field named 'magic'. It is part of a system designed to ensure that functions handling 'magic' fields perform necessary checks and resets to prevent memory corruption. The `MagicCmp` and `MagicNulling` classes extend this functionality by representing comparison and assignment operations involving the 'magic' field. The `CheckFunction` class further ensures that functions correctly handle the 'magic' field by checking for its presence and ensuring it is either compared or reset, especially in functions related to deletion or joining operations.


---
### MagicCmp
- **Type**: ``class``
- **Members**:
    - ``MagicCmp``: Represents a comparison operation that checks for the presence of a `MagicAccess` instance as a child operand.
- **Description**: `MagicCmp` is a class that extends `ComparisonOperation` and is used to identify comparison operations involving a `MagicAccess` instance. It checks if any operand of the comparison operation has a child that is a `MagicAccess`, which targets the `magic` field. This class is part of a system designed to ensure that functions handling memory corruption issues properly check and reset the `magic` field.


---
### MagicNulling
- **Type**: ``class``
- **Members**:
    - `MagicNulling`: Represents an assignment operation that involves a `magic` field.
- **Description**: Represents an assignment operation that involves a `magic` field. It checks if a `MagicAccess` instance exists where the enclosing statement of the `MagicAccess` is a child of the `MagicNulling` instance.


---
### CheckFunction
- **Type**: ``class``
- **Members**:
    - ``magicField``: Represents the field named 'magic' that the function checks and resets.
    - ``parentType``: Represents the type of the parent structure that contains the `magicField`.
    - ``CheckFunction``: Constructor that initializes the `CheckFunction` by checking the existence of a parameter with the `parentType` and a field named 'magic'.
    - ``hasMagicCmp``: Predicate that checks if there is a comparison operation involving the `magicField`.
    - ``setsMagicNull``: Predicate that checks if there is an assignment operation that nullifies the `magicField`.
    - ``getParentType``: Returns the name of the `parentType`.
    - ``valid``: Predicate that checks if the function has a comparison for the `magicField` and either nullifies it or is not a delete function.
- **Description**: Represents a function that checks and resets a 'magic' field in a parent structure, ensuring that the function has a comparison operation for the 'magic' field and either nullifies it or is not a delete function.



---
Made with ❤️ by [Driver](https://www.driver.ai/)