<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A Python script for detecting memory leaks by analyzing log files for allocation and deallocation events.

# Purpose
This script is a command-line tool designed to detect memory leaks by analyzing log files. It reads input from the standard input, which is expected to be piped from a log file. The log file should contain lines that start with either `+++ ALLOC` or `+++ FREE`, indicating memory allocation and deallocation events, respectively. The script processes these lines to track memory addresses and their associated backtraces. It maintains a dictionary, `addr_map`, to map memory addresses to their backtrace information and size.

The script calculates the total size of memory that remains allocated without being freed, grouped by backtrace. It uses the `Counter` class from the `collections` module to count the occurrences and sizes of these backtraces. The results are printed in ascending order of memory size, showing the size and count of allocations for each backtrace. This output helps identify potential memory leaks by highlighting backtraces that have not been properly freed. The script is intended to be executed as a standalone program and does not define any public APIs or external interfaces.
# Imports and Dependencies

---
- `collections.Counter`
- `sys`


# Functions

---
### main<!-- {{#callable:firedancer/contrib/tool/leak-detector.main}} -->
[View Source →](<../../../../contrib/tool/leak-detector.py#L10>)

Reads input from standard input, processes memory allocation and deallocation logs, and outputs a summary of memory usage.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `line_cnt` to 0 and `addr_map` as an empty dictionary.
    - Enter an infinite loop to read lines from standard input.
    - Increment `line_cnt` for each line read.
    - Break the loop if an empty line is encountered.
    - Check if the line starts with '+++', indicating a memory operation.
    - Parse the operation type and parameters from the line.
    - For 'ALLOC' and 'FREE' operations, read the specified number of backtrace lines.
    - Store or remove entries in `addr_map` based on the operation type.
    - After reading all input, initialize `bt_map_sz` and `bt_map_cnt` as `Counter` objects.
    - Aggregate memory sizes and counts for each backtrace in `addr_map`.
    - Sort and print the aggregated memory usage data.
- **Output**: Prints the size and count of memory allocations for each unique backtrace.



---
Made with ❤️ by [Driver](https://www.driver.ai/)