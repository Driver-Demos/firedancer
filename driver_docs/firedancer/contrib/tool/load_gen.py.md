<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A tool for generating and sending Solana transactions, including account creation and token transfers, with multiprocessing and threading support.

# Purpose
The code is a Python script designed to interact with the Solana blockchain. It facilitates the creation and funding of accounts, as well as the generation and sending of various types of transactions, including system transfers, token transfers, and nano-token transfers. The script uses several Solana-specific libraries to manage accounts and transactions, and it employs multiprocessing and threading to handle concurrent operations efficiently. The script is intended to be executed as a standalone program, as indicated by the presence of a [`main`](<#main>) function and the use of command-line argument parsing via the `argparse` module.

Key components of the script include functions for generating transactions ([`gen_tx_empty`](<#gen_tx_empty>), [`gen_tx_system_transfer`](<#gen_tx_system_transfer>), [`gen_tx_token_transfer`](<#gen_tx_token_transfer>), [`gen_tx_nano_token_transfer`](<#gen_tx_nano_token_transfer>)), sending transactions ([`send_txs`](<#send_txs>)), and monitoring transaction throughput ([`monitor_send_tps`](<#monitor_send_tps>)). The script also includes functions to fetch recent blockhashes from the Solana network and to manage account balances. The script defines a public API through its command-line interface, allowing users to specify parameters such as the number of keys, transaction type, and network endpoints. The script is structured to support high transaction throughput by leveraging parallel processing and network communication via UDP sockets.
# Imports and Dependencies

---
- `argparse`
- `logging`
- `json`
- `time`
- `random`
- `socket`
- `math`
- `multiprocessing`
- `threading`
- `requests`
- `functools.partial`
- `typing.List`
- `multiprocessing.sharedctypes.SynchronizedBase`
- `multiprocessing.Event`
- `multiprocessing.Value`
- `multiprocessing.Array`
- `tqdm`
- `pqdm.processes.pqdm`
- `solana.transaction.Transaction`
- `solana.rpc.api.Client`
- `solders.hash.Hash`
- `solana.rpc.commitment.Commitment`
- `solders.keypair.Keypair`
- `solders.system_program.TransferParams`
- `solders.system_program.transfer`
- `solders.system_program.create_account`
- `solders.system_program.CreateAccountParams`
- `solders.compute_budget.set_compute_unit_limit`
- `solders.compute_budget.set_compute_unit_price`
- `solders.pubkey.Pubkey`
- `solders.instruction.AccountMeta`
- `solders.instruction.Instruction`
- `solders.system_program.ID`
- `spl.token.client.Token`
- `spl.token.constants.TOKEN_PROGRAM_ID`
- `spl.token._layouts.ACCOUNT_LAYOUT`
- `spl.token._layouts.MINT_LAYOUT`
- `spl.token._layouts.MULTISIG_LAYOUT`
- `spl.token.instructions.initialize_mint`
- `spl.token.instructions.get_associated_token_address`
- `spl.token.instructions.create_associated_token_account`
- `spl.token.instructions.InitializeMintParams`
- `spl.token.instructions.mint_to`
- `spl.token.instructions.MintToParams`
- `spl.token.instructions.transfer`
- `spl.token.instructions.TransferParams`
- `solders.rent.Rent`
- `solana.rpc.types.TxOpts`


# Global Variables

---
### TXN\_TYPE\_EMPTY
- **Type**: ``int``
- **Description**: Represents a transaction type identifier with a value of 0. This identifier is used to denote an empty transaction type in the system.
- **Use**: Used to specify that a transaction is of the empty type when processing or generating transactions.


---
### TXN\_TYPE\_SYSTEM\_TRANSFER
- **Type**: ``int``
- **Description**: Represents a constant integer value used to identify a specific type of transaction, specifically a system transfer transaction, in the code. It is assigned the value `1`.
- **Use**: Used to specify the transaction type as a system transfer in various functions and logic throughout the code.


---
### TXN\_TYPE\_TOKEN\_TRANSFER
- **Type**: `int`
- **Description**: Represents the transaction type identifier for a token transfer operation. It is assigned the integer value `2`.
- **Use**: Used to specify the type of transaction as a token transfer in various functions and operations.


---
### TXN\_TYPE\_NANO\_TOKEN\_TRANSFER
- **Type**: `int`
- **Description**: Represents a constant integer value that identifies a specific type of transaction, specifically a nano token transfer, in the system.
- **Use**: Used to specify the transaction type as a nano token transfer in various functions and operations.


---
### NANO\_TOKEN\_ID
- **Type**: ``Pubkey``
- **Description**: Represents a public key for a specific token in the Solana blockchain. It is initialized using the `from_string` method with a specific string that identifies the token.
- **Use**: Used as the owner identifier for accounts and instructions related to the nano token in the Solana blockchain.


---
### seed\_file
- **Type**: `file object`
- **Description**: Opens the file located at `../keygrinds/bench-tps.json` in read mode. This file is expected to contain JSON data that is loaded and used in the program.
- **Use**: Used to read JSON data from the specified file for further processing.


---
### top\_seed
- **Type**: ``bytes``
- **Description**: The `top_seed` variable is a byte sequence that is loaded from a JSON file named `bench-tps.json`. It is used to initialize a keypair for cryptographic operations.
- **Use**: Used to derive keypairs for cryptographic operations in the application.


---
### fd\_mint
- **Type**: ``Keypair``
- **Description**: Represents a keypair object generated from a seed and a specific derivation path. The derivation path used is `m/44'/45'/30'/9999'`, which is a hierarchical deterministic (HD) wallet path.
- **Use**: Used to generate a public key for the `fd_mint` address, which is printed and potentially used in token-related operations.


---
### config\_acc
- **Type**: ``Keypair``
- **Description**: Represents a keypair object created from bytes loaded from a JSON configuration file. The keypair is initialized using the `Keypair.from_bytes` method, which converts the byte data into a keypair instance.
- **Use**: Used to manage and access the public key and private key for a specific account configuration.


---
### nano\_mint
- **Type**: ``Keypair``
- **Description**: Represents a keypair generated from a seed and a specific derivation path. It is created using the `Keypair.from_seed_and_derivation_path` method with `top_seed` and a derivation path of `m/44'/45'/30'/9992'`. This keypair is used to derive a public key for the nano mint address.
- **Use**: Used to generate and manage the keypair for the nano mint address in the Solana blockchain.


# Functions

---
### get\_recent\_blockhash<!-- {{#callable:firedancer/contrib/tool/load_gen.get_recent_blockhash}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L58>)

Fetches the most recent blockhash from a Solana RPC endpoint.
- **Inputs**:
    - `rpc`: A string representing the URL of the Solana RPC endpoint to query.
- **Logic and Control Flow**:
    - Constructs a JSON-RPC request payload to get the latest blockhash with a commitment level of 'processed'.
    - Sends a POST request to the specified RPC endpoint with the constructed payload.
    - Prints the response text from the RPC call for debugging purposes.
    - Parses the JSON response to extract the blockhash value.
    - Converts the blockhash string into a `Hash` object and returns it.
- **Output**: A `Hash` object representing the most recent blockhash.


---
### get\_balance<!-- {{#callable:firedancer/contrib/tool/load_gen.get_balance}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L64>)

Retrieves the balance of a specified account using an RPC endpoint.
- **Inputs**:
    - `rpc`: A string representing the RPC endpoint URL to send the request to.
    - `acc`: A `Pubkey` object representing the public key of the account whose balance is to be retrieved.
- **Logic and Control Flow**:
    - Converts the `acc` parameter to a string format to use in the JSON-RPC request.
    - Constructs a JSON-RPC request payload to call the `getBalance` method with the account's public key and a commitment level of `confirmed`.
    - Sends a POST request to the specified `rpc` endpoint with the constructed JSON-RPC payload.
    - Checks if the HTTP response status code is not 200, and if so, returns 0 indicating failure to retrieve balance.
    - If the response status code is 200, parses the JSON response to extract and return the balance value from the `result` field.
    - Handles any exceptions that occur during the process and returns 0 in case of an error.
- **Output**: An integer representing the balance of the account, or 0 if an error occurs or the request fails.


---
### get\_account\_info<!-- {{#callable:firedancer/contrib/tool/load_gen.get_account_info}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L76>)

Fetches account information from a specified RPC endpoint and returns a status code based on the response.
- **Inputs**:
    - `rpc`: A string representing the RPC endpoint URL to which the request is sent.
    - `acc`: A string representing the account identifier for which information is requested.
- **Logic and Control Flow**:
    - Constructs a JSON-RPC request payload with the method 'getAccountInfo' and the specified account identifier.
    - Sends a POST request to the specified RPC endpoint with the constructed payload and a JSON content type header.
    - Checks if the HTTP response status code is not 200, and if so, returns 0.
    - Checks if the 'value' field in the JSON response is None, prints the response, and returns 0.
    - If the 'value' field is not None, prints the response and returns 1.
- **Output**: Returns an integer status code: 0 if the request fails or the account information is not found, and 1 if the account information is successfully retrieved.


---
### parse\_args<!-- {{#callable:firedancer/contrib/tool/load_gen.parse_args}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L88>)

Parses command-line arguments for a script that interacts with Solana transactions.
- **Inputs**: None
- **Logic and Control Flow**:
    - Creates an `ArgumentParser` object to handle command-line arguments.
    - Adds several required arguments to the parser, each with a specific type and help description.
    - Calls `parser.parse_args()` to parse the command-line arguments and store them in the `args` variable.
    - Returns the parsed arguments as an `argparse.Namespace` object.
- **Output**: An `argparse.Namespace` object containing the parsed command-line arguments.


---
### send\_round\_of\_txs<!-- {{#callable:firedancer/contrib/tool/load_gen.send_round_of_txs}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L137>)

Sends a batch of transactions to multiple TPU endpoints using a socket.
- **Inputs**:
    - `txs`: A list of `Transaction` objects to send.
    - `sock`: A socket object used to send the transactions.
    - `tpus`: A list of TPU (Transaction Processing Unit) endpoints to which the transactions are sent.
- **Logic and Control Flow**:
    - Iterates over each transaction in the `txs` list using a progress bar from `tqdm`.
    - Converts each transaction to a byte format using the `to_solders` method.
    - Iterates over each TPU endpoint in the `tpus` list.
    - Sends the byte-formatted transaction to each TPU endpoint using the `sendto` method of the socket.
    - Pauses for 0.001 seconds after sending each transaction to all TPU endpoints.
- **Output**: No return value; the function sends transactions over the network.


---
### fund\_config\_account<!-- {{#callable:firedancer/contrib/tool/load_gen.fund_config_account}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L145>)

Creates and signs a Solana transaction to fund a configuration account with specified lamports and additional parameters.
- **Inputs**:
    - `funder`: The `Keypair` object representing the account that will fund the transaction.
    - `lamports`: The number of lamports to transfer to the configuration account.
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `range`: An additional amount to add to the lamports for the transaction.
- **Logic and Control Flow**:
    - Creates a `Transaction` object with the given `recent_blockhash`, no fee payer, and the funder's public key.
    - Sets compute unit price and limit for the transaction using `set_compute_unit_price` and `set_compute_unit_limit`.
    - Adds an instruction to create an account with the specified lamports plus range, space, and owner using `create_account`.
    - Prepares instruction data with a zero discriminator converted to bytes.
    - Defines account metadata for the instruction, including the configuration account, system program ID, and funder's public key.
    - Creates an `Instruction` object with the account metadata, program ID, and data, and adds it to the transaction.
    - Signs the transaction with the funder and configuration account keypairs.
    - Returns the signed transaction.
- **Output**: A signed `Transaction` object ready to be sent to the Solana network.


---
### fund\_nano\_mint\_account<!-- {{#callable:firedancer/contrib/tool/load_gen.fund_nano_mint_account}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L161>)

Creates and signs a transaction to fund a nano mint account with specified lamports and additional parameters.
- **Inputs**:
    - `funder`: The `Keypair` object representing the account that will fund the nano mint account.
    - `lamports`: The number of lamports to transfer to the nano mint account.
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `range`: An additional amount to add to the lamports for the transaction.
- **Logic and Control Flow**:
    - Creates a `Transaction` object with the given `recent_blockhash`, no fee payer, and the funder's public key.
    - Sets compute unit price to 100 and compute unit limit to 300,000 for the transaction.
    - Adds an instruction to create an account with the specified lamports plus range, space of 64 bytes, and owner as `NANO_TOKEN_ID`.
    - Prepares data for the instruction by converting integers to bytes and concatenating them with the funder's public key.
    - Defines a list of `AccountMeta` objects representing the accounts involved in the transaction, including the nano mint account, config account, system program ID, and funder.
    - Creates an `Instruction` object with the prepared accounts, program ID, and data, and adds it to the transaction.
    - Signs the transaction with the funder and nano mint keypairs.
    - Returns the signed transaction.
- **Output**: A signed `Transaction` object ready to be sent to the blockchain.


---
### fund\_token\_account<!-- {{#callable:firedancer/contrib/tool/load_gen.fund_token_account}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L184>)

Creates and signs a transaction to fund a token account with specified lamports and initializes the mint.
- **Inputs**:
    - `funder`: The `Keypair` object representing the account that will fund the token account.
    - `lamports`: The number of lamports to transfer to the token account.
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `is_print`: A boolean flag indicating whether to print debug information (not used in the function).
    - `range`: An additional amount of lamports to add to the transfer.
- **Logic and Control Flow**:
    - Creates a `Transaction` object with the given `recent_blockhash`, the funder's public key, and sets compute unit price and limit using random values.
    - Adds an instruction to the transaction to create a new account with the specified lamports plus the `range`, using the `CreateAccountParams` with the funder's and mint's public keys.
    - Initializes mint parameters with a fixed decimal value, the mint's public key, the funder's public key as the mint authority, and the token program ID.
    - Adds an instruction to initialize the mint with the specified parameters.
    - Signs the transaction with the funder's and mint's keypairs.
    - Returns the signed transaction.
- **Output**: A signed `Transaction` object ready to be sent to the Solana network.


---
### create\_accounts\_tx<!-- {{#callable:firedancer/contrib/tool/load_gen.create_accounts_tx}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L202>)

Creates a transaction to transfer lamports and optionally set up token accounts based on the transaction type.
- **Inputs**:
    - `funder`: The account that funds the transaction and signs it.
    - `lamports`: The amount of lamports to transfer to each account.
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `txn_type`: The type of transaction to create, which determines the setup of token accounts.
    - `accs`: A list of accounts to which lamports will be transferred.
- **Logic and Control Flow**:
    - Set the compute unit limit to 200,000 by default, or 15,000 if the transaction type is `TXN_TYPE_NANO_TOKEN_TRANSFER`.
    - Create a new transaction with the given `recent_blockhash`, `funder`'s public key, and compute unit settings.
    - Iterate over each account in `accs` and add a lamport transfer instruction to the transaction.
    - If `txn_type` is `TXN_TYPE_TOKEN_TRANSFER`, add instructions to create an associated token account and mint tokens to it.
    - If `txn_type` is `TXN_TYPE_NANO_TOKEN_TRANSFER`, derive the nano token address, create the account, and mint tokens to it.
    - Sign the transaction with the `funder` account.
- **Output**: A signed `Transaction` object ready to be sent to the network.


---
### get\_balance\_sufficient<!-- {{#callable:firedancer/contrib/tool/load_gen.get_balance_sufficient}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L265>)

Checks if an account's balance is sufficient to meet a specified amount of lamports.
- **Inputs**:
    - `lamports`: The minimum required balance in lamports.
    - `rpc`: The RPC endpoint URL as a string.
    - `acc`: The account object with a method `pubkey()` to get the public key.
- **Logic and Control Flow**:
    - Calls the [`get_balance`](<#get_balance>) function with `rpc` and the public key of `acc` to get the current balance.
    - If the balance is not zero, prints the account's public key and balance.
    - Checks if the balance is greater than or equal to `lamports`.
    - If the balance is sufficient, returns the `acc` object.
    - If the balance is not sufficient, returns `None`.
- **Output**: Returns the account object `acc` if the balance is sufficient, otherwise returns `None`.
- **Functions Called**:
    - [`firedancer/contrib/tool/load_gen.get_balance`](<#get_balance>)


---
### create\_accounts<!-- {{#callable:firedancer/contrib/tool/load_gen.create_accounts}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L274>)

Creates and funds multiple accounts with specified transaction types and manages their balances.
- **Inputs**:
    - `funder`: The account that provides the initial funding for the new accounts.
    - `rpc`: The RPC endpoint URL for blockchain communication.
    - `num_accs`: The number of accounts to create.
    - `lamports`: The amount of lamports to fund each account.
    - `seed`: The seed used to derive keypairs for the accounts.
    - `sock`: The socket used for sending transactions.
    - `tpus`: A list of TPU (Transaction Processing Unit) endpoints to send transactions to.
    - `txn_type`: The type of transaction to perform, such as token transfer or nano token transfer.
- **Logic and Control Flow**:
    - Retrieves account information and balance for a specific public key.
    - Generates keypairs for the specified number of accounts using a seed and derivation path.
    - Divides the accounts into chunks for batch processing.
    - Fetches the recent blockhash from the blockchain.
    - Creates and sends transactions to fund the accounts using parallel processing.
    - Checks if additional configuration or mint accounts need funding based on the transaction type.
    - Continuously checks the balance of remaining accounts until all have sufficient funds.
    - Repeats the funding process for accounts with insufficient balance.
    - Returns the list of created accounts.
- **Output**: A list of created account keypairs.
- **Functions Called**:
    - [`firedancer/contrib/tool/load_gen.get_account_info`](<#get_account_info>)
    - [`firedancer/contrib/tool/load_gen.get_balance`](<#get_balance>)
    - [`firedancer/contrib/tool/load_gen.get_recent_blockhash`](<#get_recent_blockhash>)
    - [`firedancer/contrib/tool/load_gen.send_round_of_txs`](<#send_round_of_txs>)
    - [`firedancer/contrib/tool/load_gen.fund_config_account`](<#fund_config_account>)


---
### gen\_tx\_empty<!-- {{#callable:firedancer/contrib/tool/load_gen.gen_tx_empty}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L349>)

Generates an empty transaction with specified compute unit price and limit, signs it, and returns the transaction.
- **Inputs**:
    - `recent_blockhash`: The recent block hash to use for the transaction.
    - `key`: The keypair used to sign the transaction.
    - `acc`: The account public key associated with the transaction.
    - `cu_price`: The compute unit price to set for the transaction.
- **Logic and Control Flow**:
    - Creates a `Transaction` object with the given `recent_blockhash`, `acc`, and instructions to set compute unit price and limit.
    - Sets the compute unit price using `set_compute_unit_price(cu_price)` and the compute unit limit using `set_compute_unit_limit(300)`.
    - Signs the transaction using the provided `key`.
    - Returns the signed transaction.
- **Output**: A signed `Transaction` object.


---
### gen\_tx\_system\_transfer<!-- {{#callable:firedancer/contrib/tool/load_gen.gen_tx_system_transfer}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L354>)

Generates a Solana system transfer transaction with specified parameters.
- **Inputs**:
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `key`: The keypair used to sign the transaction.
    - `acc`: The account public key involved in the transaction.
    - `cu_price`: The compute unit price to set for the transaction.
- **Logic and Control Flow**:
    - Creates a `Transaction` object with the given `recent_blockhash`, `acc`, and compute unit settings.
    - Adds a system transfer instruction to the transaction, transferring 1 lamport from `acc` to `acc`.
    - Signs the transaction with the provided `key`.
- **Output**: Returns the signed `Transaction` object.


---
### gen\_tx\_token\_transfer<!-- {{#callable:firedancer/contrib/tool/load_gen.gen_tx_token_transfer}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L361>)

Generates a token transfer transaction on the Solana blockchain.
- **Inputs**:
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `key`: The keypair used to sign the transaction.
    - `acc`: The account from which the transaction is initiated.
    - `cu_price`: The compute unit price for the transaction.
- **Logic and Control Flow**:
    - Create a `Transaction` object with the given `recent_blockhash`, `acc`, and compute unit settings.
    - Get the associated token address for the given `key` and `fd_mint` public key.
    - Create `SplTransferParams` with the token program ID, source and destination addresses, owner public key, and amount to transfer.
    - Add a SPL token transfer instruction to the transaction using the `spl_transfer` function and the created parameters.
    - Sign the transaction with the provided `key`.
- **Output**: Returns the signed `Transaction` object.


---
### gen\_tx\_nano\_token\_transfer<!-- {{#callable:firedancer/contrib/tool/load_gen.gen_tx_nano_token_transfer}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L373>)

Generates a transaction for transferring nano tokens between two accounts.
- **Inputs**:
    - `recent_blockhash`: The recent blockhash to use for the transaction.
    - `src_key`: The keypair of the source account, used for signing the transaction.
    - `dst_key`: The keypair of the destination account.
    - `src_acc`: The public key of the source account.
    - `dst_acc`: The public key of the destination account.
    - `cu_price`: The compute unit price for the transaction.
- **Logic and Control Flow**:
    - Create a `Transaction` object with the given `recent_blockhash`, source account, and compute unit limit.
    - Derive the nano token addresses for the source and destination accounts using their public keys and a mint ID.
    - Construct the instruction data for the token transfer, specifying the transfer amount.
    - Create a list of `AccountMeta` objects representing the source and destination nano token accounts and the source account as a signer.
    - Create an `Instruction` object with the program ID, accounts, and data for the transfer.
    - Add the instruction to the transaction.
    - Sign the transaction with the source keypair.
- **Output**: Returns the signed `Transaction` object for the nano token transfer.


---
### send\_txs<!-- {{#callable:firedancer/contrib/tool/load_gen.send_txs}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L405>)

Sends transactions to specified TPU endpoints using provided keys and transaction type until a stop event is triggered.
- **Inputs**:
    - `rpc`: A string representing the RPC endpoint URL.
    - `tpus`: A list of strings representing the TPU UDP endpoints to send transactions to.
    - `keys`: A list of `Keypair` objects used to sign transactions.
    - `tx_idx`: A shared multiprocessing value to track the index of transactions.
    - `mult`: An integer multiplier used in the transaction process.
    - `idx`: An integer index for identifying the worker process.
    - `stop_event`: A multiprocessing event used to signal when to stop sending transactions.
    - `rbh`: A shared multiprocessing array representing the recent blockhash.
    - `txn_type`: An integer representing the type of transaction to send.
- **Logic and Control Flow**:
    - Creates a UDP socket for sending transactions.
    - Initializes a list of public keys from the provided `keys`.
    - Converts the `rbh` bytes to a `Hash` object for the recent blockhash.
    - Enters a loop that continues until `stop_event` is set.
    - In each loop iteration, updates the recent blockhash and adjusts the compute unit price (`cu_price`) based on whether the blockhash has changed.
    - For each key in `keys`, generates a transaction based on the `txn_type` and sends it to each TPU endpoint in `tpus`.
    - Increments the transaction index (`tx_idx`) by the number of keys after sending all transactions.
    - Prints a stopping message with the worker index when the loop exits.
- **Output**: No return value; the function sends transactions over the network and updates shared state.
- **Functions Called**:
    - [`firedancer/contrib/tool/load_gen.gen_tx_empty`](<#gen_tx_empty>)
    - [`firedancer/contrib/tool/load_gen.gen_tx_system_transfer`](<#gen_tx_system_transfer>)
    - [`firedancer/contrib/tool/load_gen.gen_tx_token_transfer`](<#gen_tx_token_transfer>)
    - [`firedancer/contrib/tool/load_gen.gen_tx_nano_token_transfer`](<#gen_tx_nano_token_transfer>)


---
### monitor\_send\_tps<!-- {{#callable:firedancer/contrib/tool/load_gen.monitor_send_tps}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L438>)

Monitors and prints the transactions per second (TPS) at regular intervals until a stop event is triggered.
- **Inputs**:
    - `tx_idx`: A `SynchronizedBase` object that holds the current transaction index, used to calculate TPS.
    - `stop_event`: An `Event` object that signals when to stop monitoring.
    - `interval`: An integer specifying the time interval in seconds between TPS calculations, default is 1.
- **Logic and Control Flow**:
    - Initialize `prev_count` to 0 and `prev_time` to the current time.
    - Enter a loop that continues while `interval` is less than 10 and `stop_event` is not set.
    - Sleep for the specified `interval` duration.
    - Acquire a lock on `tx_idx` to safely read the current transaction count into `current_count`.
    - Calculate the current time and compute TPS as the difference between `current_count` and `prev_count` divided by `interval`.
    - Update `prev_count` to `current_count` and calculate the elapsed time since `prev_time`.
    - Print the calculated TPS and elapsed time.
    - If TPS is zero, increment the `interval` by 1.
    - Update `prev_time` to the current time.
- **Output**: No return value; the function prints the TPS and elapsed time to the console.


---
### fetch\_recent\_blockhash<!-- {{#callable:firedancer/contrib/tool/load_gen.fetch_recent_blockhash}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L454>)

Continuously fetches the most recent blockhash from a Solana RPC endpoint and updates a shared memory array with it.
- **Inputs**:
    - `rbh`: A shared memory array to store the most recent blockhash as bytes.
    - `rpc`: A string representing the RPC endpoint URL to fetch the blockhash from.
    - `stop_event`: A threading event used to signal when to stop fetching the blockhash.
- **Logic and Control Flow**:
    - Initialize `prev_recent_blockhash` with the current blockhash fetched from the RPC endpoint using [`get_recent_blockhash`](<#get_recent_blockhash>) function.
    - Enter a loop that continues until `stop_event` is set.
    - In each iteration, sleep for 0.1 seconds to reduce the frequency of requests.
    - Attempt to fetch the current blockhash from the RPC endpoint.
    - If the fetched blockhash is the same as `prev_recent_blockhash`, continue to the next iteration without updating.
    - If the fetched blockhash is different, update the `rbh` array with the new blockhash and set `prev_recent_blockhash` to this new value.
    - Print the new blockhash to the console.
    - If an exception occurs during fetching, print 'bad RBH' to the console.
- **Output**: No return value; updates the `rbh` array in place.
- **Functions Called**:
    - [`firedancer/contrib/tool/load_gen.get_recent_blockhash`](<#get_recent_blockhash>)


---
### main<!-- {{#callable:firedancer/contrib/tool/load_gen.main}} -->
[View Source →](<../../../../contrib/tool/load_gen.py#L469>)

Initializes and manages the execution of a transaction processing system using multiple worker processes and threads.
- **Inputs**: None
- **Logic and Control Flow**:
    - Parse command-line arguments using `parse_args()` to get configuration parameters.
    - Create a `Client` object with the RPC endpoint specified in the arguments.
    - Open and read the seed and funder files to obtain the seed and funder keypair.
    - Create a UDP socket for communication with TPU endpoints.
    - Parse and convert TPU endpoints from strings to tuples of host and port.
    - Determine the transaction type based on the `txn_type` argument and set the corresponding constant.
    - Call `create_accounts()` to generate accounts and prepare them for transactions.
    - Divide the accounts into chunks based on the number of workers specified in the arguments.
    - Initialize shared memory objects for recent blockhash (`rbh`), stop event, and transaction index (`tx_idx`).
    - Start a monitoring thread to track transactions per second (`monitor_send_tps`).
    - Start a fetching thread to continuously update the recent blockhash (`fetch_recent_blockhash`).
    - Create and start worker processes to send transactions using the `send_txs` function.
    - Use a try-finally block to ensure that the stop event is set and all worker processes are joined when the main loop exits.
- **Output**: No return value; the function orchestrates the setup and execution of transaction processing.
- **Functions Called**:
    - [`firedancer/contrib/tool/load_gen.parse_args`](<#parse_args>)
    - [`firedancer/contrib/tool/load_gen.create_accounts`](<#create_accounts>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)