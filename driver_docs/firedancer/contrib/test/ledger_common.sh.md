<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Shell script functions for managing ledger checksums, including creation, verification, and redownload.

# Purpose
This Bash script provides functionality for managing and verifying the integrity of ledger files through checksum operations. It includes functions to create checksums for ledger files, verify these checksums, and redownload the ledger if discrepancies are found. The script uses MD5 checksums to ensure that the ledger files have not been altered or corrupted. It also provides user feedback through colored messages to indicate notices and errors. The script is intended to be executed in environments where ledger integrity is critical, and it automates the process of checking and maintaining ledger file consistency.
# Functions

---
### echo\_notice
Formats and prints a message in blue text to the console.
- **Inputs**:
    - `$1`: The message to print to the console.
- **Logic and Control Flow**:
    - Uses the `echo` command with the `-e` option to enable interpretation of backslash escapes.
    - Formats the input message `$1` with ANSI escape codes to display it in blue text.
    - Prints the formatted message to the console.
- **Output**: The function outputs the input message in blue text to the console.


---
### echo\_error
Formats and prints an error message in red text to the console.
- **Inputs**:
    - `$1`: The first part of the error message to display.
    - `$2`: The second part of the error message to display, appended to the first part.
- **Logic and Control Flow**:
    - Uses the `echo` command with the `-e` option to enable interpretation of backslash escapes.
    - Formats the input message with ANSI escape codes to change the text color to red (`\033[31m`).
    - Appends the second input to the first input and resets the text color to default (`\033[0m`).
    - Prints the formatted error message to the console.
- **Output**: The function outputs a formatted error message to the console in red text.


---
### create\_checksum
Generates a checksum file for specific files in a ledger directory.
- **Inputs**: None
- **Logic and Control Flow**:
    - Uses the `find` command to locate files in the `$DUMP/$LEDGER` directory that match specific patterns: files starting with 'snapshot', 'genesis', or containing 'rocksdb'.
    - Pipes the list of found files to `xargs` to compute their MD5 checksums using `md5sum`.
    - Sorts the output of the checksums.
    - Redirects the sorted checksums to a file named `checksum.txt` in the `$DUMP/$LEDGER` directory.
- **Output**: A file named `checksum.txt` containing sorted MD5 checksums of the specified files in the ledger directory.


---
### redownload\_ledger\_or\_fail
Attempts to redownload the ledger if the `REDOWNLOAD` flag is set, or exits with an error message if not.
- **Inputs**:
    - ``REDOWNLOAD``: A flag that indicates whether the ledger should be redownloaded (1 for true, 0 for false).
    - ``LEDGER``: The name of the ledger to be redownloaded.
    - ``DUMP``: The directory path where the ledger is stored.
- **Logic and Control Flow**:
    - Check if the `REDOWNLOAD` flag is set to 1.
    - If `REDOWNLOAD` is 1, print a notice message about redownloading the ledger.
    - Remove the existing ledger directory using `rm -rf`.
    - Call the `download_and_extract_ledger` function to download and extract the ledger.
    - Call the `create_checksum` function to generate a new checksum for the ledger.
    - If `REDOWNLOAD` is not 1, print an error message instructing the user to remove the `-nr` flag and exit with status 1.
- **Output**: The function does not return a value; it either redownloads the ledger and creates a checksum or exits with an error message.


---
### check\_ledger\_checksum
Verifies the integrity of a ledger by comparing its current checksum with a previously stored checksum.
- **Inputs**: None
- **Logic and Control Flow**:
    - Check if the original checksum file exists at the path `$DUMP/$LEDGER/checksum.txt`; if not, print an error message and exit.
    - Generate a new checksum for the ledger files by finding all files in `$DUMP/$LEDGER` matching specific patterns, compute their MD5 checksums, and store the result in `$DUMP/$LEDGER/checksum_temp.txt`.
    - Compare the newly generated checksum file with the original checksum file using `diff`.
    - If the checksums do not match, print an error message indicating a checksum mismatch and suggest using `vimdiff` to inspect differences.
    - If the checksums match, delete the temporary checksum file `$DUMP/$LEDGER/checksum_temp.txt`.
- **Output**: No explicit output is returned; the function prints error messages to the console and may exit the script if the checksum file does not exist.


---
### check\_ledger\_checksum\_and\_redownload
Checks the ledger checksum and redownloads the ledger if necessary.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if the original checksum file exists; if not, logs an error and calls `redownload_ledger_or_fail`.
    - Generates a temporary checksum file for the current ledger files.
    - Compares the original checksum file with the temporary checksum file using `diff`.
    - If there is a checksum mismatch, logs an error and calls `redownload_ledger_or_fail`.
    - If the checksums match, deletes the temporary checksum file.
- **Output**: No explicit output is returned; the function logs messages and may trigger a ledger redownload.



---
Made with ❤️ by [Driver](https://www.driver.ai/)