<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A script to measure and display transaction and compute unit statistics from an RPC endpoint.

# Purpose
This code is a script designed to monitor and report transaction and computational unit statistics from a blockchain network. It uses the `requests` library to interact with a JSON-RPC API and a metrics endpoint. The script defines several functions, including [`get_txn_cnt`](<#get_txn_cnt>) to retrieve the transaction count and slot number from the blockchain, and [`get_cus_requested`](<#get_cus_requested>) to obtain computational unit statistics from a metrics endpoint. The [`parse_args`](<#parse_args>) function uses the `argparse` library to handle command-line arguments, allowing users to specify the RPC URL, metrics URL, polling interval, and various display options.

The main functionality is encapsulated in the [`tps`](<#tps>) function, which continuously polls the specified endpoints at user-defined intervals. It calculates the difference in transaction counts and computational units over the polling period to determine transactions per second (TPS) and computational units per second. The script can display various metrics such as elapsed time, transaction count, TPS, computational units per second, and slot number based on the user's command-line options. The [`main`](<#main>) function orchestrates the argument parsing and initiates the monitoring process. This script is intended to be executed directly and does not define a public API for external use.
# Imports and Dependencies

---
- `requests`
- `argparse`
- `time`


# Functions

---
### get\_txn\_cnt<!-- {{#callable:firedancer/contrib/test/tps.get_txn_cnt}} -->
[View Source →](<../../../../contrib/test/tps.py#L5>)

Fetches the transaction count and current slot from a specified RPC endpoint.
- **Inputs**:
    - `rpc`: A string representing the RPC endpoint URL to which the function sends requests.
- **Logic and Control Flow**:
    - Creates a JSON-RPC request payload to get the transaction count with a commitment level of 'processed'.
    - Sends a POST request to the specified RPC endpoint with the transaction count request payload.
    - Parses the JSON response to extract the transaction count from the 'result' field.
    - Creates a JSON-RPC request payload to get the current slot with a commitment level of 'processed'.
    - Sends a POST request to the specified RPC endpoint with the slot request payload.
    - Parses the JSON response to extract the current slot from the 'result' field.
    - Returns a tuple containing the transaction count and the current slot.
- **Output**: A tuple containing the transaction count and the current slot, both extracted from the JSON responses of the RPC requests.


---
### get\_cus\_requested<!-- {{#callable:firedancer/contrib/test/tps.get_cus_requested}} -->
[View Source →](<../../../../contrib/test/tps.py#L15>)

Fetches a metric from a URL and extracts a specific value from the response text.
- **Inputs**:
    - `metrics`: A URL string from which to fetch the metrics data.
- **Logic and Control Flow**:
    - Send a GET request to the URL specified by the `metrics` parameter.
    - Split the response text into individual lines.
    - Iterate over each line in the response text.
    - Check if a line starts with the string `pack_cus_net_sum`.
    - If a line starts with `pack_cus_net_sum`, split the line by spaces and return the second element as an integer.
- **Output**: An integer value extracted from the line that starts with `pack_cus_net_sum` in the response text.


---
### parse\_args<!-- {{#callable:firedancer/contrib/test/tps.parse_args}} -->
[View Source →](<../../../../contrib/test/tps.py#L22>)

Parses command-line arguments for the application.
- **Inputs**: None
- **Logic and Control Flow**:
    - Creates an `ArgumentParser` object to handle command-line arguments.
    - Adds a required string argument `-r` or `--rpc` for the RPC endpoint.
    - Adds a required string argument `-m` or `--metrics` for the metrics endpoint.
    - Adds a required integer argument `-t` or `--time` for the polling time interval.
    - Adds optional boolean flags `-e` or `--show-elapsed`, `-x` or `--show-txns`, `-p` or `--show-tps`, `-u` or `--show-cus`, and `-s` or `--show-slot` to control output display.
    - Parses the command-line arguments and stores them in the `args` variable.
    - Returns the parsed arguments as an `argparse.Namespace` object.
- **Output**: An `argparse.Namespace` object containing the parsed command-line arguments.


---
### tps<!-- {{#callable:firedancer/contrib/test/tps.tps}} -->
[View Source →](<../../../../contrib/test/tps.py#L70>)

Continuously calculates and optionally displays transaction statistics such as transactions per second (TPS) and cumulative units per second (CUS) from a given RPC and metrics endpoint.
- **Inputs**:
    - `rpc`: A string representing the RPC endpoint URL to fetch transaction count and slot information.
    - `metrics`: A string representing the metrics endpoint URL to fetch cumulative units requested.
    - `poll`: An integer representing the polling interval in seconds between data fetches.
    - `show_elapsed`: A boolean flag indicating whether to display the elapsed time.
    - `show_txns`: A boolean flag indicating whether to display the transaction count difference.
    - `show_tps`: A boolean flag indicating whether to display the transactions per second.
    - `show_cus`: A boolean flag indicating whether to display the cumulative units per second.
    - `show_slot`: A boolean flag indicating whether to display the current slot number.
- **Logic and Control Flow**:
    - Enters an infinite loop to continuously fetch and calculate transaction statistics.
    - Calls [`get_txn_cnt`](<#get_txn_cnt>) with `rpc` to get the initial transaction count and slot number.
    - Calls [`get_cus_requested`](<#get_cus_requested>) with `metrics` to get the initial cumulative units requested.
    - Records the current time as `before_time`.
    - Pauses execution for `poll` seconds using `time.sleep`.
    - Records the current time as `after_time`.
    - Calls [`get_txn_cnt`](<#get_txn_cnt>) again to get the updated transaction count and slot number.
    - Calls [`get_cus_requested`](<#get_cus_requested>) again to get the updated cumulative units requested.
    - Calculates the difference in transaction count and cumulative units requested.
    - Calculates the time difference between `after_time` and `before_time`.
    - Calculates transactions per second (TPS) and cumulative units per second (CUS) based on the differences and time interval.
    - Prints the calculated statistics based on the boolean flags provided (`show_slot`, `show_elapsed`, `show_txns`, `show_tps`, `show_cus`).
- **Output**: Continuously prints transaction statistics to the console based on the specified display flags.
- **Functions Called**:
    - [`firedancer/contrib/test/tps.get_txn_cnt`](<#get_txn_cnt>)
    - [`firedancer/contrib/test/tps.get_cus_requested`](<#get_cus_requested>)


---
### main<!-- {{#callable:firedancer/contrib/test/tps.main}} -->
[View Source →](<../../../../contrib/test/tps.py#L97>)

Parses command-line arguments and calls the [`tps`](<#tps>) function with these arguments.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the [`parse_args`](<#parse_args>) function to obtain command-line arguments.
    - Passes the parsed arguments to the [`tps`](<#tps>) function.
- **Output**: No output is returned; the function executes the [`tps`](<#tps>) function with the parsed arguments.
- **Functions Called**:
    - [`firedancer/contrib/test/tps.parse_args`](<#parse_args>)
    - [`firedancer/contrib/test/tps.tps`](<#tps>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)