<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A Bash script to set up, configure, and run a Firedancer simulation with specific parameters and cleanup.

# Purpose
This Bash script is an executable file designed to set up and run a simulation environment for a service called `firedancer-dev`. It performs several tasks, including cleaning up previous data, checking available disk space, and configuring the environment using a TOML configuration file. The script manages key generation for identity and vote accounts, downloads necessary resources from a Google Cloud Storage bucket, and sets up the simulation parameters. It also includes a cleanup function that is triggered upon script exit or interruption to ensure proper termination of the `firedancer-dev` process. The script logs its operations to a temporary file and checks for the successful completion of the simulation, adjusting the exit status accordingly.
# Global Variables

---
### DUMP\_DIR
- **Type**: `string`
- **Description**: The `DUMP_DIR` variable is a global variable that specifies the directory path where dump files are stored. It defaults to './dump' if not set by the user.
- **Use**: Stores the directory path for dump files, allowing the script to manage and access dump-related data.


---
### LOG
- **Type**: `string`
- **Description**: A string variable that stores the path to a temporary log file. The path includes the process ID (`$$`) to ensure uniqueness for each script execution.
- **Use**: Used to specify the location of the log file for storing output and status messages during script execution.


---
### DATA\_DIR
- **Type**: `string`
- **Description**: The `DATA_DIR` variable is a global variable that specifies the directory path where service-related data is stored. It defaults to the path `/data/svc_firedancer` if not set externally.
- **Use**: Used to define the location for storing and managing service data files and configurations.


---
### TOML
- **Type**: `string`
- **Description**: Contains the file path to the TOML configuration file used by the `firedancer-dev` application. This file is located in the `DATA_DIR` directory and is named `fd_shredcap.toml`. The script writes configuration settings to this file, which are then used to configure the `firedancer-dev` application.
- **Use**: Stores the path to the TOML configuration file for use in configuring the `firedancer-dev` application.


---
### SCRIPT\_DIR
- **Type**: `string`
- **Description**: Contains the absolute path to the directory where the script is located. It is determined by changing to the directory of the script and then using the `pwd` command to get the current directory path.
- **Use**: Used to define the base directory for other paths, such as `FD_DIR`, which is relative to the script's location.


---
### FD\_DIR
- **Type**: `string`
- **Description**: Represents the directory path two levels up from the current script's directory. It is calculated by navigating to the parent directory of the script's directory and then moving up one more level.
- **Use**: Used to construct paths for executing commands and accessing resources relative to the script's location.


---
### OBJDIR
- **Type**: `string`
- **Description**: Defines the directory path for the object files used in the build process. The default value is set to 'build/native/${CC}', where '${CC}' is a placeholder for the compiler being used.
- **Use**: Used to specify the directory where the compiled binaries for 'firedancer-dev' are located.


---
### AGAVE\_PATH
- **Type**: `string`
- **Description**: Defines the path to the Agave executable directory. It defaults to './agave/target/release' if not set by the user.
- **Use**: Used to specify the directory path where the Agave executable files are located for generating key pairs.


---
### DUMP
- **Type**: `string`
- **Description**: `DUMP` is a global variable that stores the absolute path to the directory where dump files are stored. It is initialized using the `realpath` command to resolve the path of the `DUMP_DIR` variable.
- **Use**: Stores the resolved path of the dump directory for use in file operations.


---
### LEDGER
- **Type**: `string`
- **Description**: Contains the name of a specific testnet ledger, 'testnet-317018409-shred-cap'. This string is used to identify and manage the ledger data within the script.
- **Use**: Used to check for the existence of the ledger in the dump directory and to download it if it is not present.


---
### SNAPSHOT
- **Type**: ``string``
- **Description**: Represents the path to the first snapshot file found in the `DUMP/$LEDGER` directory. The snapshot file is expected to have a `.tar.zst` extension and is used in the configuration of the `firedancer-dev` application.
- **Use**: Used to set the `snapshot` parameter in the `[tiles.replay]` section of the TOML configuration file.


---
### INCREMENTAL
- **Type**: `string`
- **Description**: `INCREMENTAL` is a string variable that stores the path to the first file in the `incremental*` series located in the `DUMP/$LEDGER` directory. It is determined by listing the files in the directory and selecting the first match.
- **Use**: Used to specify the path to the incremental file in the configuration for the `firedancer-dev` application.


---
### SHREDCAP
- **Type**: ``string``
- **Description**: The `SHREDCAP` variable stores the path to the first file in the `DUMP/$LEDGER` directory that matches the pattern `*shredcap`. This path is used in the configuration file to set the `shred_cap_replay` parameter.
- **Use**: Used to specify the path for the `shred_cap_replay` parameter in the configuration file.


---
### status
- **Type**: ``integer``
- **Description**: The `status` variable is an integer that stores the exit status of the `firedancer-dev` command. It is used to determine the success or failure of the command execution.
- **Use**: Used to store and check the exit status of the `firedancer-dev` command to decide the script's exit behavior.


---
### simulation\_finished
- **Type**: ``string``
- **Description**: Contains the result of a `grep` command that searches for the phrase 'Finished simulation' in the log file specified by the `LOG` variable. This variable is used to determine if the simulation process has completed successfully.
- **Use**: Used to check if the simulation process has finished by searching for a specific log entry.


# Functions

---
### cleanup
Terminates the `firedancer-dev` process and performs cleanup operations.
- **Inputs**: None
- **Logic and Control Flow**:
    - Attempts to terminate all running `firedancer-dev` processes using `sudo killall firedancer-dev` and ignores any errors.
    - Executes the `firedancer-dev configure fini all` command with the configuration file specified by the resolved path of `TOML`, ignoring any errors.
    - Exits the script with the status stored in the `status` variable.
- **Output**: The function does not return a value; it exits the script with the status stored in the `status` variable.



---
Made with ❤️ by [Driver](https://www.driver.ai/)