<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Generates C test code from Wycheproof and CCTV test vectors for EDDSA and XDH algorithms.

# Purpose
The code is a Python script designed to download and process cryptographic test vectors from external sources, specifically for the EDDSA and XDH algorithms. It retrieves test data from the Wycheproof project and the C2SP CCTV project, then generates C code to verify these cryptographic algorithms. The script defines two data classes, `EddsaVerify` and `XDHVerify`, to structure the test data for EDDSA and XDH, respectively. It includes functions [`_gen_ed25519`](<#_gen_ed25519>), [`_gen_x25519`](<#_gen_x25519>), and [`_gen_cctv_ed25519`](<#_gen_cctv_ed25519>) to handle the downloading, parsing, and conversion of test vectors into C structures. These functions output C code that includes the test vectors, which are then written to specific C source files.

The script is intended to be executed as a standalone program, as indicated by the `if __name__ == "__main__":` block. It changes the working directory to the root of the project and calls the [`main`](<#main>) function, which orchestrates the generation of the C test files. The generated C files are intended to be used for testing the cryptographic implementations in the project, ensuring they conform to the test vectors provided by the external sources. The script does not define public APIs or external interfaces, as its primary function is to automate the generation of test code for internal use.
# Imports and Dependencies

---
- `contextlib.redirect_stdout`
- `dataclasses.dataclass`
- `datetime`
- `requests`
- `os`
- `pathlib.Path`
- `sys`


# Classes

---
### EddsaVerify<!-- {{#class:firedancer/contrib/codegen/gen_wycheproofs.EddsaVerify}} -->
[View Source →](<../../../../contrib/codegen/gen_wycheproofs.py#L16>)

- **Decorators**: `@dataclass`
- **Members**:
    - `tcId`: An integer that identifies the test case.
    - `comment`: A string that contains a comment about the test case.
    - `msg`: A byte sequence that represents the message to verify.
    - `sig`: A byte sequence that represents the signature to verify.
    - `pub`: A byte sequence that represents the public key used for verification.
    - `ok`: A boolean that indicates if the verification is successful.
- **Description**: Represents a test case for verifying EdDSA signatures, containing details such as the test case ID, message, signature, public key, and the expected result of the verification.


---
### XDHVerify<!-- {{#class:firedancer/contrib/codegen/gen_wycheproofs.XDHVerify}} -->
[View Source →](<../../../../contrib/codegen/gen_wycheproofs.py#L98>)

- **Decorators**: `@dataclass`
- **Members**:
    - `tcId`: An integer that identifies the test case.
    - `comment`: A string that contains comments about the test case.
    - `shared`: A byte sequence representing the shared secret.
    - `prv`: A byte sequence representing the private key.
    - `pub`: A byte sequence representing the public key.
    - `ok`: A boolean indicating if the test case is valid.
- **Description**: Represents a test case for verifying XDH (Elliptic Curve Diffie-Hellman) operations, including details such as test case ID, comments, shared secret, private key, public key, and validity status.


# Functions

---
### \_gen\_ed25519<!-- {{#callable:firedancer/contrib/codegen/gen_wycheproofs._gen_ed25519}} -->
[View Source →](<../../../../contrib/codegen/gen_wycheproofs.py#L26>)

Generates C test code for EDDSA verification using Wycheproof test vectors.
- **Inputs**: None
- **Logic and Control Flow**:
    - Send a GET request to the Wycheproof test vectors URL for EDDSA.
    - Assert that the HTTP response status code is 200.
    - Parse the JSON response from the request.
    - Assert that the algorithm is 'EDDSA' and the schema is 'eddsa_verify_schema.json'.
    - Initialize an empty list `verify_tests` to store test cases.
    - Iterate over each test group in the JSON data.
    - Skip test groups that are not of type 'EddsaVerify'.
    - Convert the public key from hexadecimal to bytes.
    - Iterate over each test in the group and append an [`EddsaVerify`](<#eddsaverify>) object to `verify_tests`.
    - Print a header comment indicating the code is auto-generated.
    - Print the current UTC timestamp in ISO format.
    - Print the C structure definition for `fd_ed25519_verify_wycheproof`.
    - Iterate over each test in `verify_tests`.
    - Skip tests where the signature length is not 64 bytes.
    - Print each test case in the C array format.
    - Print a terminating zero entry and close the C array.
- **Output**: C code for EDDSA verification test cases is printed to the standard output.
- **Functions Called**:
    - [`firedancer/contrib/codegen/gen_wycheproofs.EddsaVerify`](<#eddsaverify>)


---
### \_gen\_x25519<!-- {{#callable:firedancer/contrib/codegen/gen_wycheproofs._gen_x25519}} -->
[View Source →](<../../../../contrib/codegen/gen_wycheproofs.py#L107>)

Generates C test code for X25519 verification using Wycheproof test vectors.
- **Inputs**: None
- **Logic and Control Flow**:
    - Send a GET request to the specified URL to download the X25519 test vectors in JSON format.
    - Assert that the HTTP response status code is 200 to ensure the request was successful.
    - Parse the JSON response and assert that the algorithm and schema match expected values ('XDH' and 'xdh_comp_schema.json').
    - Initialize an empty list `verify_tests` to store test cases.
    - Iterate over each test group in the JSON data, skipping groups that are not of type 'XdhComp'.
    - For each test in the valid groups, create an [`XDHVerify`](<#xdhverify>) object with the test case details and append it to `verify_tests`.
    - Print a header comment indicating the code is auto-generated and include the current UTC timestamp.
    - Print the C structure definition for `fd_x25519_verify_wycheproof` and its typedef.
    - Iterate over the `verify_tests` list and print each test case in the C array format, converting byte data to hexadecimal string format.
    - Print a closing brace and semicolon to complete the C array definition.
- **Output**: C code for X25519 verification tests, formatted as a static array of `fd_x25519_verify_wycheproof_t` structures.
- **Functions Called**:
    - [`firedancer/contrib/codegen/gen_wycheproofs.XDHVerify`](<#xdhverify>)


---
### \_gen\_cctv\_ed25519<!-- {{#callable:firedancer/contrib/codegen/gen_wycheproofs._gen_cctv_ed25519}} -->
[View Source →](<../../../../contrib/codegen/gen_wycheproofs.py#L172>)

Generates C test code for ED25519 verification using CCTV test vectors.
- **Inputs**: None
- **Logic and Control Flow**:
    - Send a GET request to retrieve the ED25519 test vectors from a specified URL.
    - Assert that the HTTP response status code is 200 to ensure successful retrieval.
    - Parse the JSON response to obtain the test vectors.
    - Iterate over each test vector in the JSON file.
    - For each test, check the 'flags' field to determine the validity of the test case.
    - Raise an exception if the 'non_canonical_R' flag is present without the 'low_order_R' flag.
    - Append each test case to the 'verify_tests' list as an 'EddsaVerify' object with the appropriate attributes.
    - Print the generated C code header and structure definition for the test cases.
    - Iterate over the 'verify_tests' list to print each test case in the C structure format.
    - Ensure that only signatures of length 64 are included in the output.
    - Print a terminating zero entry in the C array to mark the end of the test cases.
- **Output**: C code for ED25519 verification test cases using the CCTV test vectors.
- **Functions Called**:
    - [`firedancer/contrib/codegen/gen_wycheproofs.EddsaVerify`](<#eddsaverify>)


---
### main<!-- {{#callable:firedancer/contrib/codegen/gen_wycheproofs.main}} -->
[View Source →](<../../../../contrib/codegen/gen_wycheproofs.py#L244>)

Generates C test code for ED25519 and X25519 using Wycheproof and CCTV test vectors.
- **Inputs**: None
- **Logic and Control Flow**:
    - Opens a file named `test_ed25519_wycheproof.c` in write mode and redirects the standard output to this file.
    - Calls the [`_gen_ed25519`](<#_gen_ed25519>) function to generate ED25519 test code and writes it to the file.
    - Opens a file named `test_x25519_wycheproof.c` in write mode and redirects the standard output to this file.
    - Calls the [`_gen_x25519`](<#_gen_x25519>) function to generate X25519 test code and writes it to the file.
    - Opens a file named `test_ed25519_cctv.c` in write mode and redirects the standard output to this file.
    - Calls the [`_gen_cctv_ed25519`](<#_gen_cctv_ed25519>) function to generate ED25519 test code using CCTV vectors and writes it to the file.
- **Output**: No return value; writes generated C test code to specified files.
- **Functions Called**:
    - [`firedancer/contrib/codegen/gen_wycheproofs._gen_ed25519`](<#_gen_ed25519>)
    - [`firedancer/contrib/codegen/gen_wycheproofs._gen_x25519`](<#_gen_x25519>)
    - [`firedancer/contrib/codegen/gen_wycheproofs._gen_cctv_ed25519`](<#_gen_cctv_ed25519>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)