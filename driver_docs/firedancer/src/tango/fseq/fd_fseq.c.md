<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines and manages a shared memory region for sequence numbers with functions for alignment and lifecycle operations.

# Purpose
The code defines a shared memory structure and associated functions for managing a sequence number in a shared memory region. The primary component is the `fd_fseq_shmem` structure, which includes fields for a magic number (`magic`), an initial sequence number (`seq0`), and the current sequence number (`seq`). The magic number is used to verify the integrity of the shared memory region. The code provides functions to align the shared memory ([`fd_fseq_align`](<#fd_fseq_align>)), calculate its footprint ([`fd_fseq_footprint`](<#fd_fseq_footprint>)), and manage the lifecycle of the sequence number in shared memory, including creation ([`fd_fseq_new`](<#fd_fseq_new>)), joining ([`fd_fseq_join`](<#fd_fseq_join>)), leaving ([`fd_fseq_leave`](<#fd_fseq_leave>)), and deletion ([`fd_fseq_delete`](<#fd_fseq_delete>)).

The functions ensure that the shared memory is correctly aligned and initialized, and they perform checks to validate the integrity of the memory region using the magic number. The [`fd_fseq_new`](<#fd_fseq_new>) function initializes the shared memory with a given initial sequence number, while [`fd_fseq_join`](<#fd_fseq_join>) returns a pointer to the current sequence number. The [`fd_fseq_leave`](<#fd_fseq_leave>) and [`fd_fseq_delete`](<#fd_fseq_delete>) functions handle the cleanup and removal of the sequence number from the shared memory. This code is intended to be part of a larger system where sequence numbers need to be shared and managed across different processes or threads using shared memory.
# Imports and Dependencies

---
- `fd_fseq.h`


# Data Structures

---
### fd\_fseq\_shmem
- **Type**: ``struct``
- **Members**:
    - `magic`: Stores a magic number to verify the integrity of the structure.
    - `seq0`: Holds the initial sequence number.
    - `seq`: Contains the current sequence number.
- **Description**: Defines a shared memory layout for a sequence number tracking system, ensuring alignment and integrity through a magic number, with fields for initial and current sequence numbers, and additional padding for alignment and application-specific data.


---
### fd\_fseq\_shmem\_t
- **Type**: ``struct``
- **Members**:
    - `magic`: A magic number used to verify the integrity of the shared memory region.
    - `seq0`: The initial sequence number for the shared memory region.
    - `seq`: The current sequence number for the shared memory region.
- **Description**: Specifies the layout of a shared memory region that contains a sequence number (`fseq`). It includes a magic number for validation, an initial sequence number, and a current sequence number. The structure is aligned according to `FD_FSEQ_ALIGN` and includes padding for application-specific regions and alignment.


# Functions

---
### fd\_fseq\_align<!-- {{#callable:fd_fseq_align}} -->
[View Source →](<../../../../../src/tango/fseq/fd_fseq.c#L19>)

Returns the alignment requirement for the `fd_fseq_shmem` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Return the value of `FD_FSEQ_ALIGN`.
- **Output**: The function returns an `ulong` value representing the alignment requirement for the `fd_fseq_shmem` structure.


---
### fd\_fseq\_footprint<!-- {{#callable:fd_fseq_footprint}} -->
[View Source →](<../../../../../src/tango/fseq/fd_fseq.c#L24>)

Returns the constant `FD_FSEQ_FOOTPRINT`, which represents the footprint size of the `fd_fseq_shmem` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Return the value of `FD_FSEQ_FOOTPRINT`.
- **Output**: The function returns an `ulong` value representing the footprint size of the `fd_fseq_shmem` structure.


---
### fd\_fseq\_new<!-- {{#callable:fd_fseq_new}} -->
[View Source →](<../../../../../src/tango/fseq/fd_fseq.c#L29>)

Initializes a shared memory region for a sequence with a given starting sequence number.
- **Inputs**:
    - ``shmem``: A pointer to the shared memory region to initialize.
    - ``seq0``: The initial sequence number to set in the shared memory region.
- **Logic and Control Flow**:
    - Check if `shmem` is NULL; if true, log a warning and return NULL.
    - Check if `shmem` is aligned according to [`fd_fseq_align`](<#fd_fseq_align>); if not, log a warning and return NULL.
    - Cast `shmem` to a `fd_fseq_shmem_t` pointer.
    - Clear the memory region pointed to by `fseq` using `memset` with `FD_FSEQ_FOOTPRINT`.
    - Set `fseq->seq0` and `fseq->seq` to `seq0`.
    - Use `FD_COMPILER_MFENCE` to ensure memory ordering before and after setting `fseq->magic` to `FD_FSEQ_MAGIC`.
    - Return the `shmem` pointer.
- **Output**: Returns the initialized shared memory pointer or NULL if initialization fails.
- **Functions Called**:
    - [`fd_fseq_align`](<#fd_fseq_align>)


---
### fd\_fseq\_join<!-- {{#callable:fd_fseq_join}} -->
[View Source →](<../../../../../src/tango/fseq/fd_fseq.c#L57>)

Validates and returns a pointer to the current sequence number in a shared memory region if the input is valid.
- **Inputs**:
    - `shfseq`: A pointer to a shared memory region that is expected to contain a valid `fd_fseq_shmem_t` structure.
- **Logic and Control Flow**:
    - Check if `shfseq` is NULL; if true, log a warning and return NULL.
    - Check if `shfseq` is aligned according to [`fd_fseq_align`](<#fd_fseq_align>); if not, log a warning and return NULL.
    - Cast `shfseq` to `fd_fseq_shmem_t *` and store it in `fseq`.
    - Check if `fseq->magic` equals `FD_FSEQ_MAGIC`; if not, log a warning and return NULL.
    - Return a pointer to `fseq->seq`.
- **Output**: A pointer to the `seq` field of the `fd_fseq_shmem_t` structure if all checks pass, otherwise NULL.
- **Functions Called**:
    - [`fd_fseq_align`](<#fd_fseq_align>)


---
### fd\_fseq\_leave<!-- {{#callable:fd_fseq_leave}} -->
[View Source →](<../../../../../src/tango/fseq/fd_fseq.c#L80>)

Converts a pointer to a sequence number back to a pointer to the shared memory region.
- **Inputs**:
    - `fseq`: A pointer to a constant unsigned long integer representing the sequence number.
- **Logic and Control Flow**:
    - Check if `fseq` is NULL or invalid using `FD_UNLIKELY`; if true, log a warning and return NULL.
    - Subtract 2 from the `fseq` pointer to obtain the original shared memory pointer.
    - Return the adjusted pointer cast to a `void *`.
- **Output**: A `void *` pointer to the shared memory region, or NULL if the input is invalid.


---
### fd\_fseq\_delete<!-- {{#callable:fd_fseq_delete}} -->
[View Source →](<../../../../../src/tango/fseq/fd_fseq.c#L91>)

Removes a shared memory sequence by validating and resetting its magic number.
- **Inputs**:
    - `shfseq`: A pointer to the shared memory sequence to delete.
- **Logic and Control Flow**:
    - Check if `shfseq` is NULL; if true, log a warning and return NULL.
    - Check if `shfseq` is aligned according to [`fd_fseq_align`](<#fd_fseq_align>); if not, log a warning and return NULL.
    - Cast `shfseq` to a `fd_fseq_shmem_t` pointer named `fseq`.
    - Check if `fseq->magic` equals `FD_FSEQ_MAGIC`; if not, log a warning and return NULL.
    - Use memory fences to ensure memory operations are completed before and after setting `fseq->magic` to 0.
    - Return the `fseq` pointer.
- **Output**: A pointer to the `fd_fseq_shmem_t` structure if successful, or NULL if any validation fails.
- **Functions Called**:
    - [`fd_fseq_align`](<#fd_fseq_align>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)