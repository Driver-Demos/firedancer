<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for managing memory cache alignment, footprint calculation, creation, joining, leaving, and deletion.

# Purpose
The code defines a set of functions for managing a memory cache (`mcache`) in a shared memory environment. It provides functionality to create, join, leave, and delete a memory cache, as well as to query its properties such as depth, application size, and initial sequence number. The [`fd_mcache_new`](<#fd_mcache_new>) function initializes a new memory cache in a given shared memory region, setting up metadata and aligning memory as necessary. The [`fd_mcache_join`](<#fd_mcache_join>) and [`fd_mcache_leave`](<#fd_mcache_leave>) functions allow processes to attach to and detach from an existing memory cache, respectively. The [`fd_mcache_delete`](<#fd_mcache_delete>) function marks a memory cache for deletion by resetting its magic number, which is used to verify the integrity of the cache.

The code also includes utility functions to calculate the alignment and footprint of the memory cache, ensuring that the memory is correctly allocated and aligned. The [`fd_mcache_align`](<#fd_mcache_align>) function returns the required alignment for the memory cache, while [`fd_mcache_footprint`](<#fd_mcache_footprint>) calculates the total memory size needed based on the cache depth and application-specific size. The code uses several macros and helper functions, such as `FD_UNLIKELY` for branch prediction optimization and `fd_ulong_align_up` for memory alignment. The functions [`fd_mcache_depth`](<#fd_mcache_depth>), [`fd_mcache_app_sz`](<#fd_mcache_app_sz>), and [`fd_mcache_seq0`](<#fd_mcache_seq0>) provide access to the cache's metadata, while [`fd_mcache_seq_laddr_const`](<#fd_mcache_seq_laddr_const>), [`fd_mcache_seq_laddr`](<#fd_mcache_seq_laddr>), [`fd_mcache_app_laddr_const`](<#fd_mcache_app_laddr_const>), and [`fd_mcache_app_laddr`](<#fd_mcache_app_laddr>) provide access to the sequence numbers and application-specific data stored in the cache.
# Imports and Dependencies

---
- `fd_mcache_private.h`


# Functions

---
### fd\_mcache\_align<!-- {{#callable:fd_mcache_align}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L3>)

Returns the alignment requirement for the memory cache.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_MCACHE_ALIGN`.
- **Output**: The alignment requirement for the memory cache as defined by `FD_MCACHE_ALIGN`.


---
### fd\_mcache\_footprint<!-- {{#callable:fd_mcache_footprint}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L8>)

Calculates the memory footprint required for a metadata cache with specified depth and application size.
- **Inputs**:
    - `depth`: The number of metadata entries in the cache, which must be a power of two and within specific size limits.
    - `app_sz`: The size of the application-specific data to be stored in the cache, which must be aligned to a specific boundary.
- **Logic and Control Flow**:
    - Check if `depth` is less than `FD_MCACHE_BLOCK`; if true, return 0.
    - Check if `depth` is greater than `ULONG_MAX` divided by the size of `fd_frag_meta_t`; if true, return 0.
    - Check if `depth` is not a power of two; if true, return 0.
    - Calculate `meta_footprint` as `depth` multiplied by the size of `fd_frag_meta_t`.
    - Align `meta_footprint` to `FD_MCACHE_ALIGN` and check for overflow; if overflow occurs, return 0.
    - Align `app_sz` to `FD_MCACHE_ALIGN` to get `app_footprint` and check for overflow; if overflow occurs, return 0.
    - Calculate total `footprint` as the sum of `meta_footprint` and `app_footprint` and check for overflow; if overflow occurs, return 0.
    - Add the size of `fd_mcache_private_hdr_t` to `footprint` and check for overflow; if overflow occurs, return 0.
    - Return the calculated `footprint`.
- **Output**: Returns the total memory footprint in bytes required for the metadata cache, or 0 if any input constraints are violated.


---
### fd\_mcache\_new<!-- {{#callable:fd_mcache_new}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L31>)

Initializes a memory cache in shared memory with specified depth, application size, and starting sequence number.
- **Inputs**:
    - `shmem`: Pointer to the shared memory where the cache will be initialized.
    - `depth`: The depth of the cache, which must be a power of two and within valid range.
    - `app_sz`: The size of the application-specific data area in the cache.
    - `seq0`: The initial sequence number for the cache.
- **Logic and Control Flow**:
    - Check if `shmem` is NULL and log a warning if true, then return NULL.
    - Check if `shmem` is aligned according to `fd_mcache_align()` and log a warning if not, then return NULL.
    - Calculate the footprint of the cache using `fd_mcache_footprint()` and log a warning if the footprint is zero, then return NULL.
    - Clear the memory at `shmem` with the calculated footprint size using `fd_memset()`.
    - Initialize the cache header with `depth`, `app_sz`, `seq0`, and calculate `app_off`.
    - Set the initial sequence number in the header's sequence array.
    - Calculate the end sequence number `seq1` and iterate from `seq0` to `seq1`, initializing each cache line's sequence and control fields.
    - Use memory fences to ensure memory operations are completed before setting the magic number.
    - Set the magic number in the header to `FD_MCACHE_MAGIC` to mark the cache as initialized.
    - Return the `shmem` pointer.
- **Output**: Returns a pointer to the initialized shared memory cache, or NULL if initialization fails.
- **Functions Called**:
    - [`fd_mcache_align`](<#fd_mcache_align>)
    - [`fd_mcache_footprint`](<#fd_mcache_footprint>)


---
### fd\_mcache\_join<!-- {{#callable:fd_mcache_join}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L80>)

Validates and joins a shared memory cache to return a pointer to the fragment metadata.
- **Inputs**:
    - `shmcache`: A pointer to the shared memory cache to join.
- **Logic and Control Flow**:
    - Check if `shmcache` is NULL; if true, log a warning and return NULL.
    - Check if `shmcache` is aligned according to [`fd_mcache_align`](<#fd_mcache_align>); if not, log a warning and return NULL.
    - Cast `shmcache` to a `fd_mcache_private_hdr_t` pointer and check if the `magic` field matches `FD_MCACHE_MAGIC`; if not, log a warning and return NULL.
    - Return the result of `fd_mcache_private_mcache` using the header.
- **Output**: A pointer to `fd_frag_meta_t` if successful, or NULL if any validation fails.
- **Functions Called**:
    - [`fd_mcache_align`](<#fd_mcache_align>)


---
### fd\_mcache\_leave<!-- {{#callable:fd_mcache_leave}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L102>)

Returns a pointer to the private header of a memory cache, or NULL if the input is invalid.
- **Inputs**:
    - `mcache`: A constant pointer to `fd_frag_meta_t`, representing the memory cache to leave.
- **Logic and Control Flow**:
    - Check if `mcache` is NULL using `FD_UNLIKELY`; if true, log a warning and return NULL.
    - Return a pointer to the private header of the memory cache by casting the result of `fd_mcache_private_hdr_const(mcache)` to `void *`.
- **Output**: A pointer to the private header of the memory cache, or NULL if `mcache` is NULL.
- **Functions Called**:
    - [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>)


---
### fd\_mcache\_delete<!-- {{#callable:fd_mcache_delete}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L113>)

Deletes a shared memory cache by validating and resetting its magic number.
- **Inputs**:
    - `shmcache`: A pointer to the shared memory cache to delete.
- **Logic and Control Flow**:
    - Check if `shmcache` is NULL; if true, log a warning and return NULL.
    - Check if `shmcache` is aligned according to [`fd_mcache_align`](<#fd_mcache_align>); if not, log a warning and return NULL.
    - Cast `shmcache` to `fd_mcache_private_hdr_t` and check if its `magic` field matches `FD_MCACHE_MAGIC`; if not, log a warning and return NULL.
    - Use memory fences to ensure memory operations are completed before and after setting the `magic` field to 0.
    - Return the `shmcache` pointer.
- **Output**: Returns the `shmcache` pointer if successful, or NULL if any validation fails.
- **Functions Called**:
    - [`fd_mcache_align`](<#fd_mcache_align>)


---
### fd\_mcache\_depth<!-- {{#callable:fd_mcache_depth}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L139>)

Retrieves the depth of the memory cache from the given fragment metadata.
- **Inputs**:
    - `mcache`: A pointer to a constant `fd_frag_meta_t` structure representing the fragment metadata.
- **Logic and Control Flow**:
    - Call the function [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>) with `mcache` as the argument to obtain a constant pointer to the private header.
    - Access the `depth` field of the returned private header structure.
- **Output**: Returns the `depth` field from the private header associated with the given fragment metadata as an unsigned long integer.
- **Functions Called**:
    - [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>)


---
### fd\_mcache\_app\_sz<!-- {{#callable:fd_mcache_app_sz}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L144>)

Retrieves the application size from the metadata cache header.
- **Inputs**:
    - `mcache`: A pointer to a constant `fd_frag_meta_t` structure representing the metadata cache.
- **Logic and Control Flow**:
    - Call the function [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>) with `mcache` as the argument to obtain a constant pointer to the private header.
    - Access the `app_sz` field of the returned header structure.
- **Output**: Returns an unsigned long integer representing the application size stored in the metadata cache header.
- **Functions Called**:
    - [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>)


---
### fd\_mcache\_seq0<!-- {{#callable:fd_mcache_seq0}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L149>)

Retrieves the initial sequence number from the metadata cache header.
- **Inputs**:
    - `mcache`: A pointer to a constant `fd_frag_meta_t` structure representing the metadata cache.
- **Logic and Control Flow**:
    - Calls the function [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>) with `mcache` as an argument to obtain a constant pointer to the private header.
    - Accesses the `seq0` field of the returned header structure.
- **Output**: Returns the initial sequence number (`seq0`) as an unsigned long integer.
- **Functions Called**:
    - [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>)


---
### fd\_mcache\_seq\_laddr\_const<!-- {{#callable:fd_mcache_seq_laddr_const}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L154>)

Returns a constant pointer to the sequence number array from the metadata cache header.
- **Inputs**:
    - `mcache`: A constant pointer to an `fd_frag_meta_t` structure representing the metadata cache.
- **Logic and Control Flow**:
    - Calls [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>) with `mcache` to get a constant pointer to the private header.
    - Accesses the `seq` field of the returned header and returns it as a constant pointer.
- **Output**: A constant pointer to an array of unsigned long integers representing sequence numbers.
- **Functions Called**:
    - [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>)


---
### fd\_mcache\_seq\_laddr<!-- {{#callable:fd_mcache_seq_laddr}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L159>)

Returns a pointer to the sequence number array in the metadata cache header.
- **Inputs**:
    - `mcache`: A pointer to an `fd_frag_meta_t` structure representing the metadata cache.
- **Logic and Control Flow**:
    - Call [`fd_mcache_private_hdr`](<fd_mcache_private.h.md#fd_mcache_private_hdr>) with `mcache` to get a pointer to the private header of the metadata cache.
    - Access the `seq` field of the private header and return it.
- **Output**: A pointer to the sequence number array (`ulong *`) in the metadata cache header.
- **Functions Called**:
    - [`fd_mcache_private_hdr`](<fd_mcache_private.h.md#fd_mcache_private_hdr>)


---
### fd\_mcache\_app\_laddr\_const<!-- {{#callable:fd_mcache_app_laddr_const}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L164>)

Returns a constant pointer to the application-specific data area within the memory cache.
- **Inputs**:
    - `mcache`: A constant pointer to `fd_frag_meta_t`, representing the memory cache metadata.
- **Logic and Control Flow**:
    - Call [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>) with `mcache` to get a constant pointer to the private header `hdr`.
    - Calculate the address of the application-specific data by adding `hdr->app_off` to the address of `hdr`.
    - Cast the calculated address to a constant `uchar` pointer and return it.
- **Output**: A constant pointer to the application-specific data area within the memory cache.
- **Functions Called**:
    - [`fd_mcache_private_hdr_const`](<fd_mcache_private.h.md#fd_mcache_private_hdr_const>)


---
### fd\_mcache\_app\_laddr<!-- {{#callable:fd_mcache_app_laddr}} -->
[View Source →](<../../../../../src/tango/mcache/fd_mcache.c#L170>)

Returns a pointer to the application-specific data area within the memory cache.
- **Inputs**:
    - `mcache`: A pointer to a `fd_frag_meta_t` structure representing the memory cache.
- **Logic and Control Flow**:
    - Call [`fd_mcache_private_hdr`](<fd_mcache_private.h.md#fd_mcache_private_hdr>) with `mcache` to get the private header associated with the memory cache.
    - Calculate the address of the application-specific data area by adding `hdr->app_off` to the base address of the header.
    - Return the calculated address cast to a `uchar *`.
- **Output**: A pointer to the application-specific data area within the memory cache.
- **Functions Called**:
    - [`fd_mcache_private_hdr`](<fd_mcache_private.h.md#fd_mcache_private_hdr>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)