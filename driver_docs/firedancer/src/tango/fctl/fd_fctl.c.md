<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for configuring and managing flow control settings in shared memory.

# Purpose
The code defines functions for managing flow control configurations in a system. It provides functionality to initialize and configure flow control settings using shared memory. The [`fd_fctl_new`](<#fd_fctl_new>) function initializes a flow control structure in a given shared memory region, ensuring that the memory is correctly aligned and that the maximum number of receivers (`rx_max`) does not exceed a predefined limit. The function returns a pointer to the initialized memory if successful, or `NULL` if any validation checks fail.

The [`fd_fctl_cfg_rx_add`](<#fd_fctl_cfg_rx_add>) function adds a receiver configuration to the flow control structure, validating input parameters such as the maximum credit (`cr_max`) and ensuring that the number of receivers does not exceed the maximum allowed. The [`fd_fctl_cfg_done`](<#fd_fctl_cfg_done>) function finalizes the configuration by setting burst, maximum, resume, and refill credit values, ensuring they are within valid ranges. These functions collectively manage the setup and configuration of flow control parameters, ensuring that the system operates within defined constraints.
# Imports and Dependencies

---
- `fd_fctl.h`


# Functions

---
### fd\_fctl\_new<!-- {{#callable:fd_fctl_new}} -->
[View Source →](<../../../../../src/tango/fctl/fd_fctl.c#L3>)

Initializes a flow control structure in shared memory with specified maximum receive count.
- **Inputs**:
    - `shmem`: A pointer to shared memory where the flow control structure will be initialized.
    - `rx_max`: The maximum number of receive operations allowed, must not exceed `FD_FCTL_RX_MAX_MAX`.
- **Logic and Control Flow**:
    - Check if `shmem` is NULL; if true, log a warning and return NULL.
    - Check if `shmem` is aligned according to `fd_fctl_align`; if not, log a warning and return NULL.
    - Check if `rx_max` exceeds `FD_FCTL_RX_MAX_MAX`; if true, log a warning and return NULL.
    - Cast `shmem` to a `fd_fctl_t` pointer and initialize its fields: `rx_max` to `rx_max`, `rx_cnt` to 0, `in_refill` to 0, `cr_burst` to 0, `cr_max` to 0, `cr_resume` to 0, and `cr_refill` to 0.
    - Return the `shmem` pointer.
- **Output**: Returns the `shmem` pointer if initialization is successful, otherwise returns NULL.


---
### fd\_fctl\_cfg\_rx\_add<!-- {{#callable:fd_fctl_cfg_rx_add}} -->
[View Source →](<../../../../../src/tango/fctl/fd_fctl.c#L34>)

Adds a new receiver configuration to the flow control structure if the parameters are valid.
- **Inputs**:
    - `fctl`: A pointer to the `fd_fctl_t` structure where the receiver configuration will be added.
    - `cr_max`: The maximum credit value for the receiver, must be a positive value and not exceed `LONG_MAX`.
    - `seq_laddr`: A pointer to a sequence address, can be `NULL` to indicate it is disabled temporarily.
    - `slow_laddr`: A pointer to a slow address, must not be `NULL`.
- **Logic and Control Flow**:
    - Check if `fctl` is `NULL` and log a warning if true, then return `NULL`.
    - Check if `cr_max` is zero and log a warning if true, then return `NULL`.
    - Check if `cr_max` exceeds `LONG_MAX` and log a warning if true, then return `NULL`.
    - Check if `slow_laddr` is `NULL` and log a warning if true, then return `NULL`.
    - Calculate the current receiver index `rx_idx` from `fctl->rx_cnt`.
    - Check if `rx_idx` exceeds or equals `fctl->rx_max` and log a warning if true, then return `NULL`.
    - Retrieve the private receiver array from `fctl` and set the `cr_max`, `seq_laddr`, and `slow_laddr` for the receiver at index `rx_idx`.
    - Increment the receiver count `fctl->rx_cnt` by 1.
    - Return the updated `fctl` structure.
- **Output**: Returns the updated `fd_fctl_t` structure with the new receiver configuration, or `NULL` if any validation fails.
- **Functions Called**:
    - [`fd_fctl_private_rx`](<fd_fctl.h.md#fd_fctl_private_rx>)


---
### fd\_fctl\_cfg\_done<!-- {{#callable:fd_fctl_cfg_done}} -->
[View Source →](<../../../../../src/tango/fctl/fd_fctl.c#L76>)

Configures the flow control parameters for a given `fd_fctl_t` structure.
- **Inputs**:
    - `fctl`: A pointer to an `fd_fctl_t` structure to configure.
    - `cr_burst`: The burst credit limit, must be between 1 and the minimum of all receiver `cr_max` values.
    - `cr_max`: The maximum credit limit, defaults to the maximum of all receiver `cr_max` values if zero.
    - `cr_resume`: The resume credit limit, defaults to two-thirds of the way between `cr_burst` and `cr_max` if zero.
    - `cr_refill`: The refill credit limit, defaults to halfway between `cr_burst` and `cr_resume` if zero.
- **Logic and Control Flow**:
    - Check if `fctl` is NULL and log a warning if true, then return NULL.
    - Calculate `cr_burst_max` as the minimum of `LONG_MAX` and all receiver `cr_max` values.
    - Validate `cr_burst` is within the range [1, `cr_burst_max`], log a warning and return NULL if not.
    - Set `cr_max` to `cr_burst_max` or the maximum of all receiver `cr_max` values if `cr_max` is zero.
    - Validate `cr_max` is within the range [`cr_burst`, `LONG_MAX`], log a warning and return NULL if not.
    - Set `cr_resume` to two-thirds of the way between `cr_burst` and `cr_max` if `cr_resume` is zero.
    - Validate `cr_resume` is within the range [`cr_burst`, `cr_max`], log a warning and return NULL if not.
    - Set `cr_refill` to halfway between `cr_burst` and `cr_resume` if `cr_refill` is zero.
    - Validate `cr_refill` is within the range [`cr_burst`, `cr_resume`], log a warning and return NULL if not.
    - Assign the validated and possibly adjusted values to the `fctl` structure's fields.
    - Return the configured `fctl` pointer.
- **Output**: A pointer to the configured `fd_fctl_t` structure, or NULL if any validation fails.
- **Functions Called**:
    - [`fd_fctl_private_rx`](<fd_fctl.h.md#fd_fctl_private_rx>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)