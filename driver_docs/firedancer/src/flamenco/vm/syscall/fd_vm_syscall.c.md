<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Registers and manages system calls for a virtual machine, including feature-based conditional registration.

# Purpose
The code defines functions for managing system calls in a virtual machine environment. It provides functionality to register system calls by name and to configure system call slots based on specific features. The [`fd_vm_syscall_register`](<#fd_vm_syscall_register>) function registers a system call by inserting it into a system call map, using a hash of the system call's name. It checks for invalid inputs and ensures that the system call is not already present in the map. The [`fd_vm_syscall_register_slot`](<#fd_vm_syscall_register_slot>) function configures system call slots, enabling or disabling specific system calls based on the provided features and deployment status. It uses a macro to register a series of predefined system calls, including cryptographic operations and system variable access functions.

The code is part of a larger system that likely involves a virtual machine or an execution environment where system calls are used to perform various operations. It is not an executable file but rather a C source file intended to be part of a library or module that manages system calls. The functions defined in this file are crucial for setting up and managing the system call interface, allowing other parts of the system to interact with the virtual machine's capabilities. The code includes references to external functions and constants, indicating that it is part of a broader codebase with dependencies on other modules or libraries.
# Imports and Dependencies

---
- `fd_vm_syscall.h`


# Functions

---
### fd\_vm\_syscall\_register<!-- {{#callable:fd_vm_syscall_register}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/fd_vm_syscall.c#L3>)

Registers a syscall function with a given name into the syscall map if the name is not already present.
- **Inputs**:
    - `syscalls`: A pointer to the `fd_sbpf_syscalls_t` structure where the syscall will be registered.
    - `name`: A constant character pointer representing the name of the syscall to register.
    - `func`: A function pointer of type `fd_sbpf_syscall_func_t` representing the syscall function to register.
- **Logic and Control Flow**:
    - Checks if `syscalls` or `name` is NULL and returns `FD_VM_ERR_INVAL` if true.
    - Calculates a hash of the `name` using `fd_murmur3_32` and attempts to insert it into the `syscalls` map using `fd_sbpf_syscalls_insert`.
    - If the insertion fails (i.e., the name or its hash is already in the map), returns `FD_VM_ERR_INVAL`.
    - Assigns the `func` and `name` to the newly inserted syscall entry.
    - Returns `FD_VM_SUCCESS` upon successful registration.
- **Output**: Returns an integer status code: `FD_VM_SUCCESS` on success or `FD_VM_ERR_INVAL` on failure.


---
### fd\_vm\_syscall\_register\_slot<!-- {{#callable:fd_vm_syscall_register_slot}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/fd_vm_syscall.c#L18>)

Registers a set of system calls in a given slot based on feature flags and deployment status.
- **Inputs**:
    - `syscalls`: A pointer to `fd_sbpf_syscalls_t`, which holds the system calls to register.
    - `slot`: An unsigned long integer representing the slot number to check for feature activation.
    - `features`: A constant pointer to `fd_features_t`, which contains the feature flags for the system calls.
    - `is_deploy`: An unsigned char indicating whether the current operation is a deployment (non-zero) or not (zero).
- **Logic and Control Flow**:
    - Check if `syscalls` is NULL and return `FD_VM_ERR_INVAL` if true.
    - Initialize variables to track the enablement of various syscalls to zero.
    - If `slot` is non-zero, set each syscall enablement variable based on the feature flags using `FD_FEATURE_ACTIVE`.
    - If `slot` is zero, enable all syscalls by setting each enablement variable to one.
    - Clear the existing syscalls in `syscalls` using `fd_sbpf_syscalls_clear`.
    - Initialize `syscall_cnt` to zero to track the number of registered syscalls.
    - Define a macro `REGISTER` to register a syscall and increment `syscall_cnt`, returning errors if the syscall table is full or registration fails.
    - Register a set of default syscalls using the `REGISTER` macro.
    - Conditionally register additional syscalls based on the enablement variables and `is_deploy` flag.
    - Return `FD_VM_SUCCESS` upon successful registration of all applicable syscalls.
- **Output**: Returns an integer status code, `FD_VM_SUCCESS` on success, or an error code such as `FD_VM_ERR_INVAL` or `FD_VM_ERR_FULL` on failure.



---
Made with ❤️ by [Driver](https://www.driver.ai/)