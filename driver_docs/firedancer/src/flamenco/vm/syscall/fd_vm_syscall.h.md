<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file defining virtual machine syscalls for the Firedancer project, including syscall declarations and related constants.

# Purpose
The code is a C header file that defines a set of system call (syscall) declarations for a virtual machine (VM) environment, specifically tailored for integration with the Solana blockchain. The file includes various syscall declarations that facilitate operations such as logging, memory management, cryptographic functions, and interactions with Solana's runtime and program-derived addresses (PDAs). Each syscall is defined using the [`FD_VM_SYSCALL_DECL`](<#fd_vm_syscall_decl>) macro, which standardizes the function signature for these operations.

The header file includes constants and macros that define limits and configurations, such as `FD_VM_RETURN_DATA_MAX` and `FD_VM_PDA_SEEDS_MAX`, which set constraints on return data size and PDA seed count, respectively. The syscalls cover a wide range of functionalities, including aborting program execution, logging messages, handling memory operations like `memcpy` and `memset`, and performing cryptographic operations like hashing and curve operations. Additionally, the file provides syscalls for managing Solana-specific tasks, such as retrieving sysvar values and handling cross-program invocations. The file is intended to be included in other C source files to provide these syscall interfaces, and it serves as a bridge between the VM and the Solana blockchain environment.
# Imports and Dependencies

---
- `../fd_vm_private.h`
- `fd_vm_syscall_macros.h`
- `fd_vm_cpi.h`
- `../../runtime/fd_runtime.h`
- `../../runtime/context/fd_exec_instr_ctx.h`
- `../../log_collector/fd_log_collector.h`


# Function Declarations (Public API)

---
### fd\_vm\_prepare\_instruction<!-- {{#callable_declaration:fd_vm_prepare_instruction}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/fd_vm_syscall.h#L774>)

Prepares instruction accounts for execution.
- **Description**: Use this function to prepare instruction accounts for execution by de-duplicating and normalizing account privileges. It must be called with valid instruction and context data. The function checks for unknown accounts and privilege escalations, returning specific error codes if these conditions are met. It updates the `instruction_accounts` array with normalized permissions and sets the count of instruction accounts. Ensure that the `callee_instr`, `instr_ctx`, `callee_program_id_pubkey`, `instr_acct_keys`, `instruction_accounts`, `instruction_accounts_cnt`, `signers`, and `signers_cnt` are correctly initialized before calling.
- **Inputs**:
    - `callee_instr`: Pointer to `fd_instr_info_t` representing the callee instruction. Must not be null.
    - `instr_ctx`: Pointer to `fd_exec_instr_ctx_t` representing the execution context. Must not be null.
    - `callee_program_id_pubkey`: Pointer to `fd_pubkey_t` representing the callee program ID public key. Must not be null.
    - `instr_acct_keys`: Array of `fd_pubkey_t` with a maximum size of `FD_INSTR_ACCT_MAX`. Represents the instruction account keys.
    - `instruction_accounts`: Array of `fd_instruction_account_t` with a maximum size of `FD_INSTR_ACCT_MAX`. Will be populated with normalized instruction accounts.
    - `instruction_accounts_cnt`: Pointer to `ulong` where the function will store the count of instruction accounts. Must not be null.
    - `signers`: Pointer to an array of `fd_pubkey_t` representing the signers. Can be null if `signers_cnt` is zero.
    - `signers_cnt`: `ulong` representing the number of signers. Can be zero.
- **Output**: Returns 0 on success. On failure, returns specific error codes indicating the type of error encountered, such as missing accounts or privilege escalations.
- **See Also**: [`fd_vm_prepare_instruction`](<fd_vm_syscall_cpi.c.md#fd_vm_prepare_instruction>)  (Implementation)


---
### fd\_vm\_derive\_pda<!-- {{#callable_declaration:fd_vm_derive_pda}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/fd_vm_syscall.h#L925>)

Derives a program-derived address (PDA) using specified seeds and a program ID.
- **Description**: Use this function to derive a PDA from a given set of seeds and a program ID. The function requires a virtual machine context and checks that the number of seeds does not exceed the maximum allowed. It also ensures that each seed's size is within permissible limits. The function appends a bump seed if provided and uses SHA-256 hashing to compute the PDA. The derived address is stored in the output parameter. Ensure that the virtual machine context is valid and that the seeds and program ID are correctly specified before calling this function.
- **Inputs**:
    - `vm`: A pointer to a `fd_vm_t` structure representing the virtual machine context. Must not be null.
    - `program_id`: A pointer to a `fd_pubkey_t` structure representing the program ID. Must not be null.
    - `seed_haddrs`: An array of pointers to seed data. Each pointer must point to a valid memory location. The array must have at least `seeds_cnt` elements.
    - `seed_szs`: An array of unsigned long integers representing the sizes of each seed. Each size must not exceed `FD_VM_PDA_SEED_MEM_MAX`. The array must have at least `seeds_cnt` elements.
    - `seeds_cnt`: The number of seeds. Must not exceed `FD_VM_PDA_SEEDS_MAX`.
    - `bump_seed`: A pointer to a single byte used as a bump seed. Can be null if no bump seed is used.
    - `out`: A pointer to a `fd_pubkey_t` structure where the derived PDA will be stored. Must not be null.
- **Output**: Returns an integer status code. `FD_VM_SUCCESS` indicates success, while other codes indicate specific errors, such as invalid seeds or program ID.
- **See Also**: [`fd_vm_derive_pda`](<fd_vm_syscall_pda.c.md#fd_vm_derive_pda>)  (Implementation)


---
### fd\_vm\_translate\_and\_check\_program\_address\_inputs<!-- {{#callable_declaration:fd_vm_translate_and_check_program_address_inputs}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/fd_vm_syscall.h#L934>)

Validates and translates program address inputs for a virtual machine.
- **Description**: Use this function to validate and translate the inputs related to program addresses in a virtual machine context. It checks the validity of seed addresses and sizes, ensuring they do not exceed predefined limits. If the `out_program_id` parameter is provided, it also translates the program ID address. This function is typically used in scenarios where program address inputs need verification before further processing, such as in cross-program invocations or system calls. Ensure that the `seeds_cnt` does not exceed `FD_VM_PDA_SEEDS_MAX` and that each seed size does not exceed `FD_VM_PDA_SEED_MEM_MAX` when `is_syscall` is true.
- **Inputs**:
    - `vm`: A pointer to the virtual machine instance. Must not be null.
    - `seeds_vaddr`: The virtual address of the seeds. Must be a valid address within the virtual machine's memory space.
    - `seeds_cnt`: The number of seeds. Must not exceed `FD_VM_PDA_SEEDS_MAX`.
    - `program_id_vaddr`: The virtual address of the program ID. Must be a valid address if `out_program_id` is not null.
    - `out_seed_haddrs`: An array to store the translated seed host addresses. Must be large enough to hold `seeds_cnt` entries.
    - `out_seed_szs`: An array to store the sizes of the seeds. Must be large enough to hold `seeds_cnt` entries.
    - `out_program_id`: A pointer to store the translated program ID. Can be null if translation is not required.
    - `is_syscall`: A flag indicating if the function is called from a syscall context. Affects error logging behavior.
- **Output**: Returns an integer status code indicating success or specific error conditions. On success, `out_seed_haddrs` and `out_seed_szs` are populated with translated addresses and sizes. If `out_program_id` is provided, it is populated with the translated program ID.
- **See Also**: [`fd_vm_translate_and_check_program_address_inputs`](<fd_vm_syscall_pda.c.md#fd_vm_translate_and_check_program_address_inputs>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)