<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for virtual machine syscalls related to curve operations, including multiscalar multiplication and group operations.

# Purpose
The code is a C program designed to test virtual machine (VM) system calls related to cryptographic curve operations. It includes functions to test specific system calls for multi-scalar multiplication and group operations on elliptic curves, such as addition, subtraction, and multiplication. The program initializes a virtual machine environment, sets up test cases with predefined scalar and point data, and verifies the results against expected outcomes. The main function orchestrates the setup and execution of these tests, ensuring that the VM and its components are correctly initialized and cleaned up after the tests.

The program includes two main test functions: [`test_vm_syscall_sol_curve_multiscalar_mul`](<#test_vm_syscall_sol_curve_multiscalar_mul>) and [`test_fd_vm_syscall_sol_curve_group_op`](<#test_fd_vm_syscall_sol_curve_group_op>). These functions execute system calls for multi-scalar multiplication and group operations, respectively, and validate the results. The tests cover various scenarios, including invalid inputs and successful operations, using predefined data for scalars and points. The program logs the results of each test case and ensures that the VM environment is properly configured and reset between tests. The code is structured to be executed as a standalone program, with the [`main`](<#main>) function serving as the entry point.
# Imports and Dependencies

---
- `fd_vm_syscall.h`
- `../test_vm_util.h`


# Functions

---
### set\_memory\_region<!-- {{#callable:set_memory_region}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/test_vm_syscall_curve.c#L4>)

Initializes a memory region with a sequence of bytes where each byte is the least significant byte of its index.
- **Inputs**:
    - ``mem``: A pointer to the start of the memory region to initialize.
    - ``sz``: The size of the memory region to initialize, in bytes.
- **Logic and Control Flow**:
    - Iterates over each index `i` from 0 to `sz-1`.
    - For each index `i`, assigns the byte at `mem[i]` to the least significant byte of `i`.
- **Output**: No return value; the function modifies the memory region pointed to by `mem` in place.


---
### test\_vm\_syscall\_sol\_curve\_multiscalar\_mul<!-- {{#callable:test_vm_syscall_sol_curve_multiscalar_mul}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/test_vm_syscall_curve.c#L6>)

Tests the `fd_vm_syscall_sol_curve_multiscalar_mul` function by verifying its return code and result against expected values.
- **Inputs**:
    - `test_case_name`: A string that identifies the test case.
    - `vm`: A pointer to the virtual machine instance (`fd_vm_t`).
    - `curve_id`: An unsigned long that specifies the curve identifier.
    - `scalar_vaddr`: An unsigned long that specifies the virtual address of the scalars.
    - `point_vaddr`: An unsigned long that specifies the virtual address of the points.
    - `point_cnt`: An unsigned long that specifies the number of points.
    - `result_point_vaddr`: An unsigned long that specifies the virtual address where the result point is stored.
    - `expected_ret_code`: An unsigned long that specifies the expected return code from the syscall.
    - `expected_syscall_ret`: An integer that specifies the expected syscall return value.
    - `expected_result_host_ptr`: A pointer to the expected result in host memory.
- **Logic and Control Flow**:
    - Initialize `ret_code` to 0UL.
    - Call `fd_vm_syscall_sol_curve_multiscalar_mul` with the provided parameters and store the syscall return value in `syscall_ret`.
    - Verify that `syscall_ret` matches `expected_syscall_ret` using `FD_TEST`.
    - If `syscall_ret` is `FD_VM_SUCCESS`, verify that `ret_code` matches `expected_ret_code`.
    - Clear the transaction context error using `test_vm_clear_txn_ctx_err`.
    - Load the result point from virtual memory using `FD_VM_MEM_HADDR_LD`.
    - If both `ret_code` and `syscall_ret` are 0, compare the result point with `expected_result_host_ptr` using `memcmp` and verify the result with `FD_TEST`.
    - Log a notice indicating the test case passed.
    - Return 1 to indicate the test passed.
- **Output**: Returns 1 to indicate the test passed.


---
### test\_fd\_vm\_syscall\_sol\_curve\_group\_op<!-- {{#callable:test_fd_vm_syscall_sol_curve_group_op}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/test_vm_syscall_curve.c#L35>)

Tests the `fd_vm_syscall_sol_curve_group_op` function by executing a curve group operation and verifying the results against expected values.
- **Inputs**:
    - `test_case_name`: A string that names the test case.
    - `vm`: A pointer to the virtual machine (`fd_vm_t`) instance.
    - `curve_id`: An unsigned long that identifies the curve to use.
    - `op_id`: An unsigned long that identifies the operation to perform.
    - `in0_vaddr`: An unsigned long that specifies the virtual address of the first input point.
    - `in1_vaddr`: An unsigned long that specifies the virtual address of the second input point.
    - `result_point_vaddr`: An unsigned long that specifies the virtual address where the result point will be stored.
    - `expected_ret_code`: An unsigned long that specifies the expected return code from the syscall.
    - `expected_syscall_ret`: An integer that specifies the expected return value from the syscall.
    - `expected_result_host_ptr`: A pointer to the expected result data in host memory.
- **Logic and Control Flow**:
    - Initialize `ret_code` to 0 and call `fd_vm_syscall_sol_curve_group_op` with the provided parameters, storing the return value in `syscall_ret`.
    - Verify that `ret_code` matches `expected_ret_code` and `syscall_ret` matches `expected_syscall_ret` using `FD_TEST`.
    - Clear any transaction context errors using `test_vm_clear_txn_ctx_err`.
    - Load the result point from virtual memory using `FD_VM_MEM_HADDR_LD`.
    - If both `ret_code` and `syscall_ret` are 0, compare the result point with `expected_result_host_ptr` using `memcmp` and verify the result with `FD_TEST`.
    - Log a notice indicating the test case passed using `FD_LOG_NOTICE`.
    - Return 1 to indicate the test function executed successfully.
- **Output**: Returns 1 to indicate successful execution of the test.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../../src/flamenco/vm/syscall/test_vm_syscall_curve.c#L62>)

Initializes and tests a virtual machine environment for cryptographic operations using various syscalls.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Creates and joins a random number generator (`fd_rng_t`), a SHA-256 context (`fd_sha256_t`), and a virtual machine (`fd_vm_t`).
    - Sets up a memory region with [`set_memory_region`](<#set_memory_region>) and initializes instruction and transaction contexts.
    - Enables all features in the transaction context using `fd_features_enable_all`.
    - Initializes the virtual machine with `fd_vm_init` and checks for successful initialization.
    - Performs a series of tests on the virtual machine using [`test_vm_syscall_sol_curve_multiscalar_mul`](<#test_vm_syscall_sol_curve_multiscalar_mul>) and [`test_fd_vm_syscall_sol_curve_group_op`](<#test_fd_vm_syscall_sol_curve_group_op>) to validate cryptographic operations.
    - Tests include invalid and valid cases for multiscalar multiplication and group operations on elliptic curves.
    - Cleans up by deleting and leaving the virtual machine, SHA-256 context, and random number generator.
    - Logs a success message and halts the program with `fd_halt`.
- **Output**: Returns an integer status code, typically 0 for successful execution.
- **Functions Called**:
    - [`set_memory_region`](<#set_memory_region>)
    - [`test_vm_syscall_sol_curve_multiscalar_mul`](<#test_vm_syscall_sol_curve_multiscalar_mul>)
    - [`test_fd_vm_syscall_sol_curve_group_op`](<#test_fd_vm_syscall_sol_curve_group_op>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)