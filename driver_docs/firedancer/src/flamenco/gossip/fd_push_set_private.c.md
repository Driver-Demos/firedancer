<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a push set data structure using custom pool and doubly linked list templates for managing entries.

# Purpose
The code defines a data structure and associated functions for managing a set of transactions in a gossip protocol. The primary data structure is `push_set_entry`, which includes a transaction builder (`fd_gossip_txbuild_t`), a pool for managing active set indices, and a linked list for tracking the last access time of each entry. The `push_set` structure aggregates these entries and provides mechanisms to manage them efficiently.

The code includes functions for aligning memory ([`push_set_align`](<#push_set_align>)), calculating memory footprint ([`push_set_footprint`](<#push_set_footprint>)), creating a new push set ([`push_set_new`](<#push_set_new>)), joining an existing push set ([`push_set_join`](<#push_set_join>)), and updating the access order of entries ([`push_set_pop_append`](<#push_set_pop_append>)). The implementation uses templates from `fd_pool.c` and `fd_dlist.c` to manage memory pools and doubly linked lists, respectively. This code is intended to be part of a larger system, providing a specialized utility for transaction management in a gossip protocol environment.
# Imports and Dependencies

---
- `fd_gossip_txbuild.h`
- `../../util/tmpl/fd_pool.c`
- `../../util/tmpl/fd_dlist.c`


# Data Structures

---
### push\_set\_entry
- **Type**: ``struct``
- **Members**:
    - ``txbuild``: An array of `fd_gossip_txbuild_t` structures used for transaction building.
    - ``pool``: A structure containing `next` and `in_use` fields to manage pool indices and usage.
    - ``last_hit``: A structure containing `wallclock_nanos`, `prev`, and `next` fields to track the last access time and linked list pointers.
- **Description**: The `push_set_entry` structure is used to manage entries in a push set, utilizing a transaction building component, a pool management system, and a linked list for tracking the last access time. The `txbuild` array is used for transaction-related operations, while the `pool` structure manages the indices and usage status of the entries. The `last_hit` structure maintains timing and linkage information for efficient access and manipulation within a doubly linked list.


---
### push\_set\_entry\_t
- **Type**: ``struct``
- **Members**:
    - ``txbuild``: An array of one `fd_gossip_txbuild_t` structure.
    - ``pool``: Contains `next` for the next index in the pool and `in_use` to indicate if the entry is active.
    - ``last_hit``: Tracks the last access time with `wallclock_nanos` and links to previous and next entries with `prev` and `next`.
- **Description**: The `push_set_entry_t` structure is used to manage entries in a push set, utilizing a pool for memory management and a doubly linked list to track the order of access. It includes a `txbuild` array for transaction building, a `pool` structure to manage active indices, and a `last_hit` structure to record the last access time and maintain links to other entries.


---
### push\_set
- **Type**: ``struct``
- **Members**:
    - `pool`: Pointer to a pool of `push_set_entry_t` structures.
    - `last_hit`: Pointer to a doubly linked list of `push_set_entry_t` structures.
- **Description**: Manages a collection of `push_set_entry_t` structures, which are organized in a pool and a doubly linked list to track active set indices and manage linked list operations.


---
### push\_set\_t
- **Type**: ``struct``
- **Members**:
    - `pool`: Pointer to a pool of `push_set_entry_t` structures.
    - `last_hit`: Pointer to a doubly linked list of `push_set_entry_t` structures.
- **Description**: Manages a collection of `push_set_entry_t` structures, which are organized in a pool and a doubly linked list to track active set indices and their last access times.


# Functions

---
### push\_set\_align<!-- {{#callable:push_set_align}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_push_set_private.c#L45>)

Returns the alignment requirement for the `pset_entry_pool`.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the function `pset_entry_pool_align()` to get the alignment requirement.
    - Returns the result of `pset_entry_pool_align()`.
- **Output**: The alignment requirement for the `pset_entry_pool` as an unsigned long integer.


---
### push\_set\_footprint<!-- {{#callable:push_set_footprint}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_push_set_private.c#L50>)

Calculates the memory footprint required for a `push_set` structure based on the maximum number of elements.
- **Inputs**:
    - `ele_max`: The maximum number of elements that the `push_set` can hold.
- **Logic and Control Flow**:
    - Initialize `l` with `FD_LAYOUT_INIT`.
    - Append the alignment and footprint of the `pset_entry_pool` to `l` using `FD_LAYOUT_APPEND`.
    - Append the alignment and footprint of the `pset_last_hit` to `l` using `FD_LAYOUT_APPEND`.
    - Append the alignment and size of `push_set_t` to `l` using `FD_LAYOUT_APPEND`.
    - Finalize the layout with `FD_LAYOUT_FINI` using the alignment of `push_set`.
    - Return the calculated footprint `l`.
- **Output**: Returns the total memory footprint as an `ulong` value.
- **Functions Called**:
    - [`push_set_align`](<#push_set_align>)


---
### push\_set\_new<!-- {{#callable:push_set_new}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_push_set_private.c#L61>)

Initializes a new `push_set_t` structure in shared memory with a specified maximum number of elements.
- **Inputs**:
    - `shmem`: A pointer to the shared memory where the `push_set_t` structure will be initialized.
    - `ele_max`: The maximum number of elements that the `push_set_t` structure can hold.
- **Logic and Control Flow**:
    - Check if `shmem` is NULL and log an error if true.
    - Check if `shmem` is aligned according to `push_set_align()` and log an error if not.
    - Initialize a scratch allocator with `shmem`.
    - Allocate memory for the entry pool, last hit list, and `push_set_t` structure using the scratch allocator.
    - Initialize the entry pool and last hit list with the allocated memory.
    - Iterate over each element in the entry pool and set the `in_use` flag to 0.
    - Return a pointer to the initialized `push_set_t` structure.
- **Output**: A pointer to the newly initialized `push_set_t` structure.
- **Functions Called**:
    - [`push_set_align`](<#push_set_align>)


---
### push\_set\_join<!-- {{#callable:push_set_join}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_push_set_private.c#L87>)

Converts a shared memory pool pointer to a `push_set_t` pointer after checking for null.
- **Inputs**:
    - `shpool`: A pointer to a shared memory pool, expected to be non-null.
- **Logic and Control Flow**:
    - Checks if `shpool` is null using `FD_UNLIKELY`; if true, logs an error and likely halts execution.
    - Casts the non-null `shpool` pointer to a `push_set_t` pointer and returns it.
- **Output**: A pointer to `push_set_t` cast from the input `shpool`.


---
### push\_set\_pop\_append<!-- {{#callable:push_set_pop_append}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_push_set_private.c#L95>)

Updates the `last_hit` timestamp of a `push_set_entry_t` and moves it to the end of the `last_hit` list in a `push_set_t`.
- **Inputs**:
    - `pset`: A pointer to a `push_set_t` structure that contains the `last_hit` list and pool.
    - `state`: A pointer to a `push_set_entry_t` structure whose `last_hit` timestamp will be updated and repositioned in the list.
    - `now`: A `long` integer representing the current time in nanoseconds to update the `last_hit` timestamp.
- **Logic and Control Flow**:
    - Set the `last_hit.wallclock_nanos` of `state` to `now`.
    - Remove `state` from the `last_hit` list in `pset`.
    - Append `state` to the end of the `last_hit` list in `pset`.
- **Output**: No return value.



---
Made with ❤️ by [Driver](https://www.driver.ai/)