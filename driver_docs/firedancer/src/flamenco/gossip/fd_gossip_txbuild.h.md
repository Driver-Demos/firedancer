<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for incrementally building and managing Gossip protocol push or pull response messages.

# Purpose
This C header file defines the structure and function prototypes for building gossip protocol messages, specifically push or pull response messages, using CRDS (Conflict-free Replicated Data Structures) values. The `fd_gossip_txbuild_t` structure is used to manage the message construction, including fields for storing message tags, byte arrays, and CRDS metadata. The file provides function prototypes such as [`fd_gossip_txbuild_init`](<#fd_gossip_txbuild_init>) to initialize the message builder with a public key and message type, [`fd_gossip_txbuild_can_fit`](<#fd_gossip_txbuild_can_fit>) to check if an additional CRDS value can be appended, and [`fd_gossip_txbuild_append`](<#fd_gossip_txbuild_append>) to add CRDS values to the message. The caller must ensure there is enough space before appending new values and handle the final message flushing.
# Imports and Dependencies

---
- `fd_gossip_private.h`


# Data Structures

---
### fd\_gossip\_txbuild
- **Type**: ``struct``
- **Members**:
    - ``tag``: An unsigned character that identifies the type of message.
    - ``bytes_len``: An unsigned long integer that indicates the length of the `bytes` array.
    - ``bytes``: An array of unsigned characters with a fixed size of 1232 bytes to store message data.
    - ``crds_len``: An unsigned long integer that indicates the number of CRDS entries in the `crds` array.
    - ``crds``: An array of structures, each containing `tag`, `off`, and `sz` fields, to store CRDS metadata.
- **Description**: The `fd_gossip_txbuild` structure is used to build a gossip message incrementally, either for a push or pull response. It contains fields to store the message type, the length and content of the message bytes, and an array of CRDS metadata entries. The structure allows for the construction of a message by appending CRDS values, ensuring that the message does not exceed its capacity.


---
### fd\_gossip\_txbuild\_t
- **Type**: ``struct fd_gossip_txbuild``
- **Members**:
    - ``tag``: Stores the type of message being built.
    - ``bytes_len``: Indicates the length of the `bytes` array.
    - ``bytes``: Holds the message data being constructed, with a maximum size of 1232 bytes.
    - ``crds_len``: Indicates the number of CRDS values currently stored in the `crds` array.
    - ``crds``: An array of structures, each containing a `tag`, `off`, and `sz` to describe individual CRDS values.
- **Description**: Facilitates the incremental construction of push or pull response messages from CRDS values, ensuring that the caller manages space and final message flushing.


# Function Declarations (Public API)

---
### fd\_gossip\_txbuild\_init<!-- {{#callable_declaration:fd_gossip_txbuild_init}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip_txbuild.h#L27>)

Initializes a transaction builder with a public key and message type.
- **Description**: Use this function to set up a transaction builder for creating a push or pull response message. It initializes the builder with a specified identity public key and message type. This function must be called before appending any CRDS values to ensure the builder is correctly configured. The caller must ensure that the `txbuild` pointer is valid and points to a properly allocated `fd_gossip_txbuild_t` structure.
- **Inputs**:
    - `txbuild`: A pointer to an `fd_gossip_txbuild_t` structure that will be initialized. Must not be null and must point to a valid memory location.
    - `identity_pubkey`: A pointer to a 32-byte array containing the identity public key. Must not be null.
    - `msg_type`: An unsigned character representing the message type. Valid values are `FD_GOSSIP_MESSAGE_PULL_RESPONSE` or `FD_GOSSIP_MESSAGE_PUSH`.
- **Output**: None
- **See Also**: [`fd_gossip_txbuild_init`](<fd_gossip_txbuild.c.md#fd_gossip_txbuild_init>)  (Implementation)


---
### fd\_gossip\_txbuild\_can\_fit<!-- {{#callable_declaration:fd_gossip_txbuild_can_fit}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip_txbuild.h#L42>)

Checks if an additional CRDS value can fit in the message.
- **Description**: Use this function to determine if there is enough space in the outgoing message to append an additional CRDS value of a specified size. This check is necessary before attempting to append a new value to avoid undefined behavior. Call this function before using any append operations to ensure the message buffer can accommodate the new data.
- **Inputs**:
    - `txbuild`: A pointer to an `fd_gossip_txbuild_t` structure representing the message being built. Must not be null.
    - `crds_len`: The size of the CRDS value to check for space availability. Must be a non-negative value.
- **Output**: Returns 1 if the message can accommodate the additional CRDS value, or 0 if it cannot.
- **See Also**: [`fd_gossip_txbuild_can_fit`](<fd_gossip_txbuild.c.md#fd_gossip_txbuild_can_fit>)  (Implementation)


---
### fd\_gossip\_txbuild\_append<!-- {{#callable_declaration:fd_gossip_txbuild_append}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip_txbuild.h#L53>)

Appends a CRDS value to the transaction builder.
- **Description**: Use this function to add a CRDS value to the transaction builder's message buffer. Before calling, ensure there is enough space for the new value by using `fd_gossip_txbuild_can_fit`. This function assumes that any necessary flush operations have been performed prior to appending. It updates the builder's message to include the new CRDS value, increasing the count of CRDS values by one.
- **Inputs**:
    - `txbuild`: A pointer to an `fd_gossip_txbuild_t` structure. The caller must ensure this is a valid, initialized transaction builder. The function modifies this structure to append the CRDS value.
    - `crds_len`: The length of the CRDS value to append. It must not exceed `FD_GOSSIP_CRDS_MAX_SZ` and must fit within the remaining space of the transaction builder.
    - `crds`: A pointer to the CRDS value data to append. The caller must ensure this is a valid pointer to a buffer of at least `crds_len` bytes.
- **Output**: None
- **See Also**: [`fd_gossip_txbuild_append`](<fd_gossip_txbuild.c.md#fd_gossip_txbuild_append>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)