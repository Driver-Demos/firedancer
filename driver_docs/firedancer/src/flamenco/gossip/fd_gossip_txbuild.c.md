<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions and structures for building and managing gossip transaction messages.

# Purpose
The code defines a set of functions and data structures for building and managing gossip transactions in a network communication context. It includes the definition of two packed structures, `crds_val_hdr_t` and `crds_msg_t`, which are used to represent the headers and messages in the gossip protocol. The `crds_val_hdr_t` structure contains a signature and a tag, while the `crds_msg_t` structure includes a message type, an identity public key, and a length for the CRDS (Conflict-free Replicated Data Structures) data.

The functions provided in the code are used to initialize, check capacity, and append data to a gossip transaction. The [`fd_gossip_txbuild_init`](<#fd_gossip_txbuild_init>) function initializes a transaction build structure with a given message type and identity public key. The [`fd_gossip_txbuild_can_fit`](<#fd_gossip_txbuild_can_fit>) function checks if additional CRDS data can fit into the transaction. The [`fd_gossip_txbuild_append`](<#fd_gossip_txbuild_append>) function appends CRDS data to the transaction, updating the message and transaction build structure accordingly. These functions facilitate the construction and management of gossip messages, ensuring that they adhere to size constraints and maintain the necessary metadata for network communication.
# Imports and Dependencies

---
- `fd_gossip_txbuild.h`
- `fd_gossip_private.h`


# Data Structures

---
### crds\_val\_hdr
- **Type**: ``struct``
- **Members**:
    - `sig`: An array of 64 unsigned characters used for storing a signature.
    - `tag`: An unsigned integer representing the CRDS value tag.
- **Description**: A packed structure that contains a signature and a tag, used to represent a header for CRDS values in a gossip protocol.


---
### crds\_val\_hdr\_t
- **Type**: ``struct crds_val_hdr``
- **Members**:
    - `sig`: An array of 64 unsigned characters representing a signature.
    - `tag`: An unsigned integer representing the CRDS value tag.
- **Description**: Defines a packed structure with a signature and a tag, used to represent a header for CRDS values in a gossip protocol.


---
### crds\_msg
- **Type**: ``struct``
- **Members**:
    - `msg_type`: Defines the type of the message as an unsigned integer.
    - `identity_pubkey`: Stores a 32-byte public key for identity verification.
    - `crds_len`: Indicates the length of the `crds` array as an unsigned long integer.
    - `crds`: Holds an array of unsigned characters representing CRDS data.
- **Description**: The `crds_msg` structure is a packed data structure used to represent a message in a gossip protocol. It includes a message type, an identity public key for authentication, the length of the CRDS data, and the CRDS data itself. The structure is designed to be compact and efficient for network transmission.


---
### crds\_msg\_t
- **Type**: ``struct``
- **Members**:
    - `msg_type`: Stores the type of the message as an unsigned integer.
    - `identity_pubkey`: Holds the public key of the identity as an array of 32 unsigned characters.
    - `crds_len`: Represents the length of the CRDS data as an unsigned long integer.
    - `crds`: Contains the CRDS data as a flexible array member.
- **Description**: Defines a packed structure for a CRDS message, which includes a message type, an identity public key, the length of the CRDS data, and the CRDS data itself. The structure is used in the context of gossip protocol message construction and transmission.


# Functions

---
### fd\_gossip\_txbuild\_init<!-- {{#callable:fd_gossip_txbuild_init}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip_txbuild.c#L21>)

Initializes a `fd_gossip_txbuild_t` structure with a message type and identity public key.
- **Inputs**:
    - `txbuild`: A pointer to a `fd_gossip_txbuild_t` structure to initialize.
    - `identity_pubkey`: A pointer to a 32-byte array representing the identity public key.
    - `msg_type`: An unsigned character representing the message type.
- **Logic and Control Flow**:
    - Set `txbuild->tag` to `msg_type`.
    - Set `txbuild->bytes_len` to 44, which is the offset of `crds` in `crds_msg_t`.
    - Set `txbuild->crds_len` to 0.
    - Cast `txbuild->bytes` to a `crds_msg_t` pointer and assign it to `msg`.
    - Set `msg->msg_type` to `msg_type`.
    - Copy 32 bytes from `identity_pubkey` to `msg->identity_pubkey`.
    - Set `msg->crds_len` to 0.
- **Output**: No return value; the function initializes the `txbuild` structure in place.


---
### fd\_gossip\_txbuild\_can\_fit<!-- {{#callable:fd_gossip_txbuild_can_fit}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip_txbuild.c#L35>)

Checks if a given CRDS length can fit into the remaining space of a transaction build buffer.
- **Inputs**:
    - `txbuild`: A pointer to a `fd_gossip_txbuild_t` structure representing the transaction build buffer.
    - `crds_len`: The length of the CRDS data to check for fitting into the buffer.
- **Logic and Control Flow**:
    - Calculate the remaining space in the `txbuild` buffer by subtracting `txbuild->bytes_len` from the total size of `txbuild->bytes`.
    - Compare `crds_len` with the remaining space calculated.
    - Return 1 (true) if `crds_len` is less than or equal to the remaining space, otherwise return 0 (false).
- **Output**: Returns an integer indicating whether the CRDS data can fit (1 for yes, 0 for no).


---
### fd\_gossip\_txbuild\_append<!-- {{#callable:fd_gossip_txbuild_append}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip_txbuild.c#L41>)

Appends a CRDS entry to the transaction build structure.
- **Inputs**:
    - `txbuild`: A pointer to the `fd_gossip_txbuild_t` structure where the CRDS entry will be appended.
    - `crds_len`: The length of the CRDS data to append.
    - `crds`: A pointer to the CRDS data to append.
- **Logic and Control Flow**:
    - Verify that `crds_len` does not exceed `FD_GOSSIP_CRDS_MAX_SZ`.
    - Check if the CRDS data can fit in the `txbuild` structure using [`fd_gossip_txbuild_can_fit`](<#fd_gossip_txbuild_can_fit>).
    - Ensure that the current number of CRDS entries is less than the maximum allowed.
    - Copy the CRDS data into the `txbuild->bytes` array at the current `bytes_len` position.
    - Increment the `crds_len` field in the `crds_msg_t` structure within `txbuild->bytes`.
    - Extract the `tag` from the CRDS data header and store it in the `txbuild->crds` array.
    - Set the offset and size of the new CRDS entry in the `txbuild->crds` array.
    - Increment the `crds_len` and `bytes_len` fields in the `txbuild` structure.
- **Output**: The function does not return a value; it modifies the `txbuild` structure in place.
- **Functions Called**:
    - [`fd_gossip_txbuild_can_fit`](<#fd_gossip_txbuild_can_fit>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)