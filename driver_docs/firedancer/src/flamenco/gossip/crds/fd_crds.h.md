<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for managing and manipulating CRDS entries in a gossip protocol.

# Purpose
The code is a C header file that defines the interface for managing a CRDS (Contact Replicated Data Store) system within a gossip protocol. It provides a set of data structures and functions to handle CRDS entries, which are used to store and manage contact information and other related data in a distributed network. The file includes definitions for structures such as `fd_crds_t`, `fd_crds_entry_t`, and `fd_crds_metrics_t`, which are used to represent CRDS tables, individual CRDS entries, and metrics related to CRDS operations, respectively.

The header file declares a variety of functions for creating, managing, and querying CRDS entries. These functions include [`fd_crds_new`](<#fd_crds_new>) for initializing a new CRDS table, [`fd_crds_insert`](<#fd_crds_insert>) for adding new entries, and [`fd_crds_advance`](<#fd_crds_advance>) for performing maintenance tasks such as expiring stale entries. The file also provides functions for iterating over CRDS entries and purged entries using mask-based filtering, as well as functions for managing peer activity and sampling peers for gossip operations. The header file is intended to be included in other C source files that implement or utilize the CRDS functionality within a gossip-based network system.
# Imports and Dependencies

---
- `../fd_gossip_private.h`
- `../fd_gossip_out.h`
- `../../../disco/metrics/generated/fd_metrics_gossip.h`
- `../../../ballet/sha256/fd_sha256.h`


# Data Structures

---
### fd\_crds\_entry\_t
- **Type**: ``struct``
- **Description**: `fd_crds_entry_t` is a typedef for a forward-declared struct `fd_crds_entry_private`. The actual structure definition is not provided in the code, indicating that it is used as an opaque type, likely to encapsulate CRDS (Conflict-free Replicated Data Store) entry details. This allows for abstraction and encapsulation, where the internal details of the CRDS entry are hidden from the user, and operations on CRDS entries are performed through provided functions.


---
### fd\_crds\_t
- **Type**: ``struct``
- **Description**: `fd_crds_t` is a forward declaration of a private structure used in the context of a gossip protocol. It is part of a system that manages a CRDS (Contact Replicated Data Store) table, which tracks and manages contact information and other related data for nodes in a network. The structure is used in various functions to perform operations such as inserting, purging, and sampling CRDS entries, as well as managing peer activity and contact information.


---
### fd\_crds\_mask\_iter\_t
- **Type**: `typedef struct`
- **Description**: `fd_crds_mask_iter_t` is a typedef for a structure named `fd_crds_mask_iter_private`. The structure is used to iterate over CRDS values in a table whose hashes match a given mask. This is part of the Gossip CRDS filter, which applies the mask on the most significant 8 bytes of the CRDS value's hash. The iteration API includes functions to initialize, move to the next item, check completion, and access the current entry.


---
### fd\_crds\_metrics
- **Type**: ``struct``
- **Members**:
    - `count`: An array that stores counts for different CRDS values, indexed by `FD_METRICS_ENUM_CRDS_VALUE_CNT`.
    - `expired_cnt`: Stores the count of expired CRDS entries.
    - `evicted_cnt`: Stores the count of evicted CRDS entries.
    - `peer_staked_cnt`: Stores the count of staked peers.
    - `peer_unstaked_cnt`: Stores the count of unstaked peers.
    - `peer_visible_stake`: Stores the total visible stake of peers.
    - `peer_evicted_cnt`: Stores the count of evicted peers.
    - `purged_cnt`: Stores the count of purged CRDS entries.
    - `purged_expired_cnt`: Stores the count of purged entries due to expiration.
    - `purged_evicted_cnt`: Stores the count of purged entries due to eviction.
- **Description**: The `fd_crds_metrics` structure is used to track various metrics related to CRDS (Cluster Replicated Data Store) entries and peer nodes. It includes counts for different types of CRDS values, such as expired and evicted entries, as well as metrics related to peer nodes, including counts of staked and unstaked peers, and their visible stakes. Additionally, it tracks the number of purged entries, distinguishing between those purged due to expiration and eviction.


---
### fd\_crds\_metrics\_t
- **Type**: ``struct``
- **Members**:
    - `count`: An array of unsigned long integers representing counts for different CRDS metrics.
    - `expired_cnt`: An unsigned long integer representing the count of expired CRDS entries.
    - `evicted_cnt`: An unsigned long integer representing the count of evicted CRDS entries.
    - `peer_staked_cnt`: An unsigned long integer representing the count of staked peers.
    - `peer_unstaked_cnt`: An unsigned long integer representing the count of unstaked peers.
    - `peer_visible_stake`: An unsigned long integer representing the visible stake of peers.
    - `peer_evicted_cnt`: An unsigned long integer representing the count of evicted peers.
    - `purged_cnt`: An unsigned long integer representing the count of purged CRDS entries.
    - `purged_expired_cnt`: An unsigned long integer representing the count of purged expired CRDS entries.
    - `purged_evicted_cnt`: An unsigned long integer representing the count of purged evicted CRDS entries.
- **Description**: The `fd_crds_metrics` structure holds various metrics related to the CRDS (Contact Replicated Data Store) system, including counts of different types of entries such as expired, evicted, and purged entries, as well as metrics related to peer nodes, such as the number of staked and unstaked peers and their visible stake.


# Function Declarations (Public API)

---
### fd\_crds\_align<!-- {{#callable_declaration:fd_crds_align}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L45>)

Returns the alignment requirement for CRDS structures.
- **Description**: Use this function to obtain the alignment requirement for CRDS structures in memory. This is useful when allocating memory for CRDS structures to ensure proper alignment, which can be important for performance and correctness on some architectures. The function does not require any parameters and can be called at any time.
- **Inputs**: None
- **Output**: Returns an unsigned long integer representing the alignment requirement.
- **See Also**: [`fd_crds_align`](<fd_crds.c.md#fd_crds_align>)  (Implementation)


---
### fd\_crds\_footprint<!-- {{#callable_declaration:fd_crds_footprint}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L50>)

Calculates the memory footprint required for CRDS structures.
- **Description**: Use this function to determine the total memory size needed to store CRDS structures, including pools, treaps, and lists, based on the maximum number of elements and purged entries. This is useful for allocating sufficient shared memory before initializing CRDS structures. Ensure that the values for `ele_max` and `purged_max` are within the expected operational limits of your application to avoid unexpected behavior.
- **Inputs**:
    - `ele_max`: Specifies the maximum number of elements that the CRDS can handle. Must be a positive integer. If the value is too large, it may lead to excessive memory allocation.
    - `purged_max`: Specifies the maximum number of purged entries that the CRDS can track. Must be a positive integer. If the value is too large, it may lead to excessive memory allocation.
- **Output**: Returns the total memory footprint in bytes as an unsigned long integer.
- **See Also**: [`fd_crds_footprint`](<fd_crds.c.md#fd_crds_footprint>)  (Implementation)


---
### fd\_crds\_new<!-- {{#callable_declaration:fd_crds_new}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L54>)

Creates a new CRDS instance in shared memory.
- **Description**: Use this function to initialize a new CRDS instance in a specified shared memory region. Ensure that the shared memory is properly aligned and that the maximum element and purged element counts are powers of two. This function requires a random number generator and a context for gossip updates. It returns a pointer to the new CRDS instance or NULL if any input validation fails.
- **Inputs**:
    - `shmem`: Pointer to the shared memory region where the CRDS instance will be created. Must not be null and must be aligned according to `fd_crds_align()`.
    - `rng`: Pointer to a random number generator. Must not be null.
    - `ele_max`: Maximum number of elements the CRDS can hold. Must be a power of two.
    - `purged_max`: Maximum number of purged elements the CRDS can track. Must be a power of two.
    - `gossip_update_out`: Pointer to a context for gossip updates. Must not be null.
- **Output**: Returns a pointer to the newly created CRDS instance, or NULL if any input validation fails.
- **See Also**: [`fd_crds_new`](<fd_crds.c.md#fd_crds_new>)  (Implementation)


---
### fd\_crds\_join<!-- {{#callable_declaration:fd_crds_join}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L61>)

Joins a shared CRDS object.
- **Description**: Use this function to obtain a pointer to a CRDS object from a shared memory region. Ensure that the shared memory pointer is not null and is aligned according to the CRDS alignment requirements. The function checks the integrity of the CRDS object by verifying a magic number. If any of these conditions are not met, the function returns null.
- **Inputs**:
    - `shcrds`: A pointer to the shared memory region containing the CRDS object. Must not be null and must be aligned to `FD_CRDS_ALIGN`. The function returns null if these conditions are not met.
- **Output**: Returns a pointer to the CRDS object if successful, or null if the input is invalid or the CRDS object is corrupted.
- **See Also**: [`fd_crds_join`](<fd_crds.c.md#fd_crds_join>)  (Implementation)


---
### fd\_crds\_advance<!-- {{#callable_declaration:fd_crds_advance}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L81>)

Performs housekeeping operations on the CRDS table.
- **Description**: Use this function as part of a gossip advance loop to maintain the CRDS table by removing stale entries and updating peer weights. It removes expired entries from the data store and publishes them as gossip updates. Additionally, it adjusts the sampling weight of peers that have not been refreshed within a specified time. This function should be called regularly to ensure the CRDS table remains current and efficient. It is important to note that during the initial bootstrapping phase, when no staked nodes are observed, entries do not expire.
- **Inputs**:
    - `crds`: A pointer to the `fd_crds_t` structure representing the CRDS table. Must not be null.
    - `now`: A long integer representing the current time. Used to determine expiration and refresh intervals.
    - `stem`: A pointer to the `fd_stem_context_t` structure used for publishing gossip updates. Must not be null.
- **Output**: None
- **See Also**: [`fd_crds_advance`](<fd_crds.c.md#fd_crds_advance>)  (Implementation)


---
### fd\_crds\_len<!-- {{#callable_declaration:fd_crds_len}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L90>)

Returns the number of entries in the CRDS table.
- **Description**: Use this function to get the count of current entries in the CRDS table, excluding any purged entries. This function is useful for monitoring the size of the active CRDS table and should be called when you need to know how many entries are currently being tracked. Ensure that the CRDS table is properly initialized and joined before calling this function.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. Must not be null. The caller retains ownership of the pointer.
- **Output**: Returns an unsigned long integer representing the number of entries in the CRDS table, excluding purged entries.
- **See Also**: [`fd_crds_len`](<fd_crds.c.md#fd_crds_len>)  (Implementation)


---
### fd\_crds\_purged\_len<!-- {{#callable_declaration:fd_crds_purged_len}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L117>)

Returns the number of purged entries in the CRDS table.
- **Description**: Use this function to get the count of entries that have been purged from the CRDS table. Purged entries are those that have been overridden by newer entries or have expired. This function is useful for monitoring the size of the purged entries queue, which helps in managing memory and understanding the state of the CRDS system. Ensure that the `crds` parameter is a valid pointer to a `fd_crds_t` structure.
- **Inputs**:
    - `crds`: A pointer to a `fd_crds_t` structure representing the CRDS table. Must not be null. The function will not modify the data pointed to by this parameter.
- **Output**: Returns an `ulong` representing the number of purged entries in the CRDS table.
- **See Also**: [`fd_crds_purged_len`](<fd_crds.c.md#fd_crds_purged_len>)  (Implementation)


---
### fd\_crds\_generate\_hash<!-- {{#callable_declaration:fd_crds_generate_hash}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L120>)

Generates a SHA-256 hash from a CRDS value.
- **Description**: Use this function to compute a SHA-256 hash of a given CRDS value. This function requires an initialized SHA-256 context and a buffer to store the resulting hash. It is important to ensure that the output buffer is at least 32 bytes in size to accommodate the hash. This function does not handle null pointers, so ensure all pointers are valid before calling.
- **Inputs**:
    - `sha`: A pointer to an initialized `fd_sha256_t` structure. Must not be null. The caller is responsible for initializing this context before calling.
    - `crds_value`: A pointer to the CRDS value data to hash. Must not be null. The caller retains ownership of the data.
    - `crds_value_sz`: The size of the CRDS value data in bytes. Must be a valid size for the data pointed to by `crds_value`.
    - `out_hash`: A pointer to a buffer where the resulting 32-byte hash will be stored. Must not be null and must have space for at least 32 bytes.
- **Output**: None
- **See Also**: [`fd_crds_generate_hash`](<fd_crds.c.md#fd_crds_generate_hash>)  (Implementation)


---
### fd\_crds\_insert\_failed\_insert<!-- {{#callable_declaration:fd_crds_insert_failed_insert}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L126>)

Records a failed CRDS insert attempt.
- **Description**: Use this function to record a CRDS entry that failed to insert into the main table, either because it was too old or did not meet the criteria for insertion. This function manages the purged entries by either acquiring a new entry from the pool or evicting the oldest entry if the pool is full. It updates the metrics if they are available. Ensure that the `crds` structure is properly initialized before calling this function.
- **Inputs**:
    - `crds`: A pointer to an `fd_crds_t` structure representing the CRDS table. Must not be null and should be initialized before use.
    - `hash`: A pointer to a 32-byte array representing the hash of the CRDS entry. Must not be null.
    - `now`: A long integer representing the current time. Used to timestamp the failed insert.
- **Output**: None
- **See Also**: [`fd_crds_insert_failed_insert`](<fd_crds.c.md#fd_crds_insert_failed_insert>)  (Implementation)


---
### fd\_crds\_checks\_fast<!-- {{#callable_declaration:fd_crds_checks_fast}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L151>)

Checks if a CRDS value can be inserted based on fast conditions.
- **Description**: Use this function to quickly determine if a CRDS value can be inserted into the CRDS table without performing exhaustive checks. It is useful for avoiding expensive operations if the value fails initial conditions. The function updates the purged table based on the checks that fail. It is not idempotent, as it tracks duplicate counts in the CRDS table. Call this function before attempting a full insertion to save resources.
- **Inputs**:
    - `crds`: A pointer to an `fd_crds_t` structure representing the CRDS table. Must not be null.
    - `candidate`: A pointer to a `fd_gossip_view_crds_value_t` structure representing the candidate CRDS value. Must not be null.
    - `payload`: A pointer to an array of unsigned characters representing the payload data. Must not be null.
    - `from_push_msg`: An unsigned character indicating if the candidate is from a push message. Non-zero for true, zero for false.
- **Output**: Returns `FD_CRDS_UPSERT_CHECK_UPSERTS` if the value passes fast checks, a positive integer indicating the number of duplicates if the value is a duplicate, or `FD_CRDS_UPSERT_CHECK_FAILS` for other failures. The function may also update the purged table.
- **See Also**: [`fd_crds_checks_fast`](<fd_crds.c.md#fd_crds_checks_fast>)  (Implementation)


---
### fd\_crds\_insert<!-- {{#callable_declaration:fd_crds_insert}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L176>)

Inserts and indexes a CRDS value into the data store.
- **Description**: Use this function to add a CRDS value to the data store, ensuring it can be queried in the future. It should only be called if the result of `fd_crds_checks_fast` is `FD_CRDS_UPSERT_CHECK_UPSERTS`. The function also updates related structures if the entry is a ContactInfo, and manages peer samplers based on the entry's origin. The function returns a pointer to the newly created CRDS entry, which remains valid until the next call to `fd_crds_insert` or `fd_crds_expire`. If the insertion fails, it returns NULL.
- **Inputs**:
    - `crds`: A pointer to the CRDS data structure where the value will be inserted. Must not be null.
    - `candidate_view`: A pointer to the candidate CRDS value to insert. Must not be null.
    - `payload`: A pointer to the payload data associated with the CRDS value. Must not be null.
    - `origin_stake`: The stake associated with the origin of the CRDS value. Must be a valid unsigned long value.
    - `is_from_me`: A flag indicating if the CRDS entry originates from this node. Must be 0 or 1.
    - `now`: The current time in nanoseconds. Must be a valid long value.
    - `stem`: A pointer to the stem context used for publishing updates. Must not be null.
- **Output**: Returns a pointer to the newly created CRDS entry, or NULL if the insertion fails.
- **See Also**: [`fd_crds_insert`](<fd_crds.c.md#fd_crds_insert>)  (Implementation)


---
### fd\_crds\_has\_staked\_node<!-- {{#callable_declaration:fd_crds_has_staked_node}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L189>)

Checks if any node in the cluster has stake.
- **Description**: Use this function to determine if any node in the cluster is observed to have stake. This information is important for timeout calculations, as the system defaults to an extended expiry window when no staked peers are observed. Call this function when you need to check the presence of staked nodes in the cluster.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure. Must not be null. Represents the CRDS data structure to check for staked nodes.
- **Output**: Returns a non-zero integer if any node in the cluster has stake, otherwise returns zero.
- **See Also**: [`fd_crds_has_staked_node`](<fd_crds.c.md#fd_crds_has_staked_node>)  (Implementation)


---
### fd\_crds\_entry\_value<!-- {{#callable_declaration:fd_crds_entry_value}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L192>)

Retrieves the value bytes and size from a CRDS entry.
- **Description**: Use this function to obtain the value bytes and their size from a given CRDS entry. This function is useful when you need to access the data stored in a CRDS entry. Ensure that the `entry` parameter is not null before calling this function, as it directly dereferences the entry to retrieve the data.
- **Inputs**:
    - `entry`: A pointer to a `fd_crds_entry_t` structure. Must not be null, as the function dereferences this pointer to access the entry's data.
    - `value_bytes`: A pointer to a `uchar const *` where the function will store the address of the entry's value bytes. Must not be null.
    - `value_sz`: A pointer to a `ulong` where the function will store the size of the entry's value bytes. Must not be null.
- **Output**: None
- **See Also**: [`fd_crds_entry_value`](<fd_crds.c.md#fd_crds_entry_value>)  (Implementation)


---
### fd\_crds\_entry\_hash<!-- {{#callable_declaration:fd_crds_entry_hash}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L202>)

Returns a pointer to the hash of a CRDS entry's value.
- **Description**: Use this function to obtain a pointer to the 32-byte SHA-256 hash of a CRDS entry's value. This hash is useful for constructing a bloom filter or for other operations that require a unique identifier for the entry's value. Ensure that the `entry` parameter is a valid pointer to a `fd_crds_entry_t` structure before calling this function.
- **Inputs**:
    - `entry`: A pointer to a `fd_crds_entry_t` structure. Must not be null. The function does not modify the entry, and the caller retains ownership.
- **Output**: A pointer to a 32-byte SHA-256 hash of the entry's value.
- **See Also**: [`fd_crds_entry_hash`](<fd_crds.c.md#fd_crds_entry_hash>)  (Implementation)


---
### fd\_crds\_entry\_is\_contact\_info<!-- {{#callable_declaration:fd_crds_entry_is_contact_info}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L208>)

Checks if a CRDS entry contains contact information.
- **Description**: Use this function to determine if a given CRDS entry holds a Contact Info value. This is useful when you need to verify the type of data stored in a CRDS entry. Ensure that the entry is properly populated before calling this function.
- **Inputs**:
    - `entry`: A pointer to a `fd_crds_entry_t` structure. Must not be null. The function assumes the entry is populated with valid data.
- **Output**: Returns 1 if the entry contains a Contact Info value, otherwise returns 0.
- **See Also**: [`fd_crds_entry_is_contact_info`](<fd_crds.c.md#fd_crds_entry_is_contact_info>)  (Implementation)


---
### fd\_crds\_entry\_contact\_info<!-- {{#callable_declaration:fd_crds_entry_contact_info}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L218>)

Returns a pointer to the contact info structure in the entry.
- **Description**: Use this function to access the contact information fields of a CRDS entry, such as the public key, shred version, and socket address. Ensure that the CRDS entry is a contact info type before calling this function, which can be verified using `fd_crds_entry_is_contact_info`. This function is useful when you need to retrieve or manipulate the contact information associated with a CRDS entry.
- **Inputs**:
    - `entry`: A pointer to a `fd_crds_entry_t` structure. This must not be null and must point to a valid CRDS entry that is confirmed to be a contact info type.
- **Output**: A pointer to an `fd_contact_info_t` structure containing the contact information of the entry. The caller must ensure the entry is of the correct type before using this pointer.
- **See Also**: [`fd_crds_entry_contact_info`](<fd_crds.c.md#fd_crds_entry_contact_info>)  (Implementation)


---
### fd\_crds\_contact\_info\_lookup<!-- {{#callable_declaration:fd_crds_contact_info_lookup}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L228>)

Finds the contact information for a given public key.
- **Description**: Use this function to retrieve the contact information associated with a specific public key from the CRDS table. This function is useful when you need to access the contact details of a peer identified by its public key. Ensure that the CRDS table is properly initialized and populated before calling this function. If the public key does not correspond to any entry in the CRDS table, the function returns NULL.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. Must not be null.
    - `pubkey`: A pointer to a constant unsigned character array representing the public key. Must not be null and should point to a valid public key.
- **Output**: Returns a pointer to a constant `fd_contact_info_t` structure containing the contact information if found, or NULL if no matching entry exists.
- **See Also**: [`fd_crds_contact_info_lookup`](<fd_crds.c.md#fd_crds_contact_info_lookup>)  (Implementation)


---
### fd\_crds\_peer\_count<!-- {{#callable_declaration:fd_crds_peer_count}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L235>)

Returns the number of Contact Info entries in the CRDS table.
- **Description**: Use this function to get the count of active Contact Info entries in the CRDS table. This count reflects the number of peers currently tracked by the system. The function is useful for monitoring and managing the state of the network. Ensure that the `crds` parameter is a valid pointer to an initialized `fd_crds_t` structure before calling this function.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure. This must not be null and should point to a valid CRDS table instance.
- **Output**: Returns an unsigned long integer representing the number of Contact Info entries in the CRDS table.
- **See Also**: [`fd_crds_peer_count`](<fd_crds.c.md#fd_crds_peer_count>)  (Implementation)


---
### fd\_crds\_peer\_active<!-- {{#callable_declaration:fd_crds_peer_active}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L244>)

Marks a peer as active in the CRDS table.
- **Description**: Use this function to update the active status of a peer in the CRDS table. This function is typically used when a peer's status changes, such as after a successful ping. Ensure that the `crds` structure is properly initialized before calling this function. The function does not return a value and does not handle invalid input explicitly, so ensure that the `peer_pubkey` is valid and corresponds to an existing peer in the CRDS table.
- **Inputs**:
    - `crds`: A pointer to an `fd_crds_t` structure representing the CRDS table. Must not be null and must be initialized before use.
    - `peer_pubkey`: A pointer to a constant unsigned character array representing the public key of the peer. Must not be null and should correspond to a valid peer in the CRDS table.
    - `now`: A long integer representing the current time. Used to timestamp the status update.
- **Output**: None
- **See Also**: [`fd_crds_peer_active`](<fd_crds.c.md#fd_crds_peer_active>)  (Implementation)


---
### fd\_crds\_peer\_inactive<!-- {{#callable_declaration:fd_crds_peer_inactive}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L249>)

Marks a peer as inactive in the CRDS table.
- **Description**: Use this function to update the status of a peer to inactive within the CRDS table. This is typically done when a peer is no longer responsive or has failed to meet certain activity criteria. The function should be called with the current time to ensure accurate status tracking. It is important to ensure that the CRDS table is properly initialized before calling this function.
- **Inputs**:
    - `crds`: A pointer to an `fd_crds_t` structure representing the CRDS table. Must not be null.
    - `peer_pubkey`: A pointer to a constant unsigned character array representing the public key of the peer. Must not be null.
    - `now`: A long integer representing the current time. Used to timestamp the status change.
- **Output**: None
- **See Also**: [`fd_crds_peer_inactive`](<fd_crds.c.md#fd_crds_peer_inactive>)  (Implementation)


---
### fd\_crds\_bucket\_sample\_and\_remove<!-- {{#callable_declaration:fd_crds_bucket_sample_and_remove}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L262>)

Samples and removes a contact info entry from a specified bucket.
- **Description**: Use this function to randomly select and remove a contact info entry from a specified bucket within the CRDS structure. This operation is useful when you need to temporarily exclude a peer from future sampling until it is explicitly added back. Ensure that the CRDS structure is properly initialized and that the specified bucket index is valid. The function will return a pointer to the contact info of the sampled entry or NULL if no valid entry is available for sampling.
- **Inputs**:
    - `crds`: A pointer to an initialized `fd_crds_t` structure. Must not be null. The caller retains ownership.
    - `rng`: A pointer to an `fd_rng_t` structure used for random number generation. Must not be null. The caller retains ownership.
    - `bucket`: An unsigned long representing the index of the bucket to sample from. Must be within the valid range of bucket indices in the CRDS structure.
- **Output**: Returns a pointer to an `fd_contact_info_t` structure if a contact info entry is successfully sampled and removed. Returns NULL if no valid entry is available for sampling.
- **See Also**: [`fd_crds_bucket_sample_and_remove`](<fd_crds.c.md#fd_crds_bucket_sample_and_remove>)  (Implementation)


---
### fd\_crds\_bucket\_add<!-- {{#callable_declaration:fd_crds_bucket_add}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L269>)

Adds a peer back to a specified bucket in the CRDS.
- **Description**: Use this function to re-add a peer to a specific bucket in the CRDS after it has been previously sampled and removed. This function is typically used in scenarios where the peer needs to be reintroduced into the sampling process. Ensure that the `crds` structure is properly initialized and that the `bucket` index is within the valid range of available buckets. The `pubkey` must correspond to a valid peer entry in the CRDS.
- **Inputs**:
    - `crds`: A pointer to an initialized `fd_crds_t` structure. Must not be null.
    - `bucket`: An unsigned long representing the index of the bucket. Must be within the valid range of buckets.
    - `pubkey`: A pointer to a constant unsigned char array representing the public key of the peer. Must not be null and must correspond to a valid peer entry in the CRDS.
- **Output**: None
- **See Also**: [`fd_crds_bucket_add`](<fd_crds.c.md#fd_crds_bucket_add>)  (Implementation)


---
### fd\_crds\_peer\_sample<!-- {{#callable_declaration:fd_crds_peer_sample}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L292>)

Selects a random peer node from the CRDS.
- **Description**: Use this function to randomly select a peer node from the CRDS, weighted by stake. It excludes peers that have not been refreshed in over 60 seconds, peers with no ContactInfo, the current node, low stake peers not active in the ping tracker, and peers with different shred versions or invalid gossip socket addresses. If no valid peer is found, the function returns NULL. This function is useful for selecting a peer for sending a gossip pull request.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS from which to sample a peer. Must not be null.
    - `rng`: A pointer to an `fd_rng_t` structure used for random number generation. Must not be null.
- **Output**: Returns a pointer to a constant `fd_contact_info_t` structure representing the selected peer's contact info, or NULL if no valid peer is found.
- **See Also**: [`fd_crds_peer_sample`](<fd_crds.c.md#fd_crds_peer_sample>)  (Implementation)


---
### fd\_crds\_mask\_iter\_init<!-- {{#callable_declaration:fd_crds_mask_iter_init}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L311>)

Initializes an iterator for CRDS values matching a specified mask.
- **Description**: Use this function to create an iterator that traverses CRDS values in a table whose hashes match a given mask. This is useful in scenarios where you need to filter CRDS values based on specific hash criteria. Ensure that the `iter_mem` array has a size of at least 16 bytes to store the iterator state. The function sets up the iterator to start at the first matching hash value, based on the provided mask and mask bits.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table to iterate over. Must not be null.
    - `mask`: An unsigned long integer representing the mask to apply to the CRDS value hashes.
    - `mask_bits`: An unsigned integer specifying the number of significant bits in the mask. Must be greater than 0 for the mask to be applied.
    - `iter_mem`: An array of unsigned characters with a minimum size of 16 bytes. Used to store the iterator state. The caller retains ownership.
- **Output**: Returns a pointer to an `fd_crds_mask_iter_t` structure initialized to iterate over the specified CRDS values.
- **See Also**: [`fd_crds_mask_iter_init`](<fd_crds.c.md#fd_crds_mask_iter_init>)  (Implementation)


---
### fd\_crds\_mask\_iter\_next<!-- {{#callable_declaration:fd_crds_mask_iter_next}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L317>)

Advances the iterator to the next CRDS entry.
- **Description**: Use this function to move the iterator to the next entry in the CRDS table that matches the specified mask. This function is part of an iteration process and should be called after initializing the iterator with `fd_crds_mask_iter_init`. It updates the iterator to point to the next entry, allowing sequential access to entries in the CRDS table. Ensure that the iterator is valid and initialized before calling this function.
- **Inputs**:
    - `it`: A pointer to an `fd_crds_mask_iter_t` structure. This must be a valid iterator initialized by `fd_crds_mask_iter_init`. The function updates this iterator to point to the next entry.
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. This must not be null and should be the same CRDS table used to initialize the iterator.
- **Output**: Returns a pointer to the updated `fd_crds_mask_iter_t` structure, which now points to the next entry in the CRDS table.
- **See Also**: [`fd_crds_mask_iter_next`](<fd_crds.c.md#fd_crds_mask_iter_next>)  (Implementation)


---
### fd\_crds\_mask\_iter\_done<!-- {{#callable_declaration:fd_crds_mask_iter_done}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L321>)

Checks if the CRDS mask iterator has completed.
- **Description**: Use this function to determine if the iteration over CRDS values that match a specific mask is complete. It is typically called after initializing and repeatedly calling the next function in the iteration sequence. Ensure that the iterator and CRDS table are properly initialized before calling this function.
- **Inputs**:
    - ``it``: A pointer to an `fd_crds_mask_iter_t` structure representing the current state of the iteration. Must not be null.
    - ``crds``: A pointer to a constant `fd_crds_t` structure representing the CRDS table being iterated over. Must not be null.
- **Output**: Returns a non-zero value if the iteration is complete, otherwise returns zero.
- **See Also**: [`fd_crds_mask_iter_done`](<fd_crds.c.md#fd_crds_mask_iter_done>)  (Implementation)


---
### fd\_crds\_mask\_iter\_entry<!-- {{#callable_declaration:fd_crds_mask_iter_entry}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L325>)

Retrieves the current CRDS entry from the iterator.
- **Description**: Use this function to obtain the current entry from a CRDS mask iterator. It is typically called after initializing or advancing the iterator with `fd_crds_mask_iter_init` or `fd_crds_mask_iter_next`. Ensure that the iterator is valid and not done before calling this function to avoid undefined behavior.
- **Inputs**:
    - `it`: A pointer to an `fd_crds_mask_iter_t` iterator. Must not be null and should be properly initialized.
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. Must not be null.
- **Output**: Returns a pointer to the current `fd_crds_entry_t` in the iterator. The pointer is constant and should not be modified.
- **See Also**: [`fd_crds_mask_iter_entry`](<fd_crds.c.md#fd_crds_mask_iter_entry>)  (Implementation)


---
### fd\_crds\_purged\_mask\_iter\_init<!-- {{#callable_declaration:fd_crds_purged_mask_iter_init}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L335>)

Initializes an iterator for purged CRDS entries matching a mask.
- **Description**: Use this function to create an iterator that traverses purged CRDS entries whose hashes match a specified mask. This is useful for iterating over entries that have been purged or failed to insert, based on a mask applied to the most significant bits of their hash. Ensure that the `iter_mem` array is provided with a minimum size of 16 bytes. The function must be called with a valid `fd_crds_t` structure, and the `mask_bits` should be greater than zero to define a meaningful mask range.
- **Inputs**:
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. Must not be null.
    - `mask`: An unsigned long integer representing the mask to apply to the hash of CRDS entries.
    - `mask_bits`: An unsigned integer specifying the number of significant bits in the mask. Must be greater than zero for the mask to be effective.
    - `iter_mem`: A static array of unsigned characters with a minimum size of 16 bytes. Used to store the iterator state. The caller retains ownership.
- **Output**: Returns a pointer to an `fd_crds_mask_iter_t` structure initialized to iterate over purged entries matching the mask.
- **See Also**: [`fd_crds_purged_mask_iter_init`](<fd_crds.c.md#fd_crds_purged_mask_iter_init>)  (Implementation)


---
### fd\_crds\_purged\_mask\_iter\_next<!-- {{#callable_declaration:fd_crds_purged_mask_iter_next}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L341>)

Advances the iterator to the next purged entry.
- **Description**: Use this function to move the iterator to the next entry in the purged CRDS table. This function is part of the iteration process over purged entries, which includes both purged and failed inserts. It must be called after initializing the iterator with `fd_crds_purged_mask_iter_init`. The function updates the iterator to point to the next entry, allowing sequential access to purged entries.
- **Inputs**:
    - `it`: A pointer to an `fd_crds_mask_iter_t` structure. This must be a valid iterator initialized with `fd_crds_purged_mask_iter_init`. The function updates this iterator to point to the next purged entry.
    - `crds`: A pointer to a constant `fd_crds_t` structure. This represents the CRDS table containing the purged entries. The function uses this to access the purged entries.
- **Output**: Returns the updated iterator pointing to the next purged entry. The iterator is modified in place.
- **See Also**: [`fd_crds_purged_mask_iter_next`](<fd_crds.c.md#fd_crds_purged_mask_iter_next>)  (Implementation)


---
### fd\_crds\_purged\_mask\_iter\_done<!-- {{#callable_declaration:fd_crds_purged_mask_iter_done}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L345>)

Checks if the purged mask iterator has completed.
- **Description**: Use this function to determine if the iteration over purged CRDS entries has finished. It is typically called after initializing and iterating through a purged mask iterator. The function checks if the iterator has reached the end of the purged entries or if the current entry's hash is beyond the specified end hash. This function is part of the iteration process and should be used in conjunction with other iterator functions to traverse purged entries.
- **Inputs**:
    - `it`: A pointer to an `fd_crds_mask_iter_t` structure representing the current state of the purged mask iterator. Must not be null.
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. Must not be null.
- **Output**: Returns a non-zero integer if the iteration is complete, otherwise returns zero.
- **See Also**: [`fd_crds_purged_mask_iter_done`](<fd_crds.c.md#fd_crds_purged_mask_iter_done>)  (Implementation)


---
### fd\_crds\_purged\_mask\_iter\_hash<!-- {{#callable_declaration:fd_crds_purged_mask_iter_hash}} -->
[View Source →](<../../../../../../src/flamenco/gossip/crds/fd_crds.h#L351>)

Returns the hash of the current entry in the purged mask iterator.
- **Description**: Use this function to obtain the hash of the current entry when iterating over purged CRDS entries using a mask iterator. This function is part of the purged mask iterator API and should be used after initializing and advancing the iterator with the appropriate functions. Ensure that the iterator is valid and points to a current entry before calling this function.
- **Inputs**:
    - `it`: A pointer to an `fd_crds_mask_iter_t` structure representing the current state of the purged mask iterator. Must not be null and should be properly initialized and advanced using the purged mask iterator API.
    - `crds`: A pointer to a constant `fd_crds_t` structure representing the CRDS table. Must not be null and should be the same CRDS table used to initialize the iterator.
- **Output**: A pointer to an unsigned char array representing the hash of the current entry in the purged mask iterator.
- **See Also**: [`fd_crds_purged_mask_iter_hash`](<fd_crds.c.md#fd_crds_purged_mask_iter_hash>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)