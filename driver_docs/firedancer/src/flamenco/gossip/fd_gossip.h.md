<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for implementing the Solana gossip protocol, including functions for node communication and metrics tracking.

# Purpose
The code is a C header file that defines the interface for a gossip protocol implementation used in a distributed network, specifically for the Solana blockchain. The gossip protocol facilitates the sharing of key-value pairs among distributed nodes to achieve eventual consistency. The file includes type definitions, function prototypes, and data structures necessary for implementing the gossip protocol. It defines the `fd_gossip_t` structure, which represents the gossip protocol's internal state, and the `fd_gossip_metrics_t` structure, which is used to track various metrics related to the protocol's operation.

The header file provides function prototypes for initializing and managing the gossip protocol, such as [`fd_gossip_new`](<#fd_gossip_new>), [`fd_gossip_join`](<#fd_gossip_join>), and [`fd_gossip_advance`](<#fd_gossip_advance>). It also includes functions for handling incoming and outgoing messages ([`fd_gossip_rx`](<#fd_gossip_rx>) and `fd_gossip_tx`), updating contact information ([`fd_gossip_set_my_contact_info`](<#fd_gossip_set_my_contact_info>)), and tracking peer activity ([`fd_gossip_ping_tracker_track`](<#fd_gossip_ping_tracker_track>)). The file outlines the protocol's key operations, such as joining a cluster, broadcasting updates, and maintaining consistency through pull requests and prune messages. The protocol is designed to be peer-to-peer and includes mechanisms to prevent DDoS attacks and manage network participation based on node stakes.
# Imports and Dependencies

---
- `fd_gossip_types.h`
- `fd_gossip_out.h`
- `fd_ping_tracker.h`
- `crds/fd_crds.h`
- `../../disco/metrics/fd_metrics.h`
- `../../util/rng/fd_rng.h`
- `../../util/net/fd_net_headers.h`


# Data Structures

---
### fd\_gossip\_t
- **Type**: ``struct``
- **Members**:
    - ``fd_gossip_private``: A forward declaration for the private structure that defines the internal details of `fd_gossip_t`.
- **Description**: `fd_gossip_t` is a typedef for a forward-declared structure `fd_gossip_private`, which encapsulates the internal state and operations of the Solana gossip protocol. This protocol enables distributed nodes to share key-value pairs and reach consensus on the contents of a key-value store. The structure is part of a system that manages node communication, message propagation, and network consistency through various operations such as joining the network, sending and receiving messages, and maintaining peer connections.


---
### fd\_gossip\_metrics
- **Type**: ``struct``
- **Members**:
    - `crds_rx_count`: An array that counts received CRDS messages for each outcome defined by `FD_METRICS_ENUM_GOSSIP_CRDS_OUTCOME_CNT`.
    - `message_tx`: An array that counts transmitted messages for each type defined by `FD_METRICS_ENUM_GOSSIP_MESSAGE_CNT`.
    - `message_tx_bytes`: An array that counts the bytes of transmitted messages for each type defined by `FD_METRICS_ENUM_GOSSIP_MESSAGE_CNT`.
    - `crds_tx_push`: An array that counts CRDS push messages transmitted for each value defined by `FD_METRICS_ENUM_CRDS_VALUE_CNT`.
    - `crds_tx_push_bytes`: An array that counts the bytes of CRDS push messages transmitted for each value defined by `FD_METRICS_ENUM_CRDS_VALUE_CNT`.
    - `crds_tx_pull_response`: An array that counts CRDS pull response messages transmitted for each value defined by `FD_METRICS_ENUM_CRDS_VALUE_CNT`.
    - `crds_tx_pull_response_bytes`: An array that counts the bytes of CRDS pull response messages transmitted for each value defined by `FD_METRICS_ENUM_CRDS_VALUE_CNT`.
    - `ci_rx_unrecognized_socket_tag_cnt`: Counts the number of received messages with unrecognized socket tags.
    - `ci_rx_ipv6_address_cnt`: Counts the number of received messages with IPv6 addresses.
- **Description**: The `fd_gossip_metrics` structure is used to track various metrics related to the Solana gossip protocol. It includes arrays for counting received and transmitted CRDS messages, message types, and their respective byte sizes. Additionally, it tracks counts of unrecognized socket tags and IPv6 addresses in received messages. This structure helps in monitoring and analyzing the performance and behavior of the gossip protocol.


---
### fd\_gossip\_metrics\_t
- **Type**: ``struct``
- **Members**:
    - ``crds_rx_count``: An array that counts received CRDS messages by outcome.
    - ``message_tx``: An array that counts transmitted messages by type.
    - ``message_tx_bytes``: An array that counts transmitted message bytes by type.
    - ``crds_tx_push``: An array that counts CRDS push messages by value type.
    - ``crds_tx_push_bytes``: An array that counts bytes of CRDS push messages by value type.
    - ``crds_tx_pull_response``: An array that counts CRDS pull response messages by value type.
    - ``crds_tx_pull_response_bytes``: An array that counts bytes of CRDS pull response messages by value type.
    - ``ci_rx_unrecognized_socket_tag_cnt``: Counts received messages with unrecognized socket tags.
    - ``ci_rx_ipv6_address_cnt``: Counts received messages with IPv6 addresses.
- **Description**: The `fd_gossip_metrics_t` structure is used to track various metrics related to the Solana gossip protocol, including counts of received and transmitted messages, both in terms of number and size, as well as specific counts for CRDS messages and contact information messages. This structure helps in monitoring and analyzing the performance and behavior of the gossip protocol in a distributed network.


# Function Declarations (Public API)

---
### fd\_gossip\_align<!-- {{#callable_declaration:fd_gossip_align}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L91>)

Returns the required memory alignment for gossip structures.
- **Description**: Use this function to obtain the memory alignment requirement for gossip-related structures. This alignment value is necessary when allocating memory for these structures to ensure proper access and performance. It is a constant value and does not depend on any input parameters or state.
- **Inputs**: None
- **Output**: Returns an unsigned long integer representing the alignment requirement, which is 128.
- **See Also**: [`fd_gossip_align`](<fd_gossip.c.md#fd_gossip_align>)  (Implementation)


---
### fd\_gossip\_footprint<!-- {{#callable_declaration:fd_gossip_footprint}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L96>)

Calculates the memory footprint required for a gossip instance.
- **Description**: Use this function to determine the amount of memory needed to allocate for a gossip instance based on the maximum number of values and the length of entrypoints. This is useful for memory allocation planning before initializing a gossip instance. Ensure that the values for `max_values` and `entrypoints_len` are within the expected operational limits of the application to avoid incorrect memory calculations.
- **Inputs**:
    - `max_values`: Specifies the maximum number of values the gossip instance will handle. Must be a non-negative integer. Invalid values may result in incorrect memory footprint calculations.
    - `entrypoints_len`: Indicates the number of entrypoints for the gossip instance. Must be a non-negative integer. Invalid values may result in incorrect memory footprint calculations.
- **Output**: Returns the calculated memory footprint in bytes as an unsigned long integer.
- **See Also**: [`fd_gossip_footprint`](<fd_gossip.c.md#fd_gossip_footprint>)  (Implementation)


---
### fd\_gossip\_new<!-- {{#callable_declaration:fd_gossip_new}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L100>)

Creates a new gossip protocol instance in shared memory.
- **Description**: Use this function to initialize a new instance of the gossip protocol in a specified shared memory region. This function requires a pre-allocated and properly aligned shared memory block. It sets up the gossip protocol with specified parameters, including entry points, contact information, and function callbacks for sending and signing messages. Ensure that the `max_values` parameter is a power of two and that the number of entry points does not exceed 16. The function returns a pointer to the initialized gossip instance or `NULL` if any preconditions are not met.
- **Inputs**:
    - `shmem`: Pointer to the shared memory region where the gossip instance will be created. Must not be null and must be aligned according to `fd_gossip_align()`.
    - `rng`: Pointer to a random number generator state. Must not be null.
    - `max_values`: Maximum number of values the gossip protocol can handle. Must be a power of two.
    - `entrypoints_len`: Number of entry points provided. Must be between 0 and 16 inclusive.
    - `entrypoints`: Pointer to an array of entry points. The array must have at least `entrypoints_len` elements.
    - `my_contact_info`: Pointer to the contact information of the current node. Must not be null.
    - `now`: Current time in nanoseconds. Used for initializing timers.
    - `send_fn`: Function pointer for sending messages. Must not be null.
    - `send_ctx`: Context for the send function. Can be null if not needed.
    - `sign_fn`: Function pointer for signing messages. Must not be null.
    - `sign_ctx`: Context for the sign function. Can be null if not needed.
    - `ping_tracker_change_fn`: Function pointer for handling changes in the ping tracker. Must not be null.
    - `ping_tracker_change_fn_ctx`: Context for the ping tracker change function. Can be null if not needed.
    - `gossip_update_out`: Pointer to a context for gossip updates. Must not be null.
    - `gossip_net_out`: Pointer to a context for network updates. Must not be null.
- **Output**: Returns a pointer to the initialized gossip instance or `NULL` if initialization fails due to invalid input or precondition violations.
- **See Also**: [`fd_gossip_new`](<fd_gossip.c.md#fd_gossip_new>)  (Implementation)


---
### fd\_gossip\_join<!-- {{#callable_declaration:fd_gossip_join}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L117>)

Joins a gossip protocol instance using shared memory.
- **Description**: Use this function to join an existing gossip protocol instance by providing a pointer to shared memory. This function checks if the provided pointer is non-null and properly aligned according to the required alignment for `fd_gossip_t`. If these conditions are not met, the function logs a warning and returns `NULL`. Ensure that the shared memory is correctly initialized and aligned before calling this function.
- **Inputs**:
    - `shgossip`: A pointer to shared memory that represents a gossip protocol instance. Must not be null and must be aligned according to `fd_gossip_align()`. If these conditions are not met, the function returns `NULL`.
- **Output**: Returns a pointer to `fd_gossip_t` if successful, or `NULL` if the input is invalid.
- **See Also**: [`fd_gossip_join`](<fd_gossip.c.md#fd_gossip_join>)  (Implementation)


---
### fd\_gossip\_crds\_metrics<!-- {{#callable_declaration:fd_gossip_crds_metrics}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L123>)

Retrieves CRDS metrics from a gossip instance.
- **Description**: Use this function to obtain a constant pointer to the CRDS metrics associated with a given gossip instance. This function is useful for monitoring or logging purposes where you need to access the current state of CRDS metrics. Ensure that the `gossip` parameter is a valid pointer to an initialized `fd_gossip_t` instance before calling this function.
- **Inputs**:
    - `gossip`: A constant pointer to an `fd_gossip_t` instance. This must be a valid and initialized gossip instance. The function does not modify the `gossip` instance, and the caller retains ownership.
- **Output**: A constant pointer to an `fd_crds_metrics_t` structure containing the CRDS metrics. The caller must not modify the data pointed to by the returned pointer.
- **See Also**: [`fd_gossip_crds_metrics`](<fd_gossip.c.md#fd_gossip_crds_metrics>)  (Implementation)


---
### fd\_gossip\_ping\_tracker\_metrics<!-- {{#callable_declaration:fd_gossip_ping_tracker_metrics}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L126>)

Retrieves ping tracker metrics for a given gossip instance.
- **Description**: Use this function to obtain metrics related to the ping tracker of a specific gossip instance. This is useful for monitoring and analyzing the performance and behavior of the gossip protocol's ping tracking mechanism. Ensure that the `gossip` parameter is a valid and initialized instance of `fd_gossip_t` before calling this function.
- **Inputs**:
    - `gossip`: A pointer to a constant `fd_gossip_t` structure representing the gossip instance. This parameter must not be null and should point to a valid, initialized gossip instance.
- **Output**: A pointer to a constant `fd_ping_tracker_metrics_t` structure containing the ping tracker metrics for the specified gossip instance.
- **See Also**: [`fd_gossip_ping_tracker_metrics`](<fd_gossip.c.md#fd_gossip_ping_tracker_metrics>)  (Implementation)


---
### fd\_gossip\_set\_my\_contact\_info<!-- {{#callable_declaration:fd_gossip_set_my_contact_info}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L145>)

Updates the node's contact information in the gossip protocol.
- **Description**: Use this function to set or update the node's contact information within the gossip protocol. This is necessary for the node to communicate its identity and contact details to other nodes in the network. The function must be called with valid contact information and a current timestamp. It is important to ensure that the contact information, especially the public key, is accurate as it is used for identity verification. The function also updates the internal state to reflect the new contact information.
- **Inputs**:
    - `gossip`: A pointer to an `fd_gossip_t` structure representing the gossip protocol instance. Must not be null.
    - `contact_info`: A pointer to a constant `fd_contact_info_t` structure containing the new contact information. Must not be null and should contain valid data.
    - `now`: A long integer representing the current time in nanoseconds. Used to update the internal state with the current timestamp.
- **Output**: None
- **See Also**: [`fd_gossip_set_my_contact_info`](<fd_gossip.c.md#fd_gossip_set_my_contact_info>)  (Implementation)


---
### fd\_gossip\_stakes\_update<!-- {{#callable_declaration:fd_gossip_stakes_update}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L150>)

Updates the stake weights in the gossip structure.
- **Description**: Use this function to update the stake weights in the gossip structure with new values. This function clears the existing stake map and inserts new stake weights from the provided array. It also updates the identity stake based on the new weights. Ensure that the number of stake weights does not exceed the maximum allowed (`CRDS_MAX_CONTACT_INFO`). Call this function when you need to refresh the stake information in the gossip protocol.
- **Inputs**:
    - `gossip`: A pointer to an `fd_gossip_t` structure. Must not be null. The function updates the stake information in this structure.
    - `stake_weights`: A pointer to an array of `fd_stake_weight_t` structures. Must not be null. Contains the new stake weights to be used.
    - `stake_weights_cnt`: The number of elements in the `stake_weights` array. Must not exceed `CRDS_MAX_CONTACT_INFO`. If it does, the function logs an error and does not proceed with the update.
- **Output**: None
- **See Also**: [`fd_gossip_stakes_update`](<fd_gossip.c.md#fd_gossip_stakes_update>)  (Implementation)


---
### fd\_gossip\_advance<!-- {{#callable_declaration:fd_gossip_advance}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L184>)

Advances the gossip protocol to a specified time.
- **Description**: Use this function to progress the gossip protocol to a given time, performing necessary updates and actions. It sends pings to peers, expires old CRDS entries, flushes push messages, sends pull requests, updates contact info, and rotates the active peer set. Call this function frequently to ensure the protocol remains up-to-date and consistent.
- **Inputs**:
    - `gossip`: A pointer to an `fd_gossip_t` structure representing the gossip protocol instance. Must not be null.
    - `now`: A long integer representing the current time in nanoseconds. Used to determine when to perform specific actions.
    - `stem`: A pointer to an `fd_stem_context_t` structure used for context during operations. Must not be null.
- **Output**: None
- **See Also**: [`fd_gossip_advance`](<fd_gossip.c.md#fd_gossip_advance>)  (Implementation)


---
### fd\_gossip\_rx<!-- {{#callable_declaration:fd_gossip_rx}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L203>)

Processes an incoming gossip packet.
- **Description**: Use this function to handle incoming packets received on the gossip socket from the network. It processes the packet based on its type and updates the internal state of the gossip protocol. The function expects the packet to be a UDP packet, but it does not assume the packet is well-formed or non-malicious. The current time in nanoseconds is used to determine if the packet is stale and to update the protocol's state. This function may queue response packets for later sending, and the caller must send these responses by calling `fd_gossip_tx()`.
- **Inputs**:
    - `gossip`: A pointer to an `fd_gossip_t` structure representing the gossip protocol instance. Must not be null.
    - `peer`: An `fd_ip4_port_t` value representing the peer's IP address and port. Must be a valid address and port.
    - `data`: A pointer to a buffer containing the packet data. Must not be null and must point to a buffer of at least `data_sz` bytes.
    - `data_sz`: An `ulong` representing the size of the data buffer. Must be at least the size of `fd_gossip_view_t`.
    - `now`: A `long` representing the current time in nanoseconds. Used to check packet staleness and update protocol state.
    - `stem`: A pointer to an `fd_stem_context_t` structure used for context during processing. Must not be null.
- **Output**: None
- **See Also**: [`fd_gossip_rx`](<fd_gossip.c.md#fd_gossip_rx>)  (Implementation)


---
### fd\_gossip\_ping\_tracker\_track<!-- {{#callable_declaration:fd_gossip_ping_tracker_track}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L219>)

Marks a peer for ping tracking.
- **Description**: Use this function to track a peer for ping purposes within the gossip protocol. This is necessary when the gossip layer needs to ping a peer that might be filtered out by the gossvf layer due to inactivity. Ensure that the `gossip` object is properly initialized before calling this function. This function does not return a value and does not modify the input parameters.
- **Inputs**:
    - `gossip`: A pointer to an `fd_gossip_t` structure. Must not be null. Represents the gossip protocol instance.
    - `peer_pubkey`: A pointer to a constant unsigned character array representing the peer's public key. Must not be null.
    - `peer_address`: An `fd_ip4_port_t` value representing the peer's IP address and port. Must be a valid address.
    - `now`: A long integer representing the current time in nanoseconds. Used for timestamping the tracking action.
- **Output**: None
- **See Also**: [`fd_gossip_ping_tracker_track`](<fd_gossip.c.md#fd_gossip_ping_tracker_track>)  (Implementation)


---
### fd\_gossip\_push\_vote<!-- {{#callable_declaration:fd_gossip_push_vote}} -->
[View Source →](<../../../../../src/flamenco/gossip/fd_gossip.h#L225>)

Pushes a vote transaction into the gossip network.
- **Description**: Use this function to add a vote transaction to the gossip network for dissemination among peers. This function encodes the transaction, signs it, and checks it against the CRDS (Conflict-free Replicated Data Store) for validity. If valid, it inserts the transaction into the CRDS and the active push set. This function must be called with a valid gossip context and a properly initialized stem context. Ensure that the transaction data and size are correct, and provide the current time in nanoseconds for accurate timestamping.
- **Inputs**:
    - `gossip`: A pointer to a `fd_gossip_t` structure representing the gossip context. Must not be null.
    - `txn`: A pointer to the transaction data to be pushed. Must not be null and should point to a valid memory region of at least `txn_sz` bytes.
    - `txn_sz`: The size of the transaction data in bytes. Must be a valid size for the transaction data provided.
    - `stem`: A pointer to a `fd_stem_context_t` structure used for context during the operation. Must not be null.
    - `now`: The current time in nanoseconds. Used for timestamping the transaction.
- **Output**: Returns 0 on success, or -1 if the transaction is invalid or cannot be inserted into the CRDS.
- **See Also**: [`fd_gossip_push_vote`](<fd_gossip.c.md#fd_gossip_push_vote>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)