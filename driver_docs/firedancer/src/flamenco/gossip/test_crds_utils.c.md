<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for CRDS utilities, including functions to create and free test CRDS instances.

# Purpose
This code is a C source file that provides functions to create and manage a test instance of a CRDS (Contact Replication and Dissemination System) for testing purposes. The function [`create_test_crds_with_ci`](<#create_test_crds_with_ci>) initializes a CRDS structure with a specified number of peer entries, each containing randomly generated contact information and stake values. It uses memory allocation functions to set up the CRDS and inserts test contact information entries into it. The function [`free_test_crds`](<#free_test_crds>) is used to deallocate the memory associated with the CRDS instance. This setup is useful for testing the behavior of CRDS-related operations in a controlled environment.
# Imports and Dependencies

---
- `crds/fd_crds.h`
- `stdlib.h`


# Global Variables

---
### test\_gossip\_out\_ctx
- **Type**: ``fd_gossip_out_ctx_t``
- **Description**: A static instance of `fd_gossip_out_ctx_t` initialized to zero. It is used as a mock gossip out context for testing purposes.
- **Use**: Used in the `create_test_crds_with_ci` function to initialize a CRDS instance for testing.


# Functions

---
### create\_test\_crds\_with\_ci<!-- {{#callable:create_test_crds_with_ci}} -->
[View Source →](<../../../../../src/flamenco/gossip/test_crds_utils.c#L8>)

Creates a test CRDS (Contact Replication and Dissemination System) with contact information entries for a specified number of peers.
- **Inputs**:
    - `rng`: A pointer to a random number generator (`fd_rng_t *`) used to generate random values for the contact information.
    - `num_peers`: An unsigned long integer specifying the number of peer contact information entries to create.
- **Logic and Control Flow**:
    - Allocate memory for the CRDS using `aligned_alloc` with alignment and footprint determined by [`fd_crds_align`](<crds/fd_crds.c.md#fd_crds_align>) and [`fd_crds_footprint`](<crds/fd_crds.c.md#fd_crds_footprint>) respectively.
    - Check if the memory allocation for `crds_mem` is successful using `FD_TEST`.
    - Create a new CRDS instance with [`fd_crds_new`](<crds/fd_crds.c.md#fd_crds_new>) and join it using [`fd_crds_join`](<crds/fd_crds.c.md#fd_crds_join>), then check if the CRDS instance is valid using `FD_TEST`.
    - Iterate over the number of peers (`num_peers`) to insert contact information entries.
    - For each peer, initialize a payload array to zero and generate a random public key using `fd_rng_uchar`.
    - Create a minimal gossip view for contact information with a tag, offsets, length, and wallclock time using `fd_log_wallclock`.
    - Set the instance creation wallclock time in the contact info view.
    - Generate a random stake value using `fd_rng_ulong_roll`.
    - Insert the contact information into the CRDS using [`fd_crds_insert`](<crds/fd_crds.c.md#fd_crds_insert>) and mark the entry as active using [`fd_crds_peer_active`](<crds/fd_crds.c.md#fd_crds_peer_active>).
- **Output**: Returns a pointer to the created `fd_crds_t` instance containing the test contact information entries.
- **Functions Called**:
    - [`fd_crds_align`](<crds/fd_crds.c.md#fd_crds_align>)
    - [`fd_crds_footprint`](<crds/fd_crds.c.md#fd_crds_footprint>)
    - [`fd_crds_join`](<crds/fd_crds.c.md#fd_crds_join>)
    - [`fd_crds_new`](<crds/fd_crds.c.md#fd_crds_new>)
    - [`fd_crds_insert`](<crds/fd_crds.c.md#fd_crds_insert>)
    - [`fd_crds_peer_active`](<crds/fd_crds.c.md#fd_crds_peer_active>)


---
### free\_test\_crds<!-- {{#callable:free_test_crds}} -->
[View Source →](<../../../../../src/flamenco/gossip/test_crds_utils.c#L52>)

Releases the memory allocated for a `fd_crds_t` object.
- **Inputs**:
    - `crds`: A pointer to a `fd_crds_t` object that needs to be freed.
- **Logic and Control Flow**:
    - Casts the `crds` pointer to a `void *` type.
    - Calls the `free` function to deallocate the memory pointed to by `crds`.
- **Output**: No return value.



---
Made with ❤️ by [Driver](https://www.driver.ai/)