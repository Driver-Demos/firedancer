<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for multi-epoch leader scheduling and stake message handling in the Firedancer codebase.

# Purpose
The code is a C test suite for validating the functionality of a multi-epoch leader scheduling system. It includes several static functions that test different aspects of the leader scheduling, such as handling staked leaders, transitions between epochs, skipping epochs, canceling operations, and maintaining order. The test suite uses a static memory buffer `mleaders_mem` to store leader scheduling data and defines constants like `SLOTS_PER_EPOCH` and `STAKE_MSG_SZ` for testing purposes. The [`generate_stake_msg`](<#generate_stake_msg>) function creates stake messages for different epochs, which are then used in various test functions to initialize and finalize leader schedules.

The main function initializes the test environment and calls each test function in sequence. These tests verify the correct behavior of the leader scheduling system by checking the allocation of leader slots across different epochs and ensuring that transitions and cancellations are handled correctly. The test suite also includes checks for edge cases, such as handling the maximum number of staked leaders and verifying the sorting of leader schedules. The code concludes by logging a success message if all tests pass and then halts the test environment.
# Imports and Dependencies

---
- `fd_multi_epoch_leaders.h`


# Global Variables

---
### mleaders\_mem
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size defined by the macro `FD_MULTI_EPOCH_LEADERS_FOOTPRINT`. The array is aligned according to the macro `FD_MULTI_EPOCH_LEADERS_ALIGN` using the `__attribute__((aligned(...)))` directive.
- **Use**: Used as a memory buffer for operations related to multi-epoch leaders in the program.


---
### stake\_msg
- **Type**: `uchar[]`
- **Description**: An array of unsigned characters with a size defined by `STAKE_MSG_SZ`, which is calculated based on the header size and the maximum number of staked leaders.
- **Use**: Used to store stake messages for different epochs in the multi-epoch leaders system.


# Functions

---
### generate\_stake\_msg<!-- {{#callable:generate_stake_msg}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L12>)

Generates a stake weight message for a given epoch and list of stakers.
- **Inputs**:
    - `_buf`: A pointer to a buffer where the stake weight message will be stored.
    - `epoch`: The epoch number for which the stake message is generated.
    - `stakers`: A string containing the list of stakers.
- **Logic and Control Flow**:
    - Cast the `_buf` to a `fd_stake_weight_msg_t` pointer using `fd_type_pun` and store it in `buf`.
    - Set the `epoch` field of `buf` to the provided `epoch` value.
    - Calculate the `start_slot` as `epoch * SLOTS_PER_EPOCH` and assign it to `buf->start_slot`.
    - Set `buf->slot_cnt` to `SLOTS_PER_EPOCH`.
    - Calculate the number of stakers using `strlen(stakers)` and assign it to `buf->staked_cnt`.
    - Initialize `buf->excluded_stake` and `buf->vote_keyed_lsched` to 0.
    - Iterate over each character in `stakers`, setting the `vote_key` and `id_key` fields of `buf->weights[i]` to the current staker character using `memset`.
    - Assign a stake value of `1000UL/(i+1UL)` to `buf->weights[i].stake` for each staker.
    - Return the `fd_stake_weight_msg_t` pointer cast from `_buf` using `fd_type_pun`.
- **Output**: A pointer to the `fd_stake_weight_msg_t` structure that contains the generated stake weight message.


---
### check\_leaders<!-- {{#callable:check_leaders}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L34>)

Validates the leader schedule for a given epoch against expected staked leaders.
- **Inputs**:
    - `mleaders`: A pointer to a `fd_multi_epoch_leaders_t` structure containing leader schedules for multiple epochs.
    - `epoch`: An unsigned long integer representing the epoch number to check.
    - `staked_leaders`: A pointer to a constant character string representing the expected staked leaders for the epoch.
- **Logic and Control Flow**:
    - Calculate `min_slot` and `max_slot` for the given `epoch` using `SLOTS_PER_EPOCH`.
    - Retrieve the leader schedule for `min_slot` using [`fd_multi_epoch_leaders_get_lsched_for_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_lsched_for_slot>).
    - If `staked_leaders` is NULL, assert that `lsched` is also NULL and return.
    - Assert that `lsched` is valid and consistent for both `min_slot` and `max_slot`.
    - Assert that there are no leaders for slots just outside the epoch range (`min_slot-1` and `max_slot+1`).
    - Initialize an array `leader_cnt` to count occurrences of each leader character from 'A' to 'Z'.
    - Iterate over each slot from `min_slot` to `max_slot`, retrieve the leader for each slot, and update `leader_cnt` based on the leader's first character.
    - Initialize `unaccounted` to the total number of slots in the epoch.
    - Iterate over each character in `staked_leaders`, assert that each character has a non-zero count in `leader_cnt`, and decrement `unaccounted` by the count of each character.
    - Assert that `unaccounted` is zero, indicating all slots are accounted for by the staked leaders.
- **Output**: No return value; the function uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_get_lsched_for_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_lsched_for_slot>)
    - [`fd_epoch_leaders_get`](<fd_leaders.h.md#fd_epoch_leaders_get>)
    - [`fd_multi_epoch_leaders_get_leader_for_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_leader_for_slot>)


---
### test\_staked\_only<!-- {{#callable:test_staked_only}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L73>)

Tests the functionality of staking messages and leader scheduling across multiple epochs.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_multi_epoch_leaders_t` object by joining a new instance created with `mleaders_mem`.
    - Generate and initialize a stake message for epoch 0 with stakers 'ABC', finalize the message, and check leaders for epoch 0.
    - Generate and initialize a stake message for epoch 1 with stakers 'ABCDE', finalize the message, and check leaders for epochs 0 and 1.
    - Generate and initialize a stake message for epoch 2 with stakers 'ABCF', finalize the message, and check leaders for epochs 2 and 1.
    - Generate and initialize a stake message for epoch 3 with staker 'I', finalize the message, and check leaders for epochs 2 and 3.
    - Delete the `fd_multi_epoch_leaders_t` object by leaving and deleting the instance.
- **Output**: No output is returned as the function is void and primarily performs tests and assertions.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`check_leaders`](<#check_leaders>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_transitions<!-- {{#callable:test_transitions}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L99>)

Tests transitions between different sets of staked leaders across multiple epochs.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_multi_epoch_leaders_t` object `mleaders` using [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>) and [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>).
    - Generate and initialize a stake message for epoch 0 with leaders 'ABCD' using [`generate_stake_msg`](<#generate_stake_msg>) and [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>).
    - Finalize the stake message with [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>) and verify leaders for epoch 0 using [`check_leaders`](<#check_leaders>).
    - Transition to a new set of leaders 'ABCDEF' for epoch 1, finalize, and verify leaders for epochs 0 and 1.
    - Transition back to leaders 'AB' for epoch 2, finalize, and verify leaders for epochs 1 and 2.
    - Completely swap to leaders 'GI' for epoch 3, finalize, and verify leaders for epochs 2 and 3.
    - Clean up by deleting the `mleaders` object using [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>) and [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>).
- **Output**: No output is returned; the function performs tests and validations internally.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`check_leaders`](<#check_leaders>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_skip\_ahead<!-- {{#callable:test_skip_ahead}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L128>)

Tests the behavior of skipping several epochs in the multi-epoch leader schedule.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_multi_epoch_leaders_t` object `mleaders` by joining a new instance created with `mleaders_mem`.
    - Generate and initialize a stake message for epoch 0 with stakers 'ABC', then finalize the stake message and check the leaders for epoch 0.
    - Generate and initialize a stake message for epoch 5 with stakers 'DEF', then finalize the stake message.
    - Check the leaders for epochs 0, 1, 4, and 5 to verify that the leaders for epoch 0 remain due to different parity, and epochs 1 and 4 have no leaders, while epoch 5 has leaders 'DEF'.
    - Delete the `mleaders` object after leaving it.
- **Output**: No output is returned as the function is void and primarily performs tests and assertions.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`check_leaders`](<#check_leaders>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_cancel<!-- {{#callable:test_cancel}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L147>)

Tests the cancellation of an unfinished stake message initialization by starting a new one.
- **Inputs**:
    - `None`: This function does not take any input parameters.
- **Logic and Control Flow**:
    - Join a new `fd_multi_epoch_leaders_t` instance using [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>) and [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>).
    - Initialize a stake message for epoch 0 with stakers 'ABC' using [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>) and finalize it with [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>).
    - Verify the leaders for epoch 0 are 'ABC' using [`check_leaders`](<#check_leaders>).
    - Start initializing a stake message for epoch 1 with stakers 'DEF' but do not finalize it.
    - Start another initialization for epoch 1 with stakers 'GHI', which cancels the previous unfinished initialization, and finalize it.
    - Verify the leaders for epoch 0 remain 'ABC' and for epoch 1 are 'GHI' using [`check_leaders`](<#check_leaders>).
    - Delete the `fd_multi_epoch_leaders_t` instance using [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>) and [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>).
- **Output**: No output is returned as this function is a void function and is used for testing purposes.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`check_leaders`](<#check_leaders>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_ordering<!-- {{#callable:test_ordering}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L169>)

Tests the ordering of leaders across multiple epochs using stake messages.
- **Inputs**: None
- **Logic and Control Flow**:
    - Join a new `fd_multi_epoch_leaders_t` instance using [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>) and [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>).
    - Initialize a stake message for epoch 0 with leaders 'ABC' using [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>) and [`generate_stake_msg`](<#generate_stake_msg>).
    - Finalize the stake message with [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>).
    - Check the leaders for epoch 0 using [`check_leaders`](<#check_leaders>) to ensure they match 'ABC'.
    - Initialize a stake message for epoch 1 with leaders 'BCA'.
    - Finalize the stake message and check leaders for both epoch 0 and epoch 1 to ensure they match 'ABC' and 'BCA' respectively.
    - Delete the `fd_multi_epoch_leaders_t` instance using [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>) and [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>).
- **Output**: No output is returned as the function is void and primarily performs tests and assertions.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`check_leaders`](<#check_leaders>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_next\_slot<!-- {{#callable:test_next_slot}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L185>)

Tests the functionality of finding the next slot for a leader in a multi-epoch leader schedule.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_multi_epoch_leaders_t` object `mleaders` using [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>) and [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>).
    - Initialize stake messages for epochs 0 and 1 with leaders 'ABC' and 'D' respectively using [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>) and [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>).
    - Retrieve the leader schedule for epoch 0 using [`fd_multi_epoch_leaders_get_lsched_for_epoch`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_lsched_for_epoch>) and verify its properties using `FD_TEST`.
    - For each leader 'A', 'B', and 'C', find the next slot using [`fd_multi_epoch_leaders_get_next_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_next_slot>) and verify the slot is within the expected range and corresponds to the correct leader using `FD_TEST`.
    - Test crossing the epoch boundary by finding the next slot for leader 'D' in epoch 1 and verify the slot is within the expected range and corresponds to leader 'D'.
    - Test with a non-existent leader 'Z' and verify that the next slot is `ULONG_MAX`.
    - Clean up by deleting the `mleaders` object using [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>) and [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>).
- **Output**: No output is returned; the function performs tests and uses assertions (`FD_TEST`) to validate conditions.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`fd_multi_epoch_leaders_get_lsched_for_epoch`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_lsched_for_epoch>)
    - [`fd_multi_epoch_leaders_get_next_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_next_slot>)
    - [`fd_multi_epoch_leaders_get_leader_for_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_leader_for_slot>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_limits<!-- {{#callable:test_limits}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L228>)

Tests the behavior of the system with varying numbers of staked leaders around the maximum limit.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_multi_epoch_leaders_t` object `mleaders` using [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>) and [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>).
    - Iterate over `stake_weight_cnt` from `MAX_STAKED_LEADERS-2` to `MAX_STAKED_LEADERS+2`.
    - For each `stake_weight_cnt`, initialize a `fd_stake_weight_msg_t` buffer `buf` using `fd_type_pun` on `stake_msg`.
    - Set `buf` fields: `epoch`, `start_slot`, `slot_cnt`, `staked_cnt`, `excluded_stake`, and `vote_keyed_lsched`.
    - Iterate over `i` from `0` to `stake_weight_cnt` to calculate `stake` and populate `buf->weights` with vote and id keys, and stake values.
    - If `i` is less than `MAX_STAKED_LEADERS`, increment `buf->staked_cnt`; otherwise, add `stake` to `buf->excluded_stake`.
    - Initialize and finalize the stake message in `mleaders` using [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>) and [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>).
    - Test the leader schedule for the slot corresponding to `stake_weight_cnt*SLOTS_PER_EPOCH` using `FD_TEST`.
    - Delete `mleaders` using [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>) and [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>).
- **Output**: No output is returned; the function performs tests and uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`fd_multi_epoch_leaders_get_lsched_for_slot`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_get_lsched_for_slot>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### test\_get\_sorted\_lscheds<!-- {{#callable:test_get_sorted_lscheds}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L264>)

Tests the retrieval and sorting of leader schedules across multiple epochs.
- **Inputs**: None
- **Logic and Control Flow**:
    - Join a new `fd_multi_epoch_leaders_t` instance using [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>) and [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>).
    - Call `fd_multi_epoch_leaders_get_sorted_lscheds` to get the sorted leader schedules and verify that both entries are `NULL` when no epochs are initialized.
    - Initialize epoch 0 using [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>) and [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>), then verify that the first entry in the sorted leader schedules is not `NULL` and corresponds to epoch 0.
    - Initialize epoch 1 and verify that the sorted leader schedules contain entries for both epoch 0 and epoch 1, sorted by epoch.
    - Initialize epoch 3, which overwrites epoch 1, and verify that the sorted leader schedules maintain sorting with entries for epoch 0 and epoch 3.
    - Initialize epoch 10 to test handling of large gaps, and verify that the sorted leader schedules contain entries for epoch 3 and epoch 10, maintaining the correct order.
    - Delete the `fd_multi_epoch_leaders_t` instance using [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>) and [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>).
- **Output**: No output is returned; the function performs internal tests using `FD_TEST` assertions.
- **Functions Called**:
    - [`fd_multi_epoch_leaders_join`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_join>)
    - [`fd_multi_epoch_leaders_new`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_new>)
    - [`fd_multi_epoch_leaders_stake_msg_init`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_init>)
    - [`generate_stake_msg`](<#generate_stake_msg>)
    - [`fd_multi_epoch_leaders_stake_msg_fini`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_stake_msg_fini>)
    - [`fd_multi_epoch_leaders_delete`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_delete>)
    - [`fd_multi_epoch_leaders_leave`](<fd_multi_epoch_leaders.c.md#fd_multi_epoch_leaders_leave>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/flamenco/leaders/test_multi_leaders.c#L316>)

Initializes the system, runs a series of test functions, logs a success message, and halts the system.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Call `fd_boot` to initialize the system with command-line arguments.
    - Execute a series of test functions: [`test_staked_only`](<#test_staked_only>), [`test_transitions`](<#test_transitions>), [`test_skip_ahead`](<#test_skip_ahead>), [`test_cancel`](<#test_cancel>), [`test_ordering`](<#test_ordering>), [`test_next_slot`](<#test_next_slot>), [`test_limits`](<#test_limits>), and [`test_get_sorted_lscheds`](<#test_get_sorted_lscheds>).
    - Log a notice message 'pass' using `FD_LOG_NOTICE`.
    - Call `fd_halt` to halt the system.
    - Return 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_staked_only`](<#test_staked_only>)
    - [`test_transitions`](<#test_transitions>)
    - [`test_skip_ahead`](<#test_skip_ahead>)
    - [`test_cancel`](<#test_cancel>)
    - [`test_ordering`](<#test_ordering>)
    - [`test_next_slot`](<#test_next_slot>)
    - [`test_limits`](<#test_limits>)
    - [`test_get_sorted_lscheds`](<#test_get_sorted_lscheds>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)