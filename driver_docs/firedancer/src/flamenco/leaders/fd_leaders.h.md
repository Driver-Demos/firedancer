<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for managing the Solana leader schedule, including memory management and leader retrieval functions.

# Purpose
The code is a C header file that defines the API for managing the leader schedule in the Solana blockchain network. It provides structures and functions to handle the assignment of leaders to slots within an epoch. The leader schedule is a sequence of leaders, identified by their public keys, responsible for producing blocks in specific slots. The schedule is divided into rotations, with each rotation spanning multiple slots. The file includes definitions for calculating the memory footprint and alignment requirements for storing the leader schedule, as well as functions to create, join, leave, and delete leader schedule objects.

The `fd_epoch_leaders_t` structure is central to this file, encapsulating the leader schedule for a given epoch. It includes fields for the epoch number, the starting slot, the number of slots, a lookup table for public keys, and an array of indices representing the schedule. The file also defines macros for compile-time calculations of memory requirements and provides a function to retrieve the public key of the leader for a specific slot. The header file is intended to be included in other C source files that need to interact with the Solana leader schedule, providing a clear interface for managing and accessing leader information.
# Imports and Dependencies

---
- `fd_leaders_base.h`
- `../../ballet/wsample/fd_wsample.h`


# Data Structures

---
### fd\_epoch\_leaders
- **Type**: ``struct``
- **Members**:
    - `epoch`: The epoch number for which the leader schedule is defined.
    - `slot0`: The starting slot number of the epoch.
    - `slot_cnt`: The total number of slots in the epoch.
    - `pub`: A pointer to an array of public keys representing node identities.
    - `pub_cnt`: The number of unique public keys in the `pub` array.
    - `sched`: A pointer to an array of indexes into the `pub` array, representing the leader schedule.
    - `sched_cnt`: The number of entries in the `sched` array.
- **Description**: Defines the leader schedule for a specific epoch in the Solana network, including the starting slot, total slots, and a mapping of slots to node public keys through a schedule of indexes.


---
### fd\_epoch\_leaders\_t
- **Type**: ``struct``
- **Members**:
    - `epoch`: The epoch number for which the schedule is defined.
    - `slot0`: The starting slot number of the epoch.
    - `slot_cnt`: The total number of slots in the epoch.
    - `pub`: A pointer to an array of public keys representing node identities.
    - `pub_cnt`: The number of unique public keys in the `pub` array.
    - `sched`: A pointer to an array of indexes into the `pub` array, representing the leader schedule.
    - `sched_cnt`: The number of entries in the `sched` array.
- **Description**: Contains the leader schedule for a Solana epoch, mapping slots to leaders using a lookup table of public keys and an index-based schedule.


# Functions

---
### fd\_epoch\_leaders\_get<!-- {{#callable:fd_epoch_leaders_get}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L156>)

Returns a pointer to the public key of the leader for a given slot in the epoch leader schedule.
- **Inputs**:
    - `leaders`: A pointer to a `fd_epoch_leaders_t` structure that contains the leader schedule for an epoch.
    - `slot`: An unsigned long integer representing the slot number for which the leader's public key is requested.
- **Logic and Control Flow**:
    - Check if `leaders` is NULL; if true, return NULL.
    - Calculate `slot_delta` as the difference between `slot` and `leaders->slot0`.
    - Check if `slot` is less than `leaders->slot0`; if true, return NULL.
    - Check if `slot_delta` is greater than or equal to `leaders->slot_cnt`; if true, return NULL.
    - Return a pointer to the public key by accessing `leaders->pub` at the index specified by `leaders->sched[slot_delta/FD_EPOCH_SLOTS_PER_ROTATION]`.
- **Output**: A pointer to a `fd_pubkey_t` representing the leader's public key for the specified slot, or NULL if the slot is out of range.


# Function Declarations (Public API)

---
### fd\_epoch\_leaders\_align<!-- {{#callable_declaration:fd_epoch_leaders_align}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L80>)

Returns the alignment requirement for a leader schedule object.
- **Description**: Use this function to obtain the alignment requirement for a leader schedule object in the Solana leader schedule API. This function is useful when you need to allocate memory for a leader schedule object and must ensure that the memory is correctly aligned. It is a constant function and does not require any parameters.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement in bytes.
- **See Also**: [`fd_epoch_leaders_align`](<fd_leaders.c.md#fd_epoch_leaders_align>)  (Implementation)


---
### fd\_epoch\_leaders\_footprint<!-- {{#callable_declaration:fd_epoch_leaders_footprint}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L90>)

Calculates the memory footprint for a leader schedule object.
- **Description**: Use this function to determine the memory size needed for a leader schedule object based on the number of unique public keys and the number of slots in an epoch. This function is useful when allocating memory for leader schedule objects. Ensure that `pub_cnt` is greater than zero and does not exceed `UINT_MAX - 3`, and `slot_cnt` is greater than zero. If these conditions are not met, the function returns zero, indicating an invalid input.
- **Inputs**:
    - `pub_cnt`: The number of unique public keys. Must be greater than zero and not exceed `UINT_MAX - 3`. If invalid, the function returns zero.
    - `slot_cnt`: The number of slots in the epoch. Must be greater than zero. If invalid, the function returns zero.
- **Output**: Returns the calculated memory footprint in bytes, or zero if inputs are invalid.
- **See Also**: [`fd_epoch_leaders_footprint`](<fd_leaders.c.md#fd_epoch_leaders_footprint>)  (Implementation)


---
### fd\_epoch\_leaders\_new<!-- {{#callable_declaration:fd_epoch_leaders_new}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L115>)

Formats a memory region for a leader schedule object.
- **Description**: Use this function to prepare a memory region for a leader schedule object for a specific epoch in a Solana network. Ensure that the memory region pointed to by `shmem` meets the required alignment and footprint. The function organizes the leader schedule for the specified epoch, which spans from `slot0` to `slot0 + slot_cnt`. The `stakes` array must contain `pub_cnt` entries sorted by stake and public key. If `vote_keyed_lsched` is set to 1, the schedule is computed by vote accounts. The function does not retain a read interest in `stakes` after execution, and the caller is not joined to the object upon return.
- **Inputs**:
    - `shmem`: Pointer to the start of a memory region with the required alignment and footprint. Must not be null.
    - `epoch`: The epoch number for which the leader schedule is being created.
    - `slot0`: The first slot in the epoch. Must be the start of the epoch.
    - `slot_cnt`: The number of slots in the epoch. Can be less than the full epoch length.
    - `pub_cnt`: The number of unique public keys in the schedule.
    - `stakes`: Pointer to an array of `fd_vote_stake_weight_t` structures, containing `pub_cnt` entries sorted by stake and public key. The caller retains ownership.
    - `excluded_stake`: The sum of stakes not included in `stakes`, used in cases like network attacks with fake validators.
    - `vote_keyed_lsched`: Determines if the leader schedule is computed by vote accounts. Set to 0 or 1.
- **Output**: Returns a pointer to the formatted memory region if successful, or NULL if there is an error (e.g., null or misaligned `shmem`).
- **See Also**: [`fd_epoch_leaders_new`](<fd_leaders.c.md#fd_epoch_leaders_new>)  (Implementation)


---
### fd\_epoch\_leaders\_join<!-- {{#callable_declaration:fd_epoch_leaders_join}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L128>)

Joins the caller to a leader schedule object.
- **Description**: Use this function to join a leader schedule object, which is necessary before performing operations on it. The input must be a valid pointer to a memory region formatted as a leader schedule object. This function does not perform any validation on the input pointer, so ensure that the pointer is correctly initialized and points to a valid leader schedule object.
- **Inputs**:
    - `shleaders`: A pointer to a memory region that represents a leader schedule object. Must not be null and should point to a valid leader schedule object. The function does not validate this pointer.
- **Output**: Returns a pointer to the `fd_epoch_leaders_t` structure, allowing access to the leader schedule object.
- **See Also**: [`fd_epoch_leaders_join`](<fd_leaders.c.md#fd_epoch_leaders_join>)  (Implementation)


---
### fd\_epoch\_leaders\_leave<!-- {{#callable_declaration:fd_epoch_leaders_leave}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L131>)

Leaves the leader schedule object.
- **Description**: Use this function to leave a previously joined leader schedule object. This operation is necessary when the caller no longer needs to interact with the leader schedule. Ensure that the `leaders` parameter is not null before calling this function to avoid undefined behavior.
- **Inputs**:
    - `leaders`: A pointer to an `fd_epoch_leaders_t` object that the caller is currently joined to. Must not be null. The function returns this pointer as a void pointer.
- **Output**: Returns the `leaders` pointer cast to a void pointer.
- **See Also**: [`fd_epoch_leaders_leave`](<fd_leaders.c.md#fd_epoch_leaders_leave>)  (Implementation)


---
### fd\_epoch\_leaders\_delete<!-- {{#callable_declaration:fd_epoch_leaders_delete}} -->
[View Source →](<../../../../../src/flamenco/leaders/fd_leaders.h#L137>)

Unformats a memory region and returns ownership to the caller.
- **Description**: Use this function to release a memory region previously formatted as a leader schedule object. It returns the ownership of the memory back to the caller, allowing for potential reuse or deallocation. This function should be called when the leader schedule object is no longer needed, ensuring that resources are properly managed. The input must be a valid pointer to a memory region formatted by `fd_epoch_leaders_new`.
- **Inputs**:
    - `shleaders`: A pointer to a memory region that was previously formatted as a leader schedule object. The pointer must not be null and should point to a valid leader schedule object. Invalid or null pointers will result in undefined behavior.
- **Output**: Returns the same pointer that was passed in, indicating the memory region is no longer formatted as a leader schedule object.
- **See Also**: [`fd_epoch_leaders_delete`](<fd_leaders.c.md#fd_epoch_leaders_delete>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)