<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Utility methods for creating transaction templates and building transactions with instructions.

# Purpose
This C header file defines utility functions and structures for creating and managing transaction templates in a system. It includes necessary headers for transaction and type definitions and declares a structure `fd_txn_accounts` to manage account information, including the number of signers and writable accounts. The file provides prototypes for three main functions: [`fd_txn_base_generate`](<#fd_txn_base_generate>), which creates a transaction template with a specified number of signatures; [`fd_txn_add_instr`](<#fd_txn_add_instr>), which adds an instruction to a transaction; and [`fd_txn_reset_instrs`](<#fd_txn_reset_instrs>), which resets the instruction list in the transaction metadata. These functions facilitate the construction and manipulation of transactions, allowing for pre-staging and reuse of transaction templates.
# Imports and Dependencies

---
- `../../ballet/txn/fd_txn.h`
- `../../ballet/txn/fd_compact_u16.h`
- `../../flamenco/types/fd_types_custom.h`
- `../../flamenco/types/fd_types.h`


# Data Structures

---
### fd\_txn\_accounts
- **Type**: ``struct``
- **Members**:
    - `signature_cnt`: Stores the count of signatures, with a maximum of 128.
    - `readonly_signed_cnt`: Stores the count of readonly signed accounts, with a maximum of 128.
    - `readonly_unsigned_cnt`: Stores the count of readonly unsigned accounts, with a maximum of 128.
    - `acct_cnt`: Stores the total count of accounts.
    - `signers_w`: Pointer to an array of public keys for writable signers.
    - `signers_r`: Pointer to an array of public keys for readonly signers.
    - `non_signers_w`: Pointer to an array of public keys for writable non-signers.
    - `non_signers_r`: Pointer to an array of public keys for readonly non-signers.
- **Description**: Defines a structure for managing transaction accounts, including counts of signatures and accounts, and pointers to arrays of public keys for signers and non-signers, both writable and readonly.


---
### fd\_txn\_accounts\_t
- **Type**: ``struct``
- **Members**:
    - `signature_cnt`: Number of signatures, with a maximum of 128.
    - `readonly_signed_cnt`: Number of read-only signed accounts, with a maximum of 128.
    - `readonly_unsigned_cnt`: Number of read-only unsigned accounts, with a maximum of 128.
    - `acct_cnt`: Total number of accounts.
    - `signers_w`: Pointer to an array of writable signer public keys.
    - `signers_r`: Pointer to an array of read-only signer public keys.
    - `non_signers_w`: Pointer to an array of writable non-signer public keys.
    - `non_signers_r`: Pointer to an array of read-only non-signer public keys.
- **Description**: Defines a list of accounts used in a transaction, including details about the number of signers and writable accounts. It uses public key pointers to categorize accounts into signers and non-signers, as well as writable and read-only accounts.


# Function Declarations (Public API)

---
### fd\_txn\_base\_generate<!-- {{#callable_declaration:fd_txn_base_generate}} -->
[View Source →](<../../../../../src/flamenco/txn/fd_txn_generate.h#L30>)

Generates a transaction template with metadata and payload.
- **Description**: Use this function to create a transaction template for pre-staging or re-use. It initializes the transaction metadata and payload based on the provided account information and optional recent blockhash. The number of signatures must be less than 128. The function returns the offset to the start of the instructions in the transaction payload. Ensure that the `accounts` parameter is correctly populated with account details before calling this function.
- **Inputs**:
    - `out_txn_meta`: An array of unsigned characters with a size of at least `FD_TXN_MAX_SZ`. It will be populated with transaction metadata. The caller must provide a valid buffer.
    - `out_txn_payload`: An array of unsigned characters with a size of at least `FD_TXN_MTU`. It will be populated with the transaction payload. The caller must provide a valid buffer.
    - `num_signatures`: An unsigned long representing the number of signatures. It must be less than 128. If the value exceeds this limit, the function will not proceed.
    - `accounts`: A pointer to an `fd_txn_accounts_t` structure containing account information. It must not be null and should be properly initialized with account details.
    - `opt_recent_blockhash`: An optional pointer to an array of unsigned characters representing a recent blockhash. If null, the function will use a default value.
- **Output**: Returns an unsigned long representing the offset to the start of the instructions in the transaction payload.
- **See Also**: [`fd_txn_base_generate`](<fd_txn_generate.c.md#fd_txn_base_generate>)  (Implementation)


---
### fd\_txn\_add\_instr<!-- {{#callable_declaration:fd_txn_add_instr}} -->
[View Source →](<../../../../../src/flamenco/txn/fd_txn_generate.h#L47>)

Adds an instruction to a transaction being generated.
- **Description**: Use this function to add an instruction to a transaction that is currently being generated. It requires a pointer to transaction metadata, a buffer for the transaction payload, a program identifier, a list of account indices, and an instruction buffer. The function updates the transaction metadata and payload with the new instruction. Ensure that the transaction metadata has been initialized and that the number of instructions does not exceed the maximum allowed. The function returns the offset to the start of the newly added instruction in the transaction buffer.
- **Inputs**:
    - `txn_meta_ptr`: Pointer to the transaction metadata. Must not be null and should point to a valid transaction metadata structure.
    - `out_txn_payload`: Buffer for the transaction payload. Must have a size of at least `FD_TXN_MTU` bytes.
    - `program_id`: Identifier for the program associated with the instruction. Must be a valid program ID.
    - `accounts`: Pointer to a list of account indices used by the instruction. Must not be null if `accounts_sz` is greater than zero.
    - `accounts_sz`: Number of account indices in the `accounts` list. Must be a valid size that fits within the transaction constraints.
    - `instr_buf`: Pointer to the instruction data buffer. Must not be null if `instr_buf_sz` is greater than zero.
    - `instr_buf_sz`: Size of the instruction data buffer. Must be a valid size that fits within the transaction constraints.
- **Output**: Returns the offset to the start of the newly added instruction in the transaction buffer.
- **See Also**: [`fd_txn_add_instr`](<fd_txn_generate.c.md#fd_txn_add_instr>)  (Implementation)


---
### fd\_txn\_reset\_instrs<!-- {{#callable_declaration:fd_txn_reset_instrs}} -->
[View Source →](<../../../../../src/flamenco/txn/fd_txn_generate.h#L58>)

Resets the list of instructions in the transaction metadata and payload.
- **Description**: Use this function to clear all instructions from a transaction's metadata and payload. It is useful when you need to reset a transaction to a clean state before adding new instructions. This function must be called only when the transaction metadata is valid and initialized. If the instruction count in the metadata is zero, the function returns immediately without making changes.
- **Inputs**:
    - `txn_meta_ptr`: A pointer to the transaction metadata. Must not be null and must point to a valid and initialized `fd_txn_t` structure. The caller retains ownership.
    - `out_txn_payload`: An array with a size of at least `FD_TXN_MTU` that represents the transaction payload. The function modifies this array to remove all instructions.
- **Output**: None
- **See Also**: [`fd_txn_reset_instrs`](<fd_txn_generate.c.md#fd_txn_reset_instrs>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)