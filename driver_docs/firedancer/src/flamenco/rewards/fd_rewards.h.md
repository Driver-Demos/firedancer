<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for distributing Solana staking rewards, updating epoch bank calculations, and restoring replay state.

# Purpose
The `fd_rewards.h` header file provides APIs for managing and distributing Solana staking rewards. It includes function prototypes for operations related to reward calculations and distributions at epoch boundaries. The [`fd_begin_partitioned_rewards`](<#fd_begin_partitioned_rewards>) function updates stake and vote account reward calculations and is called at the start of an epoch. The [`fd_rewards_recalculate_partitioned_rewards`](<#fd_rewards_recalculate_partitioned_rewards>) function restores reward calculations from a snapshot without updating accounts, useful for replay state restoration. The [`fd_distribute_partitioned_epoch_rewards`](<#fd_distribute_partitioned_epoch_rewards>) function handles the payout of rewards to stake accounts at specific slots within an epoch. The file includes necessary headers for types and stake-related operations, ensuring integration with the broader system.
# Imports and Dependencies

---
- `../types/fd_types.h`
- `../stakes/fd_stake_delegations.h`
- `../stakes/fd_vote_states.h`


# Function Declarations (Public API)

---
### fd\_begin\_partitioned\_rewards<!-- {{#callable_declaration:fd_begin_partitioned_rewards}} -->
[View Source →](<../../../../../src/flamenco/rewards/fd_rewards.h#L10>)

Updates epoch bank stake and vote account reward calculations.
- **Description**: Use this function at the start of the first block of an epoch to update the reward calculations for stake and vote accounts in the epoch bank. It distributes payouts to vote accounts and increases capitalization. This function must be called during the epoch boundary to ensure correct reward distribution and initialization of the epoch rewards system variable. Ensure that all input parameters are correctly initialized and valid before calling this function.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank where the rewards are calculated and distributed. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `runtime_stack`: A pointer to an `fd_runtime_stack_t` structure used for runtime operations. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure used for capturing context during operations. Must not be null.
    - `stake_delegations`: A pointer to a constant `fd_stake_delegations_t` structure representing the stake delegations. Must not be null.
    - `parent_blockhash`: A pointer to a constant `fd_hash_t` structure representing the parent block hash. Must not be null.
    - `parent_epoch`: An unsigned long integer representing the parent epoch. Must be a valid epoch number.
- **Output**: None
- **See Also**: [`fd_begin_partitioned_rewards`](<fd_rewards.c.md#fd_begin_partitioned_rewards>)  (Implementation)


---
### fd\_rewards\_recalculate\_partitioned\_rewards<!-- {{#callable_declaration:fd_rewards_recalculate_partitioned_rewards}} -->
[View Source →](<../../../../../src/flamenco/rewards/fd_rewards.h#L52>)

Restores epoch bank stake and account reward calculations.
- **Description**: Use this function to restore the state of epoch bank stake and account reward calculations when replaying from a snapshot. It does not update accounts but recalculates the necessary reward data. This function is typically called during the restoration of replay state. Ensure that the epoch rewards sysvar is active before calling this function, as inactive rewards will result in no action.
- **Inputs**:
    - `banks`: A pointer to `fd_banks_t`, representing the collection of banks. Must not be null.
    - `bank`: A pointer to `fd_bank_t`, representing the specific bank to operate on. Must not be null.
    - `funk`: A pointer to `fd_funk_t`, representing the transaction context. Must not be null.
    - `xid`: A constant pointer to `fd_funk_txn_xid_t`, representing the transaction identifier. Must not be null.
    - `runtime_stack`: A pointer to `fd_runtime_stack_t`, used for managing runtime state. Must not be null.
    - `capture_ctx`: A pointer to `fd_capture_ctx_t`, used for capturing context during execution. Must not be null.
- **Output**: None
- **See Also**: [`fd_rewards_recalculate_partitioned_rewards`](<fd_rewards.c.md#fd_rewards_recalculate_partitioned_rewards>)  (Implementation)


---
### fd\_distribute\_partitioned\_epoch\_rewards<!-- {{#callable_declaration:fd_distribute_partitioned_epoch_rewards}} -->
[View Source →](<../../../../../src/flamenco/rewards/fd_rewards.h#L67>)

Pays out rewards to stake accounts.
- **Description**: Use this function to distribute staking rewards to accounts at the beginning of specific slots within an epoch. It must be called when the block height is within the range specified by the epoch rewards. The function checks if the current block height is eligible for reward distribution and processes the rewards accordingly. It also ensures that rewards are not distributed if the number of slots in the epoch is less than or equal to the number of partitions. After distributing rewards, it updates the status of the epoch rewards if the distribution is complete.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank where rewards are distributed. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure used for capturing context during the distribution process. Must not be null.
- **Output**: None
- **See Also**: [`fd_distribute_partitioned_epoch_rewards`](<fd_rewards.c.md#fd_distribute_partitioned_epoch_rewards>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)