<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for stake delegation functionalities, including creation, update, query, and removal operations.

# Purpose
The code is an executable C program that tests the functionality of stake delegations within a specified runtime environment. It begins by initializing the environment and setting up a workspace, either by attaching to an existing one or creating a new anonymous workspace. The program then performs a series of tests on the stake delegations, ensuring that the memory alignment and footprint requirements are met. It uses functions such as `fd_stake_delegations_new`, `fd_stake_delegations_join`, and `fd_stake_delegations_update` to create, join, and update stake delegations, respectively.

The program tests various operations on stake delegations, including adding, querying, updating, and removing stake accounts. It verifies the correctness of these operations by checking the count of stake delegations and the properties of individual stake delegations, such as the stake amount and associated public keys. The code also tests the handling of tombstone states, which indicate removed stake delegations that can be reactivated. The program concludes by logging a "pass" message and halting the execution, indicating that all tests have been successfully completed.
# Imports and Dependencies

---
- `fd_stake_delegations.h`
- `../runtime/fd_runtime_const.h`


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/flamenco/stakes/test_stake_delegations.c#L4>)

Initializes the environment, processes command-line arguments, manages workspace allocation, and tests stake delegation functionalities.
- **Inputs**:
    - `argc`: The count of command-line arguments.
    - `argv`: The array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Extracts command-line options for workspace name, page size, page count, near CPU, and workspace tag using `fd_env_strip_cmdline_cstr` and `fd_env_strip_cmdline_ulong`.
    - Checks if a workspace name is provided; if so, attaches to it using `fd_wksp_attach`, otherwise creates an anonymous workspace with `fd_wksp_new_anonymous`.
    - Verifies that the stake delegations footprint is within predefined limits using `FD_TEST`.
    - Allocates memory for stake delegations using `fd_wksp_alloc_laddr` and initializes it with [`fd_stake_delegations_new`](<fd_stake_delegations.c.md#fd_stake_delegations_new>).
    - Performs a series of tests on stake delegations, including creation, joining, updating, querying, and removal, using `FD_TEST` to validate each operation.
    - Logs the success of the tests with `FD_LOG_NOTICE` and halts the program with `fd_halt`.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_stake_delegations_footprint`](<fd_stake_delegations.c.md#fd_stake_delegations_footprint>)
    - [`fd_stake_delegations_align`](<fd_stake_delegations.c.md#fd_stake_delegations_align>)
    - [`fd_stake_delegations_new`](<fd_stake_delegations.c.md#fd_stake_delegations_new>)
    - [`fd_stake_delegations_join`](<fd_stake_delegations.c.md#fd_stake_delegations_join>)
    - [`fd_stake_delegations_leave`](<fd_stake_delegations.c.md#fd_stake_delegations_leave>)
    - [`fd_stake_delegations_max`](<fd_stake_delegations.h.md#fd_stake_delegations_max>)
    - [`fd_stake_delegations_cnt`](<fd_stake_delegations.c.md#fd_stake_delegations_cnt>)
    - [`fd_stake_delegations_update`](<fd_stake_delegations.c.md#fd_stake_delegations_update>)
    - [`fd_stake_delegations_query`](<fd_stake_delegations.c.md#fd_stake_delegations_query>)
    - [`fd_stake_delegations_remove`](<fd_stake_delegations.c.md#fd_stake_delegations_remove>)
    - [`fd_stake_delegations_delete`](<fd_stake_delegations.c.md#fd_stake_delegations_delete>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)