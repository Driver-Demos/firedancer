<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines macros, data structures, and functions for managing feature activation in the Firedancer software.

# Purpose
The code is a C header file that defines a feature management system for the Firedancer software. It provides macros and functions to manage feature activation states within the software. The file includes definitions for checking if features are active, just activated, or disabled. It also provides mechanisms to enable or disable all features, enable features that are hardcoded, and manage one-off feature activations. The `fd_features_t` type is a union that represents the current set of enabled feature flags, with each feature having an associated activation slot.

The file defines a structure `fd_feature_id_t` that maps feature IDs to their corresponding byte offsets in `fd_features_t`. This structure includes information such as the feature's index, public key, name, and status flags. The file also provides an iterator-style API to iterate over all supported features. Functions like [`fd_features_set`](<#fd_features_set>) and [`fd_features_get`](<#fd_features_get>) are used to set and retrieve the activation slots of features, respectively. The header file is intended to be included in other C files to provide feature management capabilities within the Firedancer software.
# Imports and Dependencies

---
- `../fd_flamenco_base.h`
- `fd_features_generated.h`
- `../types/fd_types.h`


# Global Variables

---
### ids
- **Type**: ``fd_feature_id_t const[]``
- **Description**: `ids` is an array of `fd_feature_id_t` structures that contains the list of known feature IDs. Each element in the array represents a feature with its associated metadata, such as index, public key, name, and status flags. The array is terminated by an element with an `index` of `ULONG_MAX`, which acts as a sentinel value.
- **Use**: Used to iterate over and access the list of known feature IDs in the Firedancer software.


# Data Structures

---
### fd\_features\_t
- **Type**: `union`
- **Members**:
    - `f`: An array of unsigned long integers representing activation slots for each feature.
- **Description**: Represents the current set of enabled feature flags, where each feature has a corresponding activation slot stored as an unsigned long integer. If a feature is not yet activated, its slot is set to `FD_FEATURE_DISABLED`. The structure allows for convenient management of feature activation states, which can change over time as features become default or new activations are added.


---
### fd\_feature\_id
- **Type**: ``struct``
- **Members**:
    - `index`: Index of the feature in `fd_features_t`.
    - `id`: Public key of the feature.
    - `name`: Name of the feature as a C-style string.
    - `cleaned_up`: Array indicating the cleaned-up cluster version for the feature.
    - `reverted`: Indicates if the feature was reverted.
    - `hardcode_for_fuzzing`: Indicates if the feature should be treated as hardcoded in the Firedancer fuzzing harness.
- **Description**: Maps a feature ID, represented by an account address, to its corresponding byte offset in `fd_features_t`. It includes metadata such as the feature's index, public key, name, cleaned-up version, and flags for reversion and fuzzing.


---
### fd\_feature\_id\_t
- **Type**: ``struct``
- **Members**:
    - `index`: Index of the feature in `fd_features_t`.
    - `id`: Public key of the feature.
    - `name`: Name of the feature as a C-style string.
    - `cleaned_up`: Array indicating the cleaned-up cluster version for the feature.
    - `reverted`: Flag indicating if the feature was reverted.
    - `hardcode_for_fuzzing`: Flag indicating if the feature should be treated as hardcoded in the Firedancer fuzzing harness.
- **Description**: Maps a feature ID, represented by an account address, to a byte offset in `fd_features_t`. It includes metadata such as the feature's index, public key, name, and status flags for whether it has been cleaned up, reverted, or hardcoded for fuzzing purposes.


# Functions

---
### fd\_feature\_iter\_init<!-- {{#callable:fd_feature_iter_init}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L107>)

Initializes an iterator over the list of known feature IDs by returning the start of the `ids` array.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the pointer to the start of the `ids` array, which contains the list of known feature IDs.
- **Output**: A pointer to the first element of the `ids` array, which is of type `fd_feature_id_t const *`.


---
### fd\_feature\_iter\_done<!-- {{#callable:fd_feature_iter_done}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L112>)

Checks if the feature iterator has reached the end of the feature list.
- **Inputs**:
    - ``id``: A pointer to a `fd_feature_id_t` structure representing a feature ID.
- **Logic and Control Flow**:
    - Compare the `index` field of the `id` structure to `ULONG_MAX`.
    - Return `1` if the `index` is equal to `ULONG_MAX`, indicating the end of the feature list.
    - Return `0` otherwise, indicating that there are more features to iterate over.
- **Output**: Returns an integer `1` if the iterator is at the end of the feature list, otherwise returns `0`.


---
### fd\_feature\_iter\_next<!-- {{#callable:fd_feature_iter_next}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L117>)

Advances the feature ID iterator to the next feature ID.
- **Inputs**:
    - `id`: A pointer to the current `fd_feature_id_t` structure in the iterator.
- **Logic and Control Flow**:
    - Takes the input pointer `id` and increments it by one to point to the next feature ID in the sequence.
- **Output**: Returns a pointer to the next `fd_feature_id_t` structure.


---
### fd\_features\_set<!-- {{#callable:fd_features_set}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L124>)

Sets the activation slot for a specified feature in the `fd_features_t` structure.
- **Inputs**:
    - ``features``: A pointer to an `fd_features_t` structure where the feature's activation slot will be set.
    - ``id``: A pointer to a constant `fd_feature_id_t` structure that identifies the feature whose activation slot is to be set.
    - ``slot``: An unsigned long integer representing the activation slot to be set for the specified feature.
- **Logic and Control Flow**:
    - Accesses the `f` array within the `fd_features_t` structure pointed to by `features`.
    - Uses the `index` from the `fd_feature_id_t` structure pointed to by `id` to locate the correct position in the `f` array.
    - Sets the value at the located position in the `f` array to the value of `slot`.
- **Output**: No output is returned as the function is `void`; it modifies the `features` structure in place.


---
### fd\_features\_get<!-- {{#callable:fd_features_get}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L134>)

Retrieves the activation slot for a specified feature ID from a feature set.
- **Inputs**:
    - `features`: A pointer to a `fd_features_t` structure that contains the activation slots of features.
    - `id`: A pointer to a `fd_feature_id_t` structure that specifies the feature ID to query.
- **Logic and Control Flow**:
    - Accesses the `index` field of the `id` structure to determine the position of the feature in the `features` structure.
    - Returns the value at the specified index in the `f` array of the `features` structure.
- **Output**: The activation slot of the specified feature, or `ULONG_MAX` if the feature is not scheduled for activation.


# Function Declarations (Public API)

---
### fd\_features\_disable\_all<!-- {{#callable_declaration:fd_features_disable_all}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L75>)

Disables all features in the feature set.
- **Description**: Use this function to disable all features in the given feature set. It iterates over all feature IDs and sets their activation slots to the sentinel value `FD_FEATURE_DISABLED`. This function is useful when you need to reset the feature set to a state where no features are active. Ensure that the feature set is properly initialized before calling this function.
- **Inputs**:
    - `f`: A pointer to an `fd_features_t` structure representing the feature set. Must not be null. The caller retains ownership of the structure.
- **Output**: None
- **See Also**: [`fd_features_disable_all`](<fd_features.c.md#fd_features_disable_all>)  (Implementation)


---
### fd\_features\_enable\_all<!-- {{#callable_declaration:fd_features_enable_all}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L80>)

Enables all features in the feature set.
- **Description**: Use this function to activate all features in the given feature set. It iterates over all supported features and sets their activation slots to zero, effectively enabling them. This function should be called when you want to ensure that all features are active, regardless of their current state. Ensure that the feature set is properly initialized before calling this function.
- **Inputs**:
    - `f`: A pointer to an `fd_features_t` structure representing the feature set. Must not be null. The caller retains ownership of the structure.
- **Output**: None
- **See Also**: [`fd_features_enable_all`](<fd_features.c.md#fd_features_enable_all>)  (Implementation)


---
### fd\_features\_enable\_cleaned\_up<!-- {{#callable_declaration:fd_features_enable_cleaned_up}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L87>)

Enables features that are marked as cleaned up based on the cluster version.
- **Description**: Use this function to enable features that have been marked as cleaned up in the current cluster version. It iterates over all supported features and checks if each feature's cleaned up version is less than or equal to the provided cluster version. If so, it enables the feature; otherwise, it sets the feature to a disabled state. This function must be called with a valid `fd_features_t` structure and a valid `fd_cluster_version_t` structure.
- **Inputs**:
    - `f`: A pointer to an `fd_features_t` structure representing the current set of enabled feature flags. The caller must ensure this pointer is valid and properly initialized.
    - `cluster_version`: A pointer to a `fd_cluster_version_t` structure representing the current cluster version. The caller must ensure this pointer is valid and properly initialized.
- **Output**: None
- **See Also**: [`fd_features_enable_cleaned_up`](<fd_features.c.md#fd_features_enable_cleaned_up>)  (Implementation)


---
### fd\_features\_enable\_one\_offs<!-- {{#callable_declaration:fd_features_enable_one_offs}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L92>)

Enables specified features based on provided one-off public keys.
- **Description**: Use this function to enable specific features in the `fd_features_t` structure by providing an array of one-off public keys. This function iterates over the provided public keys, decodes them, and matches them against known feature IDs. If a match is found, the corresponding feature is enabled at the specified slot. This function is useful when you need to activate features that are not part of the standard set but are identified by unique public keys. Ensure that the `features` structure is properly initialized before calling this function.
- **Inputs**:
    - `features`: A pointer to an `fd_features_t` structure where the features will be enabled. Must not be null.
    - `one_offs`: An array of strings, each representing a base58-encoded public key. Must not be null.
    - `one_offs_cnt`: The number of public keys in the `one_offs` array. Must be non-negative.
    - `slot`: An unsigned long integer representing the activation slot for the features. Must be a valid slot value.
- **Output**: None
- **See Also**: [`fd_features_enable_one_offs`](<fd_features.c.md#fd_features_enable_one_offs>)  (Implementation)


---
### fd\_feature\_id\_query<!-- {{#callable_declaration:fd_feature_id_query}} -->
[View Source →](<../../../../../src/flamenco/features/fd_features.h#L144>)

Queries a feature ID using a prefix.
- **Description**: Use this function to find a feature ID by providing the first 8 bytes of the feature's address in little-endian order. This function returns a pointer to the feature ID in the `ids` array if the prefix matches a known feature. If the prefix does not match any known feature, the function returns `NULL`. Ensure that the prefix is valid and corresponds to a known feature to avoid receiving a `NULL` result.
- **Inputs**:
    - `prefix`: The first 8 bytes of the feature address in little-endian order. Must be a valid prefix corresponding to a known feature. If the prefix is not recognized, the function returns `NULL`.
- **Output**: A pointer to the `fd_feature_id_t` in the `ids` array if the prefix is valid, or `NULL` if the prefix is not recognized.
- **See Also**: [`fd_feature_id_query`](<fd_features_generated.c.md#fd_feature_id_query>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)