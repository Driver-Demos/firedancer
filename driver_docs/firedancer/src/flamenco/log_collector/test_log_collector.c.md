<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for log collector functionality, including message limits and behavior under various conditions.

# Purpose
The code is a C test suite designed to evaluate the functionality and limits of a log collection system. It includes several test functions that simulate different logging scenarios to ensure the log collector behaves as expected under various conditions. The tests focus on the capacity of the log collector to handle large volumes of log messages, the behavior when message size limits are exceeded, and the handling of specific message patterns. Each test initializes a log collector, sends a series of log messages, and then verifies the log collector's state using assertions to check the length and content of the collected logs.

The [`main`](<#main>) function orchestrates the execution of these tests, excluding the [`test_log_messages_bytes_limit_agave`](<#test_log_messages_bytes_limit_agave>) function, which is commented out due to its unrealistic memory requirements. The tests include [`test_log_messages_bytes_limit`](<#test_log_messages_bytes_limit>), [`test_log_messages_single_log_limit`](<#test_log_messages_single_log_limit>), [`test_log_messages_weird_behavior`](<#test_log_messages_weird_behavior>), and [`test_log_messages_equivalences`](<#test_log_messages_equivalences>), each targeting different aspects of the log collector's functionality. The code uses the `fd_log_collector` API to manage log entries and employs `FD_TEST` macros to assert expected outcomes, ensuring that the log collector truncates logs appropriately and maintains message integrity. The program concludes by logging a success message and halting the execution.
# Imports and Dependencies

---
- `./fd_log_collector.h`


# Functions

---
### test\_log\_messages\_bytes\_limit\_agave<!-- {{#callable:test_log_messages_bytes_limit_agave}} -->
[View Source →](<../../../../../src/flamenco/log_collector/test_log_collector.c#L13>)

Tests the behavior of the log collector when logging 20,000 instances of a single character and checks if the log is truncated correctly.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_exec_instr_ctx_t` and `fd_exec_txn_ctx_t` structures and link them.
    - Initialize a `fd_log_collector_t` instance with a limit of 1.
    - Log the character 'x' 20,000 times using `fd_log_collector_msg_literal`.
    - Verify that the length of the log is 10,000 using `fd_log_collector_debug_len`.
    - Check that the first 9,999 log entries are 'x' using `fd_memeq` and `fd_log_collector_debug_get`.
    - Ensure the last log entry is 'Log truncated' using `fd_memeq` and `fd_log_collector_debug_get`.
- **Output**: No output is returned; the function performs assertions to validate log behavior.


---
### test\_log\_messages\_bytes\_limit<!-- {{#callable:test_log_messages_bytes_limit}} -->
[View Source →](<../../../../../src/flamenco/log_collector/test_log_collector.c#L31>)

Tests the behavior of the log collector when logging a large number of messages with a byte limit.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_exec_instr_ctx_t` and `fd_exec_txn_ctx_t` structures and link them.
    - Initialize a `fd_log_collector_t` instance with a limit of 1.
    - Iterate 10,000 times, logging the message 'Program log: ' using `fd_log_collector_msg_literal`.
    - Verify that the length of the log collector's debug output is 770 using `FD_TEST`.
    - Check that the first, second, and 768th log entries are 'Program log: ' using `fd_memeq`.
    - Check that the 769th log entry is 'Log truncated' using `fd_memeq`.
- **Output**: No output is returned; the function uses assertions to validate log behavior.


---
### test\_log\_messages\_single\_log\_limit<!-- {{#callable:test_log_messages_single_log_limit}} -->
[View Source →](<../../../../../src/flamenco/log_collector/test_log_collector.c#L49>)

Tests the behavior of the log collector when handling messages that exceed or meet the single log size limit.
- **Inputs**:
    - `ctx`: An array of `fd_exec_instr_ctx_t` structures used to maintain execution context.
    - `txn`: An array of `fd_exec_txn_ctx_t` structures used to maintain transaction context.
    - `log`: A pointer to `fd_log_collector_t` used to collect log messages.
    - `msg10k`: A character array of size 10001 initialized with a 10000-character message of zeros.
    - `msg9999`: A character array of size 10000 initialized with a 9999-character message of zeros.
- **Logic and Control Flow**:
    - Initialize the log collector with a limit of 1 message.
    - Send a 10000-character message (`msg10k`) to the log collector.
    - Verify that the log collector contains 1 message and that it is truncated.
    - Reinitialize the log collector with a limit of 1 message.
    - Send two 9999-character messages (`msg9999`) to the log collector.
    - Verify that the log collector contains 2 messages: the first is the full `msg9999` and the second is truncated.
- **Output**: No return value; the function uses assertions to validate log collector behavior.


---
### test\_log\_messages\_weird\_behavior<!-- {{#callable:test_log_messages_weird_behavior}} -->
[View Source →](<../../../../../src/flamenco/log_collector/test_log_collector.c#L73>)

Tests the behavior of the log collector when handling a sequence of log messages, including a very large message that exceeds the log size limit.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_exec_instr_ctx_t` and `fd_exec_txn_ctx_t` structures and link them.
    - Create a large message `msg9999` with 9999 zeros.
    - Initialize the log collector with a size of 1.
    - Log a literal message 'x'.
    - Log the large message `msg9999` with a size of 9999.
    - Log two more literal messages 'x'.
    - Verify that the log collector contains four entries using `FD_TEST`.
    - Check that the first, third, and fourth log entries are 'x'.
    - Check that the second log entry is 'Log truncated', indicating the large message was too big to store completely.
- **Output**: No output is returned; the function performs internal tests using `FD_TEST` to validate log collector behavior.


---
### test\_log\_messages\_equivalences<!-- {{#callable:test_log_messages_equivalences}} -->
[View Source →](<../../../../../src/flamenco/log_collector/test_log_collector.c#L94>)

Tests the equivalence of log messages collected using different methods in a logging system.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_exec_instr_ctx_t` and `fd_exec_txn_ctx_t` structures and set up a log collector.
    - Define a message `msg` with specific byte values.
    - Initialize the log collector with a capacity of 1.
    - Loop 1000 times to log the message `msg` and a literal string "hello 12345, world!" using `fd_log_collector_msg` and `fd_log_collector_msg_literal`.
    - Verify the log collector's length and the content of specific log entries using `FD_TEST` and `fd_memeq`.
    - Reinitialize the log collector and repeat the logging loop using `fd_log_collector_msg` and `fd_log_collector_printf_dangerous_max_127` to log formatted strings.
    - Perform the same verification of log collector's length and content as before.
- **Output**: No output is returned; the function performs internal tests and assertions.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/flamenco/log_collector/test_log_collector.c#L129>)

Initializes the environment, runs a series of log message tests, and then terminates the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with the command-line arguments.
    - Executes the [`test_log_messages_bytes_limit`](<#test_log_messages_bytes_limit>) function to test log message byte limits.
    - Executes the [`test_log_messages_single_log_limit`](<#test_log_messages_single_log_limit>) function to test single log message size limits.
    - Executes the [`test_log_messages_weird_behavior`](<#test_log_messages_weird_behavior>) function to test unusual log message scenarios.
    - Executes the [`test_log_messages_equivalences`](<#test_log_messages_equivalences>) function to test log message equivalences.
    - Logs a notice message indicating the tests passed using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_log_messages_bytes_limit`](<#test_log_messages_bytes_limit>)
    - [`test_log_messages_single_log_limit`](<#test_log_messages_single_log_limit>)
    - [`test_log_messages_weird_behavior`](<#test_log_messages_weird_behavior>)
    - [`test_log_messages_equivalences`](<#test_log_messages_equivalences>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)