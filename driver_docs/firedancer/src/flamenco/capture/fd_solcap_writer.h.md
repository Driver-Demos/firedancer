<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for managing the lifecycle and operations of a capture writer object for SOLCAP_V1_BANK files.

# Purpose
The code is a C header file that defines the interface for a capture writer object, specifically for writing `SOLCAP_V1_BANK` files. The primary component is the `fd_solcap_writer_t` structure, which is an opaque handle to the capture writer object. The file provides a set of functions to manage the lifecycle of this writer object, including functions to create, initialize, and delete the writer. It also includes functions to write various components of a capture file, such as account data, bank preimages, transactions, and stake reward events.

The header file defines a public API for interacting with the `fd_solcap_writer_t` object. It includes functions for setting up the memory alignment and footprint requirements, initializing the writer with a stream, and flushing the writer to complete any outstanding writes. The API also supports writing specific data structures related to the Solana blockchain, such as accounts, bank preimages, and transactions. Additionally, it provides methods for handling stake rewards and writing arbitrary protobuf messages. The file includes necessary includes and type definitions to support these operations, ensuring that the writer can be used effectively in applications that require capturing and writing Solana blockchain data.
# Imports and Dependencies

---
- `fd_solcap_proto.h`
- `fd_solcap.pb.h`
- `../types/fd_types.h`


# Data Structures

---
### fd\_solcap\_writer\_t
- **Type**: ``struct``
- **Description**: `fd_solcap_writer_t` is an opaque handle to a capture writer object that implements writing SOLCAP_V1_BANK files. It provides a lifecycle API for creating, initializing, and deleting writer objects, as well as a user API for writing various components such as slots, accounts, bank preimages, transactions, and stake rewards to a stream. The structure is designed to manage the memory region backing the writer object and to facilitate the writing of capture file headers and data to a specified stream.


# Function Declarations (Public API)

---
### fd\_solcap\_writer\_set\_slot<!-- {{#callable_declaration:fd_solcap_writer_set_slot}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L85>)

Starts a new slot record and finishes any previous slot record.
- **Description**: Use this function to begin a new slot record in the capture writer. It finalizes any previous slot record and sets the current slot to the specified value. Ensure that slot numbers are monotonically increasing when calling this function. This function must be called after the writer has been successfully initialized and before writing account or bank data for the new slot.
- **Inputs**:
    - `writer`: A pointer to an `fd_solcap_writer_t` object. Must not be null. If null, the function returns immediately without making changes.
    - `slot`: An unsigned long integer representing the slot number. Slot numbers must be monotonically increasing.
- **Output**: None
- **See Also**: [`fd_solcap_writer_set_slot`](<fd_solcap_writer.c.md#fd_solcap_writer_set_slot>)  (Implementation)


---
### fd\_solcap\_write\_account<!-- {{#callable_declaration:fd_solcap_write_account}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L94>)

Appends an account record to the current slot's account delta hash.
- **Description**: Use this function to add an account record to the current slot's account delta hash in the capture stream. This function must be called only for accounts that are part of the current slot's account delta hash. Ensure that the writer object is properly initialized before calling this function. The order of accounts is arbitrary, and the function will return 0 if the writer is null, indicating that no operation was performed.
- **Inputs**:
    - `writer`: A pointer to an `fd_solcap_writer_t` object. Must not be null. The writer must be initialized and ready to write to a stream.
    - `key`: A pointer to a 32-byte key representing the account. Must not be null.
    - `meta`: A pointer to a `fd_solana_account_meta_t` structure containing metadata about the account. Must not be null.
    - `data`: A pointer to the account data. Must not be null.
    - `data_sz`: The size of the account data in bytes. Must be a valid size for the data provided.
- **Output**: Returns 0 if the writer is null, otherwise returns the result of the internal write operation.
- **See Also**: [`fd_solcap_write_account`](<fd_solcap_writer.c.md#fd_solcap_write_account>)  (Implementation)


---
### fd\_solcap\_write\_account2<!-- {{#callable_declaration:fd_solcap_write_account2}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L101>)

Appends account data and metadata to the capture stream.
- **Description**: Use this function to append account data and metadata to a capture stream for accounts that are part of the current slot's account delta hash. Ensure the writer is initialized before calling this function. The function writes the account data and metadata to the stream and updates the account table entry. It is important to manage the order of operations as specified in the API lifecycle, particularly ensuring that `set_slot` is called before this function.
- **Inputs**:
    - `writer`: A pointer to an initialized `fd_solcap_writer_t` object. Must not be null. The function returns immediately if this parameter is null.
    - `tbl`: A pointer to a constant `fd_solcap_account_tbl_t` structure containing account table information. The caller retains ownership.
    - `meta_pb`: A pointer to an `fd_solcap_AccountMeta` structure where the function will store serialized account metadata. The caller provides this structure, and the function modifies it.
    - `data`: A pointer to the account data to write. The data must be valid and the caller retains ownership. Must not be null.
    - `data_sz`: The size of the account data in bytes. Must be a valid size for the data provided.
- **Output**: Returns 0 on success. The function writes account data and metadata to the stream and updates the account table entry.
- **See Also**: [`fd_solcap_write_account2`](<fd_solcap_writer.c.md#fd_solcap_write_account2>)  (Implementation)


---
### fd\_solcap\_write\_bank\_preimage<!-- {{#callable_declaration:fd_solcap_write_bank_preimage}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L115>)

Sets fields for the current slot's bank hash preimage.
- **Description**: Use this function to set additional fields that are part of the current slot's bank hash preimage. This function must be called after initializing the writer and before writing the bank hash. It is important to ensure that the accounts used in the `account_delta_hash` match those passed to `fd_solcap_write_account`. The function handles null values for `account_delta_hash` and `accounts_lt_hash_checksum` by setting them to zero. The function returns an integer indicating success or failure.
- **Inputs**:
    - `writer`: A pointer to an `fd_solcap_writer_t` object. Must not be null. The function returns 0 if this parameter is null.
    - `bank_hash`: A pointer to a 32-byte hash representing the bank hash. Must not be null.
    - `prev_bank_hash`: A pointer to a 32-byte hash representing the previous bank hash. Must not be null.
    - `account_delta_hash`: A pointer to a 32-byte hash representing the Merkle root of changed accounts. Can be null, in which case the function sets it to zero.
    - `accounts_lt_hash_checksum`: A pointer to a 32-byte hash representing the checksum of accounts. Can be null, in which case the function sets it to zero.
    - `poh_hash`: A pointer to a 32-byte hash representing the PoH hash of the current block. Must not be null.
    - `signature_cnt`: An unsigned long integer representing the number of signatures. There are no specific constraints on this value.
- **Output**: Returns an integer indicating success or failure. Returns 0 if the `writer` is null.
- **See Also**: [`fd_solcap_write_bank_preimage`](<fd_solcap_writer.c.md#fd_solcap_write_bank_preimage>)  (Implementation)


---
### fd\_solcap\_write\_bank\_preimage2<!-- {{#callable_declaration:fd_solcap_write_bank_preimage2}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L124>)

Writes a bank preimage to the capture stream.
- **Description**: Use this function to write a bank preimage to the capture stream associated with the given writer. This function must be called after initializing the writer and setting the slot. It updates the preimage with the current slot and account table information, serializes it, and writes it to the stream. Ensure that the writer is valid and initialized before calling this function. If the writer is null, the function returns immediately with a success code. The function handles any necessary alignment and serialization internally.
- **Inputs**:
    - `writer`: A pointer to an `fd_solcap_writer_t` object. Must not be null. The function returns immediately with a success code if this parameter is null.
    - `preimage_pb`: A pointer to an `fd_solcap_BankPreimage` structure. The function updates this structure with the current slot and account table information before serializing and writing it to the stream.
- **Output**: Returns 0 on success or an error code if an error occurs during the writing process.
- **See Also**: [`fd_solcap_write_bank_preimage2`](<fd_solcap_writer.c.md#fd_solcap_write_bank_preimage2>)  (Implementation)


---
### fd\_solcap\_write\_transaction2<!-- {{#callable_declaration:fd_solcap_write_transaction2}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L132>)

Writes a transaction to the stream.
- **Description**: Use this function to append a transaction to the current slot's transaction hash in the stream. Ensure that the writer object is properly initialized before calling this function. The transaction must be part of the current slot's transaction hash. The function does not perform any operation if the writer is null, returning immediately in such cases.
- **Inputs**:
    - `writer`: A pointer to an initialized `fd_solcap_writer_t` object. Must not be null. The function returns immediately if this parameter is null.
    - `txn`: A pointer to a `fd_solcap_Transaction` object representing the transaction to write. Must not be null.
- **Output**: Returns 0 on success. If the writer is null, the function returns 0 without performing any operation.
- **See Also**: [`fd_solcap_write_transaction2`](<fd_solcap_writer.c.md#fd_solcap_write_transaction2>)  (Implementation)


---
### fd\_solcap\_writer\_stake\_rewards\_begin<!-- {{#callable_declaration:fd_solcap_writer_stake_rewards_begin}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L138>)

Begins a new stake rewards record in the writer.
- **Description**: Use this function to start recording a new stake rewards event in the capture writer. It initializes the necessary data structure with the provided epoch and reward information. This function must be called after the writer has been successfully initialized and before any stake reward events are recorded. Ensure that the writer is in a valid state to accept new records.
- **Inputs**:
    - `writer`: A pointer to an initialized `fd_solcap_writer_t` object. Must not be null. The caller retains ownership.
    - `payout_epoch`: The epoch in which the payout occurs. Must be a valid unsigned long value.
    - `reward_epoch`: The epoch for which the reward is calculated. Must be a valid unsigned long value.
    - `inflation_lamports`: The number of lamports generated by inflation for the reward epoch. Must be a valid unsigned long value.
    - `total_points`: The total points accumulated for the reward epoch. Must be a valid `uint128` value.
- **Output**: Returns an integer status code. A non-zero value indicates an error.
- **See Also**: [`fd_solcap_writer_stake_rewards_begin`](<fd_solcap_writer.c.md#fd_solcap_writer_stake_rewards_begin>)  (Implementation)


---
### fd\_solcap\_write\_stake\_reward\_event<!-- {{#callable_declaration:fd_solcap_write_stake_reward_event}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L147>)

Writes a stake reward event to the capture stream.
- **Description**: Use this function to record a stake reward event in the capture stream. It requires a writer object that has been successfully initialized. The function writes the event details, including commission, vote rewards, stake rewards, and new credits observed, to the stream. Ensure that the writer is properly initialized and that the public key addresses provided are valid and non-null. This function returns an integer indicating success or failure of the write operation.
- **Inputs**:
    - `writer`: A pointer to an initialized `fd_solcap_writer_t` object. Must not be null. The caller retains ownership.
    - `stake_acc_addr`: A pointer to a `fd_pubkey_t` representing the stake account address. Must not be null. The caller retains ownership.
    - `vote_acc_addr`: A pointer to a `fd_pubkey_t` representing the vote account address. Must not be null. The caller retains ownership.
    - `commission`: An unsigned integer representing the commission percentage. Valid range is 0 to 100.
    - `vote_rewards`: A long integer representing the vote rewards. Can be negative or positive.
    - `stake_rewards`: A long integer representing the stake rewards. Can be negative or positive.
    - `new_credits_observed`: A long integer representing the new credits observed. Can be negative or positive.
- **Output**: Returns an integer indicating the success (0) or failure (non-zero) of the write operation.
- **See Also**: [`fd_solcap_write_stake_reward_event`](<fd_solcap_writer.c.md#fd_solcap_write_stake_reward_event>)  (Implementation)


---
### fd\_solcap\_write\_vote\_account\_payout<!-- {{#callable_declaration:fd_solcap_write_vote_account_payout}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L158>)

Writes a vote account payout to the capture stream.
- **Description**: Use this function to record a vote account payout in the capture stream. It requires a valid writer object that has been initialized and a vote account address. The function also needs the update slot number, the current lamports balance, and the change in lamports since the last update. Ensure that the writer is properly initialized before calling this function. The function returns an integer indicating success or failure.
- **Inputs**:
    - `writer`: A pointer to an initialized `fd_solcap_writer_t` object. Must not be null. The caller retains ownership.
    - `vote_acc_addr`: A pointer to a `fd_pubkey_t` representing the vote account address. Must not be null. The caller retains ownership.
    - `update_slot`: An unsigned long integer representing the slot number at which the update occurs. Must be a valid slot number.
    - `lamports`: An unsigned long integer representing the current balance of lamports in the vote account. Must be a valid lamports value.
    - `lamports_delta`: A long integer representing the change in lamports since the last update. Can be positive or negative.
- **Output**: Returns an integer indicating success (0) or failure (non-zero).
- **See Also**: [`fd_solcap_write_vote_account_payout`](<fd_solcap_writer.c.md#fd_solcap_write_vote_account_payout>)  (Implementation)


---
### fd\_solcap\_write\_stake\_account\_payout<!-- {{#callable_declaration:fd_solcap_write_stake_account_payout}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L167>)

Writes a stake account payout to the capture stream.
- **Description**: Use this function to record a stake account payout event in the capture stream. It requires a valid and initialized writer object. The function writes details of the stake account payout, including the update slot, lamports, credits observed, and delegation stake, along with their respective deltas. Ensure that the `writer` is properly initialized and that the `stake_acc_addr` is a valid public key. This function is typically used in the context of capturing stake reward events.
- **Inputs**:
    - `writer`: A pointer to an initialized `fd_solcap_writer_t` object. Must not be null. The caller retains ownership.
    - `stake_acc_addr`: A pointer to a `fd_pubkey_t` representing the stake account address. Must not be null. The caller retains ownership.
    - `update_slot`: An unsigned long representing the slot number at which the update occurs. Must be a valid slot number.
    - `lamports`: An unsigned long representing the total lamports in the stake account. Must be a valid lamport amount.
    - `lamports_delta`: A long representing the change in lamports since the last update. Can be positive or negative.
    - `credits_observed`: An unsigned long representing the total credits observed in the stake account. Must be a valid credit amount.
    - `credits_observed_delta`: A long representing the change in credits observed since the last update. Can be positive or negative.
    - `delegation_stake`: An unsigned long representing the total delegation stake in the stake account. Must be a valid stake amount.
    - `delegation_stake_delta`: A long representing the change in delegation stake since the last update. Can be positive or negative.
- **Output**: Returns an integer status code. A non-zero value indicates an error.
- **See Also**: [`fd_solcap_write_stake_account_payout`](<fd_solcap_writer.c.md#fd_solcap_write_stake_account_payout>)  (Implementation)


---
### fd\_solcap\_write\_protobuf<!-- {{#callable_declaration:fd_solcap_write_protobuf}} -->
[View Source →](<../../../../../src/flamenco/capture/fd_solcap_writer.h#L185>)

Writes an arbitrary protobuf blob to a capture writer.
- **Description**: Use this function to write a protobuf message to a capture writer. The function requires a valid `fd_solcap_writer_t` object that has been properly initialized. It encodes the message using the provided descriptor and writes it to the writer's stream. The function uses a 1 MiB stack buffer for encoding. If the writer is null, the function returns 0 immediately. If encoding fails, it logs a warning and returns an error code. Ensure the writer is initialized before calling this function.
- **Inputs**:
    - `writer`: A pointer to an `fd_solcap_writer_t` object. Must not be null. The writer must be initialized before use.
    - `msg`: A pointer to the message to encode. The content and format must match the provided descriptor.
    - `desc`: A pointer to a `pb_msgdesc_s` structure that describes the message format. Must not be null.
    - `magic`: An unsigned long value used as a magic number in the written data. It is included in the output for identification or validation purposes.
- **Output**: Returns 0 on success. Returns an error code if encoding fails or if the writer is null.
- **See Also**: [`fd_solcap_write_protobuf`](<fd_solcap_writer.c.md#fd_solcap_write_protobuf>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)