<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the correctness of AST walk instructions generated by `fd_types_walk` using a recorder.

# Purpose
The code is a C test program designed to verify the correctness of a sequence of Abstract Syntax Tree (AST) walk instructions generated by the function `fd_types_walk`. It includes a structure `fd_flamenco_type_step_t` to hold values recorded during the invocation of the `fd_types_walk_fn_t` callback function. The `fd_flamenco_walk_recorder_t` structure is used to store a buffer of these steps, with a maximum capacity defined by `STEPS_MAX`. The function [`fd_flamenco_walk_recorder`](<#fd_flamenco_walk_recorder>) records each step of the AST walk, ensuring that the number of steps does not exceed the buffer's capacity.

The program includes a static instance of `fd_flamenco_walk_recorder_t` to store the recorded steps. It also defines an expected sequence of steps, `vote_account_walk`, which represents the correct sequence of AST walk instructions for a test ledger. The function [`test_vote_account_walk`](<#test_vote_account_walk>) decodes a binary blob representing a vote account, walks through the AST using the recorder, and compares the recorded steps against the expected sequence. Any discrepancies between the actual and expected steps are logged as warnings, and the program terminates with an error if a mismatch is found. The [`main`](<#main>) function initializes the environment, executes the test, and ensures that no memory is left allocated in the scratch space before halting.
# Imports and Dependencies

---
- `../fd_flamenco.h`
- `fd_types.h`


# Global Variables

---
### recorder
- **Type**: ``fd_flamenco_walk_recorder_t[1]``
- **Description**: The `recorder` is a static array of one `fd_flamenco_walk_recorder_t` structure. This structure contains a buffer to store `fd_flamenco_type_step_t` values and a counter to track the number of steps recorded.
- **Use**: Used to record a sequence of abstract syntax tree (AST) walk instructions during the execution of the `fd_types_walk_fn_t` callback function.


---
### vote\_account\_walk
- **Type**: ``fd_flamenco_type_step_t[]``
- **Description**: Contains a sequence of `fd_flamenco_type_step_t` structures that represent the expected steps for walking through a vote account data structure. Each element in the array specifies a level, type, and optional name and data pointer, which describe the structure and data of the vote account.
- **Use**: Used to verify the correctness of the sequence of steps generated by the `fd_types_walk_fn_t` callback function during a test.


# Data Structures

---
### fd\_flamenco\_type\_step
- **Type**: ``struct``
- **Members**:
    - `level`: Indicates the depth level of the current step in the AST walk.
    - `type`: Specifies the type of the current step in the AST walk.
    - `name`: Holds the name associated with the current step, if applicable.
    - `data`: Points to additional data related to the current step.
- **Description**: Represents a step in an Abstract Syntax Tree (AST) walk, capturing details such as the level, type, name, and associated data for each step in the sequence.


---
### fd\_flamenco\_type\_step\_t
- **Type**: ``struct``
- **Members**:
    - `level`: Indicates the depth level of the current step in the AST walk.
    - `type`: Specifies the type of the current step in the AST walk.
    - `name`: Holds the name associated with the current step, if applicable.
    - `data`: Points to additional data related to the current step.
- **Description**: Represents a structure that records information about each step during an Abstract Syntax Tree (AST) walk, capturing the level, type, name, and associated data of each step.


---
### fd\_flamenco\_walk\_recorder
- **Type**: ``struct``
- **Members**:
    - `steps`: An array of `fd_flamenco_type_step_t` that stores recorded steps.
    - `step_cnt`: A counter of type `ulong` that tracks the number of steps recorded.
- **Description**: Holds a buffer of `fd_flamenco_type_step_t` values and a counter to track the number of steps recorded during an AST walk.


---
### fd\_flamenco\_walk\_recorder\_t
- **Type**: ``struct``
- **Members**:
    - `steps`: An array of `fd_flamenco_type_step_t` structures that records the steps of a walk.
    - `step_cnt`: A counter that tracks the number of steps recorded in the `steps` array.
- **Description**: Holds a buffer of `fd_flamenco_type_step_t` values and provides the `fd_types_walk_fn_t` method to record a sequence of abstract syntax tree (AST) walk instructions. The `steps` array can store up to `STEPS_MAX` entries, and `step_cnt` keeps track of the number of entries currently stored.


# Functions

---
### fd\_flamenco\_walk\_recorder<!-- {{#callable:fd_flamenco_walk_recorder}} -->
[View Source →](<../../../../../src/flamenco/types/test_types_walk.c#L31>)

Records a step in the `fd_flamenco_walk_recorder_t` structure with the given parameters.
- **Inputs**:
    - `_self`: A pointer to the `fd_flamenco_walk_recorder_t` instance where the step will be recorded.
    - `arg`: A pointer to the data associated with the step.
    - `name`: A string representing the name of the step.
    - `type`: An integer representing the type of the step.
    - `type_name`: A string representing the name of the type, which is unused in this function.
    - `level`: An unsigned integer representing the level of the step.
    - `_unused`: An unsigned integer that is not used in this function.
- **Logic and Control Flow**:
    - Cast `_self` to a pointer of type `fd_flamenco_walk_recorder_t`.
    - Check if `step_cnt` is less than `STEPS_MAX` using `FD_TEST`.
    - Assign a new `fd_flamenco_type_step_t` to the `steps` array at the index `step_cnt` with the provided `level`, `type`, `name`, and `arg`.
    - Increment `step_cnt` by 1.
- **Output**: No return value; the function modifies the `fd_flamenco_walk_recorder_t` instance pointed to by `_self`.


---
### test\_vote\_account\_walk<!-- {{#callable:test_vote_account_walk}} -->
[View Source →](<../../../../../src/flamenco/types/test_types_walk.c#L146>)

Validates the sequence of Abstract Syntax Tree (AST) walk instructions generated by `fd_types_walk` against an expected sequence.
- **Inputs**: None
- **Logic and Control Flow**:
    - Begins a scratch memory scope using `FD_SCRATCH_SCOPE_BEGIN` and `FD_SCRATCH_SCOPE_END` to manage temporary memory usage.
    - Decodes a binary-encoded vote account state using `fd_bincode_decode_scratch` and checks for successful decoding with `FD_TEST`.
    - Invokes [`fd_vote_state_versioned_walk`](<fd_types.c.md#fd_vote_state_versioned_walk>) to traverse the decoded state and record the steps using `fd_flamenco_walk_recorder`.
    - Iterates over the recorded steps and compares each step with the expected steps defined in `vote_account_walk`.
    - Logs a warning and triggers an error if there is a mismatch between the expected and actual steps.
    - Ensures that the number of recorded steps matches the expected steps and that the iteration completes without errors.
- **Output**: No direct output; logs warnings and errors if mismatches occur during the validation process.
- **Functions Called**:
    - [`fd_vote_state_versioned_walk`](<fd_types.c.md#fd_vote_state_versioned_walk>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/flamenco/types/test_types_walk.c#L196>)

Initializes the environment, runs a test on vote account data, and ensures proper cleanup before exiting.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Allocates a static memory buffer `scratch_mem` of 32 MiB and a static aligned memory buffer `scratch_fmem`.
    - Attaches the scratch memory using `fd_scratch_attach`.
    - Calls [`test_vote_account_walk`](<#test_vote_account_walk>) to perform a test on vote account data.
    - Logs a notice message indicating the test passed.
    - Asserts that no scratch memory is used with `FD_TEST`.
    - Detaches the scratch memory using `fd_scratch_detach`.
    - Calls `fd_halt` to perform any necessary cleanup before exiting.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_vote_account_walk`](<#test_vote_account_walk>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)