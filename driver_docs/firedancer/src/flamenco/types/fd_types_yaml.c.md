<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions for converting a bincode-like AST into a YAML text stream with serialization support.

# Purpose
The code provides functionality for converting an abstract syntax tree (AST) of nodes into a YAML text stream. It defines a set of functions and macros to manage the state of a YAML writer, allowing for the serialization of various data types into a structured YAML format. The code includes functions to initialize and delete a YAML writer object, manage the serialization state, and handle different data types such as integers, floats, strings, and complex types like hashes and signatures. The [`fd_flamenco_yaml_walk`](<#fd_flamenco_yaml_walk>) function is central to this process, iterating over the AST nodes and writing the corresponding YAML output to a file.

The code is part of a library intended to be used in other applications, as indicated by the inclusion of header files and the use of external functions like `fd_base58_encode_32`. It defines a public API for creating and managing YAML writer objects, with functions like [`fd_flamenco_yaml_new`](<#fd_flamenco_yaml_new>), [`fd_flamenco_yaml_init`](<#fd_flamenco_yaml_init>), and [`fd_flamenco_yaml_walk`](<#fd_flamenco_yaml_walk>). The code also includes a global variable `g_yaml` and functions [`fd_get_types_yaml`](<#fd_get_types_yaml>) and [`fd_flush_yaml_dump`](<#fd_flush_yaml_dump>) to manage a singleton instance of the YAML writer, ensuring that the YAML output can be flushed to the file when needed.
# Imports and Dependencies

---
- `fd_types_yaml.h`
- `fd_types_meta.h`
- `../../ballet/base58/fd_base58.h`
- `ctype.h`
- `stdio.h`
- `stdlib.h`


# Global Variables

---
### g\_yaml
- **Type**: ``fd_flamenco_yaml_t *``
- **Description**: A global pointer to an `fd_flamenco_yaml_t` structure, initialized to `NULL`. This structure is used to manage the state and operations for converting an AST of nodes into a YAML text stream.
- **Use**: Used to store and manage the state of the YAML writer throughout the program.


# Functions

---
### fd\_flamenco\_yaml\_new<!-- {{#callable:fd_flamenco_yaml_new}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L65>)

Initializes a `fd_flamenco_yaml_t` structure in the provided memory space.
- **Inputs**:
    - `mem`: A pointer to a memory space where the `fd_flamenco_yaml_t` structure will be initialized.
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if true, log a warning and return NULL.
    - Cast `mem` to a `fd_flamenco_yaml_t` pointer and assign it to `yaml`.
    - Initialize the `yaml` structure to zero using `memset`.
    - Set the `indent` field of `yaml` to spaces using `memset`.
    - Return the initialized `fd_flamenco_yaml_t` pointer.
- **Output**: A pointer to the initialized `fd_flamenco_yaml_t` structure, or NULL if `mem` is NULL.


---
### fd\_flamenco\_yaml\_delete<!-- {{#callable:fd_flamenco_yaml_delete}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L79>)

Returns the input `yaml` pointer without modification.
- **Inputs**:
    - `yaml`: A pointer to an `fd_flamenco_yaml_t` structure.
- **Logic and Control Flow**:
    - The function takes a single argument, `yaml`, which is a pointer to an `fd_flamenco_yaml_t` structure.
    - It returns the same `yaml` pointer without performing any operations on it.
- **Output**: A pointer to the `fd_flamenco_yaml_t` structure passed as input.


---
### fd\_flamenco\_yaml\_init<!-- {{#callable:fd_flamenco_yaml_init}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L84>)

Initializes a `fd_flamenco_yaml_t` structure with a given file pointer.
- **Inputs**:
    - `self`: A pointer to a `fd_flamenco_yaml_t` structure to initialize.
    - `_file`: A pointer to a file or file-like object to associate with the `fd_flamenco_yaml_t` structure.
- **Logic and Control Flow**:
    - Check if `self` is NULL; if true, log a warning and return NULL.
    - Check if `_file` is NULL; if true, log a warning and return NULL.
    - Assign `_file` to the `file` member of the `self` structure.
    - Return the initialized `self` structure.
- **Output**: Returns the initialized `fd_flamenco_yaml_t` structure, or NULL if an input is invalid.


---
### fd\_flamenco\_yaml\_file<!-- {{#callable:fd_flamenco_yaml_file}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L102>)

Returns the file pointer associated with a given `fd_flamenco_yaml_t` structure.
- **Inputs**:
    - `self`: A pointer to an `fd_flamenco_yaml_t` structure from which to retrieve the file pointer.
- **Logic and Control Flow**:
    - Accesses the `file` member of the `fd_flamenco_yaml_t` structure pointed to by `self`.
    - Returns the value of the `file` member.
- **Output**: A pointer to the file associated with the `fd_flamenco_yaml_t` structure.


---
### fd\_flamenco\_yaml\_walk<!-- {{#callable:fd_flamenco_yaml_walk}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L113>)

Serializes a YAML structure from a bincode-like AST of nodes, handling indentation and formatting based on node types and levels.
- **Inputs**:
    - `_self`: A pointer to the `fd_flamenco_yaml_t` structure that maintains the state of the YAML serialization.
    - `arg`: A pointer to the data associated with the current node, used for printing the node's value.
    - `name`: A string representing the name of the current node, used for printing the node's tag.
    - `type`: An integer representing the type of the current node, which determines how the node is serialized.
    - `type_name`: A string representing the name of the type, but it is not used in the function.
    - `level`: An unsigned integer representing the current indentation level in the YAML structure.
    - `varint`: An unsigned integer that is not used in the function.
- **Logic and Control Flow**:
    - Check if the `level` exceeds `FD_FLAMENCO_YAML_MAX_INDENT-1` and log a warning if true, then return.
    - Return immediately if `type` is `FD_FLAMENCO_TYPE_ENUM_DISC`.
    - Cast `_self` to `fd_flamenco_yaml_t` and retrieve the `file` pointer.
    - Determine if the current position is at the beginning of a collection and handle inline or separate line printing based on the collection's state.
    - Indent the output based on the current `level` if not at the start of a new object or array.
    - Print the node's tag based on the current state in `self->stack[level]`.
    - Print the node's value based on the `type`, using different formats for different data types.
    - Update `self->stack[level]` to indicate that an element has been processed at the current level.
- **Output**: No return value; the function writes the serialized YAML output to the file associated with the `fd_flamenco_yaml_t` structure.
- **Functions Called**:
    - [`fd_flamenco_type_is_collection_end`](<fd_types_meta.h.md#fd_flamenco_type_is_collection_end>)


---
### fd\_get\_types\_yaml<!-- {{#callable:fd_get_types_yaml}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L341>)

Returns a singleton instance of `fd_flamenco_yaml_t`, initializing it if necessary.
- **Inputs**: None
- **Logic and Control Flow**:
    - Check if `g_yaml` is not `NULL`.
    - If `g_yaml` is not `NULL`, return `g_yaml`.
    - If `g_yaml` is `NULL`, allocate memory for a new `fd_flamenco_yaml_t` instance using `malloc` and `fd_flamenco_yaml_footprint()`.
    - Initialize the new `fd_flamenco_yaml_t` instance with [`fd_flamenco_yaml_init`](<#fd_flamenco_yaml_init>), passing `stdout` as the file parameter.
    - Assign the initialized instance to `g_yaml`.
    - Return `g_yaml`.
- **Output**: A pointer to a `fd_flamenco_yaml_t` instance.
- **Functions Called**:
    - [`fd_flamenco_yaml_init`](<#fd_flamenco_yaml_init>)
    - [`fd_flamenco_yaml_new`](<#fd_flamenco_yaml_new>)
    - [`fd_flamenco_yaml_footprint`](<fd_types_yaml.h.md#fd_flamenco_yaml_footprint>)


---
### fd\_flush\_yaml\_dump<!-- {{#callable:fd_flush_yaml_dump}} -->
[View Source →](<../../../../../src/flamenco/types/fd_types_yaml.c#L349>)

Flushes the file stream associated with the global YAML writer `g_yaml` if it is not NULL.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if the global variable `g_yaml` is not NULL.
    - If `g_yaml` is not NULL, calls `fflush` on `g_yaml->file` to flush the file stream.
- **Output**: No output or return value.



---
Made with ❤️ by [Driver](https://www.driver.ai/)