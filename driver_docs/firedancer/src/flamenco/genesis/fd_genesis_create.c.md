<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Creates a Solana genesis block with specified configurations and accounts.

# Purpose
The code defines a function [`fd_genesis_create`](<#fd_genesis_create>) that initializes and encodes a Solana blockchain genesis configuration. This function is part of a C source file that includes several headers related to Solana's runtime, system variables, and types. The primary purpose of this code is to set up the initial state of a Solana blockchain network, specifically for a development cluster. It configures various parameters such as the cluster type, creation time, tick duration, fee rate governor, rent configuration, inflation configuration, and epoch schedule. Additionally, it creates and configures several accounts, including faucet, identity, vote, stake, and stake configuration accounts.

The function [`genesis_create`](<#genesis_create>) is the core component, which performs the setup and encoding of the genesis state. It uses several helper macros and functions to ensure the configuration is valid and to handle memory allocation. The code also includes logic to handle feature gates and primordial accounts, ensuring that all accounts are sorted and checked for duplicates before encoding the final genesis state into a binary format. The [`fd_genesis_create`](<#fd_genesis_create>) function acts as a wrapper around [`genesis_create`](<#genesis_create>), managing the scratch memory scope for temporary allocations. This code is intended to be part of a larger system that initializes a Solana blockchain network, providing a foundational setup for further operations.
# Imports and Dependencies

---
- `fd_genesis_create.h`
- `../runtime/fd_system_ids.h`
- `../runtime/program/fd_stake_program.h`
- `../runtime/program/fd_vote_program.h`
- `../runtime/sysvar/fd_sysvar_clock.h`
- `../runtime/sysvar/fd_sysvar_rent.h`
- `../types/fd_types.h`
- `../../util/tmpl/fd_sort.c`


# Global Variables

---
### stake\_account\_index
- **Type**: ``ulong``
- **Description**: Represents the index of the stake account in the `genesis->accounts` array. It is initialized by incrementing the `accounts_len` field of the `genesis` structure.
- **Use**: Used to track the position of the stake account within the `genesis->accounts` array.


---
### stake\_data
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size defined by `FD_STAKE_STATE_V2_SZ`. It is initialized with zeros.
- **Use**: Holds encoded stake state data for a stake account in the genesis configuration.


---
### stake\_state\_min\_bal
- **Type**: `ulong`
- **Description**: The variable `stake_state_min_bal` is an unsigned long integer that stores the minimum balance required for a stake account to be exempt from rent. This value is calculated using the function `fd_rent_exempt_minimum_balance`, which takes the rent configuration from the `genesis` structure and the size of the stake state data (`FD_STAKE_STATE_V2_SZ`) as parameters.
- **Use**: Used to determine the rent-exempt reserve for stake accounts.


---
### vote\_min\_bal
- **Type**: `ulong`
- **Description**: The `vote_min_bal` variable is an unsigned long integer that stores the minimum balance required for a vote account to be rent-exempt. This value is calculated using the `fd_rent_exempt_minimum_balance` function, which takes the rent configuration from the `genesis` structure and the size of the vote state data (`FD_VOTE_STATE_V3_SZ`) as parameters.
- **Use**: Used to ensure that vote accounts have a sufficient balance to be exempt from rent charges.


---
### stake\_cfg\_account\_index
- **Type**: ``ulong``
- **Description**: Represents the index of the stake configuration account in the `genesis` account array. It is initialized by incrementing the `accounts_len` field of the `genesis` structure.
- **Use**: Used to track the position of the stake configuration account within the `genesis` account array.


---
### stake\_cfg\_data
- **Type**: ``uchar[10]``
- **Description**: An array of 10 unsigned characters used to store encoded stake configuration data.
- **Use**: Used to hold the encoded data of a `fd_stake_config_t` structure for a stake configuration account.


---
### feature\_cnt
- **Type**: ``ulong``
- **Description**: `feature_cnt` is a global variable of type `ulong` that is initialized to 0UL. It is used to count the number of enabled features in the system.
- **Use**: Tracks the number of enabled features by incrementing for each feature that is enabled in the `options->features`.


---
### features
- **Type**: ``fd_pubkey_t *``
- **Description**: A pointer to an array of `fd_pubkey_t` structures, which are public key representations. The array is allocated with a size based on `FD_FEATURE_ID_CNT`, which indicates the number of features.
- **Use**: Used to store public keys of enabled features in the system.


---
### default\_funded\_cnt
- **Type**: `ulong`
- **Description**: Stores the number of initial accounts to fund during the genesis creation process. It is initialized with the value from `options->fund_initial_accounts`. This variable is used to determine how many accounts will receive an initial balance in the genesis block.
- **Use**: Determines the number of accounts to fund initially in the genesis block creation.


---
### default\_funded\_idx
- **Type**: ``ulong``
- **Description**: Represents the starting index in the `genesis->accounts` array for accounts that will be funded by default during the genesis creation process. The value is initialized to the current length of the `accounts` array and is incremented by the number of default funded accounts (`default_funded_cnt`).
- **Use**: Used to track the position in the `accounts` array where default funded accounts are added.


---
### feature\_gate\_idx
- **Type**: ``ulong``
- **Description**: `feature_gate_idx` is a global variable of type `ulong` that stores the starting index for feature gate accounts in the `genesis->accounts` array. It is initialized to the current length of the accounts array (`genesis->accounts_len`) and then the length is incremented by the number of features (`feature_cnt`).
- **Use**: Used to track the position in the accounts array where feature gate accounts begin.


---
### default\_funded\_balance
- **Type**: `ulong`
- **Description**: Represents the initial amount of lamports to fund each primordial account in the genesis block creation process.
- **Use**: Used to set the `lamports` field for each primordial account in the `genesis->accounts` array.


---
### feature\_enabled\_data
- **Type**: ``static const uchar``
- **Description**: An array of unsigned characters with a fixed size of 9 elements, initialized with the values `{ 1, 0, 0, 0, 0, 0, 0, 0, 0 }`. This array is used to represent the data for enabled features in the system.
- **Use**: Used as the data for feature gate accounts in the genesis configuration.


---
### default\_feature\_enabled\_balance
- **Type**: `ulong`
- **Description**: Holds the minimum balance required for a feature account to be rent-exempt, calculated using the `fd_rent_exempt_minimum_balance` function with the `genesis->rent` configuration and a fixed size of `FEATURE_ENABLED_SZ`. This ensures that feature accounts have enough balance to avoid being charged rent.
- **Use**: Used to initialize the `lamports` field of feature gate accounts in the `genesis->accounts` array.


---
### encode
- **Type**: ``fd_bincode_encode_ctx_t``
- **Description**: The `encode` variable is an instance of the `fd_bincode_encode_ctx_t` structure. It is initialized with a data buffer and a pointer to the end of this buffer. This structure is used to manage the encoding context for binary data operations.
- **Use**: Used to encode data into a binary format within the `genesis_create` function.


---
### encode\_err
- **Type**: `int`
- **Description**: `encode_err` is an integer variable that stores the result of the `fd_genesis_solana_encode` function call. This function attempts to encode the `genesis` data structure into a binary format using the `encode` context.
- **Use**: Checks if the encoding of the `genesis` data structure was successful by evaluating if `encode_err` is non-zero.


# Functions

---
### genesis\_create<!-- {{#callable:genesis_create}} -->
[View Source →](<../../../../../src/flamenco/genesis/fd_genesis_create.c#L16>)

Initializes and encodes a Solana genesis configuration into a buffer based on provided options.
- **Inputs**:
    - ``buf``: A pointer to the buffer where the encoded genesis configuration will be stored.
    - ``bufsz``: The size of the buffer `buf`.
    - ``options``: A pointer to a `fd_genesis_options_t` structure containing configuration options for the genesis creation.
- **Logic and Control Flow**:
    - Define a macro `REQUIRE` to check conditions and log warnings if they fail.
    - Initialize a `fd_genesis_solana_t` structure and set its `cluster_type` to development mode.
    - Set various genesis parameters from `options`, such as `creation_time`, `ticks_per_slot`, and `poh_config`.
    - Create and configure the fee rate governor, rent, inflation, and epoch schedule settings.
    - Create accounts for faucet, identity, vote, stake, and stake configuration using the provided options.
    - Allocate and initialize default funded accounts and feature gate accounts.
    - Sort the accounts and check for duplicates, logging a warning if duplicates are found.
    - Encode the genesis configuration into the provided buffer using `fd_genesis_solana_encode`.
    - Return the number of bytes written to the buffer or 0 if an error occurs.
- **Output**: Returns the number of bytes written to the buffer `buf` if successful, or 0 if an error occurs.


---
### fd\_genesis\_create<!-- {{#callable:fd_genesis_create}} -->
[View Source →](<../../../../../src/flamenco/genesis/fd_genesis_create.c#L328>)

Creates a genesis block using the provided buffer, buffer size, and genesis options.
- **Inputs**:
    - ``buf``: A pointer to the buffer where the genesis block will be encoded.
    - ``bufsz``: The size of the buffer in bytes.
    - ``options``: A pointer to a `fd_genesis_options_t` structure containing the genesis configuration options.
- **Logic and Control Flow**:
    - Pushes the current state onto the scratch stack using `fd_scratch_push()`.
    - Calls the [`genesis_create`](<#genesis_create>) function with the provided buffer, buffer size, and options to create the genesis block.
    - Pops the state from the scratch stack using `fd_scratch_pop()`.
    - Returns the result of the [`genesis_create`](<#genesis_create>) function call.
- **Output**: Returns an unsigned long integer representing the number of bytes written to the buffer, or 0 if an error occurs.
- **Functions Called**:
    - [`genesis_create`](<#genesis_create>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)