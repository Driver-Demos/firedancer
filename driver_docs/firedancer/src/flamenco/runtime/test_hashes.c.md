<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for hash functions in the Firedancer codebase, including account hash and bank hash computations.

# Purpose
The code is a C test suite designed to verify the functionality of hash-related operations in a financial or blockchain context. It includes tests for functions that compute and verify hash values for accounts and banks. The code imports several header files, indicating dependencies on utility functions, hash definitions, and data types. The main components of the code are three test functions: [`test_fd_hashes_account_lthash`](<#test_fd_hashes_account_lthash>), [`test_fd_hashes_hash_bank`](<#test_fd_hashes_hash_bank>), and [`test_fd_hashes_update_lthash`](<#test_fd_hashes_update_lthash>). Each function tests specific aspects of hash computation and validation.

The [`test_fd_hashes_account_lthash`](<#test_fd_hashes_account_lthash>) function tests the computation of hash values for account metadata under different conditions, such as varying lamport values and executable flags. The [`test_fd_hashes_hash_bank`](<#test_fd_hashes_hash_bank>) function verifies the computation of a bank hash using previous bank hash values, last block hash, and a signature count. The [`test_fd_hashes_update_lthash`](<#test_fd_hashes_update_lthash>) function simulates the update of a ledger transaction hash (lthash) by subtracting a previous hash and adding a new one, ensuring the correctness of the update process. The code concludes with a [`main`](<#main>) function that initializes the test environment, runs the tests, and logs the results.
# Imports and Dependencies

---
- `../../util/fd_util_base.h`
- `fd_hashes.h`
- `../../ballet/lthash/fd_lthash.h`
- `../types/fd_types.h`
- `string.h`
- `stdio.h`


# Global Variables

---
### test\_meta
- **Type**: ``fd_account_meta_t``
- **Description**: Represents metadata for an account, including the number of lamports, executable status, owner, and data length. It is used in hash calculations for account data.
- **Use**: Used to store and manipulate account metadata for testing hash functions.


---
### test\_data
- **Type**: ``uchar[64]``
- **Description**: An array of 64 unsigned characters used to store test data.
- **Use**: Used in the `test_fd_hashes_update_lthash` function to hold data for hash calculations.


# Functions

---
### fd\_lthash\_equal<!-- {{#callable:fd_lthash_equal}} -->
[View Source →](<../../../../../src/flamenco/runtime/test_hashes.c#L9>)

Compares two `fd_lthash_value_t` structures to check if their byte arrays are equal.
- **Inputs**:
    - `a`: A pointer to the first `fd_lthash_value_t` structure to compare.
    - `b`: A pointer to the second `fd_lthash_value_t` structure to compare.
- **Logic and Control Flow**:
    - Calls `memcmp` to compare the `bytes` arrays of `a` and `b` for `FD_LTHASH_LEN_BYTES` bytes.
    - Returns the result of the comparison, which is `1` if the arrays are equal and `0` otherwise.
- **Output**: An integer indicating whether the two hash values are equal (`1` for equal, `0` for not equal).


---
### fd\_hash\_equal<!-- {{#callable:fd_hash_equal}} -->
[View Source →](<../../../../../src/flamenco/runtime/test_hashes.c#L14>)

Compares two hash values for equality by checking if their memory contents are identical.
- **Inputs**:
    - ``a``: A pointer to the first `fd_hash_t` structure to compare.
    - ``b``: A pointer to the second `fd_hash_t` structure to compare.
- **Logic and Control Flow**:
    - Uses `memcmp` to compare the memory contents of `a->uc` and `b->uc` for `FD_HASH_FOOTPRINT` bytes.
    - Returns `1` if the memory contents are identical, indicating the hashes are equal.
    - Returns `0` if the memory contents differ, indicating the hashes are not equal.
- **Output**: An integer value indicating whether the two hashes are equal (`1` for equal, `0` for not equal).


---
### test\_fd\_hashes\_account\_lthash<!-- {{#callable:test_fd_hashes_account_lthash}} -->
[View Source →](<../../../../../src/flamenco/runtime/test_hashes.c#L19>)

Tests the [`fd_hashes_account_lthash`](<fd_hashes.c.md#fd_hashes_account_lthash>) function with various account configurations to ensure correct hash generation.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test with `FD_LOG_NOTICE`.
    - Executes four test cases with different account configurations.
    - In each test case, initializes a `fd_pubkey_t` and `fd_account_meta_t` with specific values.
    - Calls [`fd_hashes_account_lthash`](<fd_hashes.c.md#fd_hashes_account_lthash>) to compute the hash for the account.
    - Compares the computed hash with an expected hash using [`fd_lthash_equal`](<#fd_lthash_equal>).
    - Logs an error with `FD_LOG_ERR` if the computed hash does not match the expected hash.
    - Uses `FD_TEST` to assert that the computed hash matches the expected hash.
    - In test case 4, verifies that the `executable` field is masked to 1 bit by comparing hashes with `executable` set to 255 and 1.
    - Logs the successful completion of the test with `FD_LOG_NOTICE`.
- **Output**: No output is returned; the function logs results and performs assertions.
- **Functions Called**:
    - [`fd_hashes_account_lthash`](<fd_hashes.c.md#fd_hashes_account_lthash>)
    - [`fd_lthash_equal`](<#fd_lthash_equal>)


---
### test\_fd\_hashes\_hash\_bank<!-- {{#callable:test_fd_hashes_hash_bank}} -->
[View Source →](<../../../../../src/flamenco/runtime/test_hashes.c#L534>)

Tests the [`fd_hashes_hash_bank`](<fd_hashes.c.md#fd_hashes_hash_bank>) function to ensure it computes the bank hash correctly.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test with `FD_LOG_NOTICE`.
    - Initializes a `fd_lthash_value_t` variable `lthash` with bytes set to `0xAA`.
    - Initializes a `fd_hash_t` variable `prev_bank_hash` with hash set to `0xBB`.
    - Initializes a `fd_hash_t` variable `last_blockhash` with hash set to `0xCC`.
    - Sets `signature_count` to `12345UL`.
    - Calls [`fd_hashes_hash_bank`](<fd_hashes.c.md#fd_hashes_hash_bank>) with the initialized variables and stores the result in `hash_out`.
    - Defines an `expected_hash` with a specific byte pattern.
    - Compares `hash_out` with `expected_hash` using [`fd_hash_equal`](<#fd_hash_equal>).
    - Logs an error if the hashes do not match using `FD_LOG_ERR`.
    - Logs the successful completion of the test with `FD_LOG_NOTICE`.
- **Output**: No output is returned; the function logs messages and performs assertions to verify correctness.
- **Functions Called**:
    - [`fd_hashes_hash_bank`](<fd_hashes.c.md#fd_hashes_hash_bank>)
    - [`fd_hash_equal`](<#fd_hash_equal>)


---
### test\_fd\_hashes\_update\_lthash<!-- {{#callable:test_fd_hashes_update_lthash}} -->
[View Source →](<../../../../../src/flamenco/runtime/test_hashes.c#L574>)

Tests the logic of updating a bank's lifetime hash (`lthash`) by simulating the subtraction of an old account hash and the addition of a new account hash.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test with `FD_LOG_NOTICE`.
    - Initializes a `fd_pubkey_t` structure with a specific pattern.
    - Sets up `test_meta` with predefined values for `lamports`, `executable`, `owner`, and `dlen`.
    - Fills `test_data` with a specific pattern.
    - Initializes `bank_lthash` with a specific pattern.
    - Initializes `prev_hash` with a specific pattern.
    - Copies `bank_lthash` to `initial_lthash` to store the initial state.
    - Simulates the `fd_hashes_update_lthash` function by subtracting `prev_hash` from `bank_lthash` using `fd_lthash_sub`.
    - Calculates `new_hash` using [`fd_hashes_account_lthash`](<fd_hashes.c.md#fd_hashes_account_lthash>) with `pubkey`, `test_meta`, and `test_data`.
    - Adds `new_hash` to `bank_lthash` using `fd_lthash_add`.
    - Verifies the result by comparing `bank_lthash` with an expected value using [`fd_lthash_equal`](<#fd_lthash_equal>).
    - Tests the scenario with a zero previous hash by initializing `zero_prev` with `fd_lthash_zero`.
    - Verifies that subtracting `zero_prev` from `bank_lthash` is a no-op and adds `new_hash` again.
    - Logs the successful completion of the test with `FD_LOG_NOTICE`.
- **Output**: No output is returned; the function logs test results and uses assertions to verify correctness.
- **Functions Called**:
    - [`fd_hashes_account_lthash`](<fd_hashes.c.md#fd_hashes_account_lthash>)
    - [`fd_lthash_equal`](<#fd_lthash_equal>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/flamenco/runtime/test_hashes.c#L639>)

Initializes the environment, runs a series of hash tests, logs the results, and then halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments passed to the program.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with the command-line arguments.
    - Executes [`test_fd_hashes_account_lthash`](<#test_fd_hashes_account_lthash>) to test account hash computations.
    - Executes [`test_fd_hashes_hash_bank`](<#test_fd_hashes_hash_bank>) to test bank hash computations.
    - Executes [`test_fd_hashes_update_lthash`](<#test_fd_hashes_update_lthash>) to test the update logic of the lthash.
    - Logs a notice message indicating the tests passed using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to clean up and halt the program.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution of the program.
- **Functions Called**:
    - [`test_fd_hashes_account_lthash`](<#test_fd_hashes_account_lthash>)
    - [`test_fd_hashes_hash_bank`](<#test_fd_hashes_hash_bank>)
    - [`test_fd_hashes_update_lthash`](<#test_fd_hashes_update_lthash>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)