<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for managing and executing loader v4 programs with state transitions and execution context.

# Purpose
This C header file defines constants, data structures, and function prototypes for managing and interacting with a version 4 loader program in a runtime environment. It includes several other header files that provide necessary dependencies and context for execution. The file outlines the different states a loader v4 program can be in, such as `Retracted`, `Deployed`, and `Finalized`, and describes the changes from the previous version, including the removal of program and buffer accounts. It defines macros for default compute units, deployment cooldown, and program data offset, and uses type punning for serialization and deserialization of the loader state. The file also provides function prototypes to check the status of a program and to execute a program within a given execution context.
# Imports and Dependencies

---
- `../../fd_flamenco_base.h`
- `../context/fd_exec_instr_ctx.h`
- `../fd_system_ids.h`
- `../fd_executor.h`
- `../sysvar/fd_sysvar_rent.h`
- `../fd_borrowed_account.h`
- `fd_bpf_loader_program.h`


# Function Declarations (Public API)

---
### fd\_loader\_v4\_status\_is\_deployed<!-- {{#callable_declaration:fd_loader_v4_status_is_deployed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_loader_v4_program.h#L60>)

Checks if the loader v4 program is in the deployed state.
- **Description**: Use this function to determine if a loader v4 program is ready to be invoked. It checks the status of the program and returns a value indicating whether it is in the deployed state. This function is useful for verifying that a program is operational and not in a retracted or finalized state. Ensure that the `state` parameter is valid and points to a properly initialized `fd_loader_v4_state_t` structure.
- **Inputs**:
    - `state`: A pointer to a `fd_loader_v4_state_t` structure representing the current state of the loader v4 program. Must not be null. The function expects this structure to be properly initialized and valid.
- **Output**: Returns a non-zero value if the program is in the deployed state, otherwise returns zero.
- **See Also**: [`fd_loader_v4_status_is_deployed`](<fd_loader_v4_program.c.md#fd_loader_v4_status_is_deployed>)  (Implementation)


---
### fd\_loader\_v4\_status\_is\_retracted<!-- {{#callable_declaration:fd_loader_v4_status_is_retracted}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_loader_v4_program.h#L65>)

Checks if the loader v4 program is in the retracted state.
- **Description**: Use this function to determine if a loader v4 program is currently in the retracted state. This state indicates that the program is either in the process of deployment or is deployed but under maintenance, making it non-invocable. This function is useful for managing program states and ensuring that operations are only performed on programs that are not retracted.
- **Inputs**:
    - `state`: A pointer to a `fd_loader_v4_state_t` structure representing the current state of the loader v4 program. Must not be null. The function does not modify the state.
- **Output**: Returns a non-zero value if the program is in the retracted state, otherwise returns zero.
- **See Also**: [`fd_loader_v4_status_is_retracted`](<fd_loader_v4_program.c.md#fd_loader_v4_status_is_retracted>)  (Implementation)


---
### fd\_loader\_v4\_status\_is\_finalized<!-- {{#callable_declaration:fd_loader_v4_status_is_finalized}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_loader_v4_program.h#L68>)

Checks if the loader v4 program is finalized.
- **Description**: Use this function to determine if a loader v4 program is in the finalized state, meaning the program is immutable. This function is useful when you need to verify the program's state before performing operations that require the program to be finalized. Ensure that the `state` parameter is not null before calling this function.
- **Inputs**:
    - `state`: A pointer to a `fd_loader_v4_state_t` structure representing the current state of the loader v4 program. Must not be null. If the pointer is null, the behavior is undefined.
- **Output**: Returns a non-zero value if the program is finalized, otherwise returns zero.
- **See Also**: [`fd_loader_v4_status_is_finalized`](<fd_loader_v4_program.c.md#fd_loader_v4_status_is_finalized>)  (Implementation)


---
### fd\_loader\_v4\_get\_state<!-- {{#callable_declaration:fd_loader_v4_get_state}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_loader_v4_program.h#L71>)

Retrieves the state of a loader v4 program.
- **Description**: Use this function to obtain the current state of a loader v4 program. It checks if the program's data length is sufficient and returns the state if valid. Call this function when you need to determine the state of a program, such as Retracted, Deployed, or Finalized. Ensure that the `program` parameter is valid and that `err` is a pointer to an integer to receive error codes. The function sets `err` to indicate success or specific errors related to data size.
- **Inputs**:
    - `program`: A pointer to a `fd_txn_account_t` structure representing the program. Must not be null. The function checks if the program's data length is sufficient.
    - `err`: A pointer to an integer where the function stores the error code. Must not be null. The function sets this to `FD_EXECUTOR_INSTR_SUCCESS` on success or `FD_EXECUTOR_INSTR_ERR_ACC_DATA_TOO_SMALL` if the program's data is too small.
- **Output**: Returns a pointer to a `fd_loader_v4_state_t` structure representing the program's state if successful, or `NULL` if the data length is insufficient.
- **See Also**: [`fd_loader_v4_get_state`](<fd_loader_v4_program.c.md#fd_loader_v4_get_state>)  (Implementation)


---
### fd\_loader\_v4\_program\_execute<!-- {{#callable_declaration:fd_loader_v4_program_execute}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_loader_v4_program.h#L75>)

Executes a loader v4 program instruction.
- **Description**: Use this function to execute a loader v4 program instruction within a given execution context. It checks if the loader v4 feature is active and processes the instruction based on its type. This function must be called with a valid instruction context that has been properly initialized. It returns an error code if the program ID is unsupported or if the instruction data is invalid. Ensure that the instruction context is correctly set up before calling this function.
- **Inputs**:
    - `instr_ctx`: A pointer to an `fd_exec_instr_ctx_t` structure representing the execution context for the instruction. Must not be null and must be properly initialized before calling this function. The caller retains ownership of this pointer.
- **Output**: Returns an integer status code indicating success or the type of error encountered. Possible return values include success, unsupported program ID, or invalid instruction data.
- **See Also**: [`fd_loader_v4_program_execute`](<fd_loader_v4_program.c.md#fd_loader_v4_program_execute>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)