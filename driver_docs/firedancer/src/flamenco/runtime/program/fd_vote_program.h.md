<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements the vote program for node registration and consensus participation in Solana, including error codes and state management functions.

# Purpose
The code is a C header file that defines the interface for a vote program used in a blockchain consensus mechanism, specifically for Solana's consensus algorithm. The vote program allows node operators to register their nodes and participate in consensus by implementing Tower BFT logic, which includes voting and lockouts. The header file includes custom error codes related to voting operations, such as mismatches, conflicts, and rollbacks, which help in handling various error conditions that may arise during the execution of the vote program.

The file declares several functions that are essential for the operation of the vote program. The [`fd_vote_program_execute`](<#fd_vote_program_execute>) function serves as the entry point for processing instructions related to voting. Other functions, such as [`fd_vote_state_versions_is_correct_and_initialized`](<#fd_vote_state_versions_is_correct_and_initialized>), [`fd_vote_get_state`](<#fd_vote_get_state>), and [`fd_vote_convert_to_current`](<#fd_vote_convert_to_current>), manage the state of vote accounts. The [`fd_vote_commission_split`](<#fd_vote_commission_split>) function calculates the distribution of commission between voters and stakers, while [`fd_vote_store_account`](<#fd_vote_store_account>) is used to store vote account information in the bank. The file also defines a structure, `fd_commission_split_t`, to represent the commission split between different parties. This header file is intended to be included in other C source files that implement or interact with the vote program.
# Imports and Dependencies

---
- `../context/fd_exec_instr_ctx.h`
- `../fd_bank.h`


# Data Structures

---
### fd\_commission\_split
- **Type**: ``struct``
- **Members**:
    - `voter_portion`: Represents the portion of the commission allocated to the voter.
    - `staker_portion`: Represents the portion of the commission allocated to the staker.
    - `is_split`: Indicates if the commission is split between voter and staker.
- **Description**: Defines a structure to represent the split of commission between a voter and a staker, with fields to specify the portions allocated to each and a flag to indicate if the commission is split.


---
### fd\_commission\_split\_t
- **Type**: ``struct``
- **Members**:
    - `voter_portion`: The portion of the commission allocated to the voter.
    - `staker_portion`: The portion of the commission allocated to the staker.
    - `is_split`: A flag indicating whether the commission is split between voter and staker.
- **Description**: Defines a structure to represent the split of commission between a voter and a staker, with fields to specify the portions allocated to each and a flag to indicate if the commission is split.


# Function Declarations (Public API)

---
### fd\_vote\_program\_execute<!-- {{#callable_declaration:fd_vote_program_execute}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_vote_program.h#L45>)

Processes a vote program instruction.
- **Description**: Use this function to execute a vote program instruction within the context of a transaction. It processes various vote-related instructions, such as initializing accounts, authorizing actions, updating vote states, and more. The function requires a valid execution context and checks for necessary conditions, such as account ownership and sufficient account keys. It returns specific error codes if any preconditions are not met or if an error occurs during processing. Ensure that the context is properly initialized and contains valid instruction data before calling this function.
- **Inputs**:
    - `ctx`: A pointer to an `fd_exec_instr_ctx_t` structure that provides the execution context for the instruction. This must not be null and should be properly initialized with valid instruction data and account information. The function checks for necessary conditions within this context, such as account count and data validity.
- **Output**: Returns an integer status code indicating the result of the instruction execution. A return value of `FD_EXECUTOR_INSTR_SUCCESS` indicates success, while other values indicate specific errors, such as `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS` or `FD_EXECUTOR_INSTR_ERR_INVALID_INSTR_DATA`.
- **See Also**: [`fd_vote_program_execute`](<fd_vote_program.c.md#fd_vote_program_execute>)  (Implementation)


---
### fd\_vote\_state\_versions\_is\_correct\_and\_initialized<!-- {{#callable_declaration:fd_vote_state_versions_is_correct_and_initialized}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_vote_program.h#L54>)

Checks if a vote account is correctly initialized and has the correct version.
- **Description**: Use this function to verify that a given vote account is both correctly initialized and matches one of the expected version sizes. This function is useful when you need to ensure that the vote account data is valid and ready for further operations. It checks the data length and specific data patterns to determine correctness. Call this function when you need to validate the state of a vote account before processing it further.
- **Inputs**:
    - `vote_account`: A pointer to a `fd_txn_account_t` structure representing the vote account to check. Must not be null. The function expects this account to contain data that can be validated against known version sizes and initialization patterns.
- **Output**: Returns 1 if the vote account is correctly initialized and matches a known version size; otherwise, returns 0.
- **See Also**: [`fd_vote_state_versions_is_correct_and_initialized`](<fd_vote_program.c.md#fd_vote_state_versions_is_correct_and_initialized>)  (Implementation)


---
### fd\_vote\_get\_state<!-- {{#callable_declaration:fd_vote_get_state}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_vote_program.h#L61>)

Retrieves the current vote state for a given account.
- **Description**: Use this function to obtain the current vote state associated with a specific transaction account. This function is useful when you need to access the vote state for operations related to consensus participation. Ensure that the `self` parameter points to a valid transaction account and that `spad` is properly initialized before calling this function. The function will output the vote state through the `versioned` parameter and return an error code indicating success or failure.
- **Inputs**:
    - `self`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account. Must not be null.
    - `spad`: A pointer to an `fd_spad_t` structure used for temporary storage during the operation. Must be properly initialized before use.
    - `versioned`: A pointer to a pointer to `fd_vote_state_versioned_t` where the function will store the address of the retrieved vote state. Must not be null.
- **Output**: Returns an integer error code. A value of 0 indicates success, while non-zero values indicate specific errors as defined by the vote program's custom error codes.
- **See Also**: [`fd_vote_get_state`](<fd_vote_program.c.md#fd_vote_get_state>)  (Implementation)


---
### fd\_vote\_convert\_to\_current<!-- {{#callable_declaration:fd_vote_convert_to_current}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_vote_program.h#L66>)

Converts a vote state to the current version.
- **Description**: Use this function to update a vote state to the current version. This is necessary when working with vote states that may be outdated or in a previous format. Ensure that the `self` and `spad` parameters are valid and properly initialized before calling this function. This function does not return a value and does not handle errors internally, so ensure that the inputs are correct to avoid undefined behavior.
- **Inputs**:
    - `self`: A pointer to a `fd_vote_state_versioned_t` structure representing the vote state to convert. Must not be null and should be properly initialized.
    - `spad`: A pointer to a `fd_spad_t` structure used during the conversion process. Must not be null and should be properly initialized.
- **Output**: None
- **See Also**: [`fd_vote_convert_to_current`](<fd_vote_program.c.md#fd_vote_convert_to_current>)  (Implementation)


---
### fd\_vote\_commission\_split<!-- {{#callable_declaration:fd_vote_commission_split}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_vote_program.h#L77>)

Calculates the split of a commission between a voter and a staker.
- **Description**: Use this function to determine how to divide a commission between a voter and a staker based on a given percentage. The function calculates the portions for both parties and stores the result in a provided structure. It handles edge cases where the commission is 0% or 100%, assigning the entire amount to one party accordingly. Ensure that the `result` parameter is a valid pointer to a `fd_commission_split_t` structure before calling this function.
- **Inputs**:
    - `commission`: The percentage of the commission to be split, represented as an unsigned character. Valid values are from 0 to 100. Values outside this range are clamped to the nearest valid value.
    - `on`: The total amount to be split, represented as an unsigned long integer. This value is the base amount on which the commission percentage is applied.
    - `result`: A pointer to an `fd_commission_split_t` structure where the function will store the calculated split. Must not be null, and the caller retains ownership of the memory.
- **Output**: None
- **See Also**: [`fd_vote_commission_split`](<fd_vote_program.c.md#fd_vote_commission_split>)  (Implementation)


---
### fd\_vote\_store\_account<!-- {{#callable_declaration:fd_vote_store_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_vote_program.h#L82>)

Stores or removes a vote account in the bank's vote states.
- **Description**: Use this function to update the bank's vote states with the given vote account. If the vote account has zero lamports or is not correctly initialized, the function removes the account from the vote states. Otherwise, it updates the vote states with the account's data. This function must be called with a valid vote account and bank, and it modifies the bank's vote states accordingly.
- **Inputs**:
    - `vote_account`: A pointer to a `fd_txn_account_t` structure representing the vote account. The account must be valid and initialized. If the account has zero lamports or is not correctly initialized, it will be removed from the vote states.
    - `bank`: A pointer to a `fd_bank_t` structure representing the bank. The bank must be valid and initialized. The function modifies the bank's vote states based on the vote account's status.
- **Output**: None
- **See Also**: [`fd_vote_store_account`](<fd_vote_program.c.md#fd_vote_store_account>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)