<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for the third version of the BPF loader program, defining constants, error codes, and function prototypes for program deployment and execution.

# Purpose
The code is a C header file that defines the interface for a BPF (Berkeley Packet Filter) loader program, specifically the third version of this loader. It includes several header files that provide necessary types and features, such as `fd_progcache_rec.h`, `fd_features.h`, `fd_types.h`, and `fd_funk_base.h`. The file defines constants related to compute units and program sizes, which are used in the context of BPF program deployment and execution. These constants are crucial for managing resources and ensuring compatibility with the BPF loader's requirements.

The header file also defines several macros for error handling, which are used to convert instruction errors into specific error codes. These error codes are shifted by a defined bit shift value, `BUILTIN_BIT_SHIFT`, to create unique identifiers for different error conditions. Additionally, the file declares several functions that form the public API for interacting with the BPF loader. These functions include `fd_bpf_loader_program_get_state`, [`fd_deploy_program`](<#fd_deploy_program>), [`fd_bpf_execute`](<#fd_bpf_execute>), [`fd_bpf_loader_program_execute`](<#fd_bpf_loader_program_execute>), and [`fd_directly_invoke_loader_v3_deploy`](<#fd_directly_invoke_loader_v3_deploy>). These functions facilitate the deployment and execution of BPF programs, as well as the retrieval of program states, and are integral to the operation of the BPF loader within the system.
# Imports and Dependencies

---
- `../../progcache/fd_progcache_rec.h`
- `../../features/fd_features.h`
- `../../types/fd_types.h`
- `../../../funk/fd_funk_base.h`


# Function Declarations (Public API)

---
### fd\_deploy\_program<!-- {{#callable_declaration:fd_deploy_program}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_bpf_loader_program.h#L69>)

Deploys a program using the provided execution context and program data.
- **Description**: Use this function to deploy a program by providing the necessary execution context, program key, program data, and a scratchpad memory allocator. Ensure that the execution context and scratchpad are properly initialized before calling this function. The function performs necessary checks and validations on the program data, including ELF and VM validation, and registers the program for reverification. It returns an error code if any step in the deployment process fails, such as invalid program data or failure to set up the program environment.
- **Inputs**:
    - `instr_ctx`: A pointer to an `fd_exec_instr_ctx_t` structure representing the execution context. Must be properly initialized and not null.
    - `program_key`: A pointer to a constant `fd_pubkey_t` representing the program's public key. Must not be null.
    - `programdata`: A pointer to a constant `uchar` array containing the program data. Must not be null.
    - `programdata_size`: An `ulong` representing the size of the program data. Must be greater than zero.
    - `spad`: A pointer to an `fd_spad_t` structure used for memory allocation during the deployment process. Must be properly initialized and not null.
- **Output**: Returns an integer status code indicating success or the type of error encountered during deployment.
- **See Also**: [`fd_deploy_program`](<fd_bpf_loader_program.c.md#fd_deploy_program>)  (Implementation)


---
### fd\_bpf\_execute<!-- {{#callable_declaration:fd_bpf_execute}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_bpf_loader_program.h#L76>)

Executes a BPF program with the given execution context and program cache entry.
- **Description**: Use this function to execute a BPF program using a specified execution context and program cache entry. It is important to ensure that the execution context and program cache entry are properly initialized before calling this function. The function handles various execution scenarios, including deprecated program handling, and returns an error code if execution fails. It is crucial to check the return value to determine if the execution was successful or if an error occurred.
- **Inputs**:
    - `instr_ctx`: A pointer to an `fd_exec_instr_ctx_t` structure representing the execution context. Must be properly initialized and must not be null. The caller retains ownership.
    - `program`: A pointer to a constant `fd_progcache_rec_t` structure representing the program cache entry. Must be properly initialized and must not be null. The caller retains ownership.
    - `is_deprecated`: An `uchar` indicating whether the program is deprecated. Valid values are 0 (not deprecated) and 1 (deprecated).
- **Output**: Returns an integer error code. A return value of `FD_EXECUTOR_INSTR_SUCCESS` indicates successful execution, while other values indicate specific errors encountered during execution.
- **See Also**: [`fd_bpf_execute`](<fd_bpf_loader_program.c.md#fd_bpf_execute>)  (Implementation)


---
### fd\_bpf\_loader\_program\_execute<!-- {{#callable_declaration:fd_bpf_loader_program_execute}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_bpf_loader_program.h#L81>)

Executes a BPF program using the given execution context.
- **Description**: Use this function to execute a BPF program within a specified execution context. It is important to ensure that the execution context is properly initialized and contains valid program account information before calling this function. The function handles various program management instructions and checks for program validity, including whether the program is executable and if it is in a supported state. It returns specific error codes if the program is not supported, not executable, or if there are issues with the program account data. This function is typically used in environments where BPF programs need to be executed as part of a transaction processing system.
- **Inputs**:
    - `ctx`: A pointer to an `fd_exec_instr_ctx_t` structure representing the execution context. This context must be initialized and contain valid transaction and program account information. The caller retains ownership and must ensure it is not null.
- **Output**: Returns an integer status code indicating the result of the execution. A return value of 0 indicates success, while non-zero values indicate various error conditions related to program execution or account validity.
- **See Also**: [`fd_bpf_loader_program_execute`](<fd_bpf_loader_program.c.md#fd_bpf_loader_program_execute>)  (Implementation)


---
### fd\_directly\_invoke\_loader\_v3\_deploy<!-- {{#callable_declaration:fd_directly_invoke_loader_v3_deploy}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_bpf_loader_program.h#L97>)

Deploys a BPF program using ELF and VM validation checks.
- **Description**: Use this function to deploy a BPF program at the epoch boundary when a new BPF core migration feature is activated. It performs necessary ELF and VM validation checks without executing any funk operations. The function requires a mock transaction and instruction context for execution. It is important to note that the BPF cache entry is created at the end of the block, not during this function call.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure. Must not be null. Represents the bank context for the deployment.
    - `accdb_shfunk`: A pointer to a shared function or data structure. The specific type and usage are not detailed in the header. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure. Represents the transaction ID. Must not be null.
    - `program_key`: A pointer to a constant `fd_pubkey_t` structure. Represents the public key of the program to deploy. Must not be null.
    - `elf`: A pointer to a constant unsigned character array. Represents the ELF data of the program. Must not be null.
    - `elf_sz`: An unsigned long integer representing the size of the ELF data. Must be greater than zero.
- **Output**: Returns an integer status code. The function is not implemented and currently returns 0.
- **See Also**: [`fd_directly_invoke_loader_v3_deploy`](<fd_bpf_loader_program.c.md#fd_directly_invoke_loader_v3_deploy>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)