<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions for executing various system instructions, such as account creation and transfers, in a Solana-like environment.

# Purpose
The code is a C implementation of a system program for managing accounts and transactions, inspired by the Solana blockchain's system processor. It provides a set of functions to execute various system instructions, such as creating accounts, transferring funds, allocating space, and assigning ownership. The code includes functions like [`fd_system_program_exec_create_account`](<#fd_system_program_exec_create_account>), [`fd_system_program_exec_transfer`](<#fd_system_program_exec_transfer>), and [`fd_system_program_exec_allocate`](<#fd_system_program_exec_allocate>), which correspond to specific system instructions. These functions handle the logic for verifying account signatures, checking account states, and performing operations like transferring lamports (the smallest unit of currency in Solana) between accounts.

The code also includes utility functions for logging and verifying addresses, such as [`fd_log_address_type`](<#fd_log_address_type>) and [`verify_seed_address`](<#verify_seed_address>). These functions help ensure that operations are performed correctly and that derived addresses match expected values. The code is structured to handle errors and log messages efficiently, using macros like `FD_UNLIKELY` to optimize performance. Additionally, the code provides a public API function, [`fd_get_system_account_kind`](<#fd_get_system_account_kind>), which determines the type of a given account based on its owner and data length. This function is useful for identifying system accounts and nonce accounts within the Solana ecosystem.
# Imports and Dependencies

---
- `fd_system_program.h`
- `../fd_executor.h`
- `../fd_borrowed_account.h`
- `../fd_system_ids.h`
- `../fd_pubkey_utils.h`


# Functions

---
### fd\_log\_address\_type<!-- {{#callable:fd_log_address_type}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L16>)

Formats and returns a string representation of an address and its base in the Agave system program.
- **Inputs**:
    - ``spad``: A pointer to `fd_spad_t`, used for memory allocation.
    - ``pubkey``: A constant pointer to `fd_pubkey_t`, representing the public key of the address.
    - ``base``: A constant pointer to `fd_pubkey_t`, representing the base public key, or `NULL` if the address is not derived.
- **Logic and Control Flow**:
    - Allocate a buffer of 125 bytes using `fd_spad_alloc` for the output string.
    - Check if `base` is not `NULL` using `FD_UNLIKELY`. If true, format `base` as a Base58 encoded string prefixed with 'Some' and store it in `base_addr`.
    - If `base` is `NULL`, store 'None' in `base_addr`.
    - Format the final output string with the public key and `base_addr`, and store it in the allocated buffer.
    - Return the formatted string.
- **Output**: A pointer to a character array containing the formatted address string.


---
### verify\_seed\_address<!-- {{#callable:verify_seed_address}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L37>)

Verifies that a derived public key matches an expected public key using a seed and base public key.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context.
    - `expected`: A pointer to the `fd_pubkey_t` structure representing the expected public key.
    - `base`: A pointer to the `fd_pubkey_t` structure representing the base public key.
    - `seed`: A constant character pointer to the seed used for deriving the public key.
    - `seed_sz`: An unsigned long representing the size of the seed.
    - `owner`: A pointer to the `fd_pubkey_t` structure representing the owner's public key.
- **Logic and Control Flow**:
    - Create a new public key `actual` using the `fd_pubkey_create_with_seed` function with the provided `ctx`, `base`, `seed`, `seed_sz`, and `owner`.
    - Check if the creation of the public key `actual` resulted in an error; if so, return the error code.
    - Compare the derived public key `actual` with the `expected` public key using `memcmp`.
    - If the public keys do not match, log an error message and set a custom error code in `ctx->txn_ctx->custom_err`.
    - Return the custom error code `FD_EXECUTOR_INSTR_ERR_CUSTOM_ERR` if the public keys do not match.
    - Return 0 if the public keys match, indicating success.
- **Output**: Returns 0 if the derived public key matches the expected public key, otherwise returns an error code.


---
### fd\_system\_program\_transfer\_verified<!-- {{#callable:fd_system_program_transfer_verified}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L75>)

Transfers a specified amount of lamports from one account to another, ensuring the source account has sufficient balance and no data.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context for the instruction.
    - ``transfer_amount``: The amount of lamports to transfer from the source account to the destination account.
    - ``from_acct_idx``: The index of the source account in the instruction's account list.
    - ``to_acct_idx``: The index of the destination account in the instruction's account list.
- **Logic and Control Flow**:
    - Initialize a `fd_guarded_borrowed_account_t` structure for the source account using `FD_TRY_BORROW_INSTR_ACCOUNT_DEFAULT_ERR_CHECK` with `from_acct_idx`.
    - Check if the source account carries any data using `fd_borrowed_account_get_data_len`. If it does, log an error message and return `FD_EXECUTOR_INSTR_ERR_INVALID_ARG`.
    - Verify that the source account has enough lamports to cover the transfer amount using `fd_borrowed_account_get_lamports`. If not, log an error message, set a custom error code, and return `FD_EXECUTOR_INSTR_ERR_CUSTOM_ERR`.
    - Subtract the transfer amount from the source account's lamports using `fd_borrowed_account_checked_sub_lamports`. If an error occurs, return the error code.
    - Release the source account using `fd_borrowed_account_drop`.
    - Initialize a `fd_guarded_borrowed_account_t` structure for the destination account using `FD_TRY_BORROW_INSTR_ACCOUNT_DEFAULT_ERR_CHECK` with `to_acct_idx`.
    - Add the transfer amount to the destination account's lamports using `fd_borrowed_account_checked_add_lamports`. If an error occurs, return the error code.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success, or an error code if the transfer cannot be completed due to insufficient funds or other issues.


---
### fd\_system\_program\_transfer<!-- {{#callable:fd_system_program_transfer}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L130>)

Transfers a specified amount between two accounts, ensuring the 'from' account has signed the transaction.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which contains the execution context for the instruction.
    - ``transfer_amount``: The amount of lamports to transfer from the 'from' account to the 'to' account.
    - ``from_acct_idx``: The index of the 'from' account in the transaction's account list.
    - ``to_acct_idx``: The index of the 'to' account in the transaction's account list.
- **Logic and Control Flow**:
    - Initialize `instr_err_code` to 0.
    - Check if the 'from' account is a signer using `fd_instr_acc_is_signer_idx`.
    - If the 'from' account is not a signer, check `instr_err_code` for errors and return it if non-zero.
    - Log an error message if the 'from' account is not a signer and return `FD_EXECUTOR_INSTR_ERR_MISSING_REQUIRED_SIGNATURE`.
    - Call [`fd_system_program_transfer_verified`](<#fd_system_program_transfer_verified>) to perform the transfer if the 'from' account is a signer.
- **Output**: Returns 0 on success or an error code if the 'from' account is not a signer or if there is an error in [`fd_system_program_transfer_verified`](<#fd_system_program_transfer_verified>).
- **Functions Called**:
    - [`fd_system_program_transfer_verified`](<#fd_system_program_transfer_verified>)


---
### fd\_system\_program\_allocate<!-- {{#callable:fd_system_program_allocate}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L159>)

Allocates space for an account in the Solana system program, ensuring necessary conditions are met.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context for the instruction.
    - `account`: A pointer to the `fd_borrowed_account_t` structure, representing the account to allocate space for.
    - `space`: An unsigned long integer specifying the amount of space to allocate for the account.
    - `authority`: A pointer to a `fd_pubkey_t` structure representing the authority that must sign the allocation.
    - `base`: A pointer to a `fd_pubkey_t` structure representing the base public key, used for logging purposes.
- **Logic and Control Flow**:
    - Checks if the `authority` has signed the transaction using `fd_exec_instr_ctx_any_signed`; logs and returns an error if not signed.
    - Verifies if the account is already in use by checking its data length and owner; logs and returns an error if the account is in use.
    - Checks if the requested `space` exceeds the maximum allowed size `FD_RUNTIME_ACC_SZ_MAX`; logs and returns an error if it does.
    - Attempts to set the data length of the account to `space` using `fd_borrowed_account_set_data_length`; returns an error if this operation fails.
    - Returns `FD_EXECUTOR_INSTR_SUCCESS` if all checks pass and the allocation is successful.
- **Output**: Returns an integer status code: `FD_EXECUTOR_INSTR_SUCCESS` on success, or an error code if any checks fail.
- **Functions Called**:
    - [`fd_log_address_type`](<#fd_log_address_type>)


---
### fd\_system\_program\_assign<!-- {{#callable:fd_system_program_assign}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L214>)

Assigns a new owner to an account if the current owner is different and the authority has signed the transaction.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, which contains the execution context for the instruction.
    - `account`: A pointer to the `fd_borrowed_account_t` structure, representing the account to be assigned a new owner.
    - `owner`: A pointer to the `fd_pubkey_t` structure, representing the new owner's public key.
    - `authority`: A pointer to the `fd_pubkey_t` structure, representing the authority's public key that must sign the transaction.
    - `base`: A pointer to the `fd_pubkey_t` structure, representing the base public key, used for logging purposes.
- **Logic and Control Flow**:
    - Check if the current owner of the account matches the new owner; if they match, return 0 indicating no change is needed.
    - If the authority has not signed the transaction, log an error message and return `FD_EXECUTOR_INSTR_ERR_MISSING_REQUIRED_SIGNATURE`.
    - If the authority has signed, call `fd_borrowed_account_set_owner` to set the new owner for the account and return the result.
- **Output**: Returns 0 if the owner is already set or successfully changed, otherwise returns an error code if the authority has not signed.
- **Functions Called**:
    - [`fd_log_address_type`](<#fd_log_address_type>)


---
### fd\_system\_program\_allocate\_and\_assign<!-- {{#callable:fd_system_program_allocate_and_assign}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L243>)

Allocates space for an account and assigns it to a specified owner.
- **Inputs**:
    - ``ctx``: A pointer to the execution instruction context (`fd_exec_instr_ctx_t`).
    - ``account``: A pointer to the borrowed account (`fd_borrowed_account_t`) to allocate and assign.
    - ``space``: The amount of space (`ulong`) to allocate for the account.
    - ``owner``: A pointer to the public key (`fd_pubkey_t const *`) of the new owner of the account.
    - ``authority``: A pointer to the public key (`fd_pubkey_t const *`) of the authority required for allocation.
    - ``base``: A pointer to the public key (`fd_pubkey_t const *`) used as a base for derived addresses, if applicable.
- **Logic and Control Flow**:
    - Calls [`fd_system_program_allocate`](<#fd_system_program_allocate>) to allocate the specified space for the account, using the provided authority and base keys.
    - Checks for errors during allocation; if an error occurs, it returns the error code immediately.
    - If allocation is successful, calls [`fd_system_program_assign`](<#fd_system_program_assign>) to assign the account to the specified owner, using the provided authority and base keys.
    - Returns the result of the [`fd_system_program_assign`](<#fd_system_program_assign>) function.
- **Output**: Returns an integer status code, where 0 indicates success and any non-zero value indicates an error.
- **Functions Called**:
    - [`fd_system_program_allocate`](<#fd_system_program_allocate>)
    - [`fd_system_program_assign`](<#fd_system_program_assign>)


---
### fd\_system\_program\_create\_account<!-- {{#callable:fd_system_program_create_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L264>)

Creates a new account by allocating space, assigning an owner, and transferring lamports from a source account.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context for the instruction.
    - ``from_acct_idx``: An unsigned short representing the index of the source account from which lamports will be transferred.
    - ``to_acct_idx``: An unsigned short representing the index of the destination account to be created.
    - ``lamports``: An unsigned long representing the number of lamports to transfer from the source account to the new account.
    - ``space``: An unsigned long representing the amount of space to allocate for the new account.
    - ``owner``: A pointer to a `fd_pubkey_t` structure representing the public key of the owner of the new account.
    - ``authority``: A pointer to a `fd_pubkey_t` structure representing the authority that must sign the transaction.
    - ``base``: A pointer to a `fd_pubkey_t` structure representing the base public key, used for logging purposes.
- **Logic and Control Flow**:
    - Check if the destination account (`to_acct_idx`) is already in use by borrowing the account and checking its lamports.
    - If the account is in use, log an error message and return a custom error code indicating the account is already in use.
    - If the account is not in use, call [`fd_system_program_allocate_and_assign`](<#fd_system_program_allocate_and_assign>) to allocate space and assign the owner and authority to the new account.
    - Transfer the specified number of lamports from the source account (`from_acct_idx`) to the destination account (`to_acct_idx`) using [`fd_system_program_transfer`](<#fd_system_program_transfer>).
- **Output**: Returns an integer status code, where 0 indicates success and non-zero indicates an error occurred during account creation or transfer.
- **Functions Called**:
    - [`fd_log_address_type`](<#fd_log_address_type>)
    - [`fd_system_program_allocate_and_assign`](<#fd_system_program_allocate_and_assign>)
    - [`fd_system_program_transfer`](<#fd_system_program_transfer>)


---
### fd\_system\_program\_exec\_create\_account<!-- {{#callable:fd_system_program_exec_create_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L312>)

Executes the creation of a new account in the system program context.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context for the instruction.
    - ``create_acc``: A pointer to the `fd_system_program_instruction_create_account_t` structure, which contains the parameters for creating the account, such as lamports, space, and owner.
- **Logic and Control Flow**:
    - Checks if the number of account keys in `ctx` is less than 2; if true, returns `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Defines `from_acct_idx` as 0 and `to_acct_idx` as 1, representing the indices of the source and destination accounts.
    - Retrieves the authority key for the account at `to_acct_idx` using `fd_exec_instr_ctx_get_key_of_account_at_index`; if an error occurs, returns the error code.
    - Calls [`fd_system_program_create_account`](<#fd_system_program_create_account>) with the context, account indices, and parameters from `create_acc`, along with the retrieved authority.
- **Output**: Returns an integer status code indicating success or the type of error encountered during execution.
- **Functions Called**:
    - [`fd_system_program_create_account`](<#fd_system_program_create_account>)


---
### fd\_system\_program\_exec\_assign<!-- {{#callable:fd_system_program_exec_assign}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L347>)

Assigns a new owner to an account within the execution context if the account count is sufficient.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which contains the execution context for the instruction.
    - ``owner``: A pointer to the `fd_pubkey_t` structure representing the new owner of the account.
- **Logic and Control Flow**:
    - Check if the account count in `ctx->instr` is less than 1; if true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Initialize a `fd_guarded_borrowed_account_t` structure named `account` to zero.
    - Attempt to borrow the first account from the instruction context using `FD_TRY_BORROW_INSTR_ACCOUNT_DEFAULT_ERR_CHECK`; if this fails, return the error code.
    - Call [`fd_system_program_assign`](<#fd_system_program_assign>) with the context, the borrowed account, the new owner, the account's public key, and `NULL` for the base; if this call returns an error, return the error code.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success or an error code if an error occurs during execution.
- **Functions Called**:
    - [`fd_system_program_assign`](<#fd_system_program_assign>)


---
### fd\_system\_program\_exec\_transfer<!-- {{#callable:fd_system_program_exec_transfer}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L379>)

Executes a transfer of a specified amount between two accounts, ensuring there are at least two account keys available.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_exec_instr_ctx_t` structure, which contains the execution context for the instruction.
    - ``transfer_amount``: An unsigned long integer representing the amount to transfer between accounts.
- **Logic and Control Flow**:
    - Checks if the number of account keys in `ctx->instr` is less than 2; if true, returns `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Calls [`fd_system_program_transfer`](<#fd_system_program_transfer>) with `ctx`, `transfer_amount`, `0UL`, and `1UL` as arguments to perform the transfer operation.
- **Output**: Returns an integer status code, which is `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS` if there are not enough account keys, or the result of [`fd_system_program_transfer`](<#fd_system_program_transfer>) otherwise.
- **Functions Called**:
    - [`fd_system_program_transfer`](<#fd_system_program_transfer>)


---
### fd\_system\_program\_exec\_create\_account\_with\_seed<!-- {{#callable:fd_system_program_exec_create_account_with_seed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L397>)

Creates a new account with a seed in the Solana system program.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context for the instruction.
    - `args`: A pointer to the `fd_system_program_instruction_create_account_with_seed_t` structure, which contains the parameters for creating the account, including the base public key, seed, seed length, owner, lamports, and space.
- **Logic and Control Flow**:
    - Checks if the number of instruction accounts in `ctx` is less than 2; if so, returns `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Retrieves the public key of the account at index 1 in `ctx` and assigns it to `to_address`; if retrieval fails, returns the error code.
    - Calls [`verify_seed_address`](<#verify_seed_address>) to ensure the derived address from the seed matches the expected address; if verification fails, returns the error code.
    - Defines `from_acct_idx` as 0 and `to_acct_idx` as 1.
    - Calls [`fd_system_program_create_account`](<#fd_system_program_create_account>) with the context, account indices, and parameters from `args` to create the account.
- **Output**: Returns 0 on success or an error code if any step fails.
- **Functions Called**:
    - [`verify_seed_address`](<#verify_seed_address>)
    - [`fd_system_program_create_account`](<#fd_system_program_create_account>)


---
### fd\_system\_program\_exec\_allocate<!-- {{#callable:fd_system_program_exec_allocate}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L442>)

Allocates space for an account in the system program execution context.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which contains the execution context for the instruction.
    - ``space``: An unsigned long integer specifying the amount of space to allocate for the account.
- **Logic and Control Flow**:
    - Check if the account count in `ctx->instr` is less than 1; if true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Initialize a `fd_guarded_borrowed_account_t` structure named `account` to zero.
    - Attempt to borrow the first account from the instruction context using `FD_TRY_BORROW_INSTR_ACCOUNT_DEFAULT_ERR_CHECK`; if this fails, return the error code.
    - Call [`fd_system_program_allocate`](<#fd_system_program_allocate>) with `ctx`, `account`, `space`, `account.acct->pubkey`, and `NULL` as arguments.
    - If [`fd_system_program_allocate`](<#fd_system_program_allocate>) returns an error, return that error code.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success or an error code if an error occurs during execution.
- **Functions Called**:
    - [`fd_system_program_allocate`](<#fd_system_program_allocate>)


---
### fd\_system\_program\_exec\_allocate\_with\_seed<!-- {{#callable:fd_system_program_exec_allocate_with_seed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L474>)

Allocates and assigns a system account using a seed for address derivation.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_exec_instr_ctx_t` structure, which provides the execution context for the instruction.
    - ``args``: A pointer to the `fd_system_program_instruction_allocate_with_seed_t` structure, which contains the parameters for the allocation, including the base public key, seed, seed length, owner, and space to allocate.
- **Logic and Control Flow**:
    - Check if the account count in `ctx` is less than 1; if true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Initialize a `fd_guarded_borrowed_account_t` structure and attempt to borrow the instruction account at index 0 using `FD_TRY_BORROW_INSTR_ACCOUNT_DEFAULT_ERR_CHECK`.
    - Call [`verify_seed_address`](<#verify_seed_address>) to verify the derived address using the provided seed and base; if verification fails, return the error code.
    - Call [`fd_system_program_allocate_and_assign`](<#fd_system_program_allocate_and_assign>) to allocate and assign the account with the specified space and owner; if this fails, return the error code.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success or an error code if any step fails.
- **Functions Called**:
    - [`verify_seed_address`](<#verify_seed_address>)
    - [`fd_system_program_allocate_and_assign`](<#fd_system_program_allocate_and_assign>)


---
### fd\_system\_program\_exec\_assign\_with\_seed<!-- {{#callable:fd_system_program_exec_assign_with_seed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L521>)

Executes an assignment operation with a seed for a system program instruction.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, which contains the execution context for the instruction.
    - `args`: A pointer to the `fd_system_program_instruction_assign_with_seed_t` structure, which contains the arguments for the assignment operation, including the base public key, seed, seed length, and owner public key.
- **Logic and Control Flow**:
    - Check if the account count in `ctx` is less than 1; if true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Initialize a `fd_guarded_borrowed_account_t` structure named `account` and attempt to borrow the instruction account at index 0 using `FD_TRY_BORROW_INSTR_ACCOUNT_DEFAULT_ERR_CHECK`.
    - Call [`verify_seed_address`](<#verify_seed_address>) to verify the derived address using the public key, base, seed, seed length, and owner from `args`; if verification fails, return the error code.
    - Call [`fd_system_program_assign`](<#fd_system_program_assign>) to perform the assignment operation using the context, account, owner, base, and base from `args`; if the operation fails, return the error code.
    - Return 0 to indicate successful execution.
- **Output**: Returns 0 on success or an error code if an error occurs during execution.
- **Functions Called**:
    - [`verify_seed_address`](<#verify_seed_address>)
    - [`fd_system_program_assign`](<#fd_system_program_assign>)


---
### fd\_system\_program\_exec\_transfer\_with\_seed<!-- {{#callable:fd_system_program_exec_transfer_with_seed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L562>)

Executes a transfer of lamports between accounts using a derived address from a seed, ensuring necessary conditions and signatures are met.
- **Inputs**:
    - ``ctx``: A pointer to `fd_exec_instr_ctx_t`, which provides the execution context for the instruction.
    - ``args``: A pointer to `fd_system_program_instruction_transfer_with_seed_t`, which contains the parameters for the transfer, including the seed, seed length, owner, and lamports to transfer.
- **Logic and Control Flow**:
    - Check if the number of instruction accounts is at least 3; if not, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Verify that the 'from' account base index is a signer; if not, log an error and return `FD_EXECUTOR_INSTR_ERR_MISSING_REQUIRED_SIGNATURE`.
    - Retrieve the base public key from the account at the 'from_base_idx'.
    - Create a derived address using the seed, seed length, and owner from `args`; if creation fails, return the error.
    - Retrieve the public key of the 'from' account and compare it with the derived address; if they do not match, log an error and return `FD_EXECUTOR_INSTR_ERR_CUSTOM_ERR`.
    - Call [`fd_system_program_transfer_verified`](<#fd_system_program_transfer_verified>) to perform the transfer of lamports from the 'from' account to the 'to' account.
- **Output**: Returns 0 on success or an error code if any checks or operations fail.
- **Functions Called**:
    - [`fd_system_program_transfer_verified`](<#fd_system_program_transfer_verified>)


---
### fd\_system\_program\_execute<!-- {{#callable:fd_system_program_execute}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L628>)

Executes a system program instruction based on the provided context and instruction data.
- **Inputs**:
    - `ctx`: A pointer to `fd_exec_instr_ctx_t`, which contains the execution context for the instruction.
- **Logic and Control Flow**:
    - Updates the execution context with a constant value using `FD_EXEC_CU_UPDATE` macro.
    - Checks if the instruction data is `NULL` and returns an error if true.
    - Decodes the instruction data into a `fd_system_program_instruction_t` structure using `fd_bincode_decode1_spad`.
    - Checks for decoding errors or if the decoded size exceeds `FD_TXN_MTU`, returning an error if any condition is met.
    - Initializes `result` with `FD_EXECUTOR_INSTR_ERR_INVALID_ARG`.
    - Uses a switch statement to determine the type of system instruction based on `instruction->discriminant`.
    - Executes the corresponding function for each instruction type, updating `result` with the function's return value.
    - Returns the `result` after processing the instruction.
- **Output**: Returns an integer representing the result of the instruction execution, which can be a success or an error code.
- **Functions Called**:
    - [`fd_system_program_exec_create_account`](<#fd_system_program_exec_create_account>)
    - [`fd_system_program_exec_assign`](<#fd_system_program_exec_assign>)
    - [`fd_system_program_exec_transfer`](<#fd_system_program_exec_transfer>)
    - [`fd_system_program_exec_create_account_with_seed`](<#fd_system_program_exec_create_account_with_seed>)
    - [`fd_system_program_exec_advance_nonce_account`](<fd_system_program_nonce.c.md#fd_system_program_exec_advance_nonce_account>)
    - [`fd_system_program_exec_withdraw_nonce_account`](<fd_system_program_nonce.c.md#fd_system_program_exec_withdraw_nonce_account>)
    - [`fd_system_program_exec_initialize_nonce_account`](<fd_system_program_nonce.c.md#fd_system_program_exec_initialize_nonce_account>)
    - [`fd_system_program_exec_authorize_nonce_account`](<fd_system_program_nonce.c.md#fd_system_program_exec_authorize_nonce_account>)
    - [`fd_system_program_exec_allocate`](<#fd_system_program_exec_allocate>)
    - [`fd_system_program_exec_allocate_with_seed`](<#fd_system_program_exec_allocate_with_seed>)
    - [`fd_system_program_exec_assign_with_seed`](<#fd_system_program_exec_assign_with_seed>)
    - [`fd_system_program_exec_transfer_with_seed`](<#fd_system_program_exec_transfer_with_seed>)
    - [`fd_system_program_exec_upgrade_nonce_account`](<fd_system_program_nonce.c.md#fd_system_program_exec_upgrade_nonce_account>)


---
### fd\_get\_system\_account\_kind<!-- {{#callable:fd_get_system_account_kind}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_system_program.c#L729>)

Determines the kind of a system account based on its owner and data length.
- **Inputs**:
    - `account`: A pointer to an `fd_txn_account_t` structure representing the account to check.
    - `exec_spad`: A pointer to an `fd_spad_t` structure used for decoding nonce state versions.
- **Logic and Control Flow**:
    - Check if the account's owner matches the Solana system program ID; if not, return `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_UNKNOWN`.
    - Check if the account's data length is zero; if so, return `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_SYSTEM`.
    - Check if the account's data length does not match `FD_SYSTEM_PROGRAM_NONCE_DLEN`; if so, return `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_UNKNOWN`.
    - Decode the nonce state versions using `fd_bincode_decode_spad`; if an error occurs, return `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_UNKNOWN`.
    - Determine the current state from the decoded versions; if the state is initialized, return `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_NONCE`.
    - If none of the above conditions are met, return `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_UNKNOWN`.
- **Output**: Returns an integer representing the kind of the system account: `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_UNKNOWN`, `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_SYSTEM`, or `FD_SYSTEM_PROGRAM_NONCE_ACCOUNT_KIND_NONCE`.



---
Made with ❤️ by [Driver](https://www.driver.ai/)