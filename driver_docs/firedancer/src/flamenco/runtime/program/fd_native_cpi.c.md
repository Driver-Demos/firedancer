<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions for invoking native programs and creating account metadata in a runtime environment.

# Purpose
The code defines functions for handling native Cross-Program Invocations (CPI) within a virtual machine execution context. The primary function, [`fd_native_cpi_native_invoke`](<#fd_native_cpi_native_invoke>), is responsible for preparing and executing instructions that involve native programs. It sets up instruction information, including program IDs and account metadata, and then prepares the instruction for execution using `fd_vm_prepare_instruction`. If the preparation is successful, it executes the instruction with `fd_execute_instr`. This function is integral to managing the execution flow of native programs by interfacing with account metadata and transaction contexts.

Additionally, the code includes a utility function, [`fd_native_cpi_create_account_meta`](<#fd_native_cpi_create_account_meta>), which initializes account metadata structures. This function sets the signer and writable status of an account and copies the public key into the metadata structure. The code is part of a larger system that manages program execution in a virtual machine environment, focusing on the interaction between native programs and account data. It is designed to be used within a broader application, likely as part of a library that provides execution and account management capabilities.
# Imports and Dependencies

---
- `fd_native_cpi.h`
- `../fd_borrowed_account.h`
- `../fd_executor.h`
- `../../vm/syscall/fd_vm_syscall.h`
- `../../../util/bits/fd_uwide.h`


# Functions

---
### fd\_native\_cpi\_native\_invoke<!-- {{#callable:fd_native_cpi_native_invoke}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_native_cpi.c#L7>)

Executes a native program instruction within a given execution context.
- **Inputs**:
    - `ctx`: A pointer to the execution instruction context (`fd_exec_instr_ctx_t`).
    - `native_program_id`: A constant pointer to the public key of the native program (`fd_pubkey_t`).
    - `instr_data`: A pointer to the instruction data (`uchar`).
    - `instr_data_len`: The length of the instruction data (`ulong`).
    - `acct_metas`: A constant pointer to an array of account metadata (`fd_vm_rust_account_meta_t`).
    - `acct_metas_len`: The number of account metadata entries (`ulong`).
    - `signers`: A constant pointer to an array of signer public keys (`fd_pubkey_t`).
    - `signers_cnt`: The number of signers (`ulong`).
- **Logic and Control Flow**:
    - Initialize `instr_info` and `instruction_accounts` arrays.
    - Set `instr_info->program_id` to `UCHAR_MAX` and find the index of `native_program_id` in the transaction context.
    - If the program ID is found, update `instr_info->program_id`.
    - Initialize `instr_acct_keys` and `acc_idx_seen` arrays, and set all elements of `acc_idx_seen` to 0.
    - Set `instr_info->acct_cnt` to the number of account metadata entries.
    - Iterate over each account metadata entry to populate `instr_acct_keys` and set up instruction accounts using `fd_instr_info_setup_instr_account`.
    - Assign `instr_data` and its length to `instr_info->data` and `instr_info->data_sz`, respectively.
    - Call `fd_vm_prepare_instruction` to prepare the instruction for execution.
    - If `fd_vm_prepare_instruction` returns an error, return the error code.
    - Call `fd_execute_instr` to execute the instruction and return its result.
- **Output**: Returns an integer indicating the success or failure of the instruction execution.


---
### fd\_native\_cpi\_create\_account\_meta<!-- {{#callable:fd_native_cpi_create_account_meta}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_native_cpi.c#L70>)

Initializes an `fd_vm_rust_account_meta_t` structure with the provided public key, signer status, and writable status.
- **Inputs**:
    - `key`: A pointer to an `fd_pubkey_t` structure containing the public key to be copied into the `meta` structure.
    - `is_signer`: An unsigned character indicating whether the account is a signer (non-zero) or not (zero).
    - `is_writable`: An unsigned character indicating whether the account is writable (non-zero) or not (zero).
    - `meta`: A pointer to an `fd_vm_rust_account_meta_t` structure that will be initialized with the provided values.
- **Logic and Control Flow**:
    - Assigns the value of `is_signer` to `meta->is_signer`.
    - Assigns the value of `is_writable` to `meta->is_writable`.
    - Copies the public key from `key->key` to `meta->pubkey` using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `meta` structure in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)