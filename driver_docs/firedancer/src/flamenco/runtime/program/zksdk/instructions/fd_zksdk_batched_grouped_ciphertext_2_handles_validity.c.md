<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for verifying the validity of batched grouped ciphertexts with two handles in a zero-knowledge proof system.

# Purpose
The code provides functionality for verifying the validity of batched grouped ciphertexts with two handles. It includes functions to initialize a transcript for the verification process and to perform the actual verification of a proof. The [`batched_grouped_ciphertext_validity_transcript_init`](<#batched_grouped_ciphertext_validity_transcript_init>) function initializes a transcript with public keys and grouped ciphertexts, preparing it for the verification process. The [`fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity`](<#fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity>) function verifies the proof by checking several mathematical equivalences using multi-scalar multiplication (MSM) and ensures that the inputs meet specific conditions. It handles both batched and non-batched scenarios, adjusting the number of points and scalars involved in the MSM accordingly.

The code is part of a cryptographic library, likely intended to be used as part of a larger system that requires zero-knowledge proof verification. It defines a public API for verifying proofs related to grouped ciphertexts, which can be used by other components or applications. The [`fd_zksdk_instr_verify_proof_batched_grouped_ciphertext_2_handles_validity`](<#fd_zksdk_instr_verify_proof_batched_grouped_ciphertext_2_handles_validity>) function serves as an entry point for the verification process, taking context and proof data as input and returning a success or error code based on the verification outcome. The code relies on external functions and data structures, such as `fd_zksdk_transcript_t` and `fd_ristretto255_point_t`, indicating its integration with a broader cryptographic framework.
# Imports and Dependencies

---
- `../fd_zksdk_private.h`


# Functions

---
### batched\_grouped\_ciphertext\_validity\_transcript\_init<!-- {{#callable:batched_grouped_ciphertext_validity_transcript_init}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_batched_grouped_ciphertext_2_handles_validity.c#L3>)

Initializes a transcript for batched grouped ciphertext validity with two public keys and associated messages.
- **Inputs**:
    - `transcript`: A pointer to an `fd_zksdk_transcript_t` structure that will be initialized.
    - `context`: A pointer to a constant `fd_zksdk_batched_grp_ciph_2h_val_context_t` structure containing the public keys and grouped ciphertexts.
- **Logic and Control Flow**:
    - Call `fd_zksdk_transcript_init` to initialize the `transcript` with a specific literal string identifier.
    - Append the first public key from `context->pubkey1` to the `transcript` using `fd_zksdk_transcript_append_pubkey`.
    - Append the second public key from `context->pubkey2` to the `transcript` using `fd_zksdk_transcript_append_pubkey`.
    - Append the low part of the grouped ciphertext from `context->grouped_ciphertext_lo` to the `transcript` using `fd_zksdk_transcript_append_message`.
    - Append the high part of the grouped ciphertext from `context->grouped_ciphertext_hi` to the `transcript` using `fd_zksdk_transcript_append_message`.
- **Output**: No return value; the function modifies the `transcript` in place.


---
### fd\_zksdk\_verify\_proof\_batched\_grouped\_ciphertext\_2\_handles\_validity<!-- {{#callable:fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_batched_grouped_ciphertext_2_handles_validity.c#L14>)

Verifies the validity of a batched grouped ciphertext proof with two handles using multi-scalar multiplication (MSM).
- **Inputs**:
    - `proof`: A pointer to a `fd_zksdk_grp_ciph_2h_val_proof_t` structure containing the proof to verify.
    - `pubkey1`: A 32-byte array representing the first public key.
    - `pubkey2`: A 32-byte array representing the second public key.
    - `comm`: A 32-byte array representing the commitment.
    - `handle1`: A 32-byte array representing the first handle.
    - `handle2`: A 32-byte array representing the second handle.
    - `comm_hi`: A 32-byte array representing the high part of the commitment, used when batched.
    - `handle1_hi`: A 32-byte array representing the high part of the first handle, used when batched.
    - `handle2_hi`: A 32-byte array representing the high part of the second handle, used when batched.
    - `batched`: A boolean indicating whether the proof is batched.
    - `transcript`: A pointer to a `fd_zksdk_transcript_t` structure used for transcript management.
- **Logic and Control Flow**:
    - Check if `pubkey2` is zero and validate related inputs (`handle2`, `handle2_hi`, `proof->y2`) to ensure they are also zero if `pubkey2` is zero.
    - Validate the scalars `proof->zr` and `proof->zx` using `fd_curve25519_scalar_validate`.
    - Decompress points from the proof and inputs into the `points` array, handling the `batched` and `pubkey2_not_zero` conditions to determine which points to decompress.
    - Initialize the transcript and extract challenges `c` and `w`, and if `batched`, also extract `t`.
    - Compute the scalars for the MSM based on the proof and challenges, adjusting for `batched` and `pubkey2_not_zero` conditions.
    - Perform the MSM using `fd_ristretto255_multi_scalar_mul` with the computed scalars and points.
    - Compare the result of the MSM with `y0` to determine if the proof is valid, returning `FD_EXECUTOR_INSTR_SUCCESS` if valid, otherwise `FD_ZKSDK_VERIFY_PROOF_ERROR`.
- **Output**: Returns an integer indicating success (`FD_EXECUTOR_INSTR_SUCCESS`) or failure (`FD_ZKSDK_VERIFY_PROOF_ERROR`) of the proof verification.


---
### fd\_zksdk\_instr\_verify\_proof\_batched\_grouped\_ciphertext\_2\_handles\_validity<!-- {{#callable:fd_zksdk_instr_verify_proof_batched_grouped_ciphertext_2_handles_validity}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_batched_grouped_ciphertext_2_handles_validity.c#L193>)

Verifies the validity of a batched grouped ciphertext proof using two handles.
- **Inputs**:
    - `_context`: A pointer to a `fd_zksdk_batched_grp_ciph_2h_val_context_t` structure containing the context for the verification, including public keys and grouped ciphertexts.
    - `_proof`: A pointer to a `fd_zksdk_batched_grp_ciph_2h_val_proof_t` structure containing the proof to be verified.
- **Logic and Control Flow**:
    - Initialize a `fd_zksdk_transcript_t` object using the [`batched_grouped_ciphertext_validity_transcript_init`](<#batched_grouped_ciphertext_validity_transcript_init>) function with the provided context.
    - Call the [`fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity`](<#fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity>) function with the proof, context details, and the initialized transcript to perform the verification.
    - Return the result of the verification function, which indicates success or failure of the proof verification.
- **Output**: Returns an integer indicating the success or failure of the proof verification process.
- **Functions Called**:
    - [`batched_grouped_ciphertext_validity_transcript_init`](<#batched_grouped_ciphertext_validity_transcript_init>)
    - [`fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity`](<#fd_zksdk_verify_proof_batched_grouped_ciphertext_2_handles_validity>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)