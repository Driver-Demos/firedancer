<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions to initialize and verify zero-knowledge proofs for percentage with cap instructions.

# Purpose
The code is a C source file that implements functionality for verifying cryptographic proofs related to a "percentage with cap" concept. It includes functions that initialize and manage a cryptographic transcript, which is a sequence of operations that records commitments and challenges used in the proof verification process. The main function, [`fd_zksdk_instr_verify_proof_percentage_with_cap`](<#fd_zksdk_instr_verify_proof_percentage_with_cap>), serves as an interface to verify a given proof against a set of commitments and a maximum value. It uses helper functions such as [`percentage_with_cap_transcript_init`](<#percentage_with_cap_transcript_init>) to set up the transcript and [`fd_zksdk_verify_proof_percentage_with_cap`](<#fd_zksdk_verify_proof_percentage_with_cap>) to perform the actual verification logic.

The verification process involves validating scalar values and points, computing multi-scalar multiplications, and comparing the results to ensure the proof's correctness. The code uses cryptographic operations on elliptic curve points and scalars, specifically with the Ristretto255 curve, to perform these tasks. The file is intended to be part of a larger cryptographic library, as indicated by the inclusion of a private header file and the use of specific data structures and functions prefixed with `fd_zksdk`. The code does not define public APIs directly but provides internal functionality that can be used by other components of the library to verify cryptographic proofs.
# Imports and Dependencies

---
- `../fd_zksdk_private.h`


# Functions

---
### percentage\_with\_cap\_transcript\_init<!-- {{#callable:percentage_with_cap_transcript_init}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_percentage_with_cap.c#L3>)

Initializes a transcript for a percentage-with-cap instruction using context data.
- **Inputs**:
    - `transcript`: A pointer to an `fd_zksdk_transcript_t` structure that will be initialized.
    - `context`: A pointer to a constant `fd_zksdk_percentage_with_cap_context_t` structure containing the context data for initialization.
- **Logic and Control Flow**:
    - Call `fd_zksdk_transcript_init` to initialize the `transcript` with the literal "percentage-with-cap-instruction".
    - Append the `percentage_commitment` from `context` to `transcript` using `fd_zksdk_transcript_append_commitment` with the literal "percentage-commitment".
    - Append the `delta_commitment` from `context` to `transcript` using `fd_zksdk_transcript_append_commitment` with the literal "delta-commitment".
    - Append the `claimed_commitment` from `context` to `transcript` using `fd_zksdk_transcript_append_commitment` with the literal "claimed-commitment".
    - Append the `max_value` from `context` to `transcript` using `fd_merlin_transcript_append_u64` with the literal "max-value".
- **Output**: No output is returned as the function is `void`; it modifies the `transcript` in place.


---
### fd\_zksdk\_verify\_proof\_percentage\_with\_cap<!-- {{#callable:fd_zksdk_verify_proof_percentage_with_cap}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_percentage_with_cap.c#L14>)

Verifies a zero-knowledge proof for a percentage with a cap using Ristretto255 points and Curve25519 scalars.
- **Inputs**:
    - `proof`: A pointer to a `fd_zksdk_percentage_with_cap_proof_t` structure containing the proof data.
    - `percentage_commitment`: A 32-byte array representing the percentage commitment.
    - `delta_commitment`: A 32-byte array representing the delta commitment.
    - `claimed_commitment`: A 32-byte array representing the claimed commitment.
    - `max_value`: An unsigned long integer representing the maximum value for the cap.
    - `transcript`: A pointer to a `fd_zksdk_transcript_t` structure used for managing the transcript of the proof verification process.
- **Logic and Control Flow**:
    - Initialize arrays for scalars and points, and validate the scalar values in the `proof` structure.
    - Set base points `G` and `H`, and decompress the commitments and proof points into the `points` array.
    - Initialize the transcript with domain separation and append the proof points to it.
    - Generate challenge scalars `c` and `w` from the transcript, and compute `ww` as `w` squared.
    - Calculate the scalar `m` from `max_value` and adjust `c_eq` by subtracting `c_max` from `c`.
    - Compute the scalars for the multi-scalar multiplication (MSM) using the given formulas.
    - Perform the MSM with the computed scalars and points, storing the result in `res`.
    - Compare the result `res` with the decompressed `y` point to determine if the proof is valid.
    - Return `FD_EXECUTOR_INSTR_SUCCESS` if the proof is valid, otherwise return `FD_ZKSDK_VERIFY_PROOF_ERROR`.
- **Output**: Returns an integer indicating success (`FD_EXECUTOR_INSTR_SUCCESS`) or failure (`FD_ZKSDK_VERIFY_PROOF_ERROR`) of the proof verification.


---
### fd\_zksdk\_instr\_verify\_proof\_percentage\_with\_cap<!-- {{#callable:fd_zksdk_instr_verify_proof_percentage_with_cap}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_percentage_with_cap.c#L141>)

Verifies a proof of a percentage with a cap using a given context and proof data.
- **Inputs**:
    - `_context`: A pointer to a `fd_zksdk_percentage_with_cap_context_t` structure containing the context for the verification.
    - `_proof`: A pointer to a `fd_zksdk_percentage_with_cap_proof_t` structure containing the proof data to verify.
- **Logic and Control Flow**:
    - Initialize a `fd_zksdk_transcript_t` object named `transcript`.
    - Cast `_context` to a `fd_zksdk_percentage_with_cap_context_t` pointer and assign it to `context`.
    - Cast `_proof` to a `fd_zksdk_percentage_with_cap_proof_t` pointer and assign it to `proof`.
    - Call [`percentage_with_cap_transcript_init`](<#percentage_with_cap_transcript_init>) to initialize the `transcript` with the `context`.
    - Call [`fd_zksdk_verify_proof_percentage_with_cap`](<#fd_zksdk_verify_proof_percentage_with_cap>) with `proof`, commitments from `context`, `context->max_value`, and `transcript` to verify the proof.
    - Return the result of [`fd_zksdk_verify_proof_percentage_with_cap`](<#fd_zksdk_verify_proof_percentage_with_cap>).
- **Output**: Returns an integer indicating the success or failure of the proof verification process.
- **Functions Called**:
    - [`percentage_with_cap_transcript_init`](<#percentage_with_cap_transcript_init>)
    - [`fd_zksdk_verify_proof_percentage_with_cap`](<#fd_zksdk_verify_proof_percentage_with_cap>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)