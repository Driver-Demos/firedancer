<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions to verify ciphertext equality proofs using zero-knowledge protocols.

# Purpose
The code provides functionality for verifying proofs of ciphertext-ciphertext equality in a zero-knowledge setting. It includes functions that initialize a transcript for the verification process and perform the actual verification of the proof. The [`ciphertext_ciphertext_equality_transcript_init`](<#ciphertext_ciphertext_equality_transcript_init>) function initializes a transcript with public keys and ciphertexts, which are necessary for the verification process. The [`fd_zksdk_verify_proof_ciphertext_ciphertext_equality`](<#fd_zksdk_verify_proof_ciphertext_ciphertext_equality>) function validates the proof by checking the decompression of points and scalars, computing challenges, and performing multi-scalar multiplication to verify the equality of ciphertexts.

The code is part of a cryptographic library and is intended to be used as a component in a larger system that requires zero-knowledge proof verification. It defines internal functions with static linkage, indicating that these functions are not intended to be part of a public API but are used within the module. The [`fd_zksdk_instr_verify_proof_ciphertext_ciphertext_equality`](<#fd_zksdk_instr_verify_proof_ciphertext_ciphertext_equality>) function serves as an entry point for verifying proofs, taking context and proof data as input and returning a success or error code based on the verification result.
# Imports and Dependencies

---
- `../fd_zksdk_private.h`


# Functions

---
### ciphertext\_ciphertext\_equality\_transcript\_init<!-- {{#callable:ciphertext_ciphertext_equality_transcript_init}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_ciphertext_ciphertext_equality.c#L3>)

Initializes a transcript for ciphertext-ciphertext equality verification by appending public keys and ciphertexts from the context.
- **Inputs**:
    - `transcript`: A pointer to an `fd_zksdk_transcript_t` structure where the transcript will be initialized and updated.
    - `context`: A pointer to a constant `fd_zksdk_ciph_ciph_eq_context_t` structure containing the public keys and ciphertexts to append to the transcript.
- **Logic and Control Flow**:
    - Call `fd_zksdk_transcript_init` to initialize the transcript with the literal 'ciphertext-ciphertext-equality-instruction'.
    - Append the first public key from the context to the transcript using `fd_zksdk_transcript_append_pubkey` with the literal 'first-pubkey'.
    - Append the second public key from the context to the transcript using `fd_zksdk_transcript_append_pubkey` with the literal 'second-pubkey'.
    - Append the first ciphertext from the context to the transcript using `fd_zksdk_transcript_append_ciphertext` with the literal 'first-ciphertext'.
    - Append the second ciphertext from the context to the transcript using `fd_zksdk_transcript_append_ciphertext` with the literal 'second-ciphertext'.
- **Output**: No return value; the function modifies the `transcript` in place.


---
### fd\_zksdk\_verify\_proof\_ciphertext\_ciphertext\_equality<!-- {{#callable:fd_zksdk_verify_proof_ciphertext_ciphertext_equality}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_ciphertext_ciphertext_equality.c#L14>)

Verifies the equality of two ciphertexts using a zero-knowledge proof.
- **Inputs**:
    - `proof`: A pointer to a `fd_zksdk_ciph_ciph_eq_proof_t` structure containing the proof data.
    - `pubkey1`: A 32-byte array representing the first public key.
    - `pubkey2`: A 32-byte array representing the second public key.
    - `ciphertext1`: A 64-byte array representing the first ciphertext.
    - `ciphertext2`: A 64-byte array representing the second ciphertext.
    - `transcript`: A pointer to a `fd_zksdk_transcript_t` structure used for maintaining the transcript of the proof verification process.
- **Logic and Control Flow**:
    - Validate the scalar values `zs`, `zx`, and `zr` from the `proof` using `fd_curve25519_scalar_validate`.
    - Decompress various points from the `proof`, `pubkey1`, `pubkey2`, `ciphertext1`, and `ciphertext2` into the `points` array using `fd_ristretto255_point_decompress`.
    - If any decompression fails, return `FD_ZKSDK_VERIFY_PROOF_ERROR`.
    - Initialize the transcript with domain separation for ciphertext equality proof using `fd_zksdk_transcript_domsep_ciph_ciph_eq_proof`.
    - Append and validate points `Y_0`, `Y_1`, `Y_2`, and `Y_3` to the transcript. If validation fails, return `FD_ZKSDK_VERIFY_PROOF_ERROR`.
    - Extract challenge scalars `c` and `w` from the transcript using `fd_zksdk_transcript_challenge_scalar`.
    - Compute the scalar `ww` as the square of `w`.
    - Calculate the `scalars` array using various arithmetic operations on `w`, `ww`, `c`, and proof scalars `zs`, `zx`, `zr`.
    - Perform a multi-scalar multiplication (MSM) with the `scalars` and `points` arrays to compute the result `res`.
    - Check if the computed point `res` is equal to `y0`. If they are equal, return `FD_EXECUTOR_INSTR_SUCCESS`; otherwise, return `FD_ZKSDK_VERIFY_PROOF_ERROR`.
- **Output**: Returns an integer indicating success (`FD_EXECUTOR_INSTR_SUCCESS`) or failure (`FD_ZKSDK_VERIFY_PROOF_ERROR`) of the proof verification.


---
### fd\_zksdk\_instr\_verify\_proof\_ciphertext\_ciphertext\_equality<!-- {{#callable:fd_zksdk_instr_verify_proof_ciphertext_ciphertext_equality}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_ciphertext_ciphertext_equality.c#L140>)

Verifies the equality of two ciphertexts using a given proof and context.
- **Inputs**:
    - `_context`: A pointer to a `fd_zksdk_ciph_ciph_eq_context_t` structure containing public keys and ciphertexts.
    - `_proof`: A pointer to a `fd_zksdk_ciph_ciph_eq_proof_t` structure containing the proof data.
- **Logic and Control Flow**:
    - Initialize a `fd_zksdk_transcript_t` object.
    - Cast `_context` to `fd_zksdk_ciph_ciph_eq_context_t` and `_proof` to `fd_zksdk_ciph_ciph_eq_proof_t`.
    - Call [`ciphertext_ciphertext_equality_transcript_init`](<#ciphertext_ciphertext_equality_transcript_init>) to initialize the transcript with context data.
    - Call [`fd_zksdk_verify_proof_ciphertext_ciphertext_equality`](<#fd_zksdk_verify_proof_ciphertext_ciphertext_equality>) with the proof, context data, and transcript to verify the proof.
    - Return the result of the verification function.
- **Output**: Returns an integer indicating success or failure of the proof verification.
- **Functions Called**:
    - [`ciphertext_ciphertext_equality_transcript_init`](<#ciphertext_ciphertext_equality_transcript_init>)
    - [`fd_zksdk_verify_proof_ciphertext_ciphertext_equality`](<#fd_zksdk_verify_proof_ciphertext_ciphertext_equality>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)