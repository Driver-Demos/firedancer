<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions to verify the validity of public key proofs using zero-knowledge protocols.

# Purpose
The code is a C module that provides functionality for verifying the validity of a public key using zero-knowledge proofs. It includes functions to initialize a transcript for public key validity and to verify a proof of public key validity. The module uses cryptographic operations based on the Ristretto255 curve and Curve25519 scalars to perform these verifications.

The function [`pubkey_validity_transcript_init`](<#pubkey_validity_transcript_init>) initializes a transcript with a specific domain separator for public key validity instructions. The function [`fd_zksdk_verify_proof_pubkey_validity`](<#fd_zksdk_verify_proof_pubkey_validity>) verifies a proof by checking the equivalence of cryptographic expressions involving the public key and proof data. It validates inputs, finalizes the transcript, extracts challenges, computes necessary scalars, and performs a multi-scalar multiplication to verify the proof. The function [`fd_zksdk_instr_verify_proof_pubkey_validity`](<#fd_zksdk_instr_verify_proof_pubkey_validity>) serves as an interface to initialize the transcript and call the verification function with the provided context and proof.
# Imports and Dependencies

---
- `../fd_zksdk_private.h`


# Functions

---
### pubkey\_validity\_transcript\_init<!-- {{#callable:pubkey_validity_transcript_init}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_pubkey_validity.c#L3>)

Initializes a transcript for public key validity verification by setting a domain separator and appending a public key.
- **Inputs**:
    - `transcript`: A pointer to an `fd_zksdk_transcript_t` structure that will be initialized.
    - `context`: A pointer to a constant `fd_zksdk_pubkey_validity_context_t` structure containing the public key to append to the transcript.
- **Logic and Control Flow**:
    - Call `fd_zksdk_transcript_init` to initialize the `transcript` with the domain separator 'pubkey-validity-instruction'.
    - Call `fd_zksdk_transcript_append_pubkey` to append the public key from `context->pubkey` to the `transcript` with the label 'pubkey'.
- **Output**: No return value; the function modifies the `transcript` in place.


---
### fd\_zksdk\_verify\_proof\_pubkey\_validity<!-- {{#callable:fd_zksdk_verify_proof_pubkey_validity}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_pubkey_validity.c#L11>)

Verifies the validity of a public key proof by checking the equivalence of elliptic curve operations.
- **Inputs**:
    - `proof`: A pointer to a `fd_zksdk_pubkey_validity_proof_t` structure containing the proof data, including the scalar `z` and point `y`.
    - `pubkey`: A 32-byte array representing the public key to verify.
    - `transcript`: A pointer to a `fd_zksdk_transcript_t` structure used to manage the transcript of the proof verification process.
- **Logic and Control Flow**:
    - Initialize arrays for scalars and points, and validate the scalar `z` from the proof using `fd_curve25519_scalar_validate`.
    - Set the first point in the `points` array to the basepoint `H` and decompress the public key into the second point using `fd_ristretto255_point_decompress`.
    - Decompress the point `y` from the proof and validate it.
    - Finalize the transcript with domain separation for public key proof and append the point `y` to the transcript.
    - Extract the challenge scalar `c` from the transcript.
    - Set the first scalar to `z` and the second scalar to `-c` using `fd_curve25519_scalar_set` and `fd_curve25519_scalar_neg`.
    - Perform a multi-scalar multiplication with the scalars and points, storing the result in `res`.
    - Check if the result `res` is equal to `y` using `fd_ristretto255_point_eq`.
    - Return `FD_EXECUTOR_INSTR_SUCCESS` if the points are equal, otherwise return `FD_ZKSDK_VERIFY_PROOF_ERROR`.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` if the proof is valid, otherwise returns `FD_ZKSDK_VERIFY_PROOF_ERROR`.


---
### fd\_zksdk\_instr\_verify\_proof\_pubkey\_validity<!-- {{#callable:fd_zksdk_instr_verify_proof_pubkey_validity}} -->
[View Source →](<../../../../../../../../src/flamenco/runtime/program/zksdk/instructions/fd_zksdk_pubkey_validity.c#L66>)

Verifies the validity of a public key proof using a given context and proof data.
- **Inputs**:
    - `_context`: A pointer to a `fd_zksdk_pubkey_validity_context_t` structure containing the public key context.
    - `_proof`: A pointer to a `fd_zksdk_pubkey_validity_proof_t` structure containing the proof data to verify.
- **Logic and Control Flow**:
    - Initialize a `fd_zksdk_transcript_t` object named `transcript`.
    - Cast `_context` to a `fd_zksdk_pubkey_validity_context_t` pointer and assign it to `context`.
    - Cast `_proof` to a `fd_zksdk_pubkey_validity_proof_t` pointer and assign it to `proof`.
    - Call [`pubkey_validity_transcript_init`](<#pubkey_validity_transcript_init>) to initialize the `transcript` with the `context`.
    - Call [`fd_zksdk_verify_proof_pubkey_validity`](<#fd_zksdk_verify_proof_pubkey_validity>) with `proof`, `context->pubkey`, and `transcript` to verify the proof.
    - Return the result of [`fd_zksdk_verify_proof_pubkey_validity`](<#fd_zksdk_verify_proof_pubkey_validity>).
- **Output**: Returns an integer indicating the success or failure of the proof verification process.
- **Functions Called**:
    - [`pubkey_validity_transcript_init`](<#pubkey_validity_transcript_init>)
    - [`fd_zksdk_verify_proof_pubkey_validity`](<#fd_zksdk_verify_proof_pubkey_validity>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)