<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines functions and structures for a stake program that manages coin staking and rewards on validators.

# Purpose
The code is a C header file that defines the interface for a stake program within a blockchain system. This program allows users to stake their coins on a validator, which is registered with a vote program. Users receive inflation rewards for staking their coins. The program manages accounts owned by the stake program to determine validator stake weights and distribute staking rewards. The header file includes necessary context headers and defines constants, function prototypes, and data structures related to the stake program.

Key components of the code include the [`fd_stake_program_execute`](<#fd_stake_program_execute>) function, which serves as the instruction processing entry point for the stake program. It also includes functions for initializing configuration accounts ([`fd_stake_program_config_init`](<#fd_stake_program_config_init>)), retrieving the state of a stake account ([`fd_stake_get_state`](<#fd_stake_get_state>)), and managing stake activation and deactivation ([`fd_stake_activating_and_deactivating`](<#fd_stake_activating_and_deactivating>)). The file defines a constant `FD_STAKE_STATE_V2_SZ` for the size of the stake state version 2. The header file is intended to be included in other C source files that implement or interact with the stake program, providing a clear API for managing stake-related operations.
# Imports and Dependencies

---
- `../context/fd_exec_instr_ctx.h`
- `../context/fd_exec_txn_ctx.h`


# Function Declarations (Public API)

---
### fd\_new\_warmup\_cooldown\_rate\_epoch<!-- {{#callable_declaration:fd_new_warmup_cooldown_rate_epoch}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_stake_program.h#L17>)

Calculates the epoch for a given slot based on warmup and cooldown rates.
- **Description**: Use this function to determine the epoch corresponding to a specific slot, considering the warmup and cooldown rates. This function requires a valid `epoch_schedule` and `features` to operate correctly. It sets the `epoch` output parameter to the calculated epoch and returns a status code indicating success or failure. If the `epoch_schedule` is null, the function sets an error code and returns a failure status. Ensure that the `features` parameter is correctly configured to include the `reduce_stake_warmup_cooldown` feature, as this function assumes its activation.
- **Inputs**:
    - `epoch_schedule`: A pointer to a `fd_epoch_schedule_t` structure that defines the epoch schedule. Must not be null. If null, the function sets `epoch` to `ULONG_MAX`, sets `err` to an error code, and returns 1.
    - `features`: A pointer to a `fd_features_t` structure that contains feature flags. Must include the `reduce_stake_warmup_cooldown` feature for the function to operate correctly.
    - `slot`: An unsigned long integer representing the slot for which the epoch is to be calculated. Must be a valid slot number.
    - `epoch`: A pointer to an unsigned long where the calculated epoch will be stored. Must not be null.
    - `err`: A pointer to an integer where the error code will be stored. Must not be null. Set to 0 on success or an error code on failure.
- **Output**: Returns 1 if the epoch is successfully calculated or if an error occurs due to a null `epoch_schedule`. Returns 0 if the `reduce_stake_warmup_cooldown` feature is not active. The `epoch` parameter is updated with the calculated epoch, and `err` is set to indicate success or the specific error.
- **See Also**: [`fd_new_warmup_cooldown_rate_epoch`](<fd_stake_program.c.md#fd_new_warmup_cooldown_rate_epoch>)  (Implementation)


---
### fd\_stake\_program\_execute<!-- {{#callable_declaration:fd_stake_program_execute}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_stake_program.h#L32>)

Processes stake program instructions.
- **Description**: Use this function to execute instructions for the stake program. It processes various stake-related operations such as initialization, authorization, delegation, and more. Ensure that the context provided is correctly set up and that the instruction data is valid. The function will return specific error codes if the instruction is unsupported, invalid, or if there are insufficient account keys. It is important to check the return value to handle any errors that may occur during execution.
- **Inputs**:
    - `ctx`: A pointer to `fd_exec_instr_ctx_t`, which must be valid and properly initialized. The context contains the transaction and instruction data necessary for processing. The caller retains ownership.
- **Output**: Returns an integer status code indicating success or the type of error encountered. The context's transaction may be marked as modified if a stake account is altered.
- **See Also**: [`fd_stake_program_execute`](<fd_stake_program.c.md#fd_stake_program_execute>)  (Implementation)


---
### fd\_stake\_program\_config\_init<!-- {{#callable_declaration:fd_stake_program_config_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_stake_program.h#L38>)

Initializes an account with default stake program configuration.
- **Description**: Use this function to set up an account with the default configuration parameters for the stake program. This function must be called before the account is used in the stake program to ensure it has the necessary configuration. It writes the default configuration to the specified account, which includes parameters like warmup cooldown rate and slash penalty. Ensure that the account database and transaction ID provided are valid and initialized before calling this function.
- **Inputs**:
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null. The caller retains ownership.
    - `xid`: A pointer to a `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null. The caller retains ownership.
- **Output**: None
- **See Also**: [`fd_stake_program_config_init`](<fd_stake_program.c.md#fd_stake_program_config_init>)  (Implementation)


---
### fd\_stake\_get\_state<!-- {{#callable_declaration:fd_stake_get_state}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_stake_program.h#L42>)

Retrieves the current state of a stake account.
- **Description**: Use this function to obtain the current state of a stake account. It requires a valid stake account and a destination for the state data. Ensure that the destination pointer is valid and can store the state information. This function does not modify the input account but writes the state to the provided output location.
- **Inputs**:
    - `self`: A pointer to a `fd_txn_account_t` structure representing the stake account. Must not be null.
    - `out`: A pointer to a `fd_stake_state_v2_t` structure where the state will be stored. Must not be null and must point to a valid memory location capable of holding the state data.
- **Output**: Returns an integer status code indicating success or failure of the operation.
- **See Also**: [`fd_stake_get_state`](<fd_stake_program.c.md#fd_stake_get_state>)  (Implementation)


---
### fd\_stake\_activating\_and\_deactivating<!-- {{#callable_declaration:fd_stake_activating_and_deactivating}} -->
[View Source →](<../../../../../../src/flamenco/runtime/program/fd_stake_program.h#L46>)

Calculates the activating and deactivating stake for a given epoch.
- **Description**: Use this function to determine the amount of stake that is activating or deactivating for a specific epoch. This is useful when you need to track stake changes over time. Ensure that the `self` parameter is a valid pointer to a `fd_delegation_t` structure, and `stake_history` is a valid pointer to a `fd_stake_history_t` structure. The function will update the `new_rate_activation_epoch` with the epoch when a new rate becomes active, if applicable.
- **Inputs**:
    - `self`: A pointer to a `fd_delegation_t` structure representing the delegation. Must not be null.
    - `target_epoch`: An unsigned long integer specifying the epoch for which to calculate stake changes. Must be a valid epoch number.
    - `stake_history`: A pointer to a `fd_stake_history_t` structure containing historical stake data. Must not be null.
    - `new_rate_activation_epoch`: A pointer to an unsigned long where the function will store the epoch of new rate activation, if applicable. Must not be null.
- **Output**: Returns a `fd_stake_history_entry_t` structure containing the activating and deactivating stake information for the specified epoch.
- **See Also**: [`fd_stake_activating_and_deactivating`](<fd_stake_program.c.md#fd_stake_activating_and_deactivating>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)