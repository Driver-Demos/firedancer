<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for interpreting Solana address lookup table usages, including functions for creating, deleting, and resolving indirect account references.

# Purpose
The code is a C header file that defines an API for interpreting Solana address lookup table (ALUT) usages. It provides functionality to manage and resolve indirect account references within a Solana transaction. The file includes necessary headers for transaction handling, base58 encoding, and error management, indicating its integration with a larger system for transaction processing.

The primary component is the `fd_alut_interp_t` structure, which holds information about the transaction, its payload, and the lookup table state. The file defines several functions, including [`fd_alut_interp_new`](<#fd_alut_interp_new>), [`fd_alut_interp_delete`](<#fd_alut_interp_delete>), and [`fd_alut_interp_next`](<#fd_alut_interp_next>). These functions manage the lifecycle of an ALUT interpreter, resolve indirect account references, and handle errors related to address lookup tables. The code ensures that the addresses are correctly resolved and validated against expected values, and it provides error codes for various failure scenarios. This header file is intended to be included in other C files that require ALUT interpretation functionality.
# Imports and Dependencies

---
- `../../ballet/txn/fd_txn.h`
- `../../ballet/base58/fd_base58.h`
- `fd_runtime_err.h`
- `fd_system_ids.h`
- `program/fd_address_lookup_table_program.h`


# Data Structures

---
### fd\_alut\_interp
- **Type**: ``struct``
- **Members**:
    - `out_accts_alt`: Pointer to an array of account addresses for output.
    - `txn`: Pointer to a constant transaction descriptor.
    - `txn_payload`: Pointer to a constant serialized transaction payload.
    - `hashes`: Pointer to a constant deque of slot hashes.
    - `slot`: Unsigned long integer representing the slot number.
    - `alut_idx`: Unsigned long integer representing the current index in the address lookup table.
    - `ro_indir_cnt`: Unsigned long integer counting read-only indirect references.
    - `rw_indir_cnt`: Unsigned long integer counting read-write indirect references.
- **Description**: Interprets indirect account references in a transaction by using a Solana address lookup table. It maintains pointers to transaction data and manages indices and counts for indirect references, facilitating the resolution of account addresses during transaction processing.


---
### fd\_alut\_interp\_t
- **Type**: ``struct``
- **Members**:
    - ``out_accts_alt``: Pointer to an array of account addresses for output.
    - ``txn``: Pointer to a constant transaction descriptor.
    - ``txn_payload``: Pointer to a constant serialized transaction payload.
    - ``hashes``: Pointer to a constant deque of slot hashes.
    - ``slot``: Unsigned long integer representing the slot number.
    - ``alut_idx``: Unsigned long integer index for address lookup table.
    - ``ro_indir_cnt``: Unsigned long integer count of read-only indirect references.
    - ``rw_indir_cnt``: Unsigned long integer count of read-write indirect references.
- **Description**: Interprets indirect account references in a transaction by managing pointers to transaction data, slot hashes, and output account addresses. It maintains indices and counts for address lookup tables, facilitating the resolution of indirect references in Solana transactions.


# Functions

---
### fd\_alut\_interp\_new<!-- {{#callable:fd_alut_interp_new}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_alut_interp.h#L32>)

Initializes a new ALUT interpreter with specified transaction details and address references.
- **Inputs**:
    - `interp`: A pointer to an `fd_alut_interp_t` structure to initialize.
    - `out_addrs`: A pointer to `fd_acct_addr_t` where indirectly referenced addresses will be written.
    - `txn`: A constant pointer to an `fd_txn_t` structure representing the transaction descriptor.
    - `txn_payload`: A constant pointer to an unsigned character array representing the serialized transaction.
    - `hashes`: A constant pointer to `fd_slot_hash_t` representing a deque of slot hashes.
    - `slot`: An unsigned long integer representing the slot number.
- **Logic and Control Flow**:
    - Assigns the `out_addrs` to the `out_accts_alt` field of `interp`.
    - Assigns the `txn` to the `txn` field of `interp`.
    - Assigns the `txn_payload` to the `txn_payload` field of `interp`.
    - Assigns the `hashes` to the `hashes` field of `interp`.
    - Assigns the `slot` to the `slot` field of `interp`.
    - Initializes `alut_idx`, `ro_indir_cnt`, and `rw_indir_cnt` to 0UL.
    - Returns the initialized `interp` pointer.
- **Output**: Returns a pointer to the initialized `fd_alut_interp_t` structure.


---
### fd\_alut\_interp\_delete<!-- {{#callable:fd_alut_interp_delete}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_alut_interp.h#L64>)

Releases references to the ALUT interpreter object and returns it.
- **Inputs**:
    - ``interp``: A pointer to an `fd_alut_interp_t` structure representing the ALUT interpreter to be deleted.
- **Logic and Control Flow**:
    - The function takes a pointer to an `fd_alut_interp_t` structure as input.
    - It returns the same pointer without modifying the structure or performing any additional operations.
- **Output**: Returns the input pointer `interp`.


---
### fd\_alut\_interp\_done<!-- {{#callable:fd_alut_interp_done}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_alut_interp.h#L69>)

Checks if the current index of the address lookup table interpreter has reached the total count of address table lookups in the transaction.
- **Inputs**:
    - ``interp``: A pointer to a constant `fd_alut_interp_t` structure, which contains the state of the address lookup table interpreter.
- **Logic and Control Flow**:
    - Access the `alut_idx` field of the `interp` structure to get the current index of the address lookup table interpreter.
    - Access the `addr_table_lookup_cnt` field of the `txn` structure within `interp` to get the total number of address table lookups in the transaction.
    - Compare `alut_idx` with `addr_table_lookup_cnt` to determine if the interpreter has completed processing all address table lookups.
- **Output**: Returns an integer value: 1 if the interpreter has completed processing all address table lookups, otherwise 0.


---
### fd\_alut\_interp\_next<!-- {{#callable:fd_alut_interp_next}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_alut_interp.h#L83>)

Resolves a subset of a transaction's indirect account references using an address lookup table.
- **Inputs**:
    - ``interp``: A pointer to an `fd_alut_interp_t` structure that holds the state of the address lookup table interpreter.
    - ``alut_addr``: A pointer to the expected address lookup table account address.
    - ``alut_owner``: A pointer to the expected owner of the address lookup table.
    - ``alut_data``: A pointer to the data of the address lookup table.
    - ``alut_data_sz``: The size of the address lookup table data in bytes.
- **Logic and Control Flow**:
    - Checks if the interpreter has completed processing all address lookup tables using [`fd_alut_interp_done`](<#fd_alut_interp_done>) and logs a critical error if true.
    - Loads the expected address from the transaction payload and compares it with `alut_addr`. Logs a critical error if they do not match.
    - Retrieves the address lookup table from the transaction using the current index `alut_idx`.
    - Verifies that `alut_owner` matches the expected program ID and returns an error if not.
    - Checks if `alut_data_sz` is less than the required metadata size and returns an error if true.
    - Decodes the address lookup table state from `alut_data` and returns an error if decoding fails or if the discriminant is incorrect.
    - Ensures that the remaining data size is 32-byte aligned and returns an error if not.
    - Calculates the number of lookup addresses and retrieves them from `alut_data`.
    - Calls [`fd_get_active_addresses_len`](<program/fd_address_lookup_table_program.c.md#fd_get_active_addresses_len>) to determine the number of active addresses and returns an error if the call fails.
    - Iterates over writable and readonly indices, checking if they are within bounds and updating the interpreter's output accounts accordingly.
    - Increments the `alut_idx` to process the next address lookup table.
- **Output**: Returns `FD_RUNTIME_EXECUTE_SUCCESS` on success, or an error code indicating the type of failure encountered.
- **Functions Called**:
    - [`fd_alut_interp_done`](<#fd_alut_interp_done>)
    - [`fd_get_active_addresses_len`](<program/fd_address_lookup_table_program.c.md#fd_get_active_addresses_len>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)