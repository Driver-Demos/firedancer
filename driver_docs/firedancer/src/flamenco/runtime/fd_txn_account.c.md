<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for managing transaction accounts, including creation, joining, deletion, and metadata manipulation.

# Purpose
The code defines a set of functions for managing transaction accounts in a financial or blockchain-related system. It provides functionality to create, join, leave, and delete transaction accounts, as well as to initialize them from external data sources. The code includes functions to manage account metadata, such as public keys, lamports (a unit of currency), and data associated with the account. It also provides mechanisms for handling account mutability, ensuring that accounts can be marked as mutable or immutable, and includes functions to safely acquire and release write access to accounts.

The code is structured to handle both read-only and mutable transaction accounts, with functions to check and modify account properties like ownership, executable status, and data length. It includes error handling and logging to ensure that operations on accounts are performed safely and correctly. The code also provides utility functions to interact with external systems, such as `fd_funk_t` and `fd_accdb_user_t`, to synchronize account data and manage transactions. The use of macros like `FD_UNLIKELY` and logging functions like `FD_LOG_WARNING` and `FD_LOG_CRIT` indicates a focus on performance and error detection.
# Imports and Dependencies

---
- `fd_txn_account.h`
- `fd_runtime.h`
- `../accdb/fd_accdb_sync.h`
- `program/fd_program_util.h`


# Functions

---
### fd\_txn\_account\_new<!-- {{#callable:fd_txn_account_new}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L6>)

Initializes a new transaction account in the provided memory space with specified metadata and mutability.
- **Inputs**:
    - `mem`: A pointer to the memory location where the transaction account will be initialized.
    - `pubkey`: A constant pointer to the public key associated with the transaction account.
    - `meta`: A pointer to the account metadata structure containing initial data length and lamports.
    - `is_mutable`: An integer indicating whether the account is mutable (non-zero) or not (zero).
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if so, log a warning and return NULL.
    - Check if `mem` is properly aligned for `fd_txn_account_t`; if not, log a warning and return NULL.
    - Check if `pubkey` is NULL; if so, log a warning and return NULL.
    - Check if `meta` is NULL; if so, log a warning and return NULL.
    - Cast `mem` to `fd_txn_account_t *` and assign it to `txn_account`.
    - Copy the `pubkey` into `txn_account->pubkey`.
    - Set `txn_account->magic` to `FD_TXN_ACCOUNT_MAGIC`.
    - Set `txn_account->starting_dlen` and `txn_account->starting_lamports` from `meta`.
    - Calculate the data pointer from `meta` and assign it to `txn_account->data`.
    - Calculate the offset of `meta` from `mem` and assign it to `txn_account->meta_soff`.
    - Assign `meta` to `txn_account->meta` and `is_mutable` to `txn_account->is_mutable`.
    - Return the `mem` pointer.
- **Output**: Returns the pointer to the initialized memory location if successful, or NULL if any input validation fails.


---
### fd\_txn\_account\_join<!-- {{#callable:fd_txn_account_join}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L51>)

Validates and initializes a `fd_txn_account_t` structure from a memory block and workspace.
- **Inputs**:
    - `mem`: A pointer to a memory block that should contain a `fd_txn_account_t` structure.
    - `data_wksp`: A pointer to a `fd_wksp_t` workspace used for data operations.
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if so, log a warning and return NULL.
    - Check if `mem` is aligned to the alignment requirements of `fd_txn_account_t`; if not, log a warning and return NULL.
    - Check if `data_wksp` is NULL; if so, log a warning and return NULL.
    - Cast `mem` to a `fd_txn_account_t` pointer named `txn_account`.
    - Check if `txn_account->magic` matches `FD_TXN_ACCOUNT_MAGIC`; if not, log a warning and return NULL.
    - Check if `txn_account->meta_soff` is zero; if so, log a critical error.
    - Calculate the `meta` pointer by adding `meta_soff` to `mem`.
    - Calculate the `data` pointer by adding the size of `fd_account_meta_t` to the `meta` pointer.
    - Return the initialized `txn_account`.
- **Output**: A pointer to the initialized `fd_txn_account_t` structure, or NULL if any validation fails.


---
### fd\_txn\_account\_leave<!-- {{#callable:fd_txn_account_leave}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L85>)

Clears the `meta` and `data` fields of a transaction account and returns the account pointer.
- **Inputs**:
    - `acct`: A pointer to an `fd_txn_account_t` structure representing the transaction account to leave.
- **Logic and Control Flow**:
    - Check if `acct` is NULL; if true, log a warning and return NULL.
    - Check if `acct->magic` is not equal to `FD_TXN_ACCOUNT_MAGIC`; if true, log a warning and return NULL.
    - Set `acct->meta` to NULL.
    - Set `acct->data` to NULL.
    - Return the `acct` pointer.
- **Output**: Returns a pointer to the `fd_txn_account_t` structure if successful, or NULL if an error occurs.


---
### fd\_txn\_account\_delete<!-- {{#callable:fd_txn_account_delete}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L104>)

Deletes a transaction account by validating and resetting its magic number.
- **Inputs**:
    - `mem`: A pointer to the memory location of the transaction account to delete.
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if true, log a warning and return NULL.
    - Check if `mem` is aligned to the alignment of `fd_txn_account_t`; if not, log a warning and return NULL.
    - Cast `mem` to a `fd_txn_account_t` pointer named `txn_account`.
    - Check if `txn_account->magic` is equal to `FD_TXN_ACCOUNT_MAGIC`; if not, log a warning and return NULL.
    - Set `txn_account->magic` to 0UL to mark the account as deleted.
    - Return the `mem` pointer.
- **Output**: Returns the original `mem` pointer if the deletion is successful, otherwise returns NULL.


---
### fd\_txn\_account\_init\_from\_funk\_readonly<!-- {{#callable:fd_txn_account_init_from_funk_readonly}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L130>)

Initializes a transaction account in a read-only mode using metadata from a given `fd_funk_t` instance.
- **Inputs**:
    - `acct`: A pointer to an `fd_txn_account_t` structure to initialize.
    - `pubkey`: A constant pointer to an `fd_pubkey_t` structure representing the public key of the account.
    - `funk`: A constant pointer to an `fd_funk_t` structure from which to retrieve account metadata.
    - `xid`: A constant pointer to an `fd_funk_txn_xid_t` structure representing the transaction ID.
- **Logic and Control Flow**:
    - Initialize `err` to `FD_ACC_MGR_SUCCESS`.
    - Call [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>) to retrieve account metadata, passing `funk`, `xid`, `pubkey`, and `&err` as arguments.
    - Check if `err` is not equal to `FD_ACC_MGR_SUCCESS`; if so, return `err`.
    - Call [`fd_txn_account_new`](<#fd_txn_account_new>) to create a new transaction account with the retrieved metadata, setting `is_mutable` to 0.
    - Call [`fd_txn_account_join`](<#fd_txn_account_join>) to join the newly created transaction account to the workspace of `funk`.
    - If joining fails, log a critical error message and continue.
    - Return `FD_ACC_MGR_SUCCESS`.
- **Output**: Returns an integer status code, `FD_ACC_MGR_SUCCESS` on success or an error code if metadata retrieval fails.
- **Functions Called**:
    - [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>)
    - [`fd_txn_account_join`](<#fd_txn_account_join>)
    - [`fd_txn_account_new`](<#fd_txn_account_new>)


---
### fd\_txn\_account\_init\_from\_funk\_mutable<!-- {{#callable:fd_txn_account_init_from_funk_mutable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L160>)

Initializes a transaction account from a mutable funk account database, preparing it for modification.
- **Inputs**:
    - `acct`: A pointer to the `fd_txn_account_t` structure to initialize.
    - `pubkey`: A constant pointer to the `fd_pubkey_t` structure representing the public key of the account.
    - `accdb`: A pointer to the `fd_accdb_user_t` structure representing the account database user.
    - `xid`: A constant pointer to the `fd_funk_txn_xid_t` structure representing the transaction ID.
    - `do_create`: An integer flag indicating whether to create the account if it does not exist.
    - `min_data_sz`: An unsigned long representing the minimum data size required for the account.
    - `prepare_out`: A pointer to the `fd_funk_rec_prepare_t` structure to store preparation details for the account modification.
- **Logic and Control Flow**:
    - Initialize `prepare_out` to zero.
    - Prepare the account database for modification using `fd_accdb_modify_prepare`.
    - If preparation fails, return `NULL`.
    - Create a new transaction account using [`fd_txn_account_new`](<#fd_txn_account_new>) and join it using [`fd_txn_account_join`](<#fd_txn_account_join>).
    - If joining fails, log a critical error and terminate.
    - Decrease the active writable reference count in `accdb`.
    - Retrieve the transaction from the transaction pool using `accdb->tip_txn_idx`.
    - Verify that the transaction ID matches `xid`; if not, log a critical error.
    - If the record is not published, populate `prepare_out` with record preparation details.
    - If the record is published, reset `prepare_out` to zero.
    - Return the metadata of the writable reference.
- **Output**: Returns a pointer to the `fd_account_meta_t` structure representing the metadata of the writable reference, or `NULL` if preparation fails.
- **Functions Called**:
    - [`fd_txn_account_join`](<#fd_txn_account_join>)
    - [`fd_txn_account_new`](<#fd_txn_account_new>)


---
### fd\_txn\_account\_mutable\_fini<!-- {{#callable:fd_txn_account_mutable_fini}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L201>)

Finalizes a mutable transaction account by validating and publishing a prepared record.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account.
    - ``accdb``: A pointer to the `fd_accdb_user_t` structure representing the account database user.
    - ``prepare``: A pointer to the `fd_funk_rec_prepare_t` structure containing the prepared record to be validated and published.
- **Logic and Control Flow**:
    - Generate a key from the account's public key using [`fd_funk_acc_key`](<fd_acc_mgr.h.md#fd_funk_rec_key_tfd_funk_acc_key>).
    - Check if the `prepare->rec` is not NULL, indicating a valid prepared record.
    - If the prepared record's `val_gaddr` is NULL, log a critical error indicating an unexpected NULL funk record value.
    - Compare the prepared record's key with the generated key; if they do not match, log a critical error indicating possible modification by another thread.
    - Publish the prepared record using `fd_funk_rec_publish`, which will crash the application if the key already exists in funk, indicating a conflicting write.
- **Output**: No return value; the function performs operations and logs errors if necessary.
- **Functions Called**:
    - [`fd_funk_rec_key_t::fd_funk_acc_key`](<fd_acc_mgr.h.md#fd_funk_rec_key_tfd_funk_acc_key>)


---
### fd\_txn\_account\_acquire\_write\_is\_safe<!-- {{#callable:fd_txn_account_acquire_write_is_safe}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L230>)

Checks if it is safe to acquire a write lock on a transaction account by verifying the exclusive reference count.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account to check.
- **Logic and Control Flow**:
    - Accesses the `refcnt_excl` field of the `acct` structure.
    - Returns the logical negation of the `refcnt_excl` field, indicating whether the account is not currently exclusively referenced.
- **Output**: Returns an integer value: `1` if the account is safe for write access (i.e., `refcnt_excl` is zero), otherwise `0`.


---
### fd\_txn\_account\_acquire\_write<!-- {{#callable:fd_txn_account_acquire_write}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L240>)

Acquires exclusive write access to a transaction account if it is safe to do so.
- **Inputs**:
    - ``acct``: A pointer to an `fd_txn_account_t` structure representing the transaction account to acquire write access for.
- **Logic and Control Flow**:
    - Check if acquiring write access is safe by calling [`fd_txn_account_acquire_write_is_safe`](<#fd_txn_account_acquire_write_is_safe>) with `acct` as the argument.
    - If acquiring write access is not safe, return 0 to indicate failure.
    - If acquiring write access is safe, set `acct->refcnt_excl` to 1 to indicate exclusive access.
    - Return 1 to indicate successful acquisition of write access.
- **Output**: Returns 1 if write access is successfully acquired, otherwise returns 0.
- **Functions Called**:
    - [`fd_txn_account_acquire_write_is_safe`](<#fd_txn_account_acquire_write_is_safe>)


---
### fd\_txn\_account\_release\_write<!-- {{#callable:fd_txn_account_release_write}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L252>)

Releases exclusive write access to a transaction account by setting its reference count to zero.
- **Inputs**:
    - ``acct``: A pointer to an `fd_txn_account_t` structure representing the transaction account to release.
- **Logic and Control Flow**:
    - Checks if the `refcnt_excl` field of the `acct` structure is not equal to 1, and logs a critical error if this condition is true.
    - Sets the `refcnt_excl` field of the `acct` structure to zero, indicating that the write access is released.
- **Output**: No return value.


---
### fd\_txn\_account\_release\_write\_private<!-- {{#callable:fd_txn_account_release_write_private}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L260>)

Releases a write lock on a transaction account if it is currently held.
- **Inputs**:
    - ``acct``: A pointer to an `fd_txn_account_t` structure representing the transaction account to release the write lock from.
- **Logic and Control Flow**:
    - Checks if the write lock on the account is currently held by calling [`fd_txn_account_acquire_write_is_safe`](<#fd_txn_account_acquire_write_is_safe>) with `acct` as the argument.
    - If the write lock is held (i.e., [`fd_txn_account_acquire_write_is_safe`](<#fd_txn_account_acquire_write_is_safe>) returns false), it calls [`fd_txn_account_release_write`](<#fd_txn_account_release_write>) to release the lock.
- **Output**: No return value.
- **Functions Called**:
    - [`fd_txn_account_acquire_write_is_safe`](<#fd_txn_account_acquire_write_is_safe>)
    - [`fd_txn_account_release_write`](<#fd_txn_account_release_write>)


---
### fd\_txn\_account\_get\_owner<!-- {{#callable:fd_txn_account_get_owner}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L268>)

Retrieves the owner of a transaction account.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account.
- **Logic and Control Flow**:
    - Check if the `meta` field of the `acct` is NULL using `FD_UNLIKELY`; if it is, log a critical error indicating the account is not set up.
    - Return the `owner` field from the `meta` structure of the `acct` as a constant pointer to `fd_pubkey_t`.
- **Output**: A constant pointer to `fd_pubkey_t` representing the owner of the account.


---
### fd\_txn\_account\_get\_meta<!-- {{#callable:fd_txn_account_get_meta}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L276>)

Retrieves the metadata associated with a given transaction account.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account from which to retrieve metadata.
- **Logic and Control Flow**:
    - Accesses the `meta` field of the `fd_txn_account_t` structure pointed to by `acct`.
    - Returns the value of the `meta` field.
- **Output**: A pointer to a constant `fd_account_meta_t` structure containing the metadata of the specified transaction account.


---
### fd\_txn\_account\_get\_data<!-- {{#callable:fd_txn_account_get_data}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L281>)

Retrieves the data pointer from a transaction account structure.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure from which to retrieve the data pointer.
- **Logic and Control Flow**:
    - Accesses the `data` member of the `fd_txn_account_t` structure pointed to by `acct`.
    - Returns the value of the `data` member.
- **Output**: A constant pointer to an unsigned character (`uchar const *`) representing the data associated with the transaction account.


---
### fd\_txn\_account\_get\_data\_mut<!-- {{#callable:fd_txn_account_get_data_mut}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L286>)

Returns a mutable pointer to the data field of a transaction account.
- **Inputs**:
    - `acct`: A constant pointer to an `fd_txn_account_t` structure representing the transaction account.
- **Logic and Control Flow**:
    - Accesses the `data` field of the `fd_txn_account_t` structure pointed to by `acct`.
    - Returns the `data` field as a mutable `uchar` pointer.
- **Output**: A mutable `uchar` pointer to the data field of the transaction account.


---
### fd\_txn\_account\_get\_data\_len<!-- {{#callable:fd_txn_account_get_data_len}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L291>)

Retrieves the data length from the account's metadata.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account.
- **Logic and Control Flow**:
    - Checks if the `meta` field of the `acct` is NULL using `FD_UNLIKELY`; if it is, logs a critical error message indicating the account is not set up.
    - Returns the data length (`dlen`) from the account's metadata.
- **Output**: Returns an unsigned long integer representing the data length of the account's metadata.


---
### fd\_txn\_account\_is\_executable<!-- {{#callable:fd_txn_account_is_executable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L299>)

Checks if a transaction account is executable by verifying its metadata.
- **Inputs**:
    - ``acct``: A pointer to a constant `fd_txn_account_t` structure representing the transaction account to check.
- **Logic and Control Flow**:
    - Checks if the `meta` field of the `acct` is NULL, and logs a critical error if it is.
    - Returns the boolean value of the `executable` field from the `meta` structure of the `acct`.
- **Output**: Returns an integer that is non-zero if the account is executable, and zero if it is not.


---
### fd\_txn\_account\_get\_lamports<!-- {{#callable:fd_txn_account_get_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L307>)

Retrieves the number of lamports from a transaction account's metadata.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account.
- **Logic and Control Flow**:
    - Checks if the `meta` field of the `acct` structure is NULL using `FD_UNLIKELY`; if it is NULL, logs a critical error message indicating the account is not set up.
    - Returns the `lamports` value from the `meta` field of the `acct` structure.
- **Output**: Returns the number of lamports as an unsigned long integer (`ulong`).


---
### fd\_txn\_account\_get\_rent\_epoch<!-- {{#callable:fd_txn_account_get_rent_epoch}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L315>)

Returns the maximum possible unsigned long value, `ULONG_MAX`, as the rent epoch for a transaction account.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure, which is not used in the function.
- **Logic and Control Flow**:
    - Ignore the input parameter `acct` by casting it to void.
    - Return the constant value `ULONG_MAX`.
- **Output**: The function returns `ULONG_MAX`, which is the maximum value for an unsigned long integer.


---
### fd\_txn\_account\_set\_meta<!-- {{#callable:fd_txn_account_set_meta}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L321>)

Sets the metadata of a transaction account if the account is mutable and the metadata is valid.
- **Inputs**:
    - `acct`: A pointer to an `fd_txn_account_t` structure representing the transaction account.
    - `meta`: A pointer to an `fd_account_meta_t` structure representing the metadata to set for the account.
- **Logic and Control Flow**:
    - Check if the account (`acct`) is mutable; if not, log a critical error and exit.
    - Check if the metadata (`meta`) is not NULL; if it is NULL, log a critical error and exit.
    - Assign the `meta` pointer to the `meta` field of the `acct` structure.
- **Output**: No return value; the function modifies the `acct` structure in place.


---
### fd\_txn\_account\_set\_executable<!-- {{#callable:fd_txn_account_set_executable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L332>)

Sets the executable status of a transaction account if it is mutable and properly initialized.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account.
    - ``is_executable``: An integer indicating whether the account should be executable (non-zero) or not (zero).
- **Logic and Control Flow**:
    - Checks if the account is mutable using `acct->is_mutable`; if not, logs a critical error and exits.
    - Checks if the account's metadata (`acct->meta`) is set up; if not, logs a critical error and exits.
    - Sets the `executable` field of the account's metadata to the boolean value of `is_executable`.
- **Output**: No return value; modifies the `executable` field of the account's metadata in place.


---
### fd\_txn\_account\_set\_owner<!-- {{#callable:fd_txn_account_set_owner}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L343>)

Sets the owner of a transaction account if the account is mutable and properly initialized.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account.
    - ``owner``: A constant pointer to the `fd_pubkey_t` structure representing the new owner of the account.
- **Logic and Control Flow**:
    - Checks if the account is mutable using `acct->is_mutable`; logs a critical error if not.
    - Checks if the account's metadata is set using `acct->meta`; logs a critical error if not.
    - Copies the new owner data from `owner` to `acct->meta->owner` using `fd_memcpy`.
- **Output**: No return value; modifies the `acct` structure in place.


---
### fd\_txn\_account\_set\_lamports<!-- {{#callable:fd_txn_account_set_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L354>)

Sets the number of lamports in a transaction account if the account is mutable and properly initialized.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account.
    - ``lamports``: The number of lamports to set in the account's metadata.
- **Logic and Control Flow**:
    - Checks if the account is mutable using `acct->is_mutable`; if not, logs a critical error and exits.
    - Checks if the account's metadata is initialized using `acct->meta`; if not, logs a critical error and exits.
    - Sets the `lamports` field in the account's metadata to the provided `lamports` value.
- **Output**: No return value; modifies the `lamports` field of the account's metadata in place.


---
### fd\_txn\_account\_checked\_add\_lamports<!-- {{#callable:fd_txn_account_checked_add_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L365>)

Adds a specified number of lamports to an account's balance, checking for arithmetic overflow.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the account to which lamports will be added.
    - ``lamports``: The number of lamports to add to the account's balance.
- **Logic and Control Flow**:
    - Initialize `balance_post` to 0.
    - Call [`fd_ulong_checked_add`](<program/fd_program_util.h.md#fd_ulong_checked_add>) with the current lamports of the account, the lamports to add, and a pointer to `balance_post` to check for overflow and calculate the new balance.
    - If [`fd_ulong_checked_add`](<program/fd_program_util.h.md#fd_ulong_checked_add>) returns an error, return `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW`.
    - If no error occurs, update the account's lamports with the new balance using [`fd_txn_account_set_lamports`](<#fd_txn_account_set_lamports>).
    - Return `FD_EXECUTOR_INSTR_SUCCESS` to indicate successful addition.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` on success or `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW` if an overflow occurs.
- **Functions Called**:
    - [`fd_ulong_checked_add`](<program/fd_program_util.h.md#fd_ulong_checked_add>)
    - [`fd_txn_account_get_lamports`](<#fd_txn_account_get_lamports>)
    - [`fd_txn_account_set_lamports`](<#fd_txn_account_set_lamports>)


---
### fd\_txn\_account\_checked\_sub\_lamports<!-- {{#callable:fd_txn_account_checked_sub_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L377>)

Subtracts a specified number of lamports from an account's balance, ensuring no arithmetic overflow occurs.
- **Inputs**:
    - `acct`: A pointer to the `fd_txn_account_t` structure representing the account from which lamports will be subtracted.
    - `lamports`: The number of lamports to subtract from the account's balance.
- **Logic and Control Flow**:
    - Initialize `balance_post` to 0.
    - Call [`fd_ulong_checked_sub`](<program/fd_program_util.h.md#fd_fn_unusedfd_ulong_checked_sub>) to subtract `lamports` from the account's current lamports, storing the result in `balance_post`.
    - Check if [`fd_ulong_checked_sub`](<program/fd_program_util.h.md#fd_fn_unusedfd_ulong_checked_sub>) returns an error indicating arithmetic overflow.
    - If an overflow error occurs, return `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW`.
    - If no error occurs, update the account's lamports with the new balance using [`fd_txn_account_set_lamports`](<#fd_txn_account_set_lamports>).
    - Return `FD_EXECUTOR_INSTR_SUCCESS` to indicate successful subtraction.
- **Output**: Returns an integer status code: `FD_EXECUTOR_INSTR_SUCCESS` on success or `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW` if an arithmetic overflow occurs.
- **Functions Called**:
    - [`FD_FN_UNUSED::fd_ulong_checked_sub`](<program/fd_program_util.h.md#fd_fn_unusedfd_ulong_checked_sub>)
    - [`fd_txn_account_get_lamports`](<#fd_txn_account_get_lamports>)
    - [`fd_txn_account_set_lamports`](<#fd_txn_account_set_lamports>)


---
### fd\_txn\_account\_set\_data<!-- {{#callable:fd_txn_account_set_data}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L391>)

Sets the data and data length for a transaction account if it is mutable and properly initialized.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account to modify.
    - ``data``: A pointer to the data to be copied into the account's data field.
    - ``data_sz``: The size of the data to be copied, in bytes.
- **Logic and Control Flow**:
    - Check if the account is mutable; if not, log a critical error and terminate.
    - Check if the account's metadata is initialized; if not, log a critical error and terminate.
    - Set the account's metadata data length (`dlen`) to the size of the new data (`data_sz`).
    - Copy the new data from the `data` pointer to the account's data field using `fd_memcpy`.
- **Output**: No return value; the function modifies the account's data and metadata in place.


---
### fd\_txn\_account\_set\_data\_len<!-- {{#callable:fd_txn_account_set_data_len}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L405>)

Sets the data length of a transaction account's metadata if the account is mutable and properly set up.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account.
    - ``data_len``: An unsigned long integer representing the new data length to set in the account's metadata.
- **Logic and Control Flow**:
    - Check if the account is mutable using `acct->is_mutable`; if not, log a critical error and exit.
    - Check if the account's metadata is set using `acct->meta`; if not, log a critical error and exit.
    - Set the data length in the account's metadata to the provided `data_len` value, casting it to an unsigned integer.
- **Output**: No return value; the function modifies the `dlen` field of the account's metadata in place.


---
### fd\_txn\_account\_set\_slot<!-- {{#callable:fd_txn_account_set_slot}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L416>)

Sets the `slot` field of the `meta` structure within a transaction account if the account is mutable and properly initialized.
- **Inputs**:
    - `acct`: A pointer to an `fd_txn_account_t` structure representing the transaction account.
    - `slot`: An unsigned long integer representing the slot value to set in the account's metadata.
- **Logic and Control Flow**:
    - Check if the account (`acct`) is mutable; if not, log a critical error and terminate.
    - Check if the account's metadata (`meta`) is set up; if not, log a critical error and terminate.
    - Set the `slot` field of the account's metadata to the provided `slot` value.
- **Output**: No return value; the function modifies the `slot` field of the account's metadata in place.


---
### fd\_txn\_account\_clear\_owner<!-- {{#callable:fd_txn_account_clear_owner}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L427>)

Clears the owner field of a transaction account's metadata if the account is mutable and properly set up.
- **Inputs**:
    - ``acct``: A pointer to an `fd_txn_account_t` structure representing the transaction account to modify.
- **Logic and Control Flow**:
    - Check if the account is mutable using `acct->is_mutable`; if not, log a critical error and exit.
    - Check if the account's metadata is set up using `acct->meta`; if not, log a critical error and exit.
    - Use `fd_memset` to set the `owner` field of the account's metadata to zero, effectively clearing it.
- **Output**: No return value; the function modifies the `owner` field of the account's metadata in place.


---
### fd\_txn\_account\_resize<!-- {{#callable:fd_txn_account_resize}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L438>)

Adjusts the size of the account's data buffer and updates its length metadata.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the account to resize.
    - ``dlen``: The new desired length for the account's data buffer.
- **Logic and Control Flow**:
    - Check if the account is mutable; if not, log a critical error and exit.
    - Check if the account's metadata is set up; if not, log a critical error and exit.
    - Calculate the size difference between the new and old data lengths.
    - Zero out the additional memory if the new size is larger than the old size.
    - Update the account's metadata to reflect the new data length.
- **Output**: No return value; the function modifies the account's data buffer and metadata in place.


---
### fd\_txn\_account\_is\_borrowed<!-- {{#callable:fd_txn_account_is_borrowed}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L458>)

Checks if a transaction account is currently borrowed by examining its exclusive reference count.
- **Inputs**:
    - ``acct``: A pointer to a constant `fd_txn_account_t` structure representing the transaction account to check.
- **Logic and Control Flow**:
    - Accesses the `refcnt_excl` field of the `acct` structure.
    - Returns a non-zero value if `refcnt_excl` is non-zero, indicating the account is borrowed.
    - Returns zero if `refcnt_excl` is zero, indicating the account is not borrowed.
- **Output**: Returns a `ushort` value: non-zero if the account is borrowed, zero if it is not.


---
### fd\_txn\_account\_is\_mutable<!-- {{#callable:fd_txn_account_is_mutable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L463>)

Checks if a transaction account is mutable by returning the value of the `is_mutable` field.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account to check.
- **Logic and Control Flow**:
    - Return the value of the `is_mutable` field from the `acct` structure.
- **Output**: An integer indicating if the transaction account is mutable (`1` if mutable, `0` if not).


---
### fd\_txn\_account\_is\_readonly<!-- {{#callable:fd_txn_account_is_readonly}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L469>)

Checks if a transaction account is read-only by verifying if the `is_mutable` field is false.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure representing the transaction account to check.
- **Logic and Control Flow**:
    - Accesses the `is_mutable` field of the `acct` structure.
    - Returns the negation of the `is_mutable` field, indicating if the account is read-only.
- **Output**: Returns an integer value: 1 if the account is read-only, 0 if it is not.


---
### fd\_txn\_account\_try\_borrow\_mut<!-- {{#callable:fd_txn_account_try_borrow_mut}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L475>)

Attempts to acquire write access to a transaction account.
- **Inputs**:
    - ``acct``: A pointer to an `fd_txn_account_t` structure representing the transaction account to attempt to borrow mutably.
- **Logic and Control Flow**:
    - Calls the [`fd_txn_account_acquire_write`](<#fd_txn_account_acquire_write>) function with the provided `acct` argument.
    - Returns the result of the [`fd_txn_account_acquire_write`](<#fd_txn_account_acquire_write>) function call.
- **Output**: An integer indicating success (1) or failure (0) of acquiring write access.
- **Functions Called**:
    - [`fd_txn_account_acquire_write`](<#fd_txn_account_acquire_write>)


---
### fd\_txn\_account\_drop<!-- {{#callable:fd_txn_account_drop}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L480>)

Releases the write/exclusive access handle of a transaction account.
- **Inputs**:
    - ``acct``: A pointer to the `fd_txn_account_t` structure representing the transaction account to release.
- **Logic and Control Flow**:
    - Calls [`fd_txn_account_release_write_private`](<#fd_txn_account_release_write_private>) with the provided `acct` to release the write/exclusive access.
- **Output**: No output is returned.
- **Functions Called**:
    - [`fd_txn_account_release_write_private`](<#fd_txn_account_release_write_private>)


---
### fd\_txn\_account\_set\_readonly<!-- {{#callable:fd_txn_account_set_readonly}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L485>)

Sets the `is_mutable` field of a transaction account to 0, making it read-only.
- **Inputs**:
    - `acct`: A pointer to an `fd_txn_account_t` structure representing the transaction account to modify.
- **Logic and Control Flow**:
    - Set the `is_mutable` field of the `acct` structure to 0.
- **Output**: No return value; the function modifies the `acct` structure in place.


---
### fd\_txn\_account\_set\_mutable<!-- {{#callable:fd_txn_account_set_mutable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L490>)

Sets the `is_mutable` field of a `fd_txn_account_t` structure to 1, indicating that the account is mutable.
- **Inputs**:
    - `acct`: A pointer to a `fd_txn_account_t` structure whose `is_mutable` field will be set to 1.
- **Logic and Control Flow**:
    - Access the `is_mutable` field of the `fd_txn_account_t` structure pointed to by `acct`.
    - Set the `is_mutable` field to 1.
- **Output**: No return value.


---
### fd\_txn\_account\_get\_solana\_meta<!-- {{#callable:fd_txn_account_get_solana_meta}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_txn_account.c#L495>)

Creates a `fd_solana_account_meta_t` structure from a `fd_txn_account_t` by copying specific metadata fields.
- **Inputs**:
    - `acct`: A pointer to a constant `fd_txn_account_t` structure from which metadata is extracted.
- **Logic and Control Flow**:
    - Initialize a `fd_solana_account_meta_t` structure named `meta` with `lamports` and `executable` fields copied from `acct->meta` and set `rent_epoch` to `ULONG_MAX`.
    - Copy the `owner` field from `acct->meta->owner` to `meta.owner` using `memcpy`.
    - Return the `meta` structure.
- **Output**: A `fd_solana_account_meta_t` structure containing the copied metadata.



---
Made with ❤️ by [Driver](https://www.driver.ai/)