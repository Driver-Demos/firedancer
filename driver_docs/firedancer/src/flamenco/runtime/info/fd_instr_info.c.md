<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for initializing, accumulating, and summing lamports in transaction instruction contexts.

# Purpose
The code provides functionality for managing and processing transaction instructions within a financial or blockchain context. It includes functions to accumulate starting lamports, initialize instruction information from a transaction instruction, and sum account lamports. The code interacts with transaction contexts and accounts, using data structures such as `fd_instr_info_t`, `fd_exec_txn_ctx_t`, and `fd_txn_instr_t`. The functions handle operations like checking for duplicate instructions, managing account indices, and performing arithmetic operations on lamport values, which are likely a unit of currency or value in this context.

The code is part of a larger system, as indicated by the inclusion of headers from different directories. It defines specific operations related to transaction instructions, suggesting it is a component of a transaction processing library. The functions use utility functions like `fd_uwide_inc` for wide integer arithmetic and check for conditions such as arithmetic overflow. The code does not define public APIs or external interfaces directly but provides internal functionality that can be used by other parts of the system to manage transaction instructions and their associated data.
# Imports and Dependencies

---
- `fd_instr_info.h`
- `../context/fd_exec_txn_ctx.h`
- `../../../util/bits/fd_uwide.h`


# Functions

---
### fd\_instr\_info\_accumulate\_starting\_lamports<!-- {{#callable:fd_instr_info_accumulate_starting_lamports}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.c#L5>)

Accumulates the starting lamports for a transaction account if it is not marked as a duplicate.
- **Inputs**:
    - ``instr``: A pointer to an `fd_instr_info_t` structure that holds instruction information, including starting lamports.
    - ``txn_ctx``: A constant pointer to an `fd_exec_txn_ctx_t` structure that contains the transaction context, including accounts.
    - ``idx_in_callee``: An unsigned short index indicating the position of the account in the callee's account list.
    - ``idx_in_txn``: An unsigned short index indicating the position of the account in the transaction's account list.
- **Logic and Control Flow**:
    - Checks if the account at `idx_in_callee` in `instr->is_duplicate` is not marked as a duplicate using `FD_LIKELY` macro.
    - If the account is not a duplicate, retrieves the account from `txn_ctx->accounts` using `idx_in_txn`.
    - Checks if the account has metadata using `fd_txn_account_get_meta`.
    - If the account has metadata, increments the starting lamports in `instr` using `fd_uwide_inc` with the lamports from the account.
- **Output**: No return value; the function modifies the `instr` structure in place.


---
### fd\_instr\_info\_init\_from\_txn\_instr<!-- {{#callable:fd_instr_info_init_from_txn_instr}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.c#L21>)

Initializes an `fd_instr_info_t` structure from a transaction instruction.
- **Inputs**:
    - `instr`: A pointer to an `fd_instr_info_t` structure to initialize.
    - `txn_ctx`: A pointer to an `fd_exec_txn_ctx_t` structure containing the transaction context.
    - `txn_instr`: A pointer to a constant `fd_txn_instr_t` structure representing the transaction instruction.
- **Logic and Control Flow**:
    - Retrieve the transaction descriptor from the transaction context using `TXN` macro.
    - Calculate the instruction account indices offset using `txn_instr->acct_off`.
    - Set `instr->program_id` to `txn_instr->program_id`.
    - Cap `instr->acct_cnt` to `FD_INSTR_ACCT_MAX` using `fd_ushort_min`.
    - Set `instr->data_sz` and `instr->data` using `txn_instr->data_sz` and `txn_instr->data_off`.
    - Initialize an array `acc_idx_seen` to track seen account indices.
    - Iterate over each account index up to `instr->acct_cnt`.
    - For each account index, call [`fd_instr_info_setup_instr_account`](<fd_instr_info.h.md#fd_instr_info_setup_instr_account>) to set up the instruction account with writable and signer status.
- **Output**: No return value; modifies the `instr` structure in place.
- **Functions Called**:
    - [`fd_instr_info_setup_instr_account`](<fd_instr_info.h.md#fd_instr_info_setup_instr_account>)


---
### fd\_instr\_info\_sum\_account\_lamports<!-- {{#callable:fd_instr_info_sum_account_lamports}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.c#L57>)

Calculates the sum of lamports from transaction accounts, handling potential arithmetic overflow.
- **Inputs**:
    - ``instr``: A pointer to a `fd_instr_info_t` structure that contains information about the instruction, including the accounts involved.
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure that provides the context of the transaction, including the accounts.
    - ``total_lamports_h``: A pointer to an `ulong` where the high part of the total lamports sum will be stored.
    - ``total_lamports_l``: A pointer to an `ulong` where the low part of the total lamports sum will be stored.
- **Logic and Control Flow**:
    - Initialize `total_lamports_h` and `total_lamports_l` to zero.
    - Iterate over each account in `instr->accounts` using a loop.
    - For each account, retrieve the index in the transaction and get the corresponding account from `txn_ctx->accounts`.
    - Check if the account metadata is valid and if the account is not marked as a duplicate; if not, skip to the next account.
    - Initialize temporary variables `tmp_total_lamports_h` and `tmp_total_lamports_l` to zero.
    - Use `fd_uwide_inc` to add the lamports of the current account to the total, storing the result in the temporary variables.
    - Check for arithmetic overflow by comparing `tmp_total_lamports_h` with `total_lamports_h`; if overflow occurs, return `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW`.
    - Update `total_lamports_h` and `total_lamports_l` with the values from the temporary variables after successful addition.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` if the sum is calculated without overflow, otherwise returns `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW` if an overflow is detected.



---
Made with ❤️ by [Driver](https://www.driver.ai/)