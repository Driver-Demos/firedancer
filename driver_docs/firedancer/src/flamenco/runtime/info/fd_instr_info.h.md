<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for managing instruction accounts and their properties in transactions.

# Purpose
The code is a C header file that defines structures and functions for managing instruction accounts within a transaction execution context. It is part of a larger system that handles transaction processing, likely in a blockchain or distributed ledger environment. The file includes definitions for `fd_instruction_account_t` and `fd_instr_info_t` structures, which store information about instruction accounts, such as their indices in various contexts, and flags indicating if they are writable or signers. The code also defines constants like `FD_INSTR_ACCT_MAX` to limit the number of instruction accounts to 256, which helps manage memory usage during transaction processing.

The file provides several inline functions and prototypes for operations on instruction accounts, such as initializing accounts, setting up instruction account information, and checking account properties like writability and signer status. Functions like [`fd_instr_info_accumulate_starting_lamports`](<#fd_instr_info_accumulate_starting_lamports>) and [`fd_instr_info_sum_account_lamports`](<#fd_instr_info_sum_account_lamports>) are used to manage and calculate lamport balances associated with instruction accounts. The header file is intended to be included in other C source files, providing a public API for managing instruction accounts in the context of transaction execution.
# Imports and Dependencies

---
- `../fd_txn_account.h`
- `../fd_executor_err.h`
- `../../../ballet/txn/fd_txn.h`


# Data Structures

---
### fd\_instruction\_account
- **Type**: ``struct``
- **Members**:
    - `index_in_transaction`: Stores the index of the account in the transaction.
    - `index_in_caller`: Stores the index of the account in the caller.
    - `index_in_callee`: Stores the index of the account in the callee.
    - `is_writable`: Indicates if the account is writable.
    - `is_signer`: Indicates if the account is a signer.
- **Description**: Defines an account used in instruction execution, with indices for transaction, caller, and callee, and flags for writability and signer status.


---
### fd\_instruction\_account\_t
- **Type**: ``struct``
- **Members**:
    - `index_in_transaction`: Stores the index of the account within the transaction.
    - `index_in_caller`: Stores the index of the account within the caller's context.
    - `index_in_callee`: Stores the index of the account within the callee's context.
    - `is_writable`: Indicates if the account is writable.
    - `is_signer`: Indicates if the account is a signer.
- **Description**: Represents an instruction account with indices for transaction, caller, and callee contexts, and flags for writability and signer status.


---
### fd\_instr\_info
- **Type**: ``struct``
- **Members**:
    - `program_id`: Stores the identifier of the program.
    - `data_sz`: Indicates the size of the data.
    - `acct_cnt`: Represents the count of accounts.
    - `data`: Points to the data associated with the instruction.
    - `accounts`: Holds an array of `fd_instruction_account_t` structures for each account.
    - `is_duplicate`: Tracks whether each account is a duplicate.
    - `starting_lamports_h`: Stores the high part of the starting lamports value.
    - `starting_lamports_l`: Stores the low part of the starting lamports value.
- **Description**: Represents information about an instruction, including program ID, data size, account count, and associated data. It also maintains an array of accounts and flags for duplicate accounts, as well as high and low parts of starting lamports values.


---
### fd\_instr\_info\_t
- **Type**: ``struct``
- **Members**:
    - `program_id`: Stores the identifier of the program associated with the instruction.
    - `data_sz`: Indicates the size of the data associated with the instruction.
    - `acct_cnt`: Represents the number of accounts involved in the instruction, capped at 256.
    - `data`: Points to the data buffer associated with the instruction.
    - `accounts`: Holds an array of `fd_instruction_account_t` structures, each representing an account involved in the instruction.
    - `is_duplicate`: Indicates whether each account in the instruction is a duplicate.
    - `starting_lamports_h`: Stores the high part of the starting lamports balance for the instruction.
    - `starting_lamports_l`: Stores the low part of the starting lamports balance for the instruction.
- **Description**: `fd_instr_info_t` is a structure that encapsulates information about an instruction in a transaction, including program ID, data size, account count, and a pointer to the instruction's data. It also contains an array of `fd_instruction_account_t` structures to represent the accounts involved, a duplicate flag array, and fields for tracking the starting lamports balance. The structure is designed to manage instruction execution within a transaction context, with a focus on memory efficiency by capping the account count at 256.


# Functions

---
### fd\_instruction\_account\_init<!-- {{#callable:fd_instruction_account_t::fd_instruction_account_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L54>)

Initializes an `fd_instruction_account_t` structure with specified indices and flags.
- **Inputs**:
    - `idx_in_txn`: The index of the account in the transaction.
    - `idx_in_caller`: The index of the account in the caller.
    - `idx_in_callee`: The index of the account in the callee.
    - `is_writable`: A flag indicating if the account is writable (non-zero if true).
    - `is_signer`: A flag indicating if the account is a signer (non-zero if true).
- **Logic and Control Flow**:
    - Creates a local variable `acc` of type `fd_instruction_account_t`.
    - Assigns the input parameters to the corresponding fields of `acc`.
    - Returns the initialized `acc` structure.
- **Output**: An `fd_instruction_account_t` structure initialized with the provided indices and flags.
- **See also**: [`fd_instruction_account_t`](<#fd_instruction_account_t>)  (Data Structure)


---
### fd\_instr\_info\_setup\_instr\_account<!-- {{#callable:fd_instr_info_setup_instr_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L72>)

Initializes an instruction account in the `fd_instr_info_t` structure and updates the duplicate account tracking.
- **Inputs**:
    - `instr`: A pointer to an `fd_instr_info_t` structure where the account information will be set.
    - `acc_idx_seen`: An array of `uchar` with a size of `FD_INSTR_ACCT_MAX` that tracks whether an account index has been seen.
    - `idx_in_txn`: A `ushort` representing the index of the account in the transaction.
    - `idx_in_caller`: A `ushort` representing the index of the account in the caller.
    - `idx_in_callee`: A `ushort` representing the index of the account in the callee.
    - `is_writable`: A `uchar` indicating if the account is writable.
    - `is_signer`: A `uchar` indicating if the account is a signer.
- **Logic and Control Flow**:
    - Checks if `idx_in_txn` is not equal to `USHORT_MAX` to determine if the account index is valid.
    - Sets the `is_duplicate` flag for the account at `idx_in_callee` in `instr` based on whether the account index `idx_in_txn` has been seen before.
    - If the account index `idx_in_txn` has not been seen, marks it as seen in the `acc_idx_seen` array.
    - Initializes the account at `idx_in_callee` in `instr->accounts` using [`fd_instruction_account_init`](<#fd_instruction_account_tfd_instruction_account_init>) with the provided indices and flags.
- **Output**: No return value; modifies the `instr` structure and `acc_idx_seen` array in place.
- **Functions Called**:
    - [`fd_instruction_account_t::fd_instruction_account_init`](<#fd_instruction_account_tfd_instruction_account_init>)


---
### fd\_instr\_acc\_is\_writable\_idx<!-- {{#callable:fd_instr_acc_is_writable_idx}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L113>)

Checks if a specified account index in an instruction is writable.
- **Inputs**:
    - `instr`: A pointer to a `fd_instr_info_t` structure that contains information about the instruction and its accounts.
    - `idx`: An unsigned short integer representing the index of the account to check within the instruction's accounts.
- **Logic and Control Flow**:
    - Check if `idx` is greater than or equal to `instr->acct_cnt`; if true, return 0.
    - Return the logical negation of the `is_writable` field of the account at the specified index.
- **Output**: Returns 1 if the account at the specified index is writable, otherwise returns 0.


---
### fd\_instr\_acc\_is\_signer\_idx<!-- {{#callable:fd_instr_acc_is_signer_idx}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L134>)

Checks if a specified account index in an instruction is a signer and optionally sets an error code if the index is invalid.
- **Inputs**:
    - `instr`: A pointer to a constant `fd_instr_info_t` structure that contains information about the instruction.
    - `idx`: An unsigned short integer representing the index of the account to check within the instruction.
    - `out_opt_err`: An optional pointer to an integer where an error code will be stored if the account index is invalid.
- **Logic and Control Flow**:
    - Check if `idx` is greater than or equal to `instr->acct_cnt` (the number of accounts in the instruction).
    - If `idx` is invalid, set `*out_opt_err` to `FD_EXECUTOR_INSTR_ERR_MISSING_ACC` if `out_opt_err` is not null, and return 0.
    - If `idx` is valid, set `*out_opt_err` to 0 if `out_opt_err` is not null.
    - Return the boolean value of `instr->accounts[idx].is_signer`, indicating if the account is a signer.
- **Output**: Returns 1 if the account at the specified index is a signer, 0 otherwise. If the index is invalid, returns 0 and sets an error code in `*out_opt_err` if provided.


---
### fd\_instr\_get\_acc\_flags<!-- {{#callable:fd_instr_get_acc_flags}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L158>)

Retrieves the access flags for a specified account in an instruction, indicating if it is a signer or writable.
- **Inputs**:
    - `instr`: A pointer to a `fd_instr_info_t` structure that contains information about the instruction and its accounts.
    - `idx`: An unsigned short integer representing the index of the account within the instruction's account list.
- **Logic and Control Flow**:
    - Check if `idx` is greater than or equal to `instr->acct_cnt`; if true, return 0.
    - Initialize `flags` to 0.
    - Check if the account at `instr->accounts[idx]` is a signer; if true, set the `FD_INSTR_ACCT_FLAGS_IS_SIGNER` bit in `flags`.
    - Check if the account at `instr->accounts[idx]` is writable; if true, set the `FD_INSTR_ACCT_FLAGS_IS_WRITABLE` bit in `flags`.
    - Return the `flags` value.
- **Output**: Returns an unsigned char representing the access flags of the specified account, with bits set for signer and writable status.


# Function Declarations (Public API)

---
### fd\_instr\_info\_accumulate\_starting\_lamports<!-- {{#callable_declaration:fd_instr_info_accumulate_starting_lamports}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L101>)

Accumulates starting lamports for a transaction instruction.
- **Description**: Use this function to update the starting lamports fields in an `fd_instr_info_t` object during transaction setup. It checks if the account at the specified index in the callee is not marked as a duplicate. If the account is valid and not a duplicate, it increments the starting lamports using the lamports from the transaction context. Ensure that the starting lamports fields in `fd_instr_info_t` are zeroed out before calling this function.
- **Inputs**:
    - `instr`: A pointer to an `fd_instr_info_t` structure where the starting lamports will be accumulated. Must not be null.
    - `txn_ctx`: A pointer to a constant `fd_exec_txn_ctx_t` structure containing transaction context information. Must not be null.
    - `idx_in_callee`: An unsigned short representing the index of the account in the callee. Must be within valid range for the `is_duplicate` array.
    - `idx_in_txn`: An unsigned short representing the index of the account in the transaction. Must be within valid range for the `accounts` array in `txn_ctx`.
- **Output**: None
- **See Also**: [`fd_instr_info_accumulate_starting_lamports`](<fd_instr_info.c.md#fd_instr_info_accumulate_starting_lamports>)  (Implementation)


---
### fd\_instr\_info\_init\_from\_txn\_instr<!-- {{#callable_declaration:fd_instr_info_init_from_txn_instr}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L107>)

Initializes an instruction information structure from a transaction instruction.
- **Description**: Use this function to populate an `fd_instr_info_t` structure with data from a given transaction instruction. This function sets up the program ID, account count, data size, and data pointer in the instruction information structure. It also initializes the accounts array with account indices and flags indicating if they are writable or signers. The account count is capped at 256 to manage memory usage efficiently. Ensure that the `txn_ctx` and `txn_instr` are valid and properly initialized before calling this function.
- **Inputs**:
    - `instr`: A pointer to an `fd_instr_info_t` structure that will be initialized. Must not be null.
    - `txn_ctx`: A pointer to an `fd_exec_txn_ctx_t` structure containing the transaction context. Must not be null.
    - `txn_instr`: A pointer to a constant `fd_txn_instr_t` structure representing the transaction instruction. Must not be null.
- **Output**: None
- **See Also**: [`fd_instr_info_init_from_txn_instr`](<fd_instr_info.c.md#fd_instr_info_init_from_txn_instr>)  (Implementation)


---
### fd\_instr\_info\_sum\_account\_lamports<!-- {{#callable_declaration:fd_instr_info_sum_account_lamports}} -->
[View Source →](<../../../../../../src/flamenco/runtime/info/fd_instr_info.h#L152>)

Calculate the sum of lamport balances for instruction accounts.
- **Description**: Use this function to compute the total lamport balances of all instruction accounts within a transaction context. It initializes the output parameters to zero and iterates over each account in the instruction. If an account is not a duplicate and has valid metadata, its lamport balance is added to the total. The function checks for arithmetic overflow during the summation process and returns an error code if overflow occurs. Ensure that the instruction and transaction context are properly initialized before calling this function.
- **Inputs**:
    - `instr`: A pointer to a `fd_instr_info_t` structure representing the instruction. Must not be null and should be properly initialized with account information.
    - `txn_ctx`: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context. Must not be null and should contain valid account data.
    - `total_lamports_h`: A pointer to an `ulong` where the high part of the total lamports will be stored. Must not be null. The function initializes this to zero.
    - `total_lamports_l`: A pointer to an `ulong` where the low part of the total lamports will be stored. Must not be null. The function initializes this to zero.
- **Output**: Returns an integer status code: `FD_EXECUTOR_INSTR_SUCCESS` on success, or `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW` if an arithmetic overflow occurs during the summation.
- **See Also**: [`fd_instr_info_sum_account_lamports`](<fd_instr_info.c.md#fd_instr_info_sum_account_lamports>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)