<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines the `fd_exec_instr_ctx_t` structure and related functions for managing instruction execution contexts.

# Purpose
The code defines a C header file that provides the structure and functions necessary for managing the execution context of a single instruction within a transaction. The primary structure, `fd_exec_instr_ctx_t`, contains pointers to instruction information, transaction context, and a system variable cache. It also includes a precomputed Base58 encoded program ID to optimize repeated logging operations. The header file includes several function prototypes that facilitate operations on the instruction context, such as checking the number of accounts, finding account indices, and borrowing accounts based on indices or public keys.

The functions in this header file mirror certain functionalities from the Agave project, specifically from the Solana SDK's transaction context. These functions include checking the number of instruction accounts, retrieving account indices, and managing program accounts. The header file also defines macros for alignment and footprint of the `fd_exec_instr_ctx_t` structure, as well as a macro for error checking when borrowing instruction accounts. The code is intended to be used as part of a larger system, likely involving transaction processing or blockchain operations, where it provides a focused set of utilities for handling instruction contexts.
# Imports and Dependencies

---
- `../info/fd_instr_info.h`
- `../fd_executor_err.h`
- `../sysvar/fd_sysvar_cache.h`
- `../../../ballet/txn/fd_txn.h`


# Data Structures

---
### fd\_borrowed\_account\_t
- **Type**: ``fd_borrowed_account_t``
- **Description**: `fd_borrowed_account_t` is a forward-declared type representing a borrowed account in the context of executing instructions. The actual structure definition is not provided in the given code, indicating that it is used as a placeholder or reference to an account that is managed elsewhere in the codebase.


---
### fd\_exec\_instr\_ctx
- **Type**: ``struct``
- **Members**:
    - ``instr``: A pointer to `fd_instr_info_t` that contains the instruction information.
    - ``txn_ctx``: A pointer to `fd_exec_txn_ctx_t` that holds the transaction context for the instruction.
    - ``sysvar_cache``: A pointer to `fd_sysvar_cache_t` that provides access to system variable cache.
    - ``program_id_base58``: A character array that stores the base58 encoded program ID.
- **Description**: Provides the context needed to execute a single instruction, including pointers to instruction information, transaction context, and system variable cache, as well as a precomputed base58 encoded program ID for efficiency.


# Functions

---
### fd\_exec\_instr\_ctx\_check\_num\_insn\_accounts<!-- {{#callable:fd_exec_instr_ctx_check_num_insn_accounts}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L36>)

Checks if the number of accounts provided to an instruction matches the expected number.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_exec_instr_ctx_t` structure that contains the context for the instruction, including the number of accounts.
    - ``expected_accounts``: An unsigned integer representing the expected number of accounts for the instruction.
- **Logic and Control Flow**:
    - Check if the actual number of accounts (`ctx->instr->acct_cnt`) is less than `expected_accounts` using the `FD_UNLIKELY` macro to optimize for the common case where the condition is false.
    - If the condition is true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - If the condition is false, return `FD_EXECUTOR_INSTR_SUCCESS`.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` if the number of accounts is as expected, otherwise returns `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.


---
### fd\_exec\_instr\_ctx\_get\_index\_of\_instr\_account\_in\_transaction<!-- {{#callable:fd_exec_instr_ctx_get_index_of_instr_account_in_transaction}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L73>)

Retrieves the index of an instruction account within a transaction, or returns an error if the index is invalid.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure, which contains the context needed to execute a single instruction.
    - `idx_in_instr`: An unsigned short representing the index of the account within the instruction.
    - `idx_in_txn`: A pointer to an unsigned short where the function will store the index of the account within the transaction.
- **Logic and Control Flow**:
    - Check if `idx_in_instr` is equal to `USHORT_MAX`; if true, set `*idx_in_txn` to `USHORT_MAX` and return `FD_EXECUTOR_INSTR_SUCCESS`.
    - Check if `idx_in_instr` is greater than or equal to `ctx->instr->acct_cnt`; if true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Set `*idx_in_txn` to the `index_in_transaction` of the account at `idx_in_instr` in `ctx->instr->accounts`.
    - Return `FD_EXECUTOR_INSTR_SUCCESS`.
- **Output**: Returns an integer status code: `FD_EXECUTOR_INSTR_SUCCESS` on success, or `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS` if the index is out of bounds.


---
### fd\_exec\_instr\_ctx\_get\_number\_of\_program\_accounts<!-- {{#callable:fd_exec_instr_ctx_get_number_of_program_accounts}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L98>)

Returns the constant number of program accounts, which is always 1.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure, representing the execution instruction context.
- **Logic and Control Flow**:
    - The function takes a single input parameter `ctx`, which is a pointer to a constant `fd_exec_instr_ctx_t` structure.
    - The function does not use the `ctx` parameter in its logic, as indicated by the `(void) ctx;` statement, which is used to suppress unused parameter warnings.
    - The function returns the constant value `1U`, indicating that there is always one program account.
- **Output**: An unsigned short integer (`ushort`) with a constant value of 1, representing the number of program accounts.


---
### fd\_signers\_contains<!-- {{#callable:fd_signers_contains}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L182>)

Checks if a given public key is present in a list of signer public keys.
- **Inputs**:
    - `signers`: An array of pointers to `fd_pubkey_t` objects, representing the list of signer public keys, with a maximum size defined by `FD_TXN_SIG_MAX`.
    - `pubkey`: A pointer to an `fd_pubkey_t` object, representing the public key to search for in the `signers` array.
- **Logic and Control Flow**:
    - Iterates over the `signers` array up to `FD_TXN_SIG_MAX` or until a null pointer is encountered.
    - For each non-null entry in the `signers` array, compares the entry with `pubkey` using `memcmp`.
    - If `memcmp` returns 0, indicating a match, the function returns 1.
    - If no match is found after checking all entries, the function returns 0.
- **Output**: Returns 1 if the `pubkey` is found in the `signers` array, otherwise returns 0.


# Function Declarations (Public API)

---
### fd\_exec\_instr\_ctx\_find\_idx\_of\_instr\_account<!-- {{#callable_declaration:fd_exec_instr_ctx_find_idx_of_instr_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L65>)

Finds the index of an instruction account by its public key.
- **Description**: Use this function to get the index of an instruction account within the context, given its public key. This is useful when you need to identify the position of an account in the instruction's account list. The function returns -1 if the account with the specified public key is not found. Ensure that the context and public key provided are valid and initialized before calling this function.
- **Inputs**:
    - `ctx`: A pointer to a `fd_exec_instr_ctx_t` structure representing the instruction context. Must not be null and should be properly initialized.
    - `pubkey`: A pointer to a `fd_pubkey_t` structure representing the public key of the account to find. Must not be null and should be properly initialized.
- **Output**: Returns the index of the instruction account if found, or -1 if the account is not found.
- **See Also**: [`fd_exec_instr_ctx_find_idx_of_instr_account`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_find_idx_of_instr_account>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_get\_key\_of\_account\_at\_index<!-- {{#callable_declaration:fd_exec_instr_ctx_get_key_of_account_at_index}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L105>)

Retrieves the public key of an account at a specified instruction index.
- **Description**: Use this function to obtain the public key of an account associated with a specific instruction index within an execution context. This function is useful when you need to access account information based on its position in the instruction context. Ensure that the `ctx` parameter is valid and that `idx_in_instr` is within the bounds of available instruction accounts. The function will return an error if the index is out of bounds or if any other issue occurs during retrieval.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the execution context. Must not be null.
    - `idx_in_instr`: An unsigned short representing the index of the account within the instruction context. Must be within the valid range of instruction accounts.
    - `key`: A pointer to a location where the function will store the address of the retrieved public key. Must not be null.
- **Output**: Returns an integer error code. A non-zero value indicates an error, such as an out-of-bounds index.
- **See Also**: [`fd_exec_instr_ctx_get_key_of_account_at_index`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_get_key_of_account_at_index>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_get\_last\_program\_key<!-- {{#callable_declaration:fd_exec_instr_ctx_get_last_program_key}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L118>)

Retrieves the public key of the last program in the instruction context.
- **Description**: Use this function to obtain the public key of the program associated with a given instruction context. This function is useful when you need to identify the program that an instruction is invoking. It is important to note that there is only one program per instruction, so this function will always retrieve the same program key. Ensure that the `ctx` parameter is valid and properly initialized before calling this function.
- **Inputs**:
    - `ctx`: A pointer to a `fd_exec_instr_ctx_t` structure. This must not be null and should be a valid instruction context that has been properly initialized.
    - `key`: A pointer to a location where the function will store the address of the program's public key. This must not be null, and the caller does not take ownership of the key.
- **Output**: Returns an integer status code. A return value of 0 indicates success, while a non-zero value indicates an error.
- **See Also**: [`fd_exec_instr_ctx_get_last_program_key`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_get_last_program_key>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_instr\_account<!-- {{#callable_declaration:fd_exec_instr_ctx_try_borrow_instr_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L128>)

Attempts to borrow an account from the instruction context.
- **Description**: Use this function to borrow an account from the instruction context by specifying the account's index. It is important to ensure that the index is within the valid range of accounts in the instruction context. If the index is out of bounds, the function will return an error code indicating insufficient account keys. This function is useful when you need to access account details for processing within a transaction context.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the instruction context. Must not be null.
    - `idx`: An unsigned short representing the index of the account within the instruction context. Must be within the valid range of accounts.
    - `account`: A pointer to an `fd_borrowed_account_t` structure where the borrowed account information will be stored. Must not be null.
- **Output**: Returns an integer error code. Returns 0 on success or an error code if the index is out of bounds or another error occurs.
- **See Also**: [`fd_exec_instr_ctx_try_borrow_instr_account`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_try_borrow_instr_account>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_instr\_account\_with\_key<!-- {{#callable_declaration:fd_exec_instr_ctx_try_borrow_instr_account_with_key}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L137>)

Borrows an account from the instruction context using a public key.
- **Description**: Use this function to borrow an account from the instruction context by specifying the account's public key. This function searches through the accounts in the instruction context to find a match with the given public key. If a matching account is found, it attempts to borrow the account and returns the result. If no matching account is found, it returns an error indicating that there are not enough account keys. Ensure that the context and public key provided are valid and that the account pointer is ready to receive the borrowed account information.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the instruction context. Must not be null.
    - `pubkey`: A pointer to a constant `fd_pubkey_t` structure representing the public key of the account to borrow. Must not be null.
    - `account`: A pointer to an `fd_borrowed_account_t` structure where the borrowed account information will be stored. Must not be null.
- **Output**: Returns an integer status code. Returns 0 on success, or an error code if the account is not found or another error occurs.
- **See Also**: [`fd_exec_instr_ctx_try_borrow_instr_account_with_key`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_try_borrow_instr_account_with_key>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_last\_program\_account<!-- {{#callable_declaration:fd_exec_instr_ctx_try_borrow_last_program_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L149>)

Borrows the instruction's program account.
- **Description**: Use this function to borrow the program account associated with a given instruction context. This function is applicable when there is only one program account per instruction, which is typical in many execution contexts. Ensure that the `ctx` parameter is a valid pointer to an `fd_exec_instr_ctx_t` structure and that `account` is a valid pointer to an `fd_borrowed_account_t` structure where the borrowed account information will be stored. This function does not handle multiple program accounts, as it assumes only one program account per instruction.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the instruction context. Must not be null.
    - `account`: A pointer to an `fd_borrowed_account_t` structure where the borrowed account information will be stored. Must not be null.
- **Output**: Returns an integer status code. A return value of 0 indicates success, while a non-zero value indicates an error.
- **See Also**: [`fd_exec_instr_ctx_try_borrow_last_program_account`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_try_borrow_last_program_account>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_get\_signers<!-- {{#callable_declaration:fd_exec_instr_ctx_get_signers}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L157>)

Retrieves the public keys of signer accounts from the instruction context.
- **Description**: Use this function to obtain the public keys of all signer accounts associated with a given instruction context. It populates the provided array with up to `FD_TXN_SIG_MAX` signer public keys. Ensure that the `ctx` parameter is valid and points to a properly initialized instruction context. The `signers` array must have space for at least `FD_TXN_SIG_MAX` entries. The function returns an error code if it encounters an issue while retrieving a signer's public key.
- **Inputs**:
    - `ctx`: A pointer to a `fd_exec_instr_ctx_t` structure representing the instruction context. Must not be null and must point to a valid instruction context.
    - `signers`: An array of pointers to `fd_pubkey_t` where the function will store the public keys of the signer accounts. The array must have space for at least `FD_TXN_SIG_MAX` entries. The caller retains ownership of the array.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` on success. If an error occurs while retrieving a signer's public key, an error code is returned.
- **See Also**: [`fd_exec_instr_ctx_get_signers`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_get_signers>)  (Implementation)


---
### fd\_exec\_instr\_ctx\_any\_signed<!-- {{#callable_declaration:fd_exec_instr_ctx_any_signed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.h#L173>)

Checks if any instruction account with a given public key is a signer.
- **Description**: Use this function to determine if any account associated with a specific public key in the instruction context is marked as a signer. This is useful when you need to verify the signing status of accounts within a transaction. The function returns a non-zero value if at least one account with the specified public key is a signer, and zero otherwise. Ensure that the `ctx` and `pubkey` parameters are valid and not null before calling this function.
- **Inputs**:
    - `ctx`: A pointer to a `fd_exec_instr_ctx_t` structure that contains the context of the instruction. Must not be null.
    - `pubkey`: A pointer to a `fd_pubkey_t` structure representing the public key to check against the instruction accounts. Must not be null.
- **Output**: Returns 1 if any account with the given public key is a signer, and 0 otherwise.
- **See Also**: [`fd_exec_instr_ctx_any_signed`](<fd_exec_instr_ctx.c.md#fd_exec_instr_ctx_any_signed>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)