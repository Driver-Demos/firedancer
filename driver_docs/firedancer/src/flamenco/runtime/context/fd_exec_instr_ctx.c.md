<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for managing and accessing instruction and transaction contexts in a runtime environment.

# Purpose
The code provides a set of functions for managing and interacting with instruction contexts within a transaction execution framework. It is part of a C library that deals with transaction and instruction contexts, as indicated by the inclusion of headers such as `fd_exec_instr_ctx.h` and `fd_exec_txn_ctx.h`. The primary purpose of these functions is to facilitate operations on accounts within an instruction context, such as finding account indices, retrieving keys, borrowing accounts, and checking signer status.

Key functions include [`fd_exec_instr_ctx_find_idx_of_instr_account`](<#fd_exec_instr_ctx_find_idx_of_instr_account>), which locates the index of an account within an instruction context, and [`fd_exec_instr_ctx_get_key_of_account_at_index`](<#fd_exec_instr_ctx_get_key_of_account_at_index>), which retrieves the public key of an account at a specified index. The code also includes functions for borrowing accounts, such as [`fd_exec_instr_ctx_try_borrow_account`](<#fd_exec_instr_ctx_try_borrow_account>) and [`fd_exec_instr_ctx_try_borrow_instr_account`](<#fd_exec_instr_ctx_try_borrow_instr_account>), which handle account borrowing operations and error handling. Additionally, the code provides functionality to retrieve signers and check if any account is signed using [`fd_exec_instr_ctx_get_signers`](<#fd_exec_instr_ctx_get_signers>) and [`fd_exec_instr_ctx_any_signed`](<#fd_exec_instr_ctx_any_signed>), respectively. These functions are integral to managing the execution of instructions within a transaction, ensuring that accounts are correctly accessed and manipulated according to the transaction's requirements.
# Imports and Dependencies

---
- `fd_exec_instr_ctx.h`
- `fd_exec_txn_ctx.h`
- `../fd_borrowed_account.h`


# Functions

---
### fd\_exec\_instr\_ctx\_find\_idx\_of\_instr\_account<!-- {{#callable:fd_exec_instr_ctx_find_idx_of_instr_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L5>)

Finds the index of an instruction account that matches a given public key within a transaction context.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure, which contains the instruction and transaction context.
    - `pubkey`: A pointer to a constant `fd_pubkey_t` structure, which represents the public key to search for.
- **Logic and Control Flow**:
    - Iterate over each account in the instruction context using a for loop, with the loop variable `i` ranging from 0 to `ctx->instr->acct_cnt`.
    - For each account, retrieve the `index_in_transaction` from `ctx->instr->accounts[i]`.
    - Compare the public key `pubkey->uc` with the account key in the transaction context at the retrieved index using `memcmp`.
    - If the keys match, return the current index `i`.
    - If no match is found after the loop, return -1.
- **Output**: Returns the index of the matching instruction account if found, otherwise returns -1.


---
### fd\_exec\_instr\_ctx\_get\_key\_of\_account\_at\_index<!-- {{#callable:fd_exec_instr_ctx_get_key_of_account_at_index}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L17>)

Retrieves the public key of an account at a specified index within an instruction context.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the instruction context.
    - `idx_in_instr`: An unsigned short integer representing the index of the account within the instruction.
    - `key`: A pointer to a pointer to a constant `fd_pubkey_t` where the function will store the address of the account's public key.
- **Logic and Control Flow**:
    - Calls [`fd_exec_instr_ctx_get_index_of_instr_account_in_transaction`](<fd_exec_instr_ctx.h.md#fd_exec_instr_ctx_get_index_of_instr_account_in_transaction>) to get the index of the account in the transaction context, storing the result in `idx_in_txn`.
    - Checks if the call to [`fd_exec_instr_ctx_get_index_of_instr_account_in_transaction`](<fd_exec_instr_ctx.h.md#fd_exec_instr_ctx_get_index_of_instr_account_in_transaction>) returned an error; if so, returns the error code.
    - Calls [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>) with the transaction context, `idx_in_txn`, and `key` to retrieve the public key of the account.
- **Output**: Returns an integer error code; 0 on success, or a non-zero error code if an error occurs.
- **Functions Called**:
    - [`fd_exec_instr_ctx_get_index_of_instr_account_in_transaction`](<fd_exec_instr_ctx.h.md#fd_exec_instr_ctx_get_index_of_instr_account_in_transaction>)
    - [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>)


---
### fd\_exec\_instr\_ctx\_get\_last\_program\_key<!-- {{#callable:fd_exec_instr_ctx_get_last_program_key}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L34>)

Retrieves the public key of the last program in the instruction context.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure, which contains the instruction and transaction context.
    - `key`: A pointer to a pointer to `fd_pubkey_t`, where the function will store the address of the retrieved public key.
- **Logic and Control Flow**:
    - Calls [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>) with the transaction context from `ctx`, the program ID from `ctx->instr`, and the `key` pointer.
    - Returns the result of the [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>) function call.
- **Output**: Returns an integer status code from the [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>) function, indicating success or an error.
- **Functions Called**:
    - [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_account<!-- {{#callable:fd_exec_instr_ctx_try_borrow_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L42>)

Attempts to borrow an account from a transaction context and initialize a borrowed account structure.
- **Inputs**:
    - ``ctx``: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the execution instruction context.
    - ``idx_in_instr``: An unsigned short integer representing the index of the account in the instruction.
    - ``idx_in_txn``: An unsigned short integer representing the index of the account in the transaction.
    - ``account``: A pointer to an `fd_borrowed_account_t` structure where the borrowed account will be initialized.
- **Logic and Control Flow**:
    - Retrieve the account from the transaction context using `idx_in_txn` by calling [`fd_exec_txn_ctx_get_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>).
    - If the account retrieval fails, log a `MissingAccount` error and return `FD_EXECUTOR_INSTR_ERR_MISSING_ACC`.
    - Attempt to borrow the account for writing using `fd_txn_account_try_borrow_mut`.
    - If borrowing fails, return `FD_EXECUTOR_INSTR_ERR_ACC_BORROW_FAILED`.
    - If successful, initialize the `account` using `fd_borrowed_account_init` with the retrieved transaction account, context, and `idx_in_instr`.
    - Return `FD_EXECUTOR_INSTR_SUCCESS` to indicate success.
- **Output**: Returns an integer status code indicating success or specific error conditions.
- **Functions Called**:
    - [`fd_exec_txn_ctx_get_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_instr\_account<!-- {{#callable:fd_exec_instr_ctx_try_borrow_instr_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L77>)

Attempts to borrow an account from the transaction context using the instruction context and account index.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, representing the instruction context.
    - `idx`: An unsigned short integer representing the index of the account in the instruction context.
    - `account`: A pointer to the `fd_borrowed_account_t` structure where the borrowed account information will be stored.
- **Logic and Control Flow**:
    - Call [`fd_exec_instr_ctx_get_index_of_instr_account_in_transaction`](<fd_exec_instr_ctx.h.md#fd_exec_instr_ctx_get_index_of_instr_account_in_transaction>) to find the index of the account in the transaction context using the provided instruction context and account index.
    - Check if the call returns an error; if so, return the error code.
    - Call [`fd_exec_instr_ctx_try_borrow_account`](<#fd_exec_instr_ctx_try_borrow_account>) with the instruction context, account index, transaction index, and account pointer to attempt borrowing the account.
    - Return the result of the [`fd_exec_instr_ctx_try_borrow_account`](<#fd_exec_instr_ctx_try_borrow_account>) call.
- **Output**: Returns an integer error code, where a non-zero value indicates an error occurred during the borrowing process.
- **Functions Called**:
    - [`fd_exec_instr_ctx_get_index_of_instr_account_in_transaction`](<fd_exec_instr_ctx.h.md#fd_exec_instr_ctx_get_index_of_instr_account_in_transaction>)
    - [`fd_exec_instr_ctx_try_borrow_account`](<#fd_exec_instr_ctx_try_borrow_account>)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_instr\_account\_with\_key<!-- {{#callable:fd_exec_instr_ctx_try_borrow_instr_account_with_key}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L97>)

Attempts to borrow an instruction account using a public key from the execution instruction context.
- **Inputs**:
    - `ctx`: A pointer to the `fd_exec_instr_ctx_t` structure, which contains the execution instruction context.
    - `pubkey`: A pointer to the `fd_pubkey_t` structure, which contains the public key to match against the account keys in the transaction context.
    - `account`: A pointer to the `fd_borrowed_account_t` structure, where the borrowed account information will be stored if the borrowing is successful.
- **Logic and Control Flow**:
    - Iterates over the accounts in the instruction context using a loop with index `i`.
    - For each account, retrieves the index of the account in the transaction context (`idx_in_txn`).
    - Compares the public key (`pubkey->uc`) with the account key at the transaction index (`ctx->txn_ctx->account_keys[idx_in_txn].uc`).
    - If a match is found, calls [`fd_exec_instr_ctx_try_borrow_instr_account`](<#fd_exec_instr_ctx_try_borrow_instr_account>) with the current index `i` and the `account` pointer, and returns its result.
    - If no match is found after iterating through all accounts, returns `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
- **Output**: Returns an integer status code: the result of [`fd_exec_instr_ctx_try_borrow_instr_account`](<#fd_exec_instr_ctx_try_borrow_instr_account>) if a matching account is found, or `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS` if no matching account is found.
- **Functions Called**:
    - [`fd_exec_instr_ctx_try_borrow_instr_account`](<#fd_exec_instr_ctx_try_borrow_instr_account>)


---
### fd\_exec\_instr\_ctx\_try\_borrow\_last\_program\_account<!-- {{#callable:fd_exec_instr_ctx_try_borrow_last_program_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L114>)

Attempts to borrow the last program account from the instruction context using a sentinel value for the index.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the execution instruction context.
    - `account`: A pointer to an `fd_borrowed_account_t` structure where the borrowed account information will be stored.
- **Logic and Control Flow**:
    - Calls [`fd_exec_instr_ctx_try_borrow_account`](<#fd_exec_instr_ctx_try_borrow_account>) with `ctx`, `USHORT_MAX` as the index in instruction, `ctx->instr->program_id` as the index in transaction, and `account`.
- **Output**: Returns an integer status code indicating success or the type of error encountered during the borrowing process.
- **Functions Called**:
    - [`fd_exec_instr_ctx_try_borrow_account`](<#fd_exec_instr_ctx_try_borrow_account>)


---
### fd\_exec\_instr\_ctx\_get\_signers<!-- {{#callable:fd_exec_instr_ctx_get_signers}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L125>)

Retrieves the public keys of all signer accounts from the instruction context and stores them in the provided array.
- **Inputs**:
    - ``ctx``: A pointer to a constant `fd_exec_instr_ctx_t` structure that contains the instruction context.
    - ``signers``: An array of pointers to `fd_pubkey_t` where the function will store the public keys of the signer accounts.
- **Logic and Control Flow**:
    - Initialize `j` to 0 to track the number of signers found.
    - Iterate over each account in the instruction context using a loop with index `i`.
    - Check if the account at index `i` is a signer using `fd_instr_acc_is_signer_idx`.
    - If the account is a signer, retrieve its index in the transaction using `ctx->instr->accounts[i].index_in_transaction`.
    - Call [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>) to get the public key of the account and store it in `signers[j]`.
    - Increment `j` to move to the next position in the `signers` array.
    - If an error occurs during key retrieval, return the error code immediately.
    - Continue until all accounts are checked or the maximum number of signers (`FD_TXN_SIG_MAX`) is reached.
    - Return `FD_EXECUTOR_INSTR_SUCCESS` if all signer keys are successfully retrieved.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` on success or an error code if a failure occurs during key retrieval.
- **Functions Called**:
    - [`fd_exec_txn_ctx_get_key_of_account_at_index`](<fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>)


---
### fd\_exec\_instr\_ctx\_any\_signed<!-- {{#callable:fd_exec_instr_ctx_any_signed}} -->
[View Source →](<../../../../../../src/flamenco/runtime/context/fd_exec_instr_ctx.c#L142>)

Checks if a given public key is a signer for any account in the instruction context.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure representing the instruction context.
    - `pubkey`: A pointer to a constant `fd_pubkey_t` structure representing the public key to check.
- **Logic and Control Flow**:
    - Initialize `is_signer` to 0 to track if the public key is a signer.
    - Iterate over each account in the instruction context using a loop with index `j`.
    - For each account, retrieve the `index_in_transaction` from `ctx->instr->accounts[j]`.
    - Check if the account at index `j` is a signer using `fd_instr_acc_is_signer_idx`.
    - Compare the public key with the account key at `index_in_transaction` using `memcmp`.
    - Use bitwise OR to update `is_signer` if both the account is a signer and the keys match.
- **Output**: Returns an integer `is_signer`, which is non-zero if the public key is a signer for any account, otherwise zero.



---
Made with ❤️ by [Driver](https://www.driver.ai/)