<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for managing RocksDB databases, including initialization, iteration, and data manipulation.

# Purpose
The code is a C header file that defines structures and functions for interacting with a RocksDB database in the context of a blockchain application, specifically related to the Solana blockchain. It includes definitions for managing blocks and shreds, which are components of the blockchain's data structure. The `fd_block` structure is used for offline replay in a blockstore, allowing iteration over various components such as shreds, microblocks, and transactions. This structure is crucial for handling the data organization and access patterns required for blockchain operations.

The file also defines the `fd_rocksdb` structure, which encapsulates a RocksDB database instance, including its configuration and column family handles. It provides a set of functions for initializing, creating, and destroying a RocksDB instance, as well as for performing operations such as inserting entries and copying data between databases. The file includes functionality for iterating over database entries using the `fd_rocksdb_root_iter` structure, which is designed to navigate the database's root column. The header file is intended to be included in other C source files that require access to these database operations, and it defines a public API for managing and interacting with RocksDB in the context of the Solana blockchain.
# Imports and Dependencies

---
- `../../ballet/block/fd_microblock.h`
- `../types/fd_types.h`
- `../../ballet/shred/fd_shred.h`
- `rocksdb/c.h`


# Data Structures

---
### fd\_block
- **Type**: ``struct``
- **Members**:
    - `data_gaddr`: Pointer to the beginning of the block's allocated data region.
    - `data_sz`: Size of the block.
    - `shreds_gaddr`: Pointer to the first `fd_block_shred_t`.
    - `shreds_cnt`: Count of shreds.
    - `batch_gaddr`: Pointer to the list of `fd_block_entry_batch_t`.
    - `batch_cnt`: Count of entry batches.
    - `micros_gaddr`: Pointer to the list of `fd_block_micro_t`.
    - `micros_cnt`: Count of microblocks.
- **Description**: Used for offline operations, `fd_block` is stored in blockstore memory to iterate over a block's contents. It indexes a block's data region to support iteration by shred, microblock/entry batch, microblock/entry, or transaction. Iteration is done by processing headers stored in allocated memory, and random access of individual shred indices is inefficient due to the variable-length nature of shreds.


---
### fd\_block\_t
- **Type**: ``struct``
- **Members**:
    - `data_gaddr`: Pointer to the beginning of the block's allocated data region.
    - `data_sz`: Size of the block.
    - `shreds_gaddr`: Pointer to the first `fd_block_shred_t`.
    - `shreds_cnt`: Count of shreds.
    - `batch_gaddr`: List of `fd_block_entry_batch_t`.
    - `batch_cnt`: Count of entry batches.
    - `micros_gaddr`: Pointer to the list of `fd_block_micro_t`.
    - `micros_cnt`: Count of microblocks.
- **Description**: Used for offline-replay in the blockstore, `fd_block_t` is a data structure that stores information about a block's data region, including pointers and counts for shreds, entry batches, and microblocks. It supports iteration over the block's contents by indexing the data region, allowing iteration by shred, microblock/entry batch, microblock/entry, or transaction. The structure is designed for use in offline scenarios and is stored in blockstore memory.


---
### fd\_rocksdb
- **Type**: ``struct``
- **Members**:
    - `db`: Pointer to a `rocksdb_t` instance representing the database.
    - `db_name`: Pointer to a constant character string representing the database name.
    - `cfgs`: Array of constant character strings for configuration settings, with a size defined by `FD_ROCKSDB_CF_CNT`.
    - `cf_handles`: Array of pointers to `rocksdb_column_family_handle_t`, each representing a column family handle, with a size defined by `FD_ROCKSDB_CF_CNT`.
    - `opts`: Pointer to a `rocksdb_options_t` structure for database options.
    - `ro`: Pointer to a `rocksdb_readoptions_t` structure for read options.
    - `wo`: Pointer to a `rocksdb_writeoptions_t` structure for write options.
- **Description**: Manages a RocksDB database instance, including its name, configuration settings, column family handles, and options for reading and writing operations. The structure facilitates interaction with the database by encapsulating necessary components and settings.


---
### fd\_rocksdb\_t
- **Type**: ``struct``
- **Members**:
    - `db`: Pointer to a `rocksdb_t` database instance.
    - `db_name`: Pointer to a string representing the database name.
    - `cfgs`: Array of pointers to configuration strings for column families.
    - `cf_handles`: Array of pointers to `rocksdb_column_family_handle_t` for column families.
    - `opts`: Pointer to `rocksdb_options_t` for database options.
    - `ro`: Pointer to `rocksdb_readoptions_t` for read options.
    - `wo`: Pointer to `rocksdb_writeoptions_t` for write options.
- **Description**: Manages a RocksDB database instance, including its configuration, column family handles, and read/write options. It provides the necessary structure to interact with a RocksDB database, allowing for operations such as initialization, creation, destruction, and data manipulation within the database.


---
### fd\_rocksdb\_root\_iter
- **Type**: ``struct``
- **Members**:
    - `db`: Pointer to a `fd_rocksdb_t` structure representing the RocksDB database.
    - `iter`: Pointer to a `rocksdb_iterator_t` used for iterating over the database.
- **Description**: Facilitates iteration over the root column of a RocksDB database by maintaining a reference to the database and an iterator for traversing its entries.


---
### fd\_rocksdb\_root\_iter\_t
- **Type**: ``struct``
- **Members**:
    - `db`: Pointer to an `fd_rocksdb_t` structure representing the RocksDB database.
    - `iter`: Pointer to a `rocksdb_iterator_t` used for iterating over the database.
- **Description**: Facilitates iteration over the root column of a RocksDB database by maintaining a reference to the database and an iterator.


# Function Declarations (Public API)

---
### fd\_rocksdb\_root\_iter\_new<!-- {{#callable_declaration:fd_rocksdb_root_iter_new}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L85>)

Initializes a RocksDB root iterator structure.
- **Description**: Use this function to initialize a RocksDB root iterator structure at the specified memory location. This function sets the memory to zero, preparing it for use as a `fd_rocksdb_root_iter_t` structure. Ensure that the memory pointed to by the parameter is large enough to hold the structure and is properly aligned. This function does not allocate memory; it only initializes the provided memory block.
- **Inputs**:
    - `ptr`: A pointer to a memory block where the iterator structure will be initialized. The memory must be large enough to hold a `fd_rocksdb_root_iter_t` structure and must be properly aligned. The caller retains ownership of the memory. Passing a null pointer or an improperly sized or aligned memory block results in undefined behavior.
- **Output**: Returns the same pointer passed as input, now initialized as a `fd_rocksdb_root_iter_t` structure.
- **See Also**: [`fd_rocksdb_root_iter_new`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_new>)  (Implementation)


---
### fd\_rocksdb\_root\_iter\_join<!-- {{#callable_declaration:fd_rocksdb_root_iter_join}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L90>)

Casts a pointer to a `fd_rocksdb_root_iter_t` type.
- **Description**: Use this function to convert a generic pointer to a `fd_rocksdb_root_iter_t` pointer. This is typically used when you have a pointer that you know points to a `fd_rocksdb_root_iter_t` structure and you need to work with it as such. Ensure that the pointer passed is valid and points to a `fd_rocksdb_root_iter_t` structure to avoid undefined behavior.
- **Inputs**:
    - `ptr`: A pointer to be cast to `fd_rocksdb_root_iter_t`. Must be a valid pointer to a `fd_rocksdb_root_iter_t` structure. Passing an invalid pointer results in undefined behavior.
- **Output**: Returns a pointer of type `fd_rocksdb_root_iter_t *` that is equivalent to the input pointer.
- **See Also**: [`fd_rocksdb_root_iter_join`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_join>)  (Implementation)


---
### fd\_rocksdb\_root\_iter\_leave<!-- {{#callable_declaration:fd_rocksdb_root_iter_leave}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L93>)

Returns a pointer to the iterator structure.
- **Description**: Use this function to obtain a pointer to the `fd_rocksdb_root_iter_t` structure when you want to leave the iterator context. This function is typically called after you have finished using the iterator and want to perform cleanup or transition to another state. Ensure that the `ptr` parameter is a valid pointer to an `fd_rocksdb_root_iter_t` structure before calling this function.
- **Inputs**:
    - `ptr`: A pointer to an `fd_rocksdb_root_iter_t` structure. Must not be null. The function returns this pointer directly.
- **Output**: Returns the same pointer that was passed in as the `ptr` parameter.
- **See Also**: [`fd_rocksdb_root_iter_leave`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_leave>)  (Implementation)


---
### fd\_rocksdb\_root\_iter\_seek<!-- {{#callable_declaration:fd_rocksdb_root_iter_seek}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L96>)

Seeks to a specific slot in the RocksDB root column family iterator.
- **Description**: Use this function to position the iterator at a specific slot within the RocksDB root column family. This function is useful when you need to access metadata associated with a particular slot. Ensure that the iterator is properly initialized before calling this function. If the specified slot is not found, the function returns `NULL`. This function does not modify the database or the iterator state beyond seeking to the specified slot.
- **Inputs**:
    - `self`: A pointer to an `fd_rocksdb_root_iter_t` structure. This must not be null and should be a valid iterator object.
    - `db`: A pointer to an `fd_rocksdb_t` structure representing the database. This must not be null and should be a valid database object.
    - `slot`: An unsigned long integer representing the slot to seek to. There are no specific constraints on the value, but it should correspond to a valid slot in the database.
- **Output**: Returns a pointer to an `fd_slot_meta_t` structure if the slot is found, or `NULL` if the slot is not found or an error occurs.
- **See Also**: [`fd_rocksdb_root_iter_seek`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_seek>)  (Implementation)


---
### fd\_rocksdb\_root\_iter\_next<!-- {{#callable_declaration:fd_rocksdb_root_iter_next}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L101>)

Advances the iterator to the next valid entry and retrieves its metadata.
- **Description**: Use this function to move the iterator to the next valid entry in the RocksDB root column and obtain the associated metadata. This function must be called on a valid `fd_rocksdb_root_iter_t` object that has been properly initialized and joined. If the iterator or the database is not valid, or if there are no more valid entries, the function returns `NULL`. Ensure that the iterator is valid before calling this function to avoid unexpected results.
- **Inputs**:
    - `self`: A pointer to an `fd_rocksdb_root_iter_t` object. This must not be `NULL` and must point to a valid iterator that has been initialized and joined. The function will return `NULL` if the iterator or the associated database is invalid.
- **Output**: Returns a pointer to an `fd_slot_meta_t` structure containing the metadata of the next valid entry, or `NULL` if there are no more valid entries or if the iterator is invalid.
- **See Also**: [`fd_rocksdb_root_iter_next`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_next>)  (Implementation)


---
### fd\_rocksdb\_root\_iter\_slot<!-- {{#callable_declaration:fd_rocksdb_root_iter_slot}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L104>)

Retrieves the slot number from the current iterator position.
- **Description**: Use this function to obtain the slot number from the current position of a RocksDB root iterator. It is important to ensure that the iterator is valid and associated with a database before calling this function. If the iterator is not valid or not associated with a database, the function will return an error code. This function is typically used in scenarios where you need to process or analyze data associated with specific slots in a RocksDB database.
- **Inputs**:
    - `self`: A pointer to an `fd_rocksdb_root_iter_t` structure. This must not be null and must be properly initialized with a valid database and iterator. If `self->db` or `self->iter` is null, the function returns -1.
    - `slot`: A pointer to an `ulong` where the function will store the slot number. This must not be null. The function writes the slot number to this location if successful.
- **Output**: Returns 0 on success, -1 if the iterator or database is not initialized, and -2 if the iterator is not valid.
- **See Also**: [`fd_rocksdb_root_iter_slot`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_slot>)  (Implementation)


---
### fd\_rocksdb\_root\_iter\_destroy<!-- {{#callable_declaration:fd_rocksdb_root_iter_destroy}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L108>)

Releases resources associated with a RocksDB root iterator.
- **Description**: Use this function to release resources allocated for a `fd_rocksdb_root_iter_t` object when it is no longer needed. This function ensures that any internal iterator is properly destroyed and that the associated database reference is cleared. Call this function to prevent resource leaks after you finish using the iterator. Ensure that the `iter` parameter is not null before calling this function.
- **Inputs**:
    - `iter`: A pointer to a `fd_rocksdb_root_iter_t` object. Must not be null. The function will safely handle the case where the internal iterator is already null.
- **Output**: None
- **See Also**: [`fd_rocksdb_root_iter_destroy`](<fd_rocksdb.c.md#fd_rocksdb_root_iter_destroy>)  (Implementation)


---
### fd\_rocksdb\_init<!-- {{#callable_declaration:fd_rocksdb_init}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L116>)

Initializes a RocksDB instance for read-only access.
- **Description**: Use this function to initialize a `fd_rocksdb_t` structure for read-only access to a RocksDB database. This function sets up the necessary options and column family configurations for the database. It must be called before any operations that require access to the database. The function requires a valid database directory path and a properly allocated `fd_rocksdb_t` structure. If the initialization fails, it returns a pointer to a string describing the error; otherwise, it returns `NULL`. Ensure that the `db_name` points to the actual RocksDB directory, not a parent directory.
- **Inputs**:
    - `db`: A pointer to an `fd_rocksdb_t` structure that will be initialized. Must not be null. The caller retains ownership.
    - `db_name`: A constant character pointer to the name of the database directory. Must point to the actual RocksDB directory. The caller retains ownership.
- **Output**: Returns a pointer to a string describing the error if initialization fails, or `NULL` if successful.
- **See Also**: [`fd_rocksdb_init`](<fd_rocksdb.c.md#fd_rocksdb_init>)  (Implementation)


---
### fd\_rocksdb\_new<!-- {{#callable_declaration:fd_rocksdb_new}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L125>)

Creates and initializes a new RocksDB instance.
- **Description**: Use this function to create and initialize a new RocksDB instance at the specified directory path. This function sets up the database options and creates necessary column families. It must be called with a valid `fd_rocksdb_t` structure and a non-null, valid directory path where the database will be created. Ensure that the directory path is accessible and writable. If the database creation fails, an error message is logged.
- **Inputs**:
    - `db`: A pointer to an `fd_rocksdb_t` structure that will be initialized. Must not be null. The caller retains ownership.
    - `db_name`: A constant character pointer to the full path where the RocksDB directory will be created. Must not be null and should point to a valid, writable directory path.
- **Output**: None
- **See Also**: [`fd_rocksdb_new`](<fd_rocksdb.c.md#fd_rocksdb_new>)  (Implementation)


---
### fd\_rocksdb\_destroy<!-- {{#callable_declaration:fd_rocksdb_destroy}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L133>)

Releases resources associated with a RocksDB instance.
- **Description**: Use this function to free all resources and memory allocations associated with a `fd_rocksdb_t` instance. This function should be called when the database is no longer needed to ensure that all internal data structures are properly released. It is important to call this function to prevent memory leaks. Ensure that the `fd_rocksdb_t` instance has been initialized before calling this function.
- **Inputs**:
    - `db`: A pointer to a `fd_rocksdb_t` instance. Must not be null. The function will release resources associated with this instance, and the caller retains ownership of the pointer itself.
- **Output**: None
- **See Also**: [`fd_rocksdb_destroy`](<fd_rocksdb.c.md#fd_rocksdb_destroy>)  (Implementation)


---
### fd\_rocksdb\_last\_slot<!-- {{#callable_declaration:fd_rocksdb_last_slot}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L142>)

Returns the last slot in the database.
- **Description**: Use this to find the last slot in the database by examining the root column. If the root column is empty, it sets the error message and returns 0. This function is useful for determining the most recent slot in a RocksDB instance. Ensure that the database is properly initialized before calling this function.
- **Inputs**:
    - `db`: A pointer to an `fd_rocksdb_t` structure representing the database. Must not be null.
    - `err`: A pointer to a `char*` where an error message will be stored if the root column is empty. Must not be null. The caller does not need to free the error message string.
- **Output**: Returns the last slot as an unsigned long. If the root column is empty, returns 0 and sets the error message.
- **See Also**: [`fd_rocksdb_last_slot`](<fd_rocksdb.c.md#fd_rocksdb_last_slot>)  (Implementation)


---
### fd\_rocksdb\_first\_slot<!-- {{#callable_declaration:fd_rocksdb_first_slot}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L152>)

Returns the first slot in the database.
- **Description**: Use this function to find the first slot in the database by examining the root column. Call this function when you need to determine the starting point of the slots in the database. If the root column is empty, the function sets the error message and returns 0. Ensure that the database is properly initialized before calling this function.
- **Inputs**:
    - `db`: A pointer to an `fd_rocksdb_t` structure representing the database. Must not be null and must point to a valid, initialized database object.
    - `err`: A pointer to a `char*` where the function can store an error message if the root column is empty. The caller must provide a valid pointer, and the function will set it to a constant string if an error occurs. The caller does not need to free this string.
- **Output**: Returns the first slot as an unsigned long integer. If the root column is empty, returns 0 and sets the error message.
- **See Also**: [`fd_rocksdb_first_slot`](<fd_rocksdb.c.md#fd_rocksdb_first_slot>)  (Implementation)


---
### fd\_rocksdb\_get\_meta<!-- {{#callable_declaration:fd_rocksdb_get_meta}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L156>)

Retrieves metadata for a specified slot from the database.
- **Description**: Use this function to obtain metadata associated with a specific slot from a RocksDB database. It is important to ensure that the database (`db`) is properly initialized and that the `slot` is valid. The function will return `NULL` if there is an error during retrieval or if no metadata is found for the given slot. The caller is responsible for freeing the returned metadata using the appropriate deallocation method.
- **Inputs**:
    - `db`: A pointer to an `fd_rocksdb_t` structure representing the database. Must not be null and must point to a valid, initialized database object.
    - `slot`: An unsigned long integer representing the slot for which metadata is to be retrieved. Must be a valid slot number within the database.
- **Output**: Returns a pointer to an `fd_slot_meta_t` structure containing the metadata for the specified slot, or `NULL` if an error occurs or no metadata is found. The caller is responsible for freeing the returned pointer.
- **See Also**: [`fd_rocksdb_get_meta`](<fd_rocksdb.c.md#fd_rocksdb_get_meta>)  (Implementation)


---
### fd\_rocksdb\_copy\_over\_slot\_indexed\_range<!-- {{#callable_declaration:fd_rocksdb_copy_over_slot_indexed_range}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L166>)

Copies entries from one RocksDB to another within a specified slot range.
- **Description**: Use this function to copy entries from a source RocksDB to a destination RocksDB for a specified column family index, within a given range of slot numbers. The function assumes that the keys in the column family are prefixed with slot numbers. It skips column families that are not slot-indexed, specifically those with indices `FD_ROCKSDB_CFIDX_TRANSACTION_MEMOS`, `FD_ROCKSDB_CFIDX_TRANSACTION_STATUS`, and `FD_ROCKSDB_CFIDX_ADDRESS_SIGNATURES`. Ensure that both source and destination databases are properly initialized before calling this function. The function does not handle errors internally, so ensure that the column family index is valid and that the slot range is correctly specified.
- **Inputs**:
    - `src`: Pointer to the source `fd_rocksdb_t` structure. Must not be null and must be initialized.
    - `dst`: Pointer to the destination `fd_rocksdb_t` structure. Must not be null and must be initialized.
    - `cf_idx`: Column family index to copy from. Must be a valid index and not one of the non-slot-indexed column families.
    - `start_slot`: Starting slot number for the range to copy. Must be less than or equal to `end_slot`.
    - `end_slot`: Ending slot number for the range to copy. Must be greater than or equal to `start_slot`.
- **Output**: Returns 0 on success. Does not return error codes for invalid input or internal errors.
- **See Also**: [`fd_rocksdb_copy_over_slot_indexed_range`](<fd_rocksdb.c.md#fd_rocksdb_copy_over_slot_indexed_range>)  (Implementation)


---
### fd\_rocksdb\_insert\_entry<!-- {{#callable_declaration:fd_rocksdb_insert_entry}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_rocksdb.h#L174>)

Inserts a key-value pair into a specified RocksDB column family.
- **Description**: Use this function to add a key-value pair to a specific column family in a RocksDB database. Ensure that the database is properly initialized and open before calling this function. The column family index must be valid and within the range of available column families. The function returns an error code if the insertion fails, which can occur if the column family index is out of range or if there is an internal error in the database operation.
- **Inputs**:
    - `db`: A pointer to an initialized `fd_rocksdb_t` structure representing the database. Must not be null.
    - `cf_idx`: An unsigned long representing the index of the column family where the key-value pair will be inserted. Must be within the valid range of column family indices.
    - `key`: A pointer to a character array containing the key to insert. Must not be null.
    - `key_len`: An unsigned long representing the length of the key. Must be greater than zero.
    - `value`: A pointer to a character array containing the value to insert. Must not be null.
    - `value_len`: An unsigned long representing the length of the value. Must be greater than zero.
- **Output**: Returns 0 on success, or -1 if an error occurs during the insertion process.
- **See Also**: [`fd_rocksdb_insert_entry`](<fd_rocksdb.c.md#fd_rocksdb_insert_entry>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)