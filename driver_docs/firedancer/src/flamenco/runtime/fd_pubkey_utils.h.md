<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Utilities for creating and deriving program-derived addresses (PDAs) with custom error handling.

# Purpose
This C header file defines utility functions and constants for handling public keys within a specific runtime environment. It includes function prototypes for creating and deriving program-derived addresses (PDAs) using seeds and public keys, specifically for non-ed25519 points. The file defines several custom error codes, such as `FD_PUBKEY_ERR_MAX_SEED_LEN_EXCEEDED`, to handle specific error conditions related to public key operations. The header also sets limits on the number of seeds (`MAX_SEEDS`) and the maximum seed length (`MAX_SEED_LEN`). The functions [`fd_pubkey_create_with_seed`](<#fd_pubkey_create_with_seed>), [`fd_pubkey_derive_pda`](<#fd_pubkey_derive_pda>), and [`fd_pubkey_find_program_address`](<#fd_pubkey_find_program_address>) are provided to facilitate the creation and validation of PDAs, with considerations for potential integration with shared functions in other parts of the system.
# Imports and Dependencies

---
- `context/fd_exec_instr_ctx.h`
- `context/fd_exec_txn_ctx.h`


# Function Declarations (Public API)

---
### fd\_pubkey\_create\_with\_seed<!-- {{#callable_declaration:fd_pubkey_create_with_seed}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_pubkey_utils.h#L18>)

Generates a public key using a base, seed, and owner.
- **Description**: Use this function to create a public key by combining a base, a seed, and an owner identifier. Ensure that the seed size does not exceed 32 bytes, as larger sizes will result in an error. The owner must not contain the string 'ProgramDerivedAddress' starting from the 12th byte, or an error will occur. The function writes the resulting public key to the provided output buffer. It is important to handle potential errors by checking the return value, which indicates success or specific error conditions.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure. This must not be null and is used for error reporting.
    - `base`: A constant array of 32 unsigned characters. This array provides the base data for the key generation and must not be null.
    - `seed`: A pointer to a constant character array. This provides additional data for key generation. The caller retains ownership, and the array must not be null.
    - `seed_sz`: An unsigned long representing the size of the seed. It must not exceed 32, or the function will return an error.
    - `owner`: A constant array of 32 unsigned characters. This array provides the owner data for the key generation and must not contain the string 'ProgramDerivedAddress' starting from the 12th byte.
    - `out`: An array of 32 unsigned characters where the function writes the generated public key. This must not be null.
- **Output**: Returns an integer indicating success or a specific error code. The output buffer is populated with the generated public key on success.
- **See Also**: [`fd_pubkey_create_with_seed`](<fd_pubkey_utils.c.md#fd_pubkey_create_with_seed>)  (Implementation)


---
### fd\_pubkey\_derive\_pda<!-- {{#callable_declaration:fd_pubkey_derive_pda}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_pubkey_utils.h#L32>)

Derives a program-derived address (PDA) from seeds and a program ID.
- **Description**: Use this function to derive a PDA that is not on an ed25519 curve point, given a program ID and a set of seeds. The function requires a valid `program_id` and a list of seeds, with an optional `bump_seed` to adjust the derivation. Ensure that the total number of seeds, including the bump seed if provided, does not exceed `MAX_SEEDS`. The function writes the derived PDA to `out` and sets `custom_err` if an error occurs, such as exceeding the maximum seed length or if the derived PDA is a valid ed25519 curve point. Callers must handle these errors appropriately.
- **Inputs**:
    - `program_id`: A pointer to a `fd_pubkey_t` structure representing the program ID. Must not be null.
    - `seeds_cnt`: The number of seeds provided in the `seeds` array. Must be non-negative and, when combined with `bump_seed`, must not exceed `MAX_SEEDS`.
    - `seeds`: An array of pointers to seed data. Each seed must be a valid pointer and not null. The number of seeds must match `seeds_cnt`.
    - `seed_szs`: An array of sizes corresponding to each seed in `seeds`. Each size must be valid and correspond to the actual size of the respective seed.
    - `bump_seed`: An optional pointer to a single-byte seed used to adjust the derivation. Can be null if not used.
    - `out`: A pointer to a `fd_pubkey_t` structure where the derived PDA will be stored. Must not be null.
    - `custom_err`: A pointer to a `uint` where error codes will be stored if an error occurs. Must not be null.
- **Output**: Returns an integer status code. `FD_PUBKEY_SUCCESS` indicates success, while other values indicate specific errors. The derived PDA is written to `out`, and `custom_err` is set if an error occurs.
- **See Also**: [`fd_pubkey_derive_pda`](<fd_pubkey_utils.c.md#fd_pubkey_derive_pda>)  (Implementation)


---
### fd\_pubkey\_find\_program\_address<!-- {{#callable_declaration:fd_pubkey_find_program_address}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_pubkey_utils.h#L49>)

Finds a valid program-derived address and its bump seed.
- **Description**: Use this function to find a valid program-derived address (PDA) by iterating through possible bump seeds. It must be called with a valid program ID and seed data. The function attempts to derive a PDA that is not on an ed25519 curve point, which would indicate an invalid PDA. It returns the first valid PDA found and its corresponding bump seed. If no valid PDA is found, the function sets a custom error code. Ensure that the number of seeds does not exceed `MAX_SEEDS` and each seed does not exceed `MAX_SEED_LEN`.
- **Inputs**:
    - `program_id`: Pointer to a `fd_pubkey_t` representing the program ID. Must not be null.
    - `seeds_cnt`: Number of seed elements. Must be less than or equal to `MAX_SEEDS`.
    - `seeds`: Array of pointers to seed data. Each seed must not exceed `MAX_SEED_LEN`. Must not be null.
    - `seed_szs`: Array of sizes for each seed. Must correspond to the number of seeds and not exceed `MAX_SEED_LEN` for each.
    - `out`: Pointer to a `fd_pubkey_t` where the function will store the valid PDA. Must not be null.
    - `out_bump_seed`: Pointer to a `uchar` where the function will store the bump seed used to derive the valid PDA. Must not be null.
    - `custom_err`: Pointer to a `uint` where the function will store a custom error code if derivation fails. Must not be null.
- **Output**: Returns `FD_PUBKEY_SUCCESS` on success. On failure, returns an error code and sets `custom_err`.
- **See Also**: [`fd_pubkey_find_program_address`](<fd_pubkey_utils.c.md#fd_pubkey_find_program_address>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)