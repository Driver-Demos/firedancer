<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for managing Solana account databases, including error handling and metadata operations.

# Purpose
The code is a C header file that defines APIs for managing Solana account databases within the Firedancer client. It provides a set of functions and macros for handling account metadata, error codes, and interactions with a database abstraction called "funk." The file includes definitions for error codes specific to account management, such as `FD_ACC_MGR_SUCCESS` and `FD_ACC_MGR_ERR_UNKNOWN_ACCOUNT`, and sets size limits for account data and nonces.

The header file includes inline functions for initializing and checking the existence of account metadata, as well as functions for retrieving account data and record sizes. It also defines a function to generate database keys from account addresses and provides an API for read-only access to account metadata in the database. Additionally, the file includes a function to convert error codes into human-readable strings. The code is designed to be used in conjunction with other components of the Firedancer client, and it includes conditional compilation for systems with AVX support to optimize certain operations.
# Imports and Dependencies

---
- `fd_txn_account.h`
- `../../util/simd/fd_avx.h`


# Functions

---
### fd\_account\_meta\_init<!-- {{#callable:fd_account_meta_init}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L28>)

Initializes an `fd_account_meta_t` structure by setting all its bytes to zero.
- **Inputs**:
    - ``m``: A pointer to an `fd_account_meta_t` structure that will be initialized.
- **Logic and Control Flow**:
    - Calls `fd_memset` to set all bytes of the structure pointed to by `m` to zero.
    - The size of the memory block to set is determined by `sizeof(fd_account_meta_t)`.
- **Output**: No return value; the function modifies the memory pointed to by `m` directly.


---
### fd\_account\_meta\_exists<!-- {{#callable:fd_account_meta_exists}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L45>)

Checks if a Solana account's metadata indicates the account exists or has been deleted.
- **Inputs**:
    - ``m``: A pointer to a `fd_account_meta_t` structure representing the account metadata to check.
- **Logic and Control Flow**:
    - If `m` is NULL, return 0 indicating the account does not exist.
    - If `FD_HAS_AVX` is defined, load the `owner` field using `wl_ldu` and check if it is non-zero using `_mm256_testz_si256`.
    - If `FD_HAS_AVX` is not defined, iterate over the `owner` array to check if any element is non-zero, setting `has_owner` accordingly.
    - Return 1 if any of the following conditions are true: `m->lamports` is greater than 0, `m->dlen` is greater than 0, or `has_owner` is true; otherwise, return 0.
- **Output**: Returns 1 if the account exists (non-zero lamports, non-empty data, or non-zero owner); otherwise, returns 0.


---
### fd\_account\_meta\_get\_data<!-- {{#callable:fd_account_meta_get_data}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L67>)

Calculates the starting address of the data region in a `fd_account_meta_t` structure.
- **Inputs**:
    - `m`: A pointer to a `fd_account_meta_t` structure.
- **Logic and Control Flow**:
    - Casts the input pointer `m` to a `uchar` pointer.
    - Adds the size of `fd_account_meta_t` to the cast pointer to calculate the address of the data region.
- **Output**: A pointer to the data region immediately following the `fd_account_meta_t` structure.


---
### fd\_account\_meta\_get\_data\_const<!-- {{#callable:fd_account_meta_get_data_const}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L72>)

Returns a constant pointer to the data section of a `fd_account_meta_t` structure.
- **Inputs**:
    - `m`: A constant pointer to a `fd_account_meta_t` structure.
- **Logic and Control Flow**:
    - Calculate the address of the data section by adding the size of `fd_account_meta_t` to the pointer `m`.
    - Return the calculated address as a constant pointer.
- **Output**: A constant pointer to the data section of the `fd_account_meta_t` structure.


---
### fd\_account\_meta\_get\_record\_sz<!-- {{#callable:fd_account_meta_get_record_sz}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L77>)

Calculates the total size of an account record including metadata and data length.
- **Inputs**:
    - `m`: A pointer to a constant `fd_account_meta_t` structure representing the account metadata.
- **Logic and Control Flow**:
    - Calculate the size of the `fd_account_meta_t` structure using `sizeof(fd_account_meta_t)`.
    - Add the `dlen` field from the `fd_account_meta_t` structure to the size calculated in the previous step.
    - Return the total size as an unsigned long integer.
- **Output**: Returns the total size of the account record as an unsigned long integer.


---
### fd\_funk\_acc\_key<!-- {{#callable:fd_funk_rec_key_t::fd_funk_acc_key}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L87>)

Generates a `fd_funk_rec_key_t` key from a given `fd_pubkey_t` public key.
- **Inputs**:
    - `pubkey`: A pointer to a `fd_pubkey_t` structure representing the public key to convert into a funk record key.
- **Logic and Control Flow**:
    - Initialize a `fd_funk_rec_key_t` structure `key` with zero values.
    - Copy the contents of the `pubkey` into the `key.uc` array using `memcpy`.
    - Return the populated `key`.
- **Output**: A `fd_funk_rec_key_t` structure containing the funk record key derived from the input public key.
- **See also**: [`fd_funk_rec_key_t`](<../../funk/fd_funk_base.h.md#fd_funk_rec_key_t>)  (Data Structure)


# Function Declarations (Public API)

---
### fd\_funk\_get\_acc\_meta\_readonly<!-- {{#callable_declaration:fd_funk_get_acc_meta_readonly}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L140>)

Requests a read-only handle to account metadata.
- **Description**: Use this function to obtain a read-only pointer to the metadata of an account in the database. This function is useful when you need to access account metadata without modifying it. Ensure that no other operations are modifying the account concurrently, as this function assumes exclusive read access. The function returns a pointer to the account metadata if successful, or NULL if the account is not found or an error occurs. It is important not to cast the returned pointer to a non-const type. The lifetime of the returned pointer is valid until the transaction ends or the account is modified.
- **Inputs**:
    - `funk`: A pointer to the database handle. Must not be null.
    - `xid`: A pointer to the transaction identifier. Must not be null.
    - `pubkey`: A pointer to the account key to query. Must not be null.
    - `orec`: An optional pointer to store a pointer to the funk record. Can be null if not needed.
    - `opt_err`: An optional pointer to an integer to store error codes. Can be null if error codes are not needed.
    - `xid_out`: An optional pointer to store the transaction identifier in which the record was created. Can be null if not needed.
- **Output**: Returns a pointer to the account metadata on success, or NULL on failure. If `orec` is not null, it stores a pointer to the funk record. If `opt_err` is not null, it stores an error code.
- **See Also**: [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>)  (Implementation)


---
### fd\_acc\_mgr\_strerror<!-- {{#callable_declaration:fd_acc_mgr_strerror}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_acc_mgr.h#L153>)

Converts an error code to a human-readable string.
- **Description**: Use this function to obtain a human-readable description of an error code related to account management. This is useful for logging or displaying error messages to users. The function is thread-safe and guarantees that the returned string is always non-null and has an infinite lifetime.
- **Inputs**:
    - `err`: An integer representing the error code to convert. Valid values include `FD_ACC_MGR_SUCCESS` and `FD_ACC_MGR_ERR_UNKNOWN_ACCOUNT`. If the error code is not recognized, the function returns a default string indicating an unknown error.
- **Output**: A constant character pointer to a string describing the error. The string is always non-null and has an infinite lifetime.
- **See Also**: [`fd_acc_mgr_strerror`](<fd_acc_mgr.c.md#fd_acc_mgr_strerror>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)