<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines the `fd_borrowed_account_t` structure and related functions for managing borrowed accounts in transactions.

# Purpose
The code defines a C header file for managing "borrowed accounts" within a transaction context, specifically in a system that appears to be related to financial transactions or blockchain technology. The primary structure defined is `fd_borrowed_account_t`, which encapsulates information about an account that is temporarily borrowed for operations within a transaction. This structure includes fields such as `magic` for validation, a pointer to the account (`acct`), and a pointer to the instruction context (`instr_ctx`). The code provides a set of functions to initialize, manipulate, and query the state of these borrowed accounts, mirroring functionality from a Rust-based system called Agave.

The header file includes various functions for constructing and destructing borrowed accounts, as well as for accessing and modifying account data. These functions include getters and setters for account properties such as data length, ownership, and lamports (a unit of currency). The code also includes functions to check account properties, such as whether an account is executable, writable, or owned by the current program. Additionally, the code enforces constraints on data length and transaction limits, ensuring that operations adhere to predefined limits. The file is intended to be included in other C source files, providing a public API for managing borrowed accounts in a transaction context.
# Imports and Dependencies

---
- `fd_bank.h`
- `fd_executor_err.h`
- `sysvar/fd_sysvar_rent.h`
- `program/fd_program_util.h`


# Data Structures

---
### fd\_borrowed\_account
- **Type**: ``struct``
- **Members**:
    - ``magic``: Stores a unique identifier for the `fd_borrowed_account` structure.
    - ``acct``: Points to a `fd_txn_account_t` structure representing the transaction account.
    - ``instr_ctx``: Points to a constant `fd_exec_instr_ctx_t` structure representing the instruction context.
    - ``index_in_instruction``: Stores the index of the account in the instruction, set to `USHORT_MAX` for borrowed program accounts.
- **Description**: Represents a borrowed account in a transaction context, encapsulating details about the account, its associated instruction context, and its position within an instruction. The `magic` field ensures the integrity of the structure, while `acct` and `instr_ctx` provide references to the account and its execution context. The `index_in_instruction` field helps identify the account's position in the instruction, with a special value for borrowed program accounts.


---
### fd\_borrowed\_account\_t
- **Type**: ``struct``
- **Members**:
    - ``magic``: A unique identifier to verify the integrity of the borrowed account.
    - ``acct``: A pointer to the transaction account associated with the borrowed account.
    - ``instr_ctx``: A constant pointer to the instruction context related to the borrowed account.
    - ``index_in_instruction``: An index indicating the position of the account in the instruction, set to `USHORT_MAX` for borrowed program accounts.
- **Description**: Represents a borrowed account in a transaction context, providing mechanisms to manage and manipulate account data, ownership, and permissions within a transaction. It includes fields for a unique identifier (`magic`), a pointer to the associated transaction account (`acct`), a pointer to the instruction context (`instr_ctx`), and an index indicating the account's position in the instruction (`index_in_instruction`).


# Functions

---
### fd\_borrowed\_account\_init<!-- {{#callable:fd_borrowed_account_init}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L31>)

Initializes a `fd_borrowed_account_t` structure with provided account, instruction context, and index, and sets a magic number for validation.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure to initialize.
    - `acct`: A pointer to a `fd_txn_account_t` structure representing the account to borrow.
    - `instr_ctx`: A constant pointer to a `fd_exec_instr_ctx_t` structure representing the instruction context.
    - `index_in_instruction`: An unsigned short representing the index of the account in the instruction.
- **Logic and Control Flow**:
    - Assigns the `acct` pointer to the `acct` field of `borrowed_acct`.
    - Assigns the `instr_ctx` pointer to the `instr_ctx` field of `borrowed_acct`.
    - Assigns the `index_in_instruction` value to the `index_in_instruction` field of `borrowed_acct`.
    - Calls `FD_COMPILER_MFENCE()` to ensure memory ordering before setting the magic number.
    - Sets the `magic` field of `borrowed_acct` to `FD_BORROWED_ACCOUNT_MAGIC`.
    - Calls `FD_COMPILER_MFENCE()` again to ensure memory ordering after setting the magic number.
- **Output**: The function does not return a value; it initializes the `borrowed_acct` structure in place.


---
### fd\_borrowed\_account\_drop<!-- {{#callable:fd_borrowed_account_drop}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L52>)

Releases the acquired write on the borrowed account object by calling `fd_txn_account_drop` on the account within the `fd_borrowed_account_t` structure.
- **Inputs**:
    - `borrowed_acct`: A pointer to an `fd_borrowed_account_t` structure representing the borrowed account to be dropped.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_drop` with the `acct` member of the `borrowed_acct` structure as an argument.
- **Output**: No return value; the function operates directly on the provided `fd_borrowed_account_t` structure.


---
### fd\_borrowed\_account\_destroy<!-- {{#callable:fd_borrowed_account_destroy}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L59>)

Releases resources associated with a borrowed account and resets its state.
- **Inputs**:
    - `borrowed_acct`: A pointer to an `fd_borrowed_account_t` structure representing the borrowed account to be destroyed.
- **Logic and Control Flow**:
    - Checks if the `magic` field of `borrowed_acct` equals `FD_BORROWED_ACCOUNT_MAGIC` to verify the account's validity.
    - If valid, calls [`fd_borrowed_account_drop`](<#fd_borrowed_account_drop>) to release the acquired write on the borrowed account object.
    - Executes a memory fence using `FD_COMPILER_MFENCE()` to ensure memory operations are completed.
    - Sets the `magic` field of `borrowed_acct` to `0UL` using `FD_VOLATILE` to mark the account as destroyed.
    - Executes another memory fence to ensure the `magic` field update is visible to other threads.
    - Sets the `borrowed_acct` pointer to `NULL` to prevent further use.
- **Output**: No return value; the function operates directly on the input pointer to modify the borrowed account's state.
- **Functions Called**:
    - [`fd_borrowed_account_drop`](<#fd_borrowed_account_drop>)


---
### fd\_borrowed\_account\_get\_data<!-- {{#callable:fd_borrowed_account_get_data}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L79>)

Retrieves the data associated with a borrowed account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account from which to retrieve data.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_get_data` with the `acct` member of the `borrowed_acct` structure as an argument.
    - Returns the result of the `fd_txn_account_get_data` function call.
- **Output**: A pointer to a constant `uchar` representing the data of the borrowed account.


---
### fd\_borrowed\_account\_get\_data\_len<!-- {{#callable:fd_borrowed_account_get_data_len}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L84>)

Retrieves the length of the data associated with a borrowed account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_get_data_len` with the `acct` member of the `borrowed_acct` structure.
    - Returns the result of the `fd_txn_account_get_data_len` function call.
- **Output**: The function returns an `ulong` representing the length of the data in the borrowed account.


---
### fd\_borrowed\_account\_get\_owner<!-- {{#callable:fd_borrowed_account_get_owner}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L103>)

Retrieves the owner of a borrowed account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_get_owner` with the `acct` member of the `borrowed_acct` structure as an argument.
    - Returns the result of the `fd_txn_account_get_owner` function call.
- **Output**: A pointer to a constant `fd_pubkey_t` representing the owner of the account.


---
### fd\_borrowed\_account\_get\_lamports<!-- {{#callable:fd_borrowed_account_get_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L116>)

Retrieves the current number of lamports in a borrowed account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_get_lamports` with the `acct` member of the `borrowed_acct` structure.
    - Returns the result of the `fd_txn_account_get_lamports` function call.
- **Output**: The function returns an `ulong` representing the number of lamports in the account.


---
### fd\_borrowed\_account\_get\_rent\_epoch<!-- {{#callable:fd_borrowed_account_get_rent_epoch}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L126>)

Retrieves the rent epoch of a borrowed account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_get_rent_epoch` with the `acct` member of the `borrowed_acct` structure.
    - Returns the result of the `fd_txn_account_get_rent_epoch` function call.
- **Output**: Returns an unsigned long integer representing the rent epoch of the account.


---
### fd\_borrowed\_account\_get\_acc\_meta<!-- {{#callable:fd_borrowed_account_get_acc_meta}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L131>)

Retrieves the account metadata from a borrowed account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_get_meta` with the `acct` member of the `borrowed_acct` structure as an argument.
    - Returns the result of the `fd_txn_account_get_meta` function call.
- **Output**: A pointer to a constant `fd_account_meta_t` structure containing the account metadata.


---
### fd\_borrowed\_account\_checked\_add\_lamports<!-- {{#callable:fd_borrowed_account_checked_add_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L208>)

Adds a specified number of lamports to a borrowed account's balance, checking for arithmetic overflow.
- **Inputs**:
    - ``borrowed_acct``: A pointer to an `fd_borrowed_account_t` structure representing the borrowed account to which lamports will be added.
    - ``lamports``: An unsigned long integer representing the number of lamports to add to the account's balance.
- **Logic and Control Flow**:
    - Initialize `balance_post` to 0.
    - Call [`fd_ulong_checked_add`](<program/fd_program_util.h.md#fd_ulong_checked_add>) to add `lamports` to the current balance of the account, storing the result in `balance_post`.
    - Check if [`fd_ulong_checked_add`](<program/fd_program_util.h.md#fd_ulong_checked_add>) returns an error indicating arithmetic overflow.
    - If an overflow error occurs, return `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW`.
    - If no error occurs, call [`fd_borrowed_account_set_lamports`](<fd_borrowed_account.c.md#fd_borrowed_account_set_lamports>) to update the account's balance with `balance_post`.
    - Return the result of [`fd_borrowed_account_set_lamports`](<fd_borrowed_account.c.md#fd_borrowed_account_set_lamports>).
- **Output**: Returns 0 on success or `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW` if an arithmetic overflow occurs.
- **Functions Called**:
    - [`fd_ulong_checked_add`](<program/fd_program_util.h.md#fd_ulong_checked_add>)
    - [`fd_borrowed_account_set_lamports`](<fd_borrowed_account.c.md#fd_borrowed_account_set_lamports>)


---
### fd\_borrowed\_account\_checked\_sub\_lamports<!-- {{#callable:fd_borrowed_account_checked_sub_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L231>)

Subtracts a specified number of lamports from a borrowed account's balance, checking for arithmetic overflow.
- **Inputs**:
    - ``borrowed_acct``: A pointer to an `fd_borrowed_account_t` structure representing the borrowed account from which lamports will be subtracted.
    - ``lamports``: An unsigned long integer representing the number of lamports to subtract from the account's balance.
- **Logic and Control Flow**:
    - Retrieve the current number of lamports in the account using `fd_txn_account_get_lamports` and store it in a temporary variable.
    - Call [`fd_ulong_checked_sub`](<program/fd_program_util.h.md#fd_fn_unusedfd_ulong_checked_sub>) to subtract the specified `lamports` from the current balance, storing the result in `balance_post`.
    - Check if [`fd_ulong_checked_sub`](<program/fd_program_util.h.md#fd_fn_unusedfd_ulong_checked_sub>) returned an error indicating arithmetic overflow; if so, return `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW`.
    - If no overflow occurred, update the account's lamports to the new balance using [`fd_borrowed_account_set_lamports`](<fd_borrowed_account.c.md#fd_borrowed_account_set_lamports>) and return its result.
- **Output**: Returns 0 on success or an error code `FD_EXECUTOR_INSTR_ERR_ARITHMETIC_OVERFLOW` if an arithmetic overflow occurs.
- **Functions Called**:
    - [`FD_FN_UNUSED::fd_ulong_checked_sub`](<program/fd_program_util.h.md#fd_fn_unusedfd_ulong_checked_sub>)
    - [`fd_borrowed_account_set_lamports`](<fd_borrowed_account.c.md#fd_borrowed_account_set_lamports>)


---
### fd\_borrowed\_account\_is\_rent\_exempt\_at\_data\_length<!-- {{#callable:fd_borrowed_account_is_rent_exempt_at_data_length}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L264>)

Checks if a borrowed account is rent-exempt based on its current data length.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account to check for rent exemption.
- **Logic and Control Flow**:
    - Retrieve the `fd_txn_account_t` account from the `borrowed_acct` structure.
    - Check if the account metadata is available using `fd_txn_account_get_meta`; if not, log an error and terminate.
    - Query the rent information from the bank using `fd_bank_rent_query`.
    - Calculate the minimum balance required for rent exemption using [`fd_rent_exempt_minimum_balance`](<sysvar/fd_sysvar_rent1.c.md#fd_rent_exempt_minimum_balance>) with the rent information and the account's data length.
    - Compare the account's current lamports (balance) with the calculated minimum balance.
    - Return 1 if the account's lamports are greater than or equal to the minimum balance, indicating rent exemption; otherwise, return 0.
- **Output**: Returns 1 if the account is rent-exempt at its current data length, otherwise returns 0.
- **Functions Called**:
    - [`fd_rent_exempt_minimum_balance`](<sysvar/fd_sysvar_rent1.c.md#fd_rent_exempt_minimum_balance>)


---
### fd\_borrowed\_account\_is\_executable<!-- {{#callable:fd_borrowed_account_is_executable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L284>)

Checks if a borrowed account is executable by calling the corresponding function on its underlying transaction account.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account to check.
- **Logic and Control Flow**:
    - Calls `fd_txn_account_is_executable` with the `acct` member of the `borrowed_acct` structure.
    - Returns the result of the `fd_txn_account_is_executable` function call.
- **Output**: An integer indicating whether the account is executable (1 if executable, 0 otherwise).


---
### fd\_borrowed\_account\_is\_executable\_internal<!-- {{#callable:fd_borrowed_account_is_executable_internal}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L296>)

Determines if a borrowed account is executable by checking if a specific feature is inactive and if the account is marked as executable.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account to check.
- **Logic and Control Flow**:
    - Check if the `remove_accounts_executable_flag_checks` feature is inactive for the transaction context associated with the borrowed account.
    - If the feature is inactive, call [`fd_borrowed_account_is_executable`](<#fd_borrowed_account_is_executable>) to check if the account is marked as executable.
    - Return the result of the logical AND operation between the feature check and the executable status.
- **Output**: Returns an integer value: 1 if the account is executable under the given conditions, otherwise 0.
- **Functions Called**:
    - [`fd_borrowed_account_is_executable`](<#fd_borrowed_account_is_executable>)


---
### fd\_borrowed\_account\_is\_mutable<!-- {{#callable:fd_borrowed_account_is_mutable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L302>)

Checks if a borrowed account is mutable by delegating to the underlying transaction account's mutability check.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account to check for mutability.
- **Logic and Control Flow**:
    - Calls the function `fd_txn_account_is_mutable` with the `acct` member of the `borrowed_acct` structure.
    - Returns the result of the `fd_txn_account_is_mutable` function call.
- **Output**: An integer indicating whether the borrowed account is mutable (non-zero) or not (zero).


---
### fd\_borrowed\_account\_is\_signer<!-- {{#callable:fd_borrowed_account_is_signer}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L313>)

Determines if a borrowed account is a signer by checking its index against the instruction's account count and verifying its signer status.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account to check.
- **Logic and Control Flow**:
    - Retrieve the instruction context from the `borrowed_acct` structure.
    - Retrieve the instruction from the instruction context.
    - Check if the `index_in_instruction` of `borrowed_acct` is greater than or equal to the account count in the instruction; if so, return 0.
    - Call `fd_instr_acc_is_signer_idx` with the instruction and `index_in_instruction` to determine if the account is a signer, and return the result.
- **Output**: Returns 1 if the account is a signer, otherwise returns 0.


---
### fd\_borrowed\_account\_is\_writable<!-- {{#callable:fd_borrowed_account_is_writable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L331>)

Checks if a borrowed account is writable by verifying its index against the instruction context and calling a helper function.
- **Inputs**:
    - `borrowed_acct`: A pointer to a constant `fd_borrowed_account_t` structure representing the borrowed account to check.
- **Logic and Control Flow**:
    - Retrieve the instruction context from the `borrowed_acct` structure.
    - Retrieve the instruction from the instruction context.
    - Check if the `index_in_instruction` of `borrowed_acct` is greater than or equal to the account count in the instruction context; if true, return 0.
    - Call `fd_instr_acc_is_writable_idx` with the instruction and `index_in_instruction` to determine if the account is writable.
- **Output**: Returns 1 if the account is writable, otherwise returns 0.


---
### fd\_borrowed\_account\_is\_owned\_by\_current\_program<!-- {{#callable:fd_borrowed_account_is_owned_by_current_program}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L352>)

Checks if a borrowed account is owned by the program invoked in the current instruction.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account to check.
- **Logic and Control Flow**:
    - Declare a pointer `program_id_pubkey` and initialize it to `NULL`.
    - Call `fd_exec_instr_ctx_get_last_program_key` with `borrowed_acct->instr_ctx` and `program_id_pubkey` to get the last program key.
    - If the call returns an error, return `0`.
    - Compare the `key` of `program_id_pubkey` with the owner of `borrowed_acct->acct` using `memcmp`.
    - Return the result of the comparison, negated, as an integer.
- **Output**: Returns `1` if the account is owned by the current program, otherwise returns `0`.


---
### fd\_borrowed\_account\_can\_data\_be\_changed<!-- {{#callable:fd_borrowed_account_can_data_be_changed}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L369>)

Determines if the data of a borrowed account can be changed based on its executability, writability, and ownership.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account to check.
    - `err`: A pointer to an integer where the function will store an error code if the data cannot be changed.
- **Logic and Control Flow**:
    - Check if the account is executable using [`fd_borrowed_account_is_executable_internal`](<#fd_borrowed_account_is_executable_internal>); if true, set `err` to `FD_EXECUTOR_INSTR_ERR_EXECUTABLE_DATA_MODIFIED` and return 0.
    - Check if the account is writable using [`fd_borrowed_account_is_writable`](<#fd_borrowed_account_is_writable>); if false, set `err` to `FD_EXECUTOR_INSTR_ERR_READONLY_DATA_MODIFIED` and return 0.
    - Check if the account is owned by the current program using [`fd_borrowed_account_is_owned_by_current_program`](<#fd_borrowed_account_is_owned_by_current_program>); if false, set `err` to `FD_EXECUTOR_INSTR_ERR_EXTERNAL_DATA_MODIFIED` and return 0.
    - If all checks pass, set `err` to `FD_EXECUTOR_INSTR_SUCCESS` and return 1.
- **Output**: Returns 1 if the data can be changed, otherwise returns 0. Sets `err` to an appropriate error code if the data cannot be changed.
- **Functions Called**:
    - [`fd_borrowed_account_is_executable_internal`](<#fd_borrowed_account_is_executable_internal>)
    - [`fd_borrowed_account_is_writable`](<#fd_borrowed_account_is_writable>)
    - [`fd_borrowed_account_is_owned_by_current_program`](<#fd_borrowed_account_is_owned_by_current_program>)


---
### fd\_borrowed\_account\_can\_data\_be\_resized<!-- {{#callable:fd_borrowed_account_can_data_be_resized}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L402>)

Checks if the data of a borrowed account can be resized to a new length under specific conditions.
- **Inputs**:
    - ``borrowed_acct``: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account.
    - ``new_length``: The desired new length for the account data.
    - ``err``: A pointer to an integer where the function will store an error code if resizing is not possible.
- **Logic and Control Flow**:
    - Retrieve the account from the `borrowed_acct` structure.
    - Check if the current data length is different from `new_length` and if the account is not owned by the current program; if true, set `err` to `FD_EXECUTOR_INSTR_ERR_ACC_DATA_SIZE_CHANGED` and return 0.
    - Check if `new_length` exceeds `MAX_PERMITTED_DATA_LENGTH`; if true, set `err` to `FD_EXECUTOR_INSTR_ERR_INVALID_REALLOC` and return 0.
    - Calculate the difference between `new_length` and the current data length, then add this to the current transaction's `accounts_resize_delta`.
    - Check if the new `accounts_resize_delta` exceeds `MAX_PERMITTED_ACCOUNT_DATA_ALLOCS_PER_TXN`; if true, set `err` to `FD_EXECUTOR_INSTR_ERR_MAX_ACCS_DATA_ALLOCS_EXCEEDED` and return 0.
    - If all checks pass, set `err` to `FD_EXECUTOR_INSTR_SUCCESS` and return 1.
- **Output**: Returns 1 if the data can be resized, otherwise returns 0 and sets an error code in `err`.
- **Functions Called**:
    - [`fd_borrowed_account_is_owned_by_current_program`](<#fd_borrowed_account_is_owned_by_current_program>)


---
### fd\_borrowed\_account\_is\_zeroed<!-- {{#callable:fd_borrowed_account_is_zeroed}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L436>)

Checks if all data in a borrowed account is zero.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account to check.
- **Logic and Control Flow**:
    - Retrieve the `fd_txn_account_t` account from the `borrowed_acct`.
    - Get the data from the account using `fd_txn_account_get_data`.
    - Iterate over each byte of the data using a loop.
    - If any byte is not zero, return 0 immediately.
    - If all bytes are zero, return 1.
- **Output**: Returns 1 if all bytes in the account data are zero, otherwise returns 0.


# Function Declarations (Public API)

---
### fd\_borrowed\_account\_get\_data\_mut<!-- {{#callable_declaration:fd_borrowed_account_get_data_mut}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L98>)

Provides mutable access to account data.
- **Description**: Use this function to obtain a writable reference to the data of a borrowed account, ensuring that the account has exclusive write access. This function checks if the account data can be changed before proceeding. It is important to call this function only when you have already acquired the necessary permissions for data modification. The function will return an error code if the account data cannot be modified due to restrictions such as the account being executable, read-only, or not owned by the current program.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account. Must not be null and must have exclusive write access.
    - `data_out`: A pointer to a location where the function will store the address of the writable account data. Can be null if the data address is not needed.
    - `dlen_out`: A pointer to a location where the function will store the length of the account data. Can be null if the data length is not needed.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` on success, or an error code if the account data cannot be modified.
- **See Also**: [`fd_borrowed_account_get_data_mut`](<fd_borrowed_account.c.md#fd_borrowed_account_get_data_mut>)  (Implementation)


---
### fd\_borrowed\_account\_set\_owner<!-- {{#callable_declaration:fd_borrowed_account_set_owner}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L143>)

Sets the owner of a borrowed account.
- **Description**: Use this function to change the owner of a borrowed account. The function requires that the current program owns the account, the account is writable, not executable, and its data is zero-initialized or empty. If the new owner is the same as the current owner, the function returns success without making changes. Call this function when you need to transfer ownership of an account under these conditions.
- **Inputs**:
    - `borrowed_acct`: A pointer to the `fd_borrowed_account_t` structure representing the borrowed account. Must not be null and must meet specific conditions (owned by the current program, writable, not executable, and zero-initialized).
    - `owner`: A pointer to the `fd_pubkey_t` structure representing the new owner's public key. Must not be null.
- **Output**: Returns an integer status code. `FD_EXECUTOR_INSTR_SUCCESS` on success, or `FD_EXECUTOR_INSTR_ERR_MODIFIED_PROGRAM_ID` if preconditions are not met.
- **See Also**: [`fd_borrowed_account_set_owner`](<fd_borrowed_account.c.md#fd_borrowed_account_set_owner>)  (Implementation)


---
### fd\_borrowed\_account\_set\_lamports<!-- {{#callable_declaration:fd_borrowed_account_set_lamports}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L157>)

Sets the lamports for a borrowed account.
- **Description**: Use this function to update the lamports (balance) of a borrowed account. Before calling, ensure the account is writable, not executable, and owned by the current program if the balance is to decrease. The function performs necessary permission checks and returns an error code if any condition is not met. It does not update global capitalization and returns success if the lamports remain unchanged.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account. Must not be null and must be properly initialized.
    - `lamports`: The new lamports value to set for the account. Must be a valid unsigned long integer.
- **Output**: Returns 0 on success or an FD_EXECUTOR_INSTR_ERR_{...} code on failure, indicating the type of permission error encountered.
- **See Also**: [`fd_borrowed_account_set_lamports`](<fd_borrowed_account.c.md#fd_borrowed_account_set_lamports>)  (Implementation)


---
### fd\_borrowed\_account\_set\_data\_from\_slice<!-- {{#callable_declaration:fd_borrowed_account_set_data_from_slice}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L171>)

Sets account data from a provided data slice.
- **Description**: Use this function to update the data of a borrowed account with a new data slice. Before calling, ensure that the account can be resized to the new data size and that the data can be changed. The function performs necessary checks and returns an error code if any condition is not met. It assumes that the destination account has enough space to accommodate the new data. This function acquires a writable handle to the account data.
- **Inputs**:
    - `borrowed_acct`: A pointer to the `fd_borrowed_account_t` structure representing the borrowed account. Must not be null and must be properly initialized.
    - `data`: A pointer to the data slice to set in the account. Must not be null.
    - `data_sz`: The size of the data slice. Must be within the permitted data length limits.
- **Output**: Returns an integer status code. Returns `FD_EXECUTOR_INSTR_SUCCESS` on success or an error code if the operation fails.
- **See Also**: [`fd_borrowed_account_set_data_from_slice`](<fd_borrowed_account.c.md#fd_borrowed_account_set_data_from_slice>)  (Implementation)


---
### fd\_borrowed\_account\_set\_data\_length<!-- {{#callable_declaration:fd_borrowed_account_set_data_length}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L182>)

Sets the data length of a borrowed account.
- **Description**: Use this function to change the data length of a borrowed account. It performs necessary checks to ensure the account's data can be resized and modified. The function must be called with a valid borrowed account that is writable and owned by the current program. It returns an error code if the operation fails due to permission issues or if the new length exceeds allowed limits.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account. Must not be null and must be writable and owned by the current program.
    - `new_len`: The desired new length for the account's data. Must not exceed `MAX_PERMITTED_DATA_LENGTH` and must comply with per-transaction allocation limits.
- **Output**: Returns an integer error code. `FD_EXECUTOR_INSTR_SUCCESS` indicates success, while other codes indicate specific errors.
- **See Also**: [`fd_borrowed_account_set_data_length`](<fd_borrowed_account.c.md#fd_borrowed_account_set_data_length>)  (Implementation)


---
### fd\_borrowed\_account\_set\_executable<!-- {{#callable_declaration:fd_borrowed_account_set_executable}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L193>)

Sets the executable flag for a borrowed account.
- **Description**: Use this function to set the executable flag of a borrowed account. The account must be rent exempt, owned by the current program, and writable. The function does not allow clearing the executable flag if it is already set. If the executable flag does not change, the function returns success without modifying the account. Call this function when you need to update the executable status of an account under the specified conditions.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account. Must not be null and must point to a valid borrowed account structure.
    - `is_executable`: An integer indicating whether to set the account as executable (non-zero) or not (zero). Cannot clear the executable flag if it is already set.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` on success or an error code if the operation fails due to unmet conditions.
- **See Also**: [`fd_borrowed_account_set_executable`](<fd_borrowed_account.c.md#fd_borrowed_account_set_executable>)  (Implementation)


---
### fd\_borrowed\_account\_update\_accounts\_resize\_delta<!-- {{#callable_declaration:fd_borrowed_account_update_accounts_resize_delta}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_borrowed_account.h#L250>)

Updates the accounts resize delta for a borrowed account.
- **Description**: Use this function to update the accounts resize delta for a borrowed account when the data length changes. This function calculates the size difference between the current data length and the new length, and adds this difference to the existing accounts resize delta. It is important to ensure that the `borrowed_acct` is valid and that the `err` pointer is not null before calling this function. The function sets the error code to indicate success.
- **Inputs**:
    - `borrowed_acct`: A pointer to a `fd_borrowed_account_t` structure representing the borrowed account. Must not be null.
    - `new_len`: The new data length for the account. Must be a valid unsigned long value.
    - `err`: A pointer to an integer where the function will store the error code. Must not be null.
- **Output**: Returns 1 on success and sets `*err` to `FD_EXECUTOR_INSTR_SUCCESS`.
- **See Also**: [`fd_borrowed_account_update_accounts_resize_delta`](<fd_borrowed_account.c.md#fd_borrowed_account_update_accounts_resize_delta>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)