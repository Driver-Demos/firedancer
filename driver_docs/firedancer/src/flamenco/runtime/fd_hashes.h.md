<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for computing and updating cryptographic bank hashes for completed slots.

# Purpose
The `fd_hashes.h` header file provides functions for computing and updating cryptographic hashes related to the state of a bank slot in a blockchain system. The primary purpose of these functions is to ensure the integrity and consistency of the slot's state by generating a bank hash. This bank hash is a cryptographic hash that includes all account modifications and transaction signatures within the slot. The bank hash is computed using a combination of the previous bank hash, the number of signatures, the last blockhash, and a cumulative lattice hash (`lthash`) of all accounts.

The file defines three main functions: [`fd_hashes_account_lthash`](<#fd_hashes_account_lthash>), [`fd_hashes_update_lthash`](<#fd_hashes_update_lthash>), and [`fd_hashes_hash_bank`](<#fd_hashes_hash_bank>). The [`fd_hashes_account_lthash`](<#fd_hashes_account_lthash>) function computes the lattice hash of a single account, which is used in the bank hash calculation. The [`fd_hashes_update_lthash`](<#fd_hashes_update_lthash>) function updates the bank's incremental `lthash` when an account is modified during transaction execution. The [`fd_hashes_hash_bank`](<#fd_hashes_hash_bank>) function computes the final bank hash for a completed slot. These functions are essential for maintaining the integrity of the blockchain by ensuring that all changes to account states are accurately reflected in the bank hash.
# Imports and Dependencies

---
- `../fd_flamenco_base.h`
- `../types/fd_types.h`
- `../../ballet/lthash/fd_lthash.h`


# Function Declarations (Public API)

---
### fd\_hashes\_account\_lthash<!-- {{#callable_declaration:fd_hashes_account_lthash}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_hashes.h#L28>)

Computes the lattice hash of a single account.
- **Description**: Use this function to compute the lattice hash (lthash) of an account, which is necessary for bank hash calculations. It processes accounts with non-zero lamports by hashing their properties, while accounts with zero lamports result in a zeroed hash. Ensure all pointers provided are valid and properly aligned, and that the account data is readable for the specified length. This function is essential for maintaining accurate bank state in cryptographic operations.
- **Inputs**:
    - `pubkey`: Pointer to the account's public key, which must be 32 bytes long. The caller retains ownership and must ensure it is valid.
    - `account`: Pointer to the account metadata, which includes lamports, data length, executable flag, and owner. The caller retains ownership and must ensure it is valid.
    - `data`: Pointer to the account data, which must be readable for the number of bytes specified by `account->dlen`. The caller retains ownership and must ensure it is valid.
    - `lthash_out`: Pointer to where the computed lthash value will be written. The caller must ensure it is valid and has space for `FD_LTHASH_LEN_BYTES`.
- **Output**: On return, `lthash_out` contains the computed lthash. For zero-lamport accounts, `lthash_out` will be zeroed.
- **See Also**: [`fd_hashes_account_lthash`](<fd_hashes.c.md#fd_hashes_account_lthash>)  (Implementation)


---
### fd\_hashes\_update\_lthash<!-- {{#callable_declaration:fd_hashes_update_lthash}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_hashes.h#L85>)

Updates the bank's incremental lattice hash when an account is modified.
- **Description**: Use this function to update the bank's lattice hash when an account is modified during transaction execution. It subtracts the previous account hash from the bank's lattice hash, computes the new account hash, and adds it to the bank's lattice hash. If a capture context is provided, it writes the account state to the capture file. This function must be called whenever an account is modified, including sysvar accounts. It assumes all non-optional pointers are valid and will terminate with an error log if the capture write fails.
- **Inputs**:
    - `account`: The modified account, provided via the `fd_txn_account_t` interface. Must not be null.
    - `prev_account_hash`: The lattice hash of the account before modification. Can be zero for newly created accounts. Must not be null.
    - `bank`: The bank whose lattice hash should be updated. Must not be null.
    - `capture_ctx`: An optional capture context for recording account changes. Can be null.
- **Output**: None
- **See Also**: [`fd_hashes_update_lthash`](<fd_hashes.c.md#fd_hashes_update_lthash>)  (Implementation)


---
### fd\_hashes\_hash\_bank<!-- {{#callable_declaration:fd_hashes_hash_bank}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_hashes.h#L107>)

Computes the bank hash for a completed slot.
- **Description**: Use this function to compute a deterministic hash of a slot's state, which includes all account modifications and transaction signatures. This function is typically called after a slot is completed to generate a cryptographic hash that represents the slot's final state. The function requires valid input parameters and writes the resulting hash to the specified output location.
- **Inputs**:
    - `lthash`: The cumulative lattice hash of all accounts modified in the slot. Must not be null.
    - `prev_bank_hash`: The bank hash of the parent slot. Must not be null.
    - `last_blockhash`: The last proof-of-history blockhash. Must not be null.
    - `signature_count`: The number of signatures processed in the slot. Must be a valid unsigned long value.
    - `hash_out`: Pointer to where the computed bank hash will be written. Must not be null.
- **Output**: The resulting bank hash is written to the location pointed to by `hash_out`.
- **See Also**: [`fd_hashes_hash_bank`](<fd_hashes.c.md#fd_hashes_hash_bank>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)