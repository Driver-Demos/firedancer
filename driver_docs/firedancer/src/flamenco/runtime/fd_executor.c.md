<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements transaction execution logic, including account management, fee validation, and instruction processing for a blockchain runtime.

# Purpose
The code is a C source file that implements a transaction execution framework for a blockchain system. It includes various components and functions to manage and execute transactions, validate accounts, and handle program execution within the blockchain. The file imports several header files that define the necessary data structures and functions for transaction execution, account management, and program execution.

The primary functionality of the code revolves around executing transactions by verifying transaction signatures, setting up transaction contexts, loading transaction accounts, and executing instructions within those transactions. It defines several functions to handle different aspects of transaction processing, such as [`fd_executor_lookup_native_program`](<#fd_executor_lookup_native_program>), which looks up the appropriate instruction processor for a given native program ID, and [`fd_executor_load_transaction_accounts`](<#fd_executor_load_transaction_accounts>), which loads transaction accounts and checks their validity. The code also includes error handling and logging mechanisms to ensure that any issues during transaction execution are properly reported and managed. Overall, the code provides a comprehensive framework for executing transactions in a blockchain environment, with a focus on account management, program execution, and error handling.
# Imports and Dependencies

---
- `fd_executor.h`
- `fd_acc_mgr.h`
- `fd_bank.h`
- `fd_hashes.h`
- `fd_runtime.h`
- `fd_runtime_err.h`
- `context/fd_exec_txn_ctx.h`
- `fd_system_ids.h`
- `program/fd_address_lookup_table_program.h`
- `program/fd_bpf_loader_program.h`
- `program/fd_loader_v4_program.h`
- `program/fd_compute_budget_program.h`
- `program/fd_config_program.h`
- `program/fd_precompiles.h`
- `program/fd_stake_program.h`
- `program/fd_system_program.h`
- `program/fd_builtin_programs.h`
- `program/fd_vote_program.h`
- `program/fd_zk_elgamal_proof_program.h`
- `sysvar/fd_sysvar_cache.h`
- `sysvar/fd_sysvar_epoch_schedule.h`
- `sysvar/fd_sysvar_instructions.h`
- `sysvar/fd_sysvar_rent.h`
- `sysvar/fd_sysvar_slot_history.h`
- `tests/fd_dump_pb.h`
- `../../ballet/base58/fd_base58.h`
- `../../util/bits/fd_uwide.h`
- `assert.h`
- `math.h`
- `stdio.h`
- `fcntl.h`
- `unistd.h`
- `time.h`
- `../../util/tmpl/fd_map_perfect.c`


# Data Structures

---
### fd\_native\_prog\_info
- **Type**: ``struct``
- **Members**:
    - ``key``: Holds the public key of the program.
    - ``fn``: Stores a function pointer to the program's execution function.
    - ``is_bpf_loader``: Indicates if the program is a BPF loader with a boolean value.
- **Description**: Defines information about a native program, including its public key, execution function, and whether it is a BPF loader.


---
### fd\_native\_prog\_info\_t
- **Type**: ``struct``
- **Members**:
    - ``key``: A public key of type `fd_pubkey_t`.
    - ``fn``: A function pointer of type `fd_exec_instr_fn_t`.
    - ``is_bpf_loader``: An unsigned character indicating if the program is a BPF loader.
- **Description**: Defines a structure that holds information about a native program, including its public key, the function to execute, and whether it is a BPF loader.


# Functions

---
### fd\_executor\_lookup\_native\_precompile\_program<!-- {{#callable:fd_executor_lookup_native_precompile_program}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L104>)

Retrieves the function pointer for a native precompiled program based on the provided program account's public key.
- **Inputs**:
    - ``prog_acc``: A pointer to a `fd_txn_account_t` structure representing the program account, which contains the public key used for lookup.
- **Logic and Control Flow**:
    - Extracts the public key from the `prog_acc` structure.
    - Initializes a `fd_native_prog_info_t` structure named `null_function` with zero values.
    - Calls `fd_native_precompile_program_fn_lookup_tbl_query` with the extracted public key and `null_function` to retrieve a `fd_native_prog_info_t` structure.
    - Returns the `fn` member of the retrieved `fd_native_prog_info_t` structure, which is a function pointer.
- **Output**: A function pointer of type `fd_exec_instr_fn_t` corresponding to the native precompiled program associated with the given public key.


---
### fd\_executor\_pubkey\_is\_bpf\_loader<!-- {{#callable:fd_executor_pubkey_is_bpf_loader}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L111>)

Checks if a given public key corresponds to a BPF loader program.
- **Inputs**:
    - ``pubkey``: A pointer to a `fd_pubkey_t` structure representing the public key to check.
- **Logic and Control Flow**:
    - Defines a constant `null_function` of type `fd_native_prog_info_t` initialized to zero.
    - Calls `fd_native_program_fn_lookup_tbl_query` with `pubkey` and `null_function` to retrieve program information.
    - Returns the `is_bpf_loader` field from the retrieved program information.
- **Output**: Returns an `uchar` indicating whether the public key is associated with a BPF loader (1 if true, 0 otherwise).


---
### fd\_executor\_lookup\_native\_program<!-- {{#callable:fd_executor_lookup_native_program}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L120>)

Finds the appropriate native program function for a given program account and transaction context, checking for precompiled programs and migration status.
- **Inputs**:
    - ``prog_acc``: A pointer to a `fd_txn_account_t` structure representing the program account to be checked.
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context.
    - ``native_prog_fn``: A pointer to a `fd_exec_instr_fn_t` where the function will store the found native program function.
    - ``is_precompile``: A pointer to an `uchar` where the function will store whether the program is a precompile (1 if true, 0 if false).
- **Logic and Control Flow**:
    - Initialize `is_precompile` to 0 and attempt to find a precompiled program function using [`fd_executor_lookup_native_precompile_program`](<#fd_executor_lookup_native_precompile_program>).
    - If a precompiled program function is found, set `is_precompile` to 1 and return 0.
    - Retrieve the public key and owner of the program account.
    - Check if the program is a native program by comparing the owner with `fd_solana_native_loader_id.key`.
    - If the program is not native and a specific feature is active, check if the owner is a BPF loader; return an error if not.
    - Determine the lookup public key based on whether the program is native or not.
    - Check if the program is migrating using [`fd_is_migrating_builtin_program`](<program/fd_builtin_programs.c.md#fd_is_migrating_builtin_program>); if migrating, set `native_prog_fn` to NULL and return an error.
    - Query the native program function lookup table with the determined public key and store the result in `native_prog_fn`.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success, or an error code if the program ID is unsupported or if the program is migrating.
- **Functions Called**:
    - [`fd_executor_lookup_native_precompile_program`](<#fd_executor_lookup_native_precompile_program>)
    - [`fd_txn_account_get_owner`](<fd_txn_account.c.md#fd_txn_account_get_owner>)
    - [`fd_executor_pubkey_is_bpf_loader`](<#fd_executor_pubkey_is_bpf_loader>)
    - [`fd_is_migrating_builtin_program`](<program/fd_builtin_programs.c.md#fd_is_migrating_builtin_program>)


---
### fd\_executor\_rent\_transition\_allowed<!-- {{#callable:fd_executor_rent_transition_allowed}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L164>)

Determines if a transition between two rent states is allowed based on specific conditions.
- **Inputs**:
    - ``pre_rent_state``: A pointer to the `fd_rent_state_t` structure representing the rent state before the transition.
    - ``post_rent_state``: A pointer to the `fd_rent_state_t` structure representing the rent state after the transition.
- **Logic and Control Flow**:
    - Check the `discriminant` of `post_rent_state` to determine the target state.
    - If `post_rent_state` is `fd_rent_state_enum_uninitialized` or `fd_rent_state_enum_rent_exempt`, return 1 to allow the transition.
    - If `post_rent_state` is `fd_rent_state_enum_rent_paying`, check the `discriminant` of `pre_rent_state`.
    - If `pre_rent_state` is `fd_rent_state_enum_uninitialized` or `fd_rent_state_enum_rent_exempt`, return 0 to disallow the transition.
    - If `pre_rent_state` is `fd_rent_state_enum_rent_paying`, compare `data_size` and `lamports` of `rent_paying` in both states; return 1 if they match and `post_rent_state` has less or equal `lamports`, otherwise return 0.
    - Use `__builtin_unreachable()` for unexpected cases in both switch statements.
- **Output**: Returns an `uchar` value of 1 if the transition is allowed, otherwise 0.


---
### fd\_executor\_check\_rent\_state\_with\_account<!-- {{#callable:fd_executor_check_rent_state_with_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L194>)

Checks if a rent state transition for an account is allowed and returns an error code if not.
- **Inputs**:
    - ``account``: A pointer to an `fd_txn_account_t` structure representing the account to check.
    - ``pre_rent_state``: A pointer to an `fd_rent_state_t` structure representing the rent state of the account before the transaction.
    - ``post_rent_state``: A pointer to an `fd_rent_state_t` structure representing the rent state of the account after the transaction.
- **Logic and Control Flow**:
    - Compares the account's public key with the incinerator ID to check if it is not the incinerator account.
    - Calls [`fd_executor_rent_transition_allowed`](<#fd_executor_rent_transition_allowed>) to determine if the rent state transition from `pre_rent_state` to `post_rent_state` is allowed.
    - If the account is not the incinerator and the rent transition is not allowed, returns `FD_RUNTIME_TXN_ERR_INSUFFICIENT_FUNDS_FOR_RENT`.
    - If the conditions are not met, returns `FD_RUNTIME_EXECUTE_SUCCESS`.
- **Output**: Returns an integer error code: `FD_RUNTIME_TXN_ERR_INSUFFICIENT_FUNDS_FOR_RENT` if the rent transition is not allowed, otherwise `FD_RUNTIME_EXECUTE_SUCCESS`.
- **Functions Called**:
    - [`fd_executor_rent_transition_allowed`](<#fd_executor_rent_transition_allowed>)


---
### fd\_executor\_get\_account\_rent\_state<!-- {{#callable:fd_executor_get_account_rent_state}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L206>)

Determines the rent state of a given account based on its lamports and data size.
- **Inputs**:
    - ``account``: A pointer to a `fd_txn_account_t` structure representing the account whose rent state is to be determined.
    - ``rent``: A pointer to a `fd_rent_t` structure containing rent-related parameters.
- **Logic and Control Flow**:
    - Check if the account's lamports are zero; if true, return a rent state with `discriminant` set to `fd_rent_state_enum_uninitialized`.
    - Check if the account's lamports are greater than or equal to the rent-exempt minimum balance; if true, return a rent state with `discriminant` set to `fd_rent_state_enum_rent_exempt`.
    - If neither condition is met, return a rent state with `discriminant` set to `fd_rent_state_enum_rent_paying`, including the account's lamports and data size in the `inner.rent_paying` structure.
- **Output**: Returns a `fd_rent_state_t` structure representing the rent state of the account.
- **Functions Called**:
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_rent_exempt_minimum_balance`](<sysvar/fd_sysvar_rent1.c.md#fd_rent_exempt_minimum_balance>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)


---
### fd\_validate\_fee\_payer<!-- {{#callable:fd_validate_fee_payer}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L235>)

Validates a fee payer account for a transaction by checking account balance, system account kind, and rent state, and deducts the transaction fee if valid.
- **Inputs**:
    - ``account``: A pointer to an `fd_txn_account_t` structure representing the account to validate as the fee payer.
    - ``rent``: A constant pointer to an `fd_rent_t` structure containing rent-related information.
    - ``fee``: An unsigned long integer representing the fee amount to be deducted from the account.
    - ``exec_spad``: A pointer to an `fd_spad_t` structure used for execution context.
- **Logic and Control Flow**:
    - Check if the account has zero lamports; if true, return `FD_RUNTIME_TXN_ERR_ACCOUNT_NOT_FOUND`.
    - Determine the system account kind using [`fd_get_system_account_kind`](<program/fd_system_program.c.md#fd_get_system_account_kind>); if unknown, return `FD_RUNTIME_TXN_ERR_INVALID_ACCOUNT_FOR_FEE`.
    - Calculate the minimum balance required if the account is a nonce account.
    - Check if the account has insufficient funds for the fee, considering the minimum balance; if true, return `FD_RUNTIME_TXN_ERR_INSUFFICIENT_FUNDS_FOR_FEE`.
    - Retrieve the pre-transaction rent state of the account using [`fd_executor_get_account_rent_state`](<#fd_executor_get_account_rent_state>).
    - Attempt to deduct the fee from the account using [`fd_txn_account_checked_sub_lamports`](<fd_txn_account.c.md#fd_txn_account_checked_sub_lamports>); if unsuccessful, return `FD_RUNTIME_TXN_ERR_INSUFFICIENT_FUNDS_FOR_FEE`.
    - Retrieve the post-transaction rent state of the account.
    - Check the rent state transition using [`fd_executor_check_rent_state_with_account`](<#fd_executor_check_rent_state_with_account>) and return its result.
- **Output**: Returns an integer status code indicating success or a specific error related to account validation or fee deduction.
- **Functions Called**:
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_get_system_account_kind`](<program/fd_system_program.c.md#fd_get_system_account_kind>)
    - [`fd_rent_exempt_minimum_balance`](<sysvar/fd_sysvar_rent1.c.md#fd_rent_exempt_minimum_balance>)
    - [`fd_executor_get_account_rent_state`](<#fd_executor_get_account_rent_state>)
    - [`fd_txn_account_checked_sub_lamports`](<fd_txn_account.c.md#fd_txn_account_checked_sub_lamports>)
    - [`fd_executor_check_rent_state_with_account`](<#fd_executor_check_rent_state_with_account>)


---
### fd\_executor\_check\_status\_cache<!-- {{#callable:fd_executor_check_status_cache}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L279>)

Checks the status cache for a transaction and determines if it has already been processed.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure that contains the transaction context, including the status cache and transaction details.
- **Logic and Control Flow**:
    - If `txn_ctx->status_cache` is NULL, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - If `txn_ctx->nonce_account_idx_in_txn` is not `ULONG_MAX`, return `FD_RUNTIME_EXECUTE_SUCCESS` to skip nonce transactions.
    - Initialize a Blake3 hash context and compute the hash of the transaction message using `fd_blake3_init`, `fd_blake3_append`, and `fd_blake3_fini`.
    - Retrieve the blockhash from the transaction payload using the offset `TXN(&txn_ctx->txn)->recent_blockhash_off`.
    - Query the status cache with `fd_txncache_query` using the blockhash and the computed Blake3 hash.
    - If the transaction is found in the status cache, return `FD_RUNTIME_TXN_ERR_ALREADY_PROCESSED`.
    - Return `FD_RUNTIME_EXECUTE_SUCCESS` if the transaction is not found in the status cache.
- **Output**: Returns an integer status code: `FD_RUNTIME_EXECUTE_SUCCESS` if the transaction is not found in the status cache or if certain conditions are met to skip processing, or `FD_RUNTIME_TXN_ERR_ALREADY_PROCESSED` if the transaction is found in the status cache.


---
### fd\_executor\_check\_transaction\_age\_and\_compute\_budget\_limits<!-- {{#callable:fd_executor_check_transaction_age_and_compute_budget_limits}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L310>)

Checks the transaction age and sanitizes compute budget limits for a given transaction context.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context to be checked and sanitized.
- **Logic and Control Flow**:
    - Call [`fd_check_transaction_age`](<program/fd_system_program_nonce.c.md#fd_check_transaction_age>) with `txn_ctx` to verify the transaction age.
    - If the transaction age check fails, return the error code from [`fd_check_transaction_age`](<program/fd_system_program_nonce.c.md#fd_check_transaction_age>).
    - Call [`fd_sanitize_compute_unit_limits`](<program/fd_compute_budget_program.c.md#fd_sanitize_compute_unit_limits>) with `txn_ctx` to sanitize the compute budget limits.
    - If the compute budget limits sanitization fails, return the error code from [`fd_sanitize_compute_unit_limits`](<program/fd_compute_budget_program.c.md#fd_sanitize_compute_unit_limits>).
    - If both checks pass, return `FD_RUNTIME_EXECUTE_SUCCESS`.
- **Output**: Returns an integer status code indicating success (`FD_RUNTIME_EXECUTE_SUCCESS`) or an error code if any checks fail.
- **Functions Called**:
    - [`fd_check_transaction_age`](<program/fd_system_program_nonce.c.md#fd_check_transaction_age>)
    - [`fd_sanitize_compute_unit_limits`](<program/fd_compute_budget_program.c.md#fd_sanitize_compute_unit_limits>)


---
### get\_transaction\_account\_lock\_limit<!-- {{#callable:get_transaction_account_lock_limit}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L332>)

Determines the account lock limit for a transaction based on a feature flag in the bank context.
- **Inputs**:
    - `txn_ctx`: A pointer to a constant `fd_exec_txn_ctx_t` structure representing the transaction context, which includes the bank and other transaction-related information.
- **Logic and Control Flow**:
    - Calls `FD_FEATURE_ACTIVE_BANK` to check if the `increase_tx_account_lock_limit` feature is active for the bank in the transaction context.
    - Uses `fd_ulong_if` to return `MAX_TX_ACCOUNT_LOCKS` if the feature is active, otherwise returns `64UL`.
- **Output**: Returns an unsigned long integer representing the transaction account lock limit.


---
### fd\_executor\_check\_transactions<!-- {{#callable:fd_executor_check_transactions}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L338>)

Checks the validity of a transaction by verifying its age, compute budget limits, and status cache.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure that contains the transaction context to be checked.
- **Logic and Control Flow**:
    - Calls [`fd_executor_check_transaction_age_and_compute_budget_limits`](<#fd_executor_check_transaction_age_and_compute_budget_limits>) with `txn_ctx` to verify transaction age and compute budget limits.
    - If the result is not `FD_RUNTIME_EXECUTE_SUCCESS`, returns the error code.
    - Calls [`fd_executor_check_status_cache`](<#fd_executor_check_status_cache>) with `txn_ctx` to verify the transaction status cache.
    - If the result is not `FD_RUNTIME_EXECUTE_SUCCESS`, returns the error code.
    - Returns `FD_RUNTIME_EXECUTE_SUCCESS` if all checks pass.
- **Output**: Returns an integer status code indicating success (`FD_RUNTIME_EXECUTE_SUCCESS`) or an error code if any checks fail.
- **Functions Called**:
    - [`fd_executor_check_transaction_age_and_compute_budget_limits`](<#fd_executor_check_transaction_age_and_compute_budget_limits>)
    - [`fd_executor_check_status_cache`](<#fd_executor_check_status_cache>)


---
### fd\_executor\_verify\_transaction<!-- {{#callable:fd_executor_verify_transaction}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L366>)

Verifies a transaction by executing compute budget program instructions and returns a success or error code.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context.
- **Logic and Control Flow**:
    - Initialize `err` to `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Call [`fd_executor_compute_budget_program_execute_instructions`](<program/fd_compute_budget_program.c.md#fd_executor_compute_budget_program_execute_instructions>) with `txn_ctx` to execute compute budget program instructions.
    - If the call returns an error, return the error code.
    - Return `FD_RUNTIME_EXECUTE_SUCCESS` if no errors occur.
- **Output**: Returns an integer indicating success (`FD_RUNTIME_EXECUTE_SUCCESS`) or an error code if the compute budget program execution fails.
- **Functions Called**:
    - [`fd_executor_compute_budget_program_execute_instructions`](<program/fd_compute_budget_program.c.md#fd_executor_compute_budget_program_execute_instructions>)


---
### fd\_executor\_setup\_instr\_infos\_from\_txn\_instrs<!-- {{#callable:fd_executor_setup_instr_infos_from_txn_instrs}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L377>)

Initializes instruction information for each transaction instruction in the given transaction context.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context, which contains transaction data and will be updated with instruction information.
- **Logic and Control Flow**:
    - Retrieve the instruction count from the transaction within the `txn_ctx` using the `TXN` macro.
    - Iterate over each instruction index from 0 to `instr_cnt - 1`.
    - For each instruction, retrieve the instruction pointer from the transaction using the `TXN` macro and the current index.
    - Call [`fd_instr_info_init_from_txn_instr`](<info/fd_instr_info.c.md#fd_instr_info_init_from_txn_instr>) to initialize the instruction information for the current instruction, passing the corresponding entry in `txn_ctx->instr_infos`, the `txn_ctx`, and the instruction pointer.
    - After the loop, set `txn_ctx->instr_info_cnt` to the total number of instructions processed (`instr_cnt`).
- **Output**: No return value; updates the `instr_infos` and `instr_info_cnt` fields of the `txn_ctx` structure.
- **Functions Called**:
    - [`fd_instr_info_init_from_txn_instr`](<info/fd_instr_info.c.md#fd_instr_info_init_from_txn_instr>)


---
### accumulate\_and\_check\_loaded\_account\_data\_size<!-- {{#callable:accumulate_and_check_loaded_account_data_size}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L391>)

Accumulates the account data size and checks if it exceeds a specified limit.
- **Inputs**:
    - ``acc_size``: The size of the current account data to add.
    - ``requested_loaded_accounts_data_size``: The maximum allowed size for loaded account data.
    - ``accumulated_account_size``: A pointer to the total accumulated account data size.
- **Logic and Control Flow**:
    - Add `acc_size` to `*accumulated_account_size` using `fd_ulong_sat_add` to prevent overflow.
    - Check if the new `*accumulated_account_size` exceeds `requested_loaded_accounts_data_size`.
    - If it exceeds, return `FD_RUNTIME_TXN_ERR_MAX_LOADED_ACCOUNTS_DATA_SIZE_EXCEEDED`.
    - If it does not exceed, return `FD_RUNTIME_EXECUTE_SUCCESS`.
- **Output**: Returns an integer indicating success or an error code if the accumulated size exceeds the limit.


---
### load\_transaction\_account<!-- {{#callable:load_transaction_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L424>)

Calculates the loaded transaction account size and collects rent from writable accounts, handling special cases for sysvar instructions and unknown accounts.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) containing transaction details and execution state.
    - ``acct``: A pointer to the transaction account (`fd_txn_account_t`) to be processed.
    - ``is_writable``: A `uchar` indicating if the account is writable (non-zero) or not (zero).
    - ``unknown_acc``: A `uchar` indicating if the account is unknown (non-zero) or not (zero).
- **Logic and Control Flow**:
    - Checks if the account is the sysvar instructions account by comparing its public key with `fd_sysvar_instructions_id.key`.
    - If it is the sysvar instructions account, serializes the account and returns a loaded size cost of 0.
    - If the account is not unknown, calculates a base account size based on the `formalize_loaded_transaction_data_size` feature flag.
    - If the account is writable, retrieves and stores the starting lamports of the account.
    - Returns the sum of the base account size and the account's data length.
    - If the account is unknown, returns a loaded size cost of 0, as unknown accounts are already set up elsewhere.
- **Output**: Returns an `ulong` representing the loaded transaction account size, which is used for accumulating and checking against the transaction's loaded account data size limit.
- **Functions Called**:
    - [`fd_sysvar_instructions_serialize_account`](<sysvar/fd_sysvar_instructions.c.md#fd_sysvar_instructions_serialize_account>)
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)


---
### fd\_executor\_load\_transaction\_accounts\_old<!-- {{#callable:fd_executor_load_transaction_accounts_old}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L480>)

Loads transaction accounts and validates them against specific criteria, including checking account existence, writability, and program ownership.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure that contains the transaction context, including account details and compute budget limits.
- **Logic and Control Flow**:
    - Initialize `requested_loaded_accounts_data_size` from `txn_ctx`'s compute budget details.
    - Iterate over each account in `txn_ctx->accounts` to check if the account is unknown or has zero lamports, and determine if it is writable.
    - For the fee payer account, accumulate and check its data size separately, skipping further processing if successful.
    - For other accounts, load the account data and accumulate its size, returning an error if the size exceeds the limit.
    - Initialize `validated_loaders` array to track unique program loaders.
    - Iterate over each instruction in the transaction to validate program accounts, ensuring they exist, are executable, and are not duplicated in `validated_loaders`.
    - Return success if all accounts and instructions are validated without errors.
- **Output**: Returns an integer status code, `FD_RUNTIME_EXECUTE_SUCCESS` on success, or an error code if any validation fails.
- **Functions Called**:
    - [`fd_exec_txn_ctx_get_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>)
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_exec_txn_ctx_account_is_writable_idx`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_account_is_writable_idx>)
    - [`accumulate_and_check_loaded_account_data_size`](<#accumulate_and_check_loaded_account_data_size>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)
    - [`load_transaction_account`](<#load_transaction_account>)
    - [`fd_txn_account_is_executable`](<fd_txn_account.c.md#fd_txn_account_is_executable>)
    - [`fd_txn_account_get_owner`](<fd_txn_account.c.md#fd_txn_account_get_owner>)
    - [`fd_txn_account_init_from_funk_readonly`](<fd_txn_account.c.md#fd_txn_account_init_from_funk_readonly>)


---
### fd\_increase\_calculated\_data\_size<!-- {{#callable:fd_increase_calculated_data_size}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L610>)

Increases the `loaded_accounts_data_size` in the transaction context by a specified delta, ensuring it does not exceed limits.
- **Inputs**:
    - ``txn_ctx``: A pointer to the `fd_exec_txn_ctx_t` structure representing the transaction context.
    - ``data_size_delta``: An unsigned long integer representing the amount by which to increase the `loaded_accounts_data_size`.
- **Logic and Control Flow**:
    - Check if `data_size_delta` exceeds `UINT_MAX`; if true, return `FD_RUNTIME_TXN_ERR_MAX_LOADED_ACCOUNTS_DATA_SIZE_EXCEEDED`.
    - Add `data_size_delta` to `txn_ctx->loaded_accounts_data_size` using `fd_ulong_sat_add`.
    - Check if the updated `loaded_accounts_data_size` exceeds `txn_ctx->compute_budget_details.loaded_accounts_data_size_limit`; if true, return `FD_RUNTIME_TXN_ERR_MAX_LOADED_ACCOUNTS_DATA_SIZE_EXCEEDED`.
    - Return `FD_RUNTIME_EXECUTE_SUCCESS` if all checks pass.
- **Output**: Returns an integer status code: `FD_RUNTIME_EXECUTE_SUCCESS` on success, or `FD_RUNTIME_TXN_ERR_MAX_LOADED_ACCOUNTS_DATA_SIZE_EXCEEDED` if limits are exceeded.


---
### fd\_collect\_loaded\_account<!-- {{#callable:fd_collect_loaded_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L630>)

Ensures that loader v3 programdata accounts are accounted for exactly once in the account loading logic.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) that contains transaction-related data.
    - ``account``: A constant pointer to the transaction account (`fd_txn_account_t`) being processed.
    - ``loaded_acc_size``: The size of the loaded account data in bytes.
    - ``additional_loaded_account_keys``: A pointer to an array of public keys (`fd_pubkey_t`) for additional loaded accounts.
    - ``additional_loaded_account_keys_cnt``: A pointer to a counter (`ulong`) that tracks the number of additional loaded account keys.
- **Logic and Control Flow**:
    - Call [`fd_increase_calculated_data_size`](<#fd_increase_calculated_data_size>) to increase the calculated data size by `loaded_acc_size` and check for errors.
    - If the account owner does not match `fd_solana_bpf_loader_upgradeable_program_id.key`, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Retrieve the program state using `fd_bpf_loader_program_get_state`; if unsuccessful, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Check if the account is a v3 program using `fd_bpf_upgradeable_loader_state_is_program`; if not, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Iterate through `txn_ctx->account_keys` to ensure the programdata account is not already present; if found, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Iterate through `additional_loaded_account_keys` to ensure the programdata account is not already counted; if found, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Initialize the programdata account from Funk using [`fd_txn_account_init_from_funk_readonly`](<fd_txn_account.c.md#fd_txn_account_init_from_funk_readonly>); if unsuccessful, return `FD_RUNTIME_EXECUTE_SUCCESS`.
    - Calculate the programdata size delta and call [`fd_increase_calculated_data_size`](<#fd_increase_calculated_data_size>) to add it to the calculated data size, checking for errors.
    - Copy the programdata address to `additional_loaded_account_keys` and increment `additional_loaded_account_keys_cnt`.
- **Output**: Returns `FD_RUNTIME_EXECUTE_SUCCESS` on success or an error code if a failure occurs during processing.
- **Functions Called**:
    - [`fd_increase_calculated_data_size`](<#fd_increase_calculated_data_size>)
    - [`fd_txn_account_get_owner`](<fd_txn_account.c.md#fd_txn_account_get_owner>)
    - [`fd_txn_account_init_from_funk_readonly`](<fd_txn_account.c.md#fd_txn_account_init_from_funk_readonly>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)


---
### fd\_executor\_load\_transaction\_accounts\_simd\_186<!-- {{#callable:fd_executor_load_transaction_accounts_simd_186}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L725>)

Loads transaction accounts, calculates data sizes, collects rent, and validates program execution conditions for a transaction.
- **Inputs**:
    - ``txn_ctx``: A pointer to the `fd_exec_txn_ctx_t` structure representing the transaction context.
- **Logic and Control Flow**:
    - Initialize an array `additional_loaded_account_keys` to track programdata accounts loaded by the transaction.
    - Calculate the base fee for each address lookup table and increase the calculated data size in `txn_ctx`.
    - Iterate over each account in `txn_ctx->accounts`, checking if it is unknown or writable, and handle the fee payer account separately.
    - For each account, load the transaction account and collect the loaded account size, updating `additional_loaded_account_keys` if necessary.
    - Iterate over each instruction in the transaction, ensuring the program account exists, is executable, and is owned by a valid loader.
    - Return `FD_RUNTIME_EXECUTE_SUCCESS` if all operations are successful, or an error code if any step fails.
- **Output**: Returns an integer status code indicating success (`FD_RUNTIME_EXECUTE_SUCCESS`) or an error code if an operation fails.
- **Functions Called**:
    - [`fd_increase_calculated_data_size`](<#fd_increase_calculated_data_size>)
    - [`fd_exec_txn_ctx_get_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>)
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_exec_txn_ctx_account_is_writable_idx`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_account_is_writable_idx>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)
    - [`fd_collect_loaded_account`](<#fd_collect_loaded_account>)
    - [`load_transaction_account`](<#load_transaction_account>)
    - [`fd_txn_account_is_executable`](<fd_txn_account.c.md#fd_txn_account_is_executable>)
    - [`fd_txn_account_get_owner`](<fd_txn_account.c.md#fd_txn_account_get_owner>)
    - [`fd_executor_pubkey_is_bpf_loader`](<#fd_executor_pubkey_is_bpf_loader>)


---
### fd\_executor\_load\_transaction\_accounts<!-- {{#callable:fd_executor_load_transaction_accounts}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L821>)

Loads transaction accounts based on the active bank feature flag.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context.
- **Logic and Control Flow**:
    - Checks if the `formalize_loaded_transaction_data_size` feature is active in the bank associated with `txn_ctx`.
    - If the feature is active, calls [`fd_executor_load_transaction_accounts_simd_186`](<#fd_executor_load_transaction_accounts_simd_186>) with `txn_ctx`.
    - If the feature is not active, calls [`fd_executor_load_transaction_accounts_old`](<#fd_executor_load_transaction_accounts_old>) with `txn_ctx`.
- **Output**: Returns an integer status code indicating the success or failure of loading transaction accounts.
- **Functions Called**:
    - [`fd_executor_load_transaction_accounts_simd_186`](<#fd_executor_load_transaction_accounts_simd_186>)
    - [`fd_executor_load_transaction_accounts_old`](<#fd_executor_load_transaction_accounts_old>)


---
### fd\_executor\_validate\_account\_locks<!-- {{#callable:fd_executor_validate_account_locks}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L831>)

Validates that the number of account keys in a transaction does not exceed the lock limit and checks for duplicate account keys.
- **Inputs**:
    - ``txn_ctx``: A pointer to a constant `fd_exec_txn_ctx_t` structure representing the transaction context, which contains information about the transaction being processed.
- **Logic and Control Flow**:
    - Retrieve the transaction account lock limit using [`get_transaction_account_lock_limit`](<#get_transaction_account_lock_limit>) with `txn_ctx` as input.
    - Check if the number of account keys (`txn_ctx->accounts_cnt`) exceeds the transaction lock limit (`tx_account_lock_limit`).
    - If the number of account keys exceeds the limit, return `FD_RUNTIME_TXN_ERR_TOO_MANY_ACCOUNT_LOCKS`.
    - Iterate over each account key in `txn_ctx->account_keys` to check for duplicates.
    - For each pair of account keys, compare them using `memcmp` to detect duplicates.
    - If a duplicate is found, return `FD_RUNTIME_TXN_ERR_ACCOUNT_LOADED_TWICE`.
    - If no errors are found, return `FD_RUNTIME_EXECUTE_SUCCESS`.
- **Output**: Returns an integer status code: `FD_RUNTIME_EXECUTE_SUCCESS` if validation passes, `FD_RUNTIME_TXN_ERR_TOO_MANY_ACCOUNT_LOCKS` if the account lock limit is exceeded, or `FD_RUNTIME_TXN_ERR_ACCOUNT_LOADED_TWICE` if duplicate account keys are detected.
- **Functions Called**:
    - [`get_transaction_account_lock_limit`](<#get_transaction_account_lock_limit>)


---
### fd\_get\_prioritization\_fee<!-- {{#callable:fd_get_prioritization_fee}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L855>)

Calculates the prioritization fee based on compute budget details.
- **Inputs**:
    - `compute_budget_details`: A pointer to a `fd_compute_budget_details_t` structure containing the compute unit price and compute unit limit.
- **Logic and Control Flow**:
    - Multiply `compute_budget_details->compute_unit_price` by `compute_budget_details->compute_unit_limit` to get `micro_lamport_fee`.
    - Add `MICRO_LAMPORTS_PER_LAMPORT-1UL` to `micro_lamport_fee` and divide by `MICRO_LAMPORTS_PER_LAMPORT` to calculate `fee`.
    - Check if `fee` exceeds `ULONG_MAX`; if so, return `ULONG_MAX`, otherwise cast `fee` to `ulong` and return it.
- **Output**: Returns the calculated prioritization fee as an `ulong`, capped at `ULONG_MAX`.


---
### fd\_executor\_lamports\_per\_signature<!-- {{#callable:fd_executor_lamports_per_signature}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L862>)

Calculates half of the `target_lamports_per_signature` from the given `fee_rate_governor`.
- **Inputs**:
    - `fee_rate_governor`: A pointer to a constant `fd_fee_rate_governor_t` structure that contains the `target_lamports_per_signature` field.
- **Logic and Control Flow**:
    - Access the `target_lamports_per_signature` field from the `fee_rate_governor` structure.
    - Divide the `target_lamports_per_signature` by 2.
    - Return the result of the division.
- **Output**: Returns an unsigned long integer representing half of the `target_lamports_per_signature`.


---
### fd\_executor\_calculate\_fee<!-- {{#callable:fd_executor_calculate_fee}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L868>)

Calculates the execution and priority fees for a transaction based on the number of signatures and compute budget details.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) containing transaction-related data and state.
    - ``txn_descriptor``: A constant pointer to the transaction descriptor (`fd_txn_t`) that provides details about the transaction, including the number of signatures and instructions.
    - ``payload``: A constant pointer to the payload data (`uchar`) associated with the transaction, used to access instruction data.
    - ``ret_execution_fee``: A pointer to an unsigned long where the calculated execution fee will be stored.
    - ``ret_priority_fee``: A pointer to an unsigned long where the calculated priority fee will be stored.
- **Logic and Control Flow**:
    - Initialize `num_signatures` with the number of signatures from `txn_descriptor->signature_cnt`.
    - Iterate over each instruction in `txn_descriptor->instr` to check if the program ID matches specific cryptographic program IDs.
    - If a matching program ID is found and the instruction has data, increment `num_signatures` by the value of the first byte of the instruction's data.
    - Calculate the execution fee by multiplying the number of signatures by the lamports per signature obtained from [`fd_executor_lamports_per_signature`](<#fd_executor_lamports_per_signature>).
    - Calculate the priority fee using [`fd_get_prioritization_fee`](<#fd_get_prioritization_fee>) based on the compute budget details in `txn_ctx`.
    - Store the calculated execution fee in `ret_execution_fee` and the priority fee in `ret_priority_fee`.
- **Output**: The function outputs the calculated execution fee and priority fee by storing them in the provided pointers `ret_execution_fee` and `ret_priority_fee`.
- **Functions Called**:
    - [`fd_executor_lamports_per_signature`](<#fd_executor_lamports_per_signature>)
    - [`fd_get_prioritization_fee`](<#fd_get_prioritization_fee>)


---
### fd\_executor\_create\_rollback\_fee\_payer\_account<!-- {{#callable:fd_executor_create_rollback_fee_payer_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L914>)

Creates a rollback account for the fee payer and deducts transaction fees from it.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) containing transaction details and account information.
    - ``total_fee``: The total fee amount (`ulong`) to be deducted from the fee payer's account.
- **Logic and Control Flow**:
    - Retrieve the fee payer's public key from the transaction context using the index `FD_FEE_PAYER_TXN_IDX`.
    - Check if the fee payer is also the nonce account by comparing `txn_ctx->nonce_account_idx_in_txn` with `FD_FEE_PAYER_TXN_IDX`.
    - If the fee payer is the nonce account, set `rollback_fee_payer_acc` to `txn_ctx->rollback_nonce_account`.
    - If the fee payer is not the nonce account, retrieve the account metadata using [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>) and allocate memory for the fee payer's data using `fd_spad_alloc`.
    - Copy the account metadata and data into the allocated memory using `fd_memcpy`.
    - Create a new transaction account for the rollback fee payer using [`fd_txn_account_new`](<fd_txn_account.c.md#fd_txn_account_new>) and join it to the workspace using [`fd_txn_account_join`](<fd_txn_account.c.md#fd_txn_account_join>).
    - Set `rollback_fee_payer_acc` to `txn_ctx->rollback_fee_payer_account`.
    - Deduct the transaction fees from `rollback_fee_payer_acc` using [`fd_txn_account_checked_sub_lamports`](<fd_txn_account.c.md#fd_txn_account_checked_sub_lamports>).
    - Log an error if fee deduction fails, although prior checks should prevent this.
- **Output**: No return value; the function modifies the transaction context to set up the rollback fee payer account and deduct fees.
- **Functions Called**:
    - [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)
    - [`fd_txn_account_join`](<fd_txn_account.c.md#fd_txn_account_join>)
    - [`fd_txn_account_new`](<fd_txn_account.c.md#fd_txn_account_new>)
    - [`fd_txn_account_checked_sub_lamports`](<fd_txn_account.c.md#fd_txn_account_checked_sub_lamports>)


---
### fd\_executor\_validate\_transaction\_fee\_payer<!-- {{#callable:fd_executor_validate_transaction_fee_payer}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L957>)

Validates the transaction fee payer by checking account existence, calculating fees, validating the fee payer, creating a rollback account, and setting initial lamports.
- **Inputs**:
    - ``txn_ctx``: A pointer to the `fd_exec_txn_ctx_t` structure representing the transaction context.
- **Logic and Control Flow**:
    - Retrieve the fee payer account record using [`fd_exec_txn_ctx_get_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>) and check if it is writable.
    - If the account retrieval fails, return `FD_RUNTIME_TXN_ERR_ACCOUNT_NOT_FOUND`.
    - Calculate the execution and priority fees using [`fd_executor_calculate_fee`](<#fd_executor_calculate_fee>).
    - Sum the execution and priority fees to get the total fee.
    - If the feature `remove_rounding_in_fee_calculation` is not active, round the total fee.
    - Validate the fee payer using [`fd_validate_fee_payer`](<#fd_validate_fee_payer>) with the calculated total fee.
    - If validation fails, return the error code from [`fd_validate_fee_payer`](<#fd_validate_fee_payer>).
    - Create a rollback account for the fee payer using [`fd_executor_create_rollback_fee_payer_account`](<#fd_executor_create_rollback_fee_payer_account>).
    - Set the starting lamports of the fee payer account to avoid unbalanced lamports issues.
    - Store the calculated execution and priority fees in the transaction context.
- **Output**: Returns `FD_RUNTIME_EXECUTE_SUCCESS` on successful validation or an error code if validation fails.
- **Functions Called**:
    - [`fd_exec_txn_ctx_get_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>)
    - [`fd_executor_calculate_fee`](<#fd_executor_calculate_fee>)
    - [`fd_validate_fee_payer`](<#fd_validate_fee_payer>)
    - [`fd_executor_create_rollback_fee_payer_account`](<#fd_executor_create_rollback_fee_payer_account>)
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)


---
### fd\_executor\_setup\_txn\_account\_keys<!-- {{#callable:fd_executor_setup_txn_account_keys}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1002>)

Unpacks account keys from a serialized transaction and sets them in the transaction context.
- **Inputs**:
    - `txn_ctx`: A pointer to `fd_exec_txn_ctx_t`, which is the transaction context containing transaction details and account information.
- **Logic and Control Flow**:
    - Retrieve the account address count from the transaction and store it in `txn_ctx->accounts_cnt`.
    - Calculate the starting address of the transaction accounts in the payload using the offset `acct_addr_off`.
    - Iterate over each account address count and copy the public key from the transaction payload to `txn_ctx->account_keys`.
- **Output**: No return value; the function modifies the `txn_ctx` structure in place.


---
### fd\_executor\_setup\_txn\_alut\_account\_keys<!-- {{#callable:fd_executor_setup_txn_alut_account_keys}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1016>)

Resolves address lookup tables in a transaction and updates the transaction's account keys accordingly.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context.
- **Logic and Control Flow**:
    - Check if the transaction version is `FD_TXN_V0`.
    - If true, query the system variable cache using `fd_bank_sysvar_cache_query` to get `sysvar_cache`.
    - Join the slot hashes from the system variable cache using [`fd_sysvar_cache_slot_hashes_join_const`](<sysvar/fd_sysvar_cache.c.md#fd_sysvar_cache_slot_hashes_join_const>).
    - If `slot_hashes` is NULL, return `FD_RUNTIME_TXN_ERR_ACCOUNT_NOT_FOUND`.
    - Cast the address of the next available account key in `txn_ctx->account_keys` to `fd_acct_addr_t *` and store it in `accts_alt`.
    - Call [`fd_runtime_load_txn_address_lookup_tables`](<fd_runtime.c.md#fd_runtime_load_txn_address_lookup_tables>) to load the address lookup tables into `accts_alt`.
    - Leave the slot hashes using [`fd_sysvar_cache_slot_hashes_leave_const`](<sysvar/fd_sysvar_cache.c.md#fd_sysvar_cache_slot_hashes_leave_const>).
    - Increment `txn_ctx->accounts_cnt` by the additional count of address lookup tables.
    - If an error occurs during loading, return the error code.
    - Return `FD_RUNTIME_EXECUTE_SUCCESS` if no errors occur.
- **Output**: Returns `FD_RUNTIME_EXECUTE_SUCCESS` on success or an error code if an error occurs.
- **Functions Called**:
    - [`fd_sysvar_cache_slot_hashes_join_const`](<sysvar/fd_sysvar_cache.c.md#fd_sysvar_cache_slot_hashes_join_const>)
    - [`fd_runtime_load_txn_address_lookup_tables`](<fd_runtime.c.md#fd_runtime_load_txn_address_lookup_tables>)
    - [`fd_sysvar_cache_slot_hashes_leave_const`](<sysvar/fd_sysvar_cache.c.md#fd_sysvar_cache_slot_hashes_leave_const>)


---
### fd\_txn\_ctx\_push<!-- {{#callable:fd_txn_ctx_push}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1043>)

Pushes an instruction onto the transaction context stack, ensuring lamport sums are balanced and stack limits are not exceeded.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) where the instruction will be pushed.
    - ``instr``: A pointer to the instruction information (`fd_instr_info_t`) to be pushed onto the stack.
- **Logic and Control Flow**:
    - Initialize `starting_lamports_h` and `starting_lamports_l` to zero.
    - Call [`fd_instr_info_sum_account_lamports`](<info/fd_instr_info.c.md#fd_instr_info_sum_account_lamports>) to calculate the sum of lamports for the instruction and store the result in `starting_lamports_h` and `starting_lamports_l`.
    - If the sum calculation returns an error, return the error code.
    - Assign the calculated lamport sums to `instr->starting_lamports_h` and `instr->starting_lamports_l`.
    - If the instruction stack size is greater than zero, retrieve the caller's instruction context and verify that the caller's lamport sum has not changed.
    - If the caller's lamport sum has changed, return `FD_EXECUTOR_INSTR_ERR_UNBALANCED_INSTR`.
    - Check if the instruction trace length exceeds `FD_MAX_INSTRUCTION_TRACE_LENGTH` and return `FD_EXECUTOR_INSTR_ERR_MAX_INSN_TRACE_LENS_EXCEEDED` if true.
    - Increment the instruction trace length.
    - Check if the instruction stack size exceeds `FD_MAX_INSTRUCTION_STACK_DEPTH` and return `FD_EXECUTOR_INSTR_ERR_CALL_DEPTH` if true.
    - Increment the instruction stack size.
    - Find the index of the sysvar instructions account using [`fd_exec_txn_ctx_find_index_of_account`](<context/fd_exec_txn_ctx.h.md#fd_exec_txn_ctx_find_index_of_account>).
    - If the sysvar instructions account is found, retrieve it and attempt to borrow it mutably.
    - If borrowing fails, return `FD_EXECUTOR_INSTR_ERR_ACC_BORROW_FAILED`.
    - Update the current instruction index in the sysvar instructions account and drop the account.
- **Output**: Returns `FD_EXECUTOR_INSTR_SUCCESS` on success, or an error code if any checks fail.
- **Functions Called**:
    - [`fd_instr_info_sum_account_lamports`](<info/fd_instr_info.c.md#fd_instr_info_sum_account_lamports>)
    - [`fd_exec_txn_ctx_find_index_of_account`](<context/fd_exec_txn_ctx.h.md#fd_exec_txn_ctx_find_index_of_account>)
    - [`fd_exec_txn_ctx_get_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_account_at_index>)
    - [`fd_txn_account_try_borrow_mut`](<fd_txn_account.c.md#fd_txn_account_try_borrow_mut>)
    - [`fd_sysvar_instructions_update_current_instr_idx`](<sysvar/fd_sysvar_instructions.c.md#fd_sysvar_instructions_update_current_instr_idx>)
    - [`fd_txn_account_drop`](<fd_txn_account.c.md#fd_txn_account_drop>)


---
### fd\_instr\_stack\_push<!-- {{#callable:fd_instr_stack_push}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1129>)

Pushes a new instruction onto the instruction stack and checks for reentrancy violations.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) that contains the current state of the transaction execution.
    - ``instr``: A pointer to the instruction information (`fd_instr_info_t`) that needs to be pushed onto the stack.
- **Logic and Control Flow**:
    - Retrieve the program ID public key for the instruction using [`fd_exec_txn_ctx_get_key_of_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>).
    - If the retrieval fails, return `FD_EXECUTOR_INSTR_ERR_UNSUPPORTED_PROGRAM_ID`.
    - Check if the instruction stack size is greater than zero.
    - If so, iterate over the existing instructions in the stack to check for reentrancy by comparing program IDs.
    - If a reentrancy violation is detected (i.e., the program ID is found in the stack but is not the last instruction), return `FD_EXECUTOR_INSTR_ERR_REENTRANCY_NOT_ALLOWED`.
    - If no violations are found, push the instruction onto the stack by incrementing the stack and trace size counters.
    - Call [`fd_txn_ctx_push`](<#fd_txn_ctx_push>) to finalize the push operation.
- **Output**: Returns an integer status code indicating success or the type of error encountered, such as unsupported program ID or reentrancy not allowed.
- **Functions Called**:
    - [`fd_exec_txn_ctx_get_key_of_account_at_index`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_get_key_of_account_at_index>)
    - [`fd_txn_ctx_push`](<#fd_txn_ctx_push>)


---
### fd\_instr\_stack\_pop<!-- {{#callable:fd_instr_stack_pop}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1183>)

Pops an instruction from the instruction stack, verifies account references and lamport balance, and returns a status code.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) which contains the instruction stack and other transaction-related data.
    - ``instr``: A pointer to the instruction information (`fd_instr_info_t const *`) that is being popped from the stack.
- **Logic and Control Flow**:
    - Check if the instruction stack size in `txn_ctx` is zero; if so, return `FD_EXECUTOR_INSTR_ERR_CALL_DEPTH`.
    - Decrement the instruction stack size in `txn_ctx`.
    - Iterate over each account in `instr` to verify that executable accounts have no outstanding references; if any do, return `FD_EXECUTOR_INSTR_ERR_ACC_BORROW_OUTSTANDING`.
    - Calculate the ending lamports for the instruction using [`fd_instr_info_sum_account_lamports`](<info/fd_instr_info.c.md#fd_instr_info_sum_account_lamports>) and compare with the starting lamports; if they do not match, return `FD_EXECUTOR_INSTR_ERR_UNBALANCED_INSTR`.
    - If all checks pass, return `FD_EXECUTOR_INSTR_SUCCESS`.
- **Output**: Returns an integer status code indicating success (`FD_EXECUTOR_INSTR_SUCCESS`) or a specific error code if a check fails.
- **Functions Called**:
    - [`fd_txn_account_is_executable`](<fd_txn_account.c.md#fd_txn_account_is_executable>)
    - [`fd_txn_account_is_borrowed`](<fd_txn_account.c.md#fd_txn_account_is_borrowed>)
    - [`fd_instr_info_sum_account_lamports`](<info/fd_instr_info.c.md#fd_instr_info_sum_account_lamports>)


---
### fd\_execute\_instr\_end<!-- {{#callable:fd_execute_instr_end}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1224>)

Handles the end of an instruction execution by popping the instruction stack and updating the execution result based on stack pop errors.
- **Inputs**:
    - ``instr_ctx``: A pointer to the `fd_exec_instr_ctx_t` structure representing the current instruction context.
    - ``instr``: A pointer to the `fd_instr_info_t` structure representing the instruction information.
    - ``instr_exec_result``: An integer representing the result of the instruction execution.
- **Logic and Control Flow**:
    - Call [`fd_instr_stack_pop`](<#fd_instr_stack_pop>) to pop the instruction from the stack and store the result in `stack_pop_err`.
    - Check if `instr_exec_result` is `FD_EXECUTOR_INSTR_SUCCESS` and `stack_pop_err` is non-zero; if true, overwrite the transaction context error and set `instr_exec_result` to `stack_pop_err`.
    - Check if `instr_exec_result` is non-zero and `failed_instr` in the transaction context is not set; if true, set `failed_instr` to `instr_ctx`.
    - Return `instr_exec_result`.
- **Output**: Returns an integer representing the final execution result of the instruction, potentially modified by stack pop errors.
- **Functions Called**:
    - [`fd_instr_stack_pop`](<#fd_instr_stack_pop>)


---
### fd\_execute\_instr<!-- {{#callable:fd_execute_instr}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1244>)

Executes a given instruction within a transaction context, handling native program lookup, execution, and error logging.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction execution context (`fd_exec_txn_ctx_t`) that contains the state and data for the transaction being processed.
    - ``instr``: A pointer to the instruction information (`fd_instr_info_t`) that specifies the instruction to be executed.
- **Logic and Control Flow**:
    - Queries the system variable cache using the bank from the transaction context.
    - Begins a stack frame for the transaction context's scratchpad memory.
    - Attempts to push the instruction onto the instruction stack; if unsuccessful, logs the error and returns the result.
    - Initializes an execution context for the instruction with the transaction context, instruction, and system variable cache.
    - Encodes the program ID of the instruction's account into Base58 format and stores it in the execution context.
    - Updates the instruction trace with the current instruction and stack height.
    - Looks up the native program function for the instruction's program ID, checking for precompiled programs as well.
    - If the lookup fails, logs the error and returns the error code.
    - If a native program function is found, logs the program invocation and resets return data if the program is not a precompile.
    - Executes the native program function and stores the result.
    - If the program function is not found, logs an unsupported program ID error and returns the result of [`fd_execute_instr_end`](<#fd_execute_instr_end>).
    - Logs the success or failure of the program execution, handling errors and logging them appropriately.
    - Ends the stack frame and returns the result of [`fd_execute_instr_end`](<#fd_execute_instr_end>).
- **Output**: Returns an integer representing the result of the instruction execution, with specific error codes for different failure scenarios.
- **Functions Called**:
    - [`fd_instr_stack_push`](<#fd_instr_stack_push>)
    - [`fd_executor_lookup_native_program`](<#fd_executor_lookup_native_program>)
    - [`fd_exec_txn_ctx_reset_return_data`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_reset_return_data>)
    - [`fd_execute_instr_end`](<#fd_execute_instr_end>)


---
### fd\_executor\_reclaim\_account<!-- {{#callable:fd_executor_reclaim_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1334>)

Reclaims an account by setting its slot and clearing its data and owner if its lamports are zero.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context.
    - ``account``: A pointer to a `fd_txn_account_t` structure representing the account to be reclaimed.
- **Logic and Control Flow**:
    - Sets the slot of the `account` to the slot from `txn_ctx`.
    - Checks if the lamports of the `account` are zero using [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>).
    - If the lamports are zero, sets the data length of the `account` to zero using [`fd_txn_account_set_data_len`](<fd_txn_account.c.md#fd_txn_account_set_data_len>).
    - Clears the owner of the `account` using [`fd_txn_account_clear_owner`](<fd_txn_account.c.md#fd_txn_account_clear_owner>).
- **Output**: No return value (void function).
- **Functions Called**:
    - [`fd_txn_account_set_slot`](<fd_txn_account.c.md#fd_txn_account_set_slot>)
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_txn_account_set_data_len`](<fd_txn_account.c.md#fd_txn_account_set_data_len>)
    - [`fd_txn_account_clear_owner`](<fd_txn_account.c.md#fd_txn_account_clear_owner>)


---
### fd\_exec\_txn\_ctx\_setup<!-- {{#callable:fd_exec_txn_ctx_setup}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1344>)

Initializes the transaction execution context by setting up various components such as the account database, program cache, transaction ID, status cache, and bank-related settings.
- **Inputs**:
    - ``bank``: A pointer to an `fd_bank_t` structure representing the bank associated with the transaction.
    - ``accdb_shfunk``: A pointer to the shared function for accessing the account database.
    - ``progcache_shfunk``: A pointer to the shared function for accessing the program cache.
    - ``xid``: A constant pointer to an `fd_funk_txn_xid_t` structure representing the transaction ID.
    - ``status_cache``: A pointer to an `fd_txncache_t` structure used for caching transaction statuses.
    - ``ctx``: A pointer to an `fd_exec_txn_ctx_t` structure where the transaction execution context will be set up.
    - ``bank_hash_cmp``: A pointer to an `fd_bank_hash_cmp_t` structure used for comparing bank hashes.
    - ``progcache_scratch``: A pointer to a scratch space used by the program cache.
    - ``progcache_scratch_sz``: An unsigned long integer representing the size of the scratch space for the program cache.
- **Logic and Control Flow**:
    - Attempts to join the account database using `fd_funk_join` and logs a critical error if it fails.
    - If `progcache_shfunk` is provided, attempts to join the program cache using `fd_progcache_join` and logs a critical error if it fails.
    - Copies the transaction ID from `xid` to `ctx->xid`.
    - Sets the `status_cache` in the context to the provided `status_cache`.
    - Sets the `bank_hash_cmp` in the context to the provided `bank_hash_cmp`.
    - Enables execution recording in the context if the bank's flags include `FD_BANK_FLAGS_EXEC_RECORDING`.
    - Sets the `bank` in the context to the provided `bank`.
    - Retrieves and sets the current slot from the bank using `fd_bank_slot_get`.
    - Retrieves and sets the bank features using `fd_bank_features_get`.
- **Output**: The function does not return a value; it sets up the provided `fd_exec_txn_ctx_t` structure with the necessary context for transaction execution.


---
### fd\_executor\_setup\_txn\_account<!-- {{#callable:fd_executor_setup_txn_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1380>)

Sets up a transaction account by retrieving a read-only handle from the database and preparing it for transaction processing.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) containing transaction-related data and state.
    - ``idx``: An unsigned short integer representing the index of the account to set up within the transaction context.
- **Logic and Control Flow**:
    - Retrieve the public key of the account from `txn_ctx->account_keys` using the provided `idx`.
    - Attempt to get a read-only handle to the account metadata from the database using [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>).
    - Check for errors in retrieving the account metadata, logging a critical error if an unexpected error occurs.
    - Determine if the account is writable by checking if it is marked writable in the transaction context or if it is the fee payer.
    - If the account is writable, allocate memory for a staging area and copy existing account data or initialize new metadata if the account does not exist.
    - If the account is not writable, use the read-only metadata if available, or initialize new metadata if the account does not exist.
    - Join the transaction account with the workspace, logging a critical error if this fails.
    - Return the pointer to the set-up transaction account.
- **Output**: A pointer to the set-up transaction account (`fd_txn_account_t *`).
- **Functions Called**:
    - [`fd_funk_get_acc_meta_readonly`](<fd_acc_mgr.c.md#fd_funk_get_acc_meta_readonly>)
    - [`fd_exec_txn_ctx_account_is_writable_idx`](<context/fd_exec_txn_ctx.c.md#fd_exec_txn_ctx_account_is_writable_idx>)
    - [`fd_account_meta_init`](<fd_acc_mgr.h.md#fd_account_meta_init>)
    - [`fd_txn_account_join`](<fd_txn_account.c.md#fd_txn_account_join>)
    - [`fd_txn_account_new`](<fd_txn_account.c.md#fd_txn_account_new>)


---
### fd\_executor\_setup\_executable\_account<!-- {{#callable:fd_executor_setup_executable_account}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1458>)

Sets up an executable account in the transaction context if it is a valid BPF program.
- **Inputs**:
    - ``txn_ctx``: A pointer to the transaction context (`fd_exec_txn_ctx_t`) where the executable account will be set up.
    - ``account``: A constant pointer to the transaction account (`fd_txn_account_t`) to be checked and potentially set up as executable.
    - ``executable_idx``: A pointer to an unsigned short that tracks the index of the next executable account in the transaction context.
- **Logic and Control Flow**:
    - Initialize an error variable `err` to 0.
    - Retrieve the BPF loader state for the given `account` using `fd_bpf_loader_program_get_state` and store it in `program_loader_state`.
    - If `program_loader_state` is NULL, return immediately as the account is not a valid BPF program.
    - Check if `program_loader_state` represents a program using `fd_bpf_upgradeable_loader_state_is_program`. If not, return immediately.
    - Retrieve the program data account address from `program_loader_state`.
    - Attempt to initialize the executable account in `txn_ctx->executable_accounts` at the index `*executable_idx` using [`fd_txn_account_init_from_funk_readonly`](<fd_txn_account.c.md#fd_txn_account_init_from_funk_readonly>).
    - If the initialization is successful, increment `*executable_idx`.
- **Output**: No explicit output; modifies the transaction context to include the executable account if applicable.
- **Functions Called**:
    - [`fd_txn_account_init_from_funk_readonly`](<fd_txn_account.c.md#fd_txn_account_init_from_funk_readonly>)


---
### fd\_executor\_setup\_accounts\_for\_txn<!-- {{#callable:fd_executor_setup_accounts_for_txn}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1485>)

Initializes transaction accounts and sets up executable accounts for a given transaction context.
- **Inputs**:
    - ``txn_ctx``: A pointer to the `fd_exec_txn_ctx_t` structure representing the transaction context.
- **Logic and Control Flow**:
    - Initialize the `accounts` array in `txn_ctx` to zero using `fd_memset`.
    - Iterate over each account index `i` from 0 to `txn_ctx->accounts_cnt`.
    - For each account, call [`fd_executor_setup_txn_account`](<#fd_executor_setup_txn_account>) to set up the transaction account.
    - Check if the account's owner matches `fd_solana_bpf_loader_upgradeable_program_id.key`.
    - If the account is executable, call [`fd_executor_setup_executable_account`](<#fd_executor_setup_executable_account>) to set up the executable account and increment the executable index `j`.
    - Check if ELF files need to be dumped to protobuf based on `txn_ctx->capture_ctx`, `txn_ctx->slot`, and `txn_ctx->capture_ctx->dump_elf_to_pb`.
    - If dumping is applicable, iterate over each account and call [`fd_dump_elf_to_protobuf`](<tests/fd_dump_pb.c.md#fd_dump_elf_to_protobuf>).
    - Set `txn_ctx->nonce_account_idx_in_txn` to `ULONG_MAX` and `txn_ctx->executable_cnt` to `j`.
    - Call [`fd_executor_setup_instr_infos_from_txn_instrs`](<#fd_executor_setup_instr_infos_from_txn_instrs>) to set up instruction information from the transaction instructions.
- **Output**: No return value; modifies the `txn_ctx` structure in place.
- **Functions Called**:
    - [`fd_executor_setup_txn_account`](<#fd_executor_setup_txn_account>)
    - [`fd_txn_account_get_owner`](<fd_txn_account.c.md#fd_txn_account_get_owner>)
    - [`fd_executor_setup_executable_account`](<#fd_executor_setup_executable_account>)
    - [`fd_dump_elf_to_protobuf`](<tests/fd_dump_pb.c.md#fd_dump_elf_to_protobuf>)
    - [`fd_executor_setup_instr_infos_from_txn_instrs`](<#fd_executor_setup_instr_infos_from_txn_instrs>)


---
### fd\_executor\_txn\_verify<!-- {{#callable:fd_executor_txn_verify}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1517>)

Verifies the signatures of a transaction using the Ed25519 algorithm and returns a success or failure code.
- **Inputs**:
    - ``txn_p``: A pointer to a `fd_txn_p_t` structure that contains the transaction data.
    - ``shas``: An array of pointers to `fd_sha512_t` structures, used for storing SHA-512 hashes of the signatures.
- **Logic and Control Flow**:
    - Retrieve the transaction object from the `txn_p` pointer using the `TXN` macro.
    - Calculate the pointers to the signatures, public keys, and message within the transaction payload using offsets from the transaction structure.
    - Determine the size of the message by subtracting the message offset from the total payload size.
    - Call `fd_ed25519_verify_batch_single_msg` to verify the batch of signatures against the message and public keys.
    - Check the result of the verification; if it is not `FD_ED25519_SUCCESS`, return `FD_RUNTIME_TXN_ERR_SIGNATURE_FAILURE`.
    - If the verification is successful, return `FD_RUNTIME_EXECUTE_SUCCESS`.
- **Output**: Returns an integer indicating the success or failure of the signature verification process, specifically `FD_RUNTIME_EXECUTE_SUCCESS` for success or `FD_RUNTIME_TXN_ERR_SIGNATURE_FAILURE` for failure.


---
### fd\_execute\_txn<!-- {{#callable:fd_execute_txn}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1535>)

Executes a transaction by iterating over its instructions and handling errors or logging as needed.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure that contains the context for the transaction execution, including transaction details, logging, and execution state.
- **Logic and Control Flow**:
    - Initialize a boolean `dump_insn` to determine if instruction dumping is needed based on the transaction context.
    - Initialize log collection using `fd_log_collector_init` with the transaction context's log collector and execution recording flag.
    - Iterate over each instruction in the transaction using a for loop with index `i`.
    - Set the current instruction index in the transaction context to `i`.
    - If `dump_insn` is true, call [`fd_dump_instr_to_protobuf`](<tests/fd_dump_pb.c.md#fd_dump_instr_to_protobuf>) to capture and convert the instruction to a Protobuf message.
    - Execute the instruction using [`fd_execute_instr`](<#fd_execute_instr>) and store the result in `instr_exec_result`.
    - If `instr_exec_result` is not `FD_EXECUTOR_INSTR_SUCCESS`, set the instruction error index in the transaction context if it is `INT_MAX`, and return `FD_RUNTIME_TXN_ERR_INSTRUCTION_ERROR`.
    - Return the result of [`fd_executor_txn_check`](<#fd_executor_txn_check>) to perform additional transaction checks.
- **Output**: Returns an integer status code indicating the success or failure of the transaction execution, with specific error codes for instruction errors or transaction checks.
- **Functions Called**:
    - [`fd_dump_instr_to_protobuf`](<tests/fd_dump_pb.c.md#fd_dump_instr_to_protobuf>)
    - [`fd_execute_instr`](<#fd_execute_instr>)
    - [`fd_executor_txn_check`](<#fd_executor_txn_check>)


---
### fd\_executor\_txn\_check<!-- {{#callable:fd_executor_txn_check}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1564>)

Checks the validity of a transaction by verifying account rent states and ensuring lamport balances are consistent.
- **Inputs**:
    - ``txn_ctx``: A pointer to a `fd_exec_txn_ctx_t` structure that contains the transaction context, including accounts and bank information.
- **Logic and Control Flow**:
    - Initialize `rent` by querying the bank for rent information using `fd_bank_rent_query` with `txn_ctx->bank`.
    - Initialize `starting_lamports_l`, `starting_lamports_h`, `ending_lamports_l`, and `ending_lamports_h` to zero.
    - Iterate over each account in `txn_ctx->accounts` using a loop indexed by `idx`.
    - For each account, check if it has been written to by verifying if `fd_txn_account_get_meta(b)` is not `NULL`.
    - If the account has been written to, increment `ending_lamports_l` and `ending_lamports_h` by the account's lamports using `fd_uwide_inc`.
    - Determine the account's rent state after the transaction by checking if lamports are zero or above the rent-exempt minimum.
    - If the account is not the incinerator and is not uninitialized or rent-exempt, check its rent state before the transaction.
    - If the account was uninitialized or rent-exempt before the transaction, log a rent exempt error and return `FD_RUNTIME_TXN_ERR_INSUFFICIENT_FUNDS_FOR_RENT`.
    - If the account's data length and lamports have not changed, do nothing; otherwise, log a rent exempt error and return `FD_RUNTIME_TXN_ERR_INSUFFICIENT_FUNDS_FOR_RENT`.
    - If the account's starting lamports are not `ULONG_MAX`, increment `starting_lamports_l` and `starting_lamports_h` by the account's starting lamports using `fd_uwide_inc`.
    - After processing all accounts, check if `ending_lamports_l` and `ending_lamports_h` match `starting_lamports_l` and `starting_lamports_h`.
    - If there is a mismatch, log a lamport sum mismatch error and return `FD_RUNTIME_TXN_ERR_UNBALANCED_TRANSACTION`.
    - Return `FD_RUNTIME_EXECUTE_SUCCESS` if all checks pass.
- **Output**: Returns an integer status code indicating success (`FD_RUNTIME_EXECUTE_SUCCESS`) or a specific error code if the transaction is invalid.
- **Functions Called**:
    - [`fd_txn_account_get_meta`](<fd_txn_account.c.md#fd_txn_account_get_meta>)
    - [`fd_txn_account_get_lamports`](<fd_txn_account.c.md#fd_txn_account_get_lamports>)
    - [`fd_rent_exempt_minimum_balance`](<sysvar/fd_sysvar_rent1.c.md#fd_rent_exempt_minimum_balance>)
    - [`fd_txn_account_get_data_len`](<fd_txn_account.c.md#fd_txn_account_get_data_len>)


---
### fd\_executor\_instr\_strerror<!-- {{#callable:fd_executor_instr_strerror}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1653>)

Maps an error code to its corresponding error message string for logging purposes.
- **Inputs**:
    - `err`: An integer representing the error code to be translated into a string message.
- **Logic and Control Flow**:
    - Uses a switch statement to match the input error code `err` with predefined error codes.
    - Returns a specific error message string for each matched error code.
    - Returns an empty string for certain error codes that should not be logged, such as `FD_EXECUTOR_INSTR_SUCCESS` and `FD_EXECUTOR_INSTR_ERR_FATAL`.
    - If the error code does not match any predefined cases, the function returns an empty string by default.
- **Output**: A constant character pointer to the error message string corresponding to the input error code.


---
### fd\_debug\_symbology<!-- {{#callable:fd_debug_symbology}} -->
[View Source →](<../../../../../src/flamenco/runtime/fd_executor.c#L1721>)

Invokes the `fd_get_types_yaml()` function to ensure its inclusion for debugging purposes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the `fd_get_types_yaml()` function and discards its return value.
- **Output**: No output is produced.



---
Made with ❤️ by [Driver](https://www.driver.ai/)