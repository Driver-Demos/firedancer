<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions and definitions for managing the stake history sysvar, including initialization, reading, and updating.

# Purpose
This C header file defines the interface for managing a "stake history" system variable (`sysvar`) in a distributed system. It includes necessary headers and defines a constant `FD_SYSVAR_STAKE_HISTORY_CAP` to specify the maximum number of entries in the stake history. The file declares three functions: [`fd_sysvar_stake_history_init`](<#fd_sysvar_stake_history_init>), which initializes the stake history account; [`fd_sysvar_stake_history_read`](<#fd_sysvar_stake_history_read>), which reads the stake history from a data structure called `funk` and returns a pointer to the stake history if it exists and has non-zero lamports; and [`fd_sysvar_stake_history_update`](<#fd_sysvar_stake_history_update>), which updates the stake history at the boundary of each epoch. These functions facilitate the management of cluster-wide activation and deactivation records per epoch.
# Imports and Dependencies

---
- `../../types/fd_types.h`
- `../../../funk/fd_funk_base.h`
- `../../accdb/fd_accdb_user.h`


# Function Declarations (Public API)

---
### fd\_sysvar\_stake\_history\_init<!-- {{#callable_declaration:fd_sysvar_stake_history_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_stake_history.h#L15>)

Initialize the stake history sysvar account.
- **Description**: Use this function to set up the stake history sysvar account, which records the history of cluster-wide activations and de-activations per epoch. This function must be called at the start of each epoch to ensure the sysvar account is correctly initialized. It is important to provide valid pointers for all parameters to avoid undefined behavior.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure. Must not be null. The caller retains ownership.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure. Must not be null. The caller retains ownership.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure. Must not be null. The caller retains ownership.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure. Must not be null. The caller retains ownership.
- **Output**: None
- **See Also**: [`fd_sysvar_stake_history_init`](<fd_sysvar_stake_history.c.md#fd_sysvar_stake_history_init>)  (Implementation)


---
### fd\_sysvar\_stake\_history\_read<!-- {{#callable_declaration:fd_sysvar_stake_history_read}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_stake_history.h#L30>)

Reads the stake history sysvar from funk.
- **Description**: Use this function to read the stake history sysvar from the specified funk. It returns a pointer to the stake history if the account exists and has non-zero lamports. If the account does not exist or has zero lamports, it returns NULL. This function is useful for retrieving the history of cluster-wide activations and deactivations per epoch. Ensure that the `funk` and `xid` parameters are valid and that `stake_history` is a valid pointer to store the result.
- **Inputs**:
    - `funk`: A pointer to an `fd_funk_t` structure representing the funk from which to read the stake history. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `stake_history`: A pointer to an `fd_stake_history_t` structure where the stake history will be stored. Must not be null and should be properly allocated by the caller.
- **Output**: Returns a pointer to `fd_stake_history_t` if successful, or NULL if the account does not exist or has zero lamports.
- **See Also**: [`fd_sysvar_stake_history_read`](<fd_sysvar_stake_history.c.md#fd_sysvar_stake_history_read>)  (Implementation)


---
### fd\_sysvar\_stake\_history\_update<!-- {{#callable_declaration:fd_sysvar_stake_history_update}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_stake_history.h#L36>)

Update the stake history sysvar account at the epoch boundary.
- **Description**: Use this function to update the stake history sysvar account when an epoch boundary occurs. It modifies the stake history to include the latest epoch's activation and deactivation data. Ensure that the stake history sysvar is initialized and readable before calling this function. The function updates the internal state of the stake history, adjusting the offset and length as necessary, and writes the updated history back to the system.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure. Must not be null. The caller retains ownership.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure. Must not be null. The caller retains ownership.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure. Must not be null. The caller retains ownership.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure. Must not be null. The caller retains ownership.
    - `pair`: A pointer to a constant `fd_epoch_stake_history_entry_pair_t` structure. Must not be null. The caller retains ownership.
- **Output**: None
- **See Also**: [`fd_sysvar_stake_history_update`](<fd_sysvar_stake_history.c.md#fd_sysvar_stake_history_update>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)