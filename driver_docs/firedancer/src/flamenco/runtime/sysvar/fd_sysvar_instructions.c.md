<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for serializing and updating sysvar instruction accounts in a transaction context.

# Purpose
The code is a C source file that provides functionality for serializing and managing instruction data within a transaction context. It includes functions to calculate the serialized size of instructions, serialize instruction data into a transaction account, and update the current instruction index in the instructions system variable account. The file imports several headers, indicating dependencies on other components such as `fd_sysvar_instructions.h`, `fd_borrowed_account.h`, and `fd_system_ids.h`.

The primary function, [`fd_sysvar_instructions_serialize_account`](<#fd_sysvar_instructions_serialize_account>), serializes a list of instructions into a transaction account, ensuring that the account is properly set up and mutable. It handles the allocation of memory for the serialized data and sets various account properties, such as owner and lamports. The function [`fd_sysvar_instructions_update_current_instr_idx`](<#fd_sysvar_instructions_update_current_instr_idx>) updates the current instruction index within the serialized data. The code is part of a larger system that manages transaction execution, likely in a blockchain or distributed ledger context, as suggested by the use of terms like "transaction," "account," and "pubkey."
# Imports and Dependencies

---
- `fd_sysvar_instructions.h`
- `../fd_borrowed_account.h`
- `../fd_system_ids.h`


# Functions

---
### instructions\_serialized\_size<!-- {{#callable:instructions_serialized_size}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_instructions.c#L5>)

Calculates the total serialized size of a set of instructions.
- **Inputs**:
    - `instrs`: A pointer to an array of `fd_instr_info_t` structures representing the instructions.
    - `instrs_cnt`: The number of instructions in the `instrs` array.
- **Logic and Control Flow**:
    - Initialize `serialized_size` to 0.
    - Add the size of `ushort` for `num_instructions` and the size of `ushort` multiplied by `instrs_cnt` for instruction offsets to `serialized_size`.
    - Iterate over each instruction in the `instrs` array.
    - For each instruction, add the size of `ushort` for `num_accounts` to `serialized_size`.
    - For each account in the instruction, add the size of `uchar` for flags and the size of `fd_pubkey_t` for the public key to `serialized_size`.
    - Add the size of `fd_pubkey_t` for the program ID public key, the size of `ushort` for `instr_data_len`, and the size of the instruction's data (`instr->data_sz`) to `serialized_size`.
    - After the loop, add the size of `ushort` for `current_instr_idx` to `serialized_size`.
    - Return the calculated `serialized_size`.
- **Output**: Returns the total serialized size as an `ulong`.


---
### fd\_sysvar\_instructions\_serialize\_account<!-- {{#callable:fd_sysvar_instructions_serialize_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_instructions.c#L35>)

Serializes instruction data into a transaction account for sysvar instructions.
- **Inputs**:
    - `txn_ctx`: A pointer to the transaction context (`fd_exec_txn_ctx_t`) that contains transaction-related data.
    - `instrs`: A pointer to an array of instruction information (`fd_instr_info_t`) to be serialized.
    - `instrs_cnt`: The number of instructions in the `instrs` array.
- **Logic and Control Flow**:
    - Calculate the serialized size of the instructions using [`instructions_serialized_size`](<#instructions_serialized_size>) function.
    - Retrieve the sysvar instructions account using `fd_exec_txn_ctx_get_account_with_key`. Log an error if the account is not found.
    - Check if the account is mutable. If not, allocate memory for the account metadata and join it to the transaction workspace.
    - Set default values for the account, including owner, lamports, executable flag, and data length.
    - Get a mutable pointer to the account data and initialize the offset.
    - Store the number of instructions at the current offset and update the offset.
    - Calculate and store instruction offsets.
    - Iterate over each instruction to serialize its data, including account count, flags, public keys, program ID, and instruction data.
    - Store a zero value at the end of the serialized data to indicate the end of instructions.
- **Output**: No return value; the function modifies the transaction account in place.
- **Functions Called**:
    - [`instructions_serialized_size`](<#instructions_serialized_size>)


---
### fd\_sysvar\_instructions\_update\_current\_instr\_idx<!-- {{#callable:fd_sysvar_instructions_update_current_instr_idx}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_instructions.c#L135>)

Updates the current instruction index in the transaction account's data.
- **Inputs**:
    - ``rec``: A pointer to the `fd_txn_account_t` structure representing the transaction account.
    - ``current_instr_idx``: The current instruction index to store, of type `ushort`.
- **Logic and Control Flow**:
    - Checks if the data length of the transaction account `rec` is less than the size of a `ushort`; if true, the function returns immediately.
    - Calculates the position in the account's mutable data where the current instruction index should be stored.
    - Stores the `current_instr_idx` value at the calculated position in the account's data.
- **Output**: No output is returned; the function updates the data in the provided transaction account.



---
Made with ❤️ by [Driver](https://www.driver.ai/)