<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for managing the "last restart slot" sysvar in a bank's state, including initialization, writing, updating, reading, and deriving.

# Purpose
The code is a C header file that defines functions and data structures related to managing a system variable, specifically the "last restart slot" in a banking context. It includes several function prototypes that facilitate the creation, updating, writing, reading, and derivation of this system variable. The header file includes other necessary headers such as `fd_sysvar_base.h`, `fd_types.h`, and `fd_accdb_user.h`, which provide foundational types and functions used within this module.

The primary functionality revolves around maintaining the state of the "last restart slot" system variable. The functions [`fd_sysvar_last_restart_slot_init`](<#fd_sysvar_last_restart_slot_init>), [`fd_sysvar_last_restart_slot_write`](<#fd_sysvar_last_restart_slot_write>), and [`fd_sysvar_last_restart_slot_update`](<#fd_sysvar_last_restart_slot_update>) are responsible for initializing, writing, and updating the system variable, respectively. The function [`fd_sysvar_last_restart_slot_read`](<#fd_sysvar_last_restart_slot_read>) allows querying the current state of the system variable, while [`fd_sysvar_last_restart_slot_derive`](<#fd_sysvar_last_restart_slot_derive>) computes the "last restart slot" value based on a bank's "hard forks" list. This header file is intended to be included in other C source files that require interaction with the "last restart slot" system variable, providing a public API for managing this specific aspect of the system's state.
# Imports and Dependencies

---
- `fd_sysvar_base.h`
- `../../types/fd_types.h`
- `../../accdb/fd_accdb_user.h`


# Data Structures

---
### fd\_hard\_forks\_global\_t
- **Type**: ``struct``
- **Description**: `fd_hard_forks_global_t` is a typedef for a structure named `fd_hard_forks_global`. The code does not provide details about the members or fields of this structure, indicating that it is defined elsewhere. This structure is used in the function `fd_sysvar_last_restart_slot_derive` to derive the "last restart slot" value from a bank's "hard forks" list.


# Function Declarations (Public API)

---
### fd\_sysvar\_last\_restart\_slot\_init<!-- {{#callable_declaration:fd_sysvar_last_restart_slot_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.h#L10>)

Creates or updates the "last restart slot" sysvar account.
- **Description**: Use this function to create or update the "last restart slot" sysvar account based on the bank's implicit state. This function should be called when the "last restart slot" sysvar needs to be initialized or updated. It is important to ensure that the bank is active for the "last restart slot" sysvar before calling this function, as it will return immediately if the bank is not active for this sysvar.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure. The bank must be active for the "last restart slot" sysvar. The caller retains ownership.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure. The caller retains ownership.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure. The caller retains ownership.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure. The caller retains ownership.
- **Output**: None
- **See Also**: [`fd_sysvar_last_restart_slot_init`](<fd_sysvar_last_restart_slot.c.md#fd_sysvar_last_restart_slot_init>)  (Implementation)


---
### fd\_sysvar\_last\_restart\_slot\_write<!-- {{#callable_declaration:fd_sysvar_last_restart_slot_write}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.h#L22>)

Writes the last restart slot sysvar to the specified account.
- **Description**: Use this function to update the "last restart slot" sysvar account with the provided slot information. This function requires a valid bank, account database, transaction ID, capture context, and sysvar structure. It is important to ensure that all pointers provided are valid and not null before calling this function. The function encodes the slot from the sysvar and updates the sysvar account accordingly.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure representing the capture context. Must not be null.
    - `sysvar`: A pointer to a constant `fd_sol_sysvar_last_restart_slot_t` structure containing the slot information to write. Must not be null.
- **Output**: None
- **See Also**: [`fd_sysvar_last_restart_slot_write`](<fd_sysvar_last_restart_slot.c.md#fd_sysvar_last_restart_slot_write>)  (Implementation)


---
### fd\_sysvar\_last\_restart\_slot\_update<!-- {{#callable_declaration:fd_sysvar_last_restart_slot_update}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.h#L36>)

Ensures the "last restart slot" sysvar contains the specified slot number.
- **Description**: Use this function to update the "last restart slot" sysvar in the bank's state to match the specified slot number. It checks if the current sysvar slot differs from the desired slot and updates it if necessary. This function should be called when you need to ensure that the sysvar reflects the latest restart slot information. It requires a valid bank, account database, transaction ID, and capture context. The function does nothing if the feature is not active in the bank.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank. Must not be null. The function checks if the feature is active in this bank.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null. Used to read the current sysvar slot.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null. Used in sysvar read and write operations.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure used in sysvar write operations. Must not be null.
    - `last_restart_slot_want`: An unsigned long integer representing the desired last restart slot number. The function updates the sysvar to this value if it differs from the current value.
- **Output**: None
- **See Also**: [`fd_sysvar_last_restart_slot_update`](<fd_sysvar_last_restart_slot.c.md#fd_sysvar_last_restart_slot_update>)  (Implementation)


---
### fd\_sysvar\_last\_restart\_slot\_read<!-- {{#callable_declaration:fd_sysvar_last_restart_slot_read}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.h#L49>)

Queries the last restart slot sysvar from the given funk.
- **Description**: Use this function to retrieve the last restart slot sysvar from a specified funk. It is important to ensure that the account exists in the funk and has non-zero lamports; otherwise, the function will return NULL. This function is useful when you need to access the last restart slot information stored in the sysvar account. Ensure that the `funk` and `xid` parameters are valid and that `out` is a valid pointer to store the result.
- **Inputs**:
    - `funk`: A pointer to an `fd_funk_t` structure representing the funk from which to query the sysvar. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `out`: A pointer to an `fd_sol_sysvar_last_restart_slot_t` structure where the function will store the result. Must not be null.
- **Output**: Returns a pointer to the `fd_sol_sysvar_last_restart_slot_t` structure containing the last restart slot if successful, or NULL if the account does not exist or has zero lamports.
- **See Also**: [`fd_sysvar_last_restart_slot_read`](<fd_sysvar_last_restart_slot.c.md#fd_sysvar_last_restart_slot_read>)  (Implementation)


---
### fd\_sysvar\_last\_restart\_slot\_derive<!-- {{#callable_declaration:fd_sysvar_last_restart_slot_derive}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.h#L59>)

Derives the last restart slot from a list of hard forks.
- **Description**: Use this function to determine the most recent restart slot from a sequence of hard forks, given the current slot. It is useful when you need to know the last slot at which a restart occurred, based on historical hard fork data. The function requires a valid `hard_forks` structure and a `current_slot` value. If the `hard_forks` list is empty, the function returns `0`. This function does not modify any input parameters.
- **Inputs**:
    - `hard_forks`: A pointer to a `fd_hard_forks_global_t` structure containing the list of hard forks. Must not be null. If the list is empty, the function returns `0`.
    - `current_slot`: An unsigned long representing the current slot number. The function uses this to find the most recent restart slot that is less than or equal to this value.
- **Output**: Returns the most recent restart slot as an unsigned long. If no such slot exists, returns `0`.
- **See Also**: [`fd_sysvar_last_restart_slot_derive`](<fd_sysvar_last_restart_slot.c.md#fd_sysvar_last_restart_slot_derive>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)