<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for managing the last restart slot system variable in a bank's account database.

# Purpose
The code provides functionality for managing and updating a system variable related to the last restart slot in a financial system. It includes functions to write, initialize, derive, read, and update the `fd_sol_sysvar_last_restart_slot_t` structure, which represents the last restart slot. The code interacts with various components such as `fd_bank_t`, `fd_accdb_user_t`, and `fd_funk_txn_xid_t` to perform operations on the system variable. The functions ensure that the system variable is correctly updated and maintained based on the current state of the system and any hard forks that may have occurred.

The code is part of a larger system and is intended to be used as a library or module that can be integrated into other parts of the system. It defines several functions that serve as an interface for interacting with the last restart slot system variable. The functions handle reading from and writing to the accounts database, checking for active features, and ensuring that the system variable is consistent with the desired state. The code also includes references to external systems and standards, such as the Solana runtime, indicating its role in a broader financial or blockchain-related application.
# Imports and Dependencies

---
- `fd_sysvar_last_restart_slot.h`
- `fd_sysvar.h`
- `../fd_system_ids.h`


# Functions

---
### fd\_sysvar\_last\_restart\_slot\_write<!-- {{#callable:fd_sysvar_last_restart_slot_write}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.c#L5>)

Writes the last restart slot value to the system variable account.
- **Inputs**:
    - `bank`: A pointer to the `fd_bank_t` structure representing the bank where the system variable account is updated.
    - `accdb`: A pointer to the `fd_accdb_user_t` structure representing the account database user context.
    - `xid`: A pointer to the `fd_funk_txn_xid_t` structure representing the transaction ID.
    - `capture_ctx`: A pointer to the `fd_capture_ctx_t` structure representing the capture context.
    - `sysvar`: A pointer to the `fd_sol_sysvar_last_restart_slot_t` structure containing the last restart slot value to write.
- **Logic and Control Flow**:
    - Declare an 8-byte array `enc` to store the encoded slot value.
    - Use the `FD_STORE` macro to encode the `slot` from `sysvar` into the `enc` array.
    - Call [`fd_sysvar_account_update`](<fd_sysvar.c.md#fd_sysvar_account_update>) to update the system variable account with the encoded slot value.
- **Output**: No return value; the function updates the system variable account with the provided slot value.
- **Functions Called**:
    - [`fd_sysvar_account_update`](<fd_sysvar.c.md#fd_sysvar_account_update>)


---
### fd\_sysvar\_last\_restart\_slot\_init<!-- {{#callable:fd_sysvar_last_restart_slot_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.c#L18>)

Initializes the last restart slot system variable if the feature is active in the bank.
- **Inputs**:
    - ``bank``: A pointer to an `fd_bank_t` structure representing the bank where the system variable is managed.
    - ``accdb``: A pointer to an `fd_accdb_user_t` structure representing the account database user.
    - ``xid``: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID.
    - ``capture_ctx``: A pointer to an `fd_capture_ctx_t` structure representing the capture context.
- **Logic and Control Flow**:
    - Check if the feature `last_restart_slot_sysvar` is active in the given `bank` using `FD_FEATURE_ACTIVE_BANK` macro.
    - If the feature is not active, return immediately without performing any operations.
    - If the feature is active, initialize a `fd_sol_sysvar_last_restart_slot_t` structure named `sysvar` with zero values.
    - Call [`fd_sysvar_last_restart_slot_write`](<#fd_sysvar_last_restart_slot_write>) to write the initialized `sysvar` to the bank using the provided `accdb`, `xid`, and `capture_ctx`.
- **Output**: No output is returned from this function.
- **Functions Called**:
    - [`fd_sysvar_last_restart_slot_write`](<#fd_sysvar_last_restart_slot_write>)


---
### fd\_sysvar\_last\_restart\_slot\_derive<!-- {{#callable:fd_sysvar_last_restart_slot_derive}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.c#L34>)

Determines the last restart slot from a list of hard fork slots that is less than or equal to the current slot.
- **Inputs**:
    - `hard_forks`: A pointer to a `fd_hard_forks_global_t` structure containing information about hard fork slots.
    - `current_slot`: An unsigned long integer representing the current slot number.
- **Logic and Control Flow**:
    - Check if `hard_forks->hard_forks_len` is zero; if true, return 0UL as the first restart slot.
    - Obtain the head and tail pointers to the array of `fd_slot_pair_t` structures using `fd_hard_forks_hard_forks_join`.
    - Iterate backwards from the tail to the head of the array.
    - For each `pair`, check if `pair->slot` is less than or equal to `current_slot`.
    - If such a `pair` is found, return `pair->slot`.
    - If no such `pair` is found, return 0UL.
- **Output**: Returns the last restart slot as an unsigned long integer that is less than or equal to the current slot, or 0UL if no such slot exists.


---
### fd\_sysvar\_last\_restart\_slot\_read<!-- {{#callable:fd_sysvar_last_restart_slot_read}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.c#L57>)

Reads the last restart slot system variable from a read-only account and decodes it into the provided output structure.
- **Inputs**:
    - ``funk``: A pointer to an `fd_funk_t` structure representing the current transaction context.
    - ``xid``: A constant pointer to an `fd_funk_txn_xid_t` structure representing the transaction identifier.
    - ``out``: A pointer to an `fd_sol_sysvar_last_restart_slot_t` structure where the decoded last restart slot will be stored.
- **Logic and Control Flow**:
    - Initialize a transaction account in read-only mode using `fd_txn_account_init_from_funk_readonly` with the provided `funk` and `xid`.
    - Check if the account initialization was successful; if not, return `NULL`.
    - Check if the account has any lamports; if not, return `NULL` as the account is considered non-existent.
    - Decode the account data into the `out` structure using `fd_bincode_decode_static` and return the result.
- **Output**: A pointer to the `fd_sol_sysvar_last_restart_slot_t` structure containing the decoded last restart slot, or `NULL` if an error occurs.


---
### fd\_sysvar\_last\_restart\_slot\_update<!-- {{#callable:fd_sysvar_last_restart_slot_update}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_last_restart_slot.c#L84>)

Updates the last restart slot in the system variable if it differs from the desired value.
- **Inputs**:
    - ``bank``: A pointer to an `fd_bank_t` structure representing the bank context.
    - ``accdb``: A pointer to an `fd_accdb_user_t` structure representing the account database user context.
    - ``xid``: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID.
    - ``capture_ctx``: A pointer to an `fd_capture_ctx_t` structure representing the capture context.
    - ``last_restart_slot_want``: An unsigned long integer representing the desired last restart slot value.
- **Logic and Control Flow**:
    - Check if the feature `last_restart_slot_sysvar` is active in the bank; if not, return immediately.
    - Initialize `last_restart_slot_have` to `ULONG_MAX` and declare a `sysvar` variable of type `fd_sol_sysvar_last_restart_slot_t`.
    - Attempt to read the current last restart slot from the account database using [`fd_sysvar_last_restart_slot_read`](<#fd_sysvar_last_restart_slot_read>); if successful, update `last_restart_slot_have` with the read value.
    - Compare `last_restart_slot_have` with `last_restart_slot_want`; if they differ, update `sysvar.slot` with `last_restart_slot_want` and write the updated `sysvar` back to the system variable using [`fd_sysvar_last_restart_slot_write`](<#fd_sysvar_last_restart_slot_write>).
- **Output**: No return value; the function updates the system variable if necessary.
- **Functions Called**:
    - [`fd_sysvar_last_restart_slot_read`](<#fd_sysvar_last_restart_slot_read>)
    - [`fd_sysvar_last_restart_slot_write`](<#fd_sysvar_last_restart_slot_write>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)