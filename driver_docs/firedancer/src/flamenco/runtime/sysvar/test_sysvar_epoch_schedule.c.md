<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the `fd_epoch_schedule_t` structure, including boundary, edge cases, and test vectors.

# Purpose
The code is a test suite for validating the functionality of the `fd_epoch_schedule_t` structure and its associated operations. It includes several static functions that test different aspects of epoch scheduling, such as boundary conditions, edge cases, and specific test vectors. The code uses assertions to verify that the `fd_epoch_schedule_t` structure is correctly aligned and that its fields are correctly offset. It also checks the size of the structure to ensure it matches expected values.

The test suite includes functions like [`test_sysvar_epoch_schedule_bounds`](<#test_sysvar_epoch_schedule_bounds>), which checks the size and alignment of the epoch schedule data, and [`test_sysvar_epoch_schedule_edge_case`](<#test_sysvar_epoch_schedule_edge_case>), which tests specific edge cases in epoch scheduling. The [`test_epoch_schedule_derive`](<#test_epoch_schedule_derive>) function verifies the derivation of epoch schedules with and without warmup periods, while [`test_epoch_schedule`](<#test_epoch_schedule>) checks the correctness of epoch and slot calculations. The [`test_sysvar_epoch_schedule_testnet`](<#test_sysvar_epoch_schedule_testnet>) function tests the epoch schedule against a predefined testnet configuration. The main function, [`test_sysvar_epoch_schedule`](<#test_sysvar_epoch_schedule>), orchestrates the execution of all these tests to ensure the integrity and correctness of the epoch scheduling logic.
# Imports and Dependencies

---
- `fd_sysvar_epoch_schedule.h`
- `stddef.h`


# Global Variables

---
### fd\_epoch\_schedule\_test\_vectors
- **Type**: ``fd_epoch_schedule_t const[]``
- **Description**: An array of constant `fd_epoch_schedule_t` structures that define test vectors for epoch schedules. Each element in the array specifies the number of slots per epoch, the first normal epoch, and the first normal slot.
- **Use**: Used to provide predefined test vectors for testing epoch schedule-related functions.


# Functions

---
### test\_sysvar\_epoch\_schedule\_bounds<!-- {{#callable:test_sysvar_epoch_schedule_bounds}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/test_sysvar_epoch_schedule.c#L13>)

Validates the bounds and alignment of the epoch schedule sysvar data against expected constants.
- **Inputs**: None
- **Logic and Control Flow**:
    - Defines a static array `data` representing a real sysvar account observed on-chain.
    - Checks if the size of `data` matches the expected size `FD_SYSVAR_EPOCH_SCHEDULE_BINCODE_SZ`.
    - Initializes a `fd_bincode_decode_ctx_t` context `ctx` with `data` and its end pointer.
    - Initializes `obj_sz` to zero and checks if `fd_epoch_schedule_decode_footprint` successfully decodes the footprint into `obj_sz`.
    - Verifies that `obj_sz` matches the expected footprint size `FD_SYSVAR_EPOCH_SCHEDULE_FOOTPRINT`.
    - Checks if the alignment returned by `fd_epoch_schedule_align` matches the expected alignment `FD_SYSVAR_EPOCH_SCHEDULE_ALIGN`.
- **Output**: No output is returned; the function uses assertions to validate conditions.


---
### test\_sysvar\_epoch\_schedule\_edge\_case<!-- {{#callable:test_sysvar_epoch_schedule_edge_case}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/test_sysvar_epoch_schedule.c#L31>)

Tests edge cases for the epoch schedule system variable by verifying specific function behaviors with zero slots per epoch.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_epoch_schedule_t` structure `schedule` with `slots_per_epoch` set to 0.
    - Call [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>) with `schedule`, slot 0, and a NULL pointer, and verify it returns 0.
    - Call [`fd_epoch_schedule_derive`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_schedule_derive>) with `schedule`, epoch length 31, leader schedule offset 31, and warmup 0, and verify it returns NULL.
- **Output**: No output is returned as this function is a static test function that uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>)
    - [`fd_epoch_schedule_derive`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_schedule_derive>)


---
### test\_epoch\_schedule\_derive<!-- {{#callable:test_epoch_schedule_derive}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/test_sysvar_epoch_schedule.c#L52>)

Tests the derivation of epoch schedules with and without warmup for a range of epoch lengths.
- **Inputs**:
    - ``t``: A pointer to a constant `fd_epoch_schedule_t` structure containing epoch schedule parameters.
- **Logic and Control Flow**:
    - Initialize `epoch_len` with the `slots_per_epoch` value from the first element of `t`.
    - Enter a loop that continues while `epoch_len` is less than the `slots_per_epoch` value of the second element of `t`.
    - Inside the loop, create a `fd_epoch_schedule_t` structure named `schedule`.
    - Call [`fd_epoch_schedule_derive`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_schedule_derive>) with `schedule`, `epoch_len`, `epoch_len / 2`, and `warmup` set to 1, then perform tests to verify the derived schedule matches expected values with warmup.
    - Call [`fd_epoch_schedule_derive`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_schedule_derive>) again with `schedule`, `epoch_len`, `epoch_len / 2`, and `warmup` set to 0, then perform tests to verify the derived schedule matches expected values without warmup.
    - Increment `epoch_len` and repeat the loop.
- **Output**: No return value; the function performs tests to validate the derived epoch schedules.
- **Functions Called**:
    - [`fd_epoch_schedule_derive`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_schedule_derive>)


---
### test\_epoch\_schedule<!-- {{#callable:test_epoch_schedule}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/test_sysvar_epoch_schedule.c#L89>)

Validates the epoch schedule by checking the monotonic increase of epoch numbers and slot indices before the first normal slot.
- **Inputs**:
    - `t`: A pointer to a constant `fd_epoch_schedule_t` structure that contains the epoch schedule information.
- **Logic and Control Flow**:
    - Initialize `last_epoch` to 0 and `last_slot_idx` to `ULONG_MAX`.
    - Iterate over each slot from 0 to `t->first_normal_slot - 1`.
    - For each slot, calculate the epoch and slot index using [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>).
    - Check that the epoch number increases monotonically and by at most one, and that the slot index increments within the epoch.
    - If the epoch number increases, verify the first slot of the epoch and the epoch length using [`fd_epoch_slot0`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot0>) and [`fd_epoch_slot_cnt`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot_cnt>).
    - Update `last_epoch` and `last_slot_idx` for the next iteration.
- **Output**: No return value; the function performs validation checks using `FD_TEST` macros.
- **Functions Called**:
    - [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>)
    - [`fd_epoch_slot0`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot0>)
    - [`fd_epoch_slot_cnt`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot_cnt>)


---
### test\_sysvar\_epoch\_schedule\_testnet<!-- {{#callable:test_sysvar_epoch_schedule_testnet}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/test_sysvar_epoch_schedule.c#L123>)

Tests the functionality of epoch schedule calculations for a testnet configuration.
- **Inputs**: None
- **Logic and Control Flow**:
    - Defines a constant `fd_epoch_schedule_t` structure named `schedule` with specific parameters for slots per epoch, leader schedule slot offset, warmup, first normal epoch, and first normal slot.
    - Performs a series of tests using `FD_TEST` to verify the correctness of the [`fd_slot_to_leader_schedule_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_leader_schedule_epoch>) function for various slot values, ensuring it returns the expected epoch numbers.
    - Initializes a variable `offset` and tests the [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>) function to ensure it returns the correct epoch and offset for given slot values, iterating over a range of slots to verify consistency.
    - Tests the [`fd_epoch_slot0`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot0>) function to ensure it returns the correct starting slot for given epoch numbers.
    - Verifies the [`fd_epoch_slot_cnt`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot_cnt>) function to ensure it returns the correct number of slots in a specified epoch.
- **Output**: No output is returned; the function uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_slot_to_leader_schedule_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_leader_schedule_epoch>)
    - [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>)
    - [`fd_epoch_slot0`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot0>)
    - [`fd_epoch_slot_cnt`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot_cnt>)


---
### test\_sysvar\_epoch\_schedule<!-- {{#callable:test_sysvar_epoch_schedule}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/test_sysvar_epoch_schedule.c#L154>)

Executes a series of tests on the epoch schedule system variable to verify its correctness and behavior under various conditions.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls [`test_sysvar_epoch_schedule_bounds`](<#test_sysvar_epoch_schedule_bounds>) to test the bounds of the epoch schedule system variable.
    - Calls [`test_sysvar_epoch_schedule_edge_case`](<#test_sysvar_epoch_schedule_edge_case>) to test edge cases of the epoch schedule.
    - Iterates over `fd_epoch_schedule_test_vectors`, calling [`test_epoch_schedule_derive`](<#test_epoch_schedule_derive>) and [`test_epoch_schedule`](<#test_epoch_schedule>) for each vector to verify the derivation and properties of epoch schedules.
    - Calls [`test_sysvar_epoch_schedule_testnet`](<#test_sysvar_epoch_schedule_testnet>) to test the epoch schedule in a testnet configuration.
- **Output**: No return value; the function performs tests and asserts conditions internally.
- **Functions Called**:
    - [`test_sysvar_epoch_schedule_bounds`](<#test_sysvar_epoch_schedule_bounds>)
    - [`test_sysvar_epoch_schedule_edge_case`](<#test_sysvar_epoch_schedule_edge_case>)
    - [`test_epoch_schedule_derive`](<#test_epoch_schedule_derive>)
    - [`test_epoch_schedule`](<#test_epoch_schedule>)
    - [`test_sysvar_epoch_schedule_testnet`](<#test_sysvar_epoch_schedule_testnet>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)