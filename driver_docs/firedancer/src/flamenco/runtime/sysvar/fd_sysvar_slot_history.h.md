<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions and definitions for managing and querying slot history in the current epoch.

# Purpose
This C header file defines the interface for managing a slot history system variable (`sysvar`) in a runtime environment. It includes necessary headers and defines constants to represent different states of a slot, such as `FD_SLOT_HISTORY_SLOT_FOUND`, `FD_SLOT_HISTORY_SLOT_FUTURE`, `FD_SLOT_HISTORY_SLOT_NOT_FOUND`, and `FD_SLOT_HISTORY_SLOT_TOO_OLD`. The file declares functions to initialize ([`fd_sysvar_slot_history_init`](<#fd_sysvar_slot_history_init>)), update ([`fd_sysvar_slot_history_update`](<#fd_sysvar_slot_history_update>)), and read ([`fd_sysvar_slot_history_read`](<#fd_sysvar_slot_history_read>)) the slot history sysvar account, as well as a function to find a specific slot ([`fd_sysvar_slot_history_find_slot`](<#fd_sysvar_slot_history_find_slot>)). The slot history sysvar uses a bit-vector to track processed slots within the current epoch, and these functions facilitate the management and querying of this data.
# Imports and Dependencies

---
- `../../fd_flamenco_base.h`
- `../../types/fd_types.h`
- `../fd_bank.h`


# Function Declarations (Public API)

---
### fd\_sysvar\_slot\_history\_init<!-- {{#callable_declaration:fd_sysvar_slot_history_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_slot_history.h#L17>)

Initialize the slot history sysvar account.
- **Description**: Use this function to initialize the slot history sysvar account, which tracks processed slots in the current epoch. This function must be called before any updates to the slot history can occur. It prepares the necessary data structures and sets the initial state for slot tracking. Ensure that the `bank`, `accdb`, `xid`, and `capture_ctx` parameters are valid and properly initialized before calling this function.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure. This must not be null and should be properly initialized before use. The function uses this to determine the current slot.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure. This must not be null and should be properly initialized. It is used to access account database information.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure. This must not be null and should be properly initialized. It represents the transaction ID for the operation.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure. This must not be null and should be properly initialized. It is used for capturing context information during the initialization process.
- **Output**: None
- **See Also**: [`fd_sysvar_slot_history_init`](<fd_sysvar_slot_history.c.md#fd_sysvar_slot_history_init>)  (Implementation)


---
### fd\_sysvar\_slot\_history\_update<!-- {{#callable_declaration:fd_sysvar_slot_history_update}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_slot_history.h#L25>)

Update the slot history sysvar account.
- **Description**: Use this function to update the slot history sysvar account at the end of each slot, after all execution has finished. This function records the current slot and prepares the next slot for processing. It is important to ensure that the bank, account database, transaction ID, and capture context are correctly initialized and valid before calling this function.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank. Must be valid and initialized.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must be valid and initialized.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must be valid and initialized.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure representing the capture context. Must be valid and initialized.
- **Output**: Returns 0 on successful update of the slot history sysvar account.
- **See Also**: [`fd_sysvar_slot_history_update`](<fd_sysvar_slot_history.c.md#fd_sysvar_slot_history_update>)  (Implementation)


---
### fd\_sysvar\_slot\_history\_read<!-- {{#callable_declaration:fd_sysvar_slot_history_read}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_slot_history.h#L35>)

Reads the slot history sysvar from funk.
- **Description**: Use this function to read the slot history sysvar from a given funk context. It returns a pointer to the slot history data if the account exists and has non-zero lamports. If the account does not exist or has zero lamports, the function returns NULL. Ensure that the `out_mem` buffer is correctly allocated with a size of `FD_SYSVAR_SLOT_HISTORY_FOOTPRINT` before calling this function.
- **Inputs**:
    - `funk`: A pointer to an `fd_funk_t` structure representing the funk context from which to read the slot history. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `out_mem`: A buffer of size `FD_SYSVAR_SLOT_HISTORY_FOOTPRINT` where the function will store the decoded slot history data. The caller must allocate this buffer.
- **Output**: Returns a pointer to `fd_slot_history_global_t` if successful, or NULL if the account does not exist or has zero lamports.
- **See Also**: [`fd_sysvar_slot_history_read`](<fd_sysvar_slot_history.c.md#fd_sysvar_slot_history_read>)  (Implementation)


---
### fd\_sysvar\_slot\_history\_find\_slot<!-- {{#callable_declaration:fd_sysvar_slot_history_find_slot}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_slot_history.h#L40>)

Finds the status of a slot in the slot history.
- **Description**: Use this function to determine the status of a specific slot within the slot history. It checks if the slot is in the future, too old, found, or not found in the current epoch's bit-vector. Ensure that the `history` parameter is a valid pointer to a `fd_slot_history_global_t` structure. The function returns specific codes to indicate the slot's status, which can be used to handle different scenarios in slot processing.
- **Inputs**:
    - `history`: A pointer to a `fd_slot_history_global_t` structure representing the slot history. Must not be null.
    - `slot`: An unsigned long integer representing the slot number to find. Must be within the valid range of slots managed by the history.
- **Output**: Returns an integer code indicating the slot's status: `FD_SLOT_HISTORY_SLOT_FOUND`, `FD_SLOT_HISTORY_SLOT_FUTURE`, `FD_SLOT_HISTORY_SLOT_NOT_FOUND`, or `FD_SLOT_HISTORY_SLOT_TOO_OLD`.
- **See Also**: [`fd_sysvar_slot_history_find_slot`](<fd_sysvar_slot_history.c.md#fd_sysvar_slot_history_find_slot>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)