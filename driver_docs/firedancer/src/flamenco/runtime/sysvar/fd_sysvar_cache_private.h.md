<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines internal structures and functions for managing a sysvar cache, including perfect hashing and serialization.

# Purpose
The code is a C header file that defines private components for managing a system variable (sysvar) cache in a runtime environment. It includes definitions and structures for handling sysvar data, such as `fd_sysvar_pos_t` and `sysvar_tbl_t`, which are used to map sysvar IDs to cache slots and manage the offsets and sizes of sysvar data within the cache. The file also defines a perfect hash table to efficiently map sysvar IDs to their corresponding cache slots, using macros like `MAP_PERFECT_HASH_PP` and `PERFECT_HASH`.

The header file includes macros and structures to facilitate the encoding and decoding of sysvar data, ensuring that sysvar data can be serialized and deserialized correctly. The `fd_sysvar_pos_tbl` array provides detailed information about each sysvar, including its name, data offsets, and maximum sizes, as well as function pointers for encoding and decoding operations. The file is intended for internal use within the system and is not meant to be used directly by external modules, as indicated by the presence of the [`fd_sysvar_obj_restore`](<#fd_sysvar_obj_restore>) function, which is marked for internal use only.
# Imports and Dependencies

---
- `fd_sysvar_cache.h`
- `../fd_system_ids_pp.h`
- `../../../util/tmpl/fd_map_perfect.c`


# Global Variables

---
### fd\_sysvar\_pos\_tbl
- **Type**: ``fd_sysvar_pos_t const``
- **Description**: An array of `fd_sysvar_pos_t` structures that define the position and size of various system variables in a cache. Each entry in the array corresponds to a specific system variable, providing metadata such as name, data offset, object offset, maximum data size, and maximum object size.
- **Use**: Used to map system variable indices to their respective positions and sizes in the system variable cache.


---
### fd\_sysvar\_key\_tbl
- **Type**: ``fd_pubkey_t const` array`
- **Description**: An array of constant public keys, `fd_sysvar_key_tbl` maps system variable indices to their corresponding system variable IDs. Each entry in the array is a `fd_pubkey_t` structure initialized with a specific system variable ID.
- **Use**: Used to associate system variable indices with their respective system variable IDs in a cache.


# Data Structures

---
### sysvar\_lut
- **Type**: ``struct``
- **Members**:
    - `key`: Stores a public key of type `fd_pubkey_t`.
    - `desc_idx`: Holds an unsigned character that serves as an index for description.
- **Description**: Defines a structure used to map system variable IDs to cache slots, utilizing a public key and an index for efficient lookup and retrieval.


---
### sysvar\_tbl\_t
- **Type**: ``struct``
- **Members**:
    - `key`: Stores the public key associated with a system variable.
    - `desc_idx`: Holds an index that describes the system variable.
- **Description**: `sysvar_tbl_t` is a typedef for `struct sysvar_lut`, which is part of a perfect hash table implementation that maps system variable IDs to cache slots. It contains a public key (`key`) and a descriptor index (`desc_idx`) to facilitate the lookup and management of system variables in a cache.


---
### fd\_sysvar\_pos
- **Type**: ``struct``
- **Members**:
    - `data_off`: Raw data offset relative to the start of the sysvar cache.
    - `obj_off`: Typed object offset relative to the start of the sysvar cache.
    - `data_max`: Maximum size of the raw data.
    - `obj_max`: Maximum size of the typed object.
    - `name`: Name of the sysvar.
    - `decode_footprint`: Function pointer to decode the footprint of the sysvar.
    - `decode`: Function pointer to decode the sysvar into memory.
    - `encode`: Function pointer to encode the sysvar from memory.
- **Description**: Defines the offsets, sizes, and encoding/decoding functions for a sysvar within a cache, allowing for efficient access and manipulation of serialized and typed representations of system variables.


---
### fd\_sysvar\_pos\_t
- **Type**: ``struct fd_sysvar_pos``
- **Members**:
    - ``data_off``: Raw data offset relative to the start of the sysvar cache.
    - ``obj_off``: Typed object offset relative to the start of the sysvar cache.
    - ``data_max``: Maximum size of the raw data.
    - ``obj_max``: Maximum size of the typed object.
    - ``name``: Name of the sysvar.
    - ``decode_footprint``: Function pointer to decode the footprint of the sysvar.
    - ``decode``: Function pointer to decode the sysvar from serialized data.
    - ``encode``: Function pointer to encode the sysvar into serialized data.
- **Description**: Defines the position and characteristics of a system variable (sysvar) within a cache, including offsets, maximum sizes, and function pointers for encoding and decoding operations.


# Function Declarations (Public API)

---
### fd\_sysvar\_obj\_restore<!-- {{#callable_declaration:fd_sysvar_obj_restore}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_cache_private.h#L141>)

Restores a typed representation of a sysvar from serialized data.
- **Description**: Use this function to restore a sysvar's typed representation from its serialized data in the cache. This function is typically called internally when sysvar data is updated directly. Ensure that the `cache` and `desc` pointers are valid and that `pos` correctly describes the sysvar's position and decoding functions. The function will validate the sysvar and update its flags accordingly. It handles cases where the sysvar is directly stored or requires deserialization, and it returns error codes if decoding fails or if the object size exceeds the maximum allowed.
- **Inputs**:
    - `cache`: A pointer to `fd_sysvar_cache_t` where the sysvar data is stored. Must not be null.
    - `desc`: A pointer to `fd_sysvar_desc_t` that describes the sysvar. Must not be null.
    - `pos`: A constant pointer to `fd_sysvar_pos_t` that provides the offsets and decoding functions for the sysvar. Must not be null and must correctly describe the sysvar's position in the cache.
- **Output**: Returns 0 on success. Returns `EINVAL` if decoding fails or `ENOMEM` if the object size exceeds the maximum allowed.
- **See Also**: [`fd_sysvar_obj_restore`](<fd_sysvar_cache.c.md#fd_sysvar_obj_restore>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)