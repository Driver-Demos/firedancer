<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines and manages the clock sysvar for network time approximation, including initialization, updating, and reading functions.

# Purpose
The code is a C header file that defines the interface for managing a clock system variable (`sysvar`) in a network environment. This `sysvar` provides an approximate measure of network time, which is crucial for synchronizing operations across distributed systems. The file includes definitions and function prototypes necessary for initializing, updating, writing, and reading the clock `sysvar`. It specifies constants such as `FD_SYSVAR_CLOCK_DEFAULT_TICKS_PER_SECOND` and `FD_SYSVAR_CLOCK_DEFAULT_HASHES_PER_TICK`, which are used to configure the clock's behavior.

The header file defines several functions: [`fd_sysvar_clock_init`](<#fd_sysvar_clock_init>) initializes the clock `sysvar` to its genesis state, [`fd_sysvar_clock_update`](<#fd_sysvar_clock_update>) updates the clock `sysvar` and should be called at the start of every slot, [`fd_sysvar_clock_write`](<#fd_sysvar_clock_write>) writes the current clock `sysvar` value, and [`fd_sysvar_clock_read`](<#fd_sysvar_clock_read>) reads the current value from the system. The file also defines a temporary structure `ts_est_ele_t` used for sorting vote accounts by the last vote timestamp, which is part of the clock `sysvar` calculation. This header file is intended to be included in other C source files that require access to the clock `sysvar` functionalities.
# Imports and Dependencies

---
- `../../types/fd_types.h`
- `../../accdb/fd_accdb_user.h`


# Data Structures

---
### ts\_est\_ele\_t
- **Type**: ``struct``
- **Members**:
    - ``timestamp``: Stores the last vote timestamp as a `long` integer.
    - ``stake``: Holds the stake value as a `uint128`, matching the Agave specification.
- **Description**: Used temporarily to sort vote accounts by their last vote timestamp for clock sysvar calculations, `ts_est_ele_t` contains a `timestamp` for the last vote and a `stake` value, which is a 128-bit unsigned integer.


# Function Declarations (Public API)

---
### fd\_sysvar\_clock\_init<!-- {{#callable_declaration:fd_sysvar_clock_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_clock.h#L32>)

Initializes the sysvar account to genesis state.
- **Description**: Use this function to set the clock sysvar account to its initial state, representing the genesis of the network. This function must be called before any updates to the clock sysvar account are made. It prepares the account with initial values such as the current slot and timestamp. Ensure that the `bank`, `accdb`, `xid`, and `capture_ctx` parameters are correctly initialized and valid before calling this function.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure used for capturing context. Must not be null.
- **Output**: None
- **See Also**: [`fd_sysvar_clock_init`](<fd_sysvar_clock.c.md#fd_sysvar_clock_init>)  (Implementation)


---
### fd\_sysvar\_clock\_update<!-- {{#callable_declaration:fd_sysvar_clock_update}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_clock.h#L45>)

Updates the clock sysvar account.
- **Description**: Use this function to update the clock sysvar account at the start of every slot before execution begins. It calculates a stake-weighted timestamp and updates the sysvar account accordingly. The function requires a pointer to the parent epoch, which is the epoch of the parent slot. If the parent epoch is not available, pass NULL for genesis bootup. The function will terminate the process with an error log if it fails.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure used for capturing context. Must not be null.
    - `runtime_stack`: A pointer to an `fd_runtime_stack_t` structure representing the runtime stack. Must not be null.
    - `parent_epoch`: A pointer to a constant `ulong` representing the epoch of the parent slot. Can be null for genesis bootup.
- **Output**: None
- **See Also**: [`fd_sysvar_clock_update`](<fd_sysvar_clock.c.md#fd_sysvar_clock_update>)  (Implementation)


---
### fd\_sysvar\_clock\_write<!-- {{#callable_declaration:fd_sysvar_clock_write}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_clock.h#L55>)

Writes the current value of the clock sysvar to funk.
- **Description**: Use this function to update the clock sysvar in the funk database with the current clock value. This function is typically called when there is a need to persist the current state of the clock sysvar. Ensure that all input parameters are valid and initialized before calling this function. The function logs an error and terminates the process if encoding the clock sysvar fails.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure. Must not be null. Represents the bank context in which the operation is performed.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure. Must not be null. Represents the account database context.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure. Must not be null. Represents the transaction ID for the operation.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure. Must not be null. Represents the capture context for the operation.
    - `clock`: A pointer to an `fd_sol_sysvar_clock_t` structure. Must not be null. Contains the current clock sysvar value to be written.
- **Output**: None
- **See Also**: [`fd_sysvar_clock_write`](<fd_sysvar_clock.c.md#fd_sysvar_clock_write>)  (Implementation)


---
### fd\_sysvar\_clock\_read<!-- {{#callable_declaration:fd_sysvar_clock_read}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_clock.h#L66>)

Reads the current value of the clock sysvar from funk.
- **Description**: Use this function to obtain the current value of the clock sysvar from the specified funk. It is important to ensure that the account exists in funk and has non-zero lamports; otherwise, the function will return NULL. This function is useful when you need to access the clock sysvar for operations that depend on network time. Ensure that the `funk` and `xid` parameters are valid and initialized before calling this function.
- **Inputs**:
    - `funk`: A pointer to an `fd_funk_t` structure representing the funk from which to read the clock sysvar. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `clock`: A pointer to an `fd_sol_sysvar_clock_t` structure where the function will store the read clock sysvar value. Must not be null.
- **Output**: Returns a pointer to the `fd_sol_sysvar_clock_t` structure containing the clock sysvar value if successful, or NULL if the account does not exist or has zero lamports.
- **See Also**: [`fd_sysvar_clock_read`](<fd_sysvar_clock.c.md#fd_sysvar_clock_read>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)