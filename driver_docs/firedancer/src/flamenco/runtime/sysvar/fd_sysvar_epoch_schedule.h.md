<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Methods and constants for managing epoch schedules in the Solana runtime, including initialization, reading, writing, and deriving epoch configurations.

# Purpose
The `fd_sysvar_epoch_schedule` header file defines functions and constants related to the management of epoch schedules within the Solana runtime environment. An epoch in Solana is a sequence of slots, and each slot is assigned an epoch number. The file provides methods to calculate and manage these epoch numbers, which are crucial for the operation of the Solana blockchain. The epoch schedule is divided into a warmup period, where the length of epochs increases exponentially, and a constant period, where the epoch length remains fixed. Constants such as `FD_EPOCH_LEN_MIN` and `FD_EPOCH_LEN_MAX` define the minimum and maximum lengths of an epoch, respectively.

The file includes several function prototypes for initializing, reading, writing, and deriving epoch schedules. Functions like [`fd_sysvar_epoch_schedule_init`](<#fd_sysvar_epoch_schedule_init>), [`fd_sysvar_epoch_schedule_read`](<#fd_sysvar_epoch_schedule_read>), and [`fd_sysvar_epoch_schedule_write`](<#fd_sysvar_epoch_schedule_write>) manage the epoch schedule sysvar account, which stores epoch scheduling constants. The function [`fd_epoch_schedule_derive`](<#fd_epoch_schedule_derive>) is used to create new epoch schedule configurations based on specified parameters. Additionally, utility functions such as [`fd_epoch_slot_cnt`](<#fd_epoch_slot_cnt>), [`fd_epoch_slot0`](<#fd_epoch_slot0>), and [`fd_slot_to_epoch`](<#fd_slot_to_epoch>) provide mechanisms to calculate the number of slots in an epoch, the starting slot of an epoch, and the epoch number for a given slot, respectively. These functions are essential for maintaining the integrity and efficiency of epoch-related operations in the Solana protocol.
# Imports and Dependencies

---
- `../../fd_flamenco_base.h`
- `../fd_bank.h`


# Function Declarations (Public API)

---
### fd\_sysvar\_epoch\_schedule\_init<!-- {{#callable_declaration:fd_sysvar_epoch_schedule_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L55>)

Initialize the epoch schedule sysvar account.
- **Description**: Use this function to set up the epoch schedule sysvar account in the context of a Solana runtime environment. This function must be called with valid pointers to a bank, an account database user, a transaction ID, and a capture context. It is typically used during the initialization phase of a Solana node or when setting up a new epoch schedule. Ensure that all input pointers are valid and properly initialized before calling this function.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database user. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure representing the capture context. Must not be null.
- **Output**: None
- **See Also**: [`fd_sysvar_epoch_schedule_init`](<fd_sysvar_epoch_schedule.c.md#fd_sysvar_epoch_schedule_init>)  (Implementation)


---
### fd\_sysvar\_epoch\_schedule\_read<!-- {{#callable_declaration:fd_sysvar_epoch_schedule_read}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L70>)

Reads the current epoch schedule from the specified account.
- **Description**: Use this function to obtain the current epoch schedule from a specified account in the `funk` database. It is important to ensure that the account exists and has a non-zero lamport balance; otherwise, the function will return `NULL`. This function is useful when you need to access epoch scheduling constants for epoch-related calculations. Ensure that the `funk` database is properly initialized and that the transaction ID (`xid`) is valid before calling this function.
- **Inputs**:
    - `funk`: A pointer to the `fd_funk_t` database from which to read the epoch schedule. Must not be null.
    - `xid`: A pointer to a `fd_funk_txn_xid_t` representing the transaction ID. Must not be null.
    - `out`: A pointer to an `fd_epoch_schedule_t` structure where the epoch schedule will be stored. Must not be null.
- **Output**: Returns a pointer to the `fd_epoch_schedule_t` structure containing the epoch schedule if successful, or `NULL` if the account does not exist or has zero lamports.
- **See Also**: [`fd_sysvar_epoch_schedule_read`](<fd_sysvar_epoch_schedule.c.md#fd_sysvar_epoch_schedule_read>)  (Implementation)


---
### fd\_sysvar\_epoch\_schedule\_write<!-- {{#callable_declaration:fd_sysvar_epoch_schedule_write}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L78>)

Writes the current epoch schedule sysvar to the specified bank.
- **Description**: Use this function to update the epoch schedule sysvar in the specified bank. This function encodes the provided epoch schedule and updates the sysvar account with the encoded data. It is important to ensure that the `epoch_schedule` parameter is valid and properly initialized before calling this function. The function does not return a value, and it is expected to be called when the epoch schedule needs to be written to the bank.
- **Inputs**:
    - `bank`: A pointer to an `fd_bank_t` structure representing the bank where the epoch schedule sysvar will be written. Must not be null.
    - `accdb`: A pointer to an `fd_accdb_user_t` structure representing the account database user. Must not be null.
    - `xid`: A pointer to a constant `fd_funk_txn_xid_t` structure representing the transaction ID. Must not be null.
    - `capture_ctx`: A pointer to an `fd_capture_ctx_t` structure used for capturing context. Must not be null.
    - `epoch_schedule`: A pointer to a constant `fd_epoch_schedule_t` structure representing the epoch schedule to be written. Must not be null and should be properly initialized.
- **Output**: None
- **See Also**: [`fd_sysvar_epoch_schedule_write`](<fd_sysvar_epoch_schedule.c.md#fd_sysvar_epoch_schedule_write>)  (Implementation)


---
### fd\_epoch\_schedule\_derive<!-- {{#callable_declaration:fd_epoch_schedule_derive}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L98>)

Derives an epoch schedule configuration from given parameters.
- **Description**: Use this function to create a new epoch schedule configuration based on specified parameters. It initializes the provided `schedule` structure with the given epoch length, leader schedule slot offset, and warmup settings. The function requires a valid `epoch_len` greater than or equal to `FD_EPOCH_LEN_MIN`. If `epoch_len` is too small, the function returns `NULL` and logs a warning. The `warmup` parameter determines if a warmup period is included, affecting the calculation of the first normal epoch and slot. This function is essential for setting up epoch schedules in the Solana runtime.
- **Inputs**:
    - `schedule`: A pointer to an `fd_epoch_schedule_t` structure to be initialized. Must not be null. Caller retains ownership.
    - `epoch_len`: The target slot count per epoch. Must be greater than or equal to `FD_EPOCH_LEN_MIN`. If less, the function returns `NULL`.
    - `leader_schedule_slot_offset`: The number of slots before the start of an epoch to generate the leader schedule. Must be a valid unsigned long value.
    - `warmup`: An integer indicating whether to enable a warmup period (0 for disabled, 1 for enabled).
- **Output**: Returns the initialized `fd_epoch_schedule_t` structure on success, or `NULL` if `epoch_len` is too small.
- **See Also**: [`fd_epoch_schedule_derive`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_schedule_derive>)  (Implementation)


---
### fd\_epoch\_slot\_cnt<!-- {{#callable_declaration:fd_epoch_slot_cnt}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L107>)

Returns the number of slots in a specified epoch.
- **Description**: Use this function to determine the number of slots in a given epoch based on the provided epoch schedule configuration. It is important to note that if the specified epoch is before the first normal epoch, the function calculates the slot count using an exponential growth model. Otherwise, it returns the constant slot count for epochs in the normal period. This function assumes that the schedule is properly initialized and that the epoch number is valid.
- **Inputs**:
    - `schedule`: A pointer to a constant `fd_epoch_schedule_t` structure that contains the epoch schedule configuration. Must not be null.
    - `epoch`: An unsigned long integer representing the epoch number for which the slot count is requested. Must be a valid epoch number.
- **Output**: Returns the number of slots in the specified epoch as an unsigned long integer. The value is greater than zero.
- **See Also**: [`fd_epoch_slot_cnt`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot_cnt>)  (Implementation)


---
### fd\_epoch\_slot0<!-- {{#callable_declaration:fd_epoch_slot0}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L114>)

Returns the absolute slot number of the first slot in an epoch.
- **Description**: Use this function to find the starting slot number of a specified epoch based on the given epoch schedule. This is useful for determining the slot boundaries within an epoch. Ensure that the `schedule` parameter is properly initialized and represents a valid epoch schedule configuration. The function handles both warmup and constant periods of the epoch schedule.
- **Inputs**:
    - `schedule`: A pointer to a constant `fd_epoch_schedule_t` structure that defines the epoch schedule. Must not be null and should be initialized with valid epoch scheduling data.
    - `epoch`: An unsigned long integer representing the epoch number for which the first slot number is to be calculated. Valid values depend on the epoch schedule configuration.
- **Output**: Returns an unsigned long integer representing the absolute slot number of the first slot in the specified epoch.
- **See Also**: [`fd_epoch_slot0`](<fd_sysvar_epoch_schedule.c.md#fd_epoch_slot0>)  (Implementation)


---
### fd\_slot\_to\_epoch<!-- {{#callable_declaration:fd_slot_to_epoch}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L123>)

Returns the epoch number for a given slot.
- **Description**: Use this function to find the epoch number that contains a specific slot number within a given epoch schedule. This function also optionally provides the offset of the slot within its epoch if `out_offset_opt` is not null. Ensure that the `slots_per_epoch` field in the `schedule` is not zero before calling this function, as this will result in undefined behavior.
- **Inputs**:
    - `schedule`: A pointer to a `fd_epoch_schedule_t` structure that defines the epoch schedule. The `slots_per_epoch` field must not be zero.
    - `slot`: An unsigned long integer representing the slot number for which the epoch number is to be determined.
    - `out_offset_opt`: An optional pointer to an unsigned long where the function will store the number of slots preceding the given slot in the same epoch. If null, this information is not returned.
- **Output**: Returns the epoch number as an unsigned long. If `out_offset_opt` is not null, it also writes the slot offset within the epoch to the location pointed to by `out_offset_opt`.
- **See Also**: [`fd_slot_to_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_epoch>)  (Implementation)


---
### fd\_slot\_to\_leader\_schedule\_epoch<!-- {{#callable_declaration:fd_slot_to_leader_schedule_epoch}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar_epoch_schedule.h#L128>)

Calculates the leader schedule epoch for a given slot.
- **Description**: Use this function to determine the leader schedule epoch for a specific slot based on the provided epoch schedule. This is useful when you need to know the epoch in which the leader schedule for a given slot is applicable. The function assumes that the epoch schedule is correctly initialized and that the slot number is valid. If the slot is before the first normal slot, the function calculates the epoch using a different method. Ensure that the `schedule` parameter is not null before calling this function.
- **Inputs**:
    - `schedule`: A pointer to a `fd_epoch_schedule_t` structure that contains the epoch scheduling constants. Must not be null.
    - `slot`: An unsigned long integer representing the slot number for which the leader schedule epoch is to be calculated. Must be a valid slot number.
- **Output**: Returns the leader schedule epoch as an unsigned long integer for the given slot.
- **See Also**: [`fd_slot_to_leader_schedule_epoch`](<fd_sysvar_epoch_schedule.c.md#fd_slot_to_leader_schedule_epoch>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)