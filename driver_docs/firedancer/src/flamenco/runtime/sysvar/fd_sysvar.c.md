<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for updating system variable accounts and checking instruction account validity in a bank system.

# Purpose
The code defines two functions, [`fd_sysvar_account_update`](<#fd_sysvar_account_update>) and [`fd_sysvar_instr_acct_check`](<#fd_sysvar_instr_acct_check>), which are part of a system for managing financial transactions and account updates in a banking context. The [`fd_sysvar_account_update`](<#fd_sysvar_account_update>) function updates a system variable account within a bank. It calculates the minimum balance required for rent exemption, updates account details such as lamports (a unit of currency), owner, slot, and data, and handles potential overflow in lamport calculations. It also updates the hash of the account to maintain data integrity and logs the update process. This function interacts with various components such as `fd_bank_t`, `fd_accdb_user_t`, and `fd_funk_txn_xid_t`, indicating its role in a larger transaction processing system.

The [`fd_sysvar_instr_acct_check`](<#fd_sysvar_instr_acct_check>) function verifies that a given account index in a transaction matches an expected public key. It checks if the index is within the bounds of the account keys in the transaction context and compares the actual account key with the expected one. If the index is out of bounds or the keys do not match, it returns an error code. Otherwise, it returns a success code. This function is used to ensure the correctness of account references in transaction instructions, contributing to the security and accuracy of transaction processing.
# Imports and Dependencies

---
- `fd_sysvar.h`
- `../fd_system_ids.h`
- `../fd_hashes.h`
- `fd_sysvar_rent.h`


# Functions

---
### fd\_sysvar\_account\_update<!-- {{#callable:fd_sysvar_account_update}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar.c#L8>)

Updates a system variable account with new data and adjusts its balance to meet minimum requirements.
- **Inputs**:
    - `bank`: A pointer to the `fd_bank_t` structure representing the bank context.
    - `accdb`: A pointer to the `fd_accdb_user_t` structure representing the account database.
    - `xid`: A pointer to the `fd_funk_txn_xid_t` structure representing the transaction ID.
    - `capture_ctx`: A pointer to the `fd_capture_ctx_t` structure used for capturing context.
    - `address`: A pointer to the `fd_pubkey_t` structure representing the public key address of the account.
    - `data`: A pointer to the data to be set in the account.
    - `sz`: The size of the data to be set in the account.
- **Logic and Control Flow**:
    - Query the rent information from the bank and calculate the minimum balance required for rent exemption based on the data size.
    - Initialize a transaction account record from the account database using the provided address and transaction ID.
    - Calculate the previous hash of the account's metadata and data.
    - Retrieve the current slot from the bank and the current lamports (balance) of the account.
    - Set the account's lamports to the maximum of the current lamports and the minimum balance required.
    - Set the account's owner to the system variable owner ID, update the slot, and set the new data.
    - Check for overflow in lamports calculation and log a critical error if overflow occurs.
    - If lamports were minted, update the bank's capitalization; otherwise, ensure no balance change occurred.
    - Update the account's hash with the new data and finalize the mutable transaction account.
- **Output**: No direct output is returned, but the function updates the account's data, balance, and other metadata in the bank and account database.
- **Functions Called**:
    - [`fd_rent_exempt_minimum_balance`](<fd_sysvar_rent1.c.md#fd_rent_exempt_minimum_balance>)


---
### fd\_sysvar\_instr\_acct\_check<!-- {{#callable:fd_sysvar_instr_acct_check}} -->
[View Source →](<../../../../../../src/flamenco/runtime/sysvar/fd_sysvar.c#L56>)

Checks if the account index and public key in the instruction context match the expected values.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_instr_ctx_t` structure that contains the execution instruction context.
    - `idx`: An unsigned long integer representing the index of the account to check within the instruction context.
    - `addr_want`: A pointer to a constant `fd_pubkey_t` structure representing the expected public key address.
- **Logic and Control Flow**:
    - Check if `idx` is greater than or equal to the number of accounts in `ctx->instr->acct_cnt`; if true, return `FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS`.
    - Retrieve the index of the account in the transaction using `ctx->instr->accounts[idx].index_in_transaction`.
    - Get the actual public key address from `ctx->txn_ctx->account_keys` using the retrieved index.
    - Compare the actual public key address with `addr_want` using `memcmp`; if they do not match, return `FD_EXECUTOR_INSTR_ERR_INVALID_ARG`.
    - If all checks pass, return `FD_EXECUTOR_INSTR_SUCCESS`.
- **Output**: Returns an integer status code indicating success or the type of error encountered.



---
Made with ❤️ by [Driver](https://www.driver.ai/)