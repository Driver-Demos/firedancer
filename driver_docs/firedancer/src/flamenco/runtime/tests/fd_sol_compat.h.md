<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a stable ABI for testing Firedancer SVM components with solfuzz, including initialization and execution functions.

# Purpose
The code defines a C header file that provides an interface for compatibility testing with the Firedancer SVM (Solana Virtual Machine) components. It includes function prototypes and data structures that facilitate the execution of test vectors and the management of feature sets. The file is intended for use in fuzzing and testing engines, such as `solfuzz`, to invoke Firedancer SVM components. The code is organized into several APIs: the Admin API, Features API, and Execution API, each serving a specific purpose in the testing process.

The Admin API includes functions like [`sol_compat_init`](<#sol_compat_init>) and [`sol_compat_fini`](<#sol_compat_fini>), which manage the setup and teardown of the testing environment. The Features API defines a structure, `sol_compat_features_t`, to store and retrieve supported feature sets. The Execution API provides several `execute_v1` functions that process Protobuf-encoded input messages and produce corresponding output messages. These functions are designed to test various aspects of the Firedancer SVM, such as instruction execution, transaction processing, and system calls. The code relies on global variables, which limits its use to single-threaded, single-session contexts.
# Imports and Dependencies

---
- `../../fd_flamenco_base.h`


# Global Variables

---
### FD\_PROTOTYPES\_BEGIN
- **Type**: `Macro`
- **Description**: `FD_PROTOTYPES_BEGIN` is a macro used to mark the beginning of a section in the code where function prototypes are declared. It is typically used to manage the organization of code and ensure that function declarations are properly encapsulated.
- **Use**: Used to indicate the start of a block of function prototypes in the code.


---
### out\_sz
- **Type**: `ulong *`
- **Description**: `out_sz` is a pointer to an unsigned long integer that represents the size of the output buffer in bytes. It is used in the `sol_compat_instr_execute_v1` function to store the capacity of the output buffer before execution and the size of the serialized output message after execution.
- **Use**: Stores the capacity and the resulting size of the serialized output message in the `sol_compat_instr_execute_v1` function.


---
### in
- **Type**: ``uchar const *``
- **Description**: Points to a byte array of `in_sz` bytes containing a Protobuf-encoded input message.
- **Use**: Used as an input parameter for functions that execute a single input against a Firedancer SVM component.


---
### ulong
- **Type**: `ulong`
- **Description**: `ulong` is a data type that represents an unsigned long integer. It is typically used to store large non-negative integer values.
- **Use**: Used to define variables that store large non-negative integer values, such as sizes or counts.


# Data Structures

---
### sol\_compat\_features\_t
- **Type**: ``struct``
- **Members**:
    - ``struct_size``: Used for ABI versioning.
    - ``hardcoded_features``: Points to a vector of hardcoded features.
    - ``hardcoded_features_cnt``: Stores the count of hardcoded features.
    - ``supported_features``: Points to a vector of supported features.
    - ``supported_feature_cnt``: Stores the count of supported features.
- **Description**: A compressed feature set storage format where `hardcoded_features` and `supported_features` point to vectors of features, each entry containing the first 8 bytes of the feature gate account address as a little-endian 64-bit integer.


# Function Declarations (Public API)

---
### sol\_compat\_init<!-- {{#callable_declaration:sol_compat_init}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L23>)

Installs a new solfuzz execution context into the current process.
- **Description**: Use this function to set up the necessary environment for executing solfuzz APIs. It allocates demand-paged memory and initializes data structures required for solfuzz operations. This function must be called before any other solfuzz API functions to ensure proper setup. It is important to note that this setup relies on global variables, which means it does not support multiple sessions or multi-threading. Calling this function multiple times without finalizing the previous setup will result in an error.
- **Inputs**:
    - `log_level`: Specifies the logging level for the solfuzz execution context. Valid values are integers that correspond to the desired logging verbosity. The function sets the log level for the logfile and core logging. Invalid values may result in unexpected logging behavior.
- **Output**: None
- **See Also**: [`sol_compat_init`](<fd_sol_compat.c.md#sol_compat_init>)  (Implementation)


---
### sol\_compat\_fini<!-- {{#callable_declaration:sol_compat_fini}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L36>)

Releases all resources allocated by the solfuzz execution context.
- **Description**: Use this function to clean up and release all resources allocated by the solfuzz execution context back to the kernel. It should be called after all solfuzz operations are complete and no further solfuzz API calls will be made. This function undoes the setup performed by `sol_compat_init`, ensuring that memory allocations and file handles are properly released. It is important to call this function to prevent resource leaks. This function is not thread-safe and should not be used in a multi-threaded context.
- **Inputs**: None
- **Output**: None
- **See Also**: [`sol_compat_fini`](<fd_sol_compat.c.md#sol_compat_fini>)  (Implementation)


---
### sol\_compat\_get\_features\_v1<!-- {{#callable_declaration:sol_compat_get_features_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L59>)

Returns the feature set supported by the current Firedancer SVM build.
- **Description**: Use this function to obtain a pointer to a `sol_compat_features_t` structure that contains the features supported by the current Firedancer SVM build. This function does not require any parameters and can be called at any time after the initialization of the solfuzz execution context. The returned structure includes both hardcoded and supported features, which are represented as vectors of 64-bit integers. The function is thread-safe and can be called multiple times, returning the same feature set each time.
- **Inputs**: None
- **Output**: A pointer to a `sol_compat_features_t` structure containing the supported feature set.
- **See Also**: [`sol_compat_get_features_v1`](<fd_sol_compat.c.md#sol_compat_get_features_v1>)  (Implementation)


---
### sol\_compat\_txn\_execute\_v1<!-- {{#callable_declaration:sol_compat_txn_execute_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L87>)

Executes a transaction against a Firedancer SVM component.
- **Description**: Use this function to execute a single transaction input against a Firedancer SVM component. The input must be a Protobuf-encoded message, and the function will write the Protobuf-encoded output message to the provided output buffer. Ensure that the `sol_compat_init` function has been called before using this function, as it relies on the global setup. The function does not support multi-threading or multiple sessions due to its reliance on global variables. The caller must provide a buffer for the output and specify its capacity. The function will update the output size to reflect the actual size of the serialized output message.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. The caller must allocate this buffer and ensure it is large enough to hold the output.
    - `out_sz`: A pointer to a variable that initially contains the capacity of the `out` buffer. On return, it will be updated to the size of the serialized output message. Must not be null.
    - `in`: A pointer to a byte array containing the Protobuf-encoded input message. Must not be null.
    - `in_sz`: The size of the input message in bytes. Must be greater than zero.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero).
- **See Also**: [`sol_compat_txn_execute_v1`](<fd_sol_compat.c.md#sol_compat_txn_execute_v1>)  (Implementation)


---
### sol\_compat\_block\_execute\_v1<!-- {{#callable_declaration:sol_compat_block_execute_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L93>)

Executes a block of input data against a Firedancer SVM component.
- **Description**: Use this function to execute a block of input data encoded in Protobuf format against a Firedancer SVM component. The function requires prior initialization with `sol_compat_init` and is not thread-safe due to reliance on global variables. It writes the Protobuf-encoded output to the provided buffer and updates the buffer size. Ensure the output buffer is large enough to hold the result. The function returns an integer indicating success or failure of the execution.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. The caller must ensure this buffer is sufficiently large to hold the output.
    - `out_sz`: A pointer to an unsigned long that initially contains the capacity of the `out` buffer. On return, it contains the size of the serialized output message. The caller must provide a valid pointer.
    - `in`: A pointer to a byte array containing the Protobuf-encoded input message. The input data must be valid and properly formatted.
    - `in_sz`: The size of the input data in bytes. Must accurately reflect the size of the data pointed to by `in`.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero) of the execution. On success, `out` contains the encoded output message and `*out_sz` is updated with the size of this message.
- **See Also**: [`sol_compat_block_execute_v1`](<fd_sol_compat.c.md#sol_compat_block_execute_v1>)  (Implementation)


---
### sol\_compat\_elf\_loader\_v1<!-- {{#callable_declaration:sol_compat_elf_loader_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L99>)

Executes a Protobuf-encoded ELF loader input against a Firedancer SVM component.
- **Description**: Use this function to execute a Protobuf-encoded ELF loader input message against a Firedancer SVM component. The function writes the Protobuf-encoded output message to the provided output buffer. Ensure that the `sol_compat_init` function is called before using this function to set up the necessary execution context. The function is not thread-safe and relies on global variables, so it does not support multiple sessions or concurrent execution. The caller must provide a sufficiently large output buffer to store the result.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. The caller must ensure this buffer is large enough to hold the output.
    - `out_sz`: A pointer to a variable that initially contains the capacity of the `out` buffer. On return, it will contain the size of the serialized output message, which is guaranteed to be less than or equal to the initial capacity.
    - `in`: A pointer to a byte array containing the Protobuf-encoded input message. The input data must be correctly formatted and non-null.
    - `in_sz`: The size of the input byte array `in`. It must accurately reflect the size of the data in the `in` buffer.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero).
- **See Also**: [`sol_compat_elf_loader_v1`](<fd_sol_compat.c.md#sol_compat_elf_loader_v1>)  (Implementation)


---
### sol\_compat\_vm\_syscall\_execute\_v1<!-- {{#callable_declaration:sol_compat_vm_syscall_execute_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L105>)

Executes a syscall input against a Firedancer SVM component.
- **Description**: Use this function to execute a syscall input message encoded in Protobuf format against a Firedancer SVM component. This function requires prior initialization with `sol_compat_init` and is not thread-safe due to reliance on global variables. The input message is processed, and the function writes the resulting output message, also in Protobuf format, to the provided output buffer. Ensure the output buffer is large enough to hold the result, as specified by the initial value of `out_sz`. The function returns an integer indicating success or failure of the operation.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. Must not be null.
    - `out_sz`: A pointer to an unsigned long that initially contains the capacity of the `out` buffer. On return, it contains the size of the serialized output message. Must not be null.
    - `in`: A pointer to a byte array containing the Protobuf-encoded input message. Must not be null.
    - `in_sz`: The size of the input message in bytes. Must be a valid size for the data pointed to by `in`.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero) of the execution. On success, `out` contains the serialized output message and `*out_sz` is updated with its size.
- **See Also**: [`sol_compat_vm_syscall_execute_v1`](<fd_sol_compat.c.md#sol_compat_vm_syscall_execute_v1>)  (Implementation)


---
### sol\_compat\_vm\_interp\_v1<!-- {{#callable_declaration:sol_compat_vm_interp_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L111>)

Executes a Protobuf-encoded input message against a Firedancer SVM component.
- **Description**: Use this function to execute a single Protobuf-encoded input message against a Firedancer SVM component. The function requires prior initialization with `sol_compat_init` and is not thread-safe due to reliance on global variables. It writes the Protobuf-encoded output message to the provided output buffer. Ensure the output buffer has sufficient capacity as specified by `*out_sz`. The function returns an integer indicating success or failure of the execution.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. The caller must ensure this buffer is allocated and has sufficient capacity.
    - `out_sz`: A pointer to an unsigned long that initially contains the capacity of the `out` buffer. On return, it contains the size of the serialized output message, which will be less than or equal to the initial capacity.
    - `in`: A pointer to a constant byte array containing the Protobuf-encoded input message. The input data must be valid and properly formatted.
    - `in_sz`: An unsigned long representing the size of the input message in bytes. It must accurately reflect the size of the data pointed to by `in`.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero) of the execution. On success, `*out_sz` is updated with the size of the output message.
- **See Also**: [`sol_compat_vm_interp_v1`](<fd_sol_compat.c.md#sol_compat_vm_interp_v1>)  (Implementation)


---
### sol\_compat\_shred\_parse\_v1<!-- {{#callable_declaration:sol_compat_shred_parse_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L117>)

Parses a Protobuf-encoded input message and writes the result to an output buffer.
- **Description**: Use this function to parse a Protobuf-encoded input message and produce a corresponding output message. The input message is provided as a byte array, and the function writes the parsed result to the specified output buffer. Ensure that the `sol_compat_init` function has been called before using this function, as it relies on the global setup. The function does not support multi-threading or multiple sessions due to its reliance on global variables. The caller must provide a buffer for the output and specify its capacity. The function returns an integer indicating success or failure of the parsing operation.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. The caller must ensure this buffer is allocated and has sufficient capacity.
    - `out_sz`: A pointer to an unsigned long that initially contains the capacity of the `out` buffer. On return, it will contain the size of the serialized output message. Must not be null.
    - `in`: A pointer to a byte array containing the Protobuf-encoded input message. Must not be null.
    - `in_sz`: An unsigned long representing the size of the input message in bytes. Must be greater than zero.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero) of the parsing operation.
- **See Also**: [`sol_compat_shred_parse_v1`](<fd_sol_compat.c.md#sol_compat_shred_parse_v1>)  (Implementation)


---
### sol\_compat\_type\_execute\_v1<!-- {{#callable_declaration:sol_compat_type_execute_v1}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_sol_compat.h#L123>)

Executes a single input against a Firedancer SVM component.
- **Description**: Use this function to process a Protobuf-encoded input message and obtain a Protobuf-encoded output message. The input message is provided as a byte array, and the function writes the output message to a specified byte array. Ensure that the `sol_compat_init` function is called before using this function to set up the necessary execution context. The function is not thread-safe and relies on global variables, so it does not support multiple sessions or concurrent execution. The caller must manage the memory for the input and output buffers.
- **Inputs**:
    - `out`: A pointer to a byte array where the function will write the Protobuf-encoded output message. The caller must allocate this buffer and ensure it is large enough to hold the output.
    - `out_sz`: A pointer to a variable that initially contains the capacity of the `out` buffer. On return, it contains the size of the serialized output message. The caller must ensure this pointer is valid.
    - `in`: A pointer to a byte array containing the Protobuf-encoded input message. The caller must ensure this pointer is valid and the data is correctly formatted.
    - `in_sz`: The size of the input message in bytes. Must be a valid size corresponding to the data pointed to by `in`.
- **Output**: Returns an integer indicating success (non-zero) or failure (zero). On success, `out` contains the serialized output message, and `*out_sz` is updated with the size of this message.
- **See Also**: [`sol_compat_type_execute_v1`](<fd_sol_compat.c.md#sol_compat_type_execute_v1>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)