<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements internal executors for testing various fixtures in the Firedancer runtime.

# Purpose
The `fd_solfuzz_exec.c` file contains functions that execute and validate various test fixtures for a fuzz testing framework. The primary purpose of this code is to compare expected and actual outcomes of different execution scenarios, such as transactions, blocks, and system calls, within a Solana-like environment. The file includes functions like [`fd_solfuzz_txn_fixture`](<#fd_solfuzz_txn_fixture>), [`fd_solfuzz_block_fixture`](<#fd_solfuzz_block_fixture>), and [`fd_solfuzz_syscall_fixture`](<#fd_solfuzz_syscall_fixture>), each responsible for decoding input data, executing the corresponding test scenario, and comparing the results against expected outcomes using helper functions like [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>) and [`sol_compat_cmp_txn`](<#sol_compat_cmp_txn>).

The code relies on several external dependencies, including protocol buffer message descriptions and a shared memory allocation system (`fd_spad_t`). It uses these to manage memory and encode/decode data structures. The functions in this file are designed to be part of a larger testing framework, as indicated by the inclusion of headers like `fd_solfuzz_private.h` and `fd_executor_err.h`. The functions log warnings when discrepancies are found between expected and actual results, aiding in the identification of errors during testing.
# Imports and Dependencies

---
- `fd_solfuzz_private.h`
- `generated/block.pb.h`
- `generated/invoke.pb.h`
- `generated/txn.pb.h`
- `generated/vm.pb.h`
- `generated/elf.pb.h`
- `../fd_executor_err.h`
- `assert.h`


# Functions

---
### sol\_compat\_cmp\_binary\_strict<!-- {{#callable:sol_compat_cmp_binary_strict}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L16>)

Compares two binary-encoded data structures for strict equality by encoding them and checking their sizes and contents.
- **Inputs**:
    - `effects`: Pointer to the effects data structure to encode and compare.
    - `expected`: Pointer to the expected data structure to encode and compare.
    - `encode_type`: Pointer to the message descriptor used for encoding.
    - `spad`: Pointer to the scratchpad memory used for temporary allocations.
- **Logic and Control Flow**:
    - Check if `effects` is `NULL`; if so, log a warning and return 0.
    - Allocate memory for `out` using `fd_spad_alloc` with a maximum size of `MAX_SZ`.
    - Encode `effects` into `out` using [`sol_compat_encode`](<fd_solfuzz_private.h.md#sol_compat_encode>); if encoding fails, log a warning and return 0.
    - Allocate memory for `exp` using `fd_spad_alloc` with a maximum size of `MAX_SZ`.
    - Encode `expected` into `exp` using [`sol_compat_encode`](<fd_solfuzz_private.h.md#sol_compat_encode>); if encoding fails, log a warning and return 0.
    - Compare the sizes of `out` and `exp`; if they differ, log a warning and return 0.
    - Compare the contents of `out` and `exp` using `fd_memeq`; if they differ, log a warning and return 0.
    - Return 1 if all checks pass, indicating the binary data structures are strictly equal.
- **Output**: Returns 1 if the binary-encoded data structures are strictly equal, otherwise returns 0.
- **Functions Called**:
    - [`sol_compat_encode`](<fd_solfuzz_private.h.md#sol_compat_encode>)


---
### FD\_SPAD\_FRAME\_BEGIN<!-- {{#callable:sol_compat_cmp_binary_strict::FD_SPAD_FRAME_BEGIN}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L22>)

Compares encoded binary data of effects and expected values using a shared memory allocation and returns a success or failure status.
- **Inputs**:
    - `spad`: A pointer to `fd_spad_t`, which is used for shared memory allocation.
- **Logic and Control Flow**:
    - Check if `effects` is NULL and log a warning if true, then return 0.
    - Allocate memory for `out` using `fd_spad_alloc` with a size of `MAX_SZ`.
    - Encode `effects` into `out` using [`sol_compat_encode`](<fd_solfuzz_private.h.md#sol_compat_encode>) and update `out_sz`. Log a warning and return 0 if encoding fails.
    - Allocate memory for `exp` using `fd_spad_alloc` with a size of `MAX_SZ`.
    - Encode `expected` into `exp` using [`sol_compat_encode`](<fd_solfuzz_private.h.md#sol_compat_encode>) and update `exp_sz`. Log a warning and return 0 if encoding fails.
    - Compare `out_sz` and `exp_sz`. Log a warning and return 0 if they are not equal.
    - Use `fd_memeq` to compare `out` and `exp` for equality. Log a warning and return 0 if they are not equal.
    - Return 1 if all checks pass.
- **Output**: Returns 1 if the encoded binary data of `effects` and `expected` are equal in size and content, otherwise returns 0.
- **Functions Called**:
    - [`sol_compat_encode`](<fd_solfuzz_private.h.md#sol_compat_encode>)


---
### \_diff\_txn\_acct<!-- {{#callable:_diff_txn_acct}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L58>)

Compares two account states and logs warnings if any discrepancies are found, returning 0 for mismatches and 1 if they match.
- **Inputs**:
    - `expected`: A pointer to the expected account state of type `fd_exec_test_acct_state_t`.
    - `actual`: A pointer to the actual account state of type `fd_exec_test_acct_state_t`.
- **Logic and Control Flow**:
    - Asserts that the `address` fields of `expected` and `actual` are equal using `fd_memeq`.
    - Checks if the `lamports` fields are equal; logs a warning and returns 0 if they are not.
    - If either `data` field is non-NULL, checks for NULL mismatches, size mismatches, and content mismatches, logging warnings and returning 0 for any discrepancies.
    - Checks if the `executable` fields are equal; logs a warning and returns 0 if they are not.
    - Checks if the `owner` fields are equal using `fd_memeq`; logs a warning and returns 0 if they are not.
    - Returns 1 if all checks pass without discrepancies.
- **Output**: Returns 1 if the account states match, otherwise returns 0.


---
### \_diff\_resulting\_states<!-- {{#callable:_diff_resulting_states}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L111>)

Compares two resulting states to ensure they have the same account states and count.
- **Inputs**:
    - `expected`: A pointer to the `fd_exec_test_resulting_state_t` structure representing the expected resulting state.
    - `actual`: A pointer to the `fd_exec_test_resulting_state_t` structure representing the actual resulting state.
- **Logic and Control Flow**:
    - Check if the number of account states in `expected` and `actual` are equal; if not, log a warning and return 0.
    - Iterate over each account state in `expected` and `actual` to find matching addresses using `fd_memeq`.
    - For each matching address, call [`_diff_txn_acct`](<#_diff_txn_acct>) to compare the account details; if any comparison fails, return 0.
    - Return 1 if all checks pass, indicating the resulting states match.
- **Output**: Returns 1 if the resulting states match, otherwise returns 0.
- **Functions Called**:
    - [`_diff_txn_acct`](<#_diff_txn_acct>)


---
### sol\_compat\_cmp\_txn<!-- {{#callable:sol_compat_cmp_txn}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L135>)

Compares two transaction results for equality and logs warnings if any discrepancies are found.
- **Inputs**:
    - `expected`: A pointer to the expected `fd_exec_test_txn_result_t` structure.
    - `actual`: A pointer to the actual `fd_exec_test_txn_result_t` structure.
- **Logic and Control Flow**:
    - Check if `executed` fields are equal; log a warning and return 0 if not.
    - Check if `sanitization_error` fields are equal; log a warning and return 0 if not.
    - Call [`_diff_resulting_states`](<#_diff_resulting_states>) to compare `resulting_state` fields; return 0 if they differ.
    - Check if `rent` fields are equal; log a warning and return 0 if not.
    - Check if `is_ok` fields are equal; log a warning and return 0 if not.
    - Check if `status` fields are equal; log a warning and return 0 if not.
    - Check if `instruction_error` fields are equal; log a warning and return 0 if not.
    - If `instruction_error` is true, check `instruction_error_index` and `custom_error` fields; log warnings and return 0 if they differ.
    - Check if `return_data` fields are both non-NULL and compare their sizes and contents; log warnings and return 0 if they differ.
    - Check if `executed_units` fields are equal; log a warning and return 0 if not.
    - Check if `has_fee_details` fields are equal; log a warning and return 0 if not.
    - If `has_fee_details` is true, compare `transaction_fee` and `prioritization_fee` fields; log warnings and return 0 if they differ.
    - Check if `loaded_accounts_data_size` fields are equal; log a warning and return 0 if not.
    - Return 1 if all checks pass.
- **Output**: Returns 1 if all fields match, otherwise returns 0.
- **Functions Called**:
    - [`_diff_resulting_states`](<#_diff_resulting_states>)


---
### fd\_solfuzz\_instr\_fixture<!-- {{#callable:fd_solfuzz_instr_fixture}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L249>)

Executes an instruction fixture, compares the output with expected results, and returns the comparison result.
- **Inputs**:
    - `runner`: A pointer to an `fd_solfuzz_runner_t` structure that manages the execution context.
    - `in`: A pointer to an array of unsigned characters representing the input data for the fixture.
    - `in_sz`: An unsigned long integer representing the size of the input data.
- **Logic and Control Flow**:
    - Initialize a `fd_exec_test_instr_fixture_t` structure named `fixture` to zero.
    - Decode the input data `in` of size `in_sz` into the `fixture` using [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>).
    - If decoding fails, log a warning and return 0.
    - Initialize an integer `ok` to 0 and a void pointer `output` to NULL.
    - Execute the instruction using [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>) with `runner`, `fixture->input`, and `fd_solfuzz_instr_run`.
    - Compare the execution output with the expected output in `fixture->output` using [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>).
    - Store the comparison result in `ok`.
    - Release resources associated with `fixture` using `pb_release`.
    - Return the value of `ok`.
- **Output**: An integer indicating whether the execution output matches the expected output (1 for match, 0 for mismatch).
- **Functions Called**:
    - [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>)
    - [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>)
    - [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>)


---
### fd\_solfuzz\_txn\_fixture<!-- {{#callable:fd_solfuzz_txn_fixture}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L274>)

Executes a transaction fixture, compares the results with expected outcomes, and returns the comparison result.
- **Inputs**:
    - `runner`: A pointer to an `fd_solfuzz_runner_t` structure that manages the execution context.
    - `in`: A pointer to an array of unsigned characters representing the input data for the transaction fixture.
    - `in_sz`: An unsigned long integer representing the size of the input data array.
- **Logic and Control Flow**:
    - Decode the transaction fixture from the input data using [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>) and store it in `fixture`.
    - If decoding fails, log a warning and return 0.
    - Push the current state of the shared memory stack using `fd_spad_push`.
    - Initialize `ok` to 0 and `output` to NULL.
    - Execute the transaction using [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>), passing the input from the fixture and storing the result in `output`.
    - If `output` is not NULL, cast it to `fd_exec_test_txn_result_t` and compare it with the expected output using [`sol_compat_cmp_txn`](<#sol_compat_cmp_txn>), storing the result in `ok`.
    - Pop the shared memory stack state using `fd_spad_pop`.
    - Release the resources allocated for the fixture using `pb_release`.
    - Return the value of `ok`, indicating whether the actual output matches the expected output.
- **Output**: An integer indicating whether the transaction execution results match the expected results (1 for match, 0 for mismatch).
- **Functions Called**:
    - [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>)
    - [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>)
    - [`sol_compat_cmp_txn`](<#sol_compat_cmp_txn>)


---
### fd\_solfuzz\_block\_fixture<!-- {{#callable:fd_solfuzz_block_fixture}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L302>)

Executes a block fixture test by decoding input data, running the test, comparing the output, and cleaning up resources.
- **Inputs**:
    - `runner`: A pointer to an `fd_solfuzz_runner_t` structure that manages the execution context.
    - `in`: A pointer to a constant unsigned character array containing the input data to decode.
    - `in_sz`: An unsigned long integer representing the size of the input data.
- **Logic and Control Flow**:
    - Decode the input data into a `fd_exec_test_block_fixture_t` structure using [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>).
    - If decoding fails, log a warning and return 0.
    - Push the current state of the `spad` stack in the `runner`.
    - Initialize a `void` pointer `output` to `NULL`.
    - Execute the block fixture using [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>) with the decoded input and store the result in `output`.
    - Compare the execution output with the expected output using [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>).
    - Pop the `spad` stack to restore the previous state.
    - Release resources associated with the decoded fixture using `pb_release`.
    - Return the result of the comparison as an integer.
- **Output**: An integer indicating the success (1) or failure (0) of the block fixture test.
- **Functions Called**:
    - [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>)
    - [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>)
    - [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>)


---
### fd\_solfuzz\_elf\_loader\_fixture<!-- {{#callable:fd_solfuzz_elf_loader_fixture}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L325>)

Executes an ELF loader fixture test by decoding input data, running the test, comparing the output, and cleaning up resources.
- **Inputs**:
    - ``runner``: A pointer to an `fd_solfuzz_runner_t` structure, which manages the execution context.
    - ``in``: A pointer to a constant unsigned character array containing the input data for the fixture.
    - ``in_sz``: An unsigned long integer representing the size of the input data.
- **Logic and Control Flow**:
    - Decode the input data into an `fd_exec_test_elf_loader_fixture_t` structure using [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>).
    - If decoding fails, log a warning and return 0.
    - Push the current state of the `spad` stack in the `runner`.
    - Initialize a `void` pointer `output` to `NULL`.
    - Execute the ELF loader test using [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>), passing the decoded input and a function pointer to `fd_solfuzz_elf_loader_run`.
    - Compare the execution output with the expected output using [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>).
    - Pop the `spad` stack to restore the previous state.
    - Release resources allocated for the fixture using `pb_release`.
    - Return the result of the comparison as an integer.
- **Output**: An integer indicating the success (1) or failure (0) of the fixture test.
- **Functions Called**:
    - [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>)
    - [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>)
    - [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>)


---
### fd\_solfuzz\_syscall\_fixture<!-- {{#callable:fd_solfuzz_syscall_fixture}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L348>)

Executes a syscall fixture test by decoding input, running the syscall, and comparing the output to expected results.
- **Inputs**:
    - `runner`: A pointer to an `fd_solfuzz_runner_t` structure that manages the execution context.
    - `in`: A pointer to a constant unsigned character array containing the input data for the fixture.
    - `in_sz`: An unsigned long integer representing the size of the input data.
- **Logic and Control Flow**:
    - Decode the input data into a `fd_exec_test_syscall_fixture_t` structure using [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>).
    - If decoding fails, log a warning and return 0.
    - Push the current state of the runner's scratchpad using `fd_spad_push`.
    - Initialize a `void *` pointer `output` to NULL.
    - Execute the syscall using [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>), passing the runner, fixture input, output pointer, and `fd_solfuzz_syscall_run`.
    - Compare the execution output with the expected output using [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>).
    - Pop the runner's scratchpad state using `fd_spad_pop`.
    - Release resources associated with the fixture using `pb_release`.
    - Return the result of the comparison as an integer.
- **Output**: An integer indicating the success (1) or failure (0) of the syscall fixture test.
- **Functions Called**:
    - [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>)
    - [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>)
    - [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>)


---
### fd\_solfuzz\_vm\_interp\_fixture<!-- {{#callable:fd_solfuzz_vm_interp_fixture}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_solfuzz_exec.c#L370>)

Executes a syscall fixture using a virtual machine interpreter and compares the output to the expected result.
- **Inputs**:
    - `runner`: A pointer to an `fd_solfuzz_runner_t` structure that manages the execution context.
    - `in`: A pointer to a constant unsigned character array that contains the input data for the fixture.
    - `in_sz`: An unsigned long integer representing the size of the input data array.
- **Logic and Control Flow**:
    - Initialize a `fd_exec_test_syscall_fixture_t` structure to zero.
    - Decode the input data into the `fixture` structure using [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>). If decoding fails, log a warning and return 0.
    - Push the current state of the shared memory area (`spad`) onto the stack.
    - Initialize a `void` pointer `output` to `NULL`.
    - Execute the fixture using [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>), passing the `runner`, `fixture->input`, `output`, and `fd_solfuzz_vm_interp_run` as arguments.
    - Compare the execution output with the expected output using [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>).
    - Pop the shared memory area (`spad`) state from the stack.
    - Release the resources allocated for the `fixture` using `pb_release`.
    - Return the result of the comparison (`ok`).
- **Output**: An integer indicating whether the execution output matches the expected output (1 for match, 0 for mismatch).
- **Functions Called**:
    - [`sol_compat_decode_lenient`](<fd_solfuzz_private.h.md#sol_compat_decode_lenient>)
    - [`fd_solfuzz_execute_wrapper`](<fd_solfuzz_private.h.md#fd_solfuzz_execute_wrapper>)
    - [`sol_compat_cmp_binary_strict`](<#sol_compat_cmp_binary_strict>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)