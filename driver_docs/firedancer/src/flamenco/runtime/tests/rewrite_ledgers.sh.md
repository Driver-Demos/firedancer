<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A Bash script for rewriting ledger files with options for input/output locations and version control.

# Purpose
This Bash script automates the process of managing and testing ledger files. It reads a list of ledger test configurations from an input file specified by the `INPUT_LEDGER_LIST` variable and processes each configuration line by line. The script supports command-line options to customize input and output file paths, ledger locations, and other parameters. It uses a `while` loop to parse these options and assigns them to corresponding variables.

The script processes each ledger entry by copying the ledger from the input location to the output location. It checks conditions such as the presence of one-off entries or the cluster version to decide whether to skip certain ledgers. For each ledger, it creates a snapshot using the `agave-ledger-tool` and verifies the ledger up to a specified slot. The script logs the commands used for these operations and appends them to an output file specified by the `OUTPUT_LEDGER_LIST` variable. It also manages snapshots by removing older ones if a newer snapshot is created.

Finally, the script cleans up temporary directories related to the ledger tool, snapshots, and accounts. This ensures that the output directory only contains the necessary files for further processing or testing. The script is designed to be executed in a Unix-like environment with the necessary permissions to read, write, and execute files in the specified directories.
# Global Variables

---
### INPUT\_LEDGER\_LIST
- **Type**: `string`
- **Description**: Contains the name of the file that lists all input ledgers to be processed. The default value is 'run_ledger_tests_all.txt', but it can be overridden by command-line arguments.
- **Use**: Used to read the list of input ledgers for processing in the script.


---
### OUTPUT\_LEDGER\_LIST
- **Type**: ``string``
- **Description**: A global variable that specifies the file name for storing the results of ledger tests. It is initialized with the default value `output_ledger_tests_all.txt`. The variable can be modified through command-line arguments using the `-ol` or `--output-ledger-list` options.
- **Use**: Stores the path to the output file where the script appends the results of ledger tests.


---
### INPUT\_LEDGERS\_LOCATION
- **Type**: `string`
- **Description**: Defines the directory path where input ledger files are located. This variable is used to construct the full path to specific ledger files during processing.
- **Use**: Used to specify the base directory for input ledger files, which are then copied and processed.


---
### OUTPUT\_LEDGERS\_LOCATION
- **Type**: `string`
- **Description**: Specifies the directory path where output ledgers are stored. This variable is used to construct the full path for each output ledger by appending the ledger name to this base path.
- **Use**: Used to define the base directory for storing output ledgers during the script's execution.


---
### AGAVE\_REPO\_DIR
- **Type**: `string`
- **Description**: Specifies the directory path where the Agave repository is located. This variable is used to construct command-line commands that interact with the Agave ledger tool.
- **Use**: Used to define the path for executing Agave ledger tool commands.


---
### VERSION
- **Type**: ``string``
- **Description**: Holds the version number of the cluster. This variable is set through the command-line option `-v` or `--cluster-version`. It is used to compare against the version specified in the ledger entries.
- **Use**: Used to determine if a ledger entry should be skipped based on its cluster version.


---
### LEDGER\_SUFFIX
- **Type**: `string`
- **Description**: Appends a suffix to the output ledger directory name. This suffix is specified by the user through a command-line argument.
- **Use**: Used to differentiate output ledger directories by appending a user-defined suffix to their names.


---
### POSITION\_ARGS
- **Type**: `array`
- **Description**: An array that stores positional arguments passed to the script that do not match any predefined options. These arguments are collected when the script processes command-line inputs.
- **Use**: Used to store and access positional arguments that are not associated with specific options in the script.



---
Made with ❤️ by [Driver](https://www.driver.ai/)