<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for loading account data and restoring features in a runtime fuzz testing environment.

# Purpose
The code defines two functions, [`fd_runtime_fuzz_load_account`](<#fd_runtime_fuzz_load_account>) and [`fd_runtime_fuzz_restore_features`](<#fd_runtime_fuzz_restore_features>), which are part of a C source file. These functions are likely used in a financial or blockchain-related application, as indicated by the use of terms like "account," "lamports," and "features." The [`fd_runtime_fuzz_load_account`](<#fd_runtime_fuzz_load_account>) function initializes an account structure (`fd_txn_account_t`) with data from a given state (`fd_exec_test_acct_state_t`). It checks if the account already exists and ensures that it does not have zero lamports if the `reject_zero_lamports` flag is set. The function sets various properties of the account, such as data, lamports, executable status, owner, and makes the account read-only by default.

The [`fd_runtime_fuzz_restore_features`](<#fd_runtime_fuzz_restore_features>) function is responsible for configuring a set of features (`fd_features_t`) based on a provided feature set (`fd_exec_test_feature_set_t`). It disables all features initially and then enables specific features identified by their IDs. The function logs a warning if an unsupported feature ID is encountered. Both functions return an integer status, indicating success or failure of the operations. The code includes headers for protobuf-generated content, account management, and feature management, suggesting that it is part of a larger system that handles account transactions and feature configurations.
# Imports and Dependencies

---
- `generated/context.pb.h`
- `../fd_acc_mgr.h`
- `../../features/fd_features.h`
- `assert.h`


# Functions

---
### fd\_runtime\_fuzz\_load\_account<!-- {{#callable:fd_runtime_fuzz_load_account}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_harness_common.c#L6>)

Initializes a transaction account with specified state and ensures it does not already exist in the database.
- **Inputs**:
    - `acc`: A pointer to `fd_txn_account_t` where the account data will be loaded.
    - `accdb`: A pointer to `fd_accdb_user_t` representing the account database.
    - `xid`: A constant pointer to `fd_funk_txn_xid_t` representing the transaction ID.
    - `state`: A constant pointer to `fd_exec_test_acct_state_t` containing the account state to load.
    - `reject_zero_lamports`: An unsigned char flag indicating whether to reject accounts with zero lamports.
- **Logic and Control Flow**:
    - Check if `reject_zero_lamports` is true and `state->lamports` is zero; if so, return 0.
    - Determine the size of the account data if `state->data` is not null.
    - Copy the account's public key from `state->address`.
    - Check if the account already exists in the database using `fd_funk_get_acc_meta_readonly`; if it does, return 0.
    - Initialize the account using `fd_txn_account_init_from_funk_mutable` and assert the result is successful.
    - If `state->data` is present, set the account data using `fd_txn_account_set_data`.
    - Set the account's starting lamports, data length, lamports, executable flag, and owner using the respective functions.
    - Make the account read-only by default using `fd_txn_account_set_readonly`.
    - Finalize the account preparation with `fd_txn_account_mutable_fini`.
    - Return 1 to indicate success.
- **Output**: Returns 1 if the account is successfully loaded and initialized, otherwise returns 0.


---
### fd\_runtime\_fuzz\_restore\_features<!-- {{#callable:fd_runtime_fuzz_restore_features}} -->
[View Source →](<../../../../../../src/flamenco/runtime/tests/fd_harness_common.c#L55>)

Restores features by disabling all current features and enabling those specified in the feature set.
- **Inputs**:
    - ``features``: A pointer to an `fd_features_t` structure where features will be restored.
    - ``feature_set``: A pointer to a constant `fd_exec_test_feature_set_t` structure containing the set of features to restore.
- **Logic and Control Flow**:
    - Call `fd_features_disable_all` to disable all features in the `features` structure.
    - Iterate over each feature in `feature_set->features` using a loop.
    - For each feature, retrieve its ID using `fd_feature_id_query`.
    - If the feature ID is not found, log a warning and return 0.
    - If the feature ID is found, enable the feature in `features` using `fd_features_set`.
    - Return 1 after processing all features.
- **Output**: Returns 1 if all features are successfully restored, otherwise returns 0 if an unsupported feature ID is encountered.



---
Made with ❤️ by [Driver](https://www.driver.ai/)