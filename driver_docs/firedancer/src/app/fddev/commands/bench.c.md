<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a command for testing validator TPS benchmarks using multithreading.

# Purpose
The code defines a command function for a benchmarking operation within a development environment. It includes headers from a shared development directory, indicating that it relies on shared components for its functionality. The primary function, [`fddev_bench_cmd_fn`](<#fddev_bench_cmd_fn>), is responsible for executing a benchmark command by calling `bench_cmd_fn` and then creating a new thread to run [`agave_thread_main`](<#agave_thread_main>). This thread executes the [`agave_boot`](<#agave_boot>) function, which is designed to run indefinitely, as indicated by the comment stating that the exit flag is never set to true.

The code also defines an `action_t` structure named `fd_action_bench`, which represents a command action with the name "bench". This structure includes pointers to the function [`fddev_bench_cmd_fn`](<#fddev_bench_cmd_fn>), argument definitions, permission settings, and a description of the action. The description indicates that the purpose of this command is to test the validator transactions per second (TPS) benchmark. The code is structured to be part of a larger system where it can be invoked as a command, likely within a command-line interface or a similar environment.
# Imports and Dependencies

---
- `../../shared_dev/commands/bench/bench.h`
- `../../shared_dev/commands/dev.h`
- `unistd.h`
- `pthread.h`


# Global Variables

---
### fd\_action\_bench
- **Type**: ``action_t``
- **Description**: Defines an action structure for a benchmark command. It includes the name of the action, arguments, a function pointer to execute the command, permission settings, a flag indicating if it is for a local cluster, and a description of the action.
- **Use**: Used to configure and execute a benchmark command within the application.


# Functions

---
### agave\_thread\_main<!-- {{#callable:agave_thread_main}} -->
[View Source →](<../../../../../../src/app/fddev/commands/bench.c#L10>)

Executes the [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>) function in a separate thread and logs an error if it exits.
- **Inputs**:
    - `_args`: A pointer to `config_t` which contains configuration data for the [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>) function.
- **Logic and Control Flow**:
    - Cast `_args` to a `config_t` pointer and store it in `config`.
    - Call the [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>) function with `config` as the argument.
    - Log an error message if [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>) exits, indicating unexpected behavior.
    - Return `NULL` as the function's result.
- **Output**: Returns `NULL` after logging an error if [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>) exits.
- **Functions Called**:
    - [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>)


---
### fddev\_bench\_cmd\_fn<!-- {{#callable:fddev_bench_cmd_fn}} -->
[View Source →](<../../../../../../src/app/fddev/commands/bench.c#L20>)

Executes a benchmark command and starts a separate thread for agave processing, then pauses indefinitely.
- **Inputs**:
    - `args`: A pointer to an `args_t` structure that contains the arguments for the benchmark command.
    - `config`: A pointer to a `config_t` structure that contains the configuration for the benchmark and agave processing.
- **Logic and Control Flow**:
    - Calls the `bench_cmd_fn` function with `args` and `config` to execute the benchmark command.
    - Creates a new thread named `agave` that runs the `agave_thread_main` function, passing `config` as an argument.
    - Enters an infinite loop that pauses the parent thread indefinitely, allowing termination only via external interruption (e.g., Ctrl+C).
- **Output**: No output is returned as the function is of type `void`.


# Function Declarations (Public API)

---
### agave\_boot<!-- {{#callable_declaration:agave_boot}} -->
[View Source →](<../../../../../../src/app/fddev/commands/bench.c#L7>)

Boots the Agave validator with the specified configuration.
- **Description**: Use this function to start the Agave validator with the given configuration settings. It prepares and executes the necessary command-line arguments based on the provided configuration. This function must be called with a valid configuration structure, and it does not return control to the caller as it will execute the validator process. Ensure that the configuration is correctly populated with all required fields before calling this function.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing the configuration settings for the Agave validator. The structure must be fully initialized and must not be null. The function reads various fields from this structure to construct command-line arguments for the validator.
- **Output**: None
- **See Also**: [`agave_boot`](<../../fdctl/commands/run_agave.c.md#agave_boot>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)