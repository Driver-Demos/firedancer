<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Mechanisms to check and report missing capabilities or permissions for a process.

# Purpose
The code is a C header file that defines a capability checker module. This module provides mechanisms to verify the capabilities or permissions available to a process. It accumulates error information if required capabilities are missing, which can be reported later. The module includes functions to check if a process is running as the root user, if it has specific Linux capabilities, and if it can raise resource limits to desired levels. If any capability checks fail, the module logs an error and terminates the program immediately.

The module defines a private structure `fd_cap_chk_t` for managing capability checks and provides several functions for interacting with this structure. The [`fd_cap_chk_new`](<#fd_cap_chk_new>) and [`fd_cap_chk_join`](<#fd_cap_chk_join>) functions are used to create and join a capability checker instance, respectively. The module also includes functions like [`fd_cap_chk_root`](<#fd_cap_chk_root>), [`fd_cap_chk_cap`](<#fd_cap_chk_cap>), and [`fd_cap_chk_raise_rlimit`](<#fd_cap_chk_raise_rlimit>) to perform specific capability checks. Additionally, it provides functions [`fd_cap_chk_err_cnt`](<#fd_cap_chk_err_cnt>) and [`fd_cap_chk_err`](<#fd_cap_chk_err>) to retrieve the number of accumulated errors and access specific error messages. The module ensures that capability checks do not fail silently and provides detailed diagnostic messages for any issues encountered.
# Imports and Dependencies

---
- `../../util/fd_util_base.h`


# Data Structures

---
### fd\_cap\_chk\_t
- **Type**: ``struct``
- **Members**:
    - ``fd_cap_chk_private``: A forward declaration for the private structure used internally by `fd_cap_chk_t`.
- **Description**: `fd_cap_chk_t` is a typedef for a private structure `fd_cap_chk_private` that provides mechanisms to check the capabilities or permissions available to the caller. It accumulates error information if capabilities are missing, which can be reported later. The structure is used in conjunction with various functions to check for root user status, specific Linux capabilities, and resource limits, and to manage and report errors related to these checks.


# Functions

---
### fd\_cap\_chk\_align<!-- {{#callable:fd_cap_chk_align}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L27>)

Returns the alignment requirement for the capability checker.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_CAP_CHK_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment requirement, which is defined by the macro `FD_CAP_CHK_ALIGN`.


---
### fd\_cap\_chk\_footprint<!-- {{#callable:fd_cap_chk_footprint}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L32>)

Returns the constant footprint size for the capability checker.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_CAP_CHK_FOOTPRINT`.
- **Output**: The output is an unsigned long integer representing the footprint size, specifically `4104UL`.


# Function Declarations (Public API)

---
### fd\_cap\_chk\_new<!-- {{#callable_declaration:fd_cap_chk_new}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L37>)

Initializes a capability checker in shared memory.
- **Description**: Use this function to initialize a capability checker in a provided shared memory region. This function sets up the capability checker to start accumulating error information related to missing capabilities or permissions. It must be called before any capability checks are performed. Ensure that the shared memory region is properly allocated and aligned according to `fd_cap_chk_align()` before calling this function.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region where the capability checker will be initialized. The memory must be aligned to `FD_CAP_CHK_ALIGN` and have a size of at least `FD_CAP_CHK_FOOTPRINT`. The caller retains ownership of the memory. Passing a null pointer or improperly aligned memory will result in undefined behavior.
- **Output**: Returns a pointer to the initialized capability checker structure within the shared memory.
- **See Also**: [`fd_cap_chk_new`](<fd_cap_chk.c.md#fd_cap_chk_new>)  (Implementation)


---
### fd\_cap\_chk\_join<!-- {{#callable_declaration:fd_cap_chk_join}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L40>)

Converts a shared memory pointer to a capability checker pointer.
- **Description**: Use this function to obtain a `fd_cap_chk_t` pointer from a shared memory pointer. This is typically done after creating a capability checker with `fd_cap_chk_new`. Ensure that the `shchk` parameter is a valid pointer to a shared memory region that represents a capability checker. This function does not perform any validation or error checking on the input pointer.
- **Inputs**:
    - `shchk`: A pointer to shared memory that represents a capability checker. Must be a valid pointer. The function does not check for null or invalid pointers, so the caller must ensure the pointer is correct.
- **Output**: Returns a pointer of type `fd_cap_chk_t *` that corresponds to the input shared memory pointer.
- **See Also**: [`fd_cap_chk_join`](<fd_cap_chk.c.md#fd_cap_chk_join>)  (Implementation)


---
### fd\_cap\_chk\_root<!-- {{#callable_declaration:fd_cap_chk_root}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L50>)

Checks if the current process is running as the root user.
- **Description**: Use this function to verify if the current process has root user privileges. If the process is not running as root, the function records an error with a specified name and reason. This function is useful in scenarios where certain operations require root access, and you need to log an error if such access is not available. Ensure that the `chk` parameter is properly initialized before calling this function.
- **Inputs**:
    - `chk`: A pointer to an `fd_cap_chk_t` structure where error information is accumulated. Must not be null.
    - `name`: A constant string used to identify the operation or context in the error message. Must not be null.
    - `reason`: A constant string providing the reason for requiring root access, used in the error message. Must not be null.
- **Output**: None
- **See Also**: [`fd_cap_chk_root`](<fd_cap_chk.c.md#fd_cap_chk_root>)  (Implementation)


---
### fd\_cap\_chk\_cap<!-- {{#callable_declaration:fd_cap_chk_cap}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L62>)

Checks if the current process has a specified Linux capability.
- **Description**: Use this function to verify if the current process possesses a specific Linux capability. If the process lacks the capability, the function records an error with a formatted message that includes the provided name and reason. This function is part of a capability checking mechanism that accumulates error information for later reporting. It does not return errors or fail silently; instead, it logs an error and terminates if it encounters an environment issue that prevents capability checking.
- **Inputs**:
    - `chk`: A pointer to an `fd_cap_chk_t` structure. This must not be null and should be properly initialized before calling this function. The function uses this structure to accumulate error information if the capability is missing.
    - `name`: A constant character pointer representing the name used in the error message. This must not be null.
    - `capability`: An unsigned integer representing the Linux capability to check. The function expects a valid capability value.
    - `reason`: A constant character pointer providing the reason for the capability check, used in the error message. This must not be null.
- **Output**: None
- **See Also**: [`fd_cap_chk_cap`](<fd_cap_chk.c.md#fd_cap_chk_cap>)  (Implementation)


---
### fd\_cap\_chk\_raise\_rlimit<!-- {{#callable_declaration:fd_cap_chk_raise_rlimit}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L86>)

Checks and potentially raises a resource limit for the current process.
- **Description**: Use this function to ensure that the current process has a specified resource limit at or above a desired threshold. If the process does not meet the required limit but has the necessary capabilities, the function will attempt to raise the limit. If the limit cannot be raised due to insufficient capabilities, an error entry is recorded. This function is useful in environments where resource limits need to be dynamically adjusted based on process capabilities. It must be called with valid parameters and assumes that the `chk` object is properly initialized.
- **Inputs**:
    - `chk`: A pointer to an `fd_cap_chk_t` object used to accumulate error information. Must not be null.
    - `name`: A string used to format diagnostic error messages. Must not be null.
    - `resource`: An integer representing a RLIMIT_* constant. Must be a valid resource limit identifier.
    - `limit`: An unsigned long specifying the desired resource limit. Must be a non-negative value.
    - `reason`: A string used to format diagnostic error messages. Must not be null.
- **Output**: None
- **See Also**: [`fd_cap_chk_raise_rlimit`](<fd_cap_chk.c.md#fd_cap_chk_raise_rlimit>)  (Implementation)


---
### fd\_cap\_chk\_err\_cnt<!-- {{#callable_declaration:fd_cap_chk_err_cnt}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L96>)

Returns the number of accumulated error entries.
- **Description**: Use this function to get the count of error entries that have been accumulated in the capability checker. This is useful after performing capability checks to determine if any errors were recorded. Ensure that the `chk` parameter is a valid pointer to an `fd_cap_chk_t` structure before calling this function.
- **Inputs**:
    - `chk`: A pointer to a constant `fd_cap_chk_t` structure. It must not be null and must point to a valid capability checker instance. The function will not modify the structure.
- **Output**: The function returns an unsigned long integer representing the number of error entries accumulated in the capability checker.
- **See Also**: [`fd_cap_chk_err_cnt`](<fd_cap_chk.c.md#fd_cap_chk_err_cnt>)  (Implementation)


---
### fd\_cap\_chk\_err<!-- {{#callable_declaration:fd_cap_chk_err}} -->
[View Source →](<../../../../../src/app/platform/fd_cap_chk.h#L103>)

Returns the error message at a specified index.
- **Description**: Use this function to retrieve a specific error message from the capability checker. It is important to ensure that the index provided is less than the total number of errors accumulated, as determined by `fd_cap_chk_err_cnt()`. This function does not perform bounds checking on the index, so providing an invalid index may result in undefined behavior.
- **Inputs**:
    - `chk`: A pointer to a `fd_cap_chk_t` structure. Must not be null. The caller retains ownership.
    - `idx`: An unsigned long integer representing the index of the error message to retrieve. Must be less than the number of errors accumulated, as returned by `fd_cap_chk_err_cnt()`. No bounds checking is performed.
- **Output**: A pointer to a constant character string containing the error message at the specified index.
- **See Also**: [`fd_cap_chk_err`](<fd_cap_chk.c.md#fd_cap_chk_err>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)