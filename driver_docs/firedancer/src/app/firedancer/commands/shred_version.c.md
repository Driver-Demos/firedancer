<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Retrieves the current shred version from entrypoints using a client in a command function.

# Purpose
The code defines a function [`shred_version_cmd_fn`](<#shred_version_cmd_fn>) that retrieves the current shred version from a network of entry points. It uses the `fd_ipecho_client` to connect to a specified tile in a topology configuration and polls for the shred version. The function allocates memory for the client using `aligned_alloc` and initializes the client with entry points from the topology configuration. It then enters a loop where it continuously polls the client for the shred version until it successfully retrieves it, at which point it logs the version and exits the loop.

Additionally, the code defines an `action_t` structure named `fd_action_shred_version`. This structure associates the [`shred_version_cmd_fn`](<#shred_version_cmd_fn>) function with the action name "shred-version" and provides a description of the action. This setup suggests that the code is part of a larger system where actions are defined and executed based on their names and associated functions. The code is likely intended to be part of a command-line tool or service that interacts with a network topology to perform specific actions, such as retrieving configuration details like the shred version.
# Imports and Dependencies

---
- `../../shared/fd_config.h`
- `../../shared/fd_action.h`
- `../../../disco/topo/fd_topo.h`
- `../../../discof/ipecho/fd_ipecho_client.h`
- `stdlib.h`
- `unistd.h`


# Global Variables

---
### fd\_action\_shred\_version
- **Type**: ``action_t``
- **Description**: Defines an action named 'shred-version' that is associated with the function `shred_version_cmd_fn`. This action is described as retrieving the current shred version from the entrypoints.
- **Use**: Used to represent an action that retrieves the shred version by executing the `shred_version_cmd_fn` function.


# Functions

---
### shred\_version\_cmd\_fn<!-- {{#callable:shred_version_cmd_fn}} -->
[View Source →](<../../../../../../src/app/firedancer/commands/shred_version.c#L10>)

Retrieves and prints the current shred version from the specified gossip entrypoints in the configuration.
- **Inputs**:
    - `args`: A pointer to an `args_t` structure, which is not used in this function.
    - `config`: A pointer to a `config_t` structure that contains the topology information needed to find the gossip entrypoints.
- **Logic and Control Flow**:
    - Allocate memory for the client using `aligned_alloc` with alignment `FD_IPECHO_CLIENT_ALIGN` and size `fd_ipecho_client_footprint()`.
    - Check if the client memory allocation is successful using `FD_TEST`.
    - Create and join a new `fd_ipecho_client_t` client using the allocated memory, and verify its success with `FD_TEST`.
    - Find the tile index for the gossip entrypoints in the configuration using `fd_topo_find_tile` and check if it is valid with `FD_TEST`.
    - Initialize the client with the gossip entrypoints and their count from the found tile.
    - Enter an infinite loop to poll the client for the shred version using `fd_ipecho_client_poll`.
    - If polling returns an error (-1), log an error message and exit.
    - If polling is successful (returns 0), print the shred version to standard output and break the loop.
- **Output**: Prints the retrieved shred version to standard output.



---
Made with ❤️ by [Driver](https://www.driver.ai/)