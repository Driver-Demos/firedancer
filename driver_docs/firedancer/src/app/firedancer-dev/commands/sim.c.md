<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements the "sim" command to simulate a smaller topology for reading archives and replaying behavior.

# Purpose
The code defines a command named `sim` that is part of a larger system, likely related to a distributed computing or simulation environment. The primary function of this command is to set up and manage a smaller topology that serves two main purposes: reading an archive file to reproduce fragments into a `storei` tile and simulating the behavior of a `replay` tile. The topology involves several components, including `playback`, `storei`, `replay`, and `exec` tiles, with various links and workspaces connecting them. The code configures these components and their interactions, such as setting up links between tiles and initializing shared objects used by the tiles.

The `sim_cmd_fn` function is responsible for executing the `sim` command. It initializes the topology using the [`sim_topo`](<#sim_topo>) function, sets up workspaces and stacks, and joins the workspaces in read-write mode. The function also handles specific configurations, such as ensuring the presence of necessary archive files and updating certain shared memory objects. The command is designed to run in a single process, and it uses a loop with `pause()` to maintain its execution state. The `fd_action_sim` structure defines the command's name, argument handling, execution function, and permission checks, integrating it into the larger system's command framework.
# Imports and Dependencies

---
- `../../firedancer/topology.h`
- `../../shared/commands/run/run.h`
- `../../../disco/topo/fd_cpu_topo.h`
- `../../../disco/pack/fd_pack.h`
- `../../../disco/pack/fd_pack_cost.h`
- `../../../disco/topo/fd_topob.h`
- `../../../util/pod/fd_pod_format.h`
- `unistd.h`


# Global Variables

---
### CALLBACKS
- **Type**: `fd_topo_obj_callbacks_t *`
- **Description**: An array of pointers to `fd_topo_obj_callbacks_t` structures, which define callback functions for topology objects.
- **Use**: Used to provide callback functions for various operations on topology objects in the Firedancer topology system.


---
### sim\_cmd\_fn
- **Type**: `function`
- **Description**: Executes the simulation command by setting up the topology and initializing necessary workspaces and stacks.
- **Use**: Used to simulate a smaller topology for reading an archive file and reproducing behavior in a controlled environment.


---
### sim\_cmd\_perm
- **Type**: `function`
- **Description**: Defines a static function `sim_cmd_perm` that takes three parameters: `args`, `chk`, and `config`, all marked as unused with `FD_PARAM_UNUSED`. The function body is empty, indicating it does not perform any operations.
- **Use**: Used as a placeholder for permission checks or setup in the `fd_action_sim` action structure.


---
### fd\_action\_sim
- **Type**: ``action_t``
- **Description**: Defines an action named 'sim' with associated command arguments, function, and permissions. The `fd_action_sim` variable is an instance of the `action_t` structure, which is used to encapsulate the details of a specific command action.
- **Use**: Used to represent and execute the 'sim' command action within the program.


# Functions

---
### sim\_topo<!-- {{#callable:sim_topo}} -->
[View Source →](<../../../../../../src/app/firedancer-dev/commands/sim.c#L33>)

Configures a smaller topology for simulating the behavior of playback, storei, and replay tiles in a distributed system.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing configuration details for the topology.
- **Logic and Control Flow**:
    - Initialize CPU topology using `fd_topo_cpus_init`.
    - Create a new topology object with `fd_topob_new` and set the maximum page size.
    - Define CPU indices for different tiles using an enumeration.
    - Create workspaces and tiles for 'metric', 'playback', 'storei', 'replay', and 'exec' using `fd_topob_wksp` and `fd_topob_tile`.
    - Set up links between tiles such as 'shred_storei', 'repair_store', 'storei_notif', 'replay_stake', and 'store_replay' using `fd_topob_link`.
    - Configure tile inputs and outputs using `fd_topob_tile_in` and `fd_topob_tile_out`.
    - Set up shared objects for tiles like 'bstore', 'poh_shred', 'root_slot', 'txncache', 'poh_slot', 'bank_busy', and 'exec_spad' using `fd_topob_obj` and `fd_topob_tile_uses`.
    - Insert properties into the topology's property list using `fd_pod_insertf_ulong`.
    - Configure each tile with `fd_topo_configure_tile`, checking for specific conditions like the presence of an archive file.
    - Finish the topology setup with `fd_topob_finish` and print the topology information using `fd_topo_print_log`.
- **Output**: No return value; the function modifies the `config` structure to set up the topology.


---
### sim\_cmd\_args<!-- {{#callable:sim_cmd_args}} -->
[View Source →](<../../../../../../src/app/firedancer-dev/commands/sim.c#L206>)

Does not perform any operations as it is a placeholder function with all parameters marked as unused.
- **Inputs**:
    - `pargc`: Pointer to an integer representing the argument count, marked as unused.
    - `pargv`: Pointer to an array of strings representing the argument vector, marked as unused.
    - `args`: Pointer to an `args_t` structure, marked as unused.
- **Logic and Control Flow**:
    - The function body is empty, indicating no operations are performed.
- **Output**: No output is produced as the function does not perform any operations.


# Function Declarations (Public API)

---
### fdctl\_tile\_run<!-- {{#callable_declaration:fdctl_tile_run}} -->
[View Source →](<../../../../../../src/app/firedancer-dev/commands/sim.c#L31>)

Finds and returns a tile from a predefined list by name.
- **Description**: Use this function to search for a tile in a predefined list of tiles by its name. It returns the tile if found, or logs an error and returns a default-initialized tile if not found. This function is useful when you need to retrieve a specific tile's configuration or properties based on its name. Ensure that the tile name provided is valid and exists in the list to avoid error logging.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure representing the tile to find. The `name` field of this structure is used for comparison. Must not be null.
- **Output**: Returns a `fd_topo_run_tile_t` structure corresponding to the tile with the matching name. If no match is found, logs an error and returns a default-initialized `fd_topo_run_tile_t`.
- **See Also**: [`fdctl_tile_run`](<../../shared/boot/fd_boot.c.md#fdctl_tile_run>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)