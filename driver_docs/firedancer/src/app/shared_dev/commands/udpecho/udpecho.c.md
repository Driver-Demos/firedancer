<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a UDP echo server with configuration and topology setup functions.

# Purpose
The code defines a UDP echo server action within a larger system, likely part of a network management or testing framework. It includes several components that configure and run a UDP echo server, which listens for incoming UDP packets and echoes them back to the sender. The code is structured to handle command-line arguments, configure system resources, and manage network topology.

Key components include the [`udpecho_topo`](<#udpecho_topo>) function, which sets up the network topology for the echo server, and the [`udpecho_cmd_args`](<#udpecho_cmd_args>) function, which processes command-line arguments to determine the listening port for the server. The [`udpecho_cmd_fn`](<#udpecho_cmd_fn>) function orchestrates the overall setup and execution of the UDP echo server, including configuring system settings, initializing resources, and running the server in a single process. The `fd_action_udpecho` structure defines the action's name, argument processing function, execution function, permissions, and description, integrating the UDP echo server into the broader system as a configurable action.
# Imports and Dependencies

---
- `../dev.h`
- `../../../shared/commands/configure/configure.h`
- `../../../shared/commands/run/run.h`
- `../../../../disco/net/fd_net_tile.h`
- `../../../../disco/topo/fd_topob.h`
- `../../../../disco/topo/fd_cpu_topo.h`
- `../../../../util/net/fd_ip4.h`
- `../../../../util/tile/fd_tile_private.h`
- `unistd.h`


# Global Variables

---
### CALLBACKS
- **Type**: `fd_topo_obj_callbacks_t *`
- **Description**: An array of pointers to `fd_topo_obj_callbacks_t` structures. These structures likely contain function pointers or callback functions related to topology operations.
- **Use**: Used to pass callback functions to the `fd_topob_finish` function for finalizing topology operations.


---
### fd\_action\_udpecho
- **Type**: ``action_t``
- **Description**: Defines an action for running a UDP echo server. It includes the name of the action, the function to parse command-line arguments, the function to execute the action, the permissions required, and a description of the action.
- **Use**: Used to configure and execute a UDP echo server action within the application.


# Functions

---
### udpecho\_topo<!-- {{#callable:udpecho_topo}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/udpecho/udpecho.c#L17>)

Configures the CPU affinity and network topology for a UDP echo server based on the provided configuration.
- **Inputs**:
    - ``config``: A pointer to a `config_t` structure containing configuration details for the UDP echo server, including CPU affinity and network settings.
- **Logic and Control Flow**:
    - Retrieve the CPU affinity setting from the configuration and determine if it is set to 'auto'.
    - Initialize an array `parsed_tile_to_cpu` to store parsed CPU indices and set all values to `USHORT_MAX`.
    - Initialize CPU topology using `fd_topo_cpus_init`.
    - If affinity is not 'auto', parse the CPU affinity string into `parsed_tile_to_cpu` and count the number of tiles with affinity.
    - For each tile with affinity, check if the CPU index is valid and log an error if it is not.
    - If affinity is not 'auto', ensure exactly three CPUs are specified and log an error if not.
    - Reset the network topology using `fd_topob_new` and configure various workspaces and tiles for network communication.
    - Link network components and configure input/output for tiles using `fd_topob_link`, `fd_topob_tile_out`, and `fd_topob_tile_in`.
    - Finalize the network tile setup and, if affinity is 'auto', perform automatic layout.
    - Set `agave_affinity_cnt` to 0 and finish the topology setup with `fd_topob_finish`.
    - Print the topology configuration to the log.
- **Output**: No return value; the function modifies the `config` structure and logs errors if configuration issues are detected.


---
### udpecho\_cmd\_args<!-- {{#callable:udpecho_cmd_args}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/udpecho/udpecho.c#L72>)

Parses command-line arguments to set the UDP echo server's listening port.
- **Inputs**:
    - ``pargc``: A pointer to an integer representing the count of command-line arguments.
    - ``pargv``: A pointer to an array of strings representing the command-line arguments.
    - ``args``: A pointer to an `args_t` structure where the parsed listening port will be stored.
- **Logic and Control Flow**:
    - Call `fd_env_strip_cmdline_ushort` to extract the port number from the command-line arguments using the `--port` option.
    - Call `fd_env_strip_cmdline_ushort` again to extract the port number using the `-p` option.
    - Select the port number from `port_s` if available; otherwise, use `port_l`.
    - If no port number is found, log an error message and terminate the program.
    - Assign the selected port number to `args->udpecho.listen_port`.
- **Output**: No return value; modifies the `args` structure to set the UDP echo server's listening port.


---
### udpecho\_cmd\_fn<!-- {{#callable:udpecho_cmd_fn}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/udpecho/udpecho.c#L83>)

Configures and runs a UDP echo server using the provided arguments and configuration.
- **Inputs**:
    - ``args``: A pointer to an `args_t` structure containing the UDP echo server's listen port.
    - ``config``: A pointer to a `config_t` structure containing the configuration for the network topology and other settings.
- **Logic and Control Flow**:
    - Calls [`udpecho_topo`](<#udpecho_topo>) to initialize the network topology based on the configuration.
    - Finds and assigns the network and metric tiles from the topology.
    - Sets the network tile's legacy transaction listen port using the port from `args`.
    - Parses the Prometheus listen address and assigns it to the metric tile; logs an error if parsing fails.
    - Configures various system stages using `configure_stage` with `CONFIGURE_CMD_INIT`.
    - Checks the configuration with `fdctl_check_configure`.
    - Initializes workspaces and stacks, noting a FIXME about unnecessary memory allocation.
    - Sets up the network namespace with `fdctl_setup_netns`.
    - Installs XDP (eXpress Data Path) on the topology using the parsed bind address.
    - Joins workspaces in read-write mode using `fd_topo_join_workspaces`.
    - Runs the topology in a single process with `fd_topo_run_single_process`, using the user and group IDs from the configuration.
    - Enters an infinite loop with `pause()` to keep the process running.
- **Output**: No return value; the function configures and runs the UDP echo server as a side effect.
- **Functions Called**:
    - [`udpecho_topo`](<#udpecho_topo>)


# Function Declarations (Public API)

---
### fdctl\_tile\_run<!-- {{#callable_declaration:fdctl_tile_run}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/udpecho/udpecho.c#L14>)

Finds and returns a tile from a predefined list by name.
- **Description**: Use this function to search for a tile in a predefined list of tiles by its name. It returns the tile if found, or logs an error and returns a default-initialized tile if not found. This function is useful when you need to retrieve a specific tile's configuration or state by its name. Ensure that the tile name provided is valid and exists in the list to avoid error logging.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure representing the tile to find. The `name` field of this structure is used for comparison. Must not be null.
- **Output**: Returns a `fd_topo_run_tile_t` structure representing the found tile. If the tile is not found, logs an error and returns a default-initialized `fd_topo_run_tile_t`.
- **See Also**: [`fdctl_tile_run`](<../../../shared/boot/fd_boot.c.md#fdctl_tile_run>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)