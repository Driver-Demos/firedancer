<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Configures and runs a bundle client tile in a network topology, including setup and execution functions.

# Purpose
The code defines a module for configuring and running a "bundle client" within a distributed system topology. It includes functions to set up the topology, configure tiles, and manage command-line arguments. The [`bundle_client_topo`](<#bundle_client_topo>) function initializes the topology by creating and configuring tiles such as "bundle", "sign", and "metric", and establishes links between them. It configures various parameters for these tiles, such as URLs, buffer sizes, and security settings. The function also handles the setup of network addresses and ports for metrics collection.

The module defines an action `fd_action_bundle_client`, which includes a command function [`bundle_client_cmd_fn`](<#bundle_client_cmd_fn>). This function orchestrates the initialization of workspaces and stacks, joins shared memory workspaces, and runs the topology in a single process. The module is designed to run the "bundle" tile in isolation, allowing for diagnostic operations against live clusters. The code is structured to be part of a larger system, with external dependencies and configurations managed through included headers and external callback functions.
# Imports and Dependencies

---
- `../../shared/fd_config.h`
- `../../shared/commands/run/run.h`
- `../../../disco/topo/fd_topob.h`
- `../../../disco/fd_txn_m.h`
- `unistd.h`


# Global Variables

---
### CALLBACKS
- **Type**: `fd_topo_obj_callbacks_t *`
- **Description**: An array of pointers to `fd_topo_obj_callbacks_t` structures. These structures likely contain callback functions or methods related to topology objects.
- **Use**: Used to pass callback functions to the `fd_topob_finish` function for finalizing topology operations.


---
### fd\_action\_bundle\_client
- **Type**: ``action_t``
- **Description**: Defines an action structure for running a bundle tile in isolation. It includes the name of the action, the function to handle command arguments, the function to execute the command, and a description of the action.
- **Use**: Used to configure and execute the 'bundle-client' action, allowing it to run in diagnostic mode against live clusters.


# Functions

---
### bundle\_client\_topo<!-- {{#callable:bundle_client_topo}} -->
[View Source →](<../../../../../../src/app/shared_dev/commands/bundle_client.c#L13>)

Configures and initializes a topology for a bundle client using the provided configuration.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing configuration data for the topology.
- **Logic and Control Flow**:
    - Initialize the topology using `fd_topob_new` with the provided configuration name.
    - Set the maximum page size for the topology using `fd_cstr_to_shmem_page_sz`.
    - Create workspaces for 'metric_in', 'bundle', 'sign', and 'metric'.
    - Create tiles for 'bundle', 'sign', and 'metric' with specific configurations.
    - Establish links between tiles using `fd_topob_link` and configure their properties.
    - Configure output and input connections for the tiles using `fd_topob_tile_out` and `fd_topob_tile_in`.
    - Set various configuration parameters for the 'bundle' and 'sign' tiles, including URLs, paths, buffer sizes, and security settings.
    - Parse and set the Prometheus listen address and port for the 'metric' tile.
    - Finalize the topology setup with `fd_topob_finish` and log the topology using `fd_topo_print_log`.
- **Output**: No return value; the function modifies the `config` structure and sets up the topology.


---
### bundle\_client\_cmd\_args<!-- {{#callable:bundle_client_cmd_args}} -->
[View Source →](<../../../../../../src/app/shared_dev/commands/bundle_client.c#L70>)

Does nothing with the provided arguments.
- **Inputs**:
    - `pargc`: A pointer to an integer representing the argument count.
    - `pargv`: A pointer to an array of strings representing the argument values.
    - `args`: A pointer to an `args_t` structure containing additional arguments.
- **Logic and Control Flow**:
    - The function takes three parameters: `pargc`, `pargv`, and `args`, but does not use them.
    - The function body contains only type casting to void for each parameter, indicating that the parameters are intentionally unused.
- **Output**: No output is produced as the function does not perform any operations.


---
### bundle\_client\_cmd\_fn<!-- {{#callable:bundle_client_cmd_fn}} -->
[View Source →](<../../../../../../src/app/shared_dev/commands/bundle_client.c#L77>)

Initializes and runs the bundle client topology in a single process mode.
- **Inputs**:
    - `args`: A pointer to an `args_t` structure, which is not used in this function.
    - `config`: A pointer to a `config_t` structure that contains configuration data for the topology.
- **Logic and Control Flow**:
    - Ignore the `args` parameter by casting it to void.
    - Retrieve the topology from the `config` structure.
    - Call [`bundle_client_topo`](<#bundle_client_topo>) to set up the topology based on the configuration.
    - Initialize workspaces using `initialize_workspaces` with the given configuration.
    - Initialize stacks using `initialize_stacks` with the given configuration.
    - Join the workspaces in read-write mode using `fd_topo_join_workspaces`.
    - Run the topology in a single process with `fd_topo_run_single_process`, using the user ID and group ID from the configuration and the `fdctl_tile_run` function.
    - Enter an infinite loop that calls `pause` to wait indefinitely.
- **Output**: No return value; the function runs indefinitely.
- **Functions Called**:
    - [`bundle_client_topo`](<#bundle_client_topo>)


# Function Declarations (Public API)

---
### fdctl\_tile\_run<!-- {{#callable_declaration:fdctl_tile_run}} -->
[View Source →](<../../../../../../src/app/shared_dev/commands/bundle_client.c#L10>)

Finds and returns a tile configuration by name.
- **Description**: Use this function to retrieve a tile configuration from a predefined list of tiles by matching the tile's name. This function is useful when you need to access the configuration of a specific tile within a topology. It is important to ensure that the tile name provided exists in the list; otherwise, the function will log an error and return a default-initialized tile configuration. This function does not modify the input tile or any global state.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure representing the tile to find. The `name` field of this structure is used to search for a matching tile in the list. The pointer must not be null, and the `name` field must be a valid string.
- **Output**: Returns a `fd_topo_run_tile_t` structure corresponding to the tile with the matching name. If no match is found, logs an error and returns a default-initialized `fd_topo_run_tile_t`.
- **See Also**: [`fdctl_tile_run`](<../../shared/boot/fd_boot.c.md#fdctl_tile_run>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)