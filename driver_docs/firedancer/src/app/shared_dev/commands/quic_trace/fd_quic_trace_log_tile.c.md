<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Processes QUIC trace logs by defining callback functions for handling fragments and logging connection close events.

# Purpose
The code is a C source file that implements functionality for tracing and logging events in a QUIC (Quick UDP Internet Connections) protocol context. It includes several static functions that handle different stages of processing fragments of data related to QUIC events. The [`before_frag`](<#before_frag>) function checks if a specific QUIC event, identified by a signal, is not a connection close event. The [`during_frag`](<#during_frag>) function copies data from a specified memory chunk into a buffer within the context structure. The [`after_frag`](<#after_frag>) function processes the buffered data to extract and print details about a QUIC connection close event, including connection ID, source IP, encryption level, packet number, and error code.

The file also defines several macros that configure the behavior of a stem processing framework, which is included from another source file. The [`fd_quic_trace_log_tile`](<#fd_quic_trace_log_tile>) function sets up and runs a stem processing tile, which processes input metadata caches and uses a random number generator for its operations. This function is responsible for managing the lifecycle of the input metadata and the random number generator, ensuring proper initialization and cleanup. The code is intended to be part of a larger system that monitors and logs QUIC protocol events, providing detailed information about connection closures for diagnostic or analytical purposes.
# Imports and Dependencies

---
- `fd_quic_trace.h`
- `../../../../waltz/quic/log/fd_quic_log_user.h`
- `stdio.h`
- `../../../../disco/stem/fd_stem.c`


# Functions

---
### before\_frag<!-- {{#callable:before_frag}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace_log_tile.c#L7>)

Checks if a signal event is not a QUIC connection close event.
- **Inputs**:
    - `_ctx`: Unused context pointer.
    - `in_idx`: Unused index of the input.
    - `seq`: Unused sequence number.
    - `sig`: Signal event identifier to check.
- **Logic and Control Flow**:
    - Calls `fd_quic_log_sig_event` with `sig` to log the signal event.
    - Compares the result of `fd_quic_log_sig_event` to `FD_QUIC_EVENT_CONN_QUIC_CLOSE`.
    - Returns the negation of the comparison result, indicating if the event is not a QUIC connection close.
- **Output**: Returns an integer that is non-zero if the signal event is not a QUIC connection close event, otherwise returns zero.


---
### during\_frag<!-- {{#callable:during_frag}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace_log_tile.c#L15>)

Copies a specified number of bytes from a source memory location to a destination buffer within a context structure.
- **Inputs**:
    - `ctx`: A pointer to an `fd_quic_trace_ctx_t` structure that contains the destination buffer for the data copy.
    - `in_idx`: An unused parameter of type `ulong`.
    - `seq`: An unused parameter of type `ulong`.
    - `sig`: An unused parameter of type `ulong`.
    - `chunk`: A `ulong` representing the source memory location from which data is copied.
    - `sz`: A `ulong` specifying the number of bytes to copy.
    - `ctl`: An unused parameter of type `ulong`.
- **Logic and Control Flow**:
    - Calls `fd_chunk_to_laddr_const` with `fd_quic_trace_log_base` and `chunk` to get the source address for the data copy.
    - Uses `fd_memcpy` to copy `sz` bytes from the source address to `ctx->buffer`.
- **Output**: No return value; the function performs a memory copy operation.


---
### after\_frag<!-- {{#callable:after_frag}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace_log_tile.c#L26>)

Logs a QUIC connection close event with specific details from the context buffer.
- **Inputs**:
    - ``ctx``: A pointer to `fd_quic_trace_ctx_t`, which contains the buffer with the error information.
    - ``in_idx``: An unused parameter of type `ulong`.
    - ``seq``: An unused parameter of type `ulong`.
    - ``sig``: An unused parameter of type `ulong`.
    - ``sz``: An unused parameter of type `ulong`.
    - ``tsorig``: An unused parameter of type `ulong`.
    - ``tspub``: An unused parameter of type `ulong`.
    - ``stem``: An unused parameter of type `fd_stem_context_t *`.
- **Logic and Control Flow**:
    - Retrieve a constant pointer to `fd_quic_log_error_t` from the `ctx->buffer` using `fd_type_pun_const`.
    - Print a formatted string to standard output with details of the QUIC connection close event, including connection ID, source IP, encryption level, packet number, close code, source file, and line number.
- **Output**: No return value; the function outputs a formatted log message to standard output.


---
### fd\_quic\_trace\_log\_tile<!-- {{#callable:fd_quic_trace_log_tile}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace_log_tile.c#L59>)

Executes a logging operation for QUIC trace data using a specified context and metadata cache.
- **Inputs**:
    - `ctx`: A pointer to `fd_quic_trace_ctx_t`, which provides the context for the QUIC trace logging operation.
    - `in_mcache`: A pointer to a constant `fd_frag_meta_t`, which represents the input metadata cache used in the logging operation.
- **Logic and Control Flow**:
    - Initialize an array `in_mcache_tbl` with the input metadata cache `in_mcache`.
    - Allocate memory for `fseq_mem` and align it according to `FD_FSEQ_ALIGN`, then create and join a new sequence `fseq` using `fd_fseq_new` and `fd_fseq_join`.
    - Initialize an array `fseq_tbl` with the sequence `fseq`.
    - Create a random number generator `rng` and initialize it with `fd_rng_new` and `fd_rng_join` using the current tick count.
    - Allocate a scratch buffer with a size of `sizeof(fd_stem_tile_in_t)+128` and align it according to `FD_STEM_SCRATCH_ALIGN`.
    - Call `stem_run1` with the initialized parameters to perform the logging operation.
    - Delete the sequence `fseq` by leaving and deleting it using `fd_fseq_leave` and `fd_fseq_delete`.
- **Output**: No return value; the function performs its operations as a side effect.



---
Made with ❤️ by [Driver](https://www.driver.ai/)