<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for QUIC tracing, defining data structures, macros, and functions for tracing QUIC connections.

# Purpose
The code is a C header file that defines structures, macros, and function prototypes for tracing QUIC (Quick UDP Internet Connections) protocol activities. It includes several external dependencies and is intended to be used in conjunction with other components of a larger system. The file provides a mechanism to map peer connection IDs to connection indices using a hash map, which is defined through the `peer_conn_id_map` structure and related macros. This mapping is crucial for managing and tracing connections efficiently.

The file also defines several structures, such as `fd_quic_trace_ctx` and `fd_quic_trace_frame_ctx`, which are used to maintain context information for tracing operations. These structures store configuration and state information necessary for tracing network activities, such as connection identifiers, source IP addresses, and packet types. The header file declares several external variables and function prototypes, such as [`fd_quic_trace_frames`](<#fd_quic_trace_frames>), [`fd_quic_trace_rx_tile`](<#fd_quic_trace_rx_tile>), and [`fd_quic_trace_log_tile`](<#fd_quic_trace_log_tile>), which are used to perform tracing operations on QUIC frames and tiles. The file is part of a larger system that likely involves network communication and performance monitoring, and it provides a focused set of functionalities for tracing and logging QUIC protocol activities.
# Imports and Dependencies

---
- `../../../shared/fd_config.h`
- `../../../shared/fd_action.h`
- `../../../../disco/net/fd_net_tile.h`
- `../../../../disco/quic/fd_quic_tile.h`
- `../../../../waltz/quic/fd_quic_private.h`
- `../../../../util/tmpl/fd_map.c`


# Global Variables

---
### fd\_quic\_trace\_tile\_ctx\_remote
- **Type**: `void const *`
- **Description**: A pointer to a remote context in the local address space.
- **Use**: Used to access the remote context from the local address space.


---
### fd\_quic\_trace\_tile\_ctx\_raddr
- **Type**: `ulong`
- **Description**: The variable `fd_quic_trace_tile_ctx_raddr` is a global variable of type `ulong` that stores the remote address of a remote context in a QUIC tracing application.
- **Use**: Used to calculate relative addresses for translating pointers from remote to local address space.


---
### fd\_quic\_trace\_link\_metrics
- **Type**: `ulong volatile *`
- **Description**: A pointer to a volatile unsigned long integer that represents link metrics for QUIC tracing.
- **Use**: Used to access and possibly modify link metrics data in a QUIC tracing context.


---
### fd\_quic\_trace\_log\_base
- **Type**: `void const *`
- **Description**: A pointer to a constant memory location that serves as the base address for logging operations in the QUIC trace context.
- **Use**: Used to reference the starting point of log data in the QUIC tracing process.


---
### \_fd\_quic\_trace\_peer\_map
- **Type**: `peer_conn_id_map_t`
- **Description**: An array of `peer_conn_id_map_t` structures that maps peer connection IDs to connection indices. The array size is determined by the macro `PEER_MAP_LG_SLOT_CNT`, which defines the number of slots as a power of two.
- **Use**: Used to store and manage mappings between peer connection IDs and their corresponding connection indices in a QUIC tracing context.


---
### fd\_quic\_trace\_peer\_map
- **Type**: ``peer_conn_id_map_t *``
- **Description**: A pointer to a `peer_conn_id_map_t` structure, which maps peer connection IDs to connection indices. The `peer_conn_id_map_t` structure contains fields for a connection ID, a hash value for memoization, and a connection index.
- **Use**: Used to access and manage the mapping of peer connection IDs to their respective connection indices in the QUIC tracing context.


---
### fd\_quic\_trace\_target\_fseq
- **Type**: `ulong **`
- **Description**: `fd_quic_trace_target_fseq` is a pointer to a pointer of type `ulong`. It represents the fseq counters that are published by the target QUIC tile.
- **Use**: Used to access and manage the fseq counters for the target QUIC tile.


---
### fd\_action\_quic\_trace
- **Type**: ``action_t``
- **Description**: `fd_action_quic_trace` is a global variable of type `action_t`. It is declared as an external variable, indicating that it is defined elsewhere in the program. The `action_t` type is likely a structure or typedef that encapsulates specific actions or operations related to QUIC tracing.
- **Use**: Used to represent an action or operation related to QUIC tracing in the program.


# Data Structures

---
### peer\_conn\_id\_map
- **Type**: ``struct``
- **Members**:
    - `conn_id`: A unique identifier for the peer connection, assumed to be at least 8 bytes long.
    - `hash`: Stores a precomputed hash value for the connection ID.
    - `conn_idx`: Represents the index of the connection.
- **Description**: Maps a peer connection ID to a connection index, using a hash value for efficient lookup.


---
### peer\_conn\_id\_map\_t
- **Type**: ``struct``
- **Members**:
    - `conn_id`: Stores the peer connection ID, which is assumed to be at least 8 bytes long and truncated if longer.
    - `hash`: Memoizes the hash value for the connection ID.
    - `conn_idx`: Represents the connection index.
- **Description**: Maps a peer connection ID to a connection index, using a hash value for efficient lookup.


---
### fd\_quic\_trace\_ctx
- **Type**: ``struct``
- **Members**:
    - `dump`: Indicates if the user requested the `--dump` option.
    - `dump_config`: Indicates if the user requested the `--dump-config` option.
    - `dump_conns`: Indicates if the user requested the `--dump-conns` option.
    - `trace_send`: Indicates if the user requested tracing the send tile (1) or the QUIC tile (0).
    - `net_out_base`: Base address of net-out chunks in the local address space.
    - `quic`: Pointer to a local join to a remote QUIC instance.
    - `net_in_bounds`: Bounds of net-in chunks in the local address space.
    - `buffer`: Buffer with a size defined by `FD_NET_MTU`.
- **Description**: The `fd_quic_trace_ctx` structure holds configuration and state information for tracing QUIC operations. It includes flags for different dump options, a flag to determine the tracing target, and addresses for network input and output. It also contains a pointer to a QUIC instance and a buffer for data handling.


---
### fd\_quic\_trace\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - `dump`: Indicates if the user requested the `--dump` option.
    - `dump_config`: Indicates if the user requested the `--dump-config` option.
    - `dump_conns`: Indicates if the user requested the `--dump-conns` option.
    - `trace_send`: Indicates if the user requested tracing the send tile (1) or the QUIC tile (0).
    - `net_out_base`: Base address of net-out chunks in local address space.
    - `quic`: Pointer to a local join to a remote QUIC context.
    - `net_in_bounds`: Bounds of net-in chunks in local address space.
    - `buffer`: Buffer with a size defined by `FD_NET_MTU`.
- **Description**: `fd_quic_trace_ctx_t` is a structure that holds context information for tracing QUIC operations. It includes flags for user-requested dump options, a flag to determine whether to trace send or QUIC tiles, and addresses for network input and output. It also contains a pointer to a QUIC context and a buffer for data handling.


---
### fd\_quic\_trace\_frame\_ctx
- **Type**: ``struct``
- **Members**:
    - `conn_id`: A unique identifier for the connection.
    - `src_ip`: The source IP address of the packet.
    - `src_port`: The source port number of the packet.
    - `pkt_type`: The type of the packet.
    - `pkt_num`: The sequence number of the packet.
- **Description**: Represents the context of a QUIC trace frame, containing information about the connection, source IP and port, packet type, and packet number.


---
### fd\_quic\_trace\_frame\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``conn_id``: The connection identifier.
    - ``src_ip``: The source IP address.
    - ``src_port``: The source port number.
    - ``pkt_type``: The packet type.
    - ``pkt_num``: The packet number.
- **Description**: Contains information about a QUIC frame, including connection ID, source IP and port, packet type, and packet number.


# Functions

---
### fd\_quic\_trace\_conn\_at\_idx<!-- {{#callable:fd_quic_trace_conn_at_idx}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace.h#L92>)

Retrieves a pointer to a QUIC connection at a specified index.
- **Inputs**:
    - ``quic``: A pointer to a constant `fd_quic_t` structure representing the QUIC instance.
    - ``idx``: An unsigned long integer representing the index of the connection to retrieve.
- **Logic and Control Flow**:
    - Call `fd_quic_get_state_const` with `quic` to get a constant pointer to the `fd_quic_state_t` structure.
    - Use `translate_ptr` to convert the `conn_base` pointer from the state to a local address space pointer, storing the result in `local_conn_base`.
    - Calculate the address of the connection at the specified `idx` by adding `idx` multiplied by `state->conn_sz` to `local_conn_base`.
    - Cast the calculated address to a pointer of type `fd_quic_conn_t` and return it.
- **Output**: A constant pointer to an `fd_quic_conn_t` structure representing the connection at the specified index.


# Function Declarations (Public API)

---
### fd\_quic\_trace\_frames<!-- {{#callable_declaration:fd_quic_trace_frames}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace.h#L76>)

Processes QUIC frames from a data buffer.
- **Description**: Use this function to process a sequence of QUIC frames from a given data buffer. It iterates over the data, processing each frame until the buffer is exhausted or an error occurs. The function requires a valid context to interpret the frames correctly. It stops processing if a frame parsing failure is detected or if an unexpected condition arises, such as a frame size exceeding the remaining data size. Ensure that the context is properly initialized before calling this function.
- **Inputs**:
    - `context`: A pointer to an `fd_quic_trace_frame_ctx_t` structure that provides context for interpreting the frames. Must not be null.
    - `data`: A pointer to a buffer containing the data to process. The buffer must be valid and not null.
    - `data_sz`: The size of the data buffer in bytes. Must be greater than zero.
- **Output**: None
- **See Also**: [`fd_quic_trace_frames`](<fd_quic_trace_frame.c.md#fd_quic_trace_frames>)  (Implementation)


---
### fd\_quic\_trace\_rx\_tile<!-- {{#callable_declaration:fd_quic_trace_rx_tile}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace.h#L83>)

Processes received and transmitted QUIC tiles for tracing.
- **Description**: Use this function to trace QUIC tiles by processing both received and transmitted metadata caches. It requires a valid tracing context and metadata caches for both received and transmitted data. This function is typically used in environments where tracing of QUIC network activity is necessary. Ensure that the tracing context and metadata caches are properly initialized before calling this function.
- **Inputs**:
    - `trace_ctx`: A pointer to an `fd_quic_trace_ctx_t` structure. This must be a valid and initialized tracing context. The caller retains ownership and must ensure it is not null.
    - `rx_mcache`: A pointer to a constant `fd_frag_meta_t` structure representing the received metadata cache. This must be valid and properly initialized. The caller retains ownership and must ensure it is not null.
    - `tx_mcache`: A pointer to a constant `fd_frag_meta_t` structure representing the transmitted metadata cache. This must be valid and properly initialized. The caller retains ownership and must ensure it is not null.
- **Output**: None
- **See Also**: [`fd_quic_trace_rx_tile`](<fd_quic_trace_rx_tile.c.md#fd_quic_trace_rx_tile>)  (Implementation)


---
### fd\_quic\_trace\_log\_tile<!-- {{#callable_declaration:fd_quic_trace_log_tile}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/quic_trace/fd_quic_trace.h#L88>)

Logs QUIC trace data for a tile.
- **Description**: Use this function to log QUIC trace data for a specific tile. It requires a context that contains configuration and state information for the QUIC trace operation. The function processes the input metadata cache to perform the logging. Ensure that the context and metadata cache are properly initialized before calling this function.
- **Inputs**:
    - `ctx`: A pointer to an `fd_quic_trace_ctx_t` structure. This structure must be initialized and contain the necessary configuration and state for the QUIC trace operation. The pointer must not be null.
    - `in_mcache`: A pointer to a constant `fd_frag_meta_t` structure representing the input metadata cache. This must be a valid pointer and properly initialized. The function does not modify the data pointed to by this parameter.
- **Output**: None
- **See Also**: [`fd_quic_trace_log_tile`](<fd_quic_trace_log_tile.c.md#fd_quic_trace_log_tile>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)