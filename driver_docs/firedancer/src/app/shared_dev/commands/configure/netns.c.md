<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Configures and manages network namespaces, including creation, deletion, and verification of interfaces.

# Purpose
The code is a C module that manages network namespaces for a specific configuration. It defines a `configure_stage_t` structure named `fd_cfg_stage_netns`, which includes several function pointers for enabling, initializing, finalizing, and checking the configuration of network namespaces. The module uses the `RUN` macro to execute system commands for creating, configuring, and deleting network namespaces and virtual Ethernet interfaces. It configures network interfaces with specific MAC addresses and IP addresses, and adjusts network settings such as disabling UDP segmentation offload to ensure proper operation within network namespaces.

The module includes functions such as [`init`](<#init>), [`fini`](<#fini>), and [`check`](<#check>) to handle the lifecycle of the network namespaces. The [`init`](<#init>) function sets up the network namespaces and interfaces, while the [`fini`](<#fini>) function cleans up by deleting them. The [`check`](<#check>) function verifies the existence and accessibility of the network namespaces. The module relies on configuration data provided through a `config_t` structure, which specifies details like interface names and addresses. The code is intended to be part of a larger system where network namespace management is required, and it provides a structured approach to configure and manage these namespaces based on the given configuration.
# Imports and Dependencies

---
- `../../../shared/commands/configure/configure.h`
- `errno.h`
- `stdlib.h`
- `sys/stat.h`


# Global Variables

---
### fd\_cfg\_stage\_netns
- **Type**: ``configure_stage_t``
- **Description**: Defines a configuration stage for managing network namespaces. It includes function pointers for enabling, initializing, finalizing, and checking the network namespace configuration.
- **Use**: Used to manage the lifecycle and configuration of network namespaces in a structured manner.


# Functions

---
### enabled<!-- {{#callable:enabled}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/configure/netns.c#L10>)

Returns the enabled status of the network namespace configuration from the given configuration object.
- **Inputs**:
    - `config`: A pointer to a constant `config_t` structure that contains the configuration data.
- **Logic and Control Flow**:
    - Accesses the `development.netns.enabled` field from the `config` structure.
    - Returns the value of the `enabled` field.
- **Output**: An integer representing the enabled status of the network namespace configuration.


---
### init\_perm<!-- {{#callable:init_perm}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/configure/netns.c#L15>)

Initializes permissions for creating and entering network namespaces.
- **Inputs**:
    - `chk`: A pointer to a `fd_cap_chk_t` structure that is used to check capabilities.
    - `config`: A pointer to a `config_t` structure, which is not used in this function.
- **Logic and Control Flow**:
    - Calls the function `fd_cap_chk_root` with `chk`, `NAME`, and a description string to check root capabilities for network namespace operations.
- **Output**: No output is returned as the function is of type `void`.


---
### fini\_perm<!-- {{#callable:fini_perm}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/configure/netns.c#L21>)

Removes network namespaces by invoking `fd_cap_chk_root` with the appropriate parameters.
- **Inputs**:
    - `chk`: A pointer to an `fd_cap_chk_t` structure, used for capability checking.
    - `config`: A pointer to a constant `config_t` structure, which is not used in this function.
- **Logic and Control Flow**:
    - Calls `fd_cap_chk_root` with `chk`, `NAME`, and the string "remove network namespaces" to perform the removal of network namespaces.
- **Output**: No output is returned as the function has a `void` return type.


---
### init<!-- {{#callable:init}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/configure/netns.c#L46>)

Initializes network namespaces and configures virtual Ethernet interfaces based on the provided configuration.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing network namespace and interface configuration details.
- **Logic and Control Flow**:
    - Retrieve the number of tiles and interface names from the `config` structure.
    - Create two network namespaces using the `ip netns add` command for the specified interfaces.
    - Add a virtual Ethernet (veth) link between the two namespaces with the specified number of RX and TX queues.
    - Set the MAC addresses for the interfaces within their respective namespaces using `ip link set`.
    - Assign IP addresses to the interfaces within their namespaces using `ip address add`.
    - Bring up the interfaces using `ip link set dev up`.
    - Configure the number of RX and TX channels for each interface using `ethtool --set-channels`.
    - Disable UDP segmentation offload, generic segmentation offload, and TX GRE segmentation for each interface using `ethtool -K`.
- **Output**: No return value; the function performs system configuration tasks.


---
### fini<!-- {{#callable:fini}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/configure/netns.c#L97>)

Deletes network interfaces and namespaces specified in the configuration.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing network namespace configuration details.
    - `pre_init`: An integer parameter that is not used in this function.
- **Logic and Control Flow**:
    - Retrieve `interface0` and `interface1` from the `config` structure.
    - Format and execute a command to delete the network link for `interface0`, which also affects `interface1`.
    - Log a debug message if the deletion of the network link fails.
    - Format and execute commands to delete the network namespaces for `interface0` and `interface1`.
    - Log an error and terminate if both namespace deletions fail.
- **Output**: Returns the integer `1` to indicate completion.


---
### check<!-- {{#callable:check}} -->
[View Source →](<../../../../../../../src/app/shared_dev/commands/configure/netns.c#L120>)

Checks the existence and readability of network namespace interfaces specified in the configuration.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing network namespace interface names.
- **Logic and Control Flow**:
    - Retrieve `interface0` and `interface1` from the `config` structure.
    - Format the path to the network namespace for `interface0` and check if it exists and is readable using `stat`.
    - If `stat` fails for `interface0` and the error is not `ENOENT`, call `PARTIALLY_CONFIGURED` with an error message.
    - Format the path to the network namespace for `interface1` and check if it exists and is readable using `stat`.
    - If `stat` fails for `interface1` and the error is not `ENOENT`, call `PARTIALLY_CONFIGURED` with an error message.
    - If both `interface0` and `interface1` do not exist, call `NOT_CONFIGURED` with an error message.
    - If only `interface0` does not exist, call `NOT_CONFIGURED` with an error message.
    - If only `interface1` does not exist, call `NOT_CONFIGURED` with an error message.
    - If both interfaces exist and are readable, call `CONFIGURE_OK`.
- **Output**: Returns a `configure_result_t` indicating the configuration status of the network namespaces.



---
Made with ❤️ by [Driver](https://www.driver.ai/)