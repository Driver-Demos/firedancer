<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Bootstraps and executes a development environment process with permission checks and command handling.

# Purpose
The code is a C source file that defines a main function, [`fd_dev_main`](<#fd_dev_main>), which serves as the entry point for a development and testing command-line tool. This tool is designed to manage and execute various actions or subcommands, which are defined in an array of `action_t` structures named `ACTIONS`. The tool processes command-line arguments to determine the appropriate action to execute, such as displaying version information, help, or executing a specific subcommand. It also handles configuration settings, logging, and permission checks to ensure the tool runs with the necessary privileges.

The file includes several headers that provide shared configurations, actions, and utility functions. It defines a static function, [`execve_as_root`](<#execve_as_root>), which attempts to rerun the current process with elevated privileges using `sudo` if the necessary permissions are not available. The [`fd_dev_main`](<#fd_dev_main>) function initializes the environment, processes command-line arguments, and checks for specific flags such as `--no-sandbox` and `--no-clone`. It also verifies if the tool is being used in a development environment and ensures that the appropriate permissions are set before executing the desired action. The code is structured to support modular actions, each with its own function and permission requirements, making it suitable for a development and testing environment.
# Imports and Dependencies

---
- `fd_dev_boot.h`
- `../../shared/fd_config.h`
- `../../shared/fd_action.h`
- `../../shared/boot/fd_boot.h`
- `../../platform/fd_file_util.h`
- `errno.h`
- `unistd.h`
- `stdlib.h`
- `stdio.h`
- `sys/types.h`
- `sys/stat.h`


# Global Variables

---
### fd\_log\_private\_path
- **Type**: ``char` array`
- **Description**: A global character array with a size of 1024 elements.
- **Use**: Stores the private path for logging purposes.


---
### ACTIONS
- **Type**: ``action_t *` array`
- **Description**: Represents an array of pointers to `action_t` structures, which define various actions or commands that the program can execute.
- **Use**: Used to look up and execute specific actions based on command-line input.


---
### config
- **Type**: ``config_t``
- **Description**: Represents a global configuration structure used throughout the program. It is defined as a variable of type `config_t`, which is likely a structure that holds various configuration settings for the application.
- **Use**: Used to store and manage configuration settings that are accessed and modified by different functions in the program.


# Functions

---
### execve\_as\_root<!-- {{#callable:execve_as_root}} -->
[View Source →](<../../../../../../src/app/shared_dev/boot/fd_dev_boot.c#L24>)

Reruns the current process as root using `sudo`, preserving specific environment variables and command-line arguments.
- **Inputs**:
    - `argc`: The number of command-line arguments passed to the function.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Retrieve the current executable path using `fd_file_util_self_exe` and store it in `_current_executable_path`.
    - Initialize an array `args` to hold the command-line arguments for `sudo`, starting with `sudo`, `-E`, and the current executable path.
    - Copy the original command-line arguments from `argv` into `args`, starting from the third position.
    - Add `--log-path` and the value of `fd_log_private_path` to `args`, followed by a `NULL` terminator.
    - Initialize an array `envp` to hold environment variables, and populate it with `FIREDANCER_CONFIG_TOML` and `TERM` if they are set in the current environment.
    - Use `execve` to replace the current process with a new one running `sudo` with the specified arguments and environment variables.
    - Log an error and exit if `execve` fails.
- **Output**: This function does not return as it replaces the current process with a new one using `execve`.


---
### fd\_dev\_main<!-- {{#callable:fd_dev_main}} -->
[View Source →](<../../../../../../src/app/shared_dev/boot/fd_dev_boot.c#L59>)

Processes command-line arguments, initializes configurations, and executes specified actions for a development environment.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `_argv`: An array of command-line argument strings.
    - `is_firedancer`: A flag indicating if the Firedancer environment is active.
    - `configs`: An array of configuration file pointers.
    - `topo_init`: A function pointer for initializing topology with a given configuration.
- **Logic and Control Flow**:
    - Saves the original argument list for potential respawn as a privileged process.
    - Checks if the number of arguments exceeds `MAX_ARGC` and logs an error if true.
    - Strips specific command-line options such as `--log-level-stderr`, `--log-path`, `--no-sandbox`, and `--no-clone`.
    - Determines the action name based on the first non-option argument or defaults to 'dev'.
    - Searches for the action in the `ACTIONS` array and executes it if it is immediate.
    - Initializes logging and main configurations using `fd_main_init`.
    - Adjusts configuration settings based on command-line options and environment.
    - Checks if the action is allowed in a live cluster and logs an error if not.
    - Executes the topology initialization function if specified by the action.
    - Processes additional arguments using the action's argument function.
    - Verifies permissions using the action's permission function and reruns as root if necessary.
    - Executes the action's main function with the prepared arguments and configuration.
- **Output**: Returns 0 upon successful execution of the specified action.
- **Functions Called**:
    - [`execve_as_root`](<#execve_as_root>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)