<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A basic RPC client for retrieving information from the Agave validator, not intended for production use.

# Purpose
The code is a C header file that defines an RPC (Remote Procedure Call) client for interacting with the Agave validator. It is not intended to be a comprehensive RPC implementation but rather a basic client for code interoperability. The file includes definitions for error codes, client states, and request methods, such as `FD_RPC_CLIENT_METHOD_LATEST_BLOCK_HASH` and `FD_RPC_CLIENT_METHOD_TRANSACTION_COUNT`. These methods allow the client to request the latest block hash and the current transaction count from the server.

The header file defines a structure `fd_rpc_client_response_t` to store the response from the server, including the request ID, method, status, and result. It provides several functions for managing the RPC client, such as [`fd_rpc_client_new`](<#fd_rpc_client_new>), [`fd_rpc_client_wait_ready`](<#fd_rpc_client_wait_ready>), [`fd_rpc_client_request_latest_block_hash`](<#fd_rpc_client_request_latest_block_hash>), and [`fd_rpc_client_service`](<#fd_rpc_client_service>). These functions handle client initialization, server readiness checks, request submissions, and response processing. The file also includes utility functions like [`fd_rpc_client_strerror`](<#fd_rpc_client_strerror>) to convert error codes to human-readable strings. The client is designed to handle multiple requests, but it is not fuzzed or hardened, and it should not be used in critical applications.
# Imports and Dependencies

---
- `../../../util/fd_util.h`
- `poll.h`


# Data Structures

---
### fd\_rpc\_client\_response\_t
- **Type**: ``struct``
- **Members**:
    - ``request_id``: A unique identifier for the RPC request.
    - ``method``: Specifies the method used in the RPC request.
    - ``status``: Indicates the status of the RPC request.
    - ``result``: A union that holds the result of the RPC request, which can be either the latest block hash or the transaction count.
- **Description**: Represents the response from an RPC client, containing the request ID, method, status, and a union for the result, which can include either the latest block hash or the transaction count.


---
### fd\_rpc\_client\_t
- **Type**: ``struct``
- **Description**: `fd_rpc_client_t` is a typedef for a private structure `fd_rpc_client_private`, which is part of a poor RPC client implementation intended to retrieve information from the Agave validator. This structure is not intended for use in a Firedancer RPC implementation and lacks fuzzing or hardening, making it unsuitable for critical code. The structure is used in functions that manage RPC requests, handle responses, and maintain the state of the RPC client.


# Functions

---
### fd\_rpc\_client\_strerror<!-- {{#callable:fd_rpc_client_strerror}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L58>)

Maps error codes to their corresponding error message strings for an RPC client.
- **Inputs**:
    - `err`: A long integer representing the error code to be translated into a human-readable string.
- **Logic and Control Flow**:
    - Use a switch statement to evaluate the input `err`.
    - Return "Success" if `err` is `FD_RPC_CLIENT_SUCCESS`.
    - Return "Pending" if `err` is `FD_RPC_CLIENT_PENDING`.
    - Return "Not found" if `err` is `FD_RPC_CLIENT_ERR_NOT_FOUND`.
    - Return "Request too large" if `err` is `FD_RPC_CLIENT_ERR_TOO_LARGE`.
    - Return "Too many requests in flight" if `err` is `FD_RPC_CLIENT_ERR_TOO_MANY`.
    - Return "Malformed response" if `err` is `FD_RPC_CLIENT_ERR_MALFORMED`.
    - Return "Network error" if `err` is `FD_RPC_CLIENT_ERR_NETWORK`.
    - Return "Unknown error" for any other value of `err`.
- **Output**: A constant character pointer to a string that describes the error.


---
### fd\_rpc\_client\_align<!-- {{#callable:fd_rpc_client_align}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L72>)

Returns the alignment requirement for the RPC client.
- **Inputs**: None
- **Logic and Control Flow**:
    - Return the value of the macro `FD_RPC_CLIENT_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment requirement for the RPC client.


---
### fd\_rpc\_client\_footprint<!-- {{#callable:fd_rpc_client_footprint}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L73>)

Returns the constant footprint size of the RPC client.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_RPC_CLIENT_FOOTPRINT`.
- **Output**: The function returns an `ulong` representing the footprint size of the RPC client, which is defined by the macro `FD_RPC_CLIENT_FOOTPRINT`.


---
### fd\_rpc\_client\_join<!-- {{#callable:fd_rpc_client_join}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L80>)

Casts a generic pointer to a `fd_rpc_client_t` pointer.
- **Inputs**:
    - `_rpc`: A generic pointer to be cast to a `fd_rpc_client_t` pointer.
- **Logic and Control Flow**:
    - Casts the input pointer `_rpc` to a `fd_rpc_client_t` pointer.
    - Returns the casted pointer.
- **Output**: A pointer of type `fd_rpc_client_t *`.


---
### fd\_rpc\_client\_leave<!-- {{#callable:fd_rpc_client_leave}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L81>)

Converts a pointer to an `fd_rpc_client_t` object into a generic `void` pointer.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` object that represents the RPC client to leave.
- **Logic and Control Flow**:
    - Cast the `rpc` pointer of type `fd_rpc_client_t *` to a `void *` pointer.
    - Return the casted `void *` pointer.
- **Output**: A `void *` pointer that represents the input `fd_rpc_client_t` object.


---
### fd\_rpc\_client\_delete<!-- {{#callable:fd_rpc_client_delete}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L82>)

Returns the input pointer `_rpc` without modification.
- **Inputs**:
    - `_rpc`: A pointer to an RPC client object that is to be deleted.
- **Logic and Control Flow**:
    - The function takes a single input parameter `_rpc`.
    - It returns the same pointer `_rpc` without any modification or additional operations.
- **Output**: The function returns the input pointer `_rpc` as a `void *`.


# Function Declarations (Public API)

---
### fd\_rpc\_client\_new<!-- {{#callable_declaration:fd_rpc_client_new}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L75>)

Creates a new RPC client instance.
- **Description**: Use this function to initialize a new RPC client instance with a specified memory location, RPC address, and port. This function prepares the client to send and receive RPC requests. Ensure that the memory provided is properly aligned and has sufficient space as defined by `FD_RPC_CLIENT_ALIGN` and `FD_RPC_CLIENT_FOOTPRINT`. The function does not perform any network operations or validations on the address and port; it only sets up the client structure.
- **Inputs**:
    - `mem`: A pointer to a memory block where the RPC client instance will be initialized. The memory must be aligned to `FD_RPC_CLIENT_ALIGN` and have a size of at least `FD_RPC_CLIENT_FOOTPRINT`. The caller retains ownership of this memory.
    - `rpc_addr`: An unsigned integer representing the RPC server address. The function does not validate this address.
    - `rpc_port`: An unsigned short representing the RPC server port. The function does not validate this port.
- **Output**: Returns a pointer to the initialized RPC client instance. The caller is responsible for managing the lifecycle of this instance.
- **See Also**: [`fd_rpc_client_new`](<fd_rpc_client.c.md#fd_rpc_client_new>)  (Implementation)


---
### fd\_rpc\_client\_wait\_ready<!-- {{#callable_declaration:fd_rpc_client_wait_ready}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L91>)

Waits for the RPC server to be ready to receive requests.
- **Description**: Use this function to block until the RPC server is ready to accept requests. It is a blocking call that will wait indefinitely if `timeout_ns` is set to -1, or for a specified number of nanoseconds otherwise. If the server becomes ready within the timeout period, the function returns success. If the timeout is reached without the server becoming ready, it returns a network error. This function should be called before making any RPC requests to ensure the server is ready.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` structure representing the RPC client. Must not be null.
    - `timeout_ns`: The maximum time to wait in nanoseconds. If set to -1, the function waits indefinitely. Must be a non-negative value or -1.
- **Output**: Returns `FD_RPC_CLIENT_SUCCESS` if the server is ready, or `FD_RPC_CLIENT_ERR_NETWORK` if a network error occurs or the timeout is reached.
- **See Also**: [`fd_rpc_client_wait_ready`](<fd_rpc_client.c.md#fd_rpc_client_wait_ready>)  (Implementation)


---
### fd\_rpc\_client\_request\_latest\_block\_hash<!-- {{#callable_declaration:fd_rpc_client_request_latest_block_hash}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L101>)

Make an RPC request to get the latest block hash.
- **Description**: Use this function to request the latest block hash from the RPC server. It returns a unique request ID for the operation if successful. If the request cannot be processed, a negative error code is returned. Ensure that the RPC client is ready and connected before calling this function. Handle potential errors, such as too many requests in flight, by checking the return value.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` structure representing the RPC client. Must not be null. The client should be properly initialized and connected to the server before use.
- **Output**: Returns a non-negative request ID on success. On failure, returns a negative error code, such as `FD_RPC_CLIENT_ERR_TOO_MANY` if there are too many requests in flight.
- **See Also**: [`fd_rpc_client_request_latest_block_hash`](<fd_rpc_client.c.md#fd_rpc_client_request_latest_block_hash>)  (Implementation)


---
### fd\_rpc\_client\_request\_transaction\_count<!-- {{#callable_declaration:fd_rpc_client_request_transaction_count}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L110>)

Make an RPC request to get the current transaction count.
- **Description**: Use this function to request the current transaction count from the RPC server. It returns a request ID if successful, which can be used to track the request's status. Ensure that the RPC client is ready to send requests before calling this function. Handle the possibility of failure, which is indicated by a negative return value. Too many concurrent requests will result in a specific error code.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` structure representing the RPC client. Must not be null. The client must be properly initialized and connected to the server before use.
- **Output**: Returns a non-negative request ID on success. On failure, returns a negative error code, such as `FD_RPC_CLIENT_ERR_TOO_MANY` if there are too many requests in flight.
- **See Also**: [`fd_rpc_client_request_transaction_count`](<fd_rpc_client.c.md#fd_rpc_client_request_transaction_count>)  (Implementation)


---
### fd\_rpc\_client\_service<!-- {{#callable_declaration:fd_rpc_client_service}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L126>)

Services all RPC connections to send and receive data.
- **Description**: Use this function to manage the sending and receiving of data for all active RPC connections. It processes requests by sending data and receiving responses, making progress on any pending RPC requests. This function can operate in both non-blocking and blocking modes, depending on the `wait` parameter. In non-blocking mode, it returns immediately after attempting to send and receive data. In blocking mode, it waits until some progress is made, although it may still return without a response if no progress is possible. This function is essential for maintaining the flow of data in the RPC client and should be called regularly to ensure timely processing of requests.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` structure representing the RPC client. Must not be null. The caller retains ownership.
    - `wait`: An integer indicating the mode of operation. If non-zero, the function operates in blocking mode, waiting for progress. If zero, it operates in non-blocking mode, returning immediately.
- **Output**: Returns 1 if any progress was made on a connection, otherwise returns 0.
- **See Also**: [`fd_rpc_client_service`](<fd_rpc_client.c.md#fd_rpc_client_service>)  (Implementation)


---
### fd\_rpc\_client\_status<!-- {{#callable_declaration:fd_rpc_client_status}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L140>)

Get the response of an RPC request by ID.
- **Description**: Use this function to retrieve the response of a previously made RPC request identified by `request_id`. If the response is not yet available, the function will return a status of `FD_RPC_PENDING`. If `wait` is true, the function will block until the response is available or an error occurs, ensuring it does not return `FD_RPC_PENDING`. If the `request_id` does not exist or has already been closed, the function returns `NULL`. This function is useful for checking the status of an RPC request and obtaining its result once it is complete.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` instance. Must not be null. The caller retains ownership.
    - `request_id`: A long integer representing the ID of the RPC request. Must correspond to a valid, open request.
    - `wait`: An integer flag indicating whether to block until the response is available. Non-zero to block, zero for non-blocking behavior.
- **Output**: A pointer to an `fd_rpc_client_response_t` structure containing the response, or `NULL` if the request ID is invalid or closed.
- **See Also**: [`fd_rpc_client_status`](<fd_rpc_client.c.md#fd_rpc_client_status>)  (Implementation)


---
### fd\_rpc\_client\_close<!-- {{#callable_declaration:fd_rpc_client_close}} -->
[View Source →](<../../../../../../src/app/shared_dev/rpc_client/fd_rpc_client.h#L153>)

Close the request with the given ID.
- **Description**: Use this function to close an RPC request identified by `request_id`. If the request is still pending, it will be abandoned. If the request has already been closed or does not exist, the function will return without any action. It is important to close all RPC requests after inspecting the results to prevent resource exhaustion, which can cause subsequent requests to fail with `FD_RPC_ERR_TOO_MANY`. This function does not return any value and does not indicate success or failure.
- **Inputs**:
    - `rpc`: A pointer to an `fd_rpc_client_t` structure representing the RPC client. Must not be null. The caller retains ownership.
    - `request_id`: A long integer representing the ID of the request to close. If the request does not exist or is already closed, the function will return without action.
- **Output**: None
- **See Also**: [`fd_rpc_client_close`](<fd_rpc_client.c.md#fd_rpc_client_close>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)