<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Configures and initializes network topology and tile settings for the Firedancer application.

# Purpose
The code is a C source file that configures and initializes a network topology for a distributed system. It includes several header files that provide necessary definitions and functions for network configuration, topology management, and utility operations. The primary function, [`fd_topo_initialize`](<#fd_topo_initialize>), sets up the network topology by defining various tiles and links, which represent different components and communication paths in the system. These tiles and links are configured based on the provided configuration structure, `config_t`, which contains parameters such as tile counts, buffer sizes, and CPU affinities.

The file defines functions to parse IP addresses and ports, configure individual tiles, and establish links between them. The [`fd_topo_configure_tile`](<#fd_topo_configure_tile>) function configures specific properties of each tile based on its type, such as network, QUIC, bundle, verify, dedup, and others. The code also handles CPU affinity settings, ensuring that tiles are assigned to appropriate CPUs, and checks for configuration consistency. Additionally, it supports optional features like plugins and GUI components, which are conditionally configured based on the configuration settings. The code is structured to facilitate the setup of a complex network topology with multiple interconnected components, each with specific roles and configurations.
# Imports and Dependencies

---
- `../shared/fd_config.h`
- `../../disco/net/fd_net_tile.h`
- `../../disco/quic/fd_tpu.h`
- `../../disco/tiles.h`
- `../../disco/topo/fd_topob.h`
- `../../disco/topo/fd_cpu_topo.h`
- `../../disco/plugin/fd_plugin.h`
- `../../util/pod/fd_pod_format.h`
- `../../util/net/fd_ip4.h`
- `../../util/tile/fd_tile_private.h`


# Global Variables

---
### CALLBACKS
- **Type**: ``fd_topo_obj_callbacks_t * []``
- **Description**: An array of pointers to `fd_topo_obj_callbacks_t` structures. These structures likely contain callback functions related to topology objects.
- **Use**: Used to store and manage callback functions for topology objects in the system.


# Functions

---
### parse\_ip\_port<!-- {{#callable:parse_ip_port}} -->
[View Source →](<../../../../../src/app/fdctl/topology.c#L15>)

Parses an IP address and port from a string and stores the result in a `fd_topo_ip_port_t` structure.
- **Inputs**:
    - `name`: A string representing the name of the entity being parsed, used for error logging.
    - `ip_port`: A string in the format 'ip:port' that contains the IP address and port to parse.
    - `parsed_ip_port`: A pointer to a `fd_topo_ip_port_t` structure where the parsed IP address and port will be stored.
- **Logic and Control Flow**:
    - Copy the `ip_port` string into a buffer `buf` of fixed size.
    - Find the position of the colon ':' in `buf` to separate the IP address from the port.
    - If the colon is not found, log an error indicating the expected format and exit.
    - Terminate the IP address string at the colon position by replacing it with a null character.
    - Convert the IP address part of `buf` to a 32-bit integer and store it in `parsed_ip_port->ip`; log an error if conversion fails.
    - Convert the port part of the string to an unsigned short and store it in `parsed_ip_port->port`; log an error if conversion fails.
- **Output**: The function does not return a value but populates the `parsed_ip_port` structure with the parsed IP address and port.


---
### fd\_topo\_initialize<!-- {{#callable:fd_topo_initialize}} -->
[View Source →](<../../../../../src/app/fdctl/topology.c#L37>)

Initializes the topology configuration for a system based on the provided configuration settings.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing configuration settings for the system layout, network, tiles, and other parameters.
- **Logic and Control Flow**:
    - Retrieve tile counts from the `config` structure for various components such as net, quic, verify, resolv, bank, and shred.
    - Create a new topology object using `fd_topob_new` and set its maximum page size and gigantic page threshold based on the `config` settings.
    - Initialize workspaces for various components using `fd_topob_wksp`.
    - Establish links between components using `fd_topob_link`, setting parameters like depth, MTU, and burst size.
    - Parse CPU affinity settings from the `config` and validate them, logging errors if inconsistencies are found.
    - Initialize CPU topology and parse CPU allocations for tiles, storing them in `tile_to_cpu`.
    - Configure network tiles using `fd_topos_net_tiles` and set up receive links for network components.
    - Configure tiles for various components using `fd_topob_tile`, specifying parameters like workspace, CPU index, and whether they use keyswitch.
    - Set up input and output links for tiles using `fd_topob_tile_in` and `fd_topob_tile_out`, specifying reliability and polling settings.
    - Handle special cases for plugins, GUI, and bundle components, initializing additional workspaces and links if enabled.
    - Check for CPU affinity mismatches and log warnings or errors as needed.
    - Configure special sequences (`fseq`) for communication between tiles, such as `bank_busy` and `poh_shred`.
    - Finalize network tile setup using `fd_topos_net_tile_finish`.
    - Configure each tile using [`fd_topo_configure_tile`](<#fd_topo_configure_tile>) based on the `config` settings.
    - Automatically layout the topology if auto-affinity is enabled using `fd_topob_auto_layout`.
    - Complete the topology setup with `fd_topob_finish` and update the `config` with the new topology.
- **Output**: The function does not return a value; it modifies the `config` structure to include the initialized topology.
- **Functions Called**:
    - [`fd_topo_configure_tile`](<#fd_topo_configure_tile>)


---
### fd\_topo\_configure\_tile<!-- {{#callable:fd_topo_configure_tile}} -->
[View Source →](<../../../../../src/app/fdctl/topology.c#L398>)

Configures a `fd_topo_tile_t` structure based on its name and the provided `fd_config_t` configuration.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure that represents the tile to configure.
    - `config`: A pointer to a `fd_config_t` structure that contains configuration settings for the tile.
- **Logic and Control Flow**:
    - Retrieve the `plugins_enabled` status from the `config` structure.
    - Check the `tile->name` to determine the type of tile and configure it accordingly.
    - For 'net' or 'sock' tiles, set the `shred_listen_port`, `quic_transaction_listen_port`, and `legacy_transaction_listen_port` from the `config`.
    - For 'quic' tiles, configure various parameters such as `reasm_cnt`, `out_depth`, `max_concurrent_connections`, and others from the `config`.
    - For 'bundle' tiles, set URL, SNI, identity key path, and other parameters from the `config`.
    - For 'verify' and 'dedup' tiles, set `tcache_depth` from the `config`.
    - For 'pack' tiles, configure transaction limits, bank tile count, and other parameters, and handle bundle settings if enabled.
    - For 'poh' tiles, configure identity key path, plugins enabled status, and bundle settings if enabled.
    - For 'shred' tiles, configure identity key path, depth, and additional shred destinations from the `config`.
    - For 'store' tiles, set `disable_blockstore_from_slot` from the `config`.
    - For 'sign' tiles, set the identity key path from the `config`.
    - For 'metric' tiles, parse and set the Prometheus listen address and port from the `config`.
    - For 'gui' tiles, parse and set the GUI listen address and port, and configure other GUI-related settings from the `config`.
    - Log an error if the tile name is unknown.
- **Output**: No return value; the function modifies the `tile` structure in place.
- **Functions Called**:
    - [`parse_ip_port`](<#parse_ip_port>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)