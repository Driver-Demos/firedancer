<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A wrapper for ethtool ioctl commands to manage network device features, channels, RXFH tables, and ntuple rules.

# Purpose
The `fd_ethtool_ioctl.h` file is a C header file that provides a set of functions for managing network devices using the older ioctl interface. This interface is used to perform various network device operations that are not fully supported by the more modern generic netlink API. The file defines a structure, `fd_ethtool_ioctl_t`, which is used to encapsulate the necessary resources for issuing ioctl system calls on a specified network device. The functions in this file allow for the configuration and management of network device features such as channels, RXFH (Receive Flow Hash) tables, feature flags, and n-tuple flow steering rules.

The header file includes functions to initialize and finalize the ioctl resources, set and get the number of active channels, and manage the RXFH table to control packet steering across multiple queues. It also provides functions to enable or disable specific network device features and to manage n-tuple rules for hardware flow steering. Special handling is included for the `EOPNOTSUPP` error to ensure correct behavior on devices that do not support certain ioctl commands. The file defines several constants and macros, such as `FD_ETHTOOL_MAX_RXFH_TABLE_CNT`, which specifies the maximum size of the RXFH table, and feature names like `FD_ETHTOOL_FEATURE_NTUPLE`, which are used in the feature management functions.
# Imports and Dependencies

---
- `linux/if.h`
- `../../../../util/fd_util_base.h`


# Data Structures

---
### fd\_ethtool\_ioctl
- **Type**: ``struct``
- **Members**:
    - ``fd``: An integer file descriptor for the network device.
    - ``ifr``: A `struct ifreq` that holds interface request information for ioctl operations.
- **Description**: The `fd_ethtool_ioctl` structure is a wrapper for managing network device operations using ioctl commands. It contains a file descriptor and an interface request structure, which are used to perform various network device configurations and queries, such as setting the number of channels, modifying RXFH tables, and managing device features and ntuple rules.


---
### fd\_ethtool\_ioctl\_t
- **Type**: ``struct``
- **Members**:
    - ``fd``: File descriptor for the network device.
    - ``ifr``: Interface request structure used for ioctl operations.
- **Description**: A `struct fd_ethtool_ioctl` is a wrapper around the ethtool ioctl commands for managing network devices. It contains a file descriptor and an interface request structure, which are used to perform various network device operations such as setting and getting channel numbers, modifying RXFH tables, managing device features, and handling ntuple rules. This structure facilitates interaction with network devices through the ioctl interface, providing a means to configure and query device settings.


---
### fd\_ethtool\_ioctl\_channels
- **Type**: ``struct``
- **Members**:
    - `supported`: Indicates if multiqueue is supported by the hardware.
    - `current`: Represents the current number of active channels or queues.
    - `max`: Specifies the maximum number of channels or queues allowed by the hardware.
- **Description**: The `fd_ethtool_ioctl_channels` structure holds information about the channel configuration of a network device, specifically in the context of multiqueue support. It includes fields to indicate whether multiqueue is supported, the current number of active channels, and the maximum number of channels that the hardware can support. This structure is used in conjunction with ioctl commands to manage and query the channel configuration of network devices.


---
### fd\_ethtool\_ioctl\_channels\_t
- **Type**: ``struct``
- **Members**:
    - `supported`: Indicates if multiqueue is supported by the hardware.
    - `current`: Represents the current number of active channels or queues.
    - `max`: Specifies the maximum number of channels or queues allowed by the hardware.
- **Description**: The `fd_ethtool_ioctl_channels_t` structure is used to manage and query the state of network device channels, particularly in the context of multiqueue support. It contains information about whether multiqueue is supported, the current number of active channels, and the maximum number of channels that the hardware can support. This structure is part of a larger system for managing network device configurations using ioctl commands.


# Function Declarations (Public API)

---
### fd\_ethtool\_ioctl\_fini<!-- {{#callable_declaration:fd_ethtool_ioctl_fini}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L66>)

Closes resources used by a network device ioctl wrapper.
- **Description**: Use this function to release resources associated with a network device ioctl wrapper after operations are complete. It must be called to close the file descriptor and reset the associated data structure to a default state. This function should be called when the ioctl operations are no longer needed to ensure proper cleanup and avoid resource leaks.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure. Must not be null. The function will close the file descriptor and reset the structure's fields.
- **Output**: None
- **See Also**: [`fd_ethtool_ioctl_fini`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_fini>)  (Implementation)


---
### fd\_ethtool\_ioctl\_channels\_set\_num<!-- {{#callable_declaration:fd_ethtool_ioctl_channels_set_num}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L73>)

Sets the number of active network device channels.
- **Description**: Use this function to configure the number of active channels or queues for a network device. If the specified number is zero, the function sets the channels to the maximum number allowed by the hardware. This function must be called after initializing the `fd_ethtool_ioctl_t` structure with `fd_ethtool_ioctl_init`. It returns a nonzero value on failure, which can occur if the ioctl command is not supported by the network device. In such cases, if the number is zero or one, the function assumes a single channel and returns success.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure that represents the network device. Must not be null and must be initialized with `fd_ethtool_ioctl_init` before use.
    - `num`: The desired number of active channels. If set to zero, the function will configure the maximum number of channels allowed by the hardware.
- **Output**: Returns zero on success and a nonzero value on failure, indicating that the ioctl command is not supported or another error occurred.
- **See Also**: [`fd_ethtool_ioctl_channels_set_num`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_channels_set_num>)  (Implementation)


---
### fd\_ethtool\_ioctl\_channels\_get\_num<!-- {{#callable_declaration:fd_ethtool_ioctl_channels_get_num}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L89>)

Retrieves the number of hardware channels and their support status.
- **Description**: Use this function to obtain information about the current state of hardware channels on a network device, including whether multiqueue is supported, the number of active channels, and the maximum number allowed. This function should be called after initializing the `fd_ethtool_ioctl_t` structure with a valid network device. It handles cases where the device does not support channel queries by assuming a single channel. The function returns zero on success and a nonzero value on failure.
- **Inputs**:
    - `ioc`: A pointer to an initialized `fd_ethtool_ioctl_t` structure representing the network device. Must not be null.
    - `channels`: A pointer to an `fd_ethtool_ioctl_channels_t` structure where the function will store the channel information. Must not be null.
- **Output**: Returns zero on success, with `channels` populated with the channel information. Returns a nonzero value on failure.
- **See Also**: [`fd_ethtool_ioctl_channels_get_num`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_channels_get_num>)  (Implementation)


---
### fd\_ethtool\_ioctl\_rxfh\_set\_default<!-- {{#callable_declaration:fd_ethtool_ioctl_rxfh_set_default}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L98>)

Sets the RXFH indirection table to its default state.
- **Description**: Use this function to reset the RXFH indirection table to its default configuration, which distributes packet hashes across all active queues in a round-robin manner. This default state allows changes to the active queue count without interference from the RXFH table. Call this function when you need to ensure that the RXFH table does not block queue count modifications. The function returns a nonzero value on failure, except when the operation is not supported, in which case it returns zero.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure that represents the network device. Must not be null. The caller retains ownership.
- **Output**: Returns zero if the operation is not supported, otherwise returns a nonzero value on failure.
- **See Also**: [`fd_ethtool_ioctl_rxfh_set_default`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_rxfh_set_default>)  (Implementation)


---
### fd\_ethtool\_ioctl\_rxfh\_set\_suffix<!-- {{#callable_declaration:fd_ethtool_ioctl_rxfh_set_suffix}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L108>)

Modifies the RXFH table to isolate a prefix of queues.
- **Description**: Use this function to adjust the RXFH indirection table so that it isolates a specific range of queues, starting from a given index. This is useful when you want to prevent general packets from being directed to certain queues, allowing ntuple rules to direct special packets to them instead. Ensure that the `start_idx` is within the valid range of queue indices, and that the RXFH table can accommodate the specified configuration. The function returns a nonzero value if it fails to set the table as requested.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure, which must be initialized and represent a valid network device. The caller retains ownership and must ensure it is not null.
    - `start_idx`: An unsigned integer specifying the starting index of the queue range to isolate. It must be less than the total number of queues available. If it is out of range, the function returns an error.
- **Output**: Returns 0 on success, or a nonzero error code if the operation fails.
- **See Also**: [`fd_ethtool_ioctl_rxfh_set_suffix`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_rxfh_set_suffix>)  (Implementation)


---
### fd\_ethtool\_ioctl\_rxfh\_get\_queue\_cnt<!-- {{#callable_declaration:fd_ethtool_ioctl_rxfh_get_queue_cnt}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L118>)

Retrieves the maximum number of queues the RXFH table can indirect to.
- **Description**: Use this function to determine the maximum number of queues that the RXFH table can indirect to for a given network device. This is typically equal to the current number of active channels, but some devices may have additional restrictions. Call this function after initializing the `fd_ethtool_ioctl_t` structure with `fd_ethtool_ioctl_init`. The function returns zero on success and a nonzero value on failure. If the ioctl command is not supported, it assumes a single queue and returns success.
- **Inputs**:
    - `ioc`: A pointer to an initialized `fd_ethtool_ioctl_t` structure. Must not be null. The caller retains ownership.
    - `queue_cnt`: A pointer to a `uint` where the function will store the maximum number of queues. Must not be null. The caller retains ownership.
- **Output**: Returns zero on success, with `queue_cnt` set to the maximum number of queues. Returns a nonzero value on failure.
- **See Also**: [`fd_ethtool_ioctl_rxfh_get_queue_cnt`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_rxfh_get_queue_cnt>)  (Implementation)


---
### fd\_ethtool\_ioctl\_rxfh\_get\_table<!-- {{#callable_declaration:fd_ethtool_ioctl_rxfh_get_table}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L128>)

Writes the current RXFH table state to a user-supplied array.
- **Description**: Use this function to obtain the current state of the RXFH indirection table for a network device. It writes the table contents into a user-provided array and returns the number of elements in the table. Ensure that the `table` array has space for `FD_ETHTOOL_MAX_RXFH_TABLE_CNT` elements. This function must be called after initializing the `fd_ethtool_ioctl_t` structure. It handles unsupported operations by setting `table_ele_cnt` to zero and returning success.
- **Inputs**:
    - `ioc`: A pointer to an initialized `fd_ethtool_ioctl_t` structure. Must not be null.
    - `table`: A pointer to an array of `uint` where the RXFH table contents will be written. Must have space for `FD_ETHTOOL_MAX_RXFH_TABLE_CNT` elements. Must not be null.
    - `table_ele_cnt`: A pointer to a `uint` where the function will store the number of elements in the RXFH table. Must not be null.
- **Output**: Returns 0 on success, with `table` filled with the RXFH table contents and `table_ele_cnt` set to the number of elements. Returns a nonzero error code on failure.
- **See Also**: [`fd_ethtool_ioctl_rxfh_get_table`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_rxfh_get_table>)  (Implementation)


---
### fd\_ethtool\_ioctl\_feature\_set<!-- {{#callable_declaration:fd_ethtool_ioctl_feature_set}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L136>)

Enables or disables a network device feature.
- **Description**: Use this function to change the state of a specific feature on a network device. It requires a valid `fd_ethtool_ioctl_t` structure, the name of the feature, and a flag indicating whether to enable or disable the feature. The function returns an error code if the feature cannot be changed or if the input parameters are invalid. It is important to ensure that the `fd_ethtool_ioctl_t` structure is properly initialized before calling this function.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure that represents the network device. Must not be null and must be initialized before use.
    - `name`: A constant character pointer representing the name of the feature to be modified. Must not be null.
    - `enabled`: An integer flag indicating whether to enable (non-zero) or disable (zero) the feature.
- **Output**: Returns 0 on success. Returns a non-zero error code if the feature cannot be changed or if the input parameters are invalid.
- **See Also**: [`fd_ethtool_ioctl_feature_set`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_feature_set>)  (Implementation)


---
### fd\_ethtool\_ioctl\_feature\_test<!-- {{#callable_declaration:fd_ethtool_ioctl_feature_test}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L144>)

Checks if a network device feature is enabled.
- **Description**: Use this function to determine if a specific feature on a network device is currently enabled. It requires a valid `fd_ethtool_ioctl_t` structure, which should be initialized before calling this function. The feature name must be a valid string corresponding to a known feature. The function sets the `enabled` parameter to 1 if the feature is enabled, or 0 if it is not. It returns 0 on success and a nonzero value on failure, such as when the feature name is invalid or the operation is not supported.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure. This must be initialized and must not be null. The caller retains ownership.
    - `name`: A constant character pointer to the name of the feature to test. This must be a valid, null-terminated string and must not be null.
    - `enabled`: A pointer to an integer where the function will store the result. It must not be null. The function sets this to 1 if the feature is enabled, or 0 if it is not.
- **Output**: Returns 0 on success. On failure, returns a nonzero value, such as EINVAL if the feature name is invalid.
- **See Also**: [`fd_ethtool_ioctl_feature_test`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_feature_test>)  (Implementation)


---
### fd\_ethtool\_ioctl\_feature\_gro\_set<!-- {{#callable_declaration:fd_ethtool_ioctl_feature_gro_set}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L152>)

Enables or disables the generic-receive-offload feature.
- **Description**: Use this function to control the generic-receive-offload (GRO) feature on a network device. This function is part of a set of APIs that manage network device features through ioctl commands. It is important to ensure that the `fd_ethtool_ioctl_t` structure is properly initialized before calling this function. The function returns a nonzero value on failure, except when disabling GRO on devices that do not support the command, in which case it returns zero.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure that represents the network device. This must be initialized before use and must not be null.
    - `enabled`: An integer indicating whether to enable (non-zero) or disable (zero) the GRO feature. Any non-zero value will enable the feature.
- **Output**: Returns zero on success or when disabling GRO on unsupported devices; otherwise, returns a nonzero error code.
- **See Also**: [`fd_ethtool_ioctl_feature_gro_set`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_feature_gro_set>)  (Implementation)


---
### fd\_ethtool\_ioctl\_feature\_gro\_test<!-- {{#callable_declaration:fd_ethtool_ioctl_feature_gro_test}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L160>)

Checks if the generic-receive-offload feature is enabled.
- **Description**: Use this function to determine if the generic-receive-offload (GRO) feature is currently enabled on a network device. This function must be called with a valid `fd_ethtool_ioctl_t` structure that has been initialized for the target network device. It sets the `enabled` parameter to 1 if the GRO feature is enabled, or to 0 if it is not. If the ioctl command is not supported by the device, the function will set `enabled` to 0 and return success, allowing for graceful handling of unsupported features.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure that represents the network device. This must be initialized before calling this function. The caller retains ownership.
    - `enabled`: A pointer to an integer where the function will store the result. It will be set to 1 if the GRO feature is enabled, or 0 if it is not. Must not be null.
- **Output**: Returns 0 on success, or a nonzero error code on failure. If the ioctl command is not supported, it returns 0 and sets `enabled` to 0.
- **See Also**: [`fd_ethtool_ioctl_feature_gro_test`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_feature_gro_test>)  (Implementation)


---
### fd\_ethtool\_ioctl\_ntuple\_clear<!-- {{#callable_declaration:fd_ethtool_ioctl_ntuple_clear}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L167>)

Deletes all active ntuple flow steering rules.
- **Description**: Use this function to remove all ntuple flow steering rules from a network device, returning it to its default state. This function is useful when you need to clear existing rules before setting new ones or when you want to ensure no rules are active. It must be called with a valid `fd_ethtool_ioctl_t` structure that has been initialized for the target network device. The function returns immediately if no rules are present or if the device does not support ntuple operations. It returns zero on success and a nonzero value on failure.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure representing the network device. This structure must be initialized before calling this function. The pointer must not be null.
- **Output**: Returns zero on success, or a nonzero error code on failure. If the device does not support ntuple operations, it returns zero.
- **See Also**: [`fd_ethtool_ioctl_ntuple_clear`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_ntuple_clear>)  (Implementation)


---
### fd\_ethtool\_ioctl\_ntuple\_set\_udp\_dport<!-- {{#callable_declaration:fd_ethtool_ioctl_ntuple_set_udp_dport}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L175>)

Installs a flow steering rule for UDP/IPv4 packets.
- **Description**: Use this function to create or overwrite a flow steering rule that directs UDP/IPv4 packets with a specific destination port to a designated queue. This function is useful for managing network traffic by steering packets to specific queues based on their destination port. Ensure that the `fd_ethtool_ioctl_t` structure is properly initialized before calling this function. If the specified rule index is already in use, the existing rule will be replaced. The function attempts to set the rule at the specified index and, if unsuccessful, tries to set it at any available location.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure that must be initialized. The caller retains ownership and it must not be null.
    - `rule_idx`: An unsigned integer specifying the index at which to install the rule. If the index is already in use, the existing rule will be overwritten.
    - `dport`: A 16-bit unsigned short representing the destination port for the UDP packets. The value is expected to be in host byte order.
    - `queue_idx`: An unsigned integer specifying the queue index to which the packets should be directed. The value must be valid for the network device.
- **Output**: Returns 0 on success and a nonzero value on failure.
- **See Also**: [`fd_ethtool_ioctl_ntuple_set_udp_dport`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_ntuple_set_udp_dport>)  (Implementation)


---
### fd\_ethtool\_ioctl\_ntuple\_validate\_udp\_dport<!-- {{#callable_declaration:fd_ethtool_ioctl_ntuple_validate_udp_dport}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/fd_ethtool_ioctl.h#L190>)

Validates ntuple rules for UDP destination ports.
- **Description**: Use this function to verify that the current ntuple rules match the expected set of rules for specified UDP destination ports. It checks if the rules are correctly configured and ensures no other rules are active. If the number of destination ports is zero, it checks for the absence of any rules. The function sets the `valid` parameter to 1 if the rules are correct, or 0 otherwise. The `dports` array is left in an indeterminate state after the function returns. Call this function when you need to confirm the correctness of ntuple rules for UDP traffic steering.
- **Inputs**:
    - `ioc`: A pointer to an `fd_ethtool_ioctl_t` structure. Must not be null. Represents the ioctl interface for network device management.
    - `dports`: A pointer to an array of UDP destination ports to validate against the ntuple rules. The array is left in an indeterminate state after the function returns. Must not be null.
    - `num_dports`: The number of UDP destination ports in the `dports` array. Can be zero to check for the absence of rules.
    - `queue_idx`: The queue index that the ntuple rules should steer the UDP packets to. Must be a valid queue index.
    - `valid`: A pointer to an integer where the function will store the validation result. Must not be null. Set to 1 if the rules are valid, or 0 otherwise.
- **Output**: Returns 0 on success, or a nonzero error code on failure. The `valid` parameter indicates the validation result.
- **See Also**: [`fd_ethtool_ioctl_ntuple_validate_udp_dport`](<fd_ethtool_ioctl.c.md#fd_ethtool_ioctl_ntuple_validate_udp_dport>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)