<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Handles the initialization and verification of the snapshots directory configuration.

# Purpose
The code defines a configuration stage for managing a "snapshots" directory within a larger configuration system. It includes two static functions: [`init`](<#init>) and [`check`](<#check>). The [`init`](<#init>) function attempts to create the snapshots directory with specified user and group IDs, logging an error if the creation fails. The [`check`](<#check>) function verifies the existence and permissions of the snapshots directory, returning a configuration result based on its findings. The `fd_cfg_stage_snapshots` structure encapsulates this stage, specifying its name, whether it should always be recreated, and the functions to initialize and check the configuration.
# Imports and Dependencies

---
- `../../../shared/commands/configure/configure.h`
- `../../../platform/fd_file_util.h`
- `errno.h`
- `sys/stat.h`


# Global Variables

---
### fd\_cfg\_stage\_snapshots
- **Type**: ``configure_stage_t``
- **Description**: Represents a configuration stage for managing snapshot directories. It includes initialization and checking functions to handle the creation and validation of these directories.
- **Use**: Used to define the behavior and properties of the snapshot configuration stage in the system.


# Functions

---
### init<!-- {{#callable:init}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/snapshots.c#L8>)

Creates a directory for snapshots with specified user and group IDs, and logs an error if creation fails.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing configuration data, including the path for the snapshots directory and user and group IDs.
- **Logic and Control Flow**:
    - Calls `fd_file_util_mkdir_all` to create the directory specified by `config->paths.snapshots` with the user ID `config->uid` and group ID `config->gid`.
    - Checks if the directory creation fails by evaluating if `fd_file_util_mkdir_all` returns -1.
    - If directory creation fails, logs an error message with the directory path and error details using `FD_LOG_ERR`.
- **Output**: No return value, as the function is of type `void`.


---
### check<!-- {{#callable:check}} -->
[View Source →](<../../../../../../../src/app/shared/commands/configure/snapshots.c#L14>)

Verifies the existence and permissions of the snapshots directory specified in the configuration.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing configuration details, including the path to the snapshots directory and user/group IDs.
- **Logic and Control Flow**:
    - Declare a `struct stat` variable `st` to hold file status information.
    - Use `stat` to check if the snapshots directory exists at the path specified by `config->paths.snapshots`.
    - If the directory does not exist (`errno` is `ENOENT`), call `NOT_CONFIGURED` to indicate the configuration is not set up.
    - Call `check_dir` to verify the directory's permissions and ownership, using `CHECK` to handle any errors.
    - If all checks pass, call `CONFIGURE_OK` to indicate successful configuration.
- **Output**: Returns a `configure_result_t` indicating the result of the configuration check.



---
Made with ❤️ by [Driver](https://www.driver.ai/)