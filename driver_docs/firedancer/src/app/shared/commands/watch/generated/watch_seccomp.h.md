<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall handling with architecture-specific checks and actions.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically by a script and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_watch`](<#populate_sock_filter_policy_watch>), initializes a BPF filter array with 24 instructions. These instructions enforce security policies by allowing or denying specific system calls based on predefined conditions.

The filter checks the architecture of the executing environment and allows or denies system calls such as `write`, `fsync`, `nanosleep`, `sched_yield`, `exit_group`, and `read`. The filter uses BPF statements and jumps to evaluate syscall numbers and arguments, allowing only those that match specified criteria. If a syscall does not match any allowed criteria, the filter defaults to a `SECCOMP_RET_KILL_PROCESS` action, terminating the process. This header file is intended to be included in other C source files to apply the defined seccomp policy, enhancing the security of the application by restricting its system call capabilities.
# Imports and Dependencies

---
- `../../../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_watch\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: Defines the number of instructions in the socket filter policy for the watch functionality. This constant is used to ensure that the correct number of instructions is processed in the filter.
- **Use**: Used to verify the count of instructions in the `populate_sock_filter_policy_watch` function.


# Functions

---
### populate\_sock\_filter\_policy\_watch<!-- {{#callable:populate_sock_filter_policy_watch}} -->
[View Source →](<../../../../../../../../src/app/shared/commands/watch/generated/watch_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call permissions.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 24.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor for the log file, used in syscall checks.
    - `drain_output_fd`: The file descriptor for draining output, used in syscall checks.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 24 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 24 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check against allowed syscalls (`write`, `fsync`, `nanosleep`, `sched_yield`, `exit_group`, `read`).
    - For `write`, `fsync`, and `read`, further check syscall argument 0 against specific values (`1`, `2`, `logfile_fd`, `drain_output_fd`, `0`).
    - If no syscalls match, jump to `RET_KILL_PROCESS`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)