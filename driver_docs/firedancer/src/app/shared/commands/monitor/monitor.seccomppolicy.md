<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines security policies for the monitor binary, including logging, process control, and I/O operations.

# Purpose
This file configures the monitoring functionality for a software component called Firedancer. It defines how the monitor interacts with log files and pipes to manage diagnostic output and logging. The file specifies file descriptors for logging (`logfile_fd` and `drain_output_fd`) and outlines conditions for writing and syncing log messages, ensuring that warnings and errors are immediately written to disk. It also describes how the monitor waits for the appropriate time to refresh diagnostic output using functions like `nanosleep` and `sched_yield`. Additionally, the file includes configurations for handling process termination signals and managing terminal attributes for a user interface. The monitor can also operate in a development mode to supervise Firedancer, interposing log messages with diagnostics, which is not required in production environments.
# Content Summary
The provided content describes the configuration and operational details of a monitoring component that works alongside the Firedancer software. This monitor is a binary executable that provides diagnostic information about the status and performance of the Firedancer validator.

Key functional details include:

1. **Log Management**: 
   - The monitor can manage log files through file descriptors `logfile_fd` and `drain_output_fd`. These descriptors are used to write log messages to a file or pipe. 
   - Log messages of 'WARNING' level and above are written to STDERR, while all messages are logged to a file. The monitor uses STDOUT for its diagnostics.
   - The `write` operation ensures that log messages are directed to the correct file descriptors, including STDOUT and STDERR.

2. **Immediate Log Synchronization**:
   - For critical log messages ('WARNING' and above), the monitor uses `fsync` to immediately write the log file to disk, ensuring data integrity.

3. **Diagnostic Output Refresh**:
   - The monitor uses `fd_log_wait_until()` to determine when to refresh the diagnostic output screen. This function may call `nanosleep` or `sched_yield` based on the required wait time.

4. **Process Termination**:
   - The monitor can terminate itself using `exit_group` when it receives a SIGINT or SIGTERM signal.

5. **Development Mode**:
   - In development mode, the monitor can act as a supervisor for Firedancer, using a custom pipe to interpose log messages with diagnostics. This mode is not intended for production use.

6. **Terminal Interaction**:
   - The monitor uses `ioctl` to manage terminal attributes, enabling a curses-like user interface.

7. **Non-blocking Input Handling**:
   - The monitor uses `pselect6` to check for data availability on STDIN without blocking, ensuring it can read new input data efficiently.

These details are crucial for developers to understand how the monitor interacts with Firedancer, manages logging, and handles process control and user interface operations.

---
Made with ❤️ by [Driver](https://www.driver.ai/)