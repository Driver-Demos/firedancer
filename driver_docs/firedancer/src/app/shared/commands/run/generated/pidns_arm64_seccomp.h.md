<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter for ARM64 architecture to control system call permissions.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter for the ARM64 architecture. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the target system architecture. The primary function, [`populate_sock_filter_policy_pidns_arm64`](<#populate_sock_filter_policy_pidns_arm64>), initializes a BPF filter array with specific rules to control system call access based on the seccomp policy.

The BPF filter is designed to allow or deny certain system calls based on predefined conditions. It checks the architecture of the running process and compares it with the expected architecture. The filter allows specific system calls like `write`, `fsync`, `ppoll`, `wait4`, and `exit_group` under certain conditions, while any other system calls result in the process being killed. The function [`populate_sock_filter_policy_pidns_arm64`](<#populate_sock_filter_policy_pidns_arm64>) copies the filter rules into an output array, which can then be used to enforce the seccomp policy in a process. This file is part of a larger system that uses seccomp to enhance security by restricting the system calls that a process can make.
# Imports and Dependencies

---
- `../../../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_pidns\_arm64\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: The `sock_filter_policy_pidns_arm64_instr_cnt` variable is a constant that represents the number of instructions in a socket filter policy for ARM64 architecture. It is set to the value 23.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_pidns_arm64` function.


# Functions

---
### populate\_sock\_filter\_policy\_pidns\_arm64<!-- {{#callable:populate_sock_filter_policy_pidns_arm64}} -->
[View Source →](<../../../../../../../../src/app/shared/commands/run/generated/pidns_arm64_seccomp.h#L26>)

Populates a socket filter policy for ARM64 architecture to enforce seccomp rules for specific syscalls.
- **Inputs**:
    - `out_cnt`: The number of elements in the output filter array, which must be at least 23.
    - `out`: A pointer to the output array of `struct sock_filter` where the filter policy will be stored.
    - `logfile_fd`: The file descriptor for the log file, used in syscall checks.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 23 using `FD_TEST` macro.
    - Define a `struct sock_filter` array `filter` with 23 elements to specify seccomp rules.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check against allowed syscalls: `SYS_write`, `SYS_fsync`, `SYS_ppoll`, `SYS_wait4`, and `SYS_exit_group`.
    - For `SYS_write`, check if the first argument is 2 or matches `logfile_fd`; allow if true, otherwise kill the process.
    - For `SYS_fsync`, check if the first argument matches `logfile_fd`; allow if true, otherwise kill the process.
    - For `SYS_wait4`, check if the third argument matches `__WALL | WNOHANG` or `__WALL`; allow if true, otherwise kill the process.
    - If none of the syscalls match, jump to `RET_KILL_PROCESS`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it populates the `out` array with the seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)