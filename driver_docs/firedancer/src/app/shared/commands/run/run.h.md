<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Function prototypes and external action declarations for initializing and running Firedancer commands.

# Purpose
This C header file defines function prototypes and external variables for managing and executing operations related to a component named "firedancer." It includes functions for creating and initializing resources such as stacks and workspaces, configuring network namespaces, and executing commands with specific arguments. The file also declares two external variables, `fd_action_run1` and `fd_action_run`, which are likely used to represent actions or commands within the application. The header file includes other headers, `fd_config.h` and `fd_action.h`, which suggests dependencies on configuration and action management components. The use of `FD_PROTOTYPES_BEGIN` and `FD_PROTOTYPES_END` indicates a macro-based approach to managing function prototypes, possibly for conditional compilation or namespace management.
# Imports and Dependencies

---
- `../../fd_config.h`
- `../../fd_action.h`


# Global Variables

---
### fd\_action\_run1
- **Type**: ``action_t``
- **Description**: `fd_action_run1` is a global variable of type `action_t`. It is declared as an external variable, indicating that its definition is located in another source file.
- **Use**: Used to represent an action or command that can be executed, likely related to the `run1_cmd_args` and `run1_cmd_fn` functions.


---
### fd\_action\_run
- **Type**: ``action_t``
- **Description**: `fd_action_run` is a global variable of type `action_t`. It is declared as an external variable, indicating that it is defined elsewhere in the program.
- **Use**: Used to represent an action within the program, likely related to running a specific command or operation.


# Function Declarations (Public API)

---
### create\_clone\_stack<!-- {{#callable_declaration:create_clone_stack}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L7>)

Allocates and returns a memory region for a stack with guard pages.
- **Description**: Use this function to allocate a memory region suitable for use as a stack, with guard pages to protect against stack overflow and underflow. The function returns a pointer to the usable stack area, which is located between two guard pages. The caller must ensure that the returned pointer is used in a context where stack overflow and underflow protection is necessary. This function does not take any parameters and will log an error if memory allocation fails.
- **Inputs**: None
- **Output**: Returns a pointer to the allocated stack memory region, or logs an error if allocation fails.
- **See Also**: [`create_clone_stack`](<run.c.md#create_clone_stack>)  (Implementation)


---
### clone\_firedancer<!-- {{#callable_declaration:clone_firedancer}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L12>)

Creates a new process in a PID namespace and sets up a communication pipe.
- **Description**: Use this function to create a new process in a PID namespace, which is useful for process isolation. The function requires a configuration structure and a file descriptor to close in the child process. It also sets up a pipe for communication between the parent and child processes, allowing the child to detect when the parent process has terminated. Ensure that the configuration structure is correctly initialized before calling this function. The function returns a process ID for the new namespace or an error code if the operation fails.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure that contains configuration settings. Must not be null and should be properly initialized before use.
    - `close_fd`: An integer representing a file descriptor that will be closed in the child process. Must be a valid file descriptor.
    - `out_pipe`: A pointer to an integer where the function will store the read end of the pipe. Must not be null.
- **Output**: Returns the process ID of the new namespace on success, or a negative error code on failure. The integer pointed to by `out_pipe` is set to the read end of the pipe.
- **See Also**: [`clone_firedancer`](<run.c.md#clone_firedancer>)  (Implementation)


---
### fdctl\_check\_configure<!-- {{#callable_declaration:fdctl_check_configure}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L17>)

Checks and validates system configuration for Firedancer.
- **Description**: Use this function to verify that the system configuration meets the requirements for running Firedancer. It checks various system settings, including huge pages, network settings, kernel parameters, and hyperthreading. If any configuration is incorrect, it logs an error message with guidance on how to correct it. This function should be called before running Firedancer to ensure the system is properly configured.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing the system configuration settings. Must not be null. The function reads from this structure to perform configuration checks.
- **Output**: None
- **See Also**: [`fdctl_check_configure`](<run.c.md#fdctl_check_configure>)  (Implementation)


---
### initialize\_workspaces<!-- {{#callable_declaration:initialize_workspaces}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L20>)

Initializes workspaces based on the given configuration.
- **Description**: Use this function to set up workspaces as specified in the provided configuration. It must be called with a valid `config_t` structure that contains the necessary workspace details. The function temporarily changes the user and group IDs to those specified in the configuration to perform workspace creation. It handles existing workspaces by either updating them or creating new ones, depending on the configuration and current state. After processing, it restores the original user and group IDs. Ensure that the configuration is correctly set up before calling this function to avoid errors.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure that contains the configuration for the workspaces. This parameter must not be null and should be properly initialized with valid user and group IDs, as well as workspace details. Invalid or null input will lead to undefined behavior or errors.
- **Output**: None
- **See Also**: [`initialize_workspaces`](<run.c.md#initialize_workspaces>)  (Implementation)


---
### initialize\_stacks<!-- {{#callable_declaration:initialize_stacks}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L23>)

Initialize stack workspaces based on configuration.
- **Description**: Use this function to set up stack workspaces for each tile as specified in the provided configuration. It temporarily changes the user and group IDs to create the necessary workspaces with appropriate permissions. This function must be called with a valid configuration structure that specifies the topology and other necessary parameters. It handles existing workspaces by updating them if necessary and creates new ones if they do not exist. Ensure that the configuration is correctly set up before calling this function to avoid errors related to permissions or memory allocation.
- **Inputs**:
    - `config`: A pointer to a constant `config_t` structure that contains the configuration details for initializing the stacks. This includes user and group IDs, topology information, and paths for huge page mounts. The pointer must not be null, and the structure must be properly initialized before calling this function.
- **Output**: None
- **See Also**: [`initialize_stacks`](<run.c.md#initialize_stacks>)  (Implementation)


---
### run\_firedancer\_init<!-- {{#callable_declaration:run_firedancer_init}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L26>)

Initializes the Firedancer environment based on the given configuration.
- **Description**: Use this function to set up the Firedancer environment by verifying the existence of necessary identity and voter keys, checking configuration prerequisites, and initializing workspaces and stacks. This function must be called with a valid configuration structure. It checks for the existence of identity and voter keys and logs errors if they are missing. If `check_configure` is true, it verifies network stack prerequisites. If `init_workspaces` is true, it initializes workspaces. This function modifies the configuration as needed during initialization.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure that contains configuration details for the Firedancer environment. Must not be null. The function expects valid paths for identity and voter keys within this structure.
    - `init_workspaces`: An integer flag indicating whether to initialize workspaces. A non-zero value means workspaces will be initialized.
    - `check_configure`: An integer flag indicating whether to check configuration prerequisites. A non-zero value means configuration checks will be performed.
- **Output**: None
- **See Also**: [`run_firedancer_init`](<run.c.md#run_firedancer_init>)  (Implementation)


---
### fdctl\_setup\_netns<!-- {{#callable_declaration:fdctl_setup_netns}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L31>)

Configures the network namespace based on the given configuration.
- **Description**: Use this function to enter a specified network namespace and configure network settings according to the provided configuration. This function must be called with a valid `config_t` structure that has network namespace settings enabled. If the `stay` parameter is non-zero, the function will not attempt to restore the original network namespace. This function logs an error and terminates if it fails to enter or restore the network namespace, or if any network configuration step fails.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure containing network configuration details. The `development.netns.enabled` field must be set to true for the function to proceed. The caller retains ownership of this pointer.
    - `stay`: An integer flag indicating whether to stay in the new network namespace. If non-zero, the function will not restore the original network namespace after configuration.
- **Output**: None
- **See Also**: [`fdctl_setup_netns`](<run.c.md#fdctl_setup_netns>)  (Implementation)


---
### run\_firedancer<!-- {{#callable_declaration:run_firedancer}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L35>)

Executes the Firedancer application with specified configuration and options.
- **Description**: Use this function to start the Firedancer application with a given configuration. It sets up necessary resources, handles security features, and manages process control. Ensure that the configuration is correctly initialized before calling this function. This function also manages logging and signal handling for the application. It is important to provide valid file descriptors and workspace initialization options to ensure proper operation.
- **Inputs**:
    - `config`: A pointer to a `config_t` structure that contains the configuration settings for the Firedancer application. Must not be null and should be properly initialized before calling.
    - `parent_pipefd`: An integer representing the file descriptor for the parent process's pipe. If not needed, it can be set to -1.
    - `init_workspaces`: An integer flag indicating whether to initialize workspaces. Non-zero values will trigger initialization.
- **Output**: None
- **See Also**: [`run_firedancer`](<run.c.md#run_firedancer>)  (Implementation)


---
### run\_cmd\_perm<!-- {{#callable_declaration:run_cmd_perm}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L40>)

Checks and raises necessary resource limits and capabilities for command execution.
- **Description**: Use this function to ensure that the necessary resource limits and capabilities are set before executing a command. It checks and raises limits for memory locking, thread priorities, and open files, and verifies capabilities required for network and system administration tasks. This function must be called with valid configuration and capability check structures to ensure the environment is correctly set up for the command to run.
- **Inputs**:
    - `args`: Pointer to an `args_t` structure. This parameter is not used in the function and can be ignored.
    - `chk`: Pointer to an `fd_cap_chk_t` structure. This must be a valid structure used to check and raise resource limits and capabilities.
    - `config`: Pointer to a constant `config_t` structure. This must be a valid configuration structure that provides necessary context for setting resource limits and capabilities.
- **Output**: None
- **See Also**: [`run_cmd_perm`](<run.c.md#run_cmd_perm>)  (Implementation)


---
### run1\_cmd\_args<!-- {{#callable_declaration:run1_cmd_args}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L44>)

Parses command-line arguments for the run1 command.
- **Description**: Use this function to parse and validate command-line arguments for the run1 command. It expects at least two arguments: a tile name and a kind ID. The function updates the `args` structure with the parsed values, including the pipe file descriptor, tile name, and kind ID. It decrements the argument count and advances the argument vector to reflect the consumed arguments. If the arguments are invalid or insufficient, the function logs an error and terminates the program. Ensure that `pargc` and `pargv` point to valid argument count and vector, and `args` is a valid pointer to an `args_t` structure.
- **Inputs**:
    - `pargc`: Pointer to the argument count. Must not be null. The function decrements this value to reflect consumed arguments.
    - `pargv`: Pointer to the argument vector. Must not be null. The function advances this pointer to reflect consumed arguments.
    - `args`: Pointer to an `args_t` structure where parsed values are stored. Must not be null.
- **Output**: None
- **See Also**: [`run1_cmd_args`](<run1.c.md#run1_cmd_args>)  (Implementation)


---
### run1\_cmd\_fn<!-- {{#callable_declaration:run1_cmd_fn}} -->
[View Source →](<../../../../../../../src/app/shared/commands/run/run.h#L45>)

Executes a command with specified arguments and configuration.
- **Description**: Use this function to execute a command in a controlled environment with the given arguments and configuration. It sets up the necessary environment, including process and thread identifiers, and manages CPU affinity. Ensure that the `args` and `config` parameters are correctly initialized before calling this function. This function handles errors internally and logs them as needed. It is important to note that this function may close file descriptors and modify the process's CPU affinity.
- **Inputs**:
    - `args`: A pointer to an `args_t` structure containing the command arguments. Must not be null. The structure should be properly initialized before use.
    - `config`: A pointer to a `config_t` structure containing the configuration settings. Must not be null. The structure should be properly initialized before use.
- **Output**: None
- **See Also**: [`run1_cmd_fn`](<run1.c.md#run1_cmd_fn>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)