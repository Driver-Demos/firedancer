<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Helpers for gRPC over HTTP/2, including status codes, header structures, and request/response handling.

# Purpose
The `fd_grpc_codec.h` file is a C header file that provides helper functions and structures for handling gRPC over HTTP/2. It includes definitions for gRPC protocol status codes, which are used to represent various states and errors in gRPC communication. The file defines internal identifiers for gRPC headers and structures for managing gRPC request and response headers, such as `fd_grpc_req_hdrs_t` and `fd_grpc_resp_hdrs_t`. It also declares functions for generating and reading gRPC request and response headers, such as [`fd_grpc_h2_gen_request_hdrs`](<#fd_grpc_h2_gen_request_hdrs>) and [`fd_grpc_h2_read_response_hdrs`](<#fd_grpc_h2_read_response_hdrs>), which facilitate the construction and parsing of HTTP/2 frames in gRPC communication. The header file includes necessary dependencies from the HTTP/2 module and provides a utility function [`fd_grpc_status_cstr`](<#fd_grpc_status_cstr>) to convert gRPC status codes to their string representations.
# Imports and Dependencies

---
- `../h2/fd_h2_base.h`
- `../h2/fd_h2_hdr_match.h`


# Data Structures

---
### fd\_grpc\_hdr
- **Type**: ``struct``
- **Members**:
    - `compressed`: Indicates if the message is compressed, with a value of 0 or 1.
    - `msg_sz`: Specifies the size of the message in network byte order.
- **Description**: Defines the header for a gRPC message, containing information about compression and the size of the message that follows.


---
### fd\_grpc\_hdr\_t
- **Type**: ``struct``
- **Members**:
    - `compressed`: Indicates if the message is compressed, with a value of 0 or 1.
    - `msg_sz`: Specifies the size of the message in network byte order.
- **Description**: Defines the header part of a Length-Prefixed-Message in the gRPC protocol, containing information about message compression and size.


---
### fd\_grpc\_req\_hdrs
- **Type**: ``struct``
- **Members**:
    - `host`: Pointer to a string representing the host, excluding the port.
    - `host_len`: Length of the host string, with a maximum value of 255.
    - `port`: Port number as an unsigned short integer.
    - `path`: Pointer to a string representing the path.
    - `path_len`: Length of the path string.
    - `https`: Flag indicating if the connection is HTTPS (1) or HTTP (0).
    - `bearer_auth`: Pointer to a string representing the bearer authentication token.
    - `bearer_auth_len`: Length of the bearer authentication token string.
- **Description**: Defines the structure for gRPC request headers, including host, port, path, HTTPS flag, and bearer authentication details.


---
### fd\_grpc\_req\_hdrs\_t
- **Type**: ``struct``
- **Members**:
    - ``host``: Pointer to a constant character string representing the host, excluding the port.
    - ``host_len``: Length of the host string, with a maximum value of 255.
    - ``port``: Unsigned short integer representing the port number.
    - ``path``: Pointer to a constant character string representing the path.
    - ``path_len``: Length of the path string.
    - ``https``: Bit field indicating if the connection is HTTPS (1) or HTTP (0).
    - ``bearer_auth``: Pointer to a constant character string for bearer authentication.
    - ``bearer_auth_len``: Length of the bearer authentication string.
- **Description**: Defines the structure for gRPC request headers, including host, port, path, and authentication details, with fields for both the data and their respective lengths.


---
### fd\_grpc\_resp\_hdrs
- **Type**: ``struct``
- **Members**:
    - `h2_status`: Stores the HTTP/2 status code, where 0 implies invalid.
    - `is_grpc_proto`: Indicates if the protocol is gRPC (1 if true, 0 if false).
    - `grpc_status`: Stores the gRPC status code, where 0 implies invalid.
    - `grpc_msg`: Holds the gRPC message as a character array with a maximum length of 1008.
    - `grpc_msg_len`: Specifies the length of the gRPC message.
- **Description**: The `fd_grpc_resp_hdrs` structure is used to represent the headers and trailers of a gRPC response over HTTP/2. It includes fields for storing HTTP/2 and gRPC status codes, a flag to indicate if the protocol is gRPC, and a buffer for the gRPC message along with its length.


---
### fd\_grpc\_resp\_hdrs\_t
- **Type**: ``struct``
- **Members**:
    - `h2_status`: Stores the HTTP/2 status code, where 0 implies invalid.
    - `is_grpc_proto`: Indicates if the protocol is gRPC (1 if true, 0 if false).
    - `grpc_status`: Stores the gRPC status code, where 0 implies invalid.
    - `grpc_msg`: Holds the gRPC message as a character array with a maximum length of 1008.
    - `grpc_msg_len`: Specifies the length of the gRPC message.
- **Description**: Defines the structure for gRPC response headers, including HTTP/2 status, gRPC protocol indicator, gRPC status, and message details.


# Function Declarations (Public API)

---
### fd\_grpc\_h2\_gen\_request\_hdrs<!-- {{#callable_declaration:fd_grpc_h2_gen_request_hdrs}} -->
[View Source →](<../../../../../src/waltz/grpc/fd_grpc_codec.h#L75>)

Generates a HEADERS frame with gRPC request headers.
- **Description**: Use this function to create a HEADERS frame for a gRPC request over HTTP/2. It must be called with valid request headers and a buffer to store the generated frame. The function returns 1 on success and 0 on failure, indicating that the headers could not be generated. Ensure that the `rbuf_tx` buffer is properly initialized and has enough space to accommodate the headers. The `version` and `version_len` parameters specify the gRPC version to include in the user-agent header.
- **Inputs**:
    - `req`: A pointer to a `fd_grpc_req_hdrs_t` structure containing the request headers. The `host`, `path`, and `bearer_auth` fields must be valid if their corresponding lengths (`host_len`, `path_len`, `bearer_auth_len`) are non-zero. The `host_len` must be less than or equal to 255.
    - `rbuf_tx`: A pointer to an `fd_h2_rbuf_t` buffer where the generated HEADERS frame will be stored. Must not be null and must be initialized before calling the function.
    - `version`: A pointer to a character array containing the gRPC version string to include in the user-agent header. Must not be null.
    - `version_len`: The length of the `version` string. Must be a valid length corresponding to the `version` parameter.
- **Output**: Returns 1 on success, indicating that the HEADERS frame was generated successfully. Returns 0 on failure, indicating an error in generating the headers.
- **See Also**: [`fd_grpc_h2_gen_request_hdrs`](<fd_grpc_codec.c.md#fd_grpc_h2_gen_request_hdrs>)  (Implementation)


---
### fd\_grpc\_h2\_read\_response\_hdrs<!-- {{#callable_declaration:fd_grpc_h2_read_response_hdrs}} -->
[View Source →](<../../../../../src/waltz/grpc/fd_grpc_codec.h#L91>)

Parses HTTP/2 response headers for gRPC.
- **Description**: Use this function to parse HTTP/2 response headers and extract relevant gRPC information. It processes the headers in the provided payload and updates the `resp` structure with the HTTP/2 status, gRPC protocol status, and message if applicable. This function must be called with a valid payload and matcher. It returns a protocol error code if parsing fails, and logs the reason for failure.
- **Inputs**:
    - `resp`: A pointer to an `fd_grpc_resp_hdrs_t` structure where the parsed header information will be stored. Must not be null.
    - `matcher`: A pointer to a constant `fd_h2_hdr_matcher_t` used to identify relevant headers. Must not be null.
    - `payload`: A pointer to the payload data containing the HTTP/2 headers. Must not be null.
    - `payload_sz`: The size of the payload in bytes. Must be a valid size for the given payload.
- **Output**: Returns `FD_H2_SUCCESS` on successful parsing, or `FD_H2_ERR_PROTOCOL` if a parsing error occurs.
- **See Also**: [`fd_grpc_h2_read_response_hdrs`](<fd_grpc_codec.c.md#fd_grpc_h2_read_response_hdrs>)  (Implementation)


---
### fd\_grpc\_status\_cstr<!-- {{#callable_declaration:fd_grpc_status_cstr}} -->
[View Source →](<../../../../../src/waltz/grpc/fd_grpc_codec.h#L97>)

Converts a gRPC status code to a human-readable string.
- **Description**: Use this function to obtain a human-readable string that describes a gRPC status code. This is useful for logging or displaying status messages to users. The function maps known gRPC status codes to their corresponding string representations. If the input status code is not recognized, the function returns "unknown". This function does not modify any input parameters and does not have side effects.
- **Inputs**:
    - `status`: An unsigned integer representing a gRPC status code. Valid values are defined as constants such as `FD_GRPC_STATUS_OK`, `FD_GRPC_STATUS_CANCELLED`, etc. If the status code is not one of the predefined constants, the function returns "unknown".
- **Output**: A constant character pointer to a string that represents the gRPC status code. The string is one of the predefined status descriptions or "unknown" if the status code is not recognized.
- **See Also**: [`fd_grpc_status_cstr`](<fd_grpc_codec.c.md#fd_grpc_status_cstr>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)