<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for generating and validating gRPC HTTP/2 request headers using the Firedancer library.

# Purpose
The code is a C source file that functions as a test suite for generating and validating HTTP/2 request headers in a gRPC context. It includes the necessary headers for handling gRPC codec operations and HTTP/2 buffer management. The primary function, [`test_h2_gen_request_hdr`](<#test_h2_gen_request_hdr>), constructs HTTP/2 request headers using the `fd_grpc_h2_gen_request_hdrs` function and verifies their correctness through a series of assertions. The test checks the generation of headers for two different gRPC requests, including one with a bearer token for authorization.

The code uses macros and functions from the included headers to initialize buffers, generate headers, and read them back for validation. The `EXPECT_HDR` macro is defined to simplify the process of checking each header's name and value against expected results. The [`main`](<#main>) function initializes the environment, calls the test function, logs the test result, and then halts the program. This file is intended to be executed as a standalone program to verify the functionality of the gRPC HTTP/2 header generation and validation process.
# Imports and Dependencies

---
- `fd_grpc_codec.h`
- `../h2/fd_h2_rbuf.h`
- `../h2/fd_hpack.h`


# Functions

---
### test\_h2\_gen\_request\_hdr<!-- {{#callable:test_h2_gen_request_hdr}} -->
[View Source →](<../../../../../src/waltz/grpc/test_grpc_codec.c#L5>)

Tests the generation and validation of HTTP/2 request headers for gRPC communication.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_grpc_req_hdrs_t` structure with HTTP/2 request header details such as host, port, and path.
    - Allocate a buffer `buf` and initialize a `fd_h2_rbuf_t` structure `rbuf_tx` with this buffer.
    - Call [`fd_grpc_h2_gen_request_hdrs`](<fd_grpc_codec.c.md#fd_grpc_h2_gen_request_hdrs>) to generate HTTP/2 request headers and store them in `rbuf_tx`.
    - Verify the generated headers using `FD_TEST` and a macro `EXPECT_HDR` to check each header's name and value against expected values.
    - Repeat the process with a second request header structure `req2` that includes a bearer authentication token.
    - Validate the presence and correctness of the 'authorization' header in the second request.
- **Output**: No output is returned; the function uses assertions to validate the correctness of header generation.
- **Functions Called**:
    - [`fd_grpc_h2_gen_request_hdrs`](<fd_grpc_codec.c.md#fd_grpc_h2_gen_request_hdrs>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/waltz/grpc/test_grpc_codec.c#L78>)

Initializes the environment, runs a test for HTTP/2 request header generation, logs a success message, and then halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Executes [`test_h2_gen_request_hdr`](<#test_h2_gen_request_hdr>) to test the generation of HTTP/2 request headers.
    - Logs a notice message 'pass' using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_h2_gen_request_hdr`](<#test_h2_gen_request_hdr>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)