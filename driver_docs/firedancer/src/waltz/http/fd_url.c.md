<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Parses and unescapes URLs, supporting HTTP and HTTPS schemes, with error handling for invalid components.

# Purpose
The code provides functionality for parsing and handling URLs. It includes two main functions: [`fd_url_parse_cstr`](<#fd_url_parse_cstr>) and [`fd_url_unescape`](<#fd_url_unescape>). The [`fd_url_parse_cstr`](<#fd_url_parse_cstr>) function is responsible for parsing a URL string into its components, such as scheme, host, and port. It checks for valid URL schemes (`http://` and `https://`) and extracts the authority part of the URL, identifying the host and port if specified. The function returns a pointer to a `fd_url_t` structure containing the parsed URL components or `NULL` if an error occurs, with an optional error code provided through `opt_err`.

The [`fd_url_unescape`](<#fd_url_unescape>) function processes a given string to decode percent-encoded characters, which are common in URLs. It iterates through the input string, replacing percent-encoded sequences with their corresponding character values. The function uses a helper function, [`fd_hex_unhex`](<#fd_hex_unhex>), to convert hexadecimal digits to their integer values. The function returns the length of the unescaped string. This code is part of a library intended to be used in other programs that require URL parsing and manipulation.
# Imports and Dependencies

---
- `fd_url.h`


# Functions

---
### fd\_url\_parse\_cstr<!-- {{#callable:fd_url_parse_cstr}} -->
[View Source →](<../../../../../src/waltz/http/fd_url.c#L3>)

Parses a URL string into its components and stores them in an `fd_url_t` structure.
- **Inputs**:
    - `url`: A pointer to an `fd_url_t` structure where the parsed URL components will be stored.
    - `url_str`: A constant character pointer to the URL string to be parsed.
    - `url_str_len`: An unsigned long integer representing the length of the URL string.
    - `opt_err`: An optional pointer to an integer where error codes will be stored; if NULL, a local error variable is used.
- **Logic and Control Flow**:
    - Initialize a local error variable if `opt_err` is NULL and set the error code to `FD_URL_SUCCESS`.
    - Check if the URL string length is less than 8; if so, return NULL.
    - Determine the URL scheme by comparing the start of the string with "http://" or "https://" and set the scheme length accordingly.
    - If the scheme is not recognized, set the error code to `FD_URL_ERR_SCHEME` and return NULL.
    - Identify the authority section of the URL by finding the first '/' character after the scheme.
    - Check for unsupported userinfo by looking for '@' in the authority section; if found, set the error code to `FD_URL_ERR_USERINFO` and return NULL.
    - Determine the host and port by searching for ':' in the authority section; set the host and port lengths accordingly.
    - If the host length exceeds 255 characters, set the error code to `FD_URL_ERR_HOST_OVERSZ` and return NULL.
    - Populate the `fd_url_t` structure with the parsed components: scheme, host, port, and the remaining URL tail.
    - Return the pointer to the `fd_url_t` structure.
- **Output**: A pointer to the `fd_url_t` structure containing the parsed URL components, or NULL if an error occurs.


---
### fd\_hex\_unhex<!-- {{#callable:fd_hex_unhex}} -->
[View Source →](<../../../../../src/waltz/http/fd_url.c#L75>)

Converts a hexadecimal character to its integer value.
- **Inputs**:
    - `c`: The character to convert, expected to be a hexadecimal digit ('0'-'9', 'a'-'f', or 'A'-'F').
- **Logic and Control Flow**:
    - Check if `c` is a digit between '0' and '9'; if true, return the integer value by subtracting '0'.
    - Check if `c` is a lowercase letter between 'a' and 'f'; if true, return the integer value by subtracting 'a' and adding 10.
    - Check if `c` is an uppercase letter between 'A' and 'F'; if true, return the integer value by subtracting 'A' and adding 10.
    - If `c` is not a valid hexadecimal character, return -1.
- **Output**: Returns the integer value of the hexadecimal character, or -1 if the character is not a valid hexadecimal digit.


---
### fd\_url\_unescape<!-- {{#callable:fd_url_unescape}} -->
[View Source →](<../../../../../src/waltz/http/fd_url.c#L83>)

Decodes percent-encoded characters in a URL string in place.
- **Inputs**:
    - `msg`: A pointer to the character array containing the URL string to unescape.
    - `len`: The length of the URL string to process.
- **Logic and Control Flow**:
    - Initialize `end` as the pointer to the end of the string and `state` as 0.
    - Set `dst` to point to the start of the `msg` array.
    - Iterate over each character in the string using `src` from `msg` to `end`.
    - In `state` 0, copy the character from `src` to `dst` if it is not '%', otherwise change `state` to 1.
    - In `state` 1, if the character is not '%', decode the hex value and store it in `dst`, then change `state` to 2; if it is '%', store '%' in `dst` and reset `state` to 0.
    - In `state` 2, complete the decoding of the hex value and store it in `dst`, then reset `state` to 0.
    - Return the number of characters written to `dst`.
- **Output**: The number of characters in the unescaped string.
- **Functions Called**:
    - [`fd_hex_unhex`](<#fd_hex_unhex>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)