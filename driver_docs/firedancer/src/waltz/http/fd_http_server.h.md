<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for a WebSocket-capable HTTP server designed for streaming messages to multiple clients efficiently.

# Purpose
The code defines a header file for an HTTP server with WebSocket capabilities, designed to efficiently stream output messages to multiple connected clients. The server is intended for use in scenarios where rapid message delivery is crucial, such as serving ongoing RPC data to subscribers or providing a WebSocket stream for browser-based GUIs. The server operates within a single-threaded event loop and uses a ring buffer to manage outgoing messages, automatically evicting clients that cannot keep up with the message flow.

Key components of the code include definitions for HTTP methods, connection close reasons, and structures for server parameters, requests, and responses. The server provides functions for managing server state, handling connections, and sending messages. It includes callback mechanisms for handling HTTP requests, WebSocket messages, and connection events. The server is designed to be memory-efficient, with a built-in allocation strategy for outgoing messages, and requires frequent polling to maintain connection activity. The code also defines several utility functions for managing the server's memory footprint and alignment, as well as functions for staging and sending messages to clients.
# Imports and Dependencies

---
- `../../util/fd_util_base.h`


# Data Structures

---
### fd\_http\_server\_params
- **Type**: ``struct``
- **Members**:
    - `max_connection_cnt`: Maximum number of concurrent HTTP/1.1 connections open.
    - `max_ws_connection_cnt`: Maximum number of concurrent websocket connections open.
    - `max_request_len`: Maximum total length of an HTTP request, including the terminating \r\n\r\n and any body in the case of a POST.
    - `max_ws_recv_frame_len`: Maximum size of an incoming websocket frame from the client.
    - `max_ws_send_frame_cnt`: Maximum number of outgoing websocket frames that can be queued before the client is disconnected.
    - `outgoing_buffer_sz`: Size of the outgoing data ring, which is used to stage outgoing HTTP response bodies and WebSocket frames.
    - `compress_websocket`: True if large websocket messages are compressed and sent as binary websocket frames.
- **Description**: Defines parameters for constructing an HTTP server, including limits on connections, request sizes, and buffer sizes, as well as options for websocket compression.


---
### fd\_http\_server\_params\_t
- **Type**: ``struct``
- **Members**:
    - `max_connection_cnt`: Maximum number of concurrent HTTP/1.1 connections open.
    - `max_ws_connection_cnt`: Maximum number of concurrent WebSocket connections open.
    - `max_request_len`: Maximum total length of an HTTP request, including the terminating \r\n\r\n and any body in the case of a POST.
    - `max_ws_recv_frame_len`: Maximum size of an incoming WebSocket frame from the client, must be >= max_request_len.
    - `max_ws_send_frame_cnt`: Maximum number of outgoing WebSocket frames that can be queued before the client is disconnected.
    - `outgoing_buffer_sz`: Size of the outgoing data ring used to stage outgoing HTTP response bodies and WebSocket frames.
    - `compress_websocket`: Indicates if large WebSocket messages are compressed and sent as binary WebSocket frames.
- **Description**: Defines parameters needed for constructing an HTTP server, including limits on connections, request sizes, and buffer sizes, as well as options for WebSocket compression.


---
### fd\_http\_server\_request
- **Type**: ``struct``
- **Members**:
    - ``connection_id``: Unique identifier for the connection, which can be recycled after the connection is closed.
    - ``method``: Indicates the HTTP method of the request, using predefined constants.
    - ``path``: NUL-terminated string representing the path component of the request.
    - ``ctx``: User-provided context pointer passed during HTTP server construction.
    - ``headers``: Contains HTTP header information such as `content_type`, `accept_encoding`, and WebSocket-related flags.
    - ``post``: Contains the body of the HTTP request and its length, applicable for POST requests.
- **Description**: Represents an HTTP server request, encapsulating details such as connection ID, HTTP method, request path, user context, headers, and request body for POST methods. It is used to handle incoming HTTP requests in a WebSocket-capable HTTP server.


---
### fd\_http\_server\_request\_t
- **Type**: ``struct``
- **Members**:
    - ``connection_id``: Unique identifier for the connection, used to track the connection's lifecycle.
    - ``method``: Indicates the HTTP method of the request, such as GET or POST.
    - ``path``: NUL-terminated string representing the path component of the request.
    - ``ctx``: User-provided context pointer associated with the HTTP server.
    - ``headers``: Contains HTTP headers like Content-Type and Accept-Encoding, and flags for WebSocket upgrades.
    - ``post``: Contains the body and length of the HTTP request for POST methods.
- **Description**: Represents an HTTP server request, encapsulating details such as the connection ID, HTTP method, request path, user context, headers, and request body for POST methods. It is used to handle incoming HTTP requests and manage their associated data within the server.


---
### fd\_http\_server\_response
- **Type**: ``struct``
- **Members**:
    - `status`: Status code of the HTTP response.
    - `upgrade_websocket`: 1 if a websocket upgrade response should be sent.
    - `compress_websocket`: 1 if a `Sec-WebSocket-Protocol: compress-zstd` header should be added to the response.
    - `content_type`: Content-Type to set in the HTTP response.
    - `cache_control`: Cache-Control to set in the HTTP response.
    - `content_encoding`: Content-Encoding to set in the HTTP response.
    - `access_control_allow_origin`: Access-Control-Allow-Origin header value.
    - `access_control_allow_methods`: Access-Control-Allow-Methods header value.
    - `access_control_allow_headers`: Access-Control-Allow-Headers header value.
    - `access_control_max_age`: Access-Control-Max-Age header value.
    - `static_body`: Response body to send, which must outlive the entire HTTP server.
    - `static_body_len`: Length of the response body.
    - `_body_off`: Internal use only; offset into the outgoing buffer where the body starts.
    - `_body_len`: Internal use only; length of the body in the outgoing buffer.
- **Description**: Represents an HTTP server response structure, containing fields for status codes, WebSocket upgrade and compression flags, content type, cache control, content encoding, access control headers, and static body data. The structure is used to define the response that the server sends back to the client, including both headers and body content, with some fields reserved for internal use to manage the response data within the server's buffer.


---
### fd\_http\_server\_response\_t
- **Type**: ``struct``
- **Members**:
    - `status`: HTTP status code of the response.
    - `upgrade_websocket`: Indicates if the connection should be upgraded to a WebSocket.
    - `compress_websocket`: Indicates if a `Sec-WebSocket-Protocol: compress-zstd` header should be added to the response.
    - `content_type`: Specifies the Content-Type header for the HTTP response.
    - `cache_control`: Specifies the Cache-Control header for the HTTP response.
    - `content_encoding`: Specifies the Content-Encoding header for the HTTP response.
    - `access_control_allow_origin`: Specifies the Access-Control-Allow-Origin header for the HTTP response.
    - `access_control_allow_methods`: Specifies the Access-Control-Allow-Methods header for the HTTP response.
    - `access_control_allow_headers`: Specifies the Access-Control-Allow-Headers header for the HTTP response.
    - `access_control_max_age`: Specifies the Access-Control-Max-Age header for the HTTP response.
    - `static_body`: Pointer to the static response body data.
    - `static_body_len`: Length of the static response body data.
    - `_body_off`: Internal offset into the outgoing buffer where the body starts.
    - `_body_len`: Internal length of the body in the outgoing buffer.
- **Description**: Represents a response issued by the server handler function to an HTTP request, including status code, headers, and body content. It supports WebSocket upgrades and compression, and can handle both staged and static response bodies. The structure is used to manage HTTP response details and ensure efficient data handling by the server.


---
### fd\_http\_server\_callbacks
- **Type**: ``struct``
- **Members**:
    - ``request``: Handles an incoming HTTP request and returns a response to the client.
    - ``open``: Called when a regular HTTP connection is established, providing the connection ID, socket file descriptor, and user context.
    - ``close``: Called when an HTTP request is closed, providing the connection ID, reason for closure, and user context.
    - ``ws_open``: Called when a WebSocket connection is opened, providing the WebSocket connection ID and user context.
    - ``ws_message``: Called when a WebSocket message is received, providing the WebSocket connection ID, message data, message length, and user context.
    - ``ws_close``: Called when a WebSocket connection is closed, providing the WebSocket connection ID, reason for closure, and user context.
- **Description**: Defines a set of callback functions for handling HTTP and WebSocket events in an HTTP server. These callbacks manage incoming HTTP requests, the establishment and closure of HTTP and WebSocket connections, and the receipt of WebSocket messages. The structure allows the user to provide custom logic for these events by implementing the specified callback functions.


---
### fd\_http\_server\_callbacks\_t
- **Type**: ``struct``
- **Members**:
    - `request`: A callback function to handle incoming HTTP requests and return a response.
    - `open`: A callback function called when a regular HTTP connection is established.
    - `close`: A callback function called when an HTTP request is closed.
    - `ws_open`: A callback function called when a WebSocket connection is opened.
    - `ws_message`: A callback function called when a WebSocket message is received.
    - `ws_close`: A callback function called when a WebSocket connection is closed.
- **Description**: Defines a set of callback functions for handling various events in an HTTP server, including HTTP requests, connection openings and closings, and WebSocket events.


---
### fd\_http\_server\_t
- **Type**: ``struct``
- **Members**:
    - ``fd_http_server_private``: A forward declaration for the private structure of the HTTP server.
- **Description**: Represents a WebSocket-capable HTTP server designed to efficiently stream output messages to multiple connected clients. It uses a ring buffer for outgoing messages and automatically manages client connections, evicting those that are too slow to read messages. The server is intended for single-threaded event loops and supports HTTP and WebSocket protocols, with built-in memory management for message staging and sending.


# Function Declarations (Public API)

---
### fd\_http\_server\_connection\_close\_reason\_str<!-- {{#callable_declaration:fd_http_server_connection_close_reason_str}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L69>)

Returns a human-readable string for a connection close reason code.
- **Description**: Use this function to obtain a descriptive string for a given connection close reason code. This is useful for logging or debugging purposes to understand why a connection was closed. The function accepts a reason code and returns a corresponding string. If the reason code is not recognized, it returns "unknown". This function does not modify any input parameters and is safe to call with any integer value.
- **Inputs**:
    - `reason`: An integer representing the reason code for closing a connection. Valid values are defined as `FD_HTTP_SERVER_CONNECTION_CLOSE_*` constants. If the value is not recognized, the function returns "unknown".
- **Output**: A constant character pointer to a string describing the reason for the connection closure. Returns "unknown" if the reason code is not recognized.
- **See Also**: [`fd_http_server_connection_close_reason_str`](<fd_http_server.c.md#fd_http_server_connection_close_reason_str>)  (Implementation)


---
### fd\_http\_server\_method\_str<!-- {{#callable_declaration:fd_http_server_method_str}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L75>)

Returns the string representation of an HTTP method code.
- **Description**: Use this function to get the string representation of an HTTP method code defined by `FD_HTTP_SERVER_METHOD_*`. This is useful for logging or debugging purposes when you need to convert a method code to its corresponding string. The function handles `GET`, `POST`, and `PUT` methods, returning "unknown" for any other method codes.
- **Inputs**:
    - `method`: An unsigned character representing the HTTP method code. Valid values are `FD_HTTP_SERVER_METHOD_GET`, `FD_HTTP_SERVER_METHOD_POST`, and `FD_HTTP_SERVER_METHOD_PUT`. If the value does not match any of these, the function returns "unknown".
- **Output**: A constant string representing the HTTP method name, or "unknown" if the method code is not recognized.
- **See Also**: [`fd_http_server_method_str`](<fd_http_server.c.md#fd_http_server_method_str>)  (Implementation)


---
### fd\_http\_server\_align<!-- {{#callable_declaration:fd_http_server_align}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L231>)

Returns the alignment requirement for an HTTP server.
- **Description**: Use this function to obtain the alignment requirement for memory regions intended to hold an HTTP server. This is necessary to ensure that the memory is correctly aligned for the server's operations. Call this function before allocating memory for the server to determine the correct alignment.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement in bytes.
- **See Also**: [`fd_http_server_align`](<fd_http_server.c.md#fd_http_server_align>)  (Implementation)


---
### fd\_http\_server\_footprint<!-- {{#callable_declaration:fd_http_server_footprint}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L265>)

Calculates the memory footprint for an HTTP server.
- **Description**: Use this function to determine the amount of memory required to allocate for an HTTP server based on the specified parameters. This is useful for planning memory allocation before initializing the server. Ensure that the parameters provided reflect the expected usage of the server, such as the maximum number of connections and buffer sizes.
- **Inputs**:
    - `params`: A structure containing configuration parameters for the HTTP server, such as maximum connection counts and buffer sizes. The values must be set according to the expected server load and requirements.
- **Output**: Returns the size in bytes of the memory footprint needed for the HTTP server with the given parameters.
- **See Also**: [`fd_http_server_footprint`](<fd_http_server.c.md#fd_http_server_footprint>)  (Implementation)


---
### fd\_http\_server\_new<!-- {{#callable_declaration:fd_http_server_new}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L268>)

Creates a new HTTP server instance in shared memory.
- **Description**: Use this function to initialize a new HTTP server instance in a specified shared memory region. The server is designed to handle both HTTP and WebSocket connections, with parameters defining the maximum number of connections and buffer sizes. Ensure that the shared memory pointer is non-null and properly aligned. The function returns a pointer to the server instance on success or NULL if any precondition is violated, such as misaligned memory or invalid parameter constraints.
- **Inputs**:
    - `shmem`: Pointer to the shared memory region where the server will be initialized. Must not be null and must be aligned according to `fd_http_server_align()`.
    - `params`: Structure containing parameters for the server, such as maximum connection counts and buffer sizes. `max_ws_recv_frame_len` must be greater than or equal to `max_request_len`.
    - `callbacks`: Structure containing callback functions for handling server events. Must be provided by the caller.
    - `callback_ctx`: User-defined context pointer passed to callback functions. Can be null if no context is needed.
- **Output**: Returns a pointer to the initialized HTTP server instance on success, or NULL on failure.
- **See Also**: [`fd_http_server_new`](<fd_http_server.c.md#fd_http_server_new>)  (Implementation)


---
### fd\_http\_server\_join<!-- {{#callable_declaration:fd_http_server_join}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L274>)

Joins a caller to an HTTP server state.
- **Description**: Use this function to join a caller to an existing HTTP server state. This function requires a pointer to the memory region that holds the server state. It returns a local handle to the server state if successful. Ensure that the memory region is correctly aligned and initialized before calling this function. If the input is null, misaligned, or the server state is invalid, the function will return null and log a warning.
- **Inputs**:
    - `shhttp`: A pointer to the memory region holding the HTTP server state. Must not be null and must be aligned according to `fd_http_server_align()`. The server state must be valid and initialized. If these conditions are not met, the function returns null.
- **Output**: Returns a pointer to the `fd_http_server_t` structure on success, or null on failure.
- **See Also**: [`fd_http_server_join`](<fd_http_server.c.md#fd_http_server_join>)  (Implementation)


---
### fd\_http\_server\_leave<!-- {{#callable_declaration:fd_http_server_leave}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L277>)

Leaves the current local join to an HTTP server state.
- **Description**: Use this function to leave the current local join to an HTTP server state. It is important to ensure that the `http` parameter is not null before calling this function, as passing a null pointer will result in a warning and a null return value. This function is typically used when the caller no longer needs to interact with the HTTP server state and wants to release any resources associated with the join.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the current local join to an HTTP server state. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a pointer to the memory region holding the HTTP server state on success, or null if the input is invalid.
- **See Also**: [`fd_http_server_leave`](<fd_http_server.c.md#fd_http_server_leave>)  (Implementation)


---
### fd\_http\_server\_delete<!-- {{#callable_declaration:fd_http_server_delete}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L280>)

Unformats a memory region holding an HTTP server state.
- **Description**: Use this function to unformat a memory region that holds an HTTP server state when it is no longer needed. Ensure that the pointer `shhttp` is not null, is properly aligned, and that the server state is valid before calling this function. This function returns the memory region to the caller, who regains ownership. It logs a warning and returns null if the input is invalid.
- **Inputs**:
    - `shhttp`: A pointer to the first byte of the memory region holding the HTTP server state. Must not be null, must be aligned according to `fd_http_server_align()`, and must point to a valid server state. If invalid, the function logs a warning and returns null.
- **Output**: Returns a pointer to the memory region on success, or null on failure.
- **See Also**: [`fd_http_server_delete`](<fd_http_server.c.md#fd_http_server_delete>)  (Implementation)


---
### fd\_http\_server\_fd<!-- {{#callable_declaration:fd_http_server_fd}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L287>)

Returns the file descriptor of the HTTP server.
- **Description**: Use this function to obtain the file descriptor associated with the HTTP server. This file descriptor is necessary for polling incoming connections and data. Ensure that the `http` parameter is a valid pointer to an `fd_http_server_t` structure before calling this function.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure. Must not be null. The function assumes this points to a valid HTTP server instance.
- **Output**: Returns the file descriptor as an integer, which can be used for polling operations.
- **See Also**: [`fd_http_server_fd`](<fd_http_server.c.md#fd_http_server_fd>)  (Implementation)


---
### fd\_http\_server\_listen<!-- {{#callable_declaration:fd_http_server_listen}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L290>)

Starts listening for incoming HTTP connections on a specified address and port.
- **Description**: Use this function to configure the server to listen for incoming HTTP connections on a specified network address and port. This function must be called after initializing the server structure. It sets up a non-blocking socket, binds it to the given address and port, and starts listening for incoming connections. Ensure that the address and port are valid and not already in use by another service. The server will log an error and terminate if it encounters issues during socket creation, option setting, binding, or listening.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null and should be properly initialized before calling this function.
    - `address`: An unsigned integer representing the IPv4 address to bind the server to. Must be in network byte order.
    - `port`: An unsigned short representing the port number to bind the server to. Must be in host byte order.
- **Output**: Returns a pointer to the `fd_http_server_t` structure on success. Logs an error and terminates the program on failure.
- **See Also**: [`fd_http_server_listen`](<fd_http_server.c.md#fd_http_server_listen>)  (Implementation)


---
### fd\_http\_server\_close<!-- {{#callable_declaration:fd_http_server_close}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L302>)

Closes an active HTTP connection.
- **Description**: Use this function to forcibly terminate an active HTTP connection identified by the connection ID. The connection ID must be valid and within the range of open connections. After calling this function, the connection ID is released and may be recycled for future connections. If a close callback is provided, it will be invoked with the specified reason for closure.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null.
    - `conn_id`: The unique identifier for the connection to close. Must be an open connection ID within the range [0, max_connection_cnt).
    - `reason`: An integer representing the reason for closing the connection. Should be one of the predefined `FD_HTTP_SERVER_CONNECTION_CLOSE_*` constants.
- **Output**: None
- **See Also**: [`fd_http_server_close`](<fd_http_server.c.md#fd_http_server_close>)  (Implementation)


---
### fd\_http\_server\_ws\_close<!-- {{#callable_declaration:fd_http_server_ws_close}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L315>)

Closes an active WebSocket connection.
- **Description**: Use this function to forcibly terminate an active WebSocket connection identified by its connection ID. The connection ID must be within the range of open WebSocket connections, specifically from 0 to `max_ws_connection_cnt` - 1. After calling this function, the connection ID is released and may be reused for future connections. If a `ws_close` callback is set, it will be triggered with the provided reason for closure.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null.
    - `ws_conn_id`: The unique identifier for the WebSocket connection to close. Must be within the range [0, max_ws_connection_cnt).
    - `reason`: An integer code indicating the reason for closing the connection. This code is passed to the `ws_close` callback if it is set.
- **Output**: None
- **See Also**: [`fd_http_server_ws_close`](<fd_http_server.c.md#fd_http_server_ws_close>)  (Implementation)


---
### fd\_http\_server\_stage\_trunc<!-- {{#callable_declaration:fd_http_server_stage_trunc}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L322>)

Truncates the staged message to a specified length.
- **Description**: Use this function to set the length of the current staged message in the HTTP server's outgoing buffer. This is useful when you need to adjust the size of the message being prepared for sending to clients. Ensure that the `http` parameter is a valid pointer to an `fd_http_server_t` instance and that the server is properly initialized before calling this function.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` instance. Must not be null and should point to a valid, initialized HTTP server object.
    - `len`: The desired length to truncate the staged message to. Must be a non-negative value.
- **Output**: None
- **See Also**: [`fd_http_server_stage_trunc`](<fd_http_server.c.md#fd_http_server_stage_trunc>)  (Implementation)


---
### fd\_http\_server\_stage\_len<!-- {{#callable_declaration:fd_http_server_stage_len}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L328>)

Returns the length of the staged data in the HTTP server.
- **Description**: Use this function to get the current length of the data that has been staged in the HTTP server's outgoing buffer. This is useful for determining how much data is ready to be sent to clients. Ensure that the HTTP server is properly initialized and joined before calling this function.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure. Must not be null. The caller must ensure that this points to a valid and joined HTTP server instance.
- **Output**: The function returns an `ulong` representing the length of the staged data in the server's outgoing buffer.
- **See Also**: [`fd_http_server_stage_len`](<fd_http_server.c.md#fd_http_server_stage_len>)  (Implementation)


---
### fd\_http\_server\_printf<!-- {{#callable_declaration:fd_http_server_printf}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L352>)

Appends a formatted string to the HTTP server's staging buffer.
- **Description**: Use this function to format and append a string to the staging area of the outgoing ring buffer in an HTTP server. This function is typically used to prepare data for sending to clients. Ensure that the server is in a valid state before calling this function, as it will not execute if the server is in an error state. The function uses a format string and additional arguments to create the output. If the formatted string exceeds the buffer size, the server enters an error state, and subsequent operations will fail until the error is cleared.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null and should be a valid, joined server instance.
    - `fmt`: A format string similar to those used in `printf`. Must not be null and should be a valid format string.
    - `...`: Additional arguments required by the format string. These should match the format specifiers in `fmt`.
- **Output**: None
- **See Also**: [`fd_http_server_printf`](<fd_http_server.c.md#fd_http_server_printf>)  (Implementation)


---
### fd\_http\_server\_memcpy<!-- {{#callable_declaration:fd_http_server_memcpy}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L378>)

Appends data to the staging area of the outgoing ring buffer.
- **Description**: Use this function to add data to the staging area of the outgoing ring buffer in an HTTP server. This function should be called when you want to prepare data to be sent to connected WebSocket clients. Ensure that the server is in a valid state and that the `http` parameter is a valid, joined HTTP server instance. If the data causes the buffer to wrap around, slow clients may be evicted. This function does not handle errors internally, so ensure that the buffer has enough space to accommodate the data.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must be a valid, joined instance. The caller retains ownership.
    - `data`: A pointer to the data to append. Must not be null. The caller retains ownership of the data.
    - `data_len`: The length of the data to append. Must be a valid length that does not exceed the buffer capacity.
- **Output**: None
- **See Also**: [`fd_http_server_memcpy`](<fd_http_server.c.md#fd_http_server_memcpy>)  (Implementation)


---
### fd\_http\_server\_unstage<!-- {{#callable_declaration:fd_http_server_unstage}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L387>)

Clears the staging buffer in the HTTP server.
- **Description**: Use this function to clear any data that has been written into the staging buffer of the HTTP server. This operation does not advance the ring buffer usage, and no clients will be evicted as a result. It is useful when you need to discard staged data without affecting the state of the ring buffer or client connections. Ensure that the HTTP server is properly initialized and joined before calling this function.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null. The caller retains ownership of this pointer.
- **Output**: None
- **See Also**: [`fd_http_server_unstage`](<fd_http_server.c.md#fd_http_server_unstage>)  (Implementation)


---
### fd\_http\_server\_stage\_body<!-- {{#callable_declaration:fd_http_server_stage_body}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L395>)

Marks the current staging buffer contents as the response body.
- **Description**: Use this function to designate the current contents of the staging buffer as the body of an HTTP response. This function should be called after data has been staged into the buffer using functions like `fd_http_server_printf` or `fd_http_server_memcpy`. It is important to ensure that the server is not in an error state before calling this function, as it will return an error if the staging buffer is in such a state. After marking the body, the function resets the error state if it was set.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null.
    - `response`: A pointer to an `fd_http_server_response_t` structure where the body offset and length will be set. Must not be null.
- **Output**: Returns 0 on success. Returns -1 if the staging buffer is in an error state, and clears the error state.
- **See Also**: [`fd_http_server_stage_body`](<fd_http_server.c.md#fd_http_server_stage_body>)  (Implementation)


---
### fd\_http\_server\_ws\_send<!-- {{#callable_declaration:fd_http_server_ws_send}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L410>)

Sends staged WebSocket message to a specific client.
- **Description**: Use this function to send the contents of the staging buffer as a WebSocket message to a specific client identified by the WebSocket connection ID. This function clears the staging buffer after sending. It does not block or wait for the message to be sent, as the sending occurs asynchronously. If the client is too slow to read the message and the staging buffer wraps around, the client will be disconnected. Ensure the connection ID is valid and open before calling this function.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null.
    - `ws_conn_id`: The WebSocket connection ID of the client to send the message to. Must be an open connection ID in the range [0, max_ws_connection_cnt).
- **Output**: Returns 0 on success. Returns -1 if the ring buffer is in an error state, and then clears the error state.
- **See Also**: [`fd_http_server_ws_send`](<fd_http_server.c.md#fd_http_server_ws_send>)  (Implementation)


---
### fd\_http\_server\_ws\_broadcast<!-- {{#callable_declaration:fd_http_server_ws_broadcast}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L425>)

Broadcasts staged WebSocket message to all connected clients.
- **Description**: Use this function to send the current contents of the staging buffer as a WebSocket message to all connected clients. It is important to ensure that the staging buffer is correctly populated with the intended message before calling this function. The function does not block; it marks the message for asynchronous sending as clients are able to read. If a client reads too slowly and the buffer wraps around, the client will be disconnected for being too slow. This function should be called after staging data using functions like `fd_http_server_printf` or `fd_http_server_memcpy`.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null. The server should be properly initialized and joined before calling this function.
- **Output**: Returns 0 on success. Returns -1 if the ring buffer is in an error state, and then clears the error state.
- **See Also**: [`fd_http_server_ws_broadcast`](<fd_http_server.c.md#fd_http_server_ws_broadcast>)  (Implementation)


---
### fd\_http\_server\_poll<!-- {{#callable_declaration:fd_http_server_poll}} -->
[View Source →](<../../../../../src/waltz/http/fd_http_server.h#L433>)

Polls the HTTP server for incoming connections and data.
- **Description**: Use this function to check for and process incoming connections and data on the HTTP server. It should be called frequently in a loop to ensure the server continues to operate and handle requests efficiently. The function can operate in a non-blocking mode if the `poll_timeout` is set to 0. It returns immediately if there is no work to do or if interrupted by a signal, and logs an error if polling fails for other reasons.
- **Inputs**:
    - `http`: A pointer to an `fd_http_server_t` structure representing the HTTP server. Must not be null.
    - `poll_timeout`: An integer specifying the maximum time in milliseconds to wait for an event. A value of 0 makes the function non-blocking.
- **Output**: Returns 1 if there was work to do on the server, or 0 if there was none or if interrupted by a signal. Logs an error and may terminate the program if polling fails for other reasons.
- **See Also**: [`fd_http_server_poll`](<fd_http_server.c.md#fd_http_server_poll>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)