<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements Huffman decoding for HTTP/2 header compression.

# Purpose
The code is part of the `nghttp2` library, which is a C library for HTTP/2. It specifically deals with Huffman decoding, a compression technique used in HTTP/2 header compression. The file includes functions to initialize and perform Huffman decoding. The function [`nghttp2_hd_huff_decode_context_init`](<#nghttp2_hd_huff_decode_context_init>) initializes a Huffman decoding context by setting its state to `NGHTTP2_HUFF_ACCEPTED`. The function [`nghttp2_hd_huff_decode`](<#nghttp2_hd_huff_decode>) performs the actual decoding process. It takes a decoding context, a buffer to store the decoded output, a source byte array, the length of the source, and a flag indicating if it is the final block. The function iterates over the source data, using a Huffman decoding table to translate encoded bytes into symbols, which are then stored in the buffer.

The code uses a decoding algorithm referenced in several documents, which are linked in the comments. The decoding process involves checking the state of the decoding context and updating it as each byte is processed. If the final flag is set and the decoding context is not in an accepted state, the function returns an error code `NGHTTP2_ERR_HEADER_COMP`. The file is intended to be part of the internal implementation of the `nghttp2` library and does not define public APIs or external interfaces directly.
# Imports and Dependencies

---
- `nghttp2_hd_huffman.h`
- `string.h`
- `assert.h`
- `stdio.h`


# Functions

---
### nghttp2\_hd\_huff\_decode\_context\_init<!-- {{#callable:nghttp2_hd_huff_decode_context_init}} -->
[View Source →](<../../../../../src/waltz/h2/nghttp2_hd_huffman.c#L34>)

Initializes the Huffman decoding context by setting its state to accepted.
- **Inputs**:
    - `ctx`: A pointer to an `nghttp2_hd_huff_decode_context` structure that will be initialized.
- **Logic and Control Flow**:
    - Set the `fstate` member of the `ctx` structure to `NGHTTP2_HUFF_ACCEPTED`.
- **Output**: No output is returned as the function is of type `void`.


---
### nghttp2\_hd\_huff\_decode<!-- {{#callable:nghttp2_hd_huff_decode}} -->
[View Source →](<../../../../../src/waltz/h2/nghttp2_hd_huffman.c#L38>)

Decodes Huffman-encoded data from a source buffer into a destination buffer.
- **Inputs**:
    - `ctx`: A pointer to `nghttp2_hd_huff_decode_context` which maintains the current state of the Huffman decoding process.
    - `buf`: A pointer to `nghttp2_buf` where the decoded output will be stored.
    - `src`: A pointer to the source buffer containing Huffman-encoded data.
    - `srclen`: The length of the source buffer `src`.
    - `final`: An integer flag indicating if this is the final block of data to decode.
- **Logic and Control Flow**:
    - Initialize `end` to point to the end of the source buffer `src`.
    - Initialize a `nghttp2_huff_decode` node with the current state from `ctx`.
    - Iterate over each byte in the source buffer `src` until `end` is reached.
    - For each byte, use the high nibble to index into the Huffman decode table and update the decode state `t`.
    - If the current state `t` indicates a symbol, append the symbol to the destination buffer `buf`.
    - Repeat the process for the low nibble of the byte.
    - Update the context's state `ctx->fstate` with the final state `t->fstate`.
    - If `final` is true and the final state is not accepted, return an error code `NGHTTP2_ERR_HEADER_COMP`.
    - Return the number of bytes processed from the source buffer `src`.
- **Output**: Returns the number of bytes processed from the source buffer `src`, or an error code if the final state is not accepted.



---
Made with ❤️ by [Driver](https://www.driver.ai/)