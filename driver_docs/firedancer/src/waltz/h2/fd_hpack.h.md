<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for HPACK compression and decompression in HTTP/2, using static tables and Huffman coding.

# Purpose
The `fd_hpack.h` file provides APIs for handling HPACK compression and decompression, specifically for HTTP/2 headers. It supports static table and Huffman string coding but does not utilize the dynamic table for encoding. The file assumes that the HTTP/2 SETTINGS have been configured to set the peer's dynamic table size to zero. This header file defines structures and functions necessary for reading and decoding HPACK-encoded HTTP/2 headers.

Key components include the `fd_h2_hdr_t` structure, which represents an HTTP/2 header name-value pair, and the `fd_hpack_rd_t` structure, which is used to read a block of HPACK-encoded headers. The file provides functions such as `fd_hpack_rd_init` to initialize the reading process and [`fd_hpack_rd_next`](<#fd_hpack_rd_next>) to read the next header from the encoded data. The file also defines several macros for handling Huffman coding and indexed table entries. These components work together to facilitate the decoding of HTTP/2 headers using HPACK compression.
# Imports and Dependencies

---
- `fd_h2_base.h`


# Data Structures

---
### fd\_h2\_hdr
- **Type**: ``struct``
- **Members**:
    - `name`: Pointer to the header name string.
    - `value`: Pointer to the header value string.
    - `name_len`: Length of the header name.
    - `hint`: Contains flags and index information for the header.
    - `value_len`: Length of the header value.
- **Description**: Represents an HTTP/2 header with pointers to the name and value strings, along with their respective lengths. The `hint` field provides additional information about the header, such as whether it is indexed or Huffman coded.


---
### fd\_h2\_hdr\_t
- **Type**: ``struct``
- **Members**:
    - `name`: Points to the header name in the HTTP/2 header name:value pair.
    - `value`: Points to the header value in the HTTP/2 header name:value pair.
    - `name_len`: Stores the length of the header name.
    - `hint`: Contains flags that provide metadata about the header, such as if it is indexed or Huffman coded.
    - `value_len`: Stores the length of the header value.
- **Description**: Represents an HTTP/2 header name:value pair, where `name` and `value` point to decoded header values that are not null-terminated and may not be valid ASCII. The `hint` field provides metadata about the header, such as whether it is indexed or Huffman coded, with specific bits indicating these properties.


---
### fd\_hpack\_rd
- **Type**: ``struct``
- **Members**:
    - ``src``: A pointer to the start of the HPACK-encoded data source.
    - ``src_end``: A pointer to the end of the HPACK-encoded data source.
- **Description**: Facilitates reading a block of HPACK-encoded HTTP/2 headers by maintaining pointers to the start and end of the data source.


---
### fd\_hpack\_rd\_t
- **Type**: ``struct``
- **Members**:
    - ``src``: A pointer to the start of the HPACK-encoded data block.
    - ``src_end``: A pointer to the end of the HPACK-encoded data block.
- **Description**: Reads a block of HPACK-encoded HTTP/2 headers, using pointers to define the range of the data block to be processed.


# Functions

---
### fd\_hpack\_rd\_done<!-- {{#callable:fd_hpack_rd_done}} -->
[View Source →](<../../../../../src/waltz/h2/fd_hpack.h#L68>)

Checks if all header entries have been read from an `fd_hpack_rd_t` object.
- **Inputs**:
    - `rd`: A pointer to a constant `fd_hpack_rd_t` object that represents the current state of reading HPACK-encoded HTTP/2 headers.
- **Logic and Control Flow**:
    - Compare the `src` pointer of the `fd_hpack_rd_t` object with its `src_end` pointer.
    - Return 1 if `src` is greater than or equal to `src_end`, indicating that all headers have been read.
    - Return 0 otherwise, indicating that there are more headers to read.
- **Output**: Returns 1 if all headers have been read, otherwise returns 0.


# Function Declarations (Public API)

---
### fd\_hpack\_rd\_next<!-- {{#callable_declaration:fd_hpack_rd_next}} -->
[View Source →](<../../../../../src/waltz/h2/fd_hpack.h#L89>)

Reads the next HPACK-encoded HTTP/2 header.
- **Description**: Use this function to read the next header from an HPACK-encoded HTTP/2 header block. It populates the `hdr` structure with pointers to the decoded header data, which may point into the source buffer or a scratch buffer. Ensure that `*scratch` points to the next free byte in a scratch buffer and `scratch_end` points one past the last byte of this buffer. The function returns success or a compression error, and updates `*scratch` on success. On failure, the header and scratch buffer contents are invalidated.
- **Inputs**:
    - `hpack_rd`: A pointer to an `fd_hpack_rd_t` object that reads HPACK-encoded headers. It must be initialized and not null.
    - `hdr`: A pointer to an `fd_h2_hdr_t` structure that will be populated with the decoded header data. It must not be null.
    - `scratch`: A pointer to a pointer to the next free byte in a scratch buffer. It must not be null and should point to a valid memory location.
    - `scratch_end`: A pointer to one past the last byte of the scratch buffer. It must not be null and should point to a valid memory location.
- **Output**: Returns `FD_H2_SUCCESS` on success, or `FD_H2_ERR_COMPRESSION` on failure. On success, `hdr` is populated and `*scratch` is updated. On failure, `hdr` and the contents of the scratch buffer are invalidated.
- **See Also**: [`fd_hpack_rd_next`](<fd_hpack.c.md#fd_hpack_rd_next>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)