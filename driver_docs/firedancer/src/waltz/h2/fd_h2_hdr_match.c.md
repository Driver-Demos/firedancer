<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions for initializing, inserting, and finalizing HTTP/2 header matchers.

# Purpose
The code is a C module that manages HTTP/2 header matching. It provides functionality to initialize, insert, and finalize a header matcher, which is used to map HTTP/2 headers to specific identifiers. The module includes functions such as [`fd_h2_hdr_matcher_init`](<#fd_h2_hdr_matcher_init>), which initializes a header matcher with a given memory block and seed, and [`fd_h2_hdr_matcher_insert`](<#fd_h2_hdr_matcher_insert>), which adds new header entries to the matcher. The [`fd_h2_hdr_matcher_insert1`](<#fd_h2_hdr_matcher_insert1>) function is a static helper that inserts a single header entry into the map. The module also defines a static array `fd_h2_hpack_matcher` that maps indices to header identifiers, which are used during the initialization process to populate the matcher with predefined headers.

The module relies on external components, as indicated by the inclusion of headers `fd_h2_hdr_match.h` and `fd_hpack_private.h`. It defines a global variable `fd_h2_hdr_match_seed` to store the seed value used in header matching operations. The code is structured to handle potential errors, such as null pointers and misaligned memory, by logging warnings and returning null pointers when necessary. The module is designed to be part of a larger system, where it can be used to efficiently match and manage HTTP/2 headers based on their identifiers.
# Imports and Dependencies

---
- `fd_h2_hdr_match.h`
- `fd_hpack_private.h`


# Global Variables

---
### fd\_h2\_hdr\_match\_seed
- **Type**: ``ulong``
- **Description**: Stores a seed value used for header matching operations in the HTTP/2 header matcher.
- **Use**: Used to initialize and update the seed value for header matching operations.


---
### fd\_h2\_hdr\_match\_entry\_null
- **Type**: ``fd_h2_hdr_match_entry_t``
- **Description**: Represents a constant instance of the `fd_h2_hdr_match_entry_t` structure initialized to zero. This variable is used as a null or default entry in header matching operations.
- **Use**: Used as a default or null entry in header matching operations.


---
### fd\_h2\_hpack\_matcher
- **Type**: `schar const`
- **Description**: An array of 62 constant signed characters, aligned to 16 bytes, that maps indices to HTTP/2 header identifiers. Each index corresponds to a specific HTTP/2 header field, represented by predefined constants such as `FD_H2_HDR_AUTHORITY`, `FD_H2_HDR_METHOD`, etc.
- **Use**: Used to map HTTP/2 header indices to their corresponding header identifiers for efficient header processing.


# Functions

---
### fd\_h2\_hdr\_matcher\_insert1<!-- {{#callable:fd_h2_hdr_matcher_insert1}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_hdr_match.c#L8>)

Inserts a header match entry into a map with a specified ID and name.
- **Inputs**:
    - `map`: A pointer to the `fd_h2_hdr_match_entry_t` map where the entry will be inserted.
    - `id`: An integer representing the ID to associate with the header entry.
    - `name`: A constant character pointer to the header name, which must have a static lifetime.
    - `name_len`: An unsigned long representing the length of the header name.
- **Logic and Control Flow**:
    - Creates a `fd_h2_hdr_match_key_t` key with the given `name` and `name_len`.
    - Calls `fd_h2_hdr_map_insert` with the `map` and `key` to insert the entry.
    - Checks if the insertion was unsuccessful using `FD_UNLIKELY`; if so, returns `NULL`.
    - If successful, assigns the `id` to the `entry->id` and returns the `entry`.
- **Output**: Returns a pointer to the inserted `fd_h2_hdr_match_entry_t` entry, or `NULL` if the insertion fails.


---
### fd\_h2\_hdr\_matcher\_init<!-- {{#callable:fd_h2_hdr_matcher_init}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_hdr_match.c#L20>)

Initializes an HTTP/2 header matcher structure with a given memory location and seed, and populates it with predefined header entries.
- **Inputs**:
    - `mem`: A pointer to a memory location where the `fd_h2_hdr_matcher_t` structure will be initialized.
    - `seed`: An unsigned long integer used to initialize the matcher seed.
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if so, log a warning and return NULL.
    - Check if `mem` is aligned to the alignment requirements of `fd_h2_hdr_matcher_t`; if not, log a warning and return NULL.
    - Cast `mem` to `fd_h2_hdr_matcher_t *` and assign it to `matcher`.
    - Attempt to join a new header map to `matcher->entry`; if unsuccessful, return NULL.
    - Initialize `matcher->seed` with the provided `seed` and set `matcher->entry_cnt` to 0.
    - Set the global `fd_h2_hdr_match_seed` to the provided `seed`.
    - Iterate over a predefined range of header indices, inserting unique header entries into the map using [`fd_h2_hdr_matcher_insert1`](<#fd_h2_hdr_matcher_insert1>).
    - Insert additional specific WebSocket-related headers into the map using [`fd_h2_hdr_matcher_insert1`](<#fd_h2_hdr_matcher_insert1>).
    - Return the initialized `matcher`.
- **Output**: A pointer to the initialized `fd_h2_hdr_matcher_t` structure, or NULL if initialization fails.
- **Functions Called**:
    - [`fd_h2_hdr_matcher_insert1`](<#fd_h2_hdr_matcher_insert1>)


---
### fd\_h2\_hdr\_matcher\_fini<!-- {{#callable:fd_h2_hdr_matcher_fini}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_hdr_match.c#L62>)

Returns the input `matcher` pointer without modification.
- **Inputs**:
    - `matcher`: A pointer to an `fd_h2_hdr_matcher_t` structure.
- **Logic and Control Flow**:
    - Return the `matcher` pointer.
- **Output**: The same `matcher` pointer that was passed as input.


---
### fd\_h2\_hdr\_matcher\_insert<!-- {{#callable:fd_h2_hdr_matcher_insert}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_hdr_match.c#L67>)

Inserts a header entry into the matcher if it meets specified constraints.
- **Inputs**:
    - `matcher`: A pointer to the `fd_h2_hdr_matcher_t` structure where the header entry will be inserted.
    - `id`: An integer representing the identifier of the header entry, which must be between 1 and `SHORT_MAX`.
    - `name`: A pointer to a constant character string representing the name of the header, which must have a static lifetime.
    - `name_len`: An unsigned long representing the length of the header name, which must be greater than 0 and less than or equal to `USHORT_MAX`.
- **Logic and Control Flow**:
    - Checks if `id` is within the valid range (1 to `SHORT_MAX`); logs an error if not.
    - Checks if the number of entries in `matcher` has reached `FD_H2_HDR_MATCH_MAX`; logs an error if so.
    - Checks if `name_len` is valid (greater than 0 and less than or equal to `USHORT_MAX`); logs an error if not.
    - Sets `fd_h2_hdr_match_seed` to the `seed` value from `matcher`.
    - Attempts to insert the header entry using [`fd_h2_hdr_matcher_insert1`](<#fd_h2_hdr_matcher_insert1>); returns if insertion fails.
    - Increments the `entry_cnt` of `matcher` if the insertion is successful.
- **Output**: None. The function modifies the `matcher` structure in place.
- **Functions Called**:
    - [`fd_h2_hdr_matcher_insert1`](<#fd_h2_hdr_matcher_insert1>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)