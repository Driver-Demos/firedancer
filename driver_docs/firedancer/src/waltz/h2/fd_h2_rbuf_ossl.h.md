<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Utilities for I/O operations between rbuf and OpenSSL BIO, including read and write functions.

# Purpose
The code in `fd_h2_rbuf_ossl.h` provides utility functions for handling input and output operations between a ring buffer (`rbuf`) and OpenSSL's `BIO` (Basic Input/Output) interface. It is a C header file that includes functionality specifically for environments where OpenSSL is available, as indicated by the `FD_HAS_OPENSSL` preprocessor directive. The file includes the necessary OpenSSL headers and defines two static inline functions: [`fd_h2_rbuf_ssl_read`](<#fd_h2_rbuf_ssl_read>) and [`fd_h2_rbuf_ssl_write`](<#fd_h2_rbuf_ssl_write>).

The [`fd_h2_rbuf_ssl_read`](<#fd_h2_rbuf_ssl_read>) function reads data from an `SSL` object and places it into a ring buffer. It uses the `SSL_read_ex` function to perform the read operation and handles potential errors by clearing the error queue and retrieving the error code if the read fails. The [`fd_h2_rbuf_ssl_write`](<#fd_h2_rbuf_ssl_write>) function writes data from a ring buffer into an `SSL` object using `SSL_write_ex`. It manages the data transfer by checking the available data in the buffer and handling the case where the buffer is split into two segments. Both functions are designed to work with the `fd_h2_rbuf_t` type, which is assumed to be defined in the included `fd_h2_rbuf.h` file.
# Imports and Dependencies

---
- `fd_h2_rbuf.h`
- `openssl/err.h`
- `openssl/ssl.h`


# Functions

---
### fd\_h2\_rbuf\_ssl\_read<!-- {{#callable:fd_h2_rbuf_ssl_read}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_rbuf_ossl.h#L16>)

Reads bytes from an SSL connection and places them into a ring buffer.
- **Inputs**:
    - `rbuf_out`: A pointer to the ring buffer where the function will store the read bytes.
    - `ssl`: A pointer to the SSL connection from which the function will read bytes.
    - `ssl_err`: A pointer to an integer where the function will store the SSL error code if an error occurs during reading.
- **Logic and Control Flow**:
    - Call [`fd_h2_rbuf_peek_free`](<fd_h2_rbuf.h.md#fd_h2_rbuf_peek_free>) to get the free space in the ring buffer and store the sizes in `sz0` and `sz1`.
    - If `sz0` is zero, return 0 as there is no space to read data into.
    - Clear any existing SSL errors using `ERR_clear_error`.
    - Attempt to read data from the SSL connection into the ring buffer using `SSL_read_ex`.
    - If `SSL_read_ex` fails, store the SSL error code in `ssl_err` using `SSL_get_error` and return 0.
    - If reading is successful, allocate the read size in the ring buffer using [`fd_h2_rbuf_alloc`](<fd_h2_rbuf.h.md#fd_h2_rbuf_alloc>).
    - Return the number of bytes read.
- **Output**: The number of bytes successfully read from the SSL connection and stored in the ring buffer, or 0 if an error occurs or there is no space to read data into.
- **Functions Called**:
    - [`fd_h2_rbuf_peek_free`](<fd_h2_rbuf.h.md#fd_h2_rbuf_peek_free>)
    - [`fd_h2_rbuf_alloc`](<fd_h2_rbuf.h.md#fd_h2_rbuf_alloc>)


---
### fd\_h2\_rbuf\_ssl\_write<!-- {{#callable:fd_h2_rbuf_ssl_write}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_rbuf_ossl.h#L37>)

Writes bytes from a ring buffer into an SSL connection.
- **Inputs**:
    - `rbuf_in`: A pointer to the `fd_h2_rbuf_t` structure representing the ring buffer from which data is written.
    - `ssl`: A pointer to the `SSL` structure representing the SSL connection to which data is written.
- **Logic and Control Flow**:
    - Call [`fd_h2_rbuf_peek_used`](<fd_h2_rbuf.h.md#fd_h2_rbuf_peek_used>) to get pointers to the used portions of the ring buffer and their sizes `sz0` and `sz1`.
    - If `sz0` is zero, return 0, indicating no data to write.
    - Attempt to write `sz0` bytes from the ring buffer to the SSL connection using `SSL_write_ex`.
    - If the write fails, return 0.
    - If there is a second segment (`sz1` is non-zero) and the first write was successful, attempt to write the second segment using `SSL_write_ex`.
    - Add the size of the second write to the total written size if successful.
    - Call [`fd_h2_rbuf_skip`](<fd_h2_rbuf.h.md#fd_h2_rbuf_skip>) to advance the ring buffer by the total number of bytes written.
    - Return the total number of bytes written.
- **Output**: The total number of bytes successfully written to the SSL connection.
- **Functions Called**:
    - [`fd_h2_rbuf_peek_used`](<fd_h2_rbuf.h.md#fd_h2_rbuf_peek_used>)
    - [`fd_h2_rbuf_skip`](<fd_h2_rbuf.h.md#fd_h2_rbuf_skip>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)