<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for Huffman encoding and decoding in the nghttp2 HTTP/2 C library.

# Purpose
The code defines a header file for handling Huffman encoding and decoding within the `nghttp2` library, which is a C library for HTTP/2. The primary focus of this file is to provide structures and functions necessary for Huffman decoding, which is a part of the HTTP/2 header compression mechanism. The file includes definitions for various data structures such as `nghttp2_huff_decode`, `nghttp2_hd_huff_decode_context`, and `nghttp2_huff_sym`, which are used to manage the state and process of Huffman decoding. It also declares external tables `huff_sym_table` and `huff_decode_table` that are likely used to facilitate the decoding process.

The file provides a function [`nghttp2_hd_huff_decode_context_init`](<#nghttp2_hd_huff_decode_context_init>) to initialize the Huffman decoding context and a function [`nghttp2_hd_huff_decode`](<#nghttp2_hd_huff_decode>) to perform the actual decoding of data. The [`nghttp2_hd_huff_decode`](<#nghttp2_hd_huff_decode>) function takes a context, a buffer, a source data pointer, the length of the source data, and a flag indicating if the input is the final block. It returns the number of bytes read or a negative error code if the decoding fails. The file also defines error codes such as `NGHTTP2_ERR_HEADER_COMP` to indicate specific decoding errors. This header file is intended to be included in other parts of the `nghttp2` library where Huffman decoding is required.
# Imports and Dependencies

---
- `stdint.h`
- `stddef.h`


# Global Variables

---
### huff\_sym\_table
- **Type**: ``nghttp2_huff_sym[]``
- **Description**: An array of `nghttp2_huff_sym` structures, where each structure represents a Huffman symbol with its corresponding code and the number of bits in that code. This table is used for encoding operations in the HTTP/2 protocol.
- **Use**: Used to store Huffman symbols and their codes for encoding purposes in HTTP/2.


---
### huff\_decode\_table
- **Type**: ``nghttp2_huff_decode``
- **Description**: A two-dimensional array of `nghttp2_huff_decode` structures, where each element represents a state in the Huffman decoding process. Each `nghttp2_huff_decode` structure contains a `fstate` field, which is the current Huffman decoding state, and a `sym` field, which holds the symbol if the `NGHTTP2_HUFF_SYM` flag is set.
- **Use**: Used to decode Huffman encoded data by transitioning through states represented in the table.


# Data Structures

---
### nghttp2\_huff\_decode\_flag
- **Type**: ``enum``
- **Members**:
    - ``NGHTTP2_HUFF_ACCEPTED``: Indicates that the finite state automaton (FSA) accepts this state as the end of a Huffman encoding sequence.
    - ``NGHTTP2_HUFF_SYM``: Indicates that this state emits a symbol.
- **Description**: Defines flags used in the Huffman decoding process, where each flag represents a specific state or action in the finite state automaton (FSA) for Huffman decoding.


---
### nghttp2\_huff\_decode
- **Type**: ``struct``
- **Members**:
    - ``fstate``: The current Huffman decoding state, represented as a node ID of the internal Huffman tree with `nghttp2_huff_decode_flag` OR-ed.
    - ``sym``: The symbol emitted if the `NGHTTP2_HUFF_SYM` flag is set.
- **Description**: Represents the state of a Huffman decoder in the HTTP/2 C library, where `fstate` indicates the current node in the Huffman tree and `sym` holds the symbol to emit if applicable.


---
### nghttp2\_hd\_huff\_decode\_context
- **Type**: ``struct``
- **Members**:
    - ``fstate``: The current Huffman decoding state represented as a `uint16_t`.
- **Description**: Maintains the current state of the Huffman decoding process in the HTTP/2 C library, using a single field `fstate` to track the decoding state.


---
### nghttp2\_huff\_sym
- **Type**: ``struct``
- **Members**:
    - ``nbits``: The number of bits in the Huffman code.
    - ``code``: The Huffman code aligned to the least significant bit (LSB).
- **Description**: Defines a Huffman symbol with its code and the number of bits used in the code, facilitating Huffman encoding and decoding processes.


---
### nghttp2\_buf
- **Type**: ``struct``
- **Members**:
    - ``last``: Points to the position one beyond the effective end of the buffer.
- **Description**: Manages a buffer with a pointer `last` that indicates the position one byte beyond the effective end of the buffer, ensuring that operations do not exceed the buffer's allocated memory.


---
### nghttp2\_error
- **Type**: ``enum``
- **Members**:
    - ``NGHTTP2_ERR_HEADER_COMP``: Indicates a header block inflate/deflate error with a value of -523.
- **Description**: Defines error codes related to HTTP/2 header compression, specifically for handling errors that occur during the inflate or deflate process of header blocks.


# Function Declarations (Public API)

---
### nghttp2\_hd\_huff\_decode\_context\_init<!-- {{#callable_declaration:nghttp2_hd_huff_decode_context_init}} -->
[View Source →](<../../../../../src/waltz/h2/nghttp2_hd_huffman.h#L74>)

Initializes a Huffman decoding context.
- **Description**: Use this function to prepare a Huffman decoding context for use in decoding operations. It sets the initial state of the context to a predefined accepted state. This function must be called before using the context in any decoding operation to ensure it is in a valid state. There are no side effects or conditions that affect the function's operation.
- **Inputs**:
    - `ctx`: A pointer to an `nghttp2_hd_huff_decode_context` structure. Must not be null. The caller retains ownership and is responsible for ensuring the context is valid and allocated before calling this function.
- **Output**: None
- **See Also**: [`nghttp2_hd_huff_decode_context_init`](<nghttp2_hd_huffman.c.md#nghttp2_hd_huff_decode_context_init>)  (Implementation)


---
### nghttp2\_hd\_huff\_decode<!-- {{#callable_declaration:nghttp2_hd_huff_decode}} -->
[View Source →](<../../../../../src/waltz/h2/nghttp2_hd_huffman.h#L121>)

Decodes Huffman-encoded data into a buffer.
- **Description**: Use this function to decode Huffman-encoded data from a source buffer into a destination buffer. Ensure that the decode context is initialized with `nghttp2_hd_huff_decode_context_init()` before calling this function. The destination buffer must have enough space to store the decoded data. Set the `fin` parameter to a nonzero value if the input data is the final block to be decoded. The function returns the number of bytes read from the source buffer. If decoding fails, it returns a negative error code indicating the type of failure.
- **Inputs**:
    - `ctx`: A pointer to an `nghttp2_hd_huff_decode_context` structure. Must be initialized before use. Caller retains ownership.
    - `buf`: A pointer to an `nghttp2_buf` structure where the decoded data will be stored. Must have enough space to hold the decoded data. Caller retains ownership.
    - `src`: A pointer to the source buffer containing Huffman-encoded data. Must not be null. Caller retains ownership.
    - `srclen`: The length of the source buffer in bytes. Must be a valid size.
    - `fin`: An integer indicating if the input data is the final block. Set to nonzero for the final block.
- **Output**: Returns the number of bytes read from the source buffer. On failure, returns a negative error code such as `NGHTTP2_ERR_HEADER_COMP`.
- **See Also**: [`nghttp2_hd_huff_decode`](<nghttp2_hd_huffman.c.md#nghttp2_hd_huff_decode>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)