<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Function for copying HTTP/2 transmission operations between connection and stream buffers.

# Purpose
The code defines a function [`fd_h2_tx_op_copy`](<#fd_h2_tx_op_copy>) that is part of an HTTP/2 transmission system. This function is responsible for managing the transmission of data frames over an HTTP/2 connection. It operates by copying data from a transmission operation (`tx_op`) into a transmission buffer (`rbuf_tx`) associated with a specific connection (`conn`) and stream (`stream`). The function ensures that the data is transmitted in compliance with the constraints of the connection's and stream's transmission windows, as well as the maximum frame size allowed by the peer's settings.

The function checks the state of the stream to ensure it is open or in a closing state before proceeding with data transmission. It calculates the maximum payload size that can be sent in a single frame, considering the available space in the buffer, the remaining data size, and the connection's constraints. If the entire chunk of data is transmitted and the `fin` flag is set, the function marks the end of the stream. The function updates the transmission windows and the remaining data size after each frame is sent. This code is part of a broader HTTP/2 implementation, likely intended to be used within a larger system that manages HTTP/2 connections and streams.
# Imports and Dependencies

---
- `fd_h2_tx.h`
- `fd_h2_conn.h`
- `fd_h2_stream.h`


# Functions

---
### fd\_h2\_tx\_op\_copy<!-- {{#callable:fd_h2_tx_op_copy}} -->
[View Source →](<../../../../../src/waltz/h2/fd_h2_tx.c#L5>)

Copies data from a transmission operation to a buffer while managing flow control and stream state.
- **Inputs**:
    - `conn`: A pointer to an `fd_h2_conn_t` structure representing the connection.
    - `stream`: A pointer to an `fd_h2_stream_t` structure representing the stream.
    - `rbuf_tx`: A pointer to an `fd_h2_rbuf_t` structure representing the transmission buffer.
    - `tx_op`: A pointer to an `fd_h2_tx_op_t` structure representing the transmission operation.
- **Logic and Control Flow**:
    - Calculate the minimum of the connection's and stream's transmission window sizes to determine the `quota` for data transmission.
    - Return immediately if `quota` is less than zero, indicating no available window for transmission.
    - Check if the stream state is `FD_H2_STREAM_STATE_CLOSED` and return if true, as no data can be sent on a closed stream.
    - Ensure the stream state is either `FD_H2_STREAM_STATE_OPEN` or `FD_H2_STREAM_STATE_CLOSING_RX`; return if not, as data transmission is not allowed in other states.
    - Enter a loop to process data transmission while `quota` is positive.
    - Calculate the remaining size of the data chunk, available buffer space, and maximum frame size to determine the `payload_sz` for the current frame.
    - Break the loop if `payload_sz` is less than or equal to zero, indicating no data can be sent.
    - Check if the remaining size of the data chunk is zero and the `fin` flag is set; if so, set the `END_STREAM` flag and close the stream's transmission.
    - Prepare the transmission by calling [`fd_h2_tx_prepare`](<fd_h2_conn.h.md#fd_h2_tx_prepare>) with the appropriate parameters.
    - Push the data chunk into the buffer using [`fd_h2_rbuf_push`](<fd_h2_rbuf.h.md#fd_h2_rbuf_push>).
    - Commit the transmission with [`fd_h2_tx_commit`](<fd_h2_conn.h.md#fd_h2_tx_commit>).
    - Update the `tx_op` chunk pointer and size, and decrement the connection's and stream's transmission windows and `quota` by `payload_sz`.
- **Output**: No explicit return value; modifies the state of the connection, stream, and transmission operation.
- **Functions Called**:
    - [`fd_h2_rbuf_free_sz`](<fd_h2_rbuf.h.md#fd_h2_rbuf_free_sz>)
    - [`fd_h2_stream_close_tx`](<fd_h2_stream.h.md#fd_h2_stream_close_tx>)
    - [`fd_h2_tx_prepare`](<fd_h2_conn.h.md#fd_h2_tx_prepare>)
    - [`fd_h2_rbuf_push`](<fd_h2_rbuf.h.md#fd_h2_rbuf_push>)
    - [`fd_h2_tx_commit`](<fd_h2_conn.h.md#fd_h2_tx_commit>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)