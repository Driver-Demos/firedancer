<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Fuzz testing for TLS message parsers using LLVM's libFuzzer framework.

# Purpose
The code is a fuzz testing suite for TLS (Transport Layer Security) message parsers. It is designed to test the robustness and correctness of parsers for specific TLS message types by providing them with a variety of inputs. The code includes two main functions: [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) and [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>). The [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) function sets up the environment for the fuzzer by configuring logging and initializing the system without signal handlers. The [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>) function is the core of the fuzzing process, where it decodes the TLS message header and processes different types of TLS messages such as `FD_TLS_MSG_CLIENT_HELLO`, `FD_TLS_MSG_SERVER_HELLO`, `FD_TLS_MSG_ENCRYPTED_EXT`, `FD_TLS_MSG_CERT_VERIFY`, and `FD_TLS_MSG_FINISHED`.

The code includes a preprocessor directive to ensure that the target environment supports hosted execution, indicated by `FD_HAS_HOSTED`. It uses functions from the `fd_tls_proto.h` header to decode various TLS message types. The fuzzing process involves checking the size of the message and decoding it based on its type. This code is intended to be used with a fuzzing framework, such as LLVM's libFuzzer, to automatically generate and test a wide range of inputs for the TLS message parsers, helping to identify potential vulnerabilities or bugs in the parsing logic.
# Imports and Dependencies

---
- `fd_tls_proto.h`
- `stdlib.h`


# Functions

---
### LLVMFuzzerInitialize<!-- {{#callable:LLVMFuzzerInitialize}} -->
[View Source →](<../../../../../src/waltz/tls/fuzz_tls_msg_parser.c#L12>)

Initializes the fuzzer environment by setting environment variables, booting the system, registering an exit function, and setting the log level.
- **Inputs**:
    - `argc`: A pointer to the argument count, typically passed to the main function.
    - `argv`: A pointer to the argument vector, typically passed to the main function.
- **Logic and Control Flow**:
    - Set the environment variable `FD_LOG_BACKTRACE` to `0` to disable backtrace logging.
    - Call `fd_boot` with `argc` and `argv` to initialize the system.
    - Register `fd_halt` to be called on program exit using `atexit`.
    - Set the core log level to `3` using `fd_log_level_core_set`, which causes the program to crash on warning logs.
    - Return `0` to indicate successful initialization.
- **Output**: Returns `0` to indicate successful initialization.


---
### LLVMFuzzerTestOneInput<!-- {{#callable:LLVMFuzzerTestOneInput}} -->
[View Source →](<../../../../../src/waltz/tls/fuzz_tls_msg_parser.c#L23>)

Processes TLS message data to decode and handle specific message types.
- **Inputs**:
    - `data`: A pointer to the input data buffer containing the TLS message.
    - `data_sz`: The size of the input data buffer in bytes.
- **Logic and Control Flow**:
    - Initialize a `fd_tls_msg_hdr_t` structure `hdr` to zero.
    - Call `fd_tls_decode_msg_hdr` to decode the message header from `data` into `hdr`.
    - If the result `res` is less than 0, return 0.
    - Assert that `res` is equal to 4 using `FD_TEST`.
    - Advance the `data` pointer by 4 bytes and decrease `data_sz` by 4 bytes.
    - Convert the 24-bit size field `hdr.sz` to a 32-bit unsigned integer `rec_sz`.
    - If `rec_sz` is greater than `data_sz`, return 0.
    - Use a switch statement on `hdr.type` to determine the message type and decode accordingly:
    - For `FD_TLS_MSG_CLIENT_HELLO`, initialize `fd_tls_client_hello_t` and call [`fd_tls_decode_client_hello`](<fd_tls_proto.c.md#fd_tls_decode_client_hello>).
    - For `FD_TLS_MSG_SERVER_HELLO`, initialize `fd_tls_server_hello_t` and call [`fd_tls_decode_server_hello`](<fd_tls_proto.c.md#fd_tls_decode_server_hello>).
    - For `FD_TLS_MSG_ENCRYPTED_EXT`, initialize `fd_tls_enc_ext_t` and call [`fd_tls_decode_enc_ext`](<fd_tls_proto.c.md#fd_tls_decode_enc_ext>).
    - For `FD_TLS_MSG_CERT_VERIFY`, initialize `fd_tls_cert_verify_t` and call [`fd_tls_decode_cert_verify`](<fd_tls_proto.c.md#fd_tls_decode_cert_verify>).
    - For `FD_TLS_MSG_FINISHED`, initialize `fd_tls_finished_t` and call `fd_tls_decode_finished`.
    - Return 0 after processing the message.
- **Output**: Always returns 0 after processing the input data.
- **Functions Called**:
    - [`fd_tls_u24_to_uint`](<fd_tls_proto.h.md#fd_tls_u24_to_uint>)
    - [`fd_tls_decode_client_hello`](<fd_tls_proto.c.md#fd_tls_decode_client_hello>)
    - [`fd_tls_decode_server_hello`](<fd_tls_proto.c.md#fd_tls_decode_server_hello>)
    - [`fd_tls_decode_enc_ext`](<fd_tls_proto.c.md#fd_tls_decode_enc_ext>)
    - [`fd_tls_decode_cert_verify`](<fd_tls_proto.c.md#fd_tls_decode_cert_verify>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)