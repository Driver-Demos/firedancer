<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines an abstraction for asynchronous packet I/O, including structures, functions, and error codes.

# Purpose
The code defines an abstraction layer for asynchronous input/output (AIO) operations, specifically for sending and receiving packets. It provides a framework that allows the same code to work with different low-level I/O libraries and hardware, abstracting away the specific details of each implementation. The main components include the `fd_aio_t` structure, which acts as an opaque handle for an AIO instance, and the `fd_aio_pkt_info_t` structure, which describes memory regions for packet data. The code also defines a function pointer type, `fd_aio_send_func_t`, for sending packet batches, and several constants for error codes and memory alignment requirements.

The header file outlines the setup and usage of AIO instances, including examples of how to configure and use them for packet transmission. It provides functions for creating, joining, and deleting AIO instances, as well as sending packets and converting error codes to human-readable strings. The code is intended to be included in other C files, serving as a public API for managing asynchronous packet I/O operations. The file includes several `FIXME` comments, indicating areas where the documentation and implementation may need further refinement or customization for specific AIO instances.
# Imports and Dependencies

---
- `../fd_waltz_base.h`


# Data Structures

---
### fd\_aio\_pkt\_info
- **Type**: ``struct``
- **Members**:
    - ``buf``: A pointer to the first byte of a memory region used for packet operations by an AIO instance.
    - ``buf_sz``: The size in bytes of the memory region pointed to by `buf`.
- **Description**: Describes a memory region in the local address space for asynchronous packet operations, with alignment and size constraints specific to AIO instances.


---
### fd\_aio\_pkt\_info\_t
- **Type**: ``struct``
- **Members**:
    - ``buf``: A pointer to the first byte of a memory region for packet operations.
    - ``buf_sz``: The size of the memory region in bytes.
- **Description**: Describes a memory region in the local address space for asynchronous packet sending and receiving operations. It includes a pointer to the memory region and its size, with alignment and footprint defined by constants. The structure is used by AIO APIs to manage packet data without object semantics.


---
### fd\_aio\_private
- **Type**: ``struct``
- **Members**:
    - ``ctx``: A pointer to the AIO specific context.
    - ``send_func``: A function pointer for sending packets in an asynchronous I/O operation.
- **Description**: Defines a private data structure for asynchronous I/O operations, containing a context pointer and a function pointer for sending packets, which are essential for managing AIO-specific functionality and operations.


---
### fd\_aio\_t
- **Type**: ``struct``
- **Members**:
    - ``ctx``: A pointer to AIO specific context.
    - ``send_func``: A function pointer for sending packets in an AIO instance.
- **Description**: Defines an opaque handle for an asynchronous I/O (AIO) instance, providing a context pointer and a function pointer for sending packets, facilitating asynchronous communication between different I/O libraries and hardware.


# Functions

---
### fd\_aio\_ctx<!-- {{#callable:fd_aio_ctx}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L238>)

Retrieves the context pointer from an `fd_aio_t` instance if it is valid, otherwise returns `NULL`.
- **Inputs**:
    - `aio`: A pointer to an `fd_aio_t` instance, which may contain a context pointer.
- **Logic and Control Flow**:
    - Checks if the `aio` pointer is valid using `FD_LIKELY` macro.
    - If `aio` is valid, returns the `ctx` member of the `fd_aio_t` structure.
    - If `aio` is not valid, returns `NULL`.
- **Output**: Returns a `void*` pointer to the context associated with the `fd_aio_t` instance, or `NULL` if the instance is invalid.


---
### fd\_aio\_send\_func<!-- {{#callable:fd_aio_send_func_t::fd_aio_send_func}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L239>)

Retrieves the send function from an asynchronous I/O instance if it exists.
- **Inputs**:
    - `aio`: A pointer to an `fd_aio_t` structure, representing an asynchronous I/O instance.
- **Logic and Control Flow**:
    - Check if the `aio` pointer is not NULL using `FD_LIKELY` macro.
    - If `aio` is valid, return the `send_func` member of the `fd_aio_t` structure.
    - If `aio` is NULL, return NULL.
- **Output**: Returns a function pointer of type `fd_aio_send_func_t` if `aio` is valid, otherwise returns NULL.


---
### fd\_aio\_send<!-- {{#callable:fd_aio_send}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L250>)

Executes the asynchronous send function for a batch of packets using the provided AIO instance.
- **Inputs**:
    - `aio`: A pointer to a constant `fd_aio_t` structure representing the AIO instance to use for sending packets.
    - `batch`: A pointer to a constant `fd_aio_pkt_info_t` structure array containing information about the packets to send.
    - `batch_cnt`: An unsigned long integer representing the number of packets in the batch to send.
    - `opt_batch_idx`: A pointer to an unsigned long integer that, if non-NULL, will store the index of the first unsent packet in case of an error.
    - `flush`: An integer indicating whether to request an asynchronous best-effort transmit of packets buffered from this and prior send operations.
- **Logic and Control Flow**:
    - Calls the `send_func` function pointer from the `aio` structure, passing the context, batch, batch count, optional batch index, and flush flag as arguments.
    - Returns the result of the `send_func` call, which is an integer indicating success or an error code.
- **Output**: Returns an integer indicating the result of the send operation, where zero represents success and negative values represent error codes.


# Function Declarations (Public API)

---
### fd\_aio\_align<!-- {{#callable_declaration:fd_aio_align}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L215>)

Returns the alignment requirement for an AIO instance.
- **Description**: Use this function to obtain the alignment requirement for an AIO instance. This is necessary when allocating memory for AIO instances to ensure proper alignment. The function does not require any parameters and can be called at any time.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement, which is a positive power of 2.
- **See Also**: [`fd_aio_align`](<fd_aio.c.md#fd_aio_align>)  (Implementation)


---
### fd\_aio\_footprint<!-- {{#callable_declaration:fd_aio_footprint}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L227>)

Returns the memory footprint of an AIO instance.
- **Description**: Use this function to obtain the size, in bytes, required to store an AIO instance. This is useful for memory allocation purposes when setting up AIO instances. The function does not require any initialization or setup before calling, and it does not modify any state or input parameters.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the memory footprint size of an AIO instance.
- **See Also**: [`fd_aio_footprint`](<fd_aio.c.md#fd_aio_footprint>)  (Implementation)


---
### fd\_aio\_new<!-- {{#callable_declaration:fd_aio_new}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L229>)

Creates a new asynchronous I/O instance.
- **Description**: Use this function to initialize a new asynchronous I/O instance with a specified shared memory region, context, and send function. This function requires a non-null shared memory pointer and a valid send function. If either is null, the function logs a warning and returns null. The context parameter can be null if not needed. This function sets up the asynchronous I/O instance to use the provided context and send function for its operations.
- **Inputs**:
    - `shmem`: Pointer to a shared memory region where the asynchronous I/O instance will be initialized. Must not be null. If null, the function logs a warning and returns null.
    - `ctx`: Pointer to a context that the asynchronous I/O instance will use. Can be null if no context is needed. The caller retains ownership.
    - `send_func`: Function pointer to a send function that the asynchronous I/O instance will use for sending packets. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a pointer to the initialized asynchronous I/O instance, or null if initialization fails due to invalid input.
- **See Also**: [`fd_aio_new`](<fd_aio.c.md#fd_aio_new>)  (Implementation)


---
### fd\_aio\_join<!-- {{#callable_declaration:fd_aio_join}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L234>)

Converts a shared asynchronous I/O instance to a local handle.
- **Description**: Use this function to obtain a local handle from a shared asynchronous I/O instance. This is necessary to perform operations on the instance locally. Ensure that the input is not null before calling this function, as a null input will result in a warning and a null return value. This function is typically used when you need to interact with an asynchronous I/O instance in a local context.
- **Inputs**:
    - `shaio`: A pointer to a shared asynchronous I/O instance. Must not be null. If null, the function logs a warning and returns null. The caller retains ownership of the pointer.
- **Output**: Returns a pointer to a local asynchronous I/O handle if the input is valid; otherwise, returns null.
- **See Also**: [`fd_aio_join`](<fd_aio.c.md#fd_aio_join>)  (Implementation)


---
### fd\_aio\_leave<!-- {{#callable_declaration:fd_aio_leave}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L235>)

Leaves an asynchronous I/O instance.
- **Description**: Use this function to leave an asynchronous I/O instance represented by `fd_aio_t`. This function should be called when you no longer need to interact with the AIO instance. It is important to ensure that the `aio` parameter is not null before calling this function, as passing a null pointer will result in a warning and a null return value.
- **Inputs**:
    - `aio`: A pointer to an `fd_aio_t` instance. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a void pointer to the AIO instance if successful, or null if the input is invalid.
- **See Also**: [`fd_aio_leave`](<fd_aio.c.md#fd_aio_leave>)  (Implementation)


---
### fd\_aio\_delete<!-- {{#callable_declaration:fd_aio_delete}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L236>)

Deletes an asynchronous I/O instance.
- **Description**: Use this function to delete an asynchronous I/O instance when it is no longer needed. This function checks if the provided pointer is null and logs a warning if it is. It is important to ensure that the pointer is valid before calling this function to avoid unexpected behavior. This function does not free any associated resources or memory.
- **Inputs**:
    - `shaio`: A pointer to the asynchronous I/O instance to delete. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns the input pointer if it is not null; otherwise, returns null.
- **See Also**: [`fd_aio_delete`](<fd_aio.c.md#fd_aio_delete>)  (Implementation)


---
### fd\_aio\_strerror<!-- {{#callable_declaration:fd_aio_strerror}} -->
[View Source →](<../../../../../src/waltz/aio/fd_aio.h#L263>)

Converts an error code to a human-readable string.
- **Description**: Use this function to obtain a human-readable description of an error code returned by asynchronous I/O operations. This can help in debugging and logging by providing a clear text representation of the error. The function accepts an error code and returns a constant string describing the error. It handles known error codes and returns "unknown" for any unrecognized codes. The returned string is always non-null and has an infinite lifetime.
- **Inputs**:
    - `err`: An integer representing the error code to convert. Valid values include `FD_AIO_SUCCESS`, `FD_AIO_ERR_INVAL`, and `FD_AIO_ERR_AGAIN`. Any other value will result in the string "unknown".
- **Output**: A constant character pointer to a string describing the error. The string is non-null and has an infinite lifetime.
- **See Also**: [`fd_aio_strerror`](<fd_aio.c.md#fd_aio_strerror>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)