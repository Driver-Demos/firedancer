<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Manages network device tables, including creation, joining, resetting, and status reporting.

# Purpose
The code defines a set of functions and structures for managing a network device table in C. It includes the definition of a private structure `fd_netdev_tbl_private` that holds metadata and offsets for device and bond tables. The functions provided include [`fd_netdev_tbl_new`](<#fd_netdev_tbl_new>), which initializes a new network device table in shared memory, and [`fd_netdev_tbl_join`](<#fd_netdev_tbl_join>), which allows a process to join an existing network device table. The [`fd_netdev_tbl_reset`](<#fd_netdev_tbl_reset>) function resets the device and bond counts and initializes the device and bond tables to default values. The [`fd_netdev_tbl_delete`](<#fd_netdev_tbl_delete>) function marks a network device table as deleted by resetting its magic number.

The code also includes a function [`fd_netdev_tbl_fprintf`](<#fd_netdev_tbl_fprintf>) that prints the status of network devices to a file, provided the `FD_HAS_HOSTED` macro is defined. This function iterates over the devices in the table and prints their operational status, MTU, and MAC address. If a device is part of a bond, it also prints information about the bond's slaves. The function [`fd_oper_status_cstr`](<#fd_oper_status_cstr>) converts an operational status code to a human-readable string. The code is designed to be part of a larger system, as indicated by the inclusion of headers and the use of macros and utility functions from other modules.
# Imports and Dependencies

---
- `fd_netdev_tbl.h`
- `../../util/fd_util.h`
- `errno.h`
- `stdio.h`
- `../../util/net/fd_eth.h`


# Data Structures

---
### fd\_netdev\_tbl\_private
- **Type**: ``struct``
- **Members**:
    - `magic`: Stores a unique identifier for the structure.
    - `dev_off`: Stores the offset to the device table from the start of the structure.
    - `bond_off`: Stores the offset to the bond table from the start of the structure.
    - `hdr`: Contains header information of type `fd_netdev_tbl_hdr_t`.
- **Description**: Defines a private data structure for network device table management, containing metadata and offsets to device and bond tables.


# Functions

---
### fd\_netdev\_tbl\_align<!-- {{#callable:fd_netdev_tbl_align}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L11>)

Returns the alignment requirement for a network device table.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the constant `FD_NETDEV_TBL_ALIGN`.
- **Output**: The function returns an `ulong` value representing the alignment requirement for a network device table.


---
### fd\_netdev\_tbl\_footprint<!-- {{#callable:fd_netdev_tbl_footprint}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L16>)

Calculates the memory footprint required for a network device table based on the maximum number of devices and bonds.
- **Inputs**:
    - `dev_max`: The maximum number of network devices.
    - `bond_max`: The maximum number of network device bonds.
- **Logic and Control Flow**:
    - Check if `dev_max` is zero or exceeds `USHORT_MAX`; if true, return 0.
    - Check if `bond_max` is zero or exceeds `USHORT_MAX`; if true, return 0.
    - Calculate the memory footprint by appending the sizes and alignments of `fd_netdev_tbl_t`, `fd_netdev_t` multiplied by `dev_max`, and `fd_netdev_bond_t` multiplied by `bond_max`, then finalize the layout with `FD_NETDEV_TBL_ALIGN`.
- **Output**: Returns the calculated memory footprint as an unsigned long integer, or 0 if input constraints are not met.


---
### fd\_netdev\_tbl\_new<!-- {{#callable:fd_netdev_tbl_new}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L28>)

Allocates and initializes a new network device table in shared memory.
- **Inputs**:
    - `shmem`: Pointer to shared memory where the network device table will be allocated.
    - `dev_max`: Maximum number of network devices that the table can hold.
    - `bond_max`: Maximum number of network device bonds that the table can hold.
- **Logic and Control Flow**:
    - Check if `shmem` is NULL and log a warning if true, then return NULL.
    - Check if `shmem` is aligned to `FD_NETDEV_TBL_ALIGN` and log a warning if not, then return NULL.
    - Check if `dev_max` is zero or exceeds `USHORT_MAX`, log a warning if true, then return NULL.
    - Check if `bond_max` is zero or exceeds `USHORT_MAX`, log a warning if true, then return NULL.
    - Initialize scratch memory allocation with `FD_SCRATCH_ALLOC_INIT`.
    - Allocate memory for `fd_netdev_tbl_t`, `fd_netdev_t`, and `fd_netdev_bond_t` using `FD_SCRATCH_ALLOC_APPEND`.
    - Finalize the scratch memory allocation with `FD_SCRATCH_ALLOC_FINI`.
    - Initialize the `fd_netdev_tbl_t` structure with magic number, offsets, and header values.
    - Join the network device table using [`fd_netdev_tbl_join`](<fd_netdev_tbl.h.md#fd_netdev_tbl_join>), reset it with [`fd_netdev_tbl_reset`](<#fd_netdev_tbl_reset>), and leave it with [`fd_netdev_tbl_leave`](<#fd_netdev_tbl_leave>).
- **Output**: Returns a pointer to the newly allocated and initialized `fd_netdev_tbl_t` structure, or NULL if an error occurs.
- **Functions Called**:
    - [`fd_netdev_tbl_join`](<fd_netdev_tbl.h.md#fd_netdev_tbl_join>)
    - [`fd_netdev_tbl_reset`](<#fd_netdev_tbl_reset>)
    - [`fd_netdev_tbl_leave`](<#fd_netdev_tbl_leave>)


---
### fd\_netdev\_tbl\_join<!-- {{#callable:fd_netdev_tbl_join}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L79>)

Initializes a `fd_netdev_tbl_join_t` structure from a shared memory table.
- **Inputs**:
    - `ljoin`: A pointer to a `fd_netdev_tbl_join_t` structure to initialize.
    - `shtbl`: A pointer to a shared memory table (`fd_netdev_tbl_t`) to join.
- **Logic and Control Flow**:
    - Check if `shtbl` is NULL; if so, log a warning and return NULL.
    - Cast `ljoin` to a `fd_netdev_tbl_join_t` pointer and `shtbl` to a `fd_netdev_tbl_t` pointer.
    - Verify that the `magic` field of `tbl` matches `FD_NETDEV_TBL_MAGIC`; if not, log a warning and return NULL.
    - Initialize the `join` structure with pointers to the header, device table, and bond table of `tbl`.
    - Return the initialized `join` structure.
- **Output**: A pointer to the initialized `fd_netdev_tbl_join_t` structure, or NULL if an error occurs.


---
### fd\_netdev\_tbl\_leave<!-- {{#callable:fd_netdev_tbl_leave}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L105>)

Returns the input pointer `join` without modification.
- **Inputs**:
    - `join`: A pointer to a `fd_netdev_tbl_join_t` structure.
- **Logic and Control Flow**:
    - Return the input pointer `join`.
- **Output**: The function returns the same pointer `join` that it receives as input.


---
### fd\_netdev\_tbl\_delete<!-- {{#callable:fd_netdev_tbl_delete}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L110>)

Sets the `magic` field of a network device table to zero and returns the table.
- **Inputs**:
    - `shtbl`: A pointer to a shared network device table (`fd_netdev_tbl_t`).
- **Logic and Control Flow**:
    - Check if `shtbl` is NULL; if true, log a warning and return NULL.
    - Cast `shtbl` to a `fd_netdev_tbl_t` pointer and store it in `tbl`.
    - Set the `magic` field of `tbl` to 0UL.
    - Return the `tbl` pointer.
- **Output**: Returns a pointer to the modified network device table, or NULL if the input was NULL.


---
### fd\_netdev\_tbl\_reset<!-- {{#callable:fd_netdev_tbl_reset}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L123>)

Resets the network device table by clearing device and bond counts and initializing device and bond entries to default values.
- **Inputs**:
    - `tbl`: A pointer to `fd_netdev_tbl_join_t`, which represents the network device table to reset.
- **Logic and Control Flow**:
    - Set `dev_cnt` and `bond_cnt` in `tbl->hdr` to 0.
    - Iterate over each device entry in `tbl->dev_tbl` up to `tbl->hdr->dev_max`.
    - For each device entry, set `master_idx` and `slave_tbl_idx` to -1.
    - Use `fd_memset` to set all entries in `tbl->bond_tbl` to 0, with a size of `sizeof(fd_netdev_bond_t) * tbl->hdr->bond_max`.
- **Output**: No return value; the function modifies the `tbl` structure in place.


---
### fd\_netdev\_tbl\_fprintf<!-- {{#callable:fd_netdev_tbl_fprintf}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L145>)

Prints the details of network devices from a table to a specified file.
- **Inputs**:
    - ``tbl``: A pointer to a `fd_netdev_tbl_join_t` structure that contains the network device table.
    - ``file_``: A pointer to a `FILE` object where the function will print the network device details.
- **Logic and Control Flow**:
    - Initialize `file` as a `FILE` pointer from `file_`.
    - Iterate over each network device in `tbl` using a loop from 0 to `tbl->hdr->dev_cnt`.
    - For each device, check if `oper_status` is non-zero; if zero, skip to the next device.
    - Print the device index, name, MTU, operational status, and its string representation using `WRAP_PRINTF`.
    - If the device is a slave (indicated by `slave_tbl_idx >= 0`), print 'master' using `WRAP_PRINT`.
    - Print the device's MAC address using `WRAP_PRINTF`.
    - If the device is a slave and has a master with slaves, print the number of slaves and their indices and names using `WRAP_PRINTF`.
    - Return 0 to indicate successful completion.
- **Output**: Returns 0 on successful printing of all network device details.
- **Functions Called**:
    - [`fd_oper_status_cstr`](<#fd_oper_status_cstr>)


---
### fd\_oper\_status\_cstr<!-- {{#callable:fd_oper_status_cstr}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.c#L179>)

Converts an operational status code to its corresponding string representation.
- **Inputs**:
    - `oper_status`: An unsigned integer representing the operational status code.
- **Logic and Control Flow**:
    - Use a switch statement to evaluate the `oper_status` value.
    - Return the string "up" if `oper_status` is `FD_OPER_STATUS_UP`.
    - Return the string "down" if `oper_status` is `FD_OPER_STATUS_DOWN`.
    - Return the string "testing" if `oper_status` is `FD_OPER_STATUS_TESTING`.
    - Return the string "dormant" if `oper_status` is `FD_OPER_STATUS_DORMANT`.
    - Return the string "not present" if `oper_status` is `FD_OPER_STATUS_NOT_PRESENT`.
    - Return the string "lower layer down" if `oper_status` is `FD_OPER_STATUS_LOWER_LAYER_DOWN`.
    - Return the string "unknown" for `FD_OPER_STATUS_UNKNOWN` or any other unrecognized status code.
- **Output**: A constant character pointer to the string representation of the operational status.



---
Made with ❤️ by [Driver](https://www.driver.ai/)