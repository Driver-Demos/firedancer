<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a network interface table API with structures and functions for managing network devices and bonds.

# Purpose
The `fd_netdev_tbl.h` file defines a network interface table API, which is used to manage and interact with network devices and their configurations. The primary entry point for this API is the `fd_netlink_tbl_t` structure. The file includes definitions for various operational statuses of network interfaces, such as `FD_OPER_STATUS_UP` and `FD_OPER_STATUS_DOWN`, which are based on RFC 2863. These statuses help in determining the current state of a network interface.

The file defines several key structures, including `fd_netdev_t`, which holds basic configuration details of a network device, such as its MTU, MAC address, and operational status. Another important structure is `fd_netdev_bond_t`, which manages the active slaves of a bonded network device. The `fd_netdev_tbl_t` structure provides an interface table optimized for frequent reads and infrequent writes, with a focus on thread safety by requiring full table copies for synchronization. The file also includes function prototypes for creating, joining, leaving, deleting, and resetting the network device table, as well as printing the table's contents to a file. These functions facilitate the management of network devices and their configurations in a shared memory environment.
# Imports and Dependencies

---
- `../../util/fd_util_base.h`


# Data Structures

---
### fd\_netdev
- **Type**: ``struct``
- **Members**:
    - `mtu`: Largest layer-3 payload that fits in a packet.
    - `mac_addr`: MAC address of the network device.
    - `if_idx`: Interface index of the network device.
    - `slave_tbl_idx`: Index to bond slave table, -1 if not a bond master.
    - `master_idx`: Index of bond master, -1 if not a bond slave.
    - `name`: C-string interface name with a maximum length of 15 characters.
    - `oper_status`: Operational status of the network device, one of `FD_OPER_STATUS_{...}`.
    - `dev_type`: Device type, one of `ARPHRD_ETHER`, `ARPHRD_LOOPBACK`, or `ARPHRD_IPGRE`.
    - `gre_dst_ip`: Destination IP address for GRE tunnels.
    - `gre_src_ip`: Source IP address for GRE tunnels.
- **Description**: Holds basic configuration details of a network device, including its MTU, MAC address, interface index, bonding information, name, operational status, device type, and GRE tunnel IP addresses.


---
### fd\_netdev\_t
- **Type**: ``struct``
- **Members**:
    - `mtu`: Largest layer-3 payload that fits in a packet.
    - `mac_addr`: MAC address of the network device.
    - `if_idx`: Interface index of the network device.
    - `slave_tbl_idx`: Index to bond slave table, -1 if not a bond master.
    - `master_idx`: Index of bond master, -1 if not a bond slave.
    - `name`: C-string interface name with a maximum length of 15 characters.
    - `oper_status`: Operational status of the network device, one of `FD_OPER_STATUS_{...}`.
    - `dev_type`: Device type, one of `ARPHRD_ETHER`, `ARPHRD_LOOPBACK`, or `ARPHRD_IPGRE`.
    - `gre_dst_ip`: Destination IP address for GRE tunnels.
    - `gre_src_ip`: Source IP address for GRE tunnels.
- **Description**: Holds basic configuration details of a network device, including its MTU, MAC address, interface index, bond master/slave indices, name, operational status, device type, and GRE tunnel IP addresses.


---
### fd\_netdev\_bond
- **Type**: ``struct``
- **Members**:
    - ``slave_cnt``: Stores the number of active slave devices in the bond.
    - ``slave_idx``: An array that holds the indices of the slave devices, with a maximum size defined by `FD_NETDEV_BOND_SLAVE_MAX`.
- **Description**: Represents a bonded network device configuration, listing active slave devices and their indices.


---
### fd\_netdev\_bond\_t
- **Type**: ``struct``
- **Members**:
    - ``slave_cnt``: Holds the count of active slave devices in the bond.
    - ``slave_idx``: An array of indices representing the active slave devices, with a maximum size defined by `FD_NETDEV_BOND_SLAVE_MAX`.
- **Description**: Lists active slave devices of a network bond, allowing management of multiple network interfaces as a single logical interface. The structure maintains a count of active slaves and their respective indices, facilitating the organization and control of bonded network devices.


---
### fd\_netdev\_tbl\_t
- **Type**: ``fd_netdev_tbl_t``
- **Members**:
    - ``fd_netdev_tbl_private``: An opaque structure that represents the private data of the network device table.
- **Description**: `fd_netdev_tbl_t` is a typedef for a private structure that provides an interface table for network devices. This table is optimized for frequent reads and rare writes, and it is not thread-safe for in-place modifications. To synchronize changes across threads, the entire table must be copied. The structure is part of a system that manages network device configurations, including device and bond tables, and provides functions for creating, joining, leaving, deleting, and resetting the table.


---
### fd\_netdev\_tbl\_hdr
- **Type**: ``struct``
- **Members**:
    - ``dev_max``: Maximum number of network devices supported.
    - ``bond_max``: Maximum number of bond devices supported.
    - ``dev_cnt``: Current count of network devices.
    - ``bond_cnt``: Current count of bond devices.
- **Description**: Defines the header for a network device table, specifying the maximum and current counts of network and bond devices.


---
### fd\_netdev\_tbl\_hdr\_t
- **Type**: ``struct``
- **Members**:
    - ``dev_max``: Maximum number of devices that the table can hold.
    - ``bond_max``: Maximum number of bond masters that the table can hold.
    - ``dev_cnt``: Current number of devices in the table.
    - ``bond_cnt``: Current number of bond masters in the table.
- **Description**: Defines the header for a network device table, specifying the maximum and current counts of devices and bond masters that the table can manage.


---
### fd\_netdev\_tbl\_join
- **Type**: ``struct``
- **Members**:
    - ``hdr``: Pointer to a `fd_netdev_tbl_hdr_t` structure that contains header information for the network device table.
    - ``dev_tbl``: Pointer to a `fd_netdev_t` structure that holds the basic configuration of network devices.
    - ``bond_tbl``: Pointer to a `fd_netdev_bond_t` structure that lists active slaves of a bond device.
- **Description**: The `fd_netdev_tbl_join` structure is used to join a network device table, providing access to the header, device table, and bond table. It facilitates operations on network device configurations and bond relationships by linking to the respective data structures that store this information.


---
### fd\_netdev\_tbl\_join\_t
- **Type**: ``struct``
- **Members**:
    - ``hdr``: Pointer to a `fd_netdev_tbl_hdr_t` structure that contains header information for the network device table.
    - ``dev_tbl``: Pointer to a `fd_netdev_t` structure that represents the network device table.
    - ``bond_tbl``: Pointer to a `fd_netdev_bond_t` structure that represents the bond table for network devices.
- **Description**: The `fd_netdev_tbl_join_t` structure is used to join a network device table, providing access to the header, device table, and bond table. It facilitates operations on the network interface table by maintaining pointers to the relevant data structures, allowing for efficient management and manipulation of network devices and their configurations.


# Function Declarations (Public API)

---
### fd\_netdev\_tbl\_align<!-- {{#callable_declaration:fd_netdev_tbl_align}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L82>)

Return the alignment requirement for a network device table.
- **Description**: Use this function to get the alignment requirement for memory regions that back a network device table. This is necessary when allocating memory to ensure proper alignment, which can affect performance and correctness. The function does not require any parameters and can be called at any time.
- **Inputs**: None
- **Output**: Returns an unsigned long integer representing the alignment requirement, which is a constant value.
- **See Also**: [`fd_netdev_tbl_align`](<fd_netdev_tbl.c.md#fd_netdev_tbl_align>)  (Implementation)


---
### fd\_netdev\_tbl\_footprint<!-- {{#callable_declaration:fd_netdev_tbl_footprint}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L90>)

Calculates the memory footprint for a network device table.
- **Description**: Use this function to determine the memory size needed to store a network device table with a specified number of devices and bond masters. It is important to ensure that both `dev_max` and `bond_max` are greater than zero and do not exceed `USHORT_MAX`. If these conditions are not met, the function returns zero, indicating an invalid input.
- **Inputs**:
    - `dev_max`: Specifies the maximum number of network devices. Must be greater than zero and less than or equal to `USHORT_MAX`. If invalid, the function returns zero.
    - `bond_max`: Specifies the maximum number of bond masters. Must be greater than zero and less than or equal to `USHORT_MAX`. If invalid, the function returns zero.
- **Output**: Returns the memory size in bytes required for the network device table, or zero if inputs are invalid.
- **See Also**: [`fd_netdev_tbl_footprint`](<fd_netdev_tbl.c.md#fd_netdev_tbl_footprint>)  (Implementation)


---
### fd\_netdev\_tbl\_new<!-- {{#callable_declaration:fd_netdev_tbl_new}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L98>)

Formats a memory region as an empty network device table.
- **Description**: Use this function to initialize a memory region as an empty network device table, which can then be used to manage network interfaces and bonds. The function requires a valid, aligned memory region and specific maximum counts for devices and bonds. It returns a pointer to the formatted table on success or NULL if any input is invalid, logging the reason for failure. Ensure the memory region is aligned to `FD_NETDEV_TBL_ALIGN` and that `dev_max` and `bond_max` are within the valid range.
- **Inputs**:
    - `shmem`: Pointer to the shared memory region to format. Must not be null and must be aligned to `FD_NETDEV_TBL_ALIGN`. Caller retains ownership.
    - `dev_max`: Maximum number of network devices the table can hold. Must be greater than 0 and less than or equal to `USHORT_MAX`.
    - `bond_max`: Maximum number of bond masters the table can hold. Must be greater than 0 and less than or equal to `USHORT_MAX`.
- **Output**: Returns a pointer to the formatted network device table on success, or NULL on failure.
- **See Also**: [`fd_netdev_tbl_new`](<fd_netdev_tbl.c.md#fd_netdev_tbl_new>)  (Implementation)


---
### fd\_netdev\_tbl\_leave<!-- {{#callable_declaration:fd_netdev_tbl_leave}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L116>)

Releases a network device table join.
- **Description**: Use this function to release a previously joined network device table, returning control of the memory region associated with the join back to the caller. This function should be called when the network device table is no longer needed, to ensure proper memory management. It is important to note that this function returns the join pointer, not the original shared table pointer.
- **Inputs**:
    - `join`: A pointer to a `fd_netdev_tbl_join_t` structure that represents the joined network device table. This pointer must not be null and should have been obtained from a successful call to `fd_netdev_tbl_join`.
- **Output**: Returns the `join` pointer, indicating the memory region is now under the caller's control.
- **See Also**: [`fd_netdev_tbl_leave`](<fd_netdev_tbl.c.md#fd_netdev_tbl_leave>)  (Implementation)


---
### fd\_netdev\_tbl\_delete<!-- {{#callable_declaration:fd_netdev_tbl_delete}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L122>)

Unformats a network device table and returns ownership of the memory region.
- **Description**: Use this function to unformat a memory region that backs a network device table, effectively deleting the table. This function should be called when the table is no longer needed, and you want to reclaim the memory region for other uses. Ensure that the pointer to the table is not null before calling this function, as passing a null pointer will result in a warning and a null return value. This function is not thread-safe, so ensure that no other threads are accessing the table concurrently.
- **Inputs**:
    - `shtbl`: A pointer to the memory region backing the network device table. Must not be null. The caller retains ownership of the memory region.
- **Output**: Returns the pointer to the memory region on success, or null if the input pointer is null.
- **See Also**: [`fd_netdev_tbl_delete`](<fd_netdev_tbl.c.md#fd_netdev_tbl_delete>)  (Implementation)


---
### fd\_netdev\_tbl\_reset<!-- {{#callable_declaration:fd_netdev_tbl_reset}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L128>)

Resets the network device table to an empty state.
- **Description**: Use this function to clear all devices and bonds from the network device table, effectively resetting it to an empty state. This function is useful when you need to reinitialize the table without deallocating and reallocating memory. Ensure that the table is properly joined and not in use by other threads, as this function is not thread-safe. Call this function when you want to start fresh with a new configuration of network devices and bonds.
- **Inputs**:
    - `tbl`: A pointer to a `fd_netdev_tbl_join_t` structure representing the network device table to reset. Must not be null. The caller must ensure that the table is properly initialized and joined before calling this function.
- **Output**: None
- **See Also**: [`fd_netdev_tbl_reset`](<fd_netdev_tbl.c.md#fd_netdev_tbl_reset>)  (Implementation)


---
### fd\_netdev\_tbl\_fprintf<!-- {{#callable_declaration:fd_netdev_tbl_fprintf}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L137>)

Prints the network interface table to a specified file.
- **Description**: Use this function to output the details of a network interface table to a specified file or equivalent target. It prints the information in ASCII format with line feed newlines. The function iterates over the network devices in the table and prints details for each device that is operational. It also includes information about bond devices and their slaves if applicable. Ensure that the table is properly initialized and joined before calling this function. The function returns 0 on success and an error code on failure.
- **Inputs**:
    - `tbl`: A pointer to a `fd_netdev_tbl_join_t` structure representing the network interface table. It must not be null and should be properly initialized and joined.
    - `file`: A pointer to a `FILE` or equivalent target where the output will be written. The caller must ensure that this pointer is valid and writable.
- **Output**: Returns 0 on success. On failure, it returns an error code.
- **See Also**: [`fd_netdev_tbl_fprintf`](<fd_netdev_tbl.c.md#fd_netdev_tbl_fprintf>)  (Implementation)


---
### fd\_oper\_status\_cstr<!-- {{#callable_declaration:fd_oper_status_cstr}} -->
[View Source →](<../../../../../src/waltz/mib/fd_netdev_tbl.h#L143>)

Converts an operational status code to a string representation.
- **Description**: Use this function to get a human-readable string that describes the operational status of a network interface. This is useful for logging or displaying status information to users. The function maps predefined status codes to their corresponding string descriptions. If the input status code is not recognized, the function returns "unknown".
- **Inputs**:
    - `oper_status`: An unsigned integer representing the operational status code of a network interface. Valid values are defined as `FD_OPER_STATUS_*` constants. If the value does not match any known status, the function returns "unknown".
- **Output**: A constant character pointer to a string that describes the operational status. Possible return values include "up", "down", "testing", "dormant", "not present", "lower layer down", and "unknown".
- **See Also**: [`fd_oper_status_cstr`](<fd_netdev_tbl.c.md#fd_oper_status_cstr>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)