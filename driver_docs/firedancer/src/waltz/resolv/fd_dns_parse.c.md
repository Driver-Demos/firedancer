<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Parses DNS messages and invokes a callback function for each answer section.

# Purpose
The code defines a function [`fd_dns_parse`](<#fd_dns_parse>) that processes DNS response messages. It takes a pointer to a buffer `r` containing the DNS message, the length of the message `rlen`, a callback function `callback`, and a context pointer `ctx`. The function first checks if the message length is valid and if the response code in the DNS header indicates no error. It then parses the question and answer sections of the DNS message. For each question, it advances the pointer `p` through the message, ensuring it does not exceed the buffer length. For each answer, it extracts the data length and calls the provided `callback` function with the context, type, data, and lengths. The function returns `-1` if it encounters an error or `0` if it successfully processes the message.

The function is part of a DNS parsing utility, likely intended to be used in a larger application that requires DNS message handling. It does not define a public API or external interface but provides a specific functionality to parse DNS messages and invoke a callback for each answer section. The inclusion of `fd_lookup.h` suggests that this header file may contain related declarations or dependencies required by the function.
# Imports and Dependencies

---
- `fd_lookup.h`


# Functions

---
### fd\_dns\_parse<!-- {{#callable:fd_dns_parse}} -->
[View Source →](<../../../../../src/waltz/resolv/fd_dns_parse.c#L3>)

Parses a DNS response and invokes a callback function for each answer record.
- **Inputs**:
    - `r`: A pointer to the DNS response data.
    - `rlen`: The length of the DNS response data.
    - `callback`: A function pointer to a callback function that processes each answer record.
    - `ctx`: A context pointer passed to the callback function.
- **Logic and Control Flow**:
    - Check if `rlen` is less than 12; if true, return -1.
    - Check if the fourth byte of `r` has any of the lower 4 bits set; if true, return 0.
    - Initialize pointer `p` to point to the start of the question section in `r`.
    - Calculate `qdcount` and `ancount` from the DNS header.
    - Iterate over each question record, adjusting `p` to skip over the question section.
    - For each answer record, adjust `p` to skip over the name and type fields.
    - Calculate the length of the data in the answer record and check if it fits within the remaining buffer; if not, return -1.
    - Invoke the `callback` function with the context, type, data, data length, and the entire response; if the callback returns a negative value, return -1.
    - Adjust `p` to skip over the current answer record.
- **Output**: Returns 0 on successful parsing and processing of all answer records, or -1 on error.



---
Made with ❤️ by [Driver](https://www.driver.ai/)