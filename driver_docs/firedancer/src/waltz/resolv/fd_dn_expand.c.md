<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Expands a DNS name from a compressed format to a full domain name string.

# Purpose
The code defines a function [`fd_dn_expand`](<#fd_dn_expand>) that expands a domain name from a DNS message into a human-readable format. It takes pointers to the start (`base`) and end (`end`) of the DNS message, a pointer to the source domain name (`src`), a destination buffer (`dest`), and the size of the buffer (`space`). The function iterates through the domain name, handling compression pointers and labels, and writes the expanded domain name to the `dest` buffer. It returns the length of the expanded domain name or `-1` if an error occurs, such as encountering a reference loop or buffer overflow. The function includes safeguards against invalid memory access and ensures that the expanded name does not exceed the buffer size.
# Imports and Dependencies

---
- `fd_resolv.h`


# Functions

---
### fd\_dn\_expand<!-- {{#callable:fd_dn_expand}} -->
[View Source →](<../../../../../src/waltz/resolv/fd_dn_expand.c#L3>)

Expands a compressed domain name from a DNS message into a full domain name string.
- **Inputs**:
    - `base`: Pointer to the start of the DNS message.
    - `end`: Pointer to the end of the DNS message.
    - `src`: Pointer to the start of the compressed domain name within the DNS message.
    - `dest`: Pointer to the buffer where the expanded domain name will be stored.
    - `space`: Maximum number of bytes available in the destination buffer.
- **Logic and Control Flow**:
    - Initialize `p` to `src` and `dbegin` to `dest`, set `len` to -1.
    - Check if `p` equals `end` or if `space` is less than or equal to 0; if true, return -1.
    - Set `dend` to the lesser of `dest + 254` or `dest + space`.
    - Iterate over the range from 0 to `end-base` in steps of 2 to detect reference loops.
    - If the current byte pointed by `p` has the two highest bits set, it indicates a pointer to another part of the message.
    - Check if `p+1` equals `end`; if true, return -1.
    - Calculate the offset `j` from the pointer and update `p` to `base + j`.
    - If `len` is less than 0, set `len` to the number of bytes processed so far.
    - If `j` is greater than or equal to `end-base`, return -1.
    - If the current byte pointed by `p` is not zero, append a dot to `dest` if it is not the beginning of the destination buffer.
    - Read the length of the next label from `p` and check if it fits within the remaining space in `dest` and `end`; if not, return -1.
    - Copy the label from `p` to `dest` and update pointers accordingly.
    - If a zero byte is encountered, terminate the string in `dest` and return the length of the expanded name.
- **Output**: Returns the length of the expanded domain name if successful, or -1 if an error occurs.



---
Made with ❤️ by [Driver](https://www.driver.ai/)