<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Opens file descriptors for `/etc/resolv.conf` and `/etc/hosts`, logging errors if unsuccessful.

# Purpose
The code is a C source file that provides functionality for opening and managing file descriptors related to network database files, specifically `/etc/resolv.conf` and `/etc/hosts`. It includes headers for network database operations and logging utilities, indicating its role in handling network configuration files. The file defines two thread-local integer variables, `fd_etc_hosts_fd` and `fd_etc_resolv_conf_fd`, which store file descriptors for the `/etc/hosts` and `/etc/resolv.conf` files, respectively.

The primary function, [`fd_netdb_open_fds`](<#fd_netdb_open_fds>), attempts to open these configuration files in read-only mode. If the files are already open (indicated by non-negative file descriptors), the function returns `NULL`. Otherwise, it opens `/etc/resolv.conf` and logs an error if the operation fails. It then attempts to open `/etc/hosts`, logging a warning if unsuccessful. If a pointer to an `fd_netdb_fds_t` structure is provided, the function populates it with the file descriptors of the opened files. This code is part of a broader system that manages network configurations, providing a mechanism to access and log the status of critical network configuration files.
# Imports and Dependencies

---
- `fd_netdb.h`
- `fd_lookup.h`
- `errno.h`
- `fcntl.h`
- `../../util/log/fd_log.h`
- `../../util/io/fd_io.h`


# Global Variables

---
### fd\_etc\_hosts\_fd
- **Type**: `int`
- **Description**: A file descriptor for the '/etc/hosts' file, initialized to -1 to indicate it is not open.
- **Use**: Used to store the file descriptor when the '/etc/hosts' file is successfully opened for reading.


---
### fd\_etc\_resolv\_conf\_fd
- **Type**: ``int``
- **Description**: Stores the file descriptor for the '/etc/resolv.conf' file, initialized to -1 to indicate it is not yet open.
- **Use**: Used to manage access to the '/etc/resolv.conf' file by storing its file descriptor once opened.


# Functions

---
### fd\_netdb\_open\_fds<!-- {{#callable:fd_netdb_open_fds}} -->
[View Source →](<../../../../../src/waltz/resolv/fd_netdb_open_fds.c#L11>)

Opens file descriptors for `/etc/resolv.conf` and `/etc/hosts`, storing them in a provided structure if successful.
- **Inputs**:
    - `fds`: A pointer to an `fd_netdb_fds_t` structure where the file descriptors will be stored if the function succeeds.
- **Logic and Control Flow**:
    - Check if `fd_etc_hosts_fd` or `fd_etc_resolv_conf_fd` are already open (i.e., not negative). If so, return `NULL`.
    - Attempt to open `/etc/resolv.conf` in read-only mode. If this fails, log an error and terminate the program.
    - Store the file descriptor of `/etc/resolv.conf` in `fd_etc_resolv_conf_fd`.
    - Attempt to open `/etc/hosts` in read-only mode. If this fails, log a warning but continue execution.
    - If opening `/etc/hosts` succeeds, store the file descriptor in `fd_etc_hosts_fd`.
    - If `fds` is not `NULL`, populate it with the file descriptors for `/etc/resolv.conf` and `/etc/hosts`.
    - Return the `fds` pointer.
- **Output**: A pointer to the `fd_netdb_fds_t` structure containing the file descriptors, or `NULL` if the file descriptors were already open.



---
Made with ❤️ by [Driver](https://www.driver.ai/)