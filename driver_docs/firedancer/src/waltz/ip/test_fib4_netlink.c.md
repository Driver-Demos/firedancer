<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the functionality of dumping local and main routing tables using netlink in a FIB4 context.

# Purpose
The code is an executable C program designed to interact with network routing tables using the Netlink protocol. It includes necessary headers for standard input/output operations, Linux routing Netlink definitions, and custom utilities. The program defines a memory buffer `fib1_mem` for storing routing information, aligned according to `FD_FIB4_ALIGN`. The main functionality is encapsulated in the [`dump_table`](<#dump_table>) function, which translates and outputs the contents of specified routing tables to the standard error stream.

The [`main`](<#main>) function initializes the program, sets up a Netlink connection, and calls [`dump_table`](<#dump_table>) to process and display the local and main routing tables. It uses the `fd_fib4` library functions to manage routing information, including creating, joining, loading, printing, and deleting routing table data. The program logs warnings and notices to help diagnose issues during execution. The use of `fd_netlink_t` and related functions indicates that the program is part of a larger system for managing network routing information, with a focus on dumping routing table contents for diagnostic or monitoring purposes.
# Imports and Dependencies

---
- `stdio.h`
- `linux/rtnetlink.h`
- `fd_fib4_netlink.h`
- `../../util/fd_util.h`


# Global Variables

---
### fib1\_mem
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters (`uchar`) with a size defined by `DEFAULT_FIB_SZ`, which is 1 MiB. The array is aligned according to `FD_FIB4_ALIGN`.
- **Use**: Used as a memory buffer for the `fd_fib4` data structure in the `dump_table` function.


# Functions

---
### dump\_table<!-- {{#callable:dump_table}} -->
[View Source →](<../../../../../src/waltz/ip/test_fib4_netlink.c#L13>)

Dumps the specified routing table to standard error output.
- **Inputs**:
    - `netlink`: A pointer to an `fd_netlink_t` structure used for netlink communication.
    - `table`: An unsigned integer representing the routing table to dump.
- **Logic and Control Flow**:
    - Define constants `route_max`, `route_peer_max`, and `route_peer_seed` for routing table configuration.
    - Check if the memory footprint of the FIB (Forwarding Information Base) is within the allocated memory size `fib1_mem`.
    - Create and join a new FIB using [`fd_fib4_new`](<fd_fib4.c.md#fd_fib4_new>) and [`fd_fib4_join`](<fd_fib4.c.md#fd_fib4_join>).
    - Load the specified routing table into the FIB using [`fd_fib4_netlink_load_table`](<fd_fib4_netlink.c.md#fd_fib4_netlink_load_table>).
    - If loading fails, log a warning message and return.
    - Print the routing table number to standard error.
    - Flush the log buffer to ensure all messages are output.
    - Dump the contents of the FIB to standard error using [`fd_fib4_fprintf`](<fd_fib4.c.md#fd_fib4_fprintf>).
    - Print a newline character to standard error.
    - Delete and leave the FIB using [`fd_fib4_delete`](<fd_fib4.c.md#fd_fib4_delete>) and [`fd_fib4_leave`](<fd_fib4.c.md#fd_fib4_leave>).
- **Output**: No return value; outputs the routing table information to standard error.
- **Functions Called**:
    - [`fd_fib4_footprint`](<fd_fib4.c.md#fd_fib4_footprint>)
    - [`fd_fib4_join`](<fd_fib4.c.md#fd_fib4_join>)
    - [`fd_fib4_new`](<fd_fib4.c.md#fd_fib4_new>)
    - [`fd_fib4_netlink_load_table`](<fd_fib4_netlink.c.md#fd_fib4_netlink_load_table>)
    - [`fd_fib4_netlink_strerror`](<fd_fib4_netlink.c.md#fd_fib4_netlink_strerror>)
    - [`fd_fib4_fprintf`](<fd_fib4.c.md#fd_fib4_fprintf>)
    - [`fd_fib4_delete`](<fd_fib4.c.md#fd_fib4_delete>)
    - [`fd_fib4_leave`](<fd_fib4.c.md#fd_fib4_leave>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/waltz/ip/test_fib4_netlink.c#L36>)

Initializes the network link, dumps local and main routing tables to standard error, and then finalizes the network link.
- **Inputs**:
    - `argc`: The count of command-line arguments.
    - `argv`: The array of command-line arguments.
- **Logic and Control Flow**:
    - Call `fd_boot` to initialize the environment with command-line arguments.
    - Declare and initialize a `fd_netlink_t` object with [`fd_netlink_init`](<fd_netlink1.c.md#fd_netlink_init>).
    - Check if the network link initialization is successful using `FD_TEST`.
    - Log a notice message indicating the start of dumping routing tables.
    - Flush the log to ensure the message is output immediately.
    - Call [`dump_table`](<#dump_table>) to dump the local routing table (`RT_TABLE_LOCAL`) to standard error.
    - Call [`dump_table`](<#dump_table>) to dump the main routing table (`RT_TABLE_MAIN`) to standard error.
    - Flush the standard error output to ensure all data is written.
    - Finalize the network link with [`fd_netlink_fini`](<fd_netlink1.c.md#fd_netlink_fini>).
    - Call `fd_halt` to perform any necessary cleanup before exiting.
    - Return 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_netlink_init`](<fd_netlink1.c.md#fd_netlink_init>)
    - [`dump_table`](<#dump_table>)
    - [`fd_netlink_fini`](<fd_netlink1.c.md#fd_netlink_fini>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)