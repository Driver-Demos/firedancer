<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines private data structures and functions for a 4-bit FIB (Forwarding Information Base) in a hashmap.

# Purpose
The code is a C header file that defines private data structures and functions for managing a Forwarding Information Base (FIB) for IPv4 addresses. It is not intended for public API use but rather for internal implementation details. The file includes definitions for two main structures: `fd_fib4_key` and `fd_fib4`. The `fd_fib4_key` structure holds information about an IPv4 address, including its prefix, mask, and priority. The `fd_fib4` structure manages the overall FIB, including offsets and counts for hash maps and hop tables, which are used to store and retrieve routing information efficiently.

The file also defines several inline functions for accessing and manipulating the FIB data structures. These functions provide low-level operations such as calculating memory addresses for key and hop tables within the FIB. Additionally, the file includes a private hash map implementation for managing entries in the FIB, with macros and functions to handle memory allocation and probing strategies. The hash map is designed to optimize performance by providing extra capacity and a probe limit to reduce the likelihood of probe failures. The file uses alignment attributes to ensure data structures are aligned in memory for optimal access speed.
# Imports and Dependencies

---
- `fd_fib4.h`
- `../../util/fd_util.h`
- `../../util/tmpl/fd_map_slot_para.c`


# Data Structures

---
### fd\_fib4\_key
- **Type**: ``struct``
- **Members**:
    - ``addr``: Prefix bits in little endian format, with low bits outside of mask being undefined.
    - ``mask``: Bit pattern used for masking.
    - ``prio``: Priority value where lower numbers indicate higher priority.
- **Description**: Defines a key structure for a Forwarding Information Base (FIB) in IPv4 routing, containing an address, a mask, and a priority to determine routing precedence.


---
### fd\_fib4\_key\_t
- **Type**: ``struct``
- **Members**:
    - ``addr``: Prefix bits in little endian format, with low bits outside of mask being undefined.
    - ``mask``: Bit pattern used for masking.
    - ``prio``: Priority value where lower numbers indicate higher priority.
- **Description**: Defines a key structure for a FIB (Forwarding Information Base) entry in IPv4 routing, containing an address, a mask, and a priority level to determine routing precedence.


---
### fd\_fib4
- **Type**: ``struct``
- **Members**:
    - ``hmap_offset``: Offset to the hashmap memory.
    - ``hmap_elem_offset``: Offset to the hashmap element memory.
    - ``hmap_cnt``: Current count of elements in the hashmap.
    - ``hmap_max``: Maximum capacity of the hashmap.
    - ``generation``: Generation counter for versioning or updates.
    - ``cnt``: Current count of elements in the structure.
    - ``max``: Maximum number of elements the structure can hold.
    - ``hop_off``: Offset to the hop table memory.
- **Description**: Represents a data structure for managing a hashmap with additional metadata for handling elements and hops. It includes offsets for memory management, counters for tracking the number of elements, and a generation counter for version control. The structure is aligned according to `FD_FIB4_ALIGN` to optimize memory access.


---
### fd\_fib4\_hmap\_entry
- **Type**: ``struct``
- **Members**:
    - ``dst_addr``: A 32-bit destination address in little-endian format.
    - ``next_hop``: An instance of `fd_fib4_hop_t` representing the next hop information.
- **Description**: Defines an entry in a hashmap used for storing IPv4 forwarding information, where each entry consists of a destination address and associated next hop data.


---
### fd\_fib4\_hmap\_entry\_t
- **Type**: ``struct``
- **Members**:
    - ``dst_addr``: Stores the destination address in little-endian format with all 32 bits defined.
    - ``next_hop``: Holds the next hop information as a `fd_fib4_hop_t` type.
- **Description**: Defines an entry in a hashmap used for storing routing information, where each entry contains a destination address and the corresponding next hop data.


# Functions

---
### fd\_fib4\_key\_tbl\_laddr<!-- {{#callable:fd_fib4_key_tbl_laddr}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L31>)

Calculates the memory address of the key table in a `fd_fib4_t` structure.
- **Inputs**:
    - `fib`: A pointer to a constant `fd_fib4_t` structure.
- **Logic and Control Flow**:
    - Convert the `fib` pointer to an unsigned long integer.
    - Add the size of the `fd_fib4_t` structure to the converted `fib` pointer.
- **Output**: Returns the calculated memory address as an unsigned long integer.


---
### fd\_fib4\_hop\_tbl\_laddr<!-- {{#callable:fd_fib4_hop_tbl_laddr}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L36>)

Calculates the memory address of the hop table in a `fd_fib4_t` structure.
- **Inputs**:
    - `fib`: A pointer to a constant `fd_fib4_t` structure, which contains the offset to the hop table.
- **Logic and Control Flow**:
    - Convert the pointer `fib` to an unsigned long integer.
    - Add the `hop_off` value from the `fib` structure to the converted pointer value.
    - Return the calculated address as an unsigned long integer.
- **Output**: The function returns the memory address of the hop table as an unsigned long integer.


---
### fd\_fib4\_key\_tbl\_const<!-- {{#callable:fd_fib4_key_tbl_const}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L41>)

Returns a constant pointer to the `fd_fib4_key_t` table associated with a given `fd_fib4_t` structure.
- **Inputs**:
    - `fib`: A constant pointer to an `fd_fib4_t` structure, which represents a Forwarding Information Base (FIB) for IPv4.
- **Logic and Control Flow**:
    - Calls the function [`fd_fib4_key_tbl_laddr`](<#fd_fib4_key_tbl_laddr>) with the input `fib` to calculate the local address of the key table.
    - Casts the result of [`fd_fib4_key_tbl_laddr`](<#fd_fib4_key_tbl_laddr>) to a constant pointer of type `fd_fib4_key_t`.
    - Returns the casted pointer.
- **Output**: A constant pointer to the `fd_fib4_key_t` table, which follows the `fd_fib4_t` structure in memory.
- **Functions Called**:
    - [`fd_fib4_key_tbl_laddr`](<#fd_fib4_key_tbl_laddr>)


---
### fd\_fib4\_hop\_tbl\_const<!-- {{#callable:fd_fib4_hop_tbl_const}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L43>)

Returns a constant pointer to the hop table within a `fd_fib4_t` structure.
- **Inputs**:
    - `fib`: A constant pointer to a `fd_fib4_t` structure, which contains the hop table and other related data.
- **Logic and Control Flow**:
    - Calls the function [`fd_fib4_hop_tbl_laddr`](<#fd_fib4_hop_tbl_laddr>) with the input `fib` to get the local address of the hop table.
    - Casts the result of [`fd_fib4_hop_tbl_laddr`](<#fd_fib4_hop_tbl_laddr>) to a constant pointer of type `fd_fib4_hop_t`.
    - Returns the casted pointer.
- **Output**: A constant pointer to a `fd_fib4_hop_t` type, representing the hop table within the `fd_fib4_t` structure.
- **Functions Called**:
    - [`fd_fib4_hop_tbl_laddr`](<#fd_fib4_hop_tbl_laddr>)


---
### fd\_fib4\_hmap\_mem<!-- {{#callable:fd_fib4_hmap_mem}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L65>)

Calculates the memory address of the hashmap within a `fd_fib4_t` structure using the `hmap_offset` field.
- **Inputs**:
    - `fib`: A pointer to a `fd_fib4_t` structure, which contains the `hmap_offset` field used to calculate the memory address.
- **Logic and Control Flow**:
    - Cast the `fib` pointer to an unsigned long integer.
    - Add the `hmap_offset` value to the casted `fib` pointer.
    - Cast the result back to a `void *` pointer to obtain the memory address of the hashmap.
- **Output**: Returns a `void *` pointer to the memory location of the hashmap within the `fd_fib4_t` structure.


---
### fd\_fib4\_hmap\_ele\_mem<!-- {{#callable:fd_fib4_hmap_ele_mem}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L66>)

Calculates the memory address of the hashmap element memory within a `fd_fib4_t` structure.
- **Inputs**:
    - `fib`: A pointer to a `fd_fib4_t` structure, which contains the offset to the hashmap element memory.
- **Logic and Control Flow**:
    - Calculate the memory address by adding the `hmap_elem_offset` from the `fd_fib4_t` structure to the base address of `fib`.
    - Cast the calculated address to a `void *` pointer type.
- **Output**: A `void *` pointer to the memory location of the hashmap element memory within the `fd_fib4_t` structure.


---
### fd\_fib4\_hmap\_get\_ele\_max<!-- {{#callable:fd_fib4_hmap_get_ele_max}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L69>)

Calculates the total capacity of a hashmap with 50% extra capacity beyond the requested size.
- **Inputs**:
    - `max_cnt`: The requested maximum number of elements for the hashmap.
- **Logic and Control Flow**:
    - Adds 50% of `max_cnt` to `max_cnt` itself to account for extra capacity.
    - Calls `fd_ulong_pow2_up` to round up the result to the nearest power of two.
- **Output**: Returns the total capacity of the hashmap as an unsigned long integer.


---
### fd\_fib4\_hmap\_get\_probe\_max<!-- {{#callable:fd_fib4_hmap_get_probe_max}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L71>)

Calculates the maximum number of probes allowed in a hashmap, which is 75% of the total element capacity.
- **Inputs**:
    - `elem_max`: The total element capacity of the hashmap.
- **Logic and Control Flow**:
    - Calculate 25% of `elem_max` by right-shifting `elem_max` by 2 bits.
    - Subtract the result from `elem_max` to get 75% of `elem_max`.
    - Return the calculated value.
- **Output**: The function returns an `ulong` representing 75% of the total element capacity, which is the maximum number of probes allowed in the hashmap.


---
### fd\_fib4\_hmap\_get\_lock\_cnt<!-- {{#callable:fd_fib4_hmap_get_lock_cnt}} -->
[View Source →](<../../../../../src/waltz/ip/fd_fib4_private.h#L73>)

Calculates the number of locks needed for a hashmap based on its maximum element count.
- **Inputs**:
    - `elem_max`: The maximum number of elements that the hashmap can contain.
- **Logic and Control Flow**:
    - Check if `elem_max` is less than or equal to 32.
    - If true, return 1 as the lock count.
    - If false, calculate the lock count by dividing `elem_max` by 16 and return the result.
- **Output**: Returns the number of locks required for the hashmap as an unsigned long integer.



---
Made with ❤️ by [Driver](https://www.driver.ai/)