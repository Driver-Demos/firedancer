<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

An unprivileged UDP socket driver for debugging with single-threaded operation and aio abstraction.

# Purpose
The code is a C header file that defines an interface for a UDP socket driver named `fd_udpsock`. This driver is designed for unprivileged applications and operates using `AF_INET` `SOCK_DGRAM` UDP sockets in non-blocking mode. It provides functions to manage memory allocation and deallocation for `fd_udpsock_t` objects, join and leave operations for socket management, and set or get asynchronous I/O (AIO) callbacks for packet handling. The driver is intended for debugging purposes over the localhost interface and is not suitable for production use due to its low performance and single-threaded operation. The file also includes constants and function prototypes related to the alignment and footprint of the socket objects, as well as functions to manage the Ethernet and IP layers.
# Imports and Dependencies

---
- `../fd_waltz_base.h`
- `../aio/fd_aio.h`


# Data Structures

---
### fd\_udpsock\_t
- **Type**: ``struct``
- **Members**:
    - `fd_udpsock_t`: An alias for the `struct fd_udpsock`, representing an unprivileged sockets-based driver for UDP applications.
- **Description**: Provides an abstraction for UDP socket operations using AF_INET SOCK_DGRAM sockets in non-blocking mode. It implements the `fd_aio` abstraction and simulates Ethernet and IP headers for localhost operations. The structure is designed for debugging purposes and is compatible with the loopback interface, but it is not suitable for production use due to its low performance and single-threaded operation limitations.


# Function Declarations (Public API)

---
### fd\_udpsock\_align<!-- {{#callable_declaration:fd_udpsock_align}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L22>)

Returns the alignment requirement for a UDP socket structure.
- **Description**: Use this function to obtain the alignment requirement for the `fd_udpsock_t` structure. This is necessary when allocating memory for a UDP socket to ensure proper alignment. The function is a constant expression and does not depend on any input parameters.
- **Inputs**: None
- **Output**: The function returns an `ulong` representing the alignment requirement for the `fd_udpsock_t` structure.
- **See Also**: [`fd_udpsock_align`](<fd_udpsock.c.md#fd_udpsock_align>)  (Implementation)


---
### fd\_udpsock\_footprint<!-- {{#callable_declaration:fd_udpsock_footprint}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L27>)

Calculates the memory footprint for a UDP socket configuration.
- **Description**: Use this function to determine the memory size needed for a UDP socket configuration based on the specified maximum transmission unit (MTU), and the number of receive and transmit packets. This function is useful when preparing memory allocation for UDP socket operations. It returns zero if any of the input parameters are zero or if the MTU is less than or equal to the defined headroom, indicating an invalid configuration.
- **Inputs**:
    - `mtu`: The maximum transmission unit size in bytes. Must be greater than zero and greater than `FD_UDPSOCK_HEADROOM`. If not, the function returns zero.
    - `rx_pkt_cnt`: The number of receive packets. Must be greater than zero. If zero, the function returns zero.
    - `tx_pkt_cnt`: The number of transmit packets. Must be greater than zero. If zero, the function returns zero.
- **Output**: Returns the calculated memory footprint in bytes for the given configuration, or zero if the configuration is invalid.
- **See Also**: [`fd_udpsock_footprint`](<fd_udpsock.c.md#fd_udpsock_footprint>)  (Implementation)


---
### fd\_udpsock\_new<!-- {{#callable_declaration:fd_udpsock_new}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L36>)

Prepares a new memory region for a UDP socket object.
- **Description**: Use this function to allocate and initialize a memory region for storing a `fd_udpsock_t` object. The function requires a memory region (`shmem`) that is correctly aligned and has sufficient size to accommodate the UDP socket object and its associated data structures. The function returns the `shmem` pointer on success, or `NULL` if the input parameters are invalid or the memory region is misaligned. This function does not join the caller to the socket object, and it is intended for single-threaded operation only.
- **Inputs**:
    - `shmem`: Pointer to a memory region where the UDP socket object will be stored. Must not be null and must be aligned according to `fd_udpsock_align()`. Caller retains ownership.
    - `mtu`: Maximum transmission unit size for the UDP socket. Must be a positive integer.
    - `rx_pkt_cnt`: Number of receive packets the socket can handle. Must be a positive integer.
    - `tx_pkt_cnt`: Number of transmit packets the socket can handle. Must be a positive integer.
- **Output**: Returns the `shmem` pointer on success, or `NULL` if the input parameters are invalid or the memory region is misaligned.
- **See Also**: [`fd_udpsock_new`](<fd_udpsock.c.md#fd_udpsock_new>)  (Implementation)


---
### fd\_udpsock\_join<!-- {{#callable_declaration:fd_udpsock_join}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L45>)

Joins a caller to a UDP socket using a memory region and file descriptor.
- **Description**: Use this function to join a caller to a previously initialized memory region that represents a UDP socket. This function requires a valid memory region pointer and a UDP socket file descriptor. It is important to ensure that the memory region is properly initialized before calling this function. The function will return a pointer to the `fd_udpsock_t` object on success, or `NULL` if the memory region pointer is `NULL`, the file descriptor is invalid, or if the socket is not an IPv4 address. This function is intended for single-threaded operation and is not suitable for production use.
- **Inputs**:
    - `shsock`: A pointer to an initialized memory region representing a UDP socket. Must not be `NULL`. The caller retains ownership.
    - `fd`: A file descriptor for a UDP socket. Must be valid and associated with an IPv4 address. Invalid file descriptors or non-IPv4 addresses will result in a `NULL` return.
- **Output**: Returns a pointer to the `fd_udpsock_t` object on success, or `NULL` on failure.
- **See Also**: [`fd_udpsock_join`](<fd_udpsock.c.md#fd_udpsock_join>)  (Implementation)


---
### fd\_udpsock\_leave<!-- {{#callable_declaration:fd_udpsock_leave}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L51>)

Undoes a local join to a UDP socket object.
- **Description**: Use this function to leave a previously joined `fd_udpsock_t` object. This function is typically called when the user no longer needs to interact with the UDP socket and wants to clean up resources. It is important to ensure that the `sock` parameter is not null before calling this function, as passing a null pointer will result in a warning and the function will return null. After calling this function, the file descriptor within the `fd_udpsock_t` object is set to -1, indicating that the socket is no longer active.
- **Inputs**:
    - `sock`: A pointer to an `fd_udpsock_t` object that the caller has previously joined. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a pointer to the `fd_udpsock_t` object if successful, or null if the input was null.
- **See Also**: [`fd_udpsock_leave`](<fd_udpsock.c.md#fd_udpsock_leave>)  (Implementation)


---
### fd\_udpsock\_delete<!-- {{#callable_declaration:fd_udpsock_delete}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L57>)

Releases ownership of a memory region back to the caller.
- **Description**: Use this function to release a memory region that was previously allocated for a UDP socket driver. This function is typically called when the memory region is no longer needed, and the caller wants to reclaim the resources. It is important to ensure that the memory region is valid and was previously allocated by the corresponding `fd_udpsock_new` function. If the input is null, the function logs a warning and returns null.
- **Inputs**:
    - `shsock`: A pointer to the memory region to release. Must not be null. If null, the function logs a warning and returns null. The caller retains ownership of the memory.
- **Output**: Returns the input pointer if it is valid, or null if the input is null.
- **See Also**: [`fd_udpsock_delete`](<fd_udpsock.c.md#fd_udpsock_delete>)  (Implementation)


---
### fd\_udpsock\_set\_rx<!-- {{#callable_declaration:fd_udpsock_set_rx}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L60>)

Sets the asynchronous I/O handler for receiving data on a UDP socket.
- **Description**: Use this function to assign an asynchronous I/O handler to a UDP socket for handling incoming data. This function is typically called after initializing the UDP socket and before starting any operations that involve receiving data. It is important to ensure that the `sock` parameter is a valid and initialized UDP socket object. The function does not perform any validation on the `aio` parameter, so it is the caller's responsibility to provide a valid asynchronous I/O handler. This function does not return a value and does not modify the state of the socket beyond setting the handler.
- **Inputs**:
    - `sock`: A pointer to a `fd_udpsock_t` object representing the UDP socket. Must not be null and must point to a valid, initialized socket object.
    - `aio`: A pointer to a `fd_aio_t` object representing the asynchronous I/O handler for receiving data. The caller must ensure this is a valid handler, as the function does not perform validation.
- **Output**: None
- **See Also**: [`fd_udpsock_set_rx`](<fd_udpsock.c.md#fd_udpsock_set_rx>)  (Implementation)


---
### fd\_udpsock\_get\_tx<!-- {{#callable_declaration:fd_udpsock_get_tx}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L64>)

Retrieves the transmit `fd_aio_t` object from a UDP socket.
- **Description**: Use this function to obtain the `fd_aio_t` object associated with the transmit operations of a UDP socket. This is useful when you need to interact with or inspect the asynchronous I/O operations related to transmission. Ensure that the `fd_udpsock_t` object is properly initialized and joined before calling this function. The function does not modify the state of the socket or the `fd_aio_t` object.
- **Inputs**:
    - `sock`: A pointer to an `fd_udpsock_t` object. Must not be null. The socket should be initialized and joined before use.
- **Output**: A pointer to a constant `fd_aio_t` object associated with the transmit operations of the given socket.
- **See Also**: [`fd_udpsock_get_tx`](<fd_udpsock.c.md#fd_udpsock_get_tx>)  (Implementation)


---
### fd\_udpsock\_service<!-- {{#callable_declaration:fd_udpsock_service}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L70>)

Services asynchronous I/O callbacks for incoming UDP packets.
- **Description**: Use this function to process incoming UDP packets and handle asynchronous I/O callbacks. It is designed for use with the `fd_udpsock_t` structure, which represents a UDP socket in non-blocking mode. This function should be called in a single-threaded context, as the underlying implementation does not support multi-threading. It processes packets received on the socket and prepares them for further handling by the application. Ensure that the socket is properly initialized and joined before calling this function. The function does not block and will return immediately if no packets are available.
- **Inputs**:
    - `sock`: A pointer to an `fd_udpsock_t` structure representing the UDP socket. Must not be null. The socket should be initialized and joined before calling this function. Invalid or null pointers will result in undefined behavior.
- **Output**: None
- **See Also**: [`fd_udpsock_service`](<fd_udpsock.c.md#fd_udpsock_service>)  (Implementation)


---
### fd\_udpsock\_get\_ip4\_address<!-- {{#callable_declaration:fd_udpsock_get_ip4_address}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L73>)

Retrieves the IPv4 address of the UDP socket.
- **Description**: Use this function to obtain the IPv4 address associated with a given UDP socket. This function is useful when you need to know the local IP address that the socket is using. It is a pure function, meaning it does not modify any state and will consistently return the same result for the same input. Ensure that the `sock` parameter is a valid pointer to an `fd_udpsock_t` object before calling this function.
- **Inputs**:
    - `sock`: A pointer to a constant `fd_udpsock_t` object. This must not be null and must point to a valid UDP socket structure. The function does not modify the object.
- **Output**: Returns the IPv4 address of the UDP socket as an unsigned integer.
- **See Also**: [`fd_udpsock_get_ip4_address`](<fd_udpsock.c.md#fd_udpsock_get_ip4_address>)  (Implementation)


---
### fd\_udpsock\_get\_listen\_port<!-- {{#callable_declaration:fd_udpsock_get_listen_port}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L76>)

Retrieves the listening port number of a UDP socket.
- **Description**: Use this function to obtain the port number on which a UDP socket is listening. This is useful for applications that need to know the specific port assigned to a socket, especially when the port is dynamically allocated. Ensure that the `sock` parameter is a valid pointer to an initialized `fd_udpsock_t` object before calling this function.
- **Inputs**:
    - `sock`: A pointer to a constant `fd_udpsock_t` object. Must not be null and should point to a valid, initialized UDP socket structure. If the pointer is invalid, the behavior is undefined.
- **Output**: Returns the port number as an unsigned integer on which the UDP socket is listening.
- **See Also**: [`fd_udpsock_get_listen_port`](<fd_udpsock.c.md#fd_udpsock_get_listen_port>)  (Implementation)


---
### fd\_udpsock\_set\_layer<!-- {{#callable_declaration:fd_udpsock_set_layer}} -->
[View Source →](<../../../../../src/waltz/udpsock/fd_udpsock.h#L84>)

Sets the header size for a UDP socket based on the specified network layer.
- **Description**: Use this function to configure the header size of a UDP socket according to the specified network layer. This function is useful when you need to adjust the socket's header size to match either the Ethernet or IP layer. It must be called with a valid `fd_udpsock_t` object and a valid layer identifier. If the layer is not recognized, the function logs a warning and returns `NULL`. Ensure that the socket is properly initialized before calling this function.
- **Inputs**:
    - `sock`: A pointer to an `fd_udpsock_t` object. This must not be null and should be a valid, initialized UDP socket object. The function modifies this object to set the appropriate header size.
    - `layer`: An unsigned integer representing the network layer. Valid values are `FD_UDPSOCK_LAYER_ETH` for the Ethernet layer and `FD_UDPSOCK_LAYER_IP` for the IP layer. If an invalid value is provided, the function logs a warning and returns `NULL`.
- **Output**: Returns the modified `fd_udpsock_t` object with the updated header size if the layer is valid, or `NULL` if the layer is invalid.
- **See Also**: [`fd_udpsock_set_layer`](<fd_udpsock.c.md#fd_udpsock_set_layer>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)