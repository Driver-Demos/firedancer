<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions to activate and deactivate XDP sockets on Linux using BPF map operations.

# Purpose
The code is a C source file that provides functionality for managing XDP (eXpress Data Path) sockets on a Linux operating system. It includes two primary functions: [`fd_xsk_activate`](<#fd_xsk_activate>) and [`fd_xsk_deactivate`](<#fd_xsk_deactivate>). These functions are responsible for attaching and detaching an XDP socket to and from a network interface queue, respectively. The code uses BPF (Berkeley Packet Filter) map operations to update and delete elements in the map, which are essential for managing the association between the XDP socket and the network interface.

The file begins with a preprocessor directive that ensures the code is only compiled on a Linux system with XDP support. It includes necessary headers such as `fd_xdp_redirect_user.h` and `fd_linux_bpf.h`, which likely define structures and functions used in the XDP and BPF operations. The [`fd_xsk_activate`](<#fd_xsk_activate>) function updates the BPF map with the socket file descriptor, while [`fd_xsk_deactivate`](<#fd_xsk_deactivate>) removes the association from the map. Both functions log information and warnings to assist with debugging and monitoring the attachment and detachment processes.
# Imports and Dependencies

---
- `fd_xdp_redirect_user.h`
- `../ebpf/fd_linux_bpf.h`
- `errno.h`


# Functions

---
### fd\_xsk\_activate<!-- {{#callable:fd_xsk_activate}} -->
[View Source →](<../../../../../src/waltz/xdp/fd_xdp_redirect_user.c#L10>)

Activates an XDP socket by updating a BPF map with the socket's file descriptor and queue ID.
- **Inputs**:
    - `xsk`: A pointer to an `fd_xsk_t` structure representing the XDP socket to activate.
    - `xsk_map_fd`: An integer representing the file descriptor of the BPF map to update.
- **Logic and Control Flow**:
    - Retrieve the queue ID from the `xsk` structure and store it in `key`.
    - Retrieve the socket file descriptor from the `xsk` structure and store it in `value`.
    - Call `fd_bpf_map_update_elem` to update the BPF map with `key` and `value`.
    - If the update fails, log a warning message and return `NULL`.
    - If the update succeeds, log an informational message indicating successful attachment to XDP.
    - Return the `xsk` pointer.
- **Output**: Returns a pointer to the `fd_xsk_t` structure if successful, or `NULL` if the BPF map update fails.


---
### fd\_xsk\_deactivate<!-- {{#callable:fd_xsk_deactivate}} -->
[View Source →](<../../../../../src/waltz/xdp/fd_xdp_redirect_user.c#L27>)

Deactivates an XDP socket by removing its entry from a BPF map.
- **Inputs**:
    - `xsk`: A pointer to an `fd_xsk_t` structure representing the XDP socket to deactivate.
    - `xsk_map_fd`: An integer file descriptor for the BPF map from which the XDP socket entry will be removed.
- **Logic and Control Flow**:
    - Retrieve the `if_queue_id` from the `xsk` structure and store it in `key`.
    - Attempt to delete the element from the BPF map using `fd_bpf_map_delete_elem` with `xsk_map_fd` and `key`.
    - If the deletion fails, log a warning message with details and return `NULL`.
    - If the deletion succeeds, log an informational message indicating detachment from the XDP interface and queue.
    - Return the `xsk` pointer.
- **Output**: Returns the `xsk` pointer if successful, or `NULL` if the deletion from the BPF map fails.



---
Made with ❤️ by [Driver](https://www.driver.ai/)