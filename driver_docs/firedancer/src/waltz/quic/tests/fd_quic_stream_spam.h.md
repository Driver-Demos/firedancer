<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for generating and managing random QUIC stream payloads for testing purposes.

# Purpose
This C header file defines a set of functions and types for generating and managing QUIC stream spam, which is used for testing purposes. It includes the definition of a function pointer type `fd_quic_stream_gen_spam_t`, which is a virtual function for generating random stream buffers to be sent over a QUIC connection. The `fd_quic_stream_spam_t` structure is a load generator that sends unidirectional streams at maximum rate, and it includes a function pointer, context, and a stream. The file provides function prototypes for creating, joining, leaving, and deleting a spam generator, as well as for initiating streams and notifying the spammer of stream finalization. The [`fd_quic_stream_spam_gen`](<#fd_quic_stream_spam_gen>) function is an implementation of the spam generation function, producing random bytes within a specified buffer size.
# Imports and Dependencies

---
- `../fd_quic.h`


# Data Structures

---
### fd\_quic\_stream\_spam\_private
- **Type**: ``struct``
- **Members**:
    - ``gen_fn``: A function pointer to a generator function that creates a random stream buffer for a given stream ID.
    - ``gen_ctx``: A pointer to the context used by the generator function.
    - ``stream``: A pointer to a `fd_quic_stream_t` structure representing the QUIC stream.
- **Description**: Defines a structure for managing the generation of random QUIC stream payloads, including a function pointer for the generation logic, a context for the function, and a reference to the associated QUIC stream.


---
### fd\_quic\_stream\_spam\_t
- **Type**: ``struct``
- **Members**:
    - `gen_fn`: A function pointer to `fd_quic_stream_gen_spam_t`, which generates a random stream buffer.
    - `gen_ctx`: A pointer to the context used in the virtual call set in `fd_quic_stream_spam_new`.
    - `stream`: A pointer to `fd_quic_stream_t`, representing the stream being managed.
- **Description**: Manages the generation and sending of sub-MTU size unidirectional streams at maximum rate using a specified generation function and context.


# Function Declarations (Public API)

---
### fd\_quic\_stream\_spam\_new<!-- {{#callable_declaration:fd_quic_stream_spam_new}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L30>)

Creates a new QUIC stream spam generator.
- **Description**: Use this function to initialize a new QUIC stream spam generator. It requires a memory block that is properly aligned and non-null. The function sets up the generator with a specified function to generate stream data and a context for that function. This is typically used in scenarios where you need to simulate or test QUIC stream behavior by generating random stream data.
- **Inputs**:
    - `mem`: A pointer to a memory block where the spam generator will be initialized. Must not be null and must be aligned to the alignment requirements of `fd_quic_stream_spam_t`. If these conditions are not met, the function returns null.
    - `gen_fn`: A function pointer of type `fd_quic_stream_gen_spam_t` that generates the stream data. This function is called to fill the stream buffer with data.
    - `gen_ctx`: A pointer to a context that is passed to the `gen_fn` function. The caller retains ownership of this context.
- **Output**: Returns a pointer to the initialized `fd_quic_stream_spam_t` structure on success, or null if the input memory is null or misaligned.
- **See Also**: [`fd_quic_stream_spam_new`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_new>)  (Implementation)


---
### fd\_quic\_stream\_spam\_join<!-- {{#callable_declaration:fd_quic_stream_spam_join}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L37>)

Joins a shared QUIC stream spam object.
- **Description**: Use this function to obtain a pointer to a `fd_quic_stream_spam_t` object from a shared memory location. This function checks if the provided pointer is non-null and properly aligned. If these conditions are not met, it logs a warning and returns `NULL`. Ensure that the memory pointed to by `shspam` is correctly aligned and initialized before calling this function.
- **Inputs**:
    - `shspam`: A pointer to a shared memory location that should contain a `fd_quic_stream_spam_t` object. Must not be null and must be aligned to the alignment requirements of `fd_quic_stream_spam_t`. If these conditions are not met, the function logs a warning and returns `NULL`.
- **Output**: Returns a pointer to a `fd_quic_stream_spam_t` object if successful, or `NULL` if the input is invalid.
- **See Also**: [`fd_quic_stream_spam_join`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_join>)  (Implementation)


---
### fd\_quic\_stream\_spam\_leave<!-- {{#callable_declaration:fd_quic_stream_spam_leave}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L40>)

Releases resources associated with a QUIC stream spam generator.
- **Description**: Use this function to release resources associated with a `fd_quic_stream_spam_t` object when it is no longer needed. This function should be called to clean up after using a QUIC stream spam generator to ensure that any allocated resources are properly released. It is important to call this function to avoid resource leaks. Ensure that the `spam` parameter is a valid pointer to a `fd_quic_stream_spam_t` object before calling this function.
- **Inputs**:
    - `spam`: A pointer to a `fd_quic_stream_spam_t` object. Must be a valid pointer. The function returns this pointer cast to `void *`. If the pointer is invalid, behavior is undefined.
- **Output**: Returns the input `spam` pointer cast to `void *`. This can be used for further processing or validation.
- **See Also**: [`fd_quic_stream_spam_leave`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_leave>)  (Implementation)


---
### fd\_quic\_stream\_spam\_delete<!-- {{#callable_declaration:fd_quic_stream_spam_delete}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L43>)

Deletes a QUIC stream spam object.
- **Description**: Use this function to delete a QUIC stream spam object when it is no longer needed. This function takes a pointer to the spam object and returns the same pointer. It is important to ensure that the pointer provided is valid and was previously created by the appropriate initialization function. This function does not perform any deallocation or cleanup beyond returning the pointer.
- **Inputs**:
    - `shspam`: A pointer to the QUIC stream spam object to delete. The pointer must be valid and previously initialized. The function does not check for null or invalid pointers.
- **Output**: Returns the same pointer that was passed in as input.
- **See Also**: [`fd_quic_stream_spam_delete`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_delete>)  (Implementation)


---
### fd\_quic\_stream\_spam\_service<!-- {{#callable_declaration:fd_quic_stream_spam_service}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L50>)

Initiates and sends random QUIC streams.
- **Description**: Use this function to send as many random QUIC streams as possible using the provided connection and spam generator. It attempts to create and send streams until it encounters a condition that prevents further sending. This function returns the number of streams successfully sent or -1 if a fatal error occurs. Ensure that the connection is valid and the spam generator is properly initialized before calling this function.
- **Inputs**:
    - `conn`: A pointer to an `fd_quic_conn_t` structure representing the QUIC connection. Must not be null. The connection should be valid and ready to handle new streams.
    - `spam`: A pointer to an `fd_quic_stream_spam_t` structure used to generate and manage the streams. Must not be null. The spam generator should be initialized and associated with a valid generation function.
- **Output**: Returns the number of streams successfully sent. Returns -1 if a fatal error occurs during the process.
- **See Also**: [`fd_quic_stream_spam_service`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_service>)  (Implementation)


---
### fd\_quic\_stream\_spam\_notify<!-- {{#callable_declaration:fd_quic_stream_spam_notify}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L58>)

Notifies the spammer of a stream's impending finalization.
- **Description**: Use this function to inform the spammer that a stream is about to be finalized. This function must only be called for streams that were created during a `fd_quic_stream_spam_service` call. It marks the stream context as a 'tombstone' if the stream is still pending, ensuring it is skipped during the unwinding of the pending stack. If the `stream_ctx` is null, the function does nothing.
- **Inputs**:
    - `stream`: A pointer to the `fd_quic_stream_t` structure representing the stream to be finalized. The function does not use this parameter, so its value is not critical.
    - `ctx`: A pointer to the stream context. This must not be null if the stream is still pending. If null, the function returns immediately without any action.
    - `type`: An integer representing the type of notification. The function does not use this parameter, so its value is not critical.
- **Output**: None
- **See Also**: [`fd_quic_stream_spam_notify`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_notify>)  (Implementation)


---
### fd\_quic\_stream\_spam\_gen<!-- {{#callable_declaration:fd_quic_stream_spam_gen}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/fd_quic_stream_spam.h#L67>)

Generates a random QUIC stream payload.
- **Description**: Use this function to fill a packet buffer with a random payload for a QUIC stream. The function writes random bytes into the buffer pointed to by `pkt`, with the size of the payload being a random value up to the initial size of the buffer (`pkt->buf_sz`). The `ctx` parameter is ignored in this implementation. This function is useful for testing or simulating QUIC stream data transmission. Ensure that `pkt->buf` is a writable buffer and `pkt->buf_sz` is correctly set before calling.
- **Inputs**:
    - `ctx`: Ignored in this implementation. Can be any value.
    - `pkt`: Pointer to an `fd_aio_pkt_info_t` structure. `pkt->buf` must be a writable buffer, and `pkt->buf_sz` must be set to the buffer's size. The function will fill this buffer with random data and update `pkt->buf_sz` to the actual size of the payload.
    - `stream_id`: An unsigned long integer representing the stream ID. Used to seed the random number generator.
- **Output**: None
- **See Also**: [`fd_quic_stream_spam_gen`](<fd_quic_stream_spam.c.md#fd_quic_stream_spam_gen>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)