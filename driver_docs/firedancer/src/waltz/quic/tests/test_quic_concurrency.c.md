<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the `fd_quic` server's ability to handle many connections with small streams, simulating mainnet conditions.

# Purpose
The code is a test suite designed to evaluate the performance and concurrency handling of a QUIC server implementation, specifically the `fd_quic` server. It simulates a high number of connections sending small streams to approximate the conditions of a QUIC server operating on a mainnet, such as a TPU (Transaction Processing Unit). The test bypasses decryption by injecting traffic directly at the QUIC frame level, while the server processes and sends out encrypted packets. This setup allows for testing the server's ability to manage numerous simultaneous connections efficiently.

The main components of the code include the initialization of a random number generator, a clock for timing operations, and a workspace for memory management. The code configures a QUIC instance with parameters that support a large number of connections and uses a sandbox environment to inject mock traffic. The test loop simulates the sending of stream frames to the server, measures the server's response in terms of frame and packet handling, and logs performance statistics. The test concludes by validating the server state and ensuring that the number of acknowledgment packets sent by the server does not exceed a certain threshold, which would indicate excessive acknowledgment traffic.
# Imports and Dependencies

---
- `fd_quic_sandbox.h`
- `../fd_quic_proto.c`
- `../fd_quic_private.h`
- `../../../tango/tempo/fd_tempo.h`
- `string.h`


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../../src/waltz/quic/tests/test_quic_concurrency.c#L15>)

Tests a QUIC server's ability to handle a large number of connections by simulating traffic and measuring performance.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Initialize the environment and random number generator.
    - Determine the CPU index and initialize the clock.
    - Parse command-line arguments for page size, page count, NUMA index, connection count, test duration, and connection burst size.
    - Convert page size string to a numeric value and check for validity.
    - Create a workspace with the specified page size and count.
    - Set up QUIC limits and create a QUIC sandbox for simulating traffic.
    - Initialize server-side connection objects for traffic injection.
    - Enter a test loop that runs until the specified duration elapses.
    - Within the loop, periodically log statistics and service the QUIC instance.
    - Randomly select connections to send frames to, simulating traffic.
    - After the loop, log the test results and validate the QUIC state.
    - Clean up resources and exit.
- **Output**: Returns 0 upon successful completion.
- **Functions Called**:
    - [`fd_quic_sandbox_align`](<fd_quic_sandbox.c.md#fd_quic_sandbox_align>)
    - [`fd_quic_sandbox_footprint`](<fd_quic_sandbox.c.md#fd_quic_sandbox_footprint>)
    - [`fd_quic_sandbox_new`](<fd_quic_sandbox.c.md#fd_quic_sandbox_new>)
    - [`fd_quic_sandbox_init`](<fd_quic_sandbox.c.md#fd_quic_sandbox_init>)
    - [`fd_quic_sandbox_send_lone_frame`](<fd_quic_sandbox.c.md#fd_quic_sandbox_send_lone_frame>)
    - [`fd_quic_sandbox_delete`](<fd_quic_sandbox.c.md#fd_quic_sandbox_delete>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)