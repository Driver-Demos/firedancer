<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Manages a pool of QUIC streams, including initialization, allocation, and deallocation functions.

# Purpose
The code defines a set of functions for managing a pool of QUIC streams, which are part of a network protocol for fast and reliable data transmission. The primary components include functions to calculate the memory footprint required for a stream pool ([`fd_quic_stream_pool_footprint`](<#fd_quic_stream_pool_footprint>)), initialize a new stream pool ([`fd_quic_stream_pool_new`](<#fd_quic_stream_pool_new>)), delete a stream pool ([`fd_quic_stream_pool_delete`](<#fd_quic_stream_pool_delete>)), allocate a stream from the pool ([`fd_quic_stream_pool_alloc`](<#fd_quic_stream_pool_alloc>)), and free a stream back to the pool ([`fd_quic_stream_pool_free`](<#fd_quic_stream_pool_free>)). The code also includes a placeholder for a batch free operation ([`fd_quic_stream_pool_free_batch`](<#fd_quic_stream_pool_free_batch>)), which is not yet implemented.

The stream pool is designed to manage a specified number of streams, with each stream having a configurable transmit buffer size. The [`fd_quic_stream_pool_new`](<#fd_quic_stream_pool_new>) function initializes the pool and allocates the specified number of streams, while ensuring proper memory alignment. The [`fd_quic_stream_pool_alloc`](<#fd_quic_stream_pool_alloc>) and [`fd_quic_stream_pool_free`](<#fd_quic_stream_pool_free>) functions manage the allocation and deallocation of streams within the pool, maintaining a count of currently allocated streams. The code is intended to be part of a larger system where efficient management of network streams is necessary, and it provides a structured way to handle stream lifecycle operations.
# Imports and Dependencies

---
- `fd_quic_stream_pool.h`


# Functions

---
### fd\_quic\_stream\_pool\_footprint<!-- {{#callable:fd_quic_stream_pool_footprint}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.c#L9>)

Calculates the memory footprint required for a QUIC stream pool based on the number of streams and the transmit buffer size.
- **Inputs**:
    - `count`: The number of streams the pool will manage.
    - `tx_buf_sz`: The size of the transmit buffer, which should be 0 for receive-only streams.
- **Logic and Control Flow**:
    - Aligns the size of `fd_quic_stream_pool_t` to `FD_QUIC_STREAM_POOL_ALIGN` and assigns it to `foot`.
    - Calculates the footprint of a single stream using [`fd_quic_stream_footprint`](<fd_quic_stream.c.md#fd_quic_stream_footprint>) with `tx_buf_sz` and assigns it to `stream_foot`.
    - Checks if `stream_foot` is zero using `FD_UNLIKELY`; if true, returns 0UL.
    - Returns the total footprint by adding `foot` and the product of `stream_foot` and `count`.
- **Output**: Returns the total memory footprint required for the stream pool, or 0 if the stream footprint is invalid.
- **Functions Called**:
    - [`fd_quic_stream_footprint`](<fd_quic_stream.c.md#fd_quic_stream_footprint>)


---
### fd\_quic\_stream\_pool\_new<!-- {{#callable:fd_quic_stream_pool_new}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.c#L28>)

Initializes a new QUIC stream pool with a specified number of streams and transmit buffer size.
- **Inputs**:
    - `mem`: A pointer to memory aligned to `fd_quic_stream_pool_align`, with at least `fd_quic_stream_pool_footprint` bytes available.
    - `count`: The number of streams the pool will manage.
    - `tx_buf_sz`: The size of the transmit buffer for each stream, should be a power of 2.
- **Logic and Control Flow**:
    - Initialize `offs` to 0 and cast `mem` to an unsigned long `ul_mem`.
    - Cast `ul_mem` to a `fd_quic_stream_pool_t` pointer and zero out the memory for the pool structure.
    - Set the pool's capacity (`cap`) to `count` and current count (`cur_cnt`) to 0.
    - Align the offset `offs` to the size of `fd_quic_stream_pool_t` using `fd_ulong_align_up`.
    - Calculate the footprint of a single stream using [`fd_quic_stream_footprint`](<fd_quic_stream.c.md#fd_quic_stream_footprint>) with `tx_buf_sz`.
    - If the stream footprint is 0, log a warning and return `NULL`.
    - Initialize the pool's head as a sentinel node using `FD_QUIC_STREAM_LIST_SENTINEL`.
    - Iterate `count` times to allocate and initialize each stream.
    - For each stream, call [`fd_quic_stream_new`](<fd_quic_stream.c.md#fd_quic_stream_new>) to create a new stream at the current offset.
    - Initialize the stream in the list and insert it after the pool's head.
    - Increment the pool's current count and update the offset by adding the stream footprint.
    - Return the initialized stream pool.
- **Output**: A pointer to the newly initialized `fd_quic_stream_pool_t` structure, or `NULL` if initialization fails.
- **Functions Called**:
    - [`fd_quic_stream_footprint`](<fd_quic_stream.c.md#fd_quic_stream_footprint>)
    - [`fd_quic_stream_new`](<fd_quic_stream.c.md#fd_quic_stream_new>)


---
### fd\_quic\_stream\_pool\_delete<!-- {{#callable:fd_quic_stream_pool_delete}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.c#L70>)

Does nothing to delete a stream pool.
- **Inputs**:
    - `stream_pool`: A pointer to the `fd_quic_stream_pool_t` structure that represents the stream pool to free.
- **Logic and Control Flow**:
    - The function takes a single argument `stream_pool` and does nothing with it.
    - The `(void)stream_pool;` line is used to suppress compiler warnings about the unused parameter.
- **Output**: There is no output or effect from this function as it currently stands.


---
### fd\_quic\_stream\_pool\_alloc<!-- {{#callable:fd_quic_stream_pool_alloc}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.c#L83>)

Allocates a stream from a pool of streams, returning the stream or NULL if no streams are available.
- **Inputs**:
    - `pool`: A pointer to the `fd_quic_stream_pool_t` structure from which to allocate a stream.
- **Logic and Control Flow**:
    - Initialize `stream_sentinel` to the head of the pool's stream list.
    - Set `stream` to the next stream in the list after `stream_sentinel`.
    - Check if `stream` is equal to `stream_sentinel`, indicating no available streams; if true, return NULL.
    - Remove `stream` from the free list using `FD_QUIC_STREAM_LIST_REMOVE`.
    - Decrease the pool's current stream count by one.
    - Return the allocated `stream`.
- **Output**: A pointer to the allocated `fd_quic_stream_t` stream, or NULL if no streams are available.


---
### fd\_quic\_stream\_pool\_free<!-- {{#callable:fd_quic_stream_pool_free}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.c#L105>)

Returns a stream to the specified pool and increments the current stream count.
- **Inputs**:
    - `pool`: A pointer to the `fd_quic_stream_pool_t` structure representing the stream pool to which the stream will be returned.
    - `stream`: A pointer to the `fd_quic_stream_t` structure representing the stream to be returned to the pool.
- **Logic and Control Flow**:
    - Insert the `stream` after the `head` of the pool's stream list using `FD_QUIC_STREAM_LIST_INSERT_AFTER`.
    - Increment the `cur_cnt` of the pool to reflect the addition of the stream back to the pool.
- **Output**: This function does not return a value.


---
### fd\_quic\_stream\_pool\_free\_batch<!-- {{#callable:fd_quic_stream_pool_free_batch}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.c#L112>)

Frees a batch of streams from the stream pool efficiently using doubly linked lists.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function is currently a placeholder with a comment indicating a TODO task.
    - The comment suggests that the function should free streams in O(1) time complexity using the doubly linked list structure of the stream pool and used/send lists.
- **Output**: No output is currently defined as the function is not yet implemented.



---
Made with ❤️ by [Driver](https://www.driver.ai/)