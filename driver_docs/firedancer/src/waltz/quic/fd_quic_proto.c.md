<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Instantiates structures and functions for the QUIC protocol, including an optimized stream frame encoder.

# Purpose
The code is part of a C implementation of the QUIC protocol, which is a transport layer network protocol. It includes various header files and templates that define types, common utilities, and protocol-specific functions for handling QUIC operations. The file focuses on encoding functionalities, particularly for stream frames, which are essential components of the QUIC protocol for managing data streams. The inclusion of multiple template files suggests that the code uses a templated approach to handle different aspects of the QUIC protocol, such as parsing, encoding, and managing transport parameters.

The function [`fd_quic_encode_stream_frame`](<#fd_quic_encode_stream_frame>) is a static function that encodes a stream frame header for QUIC. It takes parameters such as buffer pointers, stream ID, offset, data size, and a flag indicating if the stream is finished. The function calculates the maximum size of a stream header and checks if there is enough space in the buffer to write the frame. It encodes the stream ID, optionally encodes the offset if it is greater than zero, and encodes the length of the data. The function also sets the frame type, which includes flags for the presence of an offset and whether the stream is finished. The function returns the number of bytes written to the buffer.
# Imports and Dependencies

---
- `fd_quic_types.h`
- `fd_quic_common.h`
- `fd_quic_proto.h`
- `templ/fd_quic_parse_util.h`
- `templ/fd_quic_parsers.h`
- `templ/fd_quic_templ.h`
- `templ/fd_quic_frames_templ.h`
- `templ/fd_quic_undefs.h`
- `templ/fd_quic_encoders.h`
- `templ/fd_quic_encoders_footprint.h`
- `templ/fd_quic_templ_dump.h`
- `templ/fd_quic_transport_params.h`


# Functions

---
### fd\_quic\_encode\_stream\_frame<!-- {{#callable:fd_quic_encode_stream_frame}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_proto.c#L40>)

Encodes a QUIC stream frame into a buffer with specified parameters.
- **Inputs**:
    - `buf`: Pointer to the start of the buffer where the stream frame will be encoded.
    - `buf_end`: Pointer to the end of the buffer, used to ensure there is enough space for encoding.
    - `stream_id`: Identifier for the stream to be encoded.
    - `offset`: Offset value for the stream data, encoded if greater than zero.
    - `data_sz`: Size of the data to be encoded in the stream frame.
    - `fin`: Boolean flag indicating if this is the final frame of the stream.
- **Logic and Control Flow**:
    - Initialize `cur` to point to the start of the buffer `buf`.
    - Define `stream_hdr_max` as the maximum size of a stream header, which is 25 bytes.
    - Check if there is enough space in the buffer to encode the stream frame; if not, return `FD_QUIC_ENCODE_FAIL`.
    - Reserve space for the frame type and initialize `frame_type` to indicate a stream frame with length.
    - Encode the `stream_id` using [`fd_quic_varint_encode`](<templ/fd_quic_parse_util.h.md#fd_quic_varint_encode>) and update `cur`.
    - If `offset` is greater than zero, update `frame_type` to include the offset field and encode the `offset`.
    - Encode the `data_sz` as a swapped ushort and store it in the buffer, updating `cur`.
    - Set the `frame_type` in the reserved space, including the `fin` flag if set.
    - Return the number of bytes written to the buffer.
- **Output**: Returns the number of bytes written to the buffer, or `FD_QUIC_ENCODE_FAIL` if there is insufficient space.
- **Functions Called**:
    - [`fd_quic_varint_encode`](<templ/fd_quic_parse_util.h.md#fd_quic_varint_encode>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)