<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for QUIC transport parameters, including encoding, decoding, and handling unknown parameters.

# Purpose
The code is a C source file that serves as a test suite for validating the functionality of QUIC (Quick UDP Internet Connections) transport parameters and preferred address encoding and decoding. It includes several test functions that verify the correctness of encoding and decoding operations for QUIC transport parameters and preferred addresses. The file imports several headers and a source file related to QUIC protocol operations, indicating its reliance on external definitions and functions for QUIC handling.

The main components of the code include the [`preferred_address_equal`](<#preferred_address_equal>) function, which checks the equality of two `fd_quic_preferred_address_t` structures, and the [`test_preferred_address`](<#test_preferred_address>) function, which tests the encoding and decoding of a preferred address. The [`test_max_size`](<#test_max_size>) function constructs a transport parameter object with maximum possible values to test the encoding process, while [`test_grease`](<#test_grease>) ensures that the decoder correctly skips unknown transport parameters as per RFC 9000 Section 7.4.2. The [`main`](<#main>) function initializes the test environment, executes the test functions, and logs the results. The code is structured to be executed as a standalone program, as indicated by the presence of the [`main`](<#main>) function, which is typical for executable test suites.
# Imports and Dependencies

---
- `../../../util/fd_util.h`
- `../fd_quic_conn_id.h`
- `../fd_quic_enum.h`
- `../fd_quic_proto.h`
- `../fd_quic_proto.c`
- `fd_quic_transport_params.h`


# Functions

---
### preferred\_address\_equal<!-- {{#callable:preferred_address_equal}} -->
[View Source →](<../../../../../../src/waltz/quic/templ/test_quic_transport_params.c#L8>)

Compares two `fd_quic_preferred_address_t` structures to determine if they are equal.
- **Inputs**:
    - `p1`: A pointer to the first `fd_quic_preferred_address_t` structure to compare.
    - `p2`: A pointer to the second `fd_quic_preferred_address_t` structure to compare.
- **Logic and Control Flow**:
    - Compares the `ipv4_address` fields of `p1` and `p2` using `memcmp` to check if they are equal.
    - Compares the `ipv4_port` fields of `p1` and `p2` to check if they are equal.
    - Compares the `ipv6_address` fields of `p1` and `p2` using `memcmp` to check if they are equal.
    - Compares the `ipv6_port` fields of `p1` and `p2` to check if they are equal.
    - Compares the `conn_id_len` fields of `p1` and `p2` to check if they are equal.
    - Compares the `conn_id` fields of `p1` and `p2` using `memcmp` with the length specified by `conn_id_len` to check if they are equal.
    - Compares the `reset_token` fields of `p1` and `p2` using `memcmp` to check if they are equal.
    - Returns the result of the bitwise AND operation of all the above comparisons.
- **Output**: Returns an integer that is non-zero if all fields of `p1` and `p2` are equal, otherwise returns zero.


---
### test\_preferred\_address<!-- {{#callable:test_preferred_address}} -->
[View Source →](<../../../../../../src/waltz/quic/templ/test_quic_transport_params.c#L21>)

Tests the encoding and decoding of a QUIC preferred address structure and verifies the correctness of the operations.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_quic_preferred_address_t` structure with specific IPv4, IPv6 addresses, ports, connection ID, and reset token.
    - Encode the `preferred_address` into a byte array `encoded` using `fd_quic_encode_preferred_address` and verify the encoded size matches `FD_QUIC_PREFERRED_ADDRESS_SZ_MAX`.
    - Compare the encoded data with an expected byte array `expected_0` to ensure correctness.
    - Decode the `encoded` data back into a `fd_quic_preferred_address_t` structure `decoded` and verify it matches the original `preferred_address` using [`preferred_address_equal`](<#preferred_address_equal>).
    - Modify `preferred_address` by setting `conn_id_len` to 0, re-encode it, and verify the encoded size is not `FD_QUIC_ENCODE_FAIL`.
    - Compare the new encoded data with another expected byte array `expected_1` to ensure correctness.
    - Decode the new encoded data back into `decoded` and verify it matches the modified `preferred_address` using [`preferred_address_equal`](<#preferred_address_equal>).
- **Output**: No output is returned; the function uses assertions to verify correctness.
- **Functions Called**:
    - [`preferred_address_equal`](<#preferred_address_equal>)


---
### test\_max\_size<!-- {{#callable:test_max_size}} -->
[View Source →](<../../../../../../src/waltz/quic/templ/test_quic_transport_params.c#L97>)

Crafts the largest possible QUIC transport parameter object and encodes it to test the maximum size.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_quic_transport_params_t` structure `params` with all possible transport parameters set to their maximum values.
    - Create a buffer `buf` of size 4096 bytes to hold the encoded transport parameters.
    - Call [`fd_quic_encode_transport_params`](<fd_quic_transport_params.c.md#fd_quic_encode_transport_params>) to encode the `params` into `buf` and store the size of the encoded data in `sz`.
    - Use `FD_TEST` to verify that the encoding did not fail by checking that `sz` is not equal to `FD_QUIC_ENCODE_FAIL`.
    - Log the size of the largest transport parameter blob using `FD_LOG_NOTICE`.
- **Output**: Logs the size of the largest RFC 9000 transport parameter blob.
- **Functions Called**:
    - [`fd_quic_encode_transport_params`](<fd_quic_transport_params.c.md#fd_quic_encode_transport_params>)


---
### test\_grease<!-- {{#callable:test_grease}} -->
[View Source →](<../../../../../../src/waltz/quic/templ/test_quic_transport_params.c#L178>)

Tests the ability of the QUIC transport parameter decoder to skip unknown parameters and correctly handle known parameters.
- **Inputs**: None
- **Logic and Control Flow**:
    - Defines a static array `unknown_params` containing a mix of unknown and known transport parameters.
    - Initializes a `fd_quic_transport_params_t` structure `params` to zero.
    - Calls [`fd_quic_decode_transport_params`](<fd_quic_transport_params.c.md#fd_quic_decode_transport_params>) with `unknown_params` excluding the last two bytes and checks if the return value is 0, indicating successful decoding without the known zero-length parameter.
    - Calls [`fd_quic_decode_transport_params`](<fd_quic_transport_params.c.md#fd_quic_decode_transport_params>) with `unknown_params` excluding the last byte and checks if the return value is -1, indicating a failure due to incomplete known parameter data.
    - Checks that `params.disable_active_migration_present` is 0 after the first decoding attempt.
    - Calls [`fd_quic_decode_transport_params`](<fd_quic_transport_params.c.md#fd_quic_decode_transport_params>) with the full `unknown_params` array and checks if the return value is 0, indicating successful decoding including the known zero-length parameter.
    - Checks that `params.disable_active_migration_present` is 1 after the final decoding attempt.
- **Output**: No output is returned; the function uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_quic_decode_transport_params`](<fd_quic_transport_params.c.md#fd_quic_decode_transport_params>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../../src/waltz/quic/templ/test_quic_transport_params.c#L207>)

Initializes the environment, runs a series of tests on QUIC transport parameters, logs the results, and then halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Executes [`test_preferred_address`](<#test_preferred_address>) to test encoding and decoding of preferred addresses.
    - Executes [`test_max_size`](<#test_max_size>) to test the encoding of the largest possible transport parameter object.
    - Executes [`test_grease`](<#test_grease>) to ensure the decoder skips unknown transport parameters.
    - Calls [`fd_quic_dump_transport_param_desc`](<fd_quic_transport_params.c.md#fd_quic_dump_transport_param_desc>) to output transport parameter descriptions to `stdout`.
    - Logs a notice message indicating success with `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_preferred_address`](<#test_preferred_address>)
    - [`test_max_size`](<#test_max_size>)
    - [`test_grease`](<#test_grease>)
    - [`fd_quic_dump_transport_param_desc`](<fd_quic_transport_params.c.md#fd_quic_dump_transport_param_desc>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)