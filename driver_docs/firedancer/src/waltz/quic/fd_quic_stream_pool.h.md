<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a stream pool for managing QUIC streams, including functions for allocation and deallocation.

# Purpose
This C header file defines a structure and functions for managing a pool of QUIC streams. The `fd_quic_stream_pool` structure includes fields for the pool's capacity, the current count of streams, and a linked list head for free streams. The file provides function prototypes for operations such as initializing a new stream pool ([`fd_quic_stream_pool_new`](<#fd_quic_stream_pool_new>)), deleting a stream pool ([`fd_quic_stream_pool_delete`](<#fd_quic_stream_pool_delete>)), allocating a stream from the pool ([`fd_quic_stream_pool_alloc`](<#fd_quic_stream_pool_alloc>)), and freeing a stream back to the pool ([`fd_quic_stream_pool_free`](<#fd_quic_stream_pool_free>)). It also includes utility functions to determine the alignment ([`fd_quic_stream_pool_align`](<#fd_quic_stream_pool_align>)) and footprint ([`fd_quic_stream_pool_footprint`](<#fd_quic_stream_pool_footprint>)) of the stream pool. The alignment is defined by the macro `FD_QUIC_STREAM_POOL_ALIGN`, ensuring memory alignment for efficient access.
# Imports and Dependencies

---
- `fd_quic_stream.h`


# Data Structures

---
### fd\_quic\_stream\_pool
- **Type**: ``struct``
- **Members**:
    - `cap`: The capacity of the pool.
    - `cur_cnt`: The current number of streams in the pool.
    - `head`: The head of the linked list of free streams, or `NULL` if none.
- **Description**: Manages a pool of QUIC streams, tracking the total capacity, the current count of streams, and the head of a linked list of available streams.


---
### fd\_quic\_stream\_pool\_t
- **Type**: ``struct``
- **Members**:
    - `cap`: The capacity of the pool.
    - `cur_cnt`: The current number of streams in the pool.
    - `head`: The head of the linked list of free streams, or `NULL` if none.
- **Description**: Manages a pool of QUIC streams, providing functionality to allocate and free streams efficiently. The structure maintains a linked list of available streams and tracks the total capacity and current count of streams in use. It ensures that memory alignment and footprint requirements are met for optimal performance.


# Functions

---
### fd\_quic\_stream\_pool\_align<!-- {{#callable:fd_quic_stream_pool_align}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L20>)

Returns the alignment value for the `fd_quic_stream_pool_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Return the constant `FD_QUIC_STREAM_POOL_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment value, which is `128ul`.


---
### fd\_quic\_stream\_pool\_avail<!-- {{#callable:fd_quic_stream_pool_avail}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L74>)

Returns the current number of streams available in the stream pool.
- **Inputs**:
    - `pool`: A pointer to an `fd_quic_stream_pool_t` structure representing the stream pool.
- **Logic and Control Flow**:
    - Accesses the `cur_cnt` member of the `fd_quic_stream_pool_t` structure to get the current count of streams.
- **Output**: The function returns an `ulong` representing the number of streams currently available in the pool.


# Function Declarations (Public API)

---
### fd\_quic\_stream\_pool\_footprint<!-- {{#callable_declaration:fd_quic_stream_pool_footprint}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L30>)

Calculates the memory footprint required for a stream pool.
- **Description**: Use this function to determine the amount of memory needed to allocate a stream pool that can manage a specified number of streams, each with a given transmission buffer size. This calculation is necessary before allocating memory for the stream pool to ensure sufficient space is available. The function returns zero if the footprint of an individual stream cannot be determined, indicating an invalid buffer size.
- **Inputs**:
    - `count`: The number of streams the pool will manage. Must be a positive integer.
    - `tx_buf_sz`: The size of the transmission buffer for each stream. Must be a valid size that results in a non-zero stream footprint.
- **Output**: Returns the total memory footprint in bytes required for the stream pool, or zero if the stream footprint is invalid.
- **See Also**: [`fd_quic_stream_pool_footprint`](<fd_quic_stream_pool.c.md#fd_quic_stream_pool_footprint>)  (Implementation)


---
### fd\_quic\_stream\_pool\_new<!-- {{#callable_declaration:fd_quic_stream_pool_new}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L41>)

Creates and initializes a new QUIC stream pool.
- **Description**: Use this function to create a new QUIC stream pool with a specified number of streams and a given transmission buffer size. The memory provided must be aligned to `fd_quic_stream_pool_align` and have a size of at least `fd_quic_stream_pool_footprint` bytes. This function initializes the pool and allocates the specified number of streams, each with the given transmission buffer size. If the transmission buffer size is not a power of two, the function will return `NULL`. Ensure that the memory is correctly aligned and sized before calling this function.
- **Inputs**:
    - `mem`: A pointer to memory that is aligned to `fd_quic_stream_pool_align` and has a size of at least `fd_quic_stream_pool_footprint` bytes. The caller retains ownership of this memory.
    - `count`: The number of streams the pool will manage. Must be a positive integer.
    - `tx_buf_sz`: The size of the transmission buffer for each stream. Must be a power of two. If not, the function will return `NULL`.
- **Output**: A pointer to the newly initialized `fd_quic_stream_pool_t` structure, or `NULL` if the transmission buffer size is not a power of two.
- **See Also**: [`fd_quic_stream_pool_new`](<fd_quic_stream_pool.c.md#fd_quic_stream_pool_new>)  (Implementation)


---
### fd\_quic\_stream\_pool\_delete<!-- {{#callable_declaration:fd_quic_stream_pool_delete}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L52>)

Deletes a stream pool and its associated streams.
- **Description**: Use this function to delete a stream pool and all streams associated with it. Before calling, ensure that all streams have been returned to the pool. This function does not perform any operations if the `stream_pool` is null.
- **Inputs**:
    - `stream_pool`: A pointer to the stream pool to delete. Must not be null. The caller retains ownership of the memory.
- **Output**: None
- **See Also**: [`fd_quic_stream_pool_delete`](<fd_quic_stream_pool.c.md#fd_quic_stream_pool_delete>)  (Implementation)


---
### fd\_quic\_stream\_pool\_alloc<!-- {{#callable_declaration:fd_quic_stream_pool_alloc}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L62>)

Allocates a stream from the pool.
- **Description**: Use this function to obtain a stream from a specified pool. It returns a pointer to a stream if available, or NULL if the pool has no free streams. Ensure that the pool is properly initialized and contains available streams before calling this function. This function decreases the count of available streams in the pool.
- **Inputs**:
    - `pool`: A pointer to the `fd_quic_stream_pool_t` from which to allocate a stream. Must not be null. The pool should be initialized and have available streams.
- **Output**: A pointer to an `fd_quic_stream_t` if a stream is successfully allocated, or NULL if no streams are available.
- **See Also**: [`fd_quic_stream_pool_alloc`](<fd_quic_stream_pool.c.md#fd_quic_stream_pool_alloc>)  (Implementation)


---
### fd\_quic\_stream\_pool\_free<!-- {{#callable_declaration:fd_quic_stream_pool_free}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_stream_pool.h#L70>)

Returns a stream to the specified pool.
- **Description**: Use this function to return a previously allocated stream back to its originating pool. This operation increases the count of available streams in the pool. Ensure that the stream being returned was originally allocated from the specified pool. This function does not perform any validation on the stream or the pool, so incorrect usage can lead to undefined behavior.
- **Inputs**:
    - `pool`: A pointer to the `fd_quic_stream_pool_t` from which the stream was originally allocated. Must not be null.
    - `stream`: A pointer to the `fd_quic_stream_t` that is being returned to the pool. Must not be null and should have been previously allocated from the specified pool.
- **Output**: None
- **See Also**: [`fd_quic_stream_pool_free`](<fd_quic_stream_pool.c.md#fd_quic_stream_pool_free>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)