<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines an ABI for extracting high-frequency logs from an `fd_quic` instance without providing log writing APIs.

# Purpose
The `fd_quic_log_user.h` file is a C header file that defines an Application Binary Interface (ABI) for extracting high-frequency logs from an `fd_quic` instance. It includes necessary headers and defines a structure `fd_quic_log_rx_t` for managing consumer-side joins to a QUIC log interface. The file provides function prototypes for joining and leaving a QUIC log as a consumer, accessing data records, and checking the safety of log message reads. It also defines constants for memory alignment and shared memory layout identification. The header does not include APIs for writing logs, which are found in a separate internal header file.
# Imports and Dependencies

---
- `fd_quic_log.h`
- `../../../tango/mcache/fd_mcache.h`


# Data Structures

---
### fd\_quic\_log\_rx
- **Type**: ``struct``
- **Members**:
    - `mcache`: A pointer to a constant `fd_frag_meta_t` structure.
    - `mcache_seq`: A pointer to a constant unsigned long integer.
    - `base`: A pointer to a void type, representing the base address.
    - `data_lo_laddr`: An unsigned long integer representing the lower bound of data local address.
    - `data_hi_laddr`: An unsigned long integer representing the upper bound of data local address.
    - `seq`: An unsigned long integer representing the sequence number.
    - `depth`: An unsigned long integer representing the depth of the log.
- **Description**: Contains parameters for a consumer-side join to a QUIC log interface, including pointers to metadata and sequence information, as well as address and sequence boundaries for data management.


---
### fd\_quic\_log\_rx\_t
- **Type**: ``struct``
- **Members**:
    - ``mcache``: A pointer to a constant `fd_frag_meta_t` structure, representing the metadata cache.
    - ``mcache_seq``: A pointer to a constant unsigned long integer, representing the sequence number of the metadata cache.
    - ``base``: A pointer to a void type, representing the base address for data access.
    - ``data_lo_laddr``: An unsigned long integer, representing the lower bound of the data address range.
    - ``data_hi_laddr``: An unsigned long integer, representing the upper bound of the data address range.
    - ``seq``: An unsigned long integer, representing the current sequence number.
    - ``depth``: An unsigned long integer, representing the depth of the metadata cache.
- **Description**: Contains parameters for a consumer-side join to a QUIC log interface, facilitating access to log data and metadata in a shared memory environment.


# Functions

---
### fd\_quic\_log\_rx\_data\_const<!-- {{#callable:fd_quic_log_rx_data_const}} -->
[View Source →](<../../../../../../src/waltz/quic/log/fd_quic_log_user.h#L63>)

Returns a constant pointer to a data record in a QUIC log based on a given chunk index.
- **Inputs**:
    - `rx`: A pointer to a `fd_quic_log_rx_t` structure, which contains parameters for a consumer-side join to a QUIC log interface.
    - `chunk`: An unsigned long integer representing the index of the data chunk to access.
- **Logic and Control Flow**:
    - Calls the function `fd_chunk_to_laddr_const` with `rx->base` and `chunk` as arguments.
    - Returns the result of `fd_chunk_to_laddr_const`, which is a constant pointer to the data record.
- **Output**: A constant pointer to the data record corresponding to the specified chunk index.


---
### fd\_quic\_log\_rx\_is\_safe<!-- {{#callable:fd_quic_log_rx_is_safe}} -->
[View Source →](<../../../../../../src/waltz/quic/log/fd_quic_log_user.h#L73>)

Checks if a log message read is within specified memory bounds.
- **Inputs**:
    - ``rx``: A pointer to a `fd_quic_log_rx_t` structure containing parameters of a consumer-side join to a quic_log interface.
    - ``chunk``: An unsigned long integer representing the chunk value used to calculate the starting address of the log message.
    - ``sz``: An unsigned long integer representing the size of the log message.
- **Logic and Control Flow**:
    - Calculate the starting address of the log message using `fd_chunk_to_laddr_const` with `rx->base` and `chunk`.
    - Calculate the ending address of the log message by adding `sz` to the starting address.
    - Retrieve the minimum and maximum valid addresses from `rx->data_lo_laddr` and `rx->data_hi_laddr`, respectively.
    - Check if the starting address is greater than or equal to the minimum valid address, the ending address is less than or equal to the maximum valid address, and the starting address is less than or equal to the ending address.
    - Return 1 if all conditions are true, otherwise return 0.
- **Output**: Returns 1 if the log message read is within bounds, otherwise returns 0.


---
### fd\_quic\_log\_sig\_event<!-- {{#callable:fd_quic_log_sig_event}} -->
[View Source →](<../../../../../../src/waltz/quic/log/fd_quic_log_user.h#L87>)

Extracts the event ID from the `sig` field of a `frag_meta` record by masking with `USHORT_MAX`.
- **Inputs**:
    - `sig`: An unsigned long integer representing the signal from which the event ID is extracted.
- **Logic and Control Flow**:
    - Apply a bitwise AND operation between `sig` and `USHORT_MAX` to isolate the lower 16 bits of `sig`.
    - Cast the result of the bitwise operation to an unsigned integer (`uint`).
- **Output**: Returns the event ID as an unsigned integer (`uint`) extracted from the lower 16 bits of `sig`.


---
### fd\_quic\_log\_rx\_tail<!-- {{#callable:fd_quic_log_rx_tail}} -->
[View Source →](<../../../../../../src/waltz/quic/log/fd_quic_log_user.h#L98>)

Reads the last record from a sequence of log entries based on a given index.
- **Inputs**:
    - `rx`: A pointer to a `fd_quic_log_rx_t` structure, which contains parameters for accessing the log.
    - `idx`: An unsigned long integer representing the index of the record to read, relative to the most recent record.
- **Logic and Control Flow**:
    - Calculate the sequence number `seq` by querying the current sequence from `rx->mcache_seq`, subtracting 1, and then subtracting `idx`.
    - Compute the line index using `fd_mcache_line_idx` with the calculated `seq` and `rx->depth`.
    - Return a pointer to the log record at the computed line index in `rx->mcache`.
- **Output**: A pointer to a `fd_frag_meta_t` structure representing the log record at the specified index.


# Function Declarations (Public API)

---
### fd\_quic\_log\_rx\_leave<!-- {{#callable_declaration:fd_quic_log_rx_leave}} -->
[View Source →](<../../../../../../src/waltz/quic/log/fd_quic_log_user.h#L56>)

Leaves a local consumer-side join to a QUIC log.
- **Description**: Use this function to leave a consumer-side join to a QUIC log. This function resets the log structure to zero, effectively leaving the join. It must be called when the log is no longer needed to ensure proper cleanup. The function handles a null input by logging a warning and returning null.
- **Inputs**:
    - `log`: A pointer to an `fd_quic_log_rx_t` structure representing the consumer-side join to a QUIC log. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns the input `log` pointer after resetting its contents to zero, or null if the input was null.
- **See Also**: [`fd_quic_log_rx_leave`](<fd_quic_log.c.md#fd_quic_log_rx_leave>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)