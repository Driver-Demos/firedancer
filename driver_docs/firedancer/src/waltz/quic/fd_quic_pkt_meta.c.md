<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for initializing, inserting, removing, and managing QUIC packet metadata in a treap data structure.

# Purpose
The code provides functionality for managing packet metadata in a QUIC (Quick UDP Internet Connections) protocol implementation. It includes functions to initialize, insert, remove, and query packet metadata within a data structure. The primary data structure used is a treap, which is a combination of a binary search tree and a heap, allowing efficient insertion, deletion, and access operations. The code defines several functions to handle packet metadata, such as [`fd_quic_pkt_meta_tracker_init`](<#fd_quic_pkt_meta_tracker_init>), which initializes a packet metadata tracker for different encryption levels, and [`fd_quic_pkt_meta_insert`](<#fd_quic_pkt_meta_insert>), which inserts packet metadata into the data structure.

The code also includes functions for removing packet metadata, either individually or within a specified range, as seen in [`fd_quic_pkt_meta_remove`](<#fd_quic_pkt_meta_remove>) and [`fd_quic_pkt_meta_remove_range`](<#fd_quic_pkt_meta_remove_range>). Additionally, it provides utility functions like [`fd_quic_pkt_meta_min`](<#fd_quic_pkt_meta_min>) to find the minimum packet metadata element and [`fd_quic_pkt_meta_ds_clear`](<#fd_quic_pkt_meta_ds_clear>) to clear metadata for a specific encryption level. The code is intended to be part of a larger QUIC protocol library, providing essential operations for managing packet metadata efficiently. It does not define public APIs or external interfaces directly but rather offers internal functionality to be used within the QUIC protocol implementation.
# Imports and Dependencies

---
- `fd_quic_pkt_meta.h`


# Functions

---
### fd\_quic\_pkt\_meta\_tracker\_init<!-- {{#callable:fd_quic_pkt_meta_tracker_init}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L3>)

Initializes a QUIC packet metadata tracker by setting up metadata treaps for each encryption level and assigning a pool of packet metadata.
- **Inputs**:
    - `tracker`: A pointer to an `fd_quic_pkt_meta_tracker_t` structure that will be initialized.
    - `total_meta_cnt`: The total number of metadata entries to allocate for each encryption level.
    - `pool`: A pointer to an array of `fd_quic_pkt_meta_t` structures that will be used as the pool for packet metadata.
- **Logic and Control Flow**:
    - Iterates over four encryption levels (0 to 3).
    - For each encryption level, calls `fd_quic_pkt_meta_treap_new` to initialize a treap with `total_meta_cnt` entries.
    - Joins the treap using `fd_quic_pkt_meta_treap_join`.
    - Checks if the memory allocation was successful; if not, returns `NULL`.
    - Assigns the `pool` to the `tracker->pool`.
    - Returns the initialized `tracker`.
- **Output**: A pointer to the initialized `fd_quic_pkt_meta_tracker_t` structure, or `NULL` if initialization fails.


---
### fd\_quic\_pkt\_meta\_ds\_init\_pool<!-- {{#callable:fd_quic_pkt_meta_ds_init_pool}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L18>)

Initializes a pool of QUIC packet metadata with a seeded treap structure.
- **Inputs**:
    - ``pool``: A pointer to the `fd_quic_pkt_meta_t` structure that represents the pool of packet metadata to initialize.
    - ``total_meta_cnt``: The total number of metadata entries to initialize in the pool.
- **Logic and Control Flow**:
    - Calls the function `fd_quic_pkt_meta_treap_seed` with the `pool`, `total_meta_cnt`, and a seed value obtained from `fd_tickcount()`.
- **Output**: No return value; the function initializes the provided pool in place.


---
### fd\_quic\_pkt\_meta\_insert<!-- {{#callable:fd_quic_pkt_meta_insert}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L24>)

Inserts a packet metadata element into a data structure using a treap-based method.
- **Inputs**:
    - ``ds``: A pointer to the `fd_quic_pkt_meta_ds_t` data structure where the packet metadata will be inserted.
    - ``pkt_meta``: A pointer to the `fd_quic_pkt_meta_t` packet metadata element to insert.
    - ``pool``: A pointer to the `fd_quic_pkt_meta_t` pool used for managing packet metadata elements.
- **Logic and Control Flow**:
    - Calls the function `fd_quic_pkt_meta_treap_ele_insert` with the provided data structure `ds`, packet metadata `pkt_meta`, and pool `pool`.
- **Output**: No output is returned as the function has a `void` return type.


---
### fd\_quic\_pkt\_meta\_remove\_range<!-- {{#callable:fd_quic_pkt_meta_remove_range}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L32>)

Removes packet metadata entries within a specified range from a data structure and returns the count of removed entries.
- **Inputs**:
    - `ds`: A pointer to the `fd_quic_pkt_meta_ds_t` data structure from which packet metadata entries will be removed.
    - `pool`: A pointer to the `fd_quic_pkt_meta_t` pool used for managing packet metadata entries.
    - `pkt_number_lo`: The lower bound of the packet number range for entries to be removed.
    - `pkt_number_hi`: The upper bound of the packet number range for entries to be removed.
- **Logic and Control Flow**:
    - Initialize a forward iterator `l_iter` to the first entry in `ds` with a packet number greater than or equal to `pkt_number_lo`.
    - Initialize `prev` to `NULL` and `cnt_removed` to 0.
    - Iterate over the entries starting from `l_iter` until the iterator is done or the packet number exceeds `pkt_number_hi`.
    - For each entry, if `prev` is not `NULL`, remove the entry from the data structure and release it back to the pool, then increment `cnt_removed`.
    - Set `prev` to the current entry.
    - After the loop, if `prev` is not `NULL`, remove the last entry from the data structure and release it back to the pool, then increment `cnt_removed`.
- **Output**: Returns the number of packet metadata entries removed from the data structure.
- **Functions Called**:
    - [`fd_quic_pkt_meta_ds_idx_ge`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_idx_ge>)
    - [`fd_quic_pkt_meta_ds_fwd_iter_done`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_done>)
    - [`fd_quic_pkt_meta_ds_fwd_iter_next`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_next>)
    - [`fd_quic_pkt_meta_ds_fwd_iter_ele`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_ele>)


---
### fd\_quic\_pkt\_meta\_remove<!-- {{#callable:fd_quic_pkt_meta_remove}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L62>)

Removes a packet metadata element from a data structure and releases it back to the pool.
- **Inputs**:
    - `ds`: A pointer to the `fd_quic_pkt_meta_ds_t` data structure from which the packet metadata will be removed.
    - `pool`: A pointer to the `fd_quic_pkt_meta_t` pool where the packet metadata will be released.
    - `pkt_meta`: A pointer to the `fd_quic_pkt_meta_t` packet metadata element to be removed and released.
- **Logic and Control Flow**:
    - Calls `fd_quic_pkt_meta_treap_ele_remove` to remove the `pkt_meta` from the data structure `ds`.
    - Calls `fd_quic_pkt_meta_pool_ele_release` to release the `pkt_meta` back to the `pool`.
- **Output**: No output is returned as the function has a `void` return type.


---
### fd\_quic\_pkt\_meta\_min<!-- {{#callable:fd_quic_pkt_meta_min}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L70>)

Finds and returns the minimum packet metadata element from a data structure.
- **Inputs**:
    - ``ds``: A pointer to the `fd_quic_pkt_meta_ds_t` data structure from which to find the minimum packet metadata.
    - ``pool``: A pointer to the `fd_quic_pkt_meta_t` pool used for managing packet metadata elements.
- **Logic and Control Flow**:
    - Initialize a forward iterator `iter` using [`fd_quic_pkt_meta_ds_fwd_iter_init`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_init>) with `ds` and `pool`.
    - Check if the iterator `iter` is done using [`fd_quic_pkt_meta_ds_fwd_iter_done`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_done>); if true, return `NULL`.
    - Return the element pointed to by the iterator `iter` using [`fd_quic_pkt_meta_ds_fwd_iter_ele`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_ele>).
- **Output**: A pointer to the minimum `fd_quic_pkt_meta_t` element in the data structure, or `NULL` if the data structure is empty.
- **Functions Called**:
    - [`fd_quic_pkt_meta_ds_fwd_iter_init`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_init>)
    - [`fd_quic_pkt_meta_ds_fwd_iter_done`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_done>)
    - [`fd_quic_pkt_meta_ds_fwd_iter_ele`](<fd_quic_pkt_meta.h.md#fd_quic_pkt_meta_ds_fwd_iter_ele>)


---
### fd\_quic\_pkt\_meta\_ds\_clear<!-- {{#callable:fd_quic_pkt_meta_ds_clear}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic_pkt_meta.c#L79>)

Clears the packet metadata treap for a specified encryption level in the tracker.
- **Inputs**:
    - `tracker`: A pointer to `fd_quic_pkt_meta_tracker_t`, which contains the packet metadata treaps for different encryption levels.
    - `enc_level`: An unsigned integer representing the encryption level whose packet metadata treap needs to be cleared.
- **Logic and Control Flow**:
    - Retrieve the maximum number of elements (`ele_max`) in the packet metadata treap for the specified encryption level using `fd_quic_pkt_meta_treap_ele_max`.
    - Reinitialize the packet metadata treap for the specified encryption level with `fd_quic_pkt_meta_treap_new`, using the retrieved `ele_max`.
- **Output**: No output is returned as the function is of type `void`.



---
Made with ❤️ by [Driver](https://www.driver.ai/)