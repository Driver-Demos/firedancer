<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Partial implementation of the QUIC protocol with non-blocking, single-threaded API, memory management, and lifecycle functions.

# Purpose
The `fd_quic.h` file is a C header file that defines a partial implementation of the QUIC protocol, which is an encrypted, multiplexing transport layer network protocol. This implementation supports IPv4 over Ethernet and is designed to be non-blocking and single-threaded. The file provides a comprehensive API for managing QUIC connections, including lifecycle management, configuration, and service operations. It includes structures and functions for memory management, connection handling, stream operations, and callback mechanisms to notify users of events. The implementation aims to comply with RFC 9000 and RFC 9001 standards.

Key components of the file include the `fd_quic_t` structure, which represents a QUIC object, and associated structures like `fd_quic_limits_t`, `fd_quic_layout_t`, and `fd_quic_config_t` that define memory layout, limits, and configuration options. The file also defines a set of user-provided callbacks for handling connection and stream events, as well as metrics for monitoring performance and network activity. The API includes functions for initializing, joining, and managing QUIC connections, as well as sending and receiving data streams. The header file is intended to be included in other C source files to provide QUIC functionality within a larger application.
# Imports and Dependencies

---
- `fd_quic_common.h`
- `fd_quic_enum.h`
- `../aio/fd_aio.h`
- `../tls/fd_tls.h`
- `../../util/clock/fd_clock.h`
- `../../util/hist/fd_histf.h`
- `fd_quic_conn.h`
- `fd_quic_stream.h`


# Data Structures

---
### fd\_quic\_conn\_t
- **Type**: ``struct``
- **Members**:
    - ``fd_quic_conn_t``: A forward declaration for a structure representing a QUIC connection.
- **Description**: `fd_quic_conn_t` is a forward declaration for a structure that represents a QUIC connection in the Firedancer QUIC implementation. The actual structure definition is not provided in the given code, indicating that it is likely defined elsewhere. This structure is used in various callback functions and connection management functions within the QUIC API.


---
### fd\_quic\_stream\_t
- **Type**: ``struct``
- **Members**:
    - `fd_quic_stream_t`: A forward declaration for a structure representing a QUIC stream.
- **Description**: The `fd_quic_stream_t` is a forward declaration for a structure that represents a QUIC stream in the QUIC protocol implementation. It is used in the context of managing streams within a QUIC connection, allowing for operations such as creating new streams, sending data, and finalizing streams. The actual structure definition is not provided in the given code, indicating that it is defined elsewhere, likely in the `fd_quic_stream.h` file included at the end of the header.


---
### fd\_quic\_limits
- **Type**: ``struct``
- **Members**:
    - ``conn_cnt``: Maximum number of concurrent connections allowed instance-wide.
    - ``handshake_cnt``: Maximum number of concurrent handshakes allowed instance-wide.
    - ``log_depth``: Depth of the shared memory log cache instance-wide.
    - ``conn_id_cnt``: Maximum number of connection IDs allowed per connection, with a minimum of 4.
    - ``stream_id_cnt``: Maximum number of concurrent stream IDs allowed per connection.
    - ``inflight_frame_cnt``: Total maximum number of inflight frames allowed instance-wide.
    - ``min_inflight_frame_cnt_conn``: Minimum number of inflight frames allowed per connection.
    - ``tx_buf_sz``: Size of the transmission buffer in bytes per stream.
    - ``stream_pool_cnt``: Number of streams in the stream pool instance-wide.
- **Description**: Defines the limits for various parameters of a QUIC instance, including connection and stream counts, handshake limits, and buffer sizes. These limits are immutable and determine the memory layout and resource allocation for a QUIC object throughout its lifecycle.


---
### fd\_quic\_limits\_t
- **Type**: ``struct``
- **Members**:
    - ``conn_cnt``: Maximum number of concurrent connections instance-wide.
    - ``handshake_cnt``: Maximum number of concurrent handshakes instance-wide.
    - ``log_depth``: Depth of shared memory log cache instance-wide.
    - ``conn_id_cnt``: Maximum number of connection IDs per connection.
    - ``stream_id_cnt``: Maximum number of concurrent stream IDs per connection.
    - ``inflight_frame_cnt``: Total maximum number of inflight frames instance-wide.
    - ``min_inflight_frame_cnt_conn``: Minimum number of inflight frames per connection.
    - ``tx_buf_sz``: Size of the transmit buffer per stream in bytes.
    - ``stream_pool_cnt``: Number of streams in the stream pool instance-wide.
- **Description**: Defines the memory layout limits for an `fd_quic_t` object, specifying various constraints such as the maximum number of connections, handshakes, and streams, as well as buffer sizes and frame counts. These limits are immutable and remain valid for the lifetime of an `fd_quic_t` instance, ensuring consistent resource allocation and management.


---
### fd\_quic\_layout
- **Type**: ``struct``
- **Members**:
    - `meta_sz`: Size of this struct.
    - `log_off`: Offset to `quic_log`.
    - `conns_off`: Offset of connection memory region.
    - `conn_footprint`: Size of a connection.
    - `conn_map_off`: Offset of connection map memory region.
    - `lg_slot_cnt`: See `conn_map_new`.
    - `hs_pool_off`: Offset of the handshake pool.
    - `stream_pool_off`: Offset of the stream pool.
    - `svc_timers_off`: Offset of the service timers.
    - `pkt_meta_pool_off`: Offset of the packet metadata pool.
- **Description**: Describes the memory layout of an `fd_quic_t` object, providing offsets and sizes for various components such as connection memory regions, handshake pools, and service timers. This layout is derived from `fd_quic_limits_t` and is used to manage the memory structure of QUIC objects.


---
### fd\_quic\_layout\_t
- **Type**: ``struct``
- **Members**:
    - ``meta_sz``: Size of this struct.
    - ``log_off``: Offset to `quic_log`.
    - ``conns_off``: Offset of connection memory region.
    - ``conn_footprint``: Size of a connection.
    - ``conn_map_off``: Offset of connection map memory region.
    - ``lg_slot_cnt``: See `conn_map_new`.
    - ``hs_pool_off``: Offset of the handshake pool.
    - ``stream_pool_off``: Offset of the stream pool.
    - ``svc_timers_off``: Offset of the service timers.
    - ``pkt_meta_pool_off``: Offset of the packet metadata pool.
- **Description**: Describes the memory layout of an `fd_quic_t` object, derived from `fd_quic_limits_t`, providing offsets and sizes for various components within the QUIC object.


---
### fd\_quic\_config
- **Type**: ``struct``
- **Members**:
    - ``role``: Specifies the role of the QUIC instance, either client or server.
    - ``retry``: Indicates if address validation using retry packets is enabled.
    - ``idle_timeout``: Defines the upper bound on connection idle timeout.
    - ``keep_alive``: Determines if QUIC PING frames are used to keep connections alive.
    - ``ack_delay``: Specifies the median delay on outgoing ACKs.
    - ``ack_threshold``: Sets the threshold for sending an ACK based on unacknowledged stream bytes.
    - ``retry_ttl``: Defines the time-to-live for retry tokens.
    - ``tls_hs_ttl``: Specifies the time-to-live for TLS handshake.
    - ``identity_public_key``: Holds the Ed25519 public key of the node identity.
    - ``sign``: Pointer to a callback function for signing TLS 1.3 certificate verify payload.
    - ``sign_ctx``: Pointer to the context used in the signing callback.
    - ``keylog_file``: Stores the path to the keylog file for logging encryption secrets.
    - ``initial_rx_max_stream_data``: Specifies the maximum stream data size for receiving, set by the user.
    - ``net.dscp``: Defines the Differentiated Services Code Point for outgoing IPv4 packets.
- **Description**: Defines the mutable configuration for a QUIC instance, including protocol, TLS, and network settings. The configuration is immutable during an active join and includes parameters such as role, retry settings, timeouts, and network configurations. It also includes TLS-specific settings like the public key and signing function, as well as network-specific settings like the DSCP value.


---
### fd\_quic\_callbacks
- **Type**: ``struct``
- **Members**:
    - ``quic_ctx``: User-provided context pointer for instance-wide callbacks.
    - ``conn_new``: Callback for when a new connection is received and handshakes are completed.
    - ``conn_hs_complete``: Callback for when a client completes a handshake of a connection it created.
    - ``conn_final``: Callback for connection termination notification.
    - ``stream_notify``: Callback for notable stream events.
    - ``stream_rx``: Callback for receiving data on a stream.
    - ``tls_keylog``: Callback for when a new encryption secret becomes available, nullable.
- **Description**: Defines a set of user-provided callbacks that the QUIC library invokes to notify the user of various events, such as new connections, handshake completions, connection terminations, stream events, and TLS key logging. The structure includes function pointers for each callback, with some requiring a user-provided context pointer (`quic_ctx`) and others using a stream-specific context (`stream_ctx`).


---
### fd\_quic\_callbacks\_t
- **Type**: ``struct``
- **Members**:
    - ``quic_ctx``: User-provided context pointer for instance-wide callbacks.
    - ``conn_new``: Callback for when a server receives a new connection and completes handshakes.
    - ``conn_hs_complete``: Callback for when a client completes a handshake of a connection it created.
    - ``conn_final``: Callback for connection termination notification.
    - ``stream_notify``: Callback for signaling a notable stream event.
    - ``stream_rx``: Callback for receiving data on a stream.
    - ``tls_keylog``: Callback for when a new encryption secret becomes available.
- **Description**: Defines a set of user-provided callbacks that the QUIC library invokes to notify the user of various events, such as new connections, handshake completions, connection terminations, stream events, and TLS key logging. These callbacks are reset on leave and are essential for handling QUIC protocol events in a non-blocking, single-threaded environment.


---
### fd\_quic\_metrics
- **Type**: ``union``
- **Members**:
    - ``net_rx_pkt_cnt``: Number of IP packets received.
    - ``net_rx_byte_cnt``: Total bytes received, including IP, UDP, and QUIC headers.
    - ``net_tx_pkt_cnt``: Number of IP packets sent.
    - ``net_tx_byte_cnt``: Total bytes sent.
    - ``retry_tx_cnt``: Number of Retry packets sent.
    - ``conn_alloc_cnt``: Number of connections currently allocated.
    - ``conn_created_cnt``: Number of connections created.
    - ``conn_closed_cnt``: Number of connections gracefully closed.
    - ``conn_aborted_cnt``: Number of connections aborted.
    - ``conn_timeout_cnt``: Number of connections timed out.
    - ``conn_retry_cnt``: Number of connections established with retry.
    - ``conn_err_no_slots_cnt``: Number of connections that failed to create due to lack of slots.
    - ``conn_err_retry_fail_cnt``: Number of connections that failed during retry, e.g., invalid token.
    - ``conn_state_cnt``: Current number of connections in each state.
    - ``pkt_net_hdr_err_cnt``: Number of packets dropped due to weird IPv4/UDP headers.
    - ``pkt_quic_hdr_err_cnt``: Number of packets dropped due to weird QUIC header.
    - ``pkt_undersz_cnt``: Number of QUIC packets dropped due to being too small.
    - ``pkt_oversz_cnt``: Number of QUIC packets dropped due to being too large.
    - ``pkt_decrypt_fail_cnt``: Number of packets that failed decryption due to auth tag.
    - ``pkt_no_key_cnt``: Number of packets that failed decryption due to missing key.
    - ``pkt_no_conn_cnt``: Number of packets with unknown connection ID (initial, retry, hs, 1-RTT).
    - ``frame_tx_alloc_cnt``: Number of packet metadata allocation successes, fails for empty pool, fails at connection max.
    - ``pkt_verneg_cnt``: Number of QUIC version negotiation packets or packets with wrong version.
    - ``pkt_retransmissions_cnt``: Number of packet metadata retries.
    - ``initial_token_len_cnt``: Number of Initial packets grouped by token length.
    - ``frame_rx_cnt``: Number of frames received, indexed by implementation-defined IDs.
    - ``frame_rx_err_cnt``: Number of frames failed.
    - ``hs_created_cnt``: Number of handshake flows created.
    - ``hs_err_alloc_fail_cnt``: Number of handshakes dropped due to allocation failure.
    - ``hs_evicted_cnt``: Number of handshakes evicted.
    - ``stream_opened_cnt``: Number of streams opened.
    - ``stream_closed_cnt``: Number of streams closed, indexed by `FD_QUIC_STREAM_NOTIFY_{...}`.
    - ``stream_active_cnt``: Number of active streams.
    - ``stream_rx_event_cnt``: Number of stream RX events.
    - ``stream_rx_byte_cnt``: Total stream payload bytes received.
    - ``ack_tx``: ACK transmission metrics.
    - ``service_duration``: Time spent in service.
    - ``receive_duration``: Time spent in process_packet calls.
- **Description**: The `fd_quic_metrics` union is a comprehensive data structure that encapsulates various metrics related to network, connection, packet, frame, handshake, stream, acknowledgment, and performance aspects of a QUIC implementation. It includes counters for received and transmitted packets and bytes, connection states and errors, packet errors and retransmissions, frame reception and errors, handshake creation and failures, stream activities, and performance durations. This union provides a detailed overview of the QUIC protocol's operational metrics, facilitating monitoring and analysis of its performance and reliability.


---
### fd\_quic\_metrics\_t
- **Type**: ``union``
- **Members**:
    - ``net_rx_pkt_cnt``: Number of IP packets received.
    - ``net_rx_byte_cnt``: Total bytes received, including IP, UDP, and QUIC headers.
    - ``net_tx_pkt_cnt``: Number of IP packets sent.
    - ``net_tx_byte_cnt``: Total bytes sent.
    - ``retry_tx_cnt``: Number of Retry packets sent.
    - ``conn_alloc_cnt``: Number of connections currently allocated.
    - ``conn_created_cnt``: Number of connections created.
    - ``conn_closed_cnt``: Number of connections gracefully closed.
    - ``conn_aborted_cnt``: Number of connections aborted.
    - ``conn_timeout_cnt``: Number of connections timed out.
    - ``conn_retry_cnt``: Number of connections established with retry.
    - ``conn_err_no_slots_cnt``: Number of connections that failed to create due to lack of slots.
    - ``conn_err_retry_fail_cnt``: Number of connections that failed during retry.
    - ``conn_state_cnt``: Current number of connections in each state.
    - ``pkt_net_hdr_err_cnt``: Number of packets dropped due to incorrect IPv4/UDP headers.
    - ``pkt_quic_hdr_err_cnt``: Number of packets dropped due to incorrect QUIC header.
    - ``pkt_undersz_cnt``: Number of QUIC packets dropped for being too small.
    - ``pkt_oversz_cnt``: Number of QUIC packets dropped for being too large.
    - ``pkt_decrypt_fail_cnt``: Number of packets that failed decryption due to authentication tag.
    - ``pkt_no_key_cnt``: Number of packets that failed decryption due to missing key.
    - ``pkt_no_conn_cnt``: Number of packets with unknown connection ID.
    - ``frame_tx_alloc_cnt``: Number of packet metadata allocation successes and failures.
    - ``pkt_verneg_cnt``: Number of QUIC version negotiation packets or packets with wrong version.
    - ``pkt_retransmissions_cnt``: Number of packet metadata retries.
    - ``initial_token_len_cnt``: Number of Initial packets grouped by token length.
    - ``frame_rx_cnt``: Number of frames received, indexed by implementation-defined IDs.
    - ``frame_rx_err_cnt``: Number of frames failed.
    - ``hs_created_cnt``: Number of handshake flows created.
    - ``hs_err_alloc_fail_cnt``: Number of handshakes dropped due to allocation failure.
    - ``hs_evicted_cnt``: Number of handshakes evicted.
    - ``stream_opened_cnt``: Number of streams opened.
    - ``stream_closed_cnt``: Number of streams closed, indexed by notification type.
    - ``stream_active_cnt``: Number of active streams.
    - ``stream_rx_event_cnt``: Number of stream RX events.
    - ``stream_rx_byte_cnt``: Total stream payload bytes received.
    - ``ack_tx``: ACK transmission metrics.
    - ``service_duration``: Time spent in service.
    - ``receive_duration``: Time spent in process_packet calls.
- **Description**: `fd_quic_metrics_t` is a union that contains a structure for tracking various metrics related to QUIC operations, including network, connection, packet, frame, handshake, stream, and performance metrics. These metrics help monitor the performance and status of QUIC connections, such as the number of packets sent and received, connection states, and stream activities.


---
### fd\_quic
- **Type**: ``struct``
- **Members**:
    - ``magic``: A unique identifier for the `fd_quic` structure, expected to be `FD_QUIC_MAGIC`.
    - ``layout``: Defines the memory layout of the `fd_quic` object, position-independent and read-only.
    - ``limits``: Specifies immutable limits for the `fd_quic` object, position-independent and read-only.
    - ``config``: Holds mutable configuration settings for the `fd_quic` object, writable before initialization.
    - ``cb``: Contains user-provided callbacks, position-dependent and reset on join, writable before initialization.
    - ``metrics``: Tracks various metrics related to network, connection, packet, and performance, position-independent and read-only.
    - ``aio_rx``: Represents the local asynchronous I/O (AIO) for receiving data.
    - ``aio_tx``: Represents the remote asynchronous I/O (AIO) for transmitting data.
- **Description**: The `fd_quic` structure is a partial implementation of the QUIC protocol, designed for encrypted, multiplexing transport layer communication. It supports IPv4 over Ethernet and is non-blocking and single-threaded. The structure includes fields for configuration, callbacks, and metrics, and it manages memory layout and limits for QUIC operations. The `fd_quic` structure is pre-allocated and position-independent, allowing for efficient memory management and separation of allocation and runtime use. It is designed to be compliant with RFC 9000 and RFC 9001, and it supports scaling through multiple instances and RX flow steering.


# Function Declarations (Public API)

---
### fd\_quic\_align<!-- {{#callable_declaration:fd_quic_align}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L382>)

Returns the required memory alignment for a QUIC object.
- **Description**: Use this function to determine the alignment requirement for memory regions intended to store QUIC objects. This is necessary when allocating memory to ensure that the memory is correctly aligned for the QUIC implementation. The function does not require any parameters and can be called at any time to retrieve the alignment value.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the required memory alignment for a QUIC object.
- **See Also**: [`fd_quic_align`](<fd_quic.c.md#fd_quic_align>)  (Implementation)


---
### fd\_quic\_footprint<!-- {{#callable_declaration:fd_quic_footprint}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L396>)

Calculates the memory footprint required for a QUIC object.
- **Description**: Use this function to determine the size of the memory region needed to allocate a QUIC object based on the specified limits. This is essential before allocating memory for a QUIC object to ensure that the memory region is appropriately sized. The function requires a valid `fd_quic_limits_t` structure as input, which defines the constraints and capacities of the QUIC object. If the input is invalid, the function will return 0, indicating an error in calculating the footprint.
- **Inputs**:
    - `limits`: A pointer to a constant `fd_quic_limits_t` structure that specifies the limits and constraints for the QUIC object. This parameter must not be null, and it should be properly initialized with valid values. If the input is invalid, the function returns 0.
- **Output**: Returns the size in bytes of the memory footprint required for the QUIC object. If the input is invalid, returns 0.
- **See Also**: [`fd_quic_footprint`](<fd_quic.c.md#fd_quic_footprint>)  (Implementation)


---
### fd\_quic\_new<!-- {{#callable_declaration:fd_quic_new}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L405>)

Formats a memory region for use as a QUIC client or server.
- **Description**: Use this function to prepare a pre-allocated memory region for a QUIC object, ensuring it meets the required alignment and footprint. This function must be called before any other operations on the QUIC object. The memory region must be correctly aligned, and the limits must be valid and non-null. If any of these conditions are not met, the function will return NULL.
- **Inputs**:
    - `mem`: A non-null pointer to a pre-allocated memory region. The memory must be aligned according to the requirements of the QUIC object. If the pointer is null or misaligned, the function returns NULL.
    - `limits`: A non-null pointer to a `fd_quic_limits_t` structure that defines the configuration limits for the QUIC object. The structure must have valid values, such as non-zero connection and handshake counts. If the pointer is null or contains invalid values, the function returns NULL.
- **Output**: Returns a pointer to the formatted QUIC object on success, or NULL if the input parameters are invalid.
- **See Also**: [`fd_quic_new`](<fd_quic.c.md#fd_quic_new>)  (Implementation)


---
### fd\_quic\_join<!-- {{#callable_declaration:fd_quic_join}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L421>)

Joins the caller to a QUIC object.
- **Description**: Use this function to join a caller to a QUIC object by providing a pointer to the memory region backing the QUIC object. This function performs basic coherence checks to ensure the memory region is correctly formatted as a QUIC object. It returns a typed pointer to the QUIC object on success. Ensure that the memory region is properly aligned and initialized before calling this function. Each successful join should have a corresponding leave to maintain proper lifecycle management.
- **Inputs**:
    - `shquic`: A pointer to the first byte of the memory region backing the QUIC object in the caller's address space. Must not be null and must be aligned according to `FD_QUIC_ALIGN`. If the pointer is null or misaligned, the function returns null and logs a warning.
- **Output**: Returns a pointer to the `fd_quic_t` object on success, or null if the input is invalid or the memory region is not correctly formatted.
- **See Also**: [`fd_quic_join`](<fd_quic.c.md#fd_quic_join>)  (Implementation)


---
### fd\_quic\_leave<!-- {{#callable_declaration:fd_quic_leave}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L429>)

Leaves a current local join and returns the given QUIC object.
- **Description**: Use this function to leave a current local join of a QUIC object and free all dynamically managed resources associated with it. This function should be called when you no longer need to interact with the QUIC object in the current context. It is important to ensure that the `quic` parameter is not null and that there is an active join before calling this function. If these conditions are not met, the function will return null and log details of the failure.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` object representing the current local join. Must not be null and must have an active join. If invalid, the function returns null and logs details.
- **Output**: Returns the given `quic` pointer on success, or null on failure.
- **See Also**: [`fd_quic_leave`](<fd_quic.c.md#fd_quic_leave>)  (Implementation)


---
### fd\_quic\_delete<!-- {{#callable_declaration:fd_quic_delete}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L438>)

Unformats a memory region used as a QUIC object.
- **Description**: Use this function to unformat a memory region previously used as a `fd_quic_t` object. Ensure that no threads are joined to the QUIC object before calling this function. This function transfers ownership of the memory region back to the caller. It returns the given pointer on success or NULL if the input is invalid, such as when the pointer does not refer to a properly formatted QUIC object.
- **Inputs**:
    - `quic`: A pointer to a `fd_quic_t` object. Must not be NULL and must be aligned according to `fd_quic_align()`. The object must have a valid magic number (`FD_QUIC_MAGIC`). If the pointer is NULL, misaligned, or has an invalid magic number, the function logs a warning and returns NULL.
- **Output**: Returns the input pointer on success, or NULL if the input is invalid.
- **See Also**: [`fd_quic_delete`](<fd_quic.c.md#fd_quic_delete>)  (Implementation)


---
### fd\_quic\_get\_aio\_net\_rx<!-- {{#callable_declaration:fd_quic_get_aio_net_rx}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L465>)

Returns the AIO base class for receiving network data.
- **Description**: Use this function to obtain the asynchronous I/O (AIO) base class associated with a QUIC instance for receiving network data. This function provides access to the AIO object that handles incoming network data for the QUIC instance. The returned pointer is valid for the lifetime of the QUIC instance. Ensure that any operations on the AIO object are performed by the thread that has exclusive access to the QUIC instance.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` instance. This must not be null and must point to a valid, initialized QUIC instance. The caller must ensure exclusive access to the QUIC instance when using the returned AIO object.
- **Output**: A pointer to the `fd_aio_t` object used for receiving network data, valid for the lifetime of the QUIC instance.
- **See Also**: [`fd_quic_get_aio_net_rx`](<fd_quic.c.md#fd_quic_get_aio_net_rx>)  (Implementation)


---
### fd\_quic\_set\_aio\_net\_tx<!-- {{#callable_declaration:fd_quic_set_aio_net_tx}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L471>)

Sets the asynchronous I/O network transmission interface for a QUIC instance.
- **Description**: Use this function to specify the `fd_aio_t` interface that the QUIC instance will use to send data to the network driver. This function should be called before the QUIC instance is finalized. If `aio_tx` is null, the function clears the current transmission interface. This function does not return a value and does not modify the QUIC instance in any other way.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` instance. This must not be null and should point to a valid QUIC instance that is not yet finalized.
    - `aio_tx`: A pointer to a constant `fd_aio_t` structure that defines the asynchronous I/O network transmission interface. If null, the current transmission interface is cleared.
- **Output**: None
- **See Also**: [`fd_quic_set_aio_net_tx`](<fd_quic.c.md#fd_quic_set_aio_net_tx>)  (Implementation)


---
### fd\_quic\_init<!-- {{#callable_declaration:fd_quic_init}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L488>)

Initializes a QUIC object for use.
- **Description**: Use this function to prepare a `fd_quic_t` object for operation. It must be called after configuring the QUIC object with valid settings and before any service or connection operations. The function requires exclusive access to the QUIC object during initialization. It returns the initialized QUIC object on success or NULL if the configuration is invalid or if an error occurs during initialization. Ensure that all necessary external objects, such as AIO and callbacks, are set up before calling this function.
- **Inputs**:
    - `quic`: A pointer to a `fd_quic_t` object that must be properly configured before calling this function. The caller retains ownership and must ensure the pointer is not NULL. Invalid configurations will result in a NULL return value.
- **Output**: Returns the initialized `fd_quic_t` object on success, or NULL if initialization fails due to invalid configuration or other errors.
- **See Also**: [`fd_quic_init`](<fd_quic.c.md#fd_quic_init>)  (Implementation)


---
### fd\_quic\_fini<!-- {{#callable_declaration:fd_quic_fini}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L495>)

Releases resources and resets a QUIC instance.
- **Description**: Use this function to release exclusive access to a QUIC instance and free any resources allocated during initialization. It resets references to external objects and zeroes out memory regions associated with the QUIC state. This function should be called when the QUIC instance is no longer needed, ensuring that all connections are properly closed and resources are cleaned up. It is important to pass a valid pointer to a previously initialized QUIC instance.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` instance. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns the same `fd_quic_t` pointer passed in, or null if the input was null.
- **See Also**: [`fd_quic_fini`](<fd_quic.c.md#fd_quic_fini>)  (Implementation)


---
### fd\_quic\_conn\_close<!-- {{#callable_declaration:fd_quic_conn_close}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L526>)

Initiates an asynchronous shutdown of a QUIC connection.
- **Description**: Use this function to start the process of closing a QUIC connection. It is important to note that this function does not immediately close the connection but schedules it for closure. The function should be called when you want to terminate a connection and notify the peer with a specific reason code. It is safe to call this function on a connection in any state except for invalid, dead, or aborted states, where it will have no effect. The function ensures that the connection is serviced promptly to handle the closure process.
- **Inputs**:
    - `conn`: A pointer to the `fd_quic_conn_t` connection object to close. Must not be null. If null, the function returns immediately without performing any action.
    - `reason`: An unsigned integer representing the application-specific reason code for closing the connection. This code is sent to the peer in a CONNECTION_CLOSE frame, if possible.
- **Output**: None
- **See Also**: [`fd_quic_conn_close`](<fd_quic.c.md#fd_quic_conn_close>)  (Implementation)


---
### fd\_quic\_conn\_let\_die<!-- {{#callable_declaration:fd_quic_conn_let_die}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L543>)

Stops keeping a connection alive after a specified duration.
- **Description**: Use this function to disable the keep-alive behavior for a connection after a specified duration. It is safe to call this function on a connection in any state. If called multiple times, only the latest call will be effective, but it may not take effect if a keep-alive was already skipped due to a previous call. To undo a previous call, pass `ULONG_MAX` as the duration. This function does not guarantee immediate closure of the connection after the duration; it only stops the keep-alive behavior.
- **Inputs**:
    - `conn`: A pointer to the `fd_quic_conn_t` connection object. Must not be null.
    - `keep_alive_duration_ns`: The duration in nanoseconds after which to stop keeping the connection alive. Passing `ULONG_MAX` undoes a previous call.
    - `now`: The current time in nanoseconds. Used to calculate when to stop the keep-alive behavior.
- **Output**: None
- **See Also**: [`fd_quic_conn_let_die`](<fd_quic.c.md#fd_quic_conn_let_die>)  (Implementation)


---
### fd\_quic\_get\_next\_wakeup<!-- {{#callable_declaration:fd_quic_get_next_wakeup}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L553>)

Returns the next requested service time for a QUIC instance.
- **Description**: Use this function to obtain the next time at which the QUIC instance requires servicing. This is useful for scheduling purposes, particularly in unit tests where precise timing control is needed. Ensure that the `quic` parameter is a valid pointer to an initialized `fd_quic_t` instance. The function does not modify the state of the QUIC instance.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` instance. Must not be null and should point to a valid, initialized QUIC instance. The function does not alter the state of the instance.
- **Output**: Returns a `long` representing the next service time in nanoseconds.
- **See Also**: [`fd_quic_get_next_wakeup`](<fd_quic.c.md#fd_quic_get_next_wakeup>)  (Implementation)


---
### fd\_quic\_service<!-- {{#callable_declaration:fd_quic_service}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L562>)

Services the next QUIC connection at each service level.
- **Description**: Use this function to process the next QUIC connection, handling operations such as stream transmission, ACK transmission, and timeouts. It is important to call this function frequently to ensure timely processing of connections. The function returns the number of connections serviced, with a return value of 0 indicating that no work was done during the call. Ensure that the QUIC object is properly initialized and that the calling thread has exclusive access to it.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` object representing the QUIC instance to be serviced. Must not be null and must be properly initialized.
    - `now`: A `long` integer representing the current time in nanoseconds. Used to update the internal state and manage timeouts.
- **Output**: Returns an `int` representing the number of connections serviced. A return value of 0 indicates that no connections were serviced during the call.
- **See Also**: [`fd_quic_service`](<fd_quic.c.md#fd_quic_service>)  (Implementation)


---
### fd\_quic\_state\_validate<!-- {{#callable_declaration:fd_quic_state_validate}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L571>)

Validates the state of a QUIC instance.
- **Description**: Use this function to check the integrity of a QUIC instance's state. It ensures that the service queue and free list invariants are maintained, such as the absence of cycles in linked lists. This function is intended for testing purposes and will log warnings or errors and terminate the process if any checks fail. It should be called when you need to verify the correctness of the QUIC state, typically during development or debugging.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` instance. This must not be null and should point to a valid QUIC instance whose state you want to validate. The caller retains ownership of the pointer.
- **Output**: None
- **See Also**: [`fd_quic_state_validate`](<fd_quic.c.md#fd_quic_state_validate>)  (Implementation)


---
### fd\_quic\_stream\_send<!-- {{#callable_declaration:fd_quic_stream_send}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L606>)

Sends data over a QUIC stream.
- **Description**: Use this function to send a specified amount of data over an existing QUIC stream. Ensure that the stream is in a valid state for sending and that the connection is active. The function checks for flow control limits and stream state before sending. If the `fin` parameter is set, it indicates that this is the final data to be sent on the stream. Call this function after creating a stream with `fd_quic_conn_new_stream` or obtaining a stream through a callback.
- **Inputs**:
    - `stream`: A pointer to the `fd_quic_stream_t` representing the stream to send data on. Must not be null and must be in a valid state for sending.
    - `data`: A pointer to the data buffer to send. The buffer must contain at least `data_sz` bytes. Ignored if `data_sz` is 0.
    - `data_sz`: The number of bytes to send from the data buffer. Must not exceed the available buffer space or flow control limits.
    - `fin`: An integer flag indicating if this is the final data to be sent on the stream. Set to a non-zero value to indicate the end of the stream.
- **Output**: Returns 0 on success. On failure, returns a negative error code indicating the type of error, such as invalid stream or connection state.
- **See Also**: [`fd_quic_stream_send`](<fd_quic.c.md#fd_quic_stream_send>)  (Implementation)


---
### fd\_quic\_stream\_fin<!-- {{#callable_declaration:fd_quic_stream_fin}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L618>)

Signals the end of data transmission on a stream.
- **Description**: Use this function to indicate that no more data will be sent from the local side of a stream to the peer. This function should be called only once per stream, unless the end of transmission was already indicated using the `fin` parameter in `fd_quic_stream_send`. It is important to ensure that the stream is in a valid state for finalization before calling this function.
- **Inputs**:
    - `stream`: A pointer to an `fd_quic_stream_t` object representing the stream to finalize. Must not be null. The stream must be in a state that allows finalization.
- **Output**: None
- **See Also**: [`fd_quic_stream_fin`](<fd_quic.c.md#fd_quic_stream_fin>)  (Implementation)


---
### fd\_quic\_process\_packet<!-- {{#callable_declaration:fd_quic_process_packet}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L621>)

Processes a QUIC packet for a given QUIC instance.
- **Description**: Use this function to process a QUIC packet received by a specific QUIC instance. It is important to ensure that the `quic` instance is properly initialized and that the `data` buffer contains a valid QUIC packet of size `data_sz`. The function is non-blocking and should be called from the thread that has exclusive access to the `quic` instance. The `now` parameter should represent the current time in nanoseconds, which is used for processing the packet. This function also updates internal metrics related to packet processing duration.
- **Inputs**:
    - `quic`: A pointer to an `fd_quic_t` instance. Must not be null and must be properly initialized before calling this function. The caller retains ownership.
    - `data`: A pointer to a buffer containing the QUIC packet data. Must not be null and should point to a valid memory region of at least `data_sz` bytes. The caller retains ownership.
    - `data_sz`: The size of the data buffer in bytes. Must be a valid size for a QUIC packet.
    - `now`: The current time in nanoseconds. Used for processing the packet and updating metrics.
- **Output**: None
- **See Also**: [`fd_quic_process_packet`](<fd_quic.c.md#fd_quic_process_packet>)  (Implementation)


---
### fd\_quic\_tx\_buffered\_raw<!-- {{#callable_declaration:fd_quic_tx_buffered_raw}} -->
[View Source →](<../../../../../src/waltz/quic/fd_quic.h#L628>)

Transmits a raw QUIC packet over the network.
- **Description**: Use this function to send a raw QUIC packet from a pre-initialized `fd_quic_t` instance. Ensure that the `tx_buf` contains the payload data and that `tx_ptr_ptr` points to the end of this data. The function prepares the packet with the specified source and destination IP addresses and UDP ports, and updates the IPv4 ID. It returns a status code indicating success or failure. Call this function only when the QUIC instance is properly initialized and configured.
- **Inputs**:
    - `quic`: A pointer to an initialized `fd_quic_t` instance. Must not be null.
    - `tx_ptr_ptr`: A pointer to a pointer to the current end of the data in `tx_buf`. Must not be null.
    - `tx_buf`: A buffer containing the payload data to be sent. Must not be null and should have enough space for the packet header.
    - `ipv4_id`: A pointer to a ushort representing the IPv4 ID. Must not be null. The function increments this value.
    - `dst_ipv4_addr`: The destination IPv4 address in network byte order.
    - `dst_udp_port`: The destination UDP port in host byte order.
    - `src_ipv4_addr`: The source IPv4 address in network byte order.
    - `src_udp_port`: The source UDP port in host byte order.
- **Output**: Returns a uint status code: `FD_QUIC_SUCCESS` on success, `FD_QUIC_FAILED` on failure. The function resets `tx_ptr_ptr` to `tx_buf` on failure.
- **See Also**: [`fd_quic_tx_buffered_raw`](<fd_quic.c.md#fd_quic_tx_buffered_raw>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)