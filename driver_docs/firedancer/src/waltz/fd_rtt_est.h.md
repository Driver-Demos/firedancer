<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

API for estimating round trip time (RTT) for packet transmissions using RFC 9002 guidelines.

# Purpose
The `fd_rtt_est.h` file is a C header file that provides an API for estimating the round-trip time (RTT) of packet transmissions to a single destination. It defines a structure, `fd_rtt_estimate_t`, which holds various RTT metrics such as `latest_rtt`, `min_rtt`, `smoothed_rtt`, and `var_rtt`, along with a validity flag `is_rtt_valid`. The file includes a function, [`fd_rtt_sample`](<#fd_rtt_sample>), which updates these metrics based on new RTT samples, adjusting for any acknowledgment delay reported by the peer. The calculations follow guidelines from RFC 9002 Section 5, ensuring that the RTT estimates are robust against potential inaccuracies in the acknowledgment delay.
# Imports and Dependencies

---
- `../util/bits/fd_bits.h`
- `math.h`


# Data Structures

---
### fd\_rtt\_estimate
- **Type**: ``struct``
- **Members**:
    - `latest_rtt`: Stores the latest round-trip time (RTT) sample in nanoseconds.
    - `min_rtt`: Holds the smallest end-to-end RTT observed, considered trusted.
    - `smoothed_rtt`: Contains the exponentially moving average (EMA) of recent RTT samples.
    - `var_rtt`: Represents the EMA of the variance of RTT samples.
    - `is_rtt_valid`: Indicates whether at least one valid RTT sample exists.
- **Description**: Estimates round-trip time (RTT) for packet transmissions to a single destination, using various metrics such as the latest RTT sample, the minimum observed RTT, and smoothed averages of RTT and its variance. The structure also includes a validity flag to confirm the presence of at least one valid RTT sample.


---
### fd\_rtt\_estimate\_t
- **Type**: ``struct``
- **Members**:
    - `latest_rtt`: Stores the latest round-trip time (RTT) sample in nanoseconds.
    - `min_rtt`: Holds the smallest end-to-end RTT observed, considered trusted.
    - `smoothed_rtt`: Represents the exponentially weighted moving average (EMA) of recent RTT samples.
    - `var_rtt`: Contains the EMA of the variance of RTT samples.
    - `is_rtt_valid`: Indicates whether at least one valid RTT sample exists.
- **Description**: Calculates and maintains round-trip time (RTT) estimates for packet transmissions to a single destination, using samples to update metrics such as the latest RTT, minimum RTT, smoothed RTT, and variance of RTT, in accordance with RFC 9002 Section 5.


# Functions

---
### fd\_rtt\_sample<!-- {{#callable:fd_rtt_sample}} -->
[View Source →](<../../../../src/waltz/fd_rtt_est.h#L28>)

Adds a round-trip time (RTT) sample to the RTT estimate, updating the latest, minimum, smoothed, and variance RTT values.
- **Inputs**:
    - `est`: A pointer to an `fd_rtt_estimate_t` structure that holds the current RTT estimates.
    - `latest_rtt`: The duration elapsed since a request was sent and a corresponding reply was received, measured in arbitrary units.
    - `ack_delay`: The duration that the peer delayed the reply after receiving the request, reported by the peer.
- **Logic and Control Flow**:
    - Retrieve the previous minimum RTT from `est->min_rtt` if RTT is valid, otherwise use `FLT_MAX`.
    - Update `est->min_rtt` with the minimum of the previous minimum RTT and `latest_rtt`.
    - Calculate the adjusted RTT (`adj_rtt`) as the maximum of `est->min_rtt` and `latest_rtt - ack_delay`.
    - Set `est->latest_rtt` to `adj_rtt`.
    - If RTT is not valid, initialize `est->smoothed_rtt` and `est->var_rtt` with `adj_rtt`, and set `est->is_rtt_valid` to 1.
    - If RTT is valid, update `est->smoothed_rtt` using an exponential moving average with `adj_rtt`.
    - Calculate the sample variance `var_rtt_sample` as the absolute difference between `est->smoothed_rtt` and `adj_rtt`.
    - Update `est->var_rtt` using an exponential moving average with `var_rtt_sample`.
- **Output**: Updates the `fd_rtt_estimate_t` structure with new values for `latest_rtt`, `min_rtt`, `smoothed_rtt`, and `var_rtt`.



---
Made with ❤️ by [Driver](https://www.driver.ai/)