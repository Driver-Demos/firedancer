<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests and benchmarks for secp256r1 scalar, field, and point operations, including verification.

# Purpose
The code is a C program designed to test and benchmark various cryptographic operations related to the `secp256r1` elliptic curve. It includes functions to test scalar operations such as conversion from bytes, multiplication, and inversion, as well as field operations like square root calculation. Additionally, it tests point operations on the elliptic curve, including conversion from bytes and equality checks. The program also verifies digital signatures using the `secp256r1` curve. Each test function includes a benchmarking section that measures the performance of the operations by executing them multiple times and logging the results.

The program is structured as an executable with a [`main`](<#main>) function that initializes a random number generator and calls each test function. The test functions use helper functions like `fd_hex_decode` to convert hexadecimal strings to byte arrays and `FD_TEST` to assert the correctness of operations. The [`log_bench`](<#log_bench>) function is used to log the performance metrics of each operation. The program includes necessary headers and uses specific data types and functions from the `fd_ballet` and `fd_secp256r1_private` libraries, indicating that it is part of a larger cryptographic library or framework.
# Imports and Dependencies

---
- `../fd_ballet.h`
- `fd_secp256r1_private.h`
- `../hex/fd_hex.h`


# Functions

---
### log\_bench<!-- {{#callable:log_bench}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L5>)

Logs the performance metrics of a benchmark test, including the rate of iterations per second per core and the average time per call.
- **Inputs**:
    - ``descr``: A constant character pointer that describes the benchmark being logged.
    - ``iter``: An unsigned long integer representing the number of iterations performed in the benchmark.
    - ``dt``: A long integer representing the total time taken for the benchmark in microseconds.
- **Logic and Control Flow**:
    - Calculate `khz` as the number of iterations per second per core by multiplying 1,000,000 by the ratio of `iter` to `dt`.
    - Calculate `tau` as the average time per call by dividing `dt` by `iter`.
    - Log the description, iterations per second per core, and average time per call using `FD_LOG_NOTICE`.
- **Output**: No return value; the function logs the performance metrics to a logging system.


---
### test\_secp256r1\_scalar\_frombytes<!-- {{#callable:test_secp256r1_scalar_frombytes}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L14>)

Tests the conversion of byte arrays to secp256r1 scalar values and benchmarks the conversion functions.
- **Inputs**:
    - `rng`: A pointer to a random number generator object, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize a 64-byte array `_sig` and decode a hexadecimal string into it using `fd_hex_decode`.
    - Declare a scalar variable `_r` and a pointer `r` pointing to it.
    - Test the function [`fd_secp256r1_scalar_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes>) by checking if it returns the pointer `r` when converting the first 32 bytes of `sig`.
    - Test the function [`fd_secp256r1_scalar_frombytes_positive`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes_positive>) by checking if it returns the pointer `r` when converting the second 32 bytes of `sig`.
    - Test the function [`fd_secp256r1_scalar_frombytes_positive`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes_positive>) by checking if it returns `NULL` when converting the first 32 bytes of `sig`.
    - Benchmark the [`fd_secp256r1_scalar_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes>) function by running it 1,000,000 times and logging the performance.
    - Benchmark the [`fd_secp256r1_scalar_frombytes_positive`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes_positive>) function by running it 1,000,000 times and logging the performance.
- **Output**: No output is returned from this function as it is a test function.
- **Functions Called**:
    - [`fd_secp256r1_scalar_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes>)
    - [`fd_secp256r1_scalar_frombytes_positive`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes_positive>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_scalar\_mul<!-- {{#callable:test_secp256r1_scalar_mul}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L47>)

Tests the multiplication of two secp256r1 scalars and benchmarks the operation.
- **Inputs**:
    - `rng`: Unused random number generator pointer.
- **Logic and Control Flow**:
    - Initialize a buffer `buf` and scalar variables `r`, `a`, `b`, and `e`.
    - Decode hexadecimal strings into `a`, `b`, and `e` using `fd_hex_decode` and [`fd_secp256r1_scalar_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes>).
    - Perform scalar multiplication of `a` and `b` using [`fd_secp256r1_scalar_mul`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_mul>) and store the result in `r`.
    - Verify the result by comparing `r` with `e` using `FD_TEST` and `fd_memeq`.
    - Benchmark the scalar multiplication by running it 100,000 times and logging the performance using [`log_bench`](<#log_bench>).
- **Output**: No return value; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_secp256r1_scalar_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes>)
    - [`fd_secp256r1_scalar_mul`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_mul>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_scalar\_inv<!-- {{#callable:test_secp256r1_scalar_inv}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L76>)

Tests the inversion of a secp256r1 scalar and benchmarks the inversion operation.
- **Inputs**:
    - `rng`: A pointer to a random number generator, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize a buffer `_buf` of 32 bytes and a pointer `buf` to it.
    - Declare scalar variables `_r`, `a`, and `e` for storing intermediate results.
    - Decode a hexadecimal string into `buf` and convert it to a scalar `a`.
    - Decode another hexadecimal string into `buf` and convert it to a scalar `e`.
    - Compute the inverse of scalar `a` and store the result in `r`.
    - Verify that the computed inverse `r` matches the expected scalar `e` using `FD_TEST` and `fd_memeq`.
    - Benchmark the inversion operation by repeating it 10,000 times and logging the performance.
- **Output**: No output is returned; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_secp256r1_scalar_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_frombytes>)
    - [`fd_secp256r1_scalar_inv`](<fd_secp256r1_s2n.c.md#fd_secp256r1_scalar_inv>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_fp\_frombytes<!-- {{#callable:test_secp256r1_fp_frombytes}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L103>)

Tests the conversion of a byte array to a field element in the secp256r1 curve and benchmarks the conversion function.
- **Inputs**:
    - `rng`: A pointer to a random number generator, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize a 32-byte buffer `_buf` and set `buf` to point to it.
    - Decode a hexadecimal string into the buffer `buf` using `fd_hex_decode`.
    - Declare a field element `_r` and set `r` to point to it.
    - Test the [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>) function by checking if it returns the same pointer `r` when converting `buf` to a field element.
    - Benchmark the [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>) function by running it 1,000,000 times and logging the performance using [`log_bench`](<#log_bench>).
- **Output**: No output is returned from this function as it is a void function.
- **Functions Called**:
    - [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_fp\_sqrt<!-- {{#callable:test_secp256r1_fp_sqrt}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L124>)

Tests the square root function for secp256r1 finite field elements and benchmarks its performance.
- **Inputs**:
    - `rng`: A pointer to a random number generator, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize two 32-byte arrays `_sqrt0` and `_sqrt1` with hexadecimal values using `fd_hex_decode`.
    - Declare variables `r` and `a` of type `fd_secp256r1_fp_t` to store finite field elements.
    - Convert the byte array `sqrt1` to a finite field element `a` using [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>) and verify the conversion with `FD_TEST`.
    - Attempt to compute the square root of `a` using [`fd_secp256r1_fp_sqrt`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_sqrt>) and verify that the result is `NULL` with `FD_TEST`.
    - Convert the byte array `sqrt0` to a finite field element `a` using [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>) and verify the conversion with `FD_TEST`.
    - Attempt to compute the square root of `a` using [`fd_secp256r1_fp_sqrt`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_sqrt>) and verify that the result is `r` with `FD_TEST`.
    - Benchmark the [`fd_secp256r1_fp_sqrt`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_sqrt>) function by running it 10,000 times and logging the performance using [`log_bench`](<#log_bench>).
- **Output**: No output is returned as the function is void and primarily performs tests and benchmarking.
- **Functions Called**:
    - [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>)
    - [`fd_secp256r1_fp_sqrt`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_sqrt>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_point\_frombytes<!-- {{#callable:test_secp256r1_point_frombytes}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L152>)

Tests the [`fd_secp256r1_point_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_frombytes>) function by decoding hexadecimal strings into byte arrays and verifying the conversion of these bytes into elliptic curve points.
- **Inputs**:
    - `rng`: An unused random number generator pointer, marked with `FD_FN_UNUSED` to indicate it is not used in the function.
- **Logic and Control Flow**:
    - Initialize a 33-byte array `_pub` and a pointer `pub` to it, and a `fd_secp256r1_point_t` array `_r` and a pointer `r` to it.
    - Decode a hexadecimal string into the `pub` array using `fd_hex_decode` and test if [`fd_secp256r1_point_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_frombytes>) returns `NULL` for invalid points.
    - Repeat the above step with different hexadecimal strings to test various cases, including valid and invalid points.
    - Perform a benchmark by calling [`fd_secp256r1_point_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_frombytes>) in a loop for a set number of iterations and log the performance using [`log_bench`](<#log_bench>).
- **Output**: No output is returned as the function is a test function that uses assertions to verify correctness.
- **Functions Called**:
    - [`fd_secp256r1_point_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_frombytes>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_point\_eq\_x<!-- {{#callable:test_secp256r1_point_eq_x}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L186>)

Tests the equality of a secp256r1 elliptic curve point's x-coordinate with a given field element x.
- **Inputs**:
    - `rng`: A pointer to a random number generator, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize a 33-byte array `_pub` and a pointer `pub` to it, a `fd_secp256r1_point_t` array `_r` and a pointer `r` to it, and a `fd_secp256r1_fp_t` array `x`.
    - Decode a 32-byte hexadecimal string into `pub` and convert it to a field element `x`.
    - Decode a 33-byte hexadecimal string into `pub` and convert it to a point `r`.
    - Set the z-coordinate of `r` to zero and test if `fd_secp256r1_point_eq_x(r, x)` returns failure.
    - Modify the x-coordinate of `r` to an invalid value and test if `fd_secp256r1_point_eq_x(r, x)` returns failure.
    - Test if `fd_secp256r1_point_eq_x(r, x)` returns success with valid `r` and `x`.
    - Benchmark the [`fd_secp256r1_point_eq_x`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_eq_x>) function by running it 10,000 times and logging the performance.
- **Output**: No output is returned; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_secp256r1_fp_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_frombytes>)
    - [`fd_secp256r1_point_frombytes`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_frombytes>)
    - [`fd_secp256r1_fp_set`](<fd_secp256r1_s2n.c.md#fd_secp256r1_fp_set>)
    - [`fd_secp256r1_point_eq_x`](<fd_secp256r1_s2n.c.md#fd_secp256r1_point_eq_x>)
    - [`log_bench`](<#log_bench>)


---
### test\_secp256r1\_verify<!-- {{#callable:test_secp256r1_verify}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L225>)

Tests the [`fd_secp256r1_verify`](<fd_secp256r1.c.md#fd_secp256r1_verify>) function for correctness, malleability, and performance.
- **Inputs**:
    - `rng`: Unused random number generator pointer.
- **Logic and Control Flow**:
    - Initializes message, signature, and public key buffers with zero values.
    - Tests the correctness of the [`fd_secp256r1_verify`](<fd_secp256r1.c.md#fd_secp256r1_verify>) function by decoding specific hex strings into message, signature, and public key buffers and verifying them.
    - Tests the malleability of the [`fd_secp256r1_verify`](<fd_secp256r1.c.md#fd_secp256r1_verify>) function by using a different message and signature and checking for failure and success cases.
    - Performs a benchmark test by running the [`fd_secp256r1_verify`](<fd_secp256r1.c.md#fd_secp256r1_verify>) function 1000 times and logs the performance metrics.
- **Output**: No output is returned; the function uses assertions to validate the verification process and logs performance metrics.
- **Functions Called**:
    - [`fd_secp256r1_verify`](<fd_secp256r1.c.md#fd_secp256r1_verify>)
    - [`log_bench`](<#log_bench>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/secp256r1/test_secp256r1.c#L284>)

Initializes the environment, runs a series of tests on secp256r1 cryptographic functions, logs the results, and then halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Creates a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Executes a series of test functions for secp256r1 cryptographic operations, each using the `rng`.
    - Logs a notice message indicating the tests passed.
    - Calls `fd_halt` to terminate the program.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_secp256r1_scalar_frombytes`](<#test_secp256r1_scalar_frombytes>)
    - [`test_secp256r1_scalar_mul`](<#test_secp256r1_scalar_mul>)
    - [`test_secp256r1_scalar_inv`](<#test_secp256r1_scalar_inv>)
    - [`test_secp256r1_fp_frombytes`](<#test_secp256r1_fp_frombytes>)
    - [`test_secp256r1_fp_sqrt`](<#test_secp256r1_fp_sqrt>)
    - [`test_secp256r1_point_frombytes`](<#test_secp256r1_point_frombytes>)
    - [`test_secp256r1_point_eq_x`](<#test_secp256r1_point_eq_x>)
    - [`test_secp256r1_verify`](<#test_secp256r1_verify>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)