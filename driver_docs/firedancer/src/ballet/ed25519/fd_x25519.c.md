<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements constant-time X25519 elliptic curve operations for secure key exchange.

# Purpose
The code implements the X25519 key exchange protocol, which is a cryptographic algorithm used for secure key exchange based on elliptic curve Diffie-Hellman (ECDH). The code provides functions to perform scalar multiplication on the Montgomery form of the elliptic curve, specifically designed for the X25519 protocol. It includes constant-time operations to prevent timing attacks, ensuring that the execution time does not depend on the input values. The main components include the [`fd_x25519_montgomery_ladder`](<#fd_fn_sensitivefd_x25519_montgomery_ladder>) function, which performs the core scalar multiplication using a Montgomery ladder approach, and the `fd_x25519_exchange` function, which facilitates the key exchange process by computing a shared secret from a private key and a peer's public key.

The code is structured to support both scalar and vectorized implementations, with conditional compilation directives to optimize for different hardware capabilities, such as AVX and AVX-512. It defines public APIs for generating public keys (`fd_x25519_public`) and performing key exchanges (`fd_x25519_exchange`). The code also includes mechanisms to sanitize sensitive data from memory after use, enhancing security by preventing residual data from being accessed. The implementation adheres to the specifications outlined in RFC 7748, ensuring compatibility and security in cryptographic operations.
# Imports and Dependencies

---
- `fd_x25519.h`
- `fd_f25519.h`


# Global Variables

---
### fd\_x25519\_basepoint
- **Type**: ``static const uchar[32]``
- **Description**: A 32-byte array that represents the base point for the X25519 elliptic curve Diffie-Hellman key exchange protocol. The array is initialized with the value 9, which is the standard base point for X25519 operations.
- **Use**: Used as the base point in X25519 scalar multiplication operations for cryptographic key exchange.


# Functions

---
### fd\_x25519\_is\_zero\_const\_time<!-- {{#callable:FD_FN_SENSITIVE::fd_x25519_is_zero_const_time}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_x25519.c#L20>)

Checks if a 32-byte array is all zeros in constant time.
- **Inputs**:
    - `point`: A constant pointer to an array of 32 unsigned characters (`uchar`) representing the point to check.
- **Logic and Control Flow**:
    - Initialize `is_zero` to 1, assuming the array is all zeros.
    - Iterate over each byte in the `point` array.
    - For each byte, perform a logical AND operation between `is_zero` and the negation of the byte value.
    - If any byte is non-zero, `is_zero` becomes 0.
    - Return the value of `is_zero`.
- **Output**: Returns 1 if all bytes in the `point` array are zero, otherwise returns 0.


---
### fd\_x25519\_montgomery\_ladder<!-- {{#callable:FD_FN_SENSITIVE::fd_x25519_montgomery_ladder}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_x25519.c#L116>)

Performs the X25519 Montgomery ladder operation for elliptic curve scalar multiplication.
- **Inputs**:
    - ``x2``: Pointer to `fd_f25519_t` where the resulting x-coordinate will be stored.
    - ``z2``: Pointer to `fd_f25519_t` where the resulting z-coordinate will be stored.
    - ``x1``: Pointer to a constant `fd_f25519_t` representing the input x-coordinate.
    - ``secret_scalar``: Pointer to a constant `uchar` array representing the secret scalar used in the operation.
- **Logic and Control Flow**:
    - Declare and initialize variables `U`, `Q`, and `P` using `FD_R43X6_QUAD_DECL` and `FD_R43X6_QUAD_PACK` macros.
    - Initialize `Q` and `U` with specific values, including `x1->el` for `U` and `Q`.
    - Reduce `x1` using `FD_R43X6_QUAD_FOLD_SIGNED` for both `U` and `Q`.
    - Initialize `swap` and `k_t` to zero and declare `perm`, `AA`, `E`, `F`, `G`, `H`, and `GG`.
    - Iterate over bits of `secret_scalar` from 254 to 0, performing bitwise operations to determine `k_t` and update `swap`.
    - Use `wwl_if` and `wwl_permute` to conditionally swap elements of `Q` based on `swap`.
    - Perform a series of arithmetic operations using `FD_R43X6_QUAD_*` macros to compute intermediate values `A`, `B`, `C`, `D`, `BB`, `DA`, `CB`, `E`, `H`, and `GG`.
    - Pack results into `P` and `Q` using `FD_R43X6_QUAD_PACK` and `FD_R43X6_QUAD_FOLD_UNSIGNED`.
    - After the loop, perform a final conditional swap on `Q` using `wwl_if` and `wwl_permute`.
    - Unpack the final results into `x2->el` and `z2->el` using `FD_R43X6_QUAD_UNPACK`.
    - Sanitize sensitive data by setting memory areas to zero using `fd_memset_explicit`.
- **Output**: The function outputs the x and z coordinates of the resulting point in the Montgomery ladder operation, stored in `x2` and `z2` respectively.
- **Functions Called**:
    - [`fd_r43x6_scale_fast`](<avx512/fd_r43x6.h.md#fd_r43x6_scale_fast>)
    - [`fd_r43x6_sqr_fast`](<avx512/fd_r43x6.h.md#fd_r43x6_sqr_fast>)


---
### fd\_x25519\_scalar\_mul\_const\_time<!-- {{#callable:FD_FN_SENSITIVE::fd_x25519_scalar_mul_const_time}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_x25519.c#L212>)

Performs constant-time scalar multiplication on a point using the X25519 elliptic curve protocol.
- **Inputs**:
    - `out`: A 32-byte array to store the result of the scalar multiplication.
    - `secret_scalar`: A pointer to a 32-byte array representing the secret scalar used in the multiplication.
    - `point_x`: A pointer to an `fd_f25519_t` structure representing the x-coordinate of the point to multiply.
- **Logic and Control Flow**:
    - Initialize `fd_f25519_t` arrays `x2` and `z2` to store intermediate results.
    - Call [`fd_x25519_montgomery_ladder`](<#fd_fn_sensitivefd_x25519_montgomery_ladder>) to perform the Montgomery ladder operation using `point_x` and `secret_scalar`, storing results in `x2` and `z2`.
    - Compute the modular inverse of `z2` and store it back in `z2`.
    - Multiply `x2` by the inverse of `z2` to obtain the final x-coordinate of the result.
    - Convert the result in `x2` to a byte array and store it in `out`.
- **Output**: A 32-byte array in `out` containing the x-coordinate of the resulting point after scalar multiplication.
- **Functions Called**:
    - [`FD_FN_SENSITIVE::fd_x25519_montgomery_ladder`](<#fd_fn_sensitivefd_x25519_montgomery_ladder>)
    - [`fd_f25519_inv`](<fd_f25519.c.md#fd_f25519_inv>)
    - [`fd_f25519_mul`](<ref/fd_f25519.h.md#fd_f25519_mul>)
    - [`fd_f25519_tobytes`](<ref/fd_f25519.h.md#fd_f25519_tobytes>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)