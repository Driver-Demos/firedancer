<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Public API for Curve25519 scalar operations, including reduction, validation, and arithmetic functions.

# Purpose
The `fd_curve25519_scalar.h` file defines a public API for operations on Curve25519 scalars. It provides functions for scalar arithmetic, including reduction, validation, multiplication, addition, subtraction, negation, and inversion. The file includes constants representing specific scalar values such as zero, one, and minus one, which are used in various operations. The API is designed to handle 256-bit scalars, with operations typically involving 32-byte little-endian representations. The file also includes a function for computing the width-adaptive non-adjacent form (wNAF) of a scalar, which is useful in cryptographic computations.

The file is a C header file, intended to be included in other C source files that require Curve25519 scalar operations. It does not perform input argument checking, and the caller is responsible for ensuring the validity of inputs. The operations are not constant time, so they should not be used with secret data. The file uses inline functions for some operations to optimize performance, and it provides a batch inversion function for efficiently computing the inverses of multiple scalars. The header guards prevent multiple inclusions, ensuring that the definitions are only processed once during compilation.
# Imports and Dependencies

---
- `../fd_ballet_base.h`


# Global Variables

---
### fd\_curve25519\_scalar\_zero
- **Type**: ``uchar[32]``
- **Description**: An array of 32 unsigned characters, each initialized to zero. This array represents a scalar value of zero in the context of Curve25519 operations.
- **Use**: Used as a constant scalar value of zero in various scalar arithmetic operations within the Curve25519 API.


---
### fd\_curve25519\_scalar\_one
- **Type**: ``uchar[32]``
- **Description**: Represents a 32-byte array that encodes the scalar value 'one' in the Curve25519 scalar field. The array is initialized with the first byte set to 1 and the remaining bytes set to 0, representing the scalar value 1 in little-endian format.
- **Use**: Used in scalar arithmetic operations to represent the multiplicative identity in the Curve25519 scalar field.


---
### fd\_curve25519\_scalar\_minus\_one
- **Type**: ``static const uchar[32]``
- **Description**: Represents the constant value of the Curve25519 scalar `l-1`, where `l` is defined as `2^252 + 27742317777372353535851937790883648493`. This value is stored as a 32-byte array in little-endian format.
- **Use**: Used in scalar arithmetic operations to represent the value `l-1` in the Curve25519 scalar field.


# Functions

---
### fd\_curve25519\_scalar\_validate<!-- {{#callable:fd_curve25519_scalar_validate}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L57>)

Validates if a given 32-byte Ed25519 scalar is in its canonical form by comparing it to a predefined maximum value.
- **Inputs**:
    - `s`: A 32-byte array representing the Ed25519 scalar to validate.
- **Logic and Control Flow**:
    - Load the 32-byte scalar `s` into four 8-byte unsigned long integers `s0`, `s1`, `s2`, and `s3`.
    - Load the predefined maximum scalar value `fd_curve25519_scalar_minus_one` into four 8-byte unsigned long integers `l0`, `l1`, `l2`, and `l3`.
    - Compare `s3` with `l3`; if `s3` is less than `l3`, return `s`.
    - If `s3` equals `l3`, compare `s2` with `l2`; if `s2` is less than `l2`, return `s`.
    - If `s2` equals `l2`, compare `s1` with `l1`; if `s1` is less than `l1`, return `s`.
    - If `s1` equals `l1`, compare `s0` with `l0`; if `s0` is less than or equal to `l0`, return `s`.
    - If none of the above conditions are met, return `NULL`.
- **Output**: Returns the input scalar `s` if it is in canonical form, otherwise returns `NULL`.


---
### fd\_curve25519\_scalar\_mul<!-- {{#callable:fd_curve25519_scalar_mul}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L95>)

Computes the product of two 256-bit values modulo a large prime number.
- **Inputs**:
    - `s`: A pointer to a 32-byte array where the result will be stored.
    - `a`: A pointer to a 32-byte array representing the first 256-bit value.
    - `b`: A pointer to a 32-byte array representing the second 256-bit value.
- **Logic and Control Flow**:
    - Calls the [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) function with `s`, `a`, `b`, and `fd_curve25519_scalar_zero` as arguments.
    - The [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) function computes `(a * b + 0) mod l`, where `l` is a large prime number, and stores the result in `s`.
- **Output**: Returns a pointer to the 32-byte array `s` containing the result of the multiplication.
- **Functions Called**:
    - [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>)


---
### fd\_curve25519\_scalar\_add<!-- {{#callable:fd_curve25519_scalar_add}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L102>)

Computes the sum of two 256-bit scalars modulo a predefined large number.
- **Inputs**:
    - `s`: A pointer to a 32-byte array where the result will be stored.
    - `a`: A pointer to a 32-byte array representing the first scalar operand.
    - `b`: A pointer to a 32-byte array representing the second scalar operand.
- **Logic and Control Flow**:
    - Calls [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) with `s`, `a`, `fd_curve25519_scalar_one`, and `b` as arguments.
    - [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) computes the result of `(a * 1 + b) mod l`, where `l` is a large predefined constant.
- **Output**: Returns a pointer to the 32-byte array `s` containing the result of the addition.
- **Functions Called**:
    - [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>)


---
### fd\_curve25519\_scalar\_sub<!-- {{#callable:fd_curve25519_scalar_sub}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L109>)

Computes the subtraction of two Curve25519 scalars using modular arithmetic.
- **Inputs**:
    - `s`: A pointer to a 32-byte array where the result will be stored.
    - `a`: A pointer to a 32-byte array representing the first scalar operand.
    - `b`: A pointer to a 32-byte array representing the second scalar operand.
- **Logic and Control Flow**:
    - Calls [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) with `fd_curve25519_scalar_minus_one` as the multiplier for `b`, effectively negating `b` before adding it to `a`.
    - Stores the result of the operation in the memory location pointed to by `s`.
- **Output**: Returns a pointer to the 32-byte array `s` containing the result of the subtraction.
- **Functions Called**:
    - [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>)


---
### fd\_curve25519\_scalar\_neg<!-- {{#callable:fd_curve25519_scalar_neg}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L117>)

Computes the negation of a Curve25519 scalar by using the scalar multiplication and addition function.
- **Inputs**:
    - `s`: A pointer to a 32-byte array where the result will be stored.
    - `a`: A pointer to a 32-byte array representing the scalar to negate.
- **Logic and Control Flow**:
    - Calls [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) with `s`, `fd_curve25519_scalar_minus_one`, `a`, and `fd_curve25519_scalar_zero` as arguments.
    - The function [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>) computes the result as `(fd_curve25519_scalar_minus_one * a + fd_curve25519_scalar_zero) mod l`, effectively negating `a`.
- **Output**: Returns a pointer to the 32-byte array `s` containing the negated scalar.
- **Functions Called**:
    - [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>)


---
### fd\_curve25519\_scalar\_set<!-- {{#callable:fd_curve25519_scalar_set}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L124>)

Copies a 32-byte scalar value from source to destination.
- **Inputs**:
    - `s`: A pointer to the destination array where the scalar value will be copied.
    - `a`: A pointer to the source array containing the scalar value to copy.
- **Logic and Control Flow**:
    - Calls `fd_memcpy` to copy 32 bytes from the source array `a` to the destination array `s`.
- **Output**: Returns a pointer to the destination array `s`.


---
### fd\_curve25519\_scalar\_from\_u64<!-- {{#callable:fd_curve25519_scalar_from_u64}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L130>)

Converts a 64-bit unsigned integer to a 32-byte little-endian scalar representation.
- **Inputs**:
    - `s`: A pointer to an array of unsigned characters where the scalar representation will be stored.
    - `x`: A 64-bit unsigned integer to convert to a scalar representation.
- **Logic and Control Flow**:
    - Initialize the memory pointed to by `s` to zero for 32 bytes using `fd_memset`.
    - Store the 64-bit unsigned integer `x` into the first 8 bytes of the memory pointed to by `s`.
    - Return the pointer `s`.
- **Output**: A pointer to the 32-byte array `s` containing the scalar representation of the input integer.


---
### fd\_curve25519\_scalar\_inv<!-- {{#callable:fd_curve25519_scalar_inv}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L138>)

Computes the multiplicative inverse of a Curve25519 scalar using a series of multiplications based on the bits of -2.
- **Inputs**:
    - `s`: A pointer to a 32-byte array where the result will be stored.
    - `a`: A pointer to a 32-byte array representing the scalar to invert.
- **Logic and Control Flow**:
    - Copy the contents of `a` into `t` and `s` using `fd_memcpy`.
    - Square `t` and multiply `s` by `t` to handle the first two bits of -2.
    - Square `t` again to handle the third bit, which is 0.
    - Iterate from bit 3 to bit 252, squaring `t` in each iteration.
    - For each bit that is set in `fd_curve25519_scalar_minus_one`, multiply `s` by `t`.
- **Output**: Returns a pointer to the 32-byte array `s` containing the inverse of the scalar.
- **Functions Called**:
    - [`fd_curve25519_scalar_mul`](<#fd_curve25519_scalar_mul>)


---
### fd\_curve25519\_scalar\_batch\_inv<!-- {{#callable:fd_curve25519_scalar_batch_inv}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L166>)

Computes the batch inversion of multiple Curve25519 scalars and stores the result in the provided arrays.
- **Inputs**:
    - `s`: An array of size `32 * sz` to store the batch inverted scalars.
    - `allinv`: An array of size 32 to store the inversion of the product of all input scalars.
    - `a`: An array of size `32 * sz` containing the input scalars to be inverted.
    - `sz`: The number of scalars to process.
- **Logic and Control Flow**:
    - Initialize `acc` with the value of `fd_curve25519_scalar_one`.
    - Iterate over each scalar in `a`, copying the current value of `acc` to the corresponding position in `s` and updating `acc` by multiplying it with the current scalar.
    - Compute the inverse of `acc` and store it in `allinv`.
    - Iterate backwards over the scalars, updating each position in `s` by multiplying it with `acc` and updating `acc` by multiplying it with the current scalar.
- **Output**: The function does not return a value; it modifies the `s` and `allinv` arrays in place.
- **Functions Called**:
    - [`fd_curve25519_scalar_mul`](<#fd_curve25519_scalar_mul>)
    - [`fd_curve25519_scalar_inv`](<#fd_curve25519_scalar_inv>)


# Function Declarations (Public API)

---
### fd\_curve25519\_scalar\_reduce<!-- {{#callable_declaration:fd_curve25519_scalar_reduce}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L32>)

Reduces a 512-bit scalar modulo a specific large prime.
- **Description**: Use this function to reduce a 512-bit scalar to a 256-bit scalar modulo the large prime \( l = 2^{252} + 27742317777372353535851937790883648493 \). This function is useful when working with large numbers in cryptographic applications, particularly those involving Curve25519. The input scalar must be provided in a 64-byte little-endian format, and the result will be stored in a 32-byte little-endian format. The function does not perform input validation, so ensure that the input and output buffers are correctly allocated and sized before calling. The function allows in-place operations, meaning the input and output buffers can overlap.
- **Inputs**:
    - `out`: A 32-byte buffer where the reduced 256-bit scalar will be stored. The caller must ensure this buffer is properly allocated and has write access.
    - `in`: A 64-byte buffer containing the 512-bit scalar to be reduced, in little-endian format. The caller must ensure this buffer is properly allocated and has read access.
- **Output**: Returns a pointer to the `out` buffer, which contains the reduced 256-bit scalar.
- **See Also**: [`fd_curve25519_scalar_reduce`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_reduce>)  (Implementation)


---
### fd\_curve25519\_scalar\_muladd<!-- {{#callable_declaration:fd_curve25519_scalar_muladd}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_scalar.h#L89>)

Computes the modular addition of the product of two scalars and a third scalar.
- **Description**: Use this function to compute the result of the expression (a * b + c) mod l, where a, b, and c are 256-bit values represented in 32-byte little-endian format. The result is stored in the provided output buffer, which must be 32 bytes in size. This function does not perform input validation, so ensure that the input pointers are valid and point to properly formatted data. The operation is not constant time, so it should not be used with secret data.
- **Inputs**:
    - `s`: A 32-byte buffer where the result will be stored. The caller must ensure this buffer is valid and writable.
    - `a`: A pointer to a 32-byte buffer containing the first scalar in little-endian format. The caller must ensure this pointer is valid and readable.
    - `b`: A 32-byte buffer containing the second scalar in little-endian format. The caller must ensure this buffer is valid and readable.
    - `c`: A 32-byte buffer containing the third scalar in little-endian format. The caller must ensure this buffer is valid and readable.
- **Output**: Returns a pointer to the result buffer `s`, which contains the 256-bit result in 32-byte little-endian format.
- **See Also**: [`fd_curve25519_scalar_muladd`](<fd_curve25519_scalar.c.md#fd_curve25519_scalar_muladd>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)