<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Generates precomputation tables for Curve25519 and Ristretto255 used in cryptographic operations.

# Purpose
The code is a C program designed to generate precomputation tables for cryptographic operations involving Curve25519 and Ristretto255. These tables are stored in the `table/` directory and are used to optimize operations such as scalar multiplication in elliptic curve cryptography. The program includes functions to generate field constants and point tables, which are essential for efficient cryptographic computations. The tables are generated for different architectures, such as AVX512 and reference implementations, to ensure compatibility and performance across various systems.

The program defines several functions to create and write these tables to files. The [`field_tables_file`](<#field_tables_file>), [`point_tables_file`](<#point_tables_file>), and [`rangeproofs_tables_file`](<#rangeproofs_tables_file>) functions generate tables for field elements, elliptic curve points, and range proofs, respectively. The [`main`](<#main>) function orchestrates the generation process by calling these functions and writing the output to specific files based on the target architecture. The program also includes instructions for regenerating the tables, which involve compiling the code for different backends and running the generated unit tests. The generated files are marked as auto-generated and should not be modified manually.
# Imports and Dependencies

---
- `../fd_ballet.h`
- `fd_curve25519.h`
- `fd_ristretto255.h`
- `../hex/fd_hex.h`
- `stdio.h`


# Functions

---
### field\_constant<!-- {{#callable:field_constant}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L27>)

Generates a static constant field in C code from a given `fd_f25519_t` value and writes it to a file.
- **Inputs**:
    - ``file``: A pointer to a `FILE` object where the function writes the generated C code.
    - ``name``: A constant character pointer representing the name of the field to be generated.
    - ``value``: A pointer to an `fd_f25519_t` structure containing the value to be encoded and written as a static constant field.
- **Logic and Control Flow**:
    - Initializes a buffer `buf` of 32 unsigned characters and a `hex` string of 65 characters, setting `hex[64]` to 0 to ensure null-termination.
    - Encodes the `fd_f25519_t` value into a hexadecimal string using `fd_hex_encode` and `fd_f25519_tobytes`, storing the result in `hex`.
    - Writes a comment line to the file with the hexadecimal representation of the value.
    - Writes the declaration of a static constant `fd_f25519_t` array with the specified `name` to the file.
    - Writes the opening brace for the array initialization.
    - If `FD_HAS_AVX512` is defined, iterates over the first 6 elements of `value->el`, writing each as a 64-bit hexadecimal value to the file, followed by two zero values.
    - If `FD_HAS_AVX512` is not defined, iterates over the first 5 elements of `value->el`, writing each as a 64-bit hexadecimal value to the file.
    - Writes the closing brace for the array initialization and the closing brace for the static constant declaration.
    - Writes two newline characters to the file to separate this field from subsequent content.
- **Output**: No return value; the function writes the generated C code directly to the specified file.


---
### field\_tables\_file<!-- {{#callable:field_tables_file}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L54>)

Generates and writes precomputed field constants for Curve25519 operations to a file.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the function writes the precomputed field constants.
- **Logic and Control Flow**:
    - Declare and initialize an array `buf` of 32 unsigned characters for temporary storage.
    - Declare several `fd_f25519_t` variables to store field constants.
    - Decode hexadecimal strings into byte arrays and convert them into field elements using `fd_f25519_frombytes`.
    - Negate the field element `fd_f25519_k` to get `fd_f25519_minus_k`.
    - Write a predefined header to the file to indicate the file is auto-generated.
    - Iterate over the header array and write each line to the file using `fprintf`.
    - Call [`field_constant`](<#field_constant>) for each field constant to write its definition to the file.
- **Output**: Writes precomputed field constants for Curve25519 to the specified file.
- **Functions Called**:
    - [`field_constant`](<#field_constant>)


---
### point\_const<!-- {{#callable:point_const}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L128>)

Formats and writes the components of an `fd_ed25519_point_t` structure to a file in a specific format depending on the availability of AVX512 support.
- **Inputs**:
    - ``file``: A pointer to a `FILE` object where the function will write the formatted point data.
    - ``value``: A constant pointer to an `fd_ed25519_point_t` structure containing the point data to be formatted and written.
- **Logic and Control Flow**:
    - Checks if `FD_HAS_AVX512` is defined to determine the format of the output.
    - If `FD_HAS_AVX512` is defined, iterates over three arrays `P03`, `P14`, and `P25` in the `value` structure, each containing 8 elements, and writes them to the file in a specific format.
    - If `FD_HAS_AVX512` is not defined, iterates over four arrays `X->el`, `Y->el`, `T->el`, and `Z->el` in the `value` structure, each containing 5 elements, and writes them to the file in a different format.
- **Output**: No return value; the function writes formatted data to the specified file.


---
### points\_matrix<!-- {{#callable:points_matrix}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L170>)

Generates a static constant matrix of `fd_ed25519_point_t` points and writes it to a file.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the matrix will be written.
    - `name`: A constant character pointer representing the name of the matrix.
    - `values`: A 2D array of `fd_ed25519_point_t` structures containing the point values to be written.
    - `n`: An integer representing the number of rows in the matrix.
    - `m`: An integer representing the number of columns in the matrix.
- **Logic and Control Flow**:
    - Initializes a buffer `buf` of 32 bytes and a `hex` string of 65 characters, setting the last character of `hex` to 0.
    - Writes the matrix declaration to the file using `fprintf`, including the matrix name and dimensions `n` and `m`.
    - Iterates over each row `j` from 0 to `n-1`, writing a comment with the row index.
    - For each row, iterates over each column `k` from 0 to `m-1`, processing each point value.
    - Encodes each point value to a hexadecimal string using `fd_hex_encode` and writes a comment with the compressed point.
    - Writes the point value to the file by calling [`point_const`](<#point_const>) with the current point value.
    - Closes the row and column braces with `fprintf`.
    - Ends the matrix declaration with a closing brace and a newline.
- **Output**: No return value; the function writes the matrix to the specified file.
- **Functions Called**:
    - [`point_const`](<#point_const>)


---
### points\_array<!-- {{#callable:points_array}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L197>)

Generates a static array of `fd_ed25519_point_t` structures and writes it to a file.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the function writes the output.
    - `name`: A constant character pointer representing the name of the array to be written.
    - `values`: A pointer to an array of `fd_ed25519_point_t` structures that contains the point values to be written.
    - `n`: An integer representing the number of elements in the `values` array.
- **Logic and Control Flow**:
    - Initializes a buffer `buf` of 32 unsigned characters and a `hex` string of 65 characters, setting `hex[64]` to 0 to ensure it is null-terminated.
    - Writes the declaration of a static array of `fd_ed25519_point_t` with the specified `name` and size `n` to the `file`.
    - Iterates over each element in the `values` array using a loop that runs `n` times.
    - For each element, gets a pointer to the current `fd_ed25519_point_t` structure and encodes it into a hexadecimal string using `fd_hex_encode`.
    - Writes a comment with the compressed hexadecimal representation of the point to the `file`.
    - Writes the opening brace for the current point structure to the `file`.
    - Calls the [`point_const`](<#point_const>) function to write the constant representation of the point to the `file`.
    - Writes the closing brace and a comma for the current point structure to the `file`.
    - After the loop, writes the closing brace for the array to the `file`.
- **Output**: No return value; the function writes the output directly to the specified `file`.
- **Functions Called**:
    - [`point_const`](<#point_const>)


---
### point\_tables\_file<!-- {{#callable:point_tables_file}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L220>)

Generates and writes precomputed tables for Ed25519 base points and related data to a file.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the function writes the generated tables.
- **Logic and Control Flow**:
    - Initialize arrays `x` and `y` to store decoded hexadecimal values.
    - Decode hexadecimal strings into `x` and `y` arrays using `fd_hex_decode`.
    - Convert the decoded bytes into an Ed25519 base point using `fd_curve25519_affine_frombytes`.
    - Initialize low-order points `fd_ed25519_order8_point_y0` and `fd_ed25519_order8_point_y1` by decoding and converting hexadecimal strings.
    - Create a w-NAF table for fast scalar multiplication by initializing the first element and iteratively adding the base point to fill the table.
    - Precompute values for the w-NAF table using [`fd_curve25519_into_precomputed`](<ref/fd_curve25519.h.md#fd_curve25519_into_precomputed>).
    - Create a constant-time table for scalar multiplication by doubling points and adding them iteratively.
    - Precompute values for the constant-time table using [`fd_curve25519_into_precomputed`](<ref/fd_curve25519.h.md#fd_curve25519_into_precomputed>).
    - Write a header comment to the file indicating the file is auto-generated.
    - Write the base point, low-order points, w-NAF table, and constant-time table to the file using [`points_array`](<#points_array>) and [`points_matrix`](<#points_matrix>) functions.
- **Output**: Writes precomputed Ed25519 tables to the specified file.
- **Functions Called**:
    - [`fd_ed25519_point_set`](<ref/fd_curve25519.h.md#fd_ed25519_point_set>)
    - [`fd_curve25519_into_precomputed`](<ref/fd_curve25519.h.md#fd_curve25519_into_precomputed>)
    - [`points_array`](<#points_array>)
    - [`field_constant`](<#field_constant>)
    - [`points_matrix`](<#points_matrix>)


---
### ristretto\_points\_array<!-- {{#callable:ristretto_points_array}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L306>)

Generates a static array of `fd_ristretto255_point_t` points and writes it to a file.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the function will write the output.
    - `name`: A constant character pointer representing the name of the array to be written in the file.
    - `values`: A constant pointer to an array of `fd_ristretto255_point_t` structures representing the points to be written.
    - `n`: An integer representing the number of points in the `values` array.
- **Logic and Control Flow**:
    - Initializes a buffer `buf` of 32 bytes and a `hex` string of 65 characters, setting the last character of `hex` to null terminator.
    - Writes the declaration of a static array of `fd_ristretto255_point_t` with the given `name` and size `n` to the `file`.
    - Iterates over each point in the `values` array using a loop that runs `n` times.
    - For each point, encodes it into a hexadecimal string using `fd_hex_encode` and writes a comment with the compressed hexadecimal representation to the `file`.
    - Calls [`point_const`](<#point_const>) to write the point's constant representation to the `file`.
    - Writes the closing brace and comma for each point in the array.
    - Writes the closing brace for the array declaration.
- **Output**: No return value; the function writes the formatted array of points to the specified file.
- **Functions Called**:
    - [`fd_ristretto255_point_tobytes`](<fd_ristretto255.c.md#fd_ristretto255_point_tobytes>)
    - [`point_const`](<#point_const>)


---
### rangeproofs\_tables\_file<!-- {{#callable:rangeproofs_tables_file}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L329>)

Generates and writes precomputed tables for range proofs to a specified file.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the precomputed tables will be written.
- **Logic and Control Flow**:
    - Initialize a buffer `buf` of 32 bytes.
    - Set `fd_rangeproofs_basepoint_G` to the Ed25519 base point.
    - Decode a hardcoded hexadecimal string into `buf` and convert it to a Ristretto255 point, storing it in `fd_rangeproofs_basepoint_H`.
    - Iterate over 256 hardcoded hexadecimal strings, decode each into `buf`, convert to Ristretto255 points, and store in `fd_rangeproofs_generators_G`.
    - Repeat the previous step for another set of 256 hexadecimal strings, storing results in `fd_rangeproofs_generators_H`.
    - Write a predefined header to the `file`.
    - Write the `fd_rangeproofs_basepoint_G` to the `file` using [`ristretto_points_array`](<#ristretto_points_array>).
    - Write the `fd_rangeproofs_basepoint_H` to the `file` using [`ristretto_points_array`](<#ristretto_points_array>).
    - Write the `fd_rangeproofs_generators_G` to the `file` using [`ristretto_points_array`](<#ristretto_points_array>).
    - Write the `fd_rangeproofs_generators_H` to the `file` using [`ristretto_points_array`](<#ristretto_points_array>).
- **Output**: No return value; writes data to the provided `file`.
- **Functions Called**:
    - [`fd_ristretto255_point_frombytes`](<fd_ristretto255.c.md#fd_ristretto255_point_frombytes>)
    - [`ristretto_points_array`](<#ristretto_points_array>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/ed25519/fd_curve25519_tables.c#L895>)

Generates and saves precomputation tables for cryptographic operations to specified files.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Defines a `path` buffer to store file paths.
    - Sets `path_suffix` based on the presence of AVX512 support.
    - Defines `default_dir` as the default directory for saving tables.
    - Retrieves the directory from command-line arguments using `fd_env_strip_cmdline_cstr`; defaults to `default_dir` if not provided.
    - Logs a notice indicating the start of table saving.
    - For each table type (`fd_f25519_table`, `fd_curve25519_table`, `fd_rangeproofs_table`):
    -   - Constructs the file path using `snprintf`.
    -   - Opens the file for writing in binary mode.
    -   - Logs an error and exits if the file cannot be opened.
    -   - Calls the respective table generation function ([`field_tables_file`](<#field_tables_file>), [`point_tables_file`](<#point_tables_file>), [`rangeproofs_tables_file`](<#rangeproofs_tables_file>)).
    -   - Closes the file and logs a warning if closing fails.
    - Logs a notice indicating successful completion.
    - Calls `fd_halt` to clean up and exit the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`field_tables_file`](<#field_tables_file>)
    - [`point_tables_file`](<#point_tables_file>)
    - [`rangeproofs_tables_file`](<#rangeproofs_tables_file>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)