<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for Ristretto255 point operations, including decompression, compression, addition, subtraction, and scalar multiplication.

# Purpose
The code is a C source file that implements and tests various operations related to the Ristretto255 elliptic curve, which is used in cryptographic applications. The file includes functions for point decompression and compression, hashing to the curve, point addition and subtraction, scalar validation, scalar multiplication, and multi-scalar multiplication. These operations are essential for cryptographic protocols that rely on elliptic curve arithmetic.

The file defines several static arrays, such as `base_point_multiples` and `bad_encodings`, which are used to test the correctness of the implemented functions. The functions [`test_point_decompress`](<#test_point_decompress>), [`test_point_compress`](<#test_point_compress>), [`test_hash_to_curve`](<#test_hash_to_curve>), [`test_point_add_sub`](<#test_point_add_sub>), [`test_scalar_validate`](<#test_scalar_validate>), [`test_point_scalarmult`](<#test_point_scalarmult>), and [`test_multiscalar_mul`](<#fd_fn_no_asantest_multiscalar_mul>) are designed to verify the correctness and performance of the Ristretto255 operations. The code also includes benchmarking functionality to measure the performance of these operations. The [`main`](<#main>) function initializes a random number generator and executes the test functions, logging the results and performance metrics.
# Imports and Dependencies

---
- `stdlib.h`
- `stdio.h`
- `../fd_ballet.h`
- `../hex/fd_hex.h`
- `fd_ristretto255.h`


# Global Variables

---
### base\_point\_multiples
- **Type**: ``uchar const``
- **Description**: An array of constant unsigned characters that stores precomputed multiples of a base point in the Ristretto255 group. Each element in the array is a 32-byte string representing a point on the curve.
- **Use**: Used for operations involving point decompression and compression in the Ristretto255 group.


---
### bad\_encodings
- **Type**: ``static uchar const``
- **Description**: An array of 32-byte arrays that contains invalid or non-canonical encodings for field elements in the Ristretto255 group. These encodings include non-canonical field encodings, negative field elements, non-square x^2 values, negative xy values, and a special case where s = -1 causing y = 0.
- **Use**: Used to test the rejection of invalid encodings in the `fd_ristretto255_point_decompress` function.


# Functions

---
### log\_bench<!-- {{#callable:log_bench}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L74>)

Calculates and logs the performance metrics of a benchmark test, specifically the speed in kilohertz per core and the time per call in nanoseconds.
- **Inputs**:
    - ``descr``: A constant character pointer that describes the benchmark being logged.
    - ``iter``: An unsigned long integer representing the number of iterations performed in the benchmark.
    - ``dt``: A long integer representing the time duration in microseconds for the benchmark to complete.
- **Logic and Control Flow**:
    - Calculate `khz` as the number of iterations per second per core by multiplying 1,000,000 by the number of iterations and dividing by the time duration.
    - Calculate `tau` as the average time per call in nanoseconds by dividing the time duration by the number of iterations.
    - Log the description, speed in kilohertz per core, and time per call in nanoseconds using the `FD_LOG_NOTICE` macro.
- **Output**: No return value; the function logs the performance metrics.


---
### fd\_f25519\_print<!-- {{#callable:fd_f25519_print}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L83>)

Converts a `fd_f25519_t` object to a byte array and prints it in hexadecimal format.
- **Inputs**:
    - `f`: A pointer to a `fd_f25519_t` object that represents the field element to be printed.
- **Logic and Control Flow**:
    - Declare a 32-byte array `s` to store the byte representation of the field element.
    - Call `fd_f25519_tobytes` to convert the field element `f` into a byte array `s`.
    - Iterate over each byte in the array `s` and print it in hexadecimal format using `printf`.
    - Print a newline character after printing all bytes.
- **Output**: No return value; the function outputs the hexadecimal representation of the field element to the standard output.


---
### fd\_ed25519\_ge\_print<!-- {{#callable:fd_ed25519_ge_print}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L90>)

Prints the coordinates of an `fd_ed25519_point_t` point in the extended twisted Edwards coordinates (X, Y, Z, T).
- **Inputs**:
    - `p`: A pointer to an `fd_ed25519_point_t` structure representing the point to print.
- **Logic and Control Flow**:
    - Declare four `fd_f25519_t` variables `x`, `y`, `z`, and `t` to hold the coordinates of the point.
    - Call [`fd_ed25519_point_to`](<ref/fd_curve25519.h.md#fd_ed25519_point_to>) to convert the point `p` into its coordinates `x`, `y`, `z`, and `t`.
    - Print the label 'X = ' and the value of `x` using [`fd_f25519_print`](<#fd_f25519_print>).
    - Print the label 'Y = ' and the value of `y` using [`fd_f25519_print`](<#fd_f25519_print>).
    - Print the label 'Z = ' and the value of `z` using [`fd_f25519_print`](<#fd_f25519_print>).
    - Print the label 'T = ' and the value of `t` using [`fd_f25519_print`](<#fd_f25519_print>).
- **Output**: No return value; the function outputs the coordinates to the standard output.
- **Functions Called**:
    - [`fd_ed25519_point_to`](<ref/fd_curve25519.h.md#fd_ed25519_point_to>)
    - [`fd_f25519_print`](<#fd_f25519_print>)


---
### test\_point\_decompress<!-- {{#callable:test_point_decompress}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L101>)

Tests the decompression of Ristretto255 points from encoded byte arrays, verifies the rejection of invalid encodings, and benchmarks the decompression process.
- **Inputs**:
    - `rng`: A pointer to a random number generator object, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize a 32-byte array `_s` and a Ristretto255 point `_h`.
    - Iterate over `base_point_multiples`, decompress each 32-byte segment into a Ristretto255 point, and log an error if decompression fails.
    - Iterate over `bad_encodings`, attempt to decompress each 32-byte segment, and log an error if decompression succeeds (indicating a failure to reject bad encoding).
    - Copy the 6th element of `base_point_multiples` into `_s` for benchmarking.
    - Perform 100,000 decompression operations on `_s` and measure the time taken.
    - Log the benchmark results for the decompression operation.
- **Output**: No return value; outputs are logged to the console.
- **Functions Called**:
    - [`log_bench`](<#log_bench>)


---
### test\_point\_compress<!-- {{#callable:test_point_compress}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L141>)

Tests the compression and decompression of Ristretto255 points and benchmarks the compression operation.
- **Inputs**:
    - `rng`: A pointer to a random number generator of type `fd_rng_t`.
- **Logic and Control Flow**:
    - Initialize local variables for storing points and scalars.
    - Iterate over `base_point_multiples`, decompress each point, and check for decompression errors.
    - Compress the decompressed point and compare it with the original to verify correctness.
    - Generate a random scalar `c` and multiply all coordinates of the point by `c`.
    - Compress the modified point and verify the result against the original.
    - Decompress a specific base point multiple for benchmarking.
    - Measure the time taken to compress the point multiple times and log the benchmark results.
- **Output**: No return value; the function logs errors and benchmark results.
- **Functions Called**:
    - [`fd_ed25519_point_to`](<ref/fd_curve25519.h.md#fd_ed25519_point_to>)
    - [`log_bench`](<#log_bench>)


---
### test\_hash\_to\_curve<!-- {{#callable:test_hash_to_curve}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L199>)

Tests the [`fd_ristretto255_hash_to_curve`](<fd_ristretto255.c.md#fd_ristretto255_hash_to_curve>) function by comparing its output to a known expected result and benchmarks its performance.
- **Inputs**:
    - `rng`: A pointer to a random number generator object, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize arrays `_s` and `_e` to hold 64 and 32 bytes respectively, and pointers `s` and `e` to point to these arrays.
    - Initialize `fd_ristretto255_point_t` structures `_h` and `_g` to hold points, and pointers `h` and `g` to point to these structures.
    - Decode a 64-byte hexadecimal string into `s` and a 32-byte hexadecimal string into `e`.
    - Decompress the point `g` from the encoded point `e`.
    - Hash the data in `s` to a curve point `h` using [`fd_ristretto255_hash_to_curve`](<fd_ristretto255.c.md#fd_ristretto255_hash_to_curve>).
    - Check if the point `h` is equal to `g` using [`fd_ristretto255_point_eq`](<fd_ristretto255.h.md#fd_ristretto255_point_eq>) and ensure it is not equal to `g` using [`fd_ed25519_point_eq`](<ref/fd_curve25519.h.md#fd_ed25519_point_eq>).
    - Compress the point `h` into a 32-byte array `t` and compare it with `e` to verify correctness.
    - Log an error if the compressed point `t` does not match `e`.
    - Benchmark the [`fd_ristretto255_hash_to_curve`](<fd_ristretto255.c.md#fd_ristretto255_hash_to_curve>) function by running it 10,000 times and logging the performance.
    - Benchmark the [`fd_ristretto255_map_to_curve`](<fd_ristretto255.c.md#fd_ristretto255_map_to_curve>) function similarly.
- **Output**: No return value; outputs are logged or errors are reported if the test fails.
- **Functions Called**:
    - [`fd_ristretto255_hash_to_curve`](<fd_ristretto255.c.md#fd_ristretto255_hash_to_curve>)
    - [`fd_ristretto255_point_eq`](<fd_ristretto255.h.md#fd_ristretto255_point_eq>)
    - [`fd_ed25519_point_eq`](<ref/fd_curve25519.h.md#fd_ed25519_point_eq>)
    - [`log_bench`](<#log_bench>)
    - [`fd_ristretto255_map_to_curve`](<fd_ristretto255.c.md#fd_ristretto255_map_to_curve>)


---
### test\_point\_add\_sub<!-- {{#callable:test_point_add_sub}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L244>)

Tests the correctness and performance of point addition and subtraction operations on Ristretto255 points.
- **Inputs**:
    - ``rng``: A pointer to a random number generator, marked as unused in this function.
- **Logic and Control Flow**:
    - Initialize three Ristretto255 point variables `f`, `g`, and `h` for testing.
    - Decompress base point multiples into temporary point `t` and point `f`.
    - Perform addition and subtraction operations on points `f`, `g`, `h`, and `t` to verify correctness of operations such as `P + 0`, `0 + P`, `P - 0`, `0 - P`, and `P + (-P)`.
    - Use nested loops to test addition and subtraction for combinations of base point multiples, ensuring `(i+j)P = iP + jP` and `iP = (i+j)P - jP`.
    - Benchmark the performance of `fd_ristretto255_point_add` and `fd_ristretto255_point_sub` functions by executing them a million times and logging the results.
- **Output**: No return value; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_ristretto255_point_eq`](<fd_ristretto255.h.md#fd_ristretto255_point_eq>)
    - [`log_bench`](<#log_bench>)


---
### test\_scalar\_validate<!-- {{#callable:test_scalar_validate}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L307>)

Validates Curve25519 scalars by checking specific hexadecimal values for validity and benchmarking the validation function.
- **Inputs**:
    - `rng`: A pointer to a random number generator object, marked as unused in this function.
- **Logic and Control Flow**:
    - Declare a 32-byte array `_a` and a pointer `a` pointing to it.
    - Decode a hexadecimal string representing an invalid scalar into `a` and check if `fd_curve25519_scalar_validate(a)` returns `NULL`.
    - Repeat the above step for another invalid scalar value.
    - Decode a hexadecimal string representing a valid scalar into `a` and check if `fd_curve25519_scalar_validate(a)` returns `a`.
    - Repeat the above step for another valid scalar value and a specific valid scalar value `r-1`.
    - Set `iter` to 1,000,000 for benchmarking.
    - Record the current wall clock time, run `fd_ristretto255_scalar_validate(a)` in a loop `iter` times, and calculate the elapsed time.
    - Log the benchmark results using [`log_bench`](<#log_bench>).
- **Output**: No output is returned; the function performs validation checks and logs benchmark results.
- **Functions Called**:
    - [`log_bench`](<#log_bench>)


---
### test\_point\_scalarmult<!-- {{#callable:test_point_scalarmult}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L346>)

Tests the correctness and performance of scalar multiplication on Ristretto255 points.
- **Inputs**:
    - ``rng``: A pointer to a random number generator of type `fd_rng_t`.
- **Logic and Control Flow**:
    - Initialize Ristretto255 point variables `f`, `h`, and `t`, and a 32-byte array `a`.
    - Decompress the base point multiples for indices 1 and 13 into `f` and `t`, respectively.
    - Set the first byte of `a` to 13 and the rest to 0, then perform scalar multiplication of `f` by `a` and store the result in `h`.
    - Verify that the result of the scalar multiplication `h` is equal to `t`.
    - Decode a hexadecimal string into `a`, decompress the base point multiple for index 0 into `t`, and subtract `f` from `t`.
    - Perform scalar multiplication of `f` by `a` again and verify that the result `h` is equal to `t`.
    - Benchmark the scalar multiplication function by running it 10,000 times and logging the performance.
- **Output**: No output is returned; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_ristretto255_point_eq`](<fd_ristretto255.h.md#fd_ristretto255_point_eq>)
    - [`log_bench`](<#log_bench>)


---
### fd\_rng\_b256<!-- {{#callable:fd_rng_b256}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L381>)

Generates 256 bits of random data using a random number generator.
- **Inputs**:
    - `rng`: A pointer to an `fd_rng_t` structure, which represents the random number generator state.
    - `r`: A pointer to an `uchar` array where the function will store the generated random data.
- **Logic and Control Flow**:
    - Casts the `uchar` pointer `r` to a `ulong` pointer `u`.
    - Calls `fd_rng_ulong` four times to fill the `ulong` array `u` with random values.
    - Returns the pointer `r` after filling it with random data.
- **Output**: A pointer to the `uchar` array `r` containing 256 bits of random data.


---
### test\_multiscalar\_mul<!-- {{#callable:FD_FN_NO_ASAN::test_multiscalar_mul}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L389>)

Tests the correctness and performance of multi-scalar multiplication operations on Ristretto255 points.
- **Inputs**:
    - ``rng``: A pointer to a random number generator of type `fd_rng_t` used for generating random scalars.
- **Logic and Control Flow**:
    - Defines a constant `MSM_N` for the number of points and scalars used in the test.
    - Initializes arrays for points and scalars, and sets specific values for testing multi-scalar multiplication.
    - Performs decompression of base point multiples and sets up expected results for comparison.
    - Executes multi-scalar multiplication using `fd_ristretto255_multi_scalar_mul` and verifies the result against expected values using `FD_TEST`.
    - Conducts additional tests with different scalar and point values to ensure correctness of multi-scalar multiplication.
    - Benchmarks the performance of multi-scalar multiplication by varying the number of points and scalars, and logs the results.
    - Frees allocated memory for points after benchmarking.
- **Output**: No direct output; the function performs tests and logs results for correctness and performance of multi-scalar multiplication.
- **Functions Called**:
    - [`fd_ristretto255_point_eq`](<fd_ristretto255.h.md#fd_ristretto255_point_eq>)
    - [`fd_rng_b256`](<#fd_rng_b256>)
    - [`log_bench`](<#log_bench>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/ed25519/test_ristretto255.c#L504>)

Initializes the environment, runs a series of cryptographic tests, logs the results, and then halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Creates a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Executes a series of test functions: [`test_point_decompress`](<#test_point_decompress>), [`test_point_compress`](<#test_point_compress>), [`test_hash_to_curve`](<#test_hash_to_curve>), [`test_point_add_sub`](<#test_point_add_sub>), [`test_scalar_validate`](<#test_scalar_validate>), [`test_point_scalarmult`](<#test_point_scalarmult>), and [`test_multiscalar_mul`](<#fd_fn_no_asantest_multiscalar_mul>), each with `rng` as an argument.
    - Logs a notice message 'pass' using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_point_decompress`](<#test_point_decompress>)
    - [`test_point_compress`](<#test_point_compress>)
    - [`test_hash_to_curve`](<#test_hash_to_curve>)
    - [`test_point_add_sub`](<#test_point_add_sub>)
    - [`test_scalar_validate`](<#test_scalar_validate>)
    - [`test_point_scalarmult`](<#test_point_scalarmult>)
    - [`FD_FN_NO_ASAN::test_multiscalar_mul`](<#fd_fn_no_asantest_multiscalar_mul>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)