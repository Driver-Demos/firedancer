<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests and benchmarks for the `fd_lthash_adder` functionality, including random input generation and validation.

# Purpose
The code is a C source file that tests and benchmarks the functionality of a component called `fd_lthash_adder`. It includes functions to test the correctness and performance of the `fd_lthash_adder` operations. The file defines a buffer `test_lthash_adder_buf` to hold input data for testing, and a function [`test_lthash_adder_fill`](<#test_lthash_adder_fill>) to populate this buffer with random data. The main testing function, [`test_lthash_adder`](<#test_lthash_adder>), performs various operations such as initializing, pushing data, and flushing the adder, while comparing the results against a reference implementation to ensure correctness. It uses a random number generator to create diverse test cases and checks for any discrepancies in the hash values.

Additionally, the file contains a benchmarking function, [`bench_lthash_adder`](<#bench_lthash_adder>), which measures the performance of the `fd_lthash_adder` by executing a series of hash operations on a fixed-size input and logging the results. This function performs a warm-up phase followed by the actual benchmarking to provide accurate performance metrics. The code is structured to ensure that the `fd_lthash_adder` is tested under various conditions and its performance is evaluated in terms of hash operations per second and time per hash.
# Imports and Dependencies

---
- `fd_lthash_adder.h`


# Global Variables

---
### test\_lthash\_adder\_buf
- **Type**: `uchar array`
- **Description**: An array of unsigned characters with a size defined by `TEST_LTHASH_INPUT_MAX`, which is 1 MiB.
- **Use**: Used to store input data for testing the `fd_lthash_adder` functions.


# Functions

---
### test\_lthash\_adder\_fill<!-- {{#callable:test_lthash_adder_fill}} -->
[View Source →](<../../../../../src/ballet/lthash/test_lthash_adder.c#L8>)

Fills a buffer with random data using a specified size.
- **Inputs**:
    - ``rng``: A pointer to a random number generator of type `fd_rng_t`.
    - ``sz``: The size of the data to fill, of type `ulong`, which must be less than or equal to `TEST_LTHASH_INPUT_MAX`.
- **Logic and Control Flow**:
    - Check if `sz` is less than or equal to `TEST_LTHASH_INPUT_MAX` using `FD_TEST` macro.
    - Initialize a pointer `p` to the start of the buffer `test_lthash_adder_buf`.
    - While `sz` is greater than 4, store a random `uint` generated by `fd_rng_uint` into the buffer at the current position of `p`, then increment `p` by 4 and decrement `sz` by 4.
    - For the remaining bytes (when `sz` is less than or equal to 4), fill each byte with a random `uchar` generated by `fd_rng_uchar`, incrementing `p` after each byte.
- **Output**: No return value; the function modifies the global buffer `test_lthash_adder_buf`.


---
### test\_lthash\_adder<!-- {{#callable:test_lthash_adder}} -->
[View Source →](<../../../../../src/ballet/lthash/test_lthash_adder.c#L23>)

Tests the functionality of the `fd_lthash_adder` by simulating various input scenarios and verifying the results.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initializes a random number generator `rng` with a seed value of `1234U`.
    - Performs initial tests to ensure `fd_lthash_adder_new` and [`fd_lthash_adder_delete`](<fd_lthash_adder.c.md#fd_lthash_adder_delete>) return `NULL` when given invalid inputs.
    - Creates an `fd_lthash_adder_t` object `adder` and tests its creation and deletion.
    - Initializes `sum`, `check`, and `tmp` to zero using `fd_lthash_zero`.
    - Enters a loop that runs for `100000UL` iterations, decrementing `iter_rem` each time.
    - In each iteration, selects a method (`0`, `1`, or `2`) based on a random sample to test different functionalities of the adder.
    - For method `0`, generates random input data, computes a hash using `fd_blake3`, and tests [`fd_lthash_adder_push`](<fd_lthash_adder.h.md#fd_lthash_adder_push>).
    - For method `1`, generates account input data, computes a hash, and tests [`fd_lthash_adder_push_solana_account`](<fd_lthash_adder.h.md#fd_lthash_adder_push_solana_account>).
    - For method `2`, calls [`fd_lthash_adder_flush`](<fd_lthash_adder.h.md#fd_lthash_adder_flush>) and checks if the `sum` matches `check`.
    - If `iter_rem` reaches `0`, exits the loop.
    - Performs a final check to ensure the adder's output is correct before exiting.
    - Deletes the random number generator `rng`.
- **Output**: No output is returned; the function performs tests and logs errors if any discrepancies are found.
- **Functions Called**:
    - [`fd_lthash_adder_delete`](<fd_lthash_adder.c.md#fd_lthash_adder_delete>)
    - [`test_lthash_adder_fill`](<#test_lthash_adder_fill>)
    - [`fd_lthash_adder_push`](<fd_lthash_adder.h.md#fd_lthash_adder_push>)
    - [`fd_lthash_adder_push_solana_account`](<fd_lthash_adder.h.md#fd_lthash_adder_push_solana_account>)
    - [`fd_lthash_adder_flush`](<fd_lthash_adder.h.md#fd_lthash_adder_flush>)


---
### bench\_lthash\_adder<!-- {{#callable:bench_lthash_adder}} -->
[View Source →](<../../../../../src/ballet/lthash/test_lthash_adder.c#L109>)

Benchmarks the `lthash_adder` function using a 128-byte input.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the benchmarking process for `lthash_adder` with a 128-byte input.
    - Initializes a 128-byte input array filled with the character 'A' (0x41).
    - Declares output and adder variables for the hash operation.
    - Performs a warmup phase with a reduced number of iterations (1/128th of the target).
    - Records the start time using `fd_log_wallclock`.
    - Creates a new `lthash_adder` instance and pushes the input data through it for the warmup iterations.
    - Flushes the adder and deletes it after the warmup phase.
    - Calculates the elapsed time for the warmup phase.
    - Repeats the process for the full number of iterations (2^22) to perform the actual benchmark.
    - Logs the hash rate and time per hash operation after the benchmark.
- **Output**: Logs the hash rate and time per hash operation to the notice log.
- **Functions Called**:
    - [`fd_lthash_adder_push`](<fd_lthash_adder.h.md#fd_lthash_adder_push>)
    - [`fd_lthash_adder_flush`](<fd_lthash_adder.h.md#fd_lthash_adder_flush>)
    - [`fd_lthash_adder_delete`](<fd_lthash_adder.c.md#fd_lthash_adder_delete>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)