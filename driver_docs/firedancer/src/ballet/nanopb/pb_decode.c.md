<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Decodes protobuf messages using minimal resources, with functions for reading and handling various data types.

# Purpose
The `pb_decode.c` file is a C source code file that provides functionality for decoding Protocol Buffers (protobuf) messages using minimal resources. It is part of a library that handles the deserialization of protobuf data streams into structured data. The file includes various functions and macros to read and interpret different types of protobuf wire types, such as varints, fixed-length fields, and strings. It also supports handling extensions and submessages, which are common in protobuf schemas.

The code defines several static functions for internal use, such as [`buf_read`](<#checkreturnbuf_read>), [`pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>), and [`decode_basic_field`](<#checkreturndecode_basic_field>), which are used to read and decode different parts of a protobuf message. The file also includes conditional compilation sections to handle different environments and configurations, such as enabling or disabling 64-bit support and memory allocation. The main public functions, [`pb_decode`](<#checkreturnpb_decode>) and [`pb_decode_ex`](<#checkreturnpb_decode_ex>), provide the interface for decoding messages, with the latter offering additional options for handling delimited messages. The file is designed to be part of a larger library, as indicated by its inclusion of headers like `pb_firedancer.h`, `pb_decode.h`, and `pb_common.h`, and it does not define a `main` function, indicating it is not an executable but a library component.
# Imports and Dependencies

---
- `pb_firedancer.h`
- `pb_decode.h`
- `pb_common.h`


# Data Structures

---
### pb\_fields\_seen\_t
- **Type**: ``struct``
- **Members**:
    - ``bitfield``: An array of `uint32_t` that stores bit flags for tracking seen fields.
- **Description**: `pb_fields_seen_t` is a structure that contains a bitfield array used to track which fields have been seen during the decoding of a Protocol Buffers message. The size of the bitfield array is determined by the constant `PB_MAX_REQUIRED_FIELDS`, ensuring that there is enough space to represent each field as a bit. This structure is useful for ensuring that all required fields in a message are present and accounted for during decoding.


# Functions

---
### buf\_read<!-- {{#callable:checkreturn::buf_read}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L69>)

Reads a specified number of bytes from a stream into a buffer and updates the stream state.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which to read.
    - `buf`: A pointer to a buffer of type `pb_byte_t` where the read bytes will be stored; can be `NULL` if the bytes are not needed.
    - `count`: The number of bytes to read from the stream.
- **Logic and Control Flow**:
    - Get the current state of the stream and cast it to a `pb_byte_t` pointer named `source`.
    - Advance the stream's state by `count` bytes.
    - If `buf` is not `NULL`, copy `count` bytes from `source` to `buf` using `memcpy`.
    - Return `true` to indicate successful reading.
- **Output**: Returns `true` to indicate that the function executed successfully.


---
### pb\_read<!-- {{#callable:checkreturn::pb_read}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L82>)

Reads a specified number of bytes from a protobuf input stream into a buffer, handling various conditions such as skipping bytes and checking for end-of-stream errors.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which bytes are read.
    - ``buf``: A pointer to a buffer where the read bytes will be stored; can be `NULL` if bytes are to be skipped.
    - ``count``: The number of bytes to read from the stream.
- **Logic and Control Flow**:
    - If `count` is zero, return `true` immediately.
    - If `buf` is `NULL` and `stream->callback` is not [`buf_read`](<#checkreturnbuf_read>), enter a loop to skip `count` bytes in chunks of 16 bytes using a temporary buffer `tmp`.
    - If `stream->bytes_left` is less than `count`, call `PB_RETURN_ERROR` with "end-of-stream" and return `false`.
    - If `PB_BUFFER_ONLY` is not defined, use `stream->callback` to read bytes into `buf`; if it fails, call `PB_RETURN_ERROR` with "io error" and return `false`.
    - If `PB_BUFFER_ONLY` is defined, use [`buf_read`](<#checkreturnbuf_read>) to read bytes into `buf`; if it fails, return `false`.
    - Adjust `stream->bytes_left` by subtracting `count` from it, ensuring it does not go below zero.
    - Return `true` if all operations succeed.
- **Output**: Returns `true` if the bytes are successfully read or skipped, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::buf_read`](<#checkreturnbuf_read>)


---
### pb\_readbyte<!-- {{#callable:checkreturn::pb_readbyte}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L125>)

Reads a single byte from a protobuf input stream and updates the stream state.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the byte.
    - ``buf``: A pointer to a `pb_byte_t` variable where the read byte will be stored.
- **Logic and Control Flow**:
    - Checks if `stream->bytes_left` is zero; if true, returns an error indicating end-of-stream.
    - If `PB_BUFFER_ONLY` is not defined, calls the stream's callback function to read a byte into `buf`; if the callback fails, returns an error indicating an I/O error.
    - If `PB_BUFFER_ONLY` is defined, reads a byte directly from `stream->state` into `buf` and advances the `state` pointer by one byte.
    - Decrements `stream->bytes_left` by one.
    - Returns `true` to indicate successful byte reading.
- **Output**: Returns `true` if the byte is successfully read; otherwise, returns an error through `PB_RETURN_ERROR` macros.


---
### pb\_istream\_from\_buffer<!-- {{#callable:pb_istream_from_buffer}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L143>)

Creates a `pb_istream_t` stream from a buffer for reading protocol buffer data.
- **Inputs**:
    - `buf`: A pointer to the buffer containing the protocol buffer data.
    - `msglen`: The length of the message in the buffer.
- **Logic and Control Flow**:
    - Declare a `pb_istream_t` variable named `stream`.
    - Use a union to cast away the const from `buf` without a compiler error.
    - Set `stream.callback` to `NULL` if `PB_BUFFER_ONLY` is defined, otherwise set it to `&buf_read`.
    - Assign `buf` to `state.c_state` and then to `stream.state`.
    - Set `stream.bytes_left` to `msglen`.
    - Set `stream.errmsg` to `NULL` if `PB_NO_ERRMSG` is not defined.
    - Return the `stream`.
- **Output**: Returns a `pb_istream_t` structure initialized to read from the given buffer.


---
### pb\_decode\_varint32\_eof<!-- {{#callable:checkreturn::pb_decode_varint32_eof}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L171>)

Decodes a 32-bit varint from a protobuf input stream and checks for end-of-file.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the varint.
    - ``dest``: A pointer to a `uint32_t` where the decoded varint will be stored.
    - ``eof``: A pointer to a `bool` that will be set to `true` if the end of the stream is reached, otherwise it remains unchanged.
- **Logic and Control Flow**:
    - Attempt to read a byte from the input stream using [`pb_readbyte`](<#checkreturnpb_readbyte>).
    - If reading fails and `bytes_left` is zero, set `eof` to `true` if `eof` is not `NULL`, then return `false`.
    - Check if the byte does not have the continuation bit set (i.e., `byte & 0x80` is zero), indicating a single-byte varint, and store it in `result`.
    - If the continuation bit is set, initialize `result` with the lower 7 bits of the byte and enter a loop to read additional bytes.
    - In the loop, read another byte and check for overflow conditions based on `bitpos`.
    - If `bitpos` is 28, check for overflow in the 4 most significant bits of the varint.
    - If `bitpos` is less than 28, append the lower 7 bits of the byte to `result`.
    - Increment `bitpos` by 7 and continue the loop if the continuation bit is set.
    - Store the final `result` in `dest` and return `true`.
- **Output**: Returns `true` if the varint is successfully decoded and stored in `dest`, otherwise returns `false` if an error occurs or the end of the stream is reached.
- **Functions Called**:
    - [`checkreturn::pb_readbyte`](<#checkreturnpb_readbyte>)


---
### pb\_decode\_varint32<!-- {{#callable:checkreturn::pb_decode_varint32}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L237>)

Calls [`pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>) to decode a 32-bit varint from a protobuf input stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the varint.
    - ``dest``: A pointer to a `uint32_t` variable where the decoded varint will be stored.
- **Logic and Control Flow**:
    - Calls the [`pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>) function with `stream`, `dest`, and `NULL` as arguments.
    - Returns the result of the [`pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>) function call.
- **Output**: Returns a boolean value indicating the success or failure of the varint decoding operation.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>)


---
### pb\_decode\_varint<!-- {{#callable:checkreturn::pb_decode_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L243>)

Decodes a variable-length integer from a protobuf input stream and stores it in a destination variable.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the varint.
    - ``dest``: A pointer to a `uint64_t` variable where the decoded varint will be stored.
- **Logic and Control Flow**:
    - Initialize `bitpos` to 0 and `result` to 0 to prepare for decoding.
    - Enter a loop to read bytes from the stream until the most significant bit of the byte is 0.
    - Call [`pb_readbyte`](<#checkreturnpb_readbyte>) to read a byte from the stream into `byte`. If it fails, return `false`.
    - Check for overflow: if `bitpos` is 63 or more and the byte has bits set other than the least significant bit, return an error using `PB_RETURN_ERROR`.
    - Combine the lower 7 bits of `byte` into `result` by shifting them left by `bitpos` and using bitwise OR.
    - Increment `bitpos` by 7 to prepare for the next byte.
    - Exit the loop when the most significant bit of `byte` is 0, indicating the end of the varint.
    - Store the decoded `result` in the location pointed to by `dest`.
    - Return `true` to indicate successful decoding.
- **Output**: Returns `true` if the varint is successfully decoded and stored in `dest`, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_readbyte`](<#checkreturnpb_readbyte>)


---
### pb\_skip\_varint<!-- {{#callable:checkreturn::pb_skip_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L266>)

Skips over a varint in the input stream without decoding it.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which to skip the varint.
- **Logic and Control Flow**:
    - Initialize a `pb_byte_t` variable `byte` to store each byte read from the stream.
    - Enter a `do-while` loop that continues as long as the most significant bit of `byte` is set (i.e., `byte & 0x80` is true).
    - Inside the loop, call [`pb_read`](<#checkreturnpb_read>) to read one byte from the stream into `byte`.
    - If [`pb_read`](<#checkreturnpb_read>) returns false, indicating a read error or end of stream, return false to indicate failure.
    - If the loop exits, return true to indicate successful skipping of the varint.
- **Output**: Returns a boolean value: true if the varint was successfully skipped, false if there was an error reading from the stream.
- **Functions Called**:
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_skip\_string<!-- {{#callable:checkreturn::pb_skip_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L277>)

Skips over a string in a protobuf input stream by reading its length and advancing the stream position.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which the string is to be skipped.
- **Logic and Control Flow**:
    - Call [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) to read the length of the string from the stream.
    - Check if the length is valid by comparing it to its casted size_t equivalent.
    - If the length is invalid, return an error using `PB_RETURN_ERROR`.
    - Call [`pb_read`](<#checkreturnpb_read>) to skip over the string data in the stream by advancing the stream position by the length of the string.
- **Output**: Returns `true` if the string is successfully skipped, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32`](<#checkreturnpb_decode_varint32>)
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_decode\_tag<!-- {{#callable:checkreturn::pb_decode_tag}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L291>)

Decodes a protobuf tag from the input stream and extracts the wire type and tag number.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the tag.
    - ``wire_type``: A pointer to a `pb_wire_type_t` variable where the function will store the decoded wire type.
    - ``tag``: A pointer to a `uint32_t` variable where the function will store the decoded tag number.
    - ``eof``: A pointer to a `bool` variable where the function will store the end-of-file status.
- **Logic and Control Flow**:
    - Initialize `eof` to `false`, `wire_type` to 0, and `tag` to 0.
    - Call [`pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>) to decode a varint from the stream into `temp` and update `eof`.
    - If [`pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>) returns `false`, return `false` to indicate failure.
    - Extract the tag number by right-shifting `temp` by 3 bits and store it in `tag`.
    - Extract the wire type by masking `temp` with 7 and store it in `wire_type`.
    - Return `true` to indicate successful decoding.
- **Output**: Returns `true` if the tag is successfully decoded, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>)


---
### pb\_skip\_field<!-- {{#callable:checkreturn::pb_skip_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L308>)

Skips a field in a Protocol Buffers input stream based on the wire type.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream.
    - ``wire_type``: A `pb_wire_type_t` value indicating the wire type of the field to skip.
- **Logic and Control Flow**:
    - Checks the `wire_type` to determine the appropriate action.
    - If `wire_type` is `PB_WT_VARINT`, calls [`pb_skip_varint`](<#checkreturnpb_skip_varint>) to skip a varint field.
    - If `wire_type` is `PB_WT_64BIT`, calls [`pb_read`](<#checkreturnpb_read>) to skip 8 bytes.
    - If `wire_type` is `PB_WT_STRING`, calls [`pb_skip_string`](<#checkreturnpb_skip_string>) to skip a string field.
    - If `wire_type` is `PB_WT_32BIT`, calls [`pb_read`](<#checkreturnpb_read>) to skip 4 bytes.
    - If `wire_type` is none of the above, returns an error using `PB_RETURN_ERROR`.
- **Output**: Returns `true` if the field is successfully skipped, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_skip_varint`](<#checkreturnpb_skip_varint>)
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)
    - [`checkreturn::pb_skip_string`](<#checkreturnpb_skip_string>)


---
### read\_raw\_value<!-- {{#callable:checkreturn::read_raw_value}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L323>)

Reads a raw value from a protobuf input stream based on the specified wire type and stores it in a buffer.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the data.
    - ``wire_type``: A `pb_wire_type_t` value indicating the type of wire format to read (e.g., `PB_WT_VARINT`, `PB_WT_64BIT`, `PB_WT_32BIT`).
    - ``buf``: A pointer to a buffer where the read data will be stored.
    - ``size``: A pointer to a `size_t` variable that initially contains the maximum size of the buffer and will be updated to the actual size of the read data.
- **Logic and Control Flow**:
    - Initialize `max_size` with the value pointed to by `size`.
    - Use a switch statement to handle different `wire_type` values.
    - For `PB_WT_VARINT`, initialize `*size` to 0 and read bytes one by one, incrementing `*size` until a byte without the high bit set is found or `max_size` is exceeded.
    - Return an error if `max_size` is exceeded during `PB_WT_VARINT` reading.
    - For `PB_WT_64BIT`, set `*size` to 8 and read 8 bytes into `buf`.
    - For `PB_WT_32BIT`, set `*size` to 4 and read 4 bytes into `buf`.
    - For `PB_WT_STRING`, fall through to the default case.
    - In the default case, return an error indicating an invalid `wire_type`.
- **Output**: Returns `true` if the read operation is successful, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_make\_string\_substream<!-- {{#callable:checkreturn::pb_make_string_substream}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L362>)

Creates a substream from a parent stream with a specified length.
- **Inputs**:
    - ``stream``: A pointer to the parent `pb_istream_t` stream from which to create the substream.
    - ``substream``: A pointer to the `pb_istream_t` stream that will be initialized as the substream.
- **Logic and Control Flow**:
    - Call [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) to read a varint from `stream` and store it in `size`.
    - If [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) fails, return `false`.
    - Copy the contents of `stream` to `substream`.
    - Check if `substream->bytes_left` is less than `size`; if true, call `PB_RETURN_ERROR` with the message "parent stream too short".
    - Set `substream->bytes_left` to `size`.
    - Subtract `size` from `stream->bytes_left`.
    - Return `true`.
- **Output**: Returns `true` if the substream is successfully created, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32`](<#checkreturnpb_decode_varint32>)


---
### pb\_close\_string\_substream<!-- {{#callable:checkreturn::pb_close_string_substream}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L377>)

Closes a substream by reading any remaining bytes and updating the parent stream's state.
- **Inputs**:
    - `stream`: A pointer to the parent `pb_istream_t` stream structure.
    - `substream`: A pointer to the `pb_istream_t` substream structure that needs to be closed.
- **Logic and Control Flow**:
    - Check if `substream->bytes_left` is non-zero.
    - If non-zero, call [`pb_read`](<#checkreturnpb_read>) to read the remaining bytes in the substream.
    - If [`pb_read`](<#checkreturnpb_read>) fails, return `false`.
    - Update `stream->state` to `substream->state`.
    - If `PB_NO_ERRMSG` is not defined, update `stream->errmsg` to `substream->errmsg`.
    - Return `true` indicating successful closure of the substream.
- **Output**: Returns `true` if the substream is successfully closed, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### decode\_basic\_field<!-- {{#callable:checkreturn::decode_basic_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L396>)

Decodes a basic field from a Protocol Buffers input stream based on the field type and wire type.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the field.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the field to decode.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field iterator for the field to decode.
- **Logic and Control Flow**:
    - Check the field type using `PB_LTYPE(field->type)` and execute the corresponding case in the switch statement.
    - For each field type, verify that the `wire_type` matches the expected wire type for that field type.
    - If the wire type is incorrect, return an error using `PB_RETURN_ERROR`.
    - Call the appropriate decoding function for the field type, such as [`pb_dec_bool`](<#checkreturnpb_dec_bool>), [`pb_dec_varint`](<#checkreturnpb_dec_varint>), [`pb_decode_fixed32`](<#pb_decode_fixed32>), etc.
    - Return the result of the decoding function call.
- **Output**: Returns a boolean value indicating success (`true`) or failure (`false`) of the decoding operation.
- **Functions Called**:
    - [`checkreturn::pb_dec_bool`](<#checkreturnpb_dec_bool>)
    - [`checkreturn::pb_dec_varint`](<#checkreturnpb_dec_varint>)
    - [`pb_decode_fixed32`](<#pb_decode_fixed32>)
    - [`pb_decode_double_as_float`](<#pb_decode_double_as_float>)
    - [`pb_decode_fixed64`](<#pb_decode_fixed64>)
    - [`checkreturn::pb_dec_bytes`](<#checkreturnpb_dec_bytes>)
    - [`checkreturn::pb_dec_string`](<#checkreturnpb_dec_string>)
    - [`checkreturn::pb_dec_submessage`](<#checkreturnpb_dec_submessage>)
    - [`checkreturn::pb_dec_fixed_length_bytes`](<#checkreturnpb_dec_fixed_length_bytes>)


---
### decode\_static\_field<!-- {{#callable:checkreturn::decode_static_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L467>)

Decodes a static field from a Protocol Buffers input stream based on the field's type and wire type.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the field.
    - ``wire_type``: A `pb_wire_type_t` value indicating the wire type of the field to decode.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field iterator for the field to decode.
- **Logic and Control Flow**:
    - Check the field type using `PB_HTYPE` macro and switch on the field type.
    - For `PB_HTYPE_REQUIRED`, call [`decode_basic_field`](<#checkreturndecode_basic_field>) to decode the field.
    - For `PB_HTYPE_OPTIONAL`, set the field's presence flag to true if `pSize` is not NULL, then call [`decode_basic_field`](<#checkreturndecode_basic_field>).
    - For `PB_HTYPE_REPEATED`, check if the field is a packed array and handle it by creating a substream and decoding each element until the substream is exhausted or the array size limit is reached. If not packed, decode a single repeated field element.
    - For `PB_HTYPE_ONEOF`, check if the field is a submessage and if the current tag does not match the stored tag, reset the field data and set default values for submessage fields. Update the tag and decode the field using [`decode_basic_field`](<#checkreturndecode_basic_field>).
    - Return an error if the field type is invalid.
- **Output**: Returns a boolean value indicating success (`true`) or failure (`false`) of the decoding process.
- **Functions Called**:
    - [`checkreturn::decode_basic_field`](<#checkreturndecode_basic_field>)
    - [`checkreturn::pb_make_string_substream`](<#checkreturnpb_make_string_substream>)
    - [`checkreturn::pb_close_string_substream`](<#checkreturnpb_close_string_substream>)
    - [`pb_field_iter_begin`](<pb_common.c.md#pb_field_iter_begin>)
    - [`pb_message_set_to_defaults`](<#pb_message_set_to_defaults>)


---
### allocate\_field<!-- {{#callable:checkreturn::allocate_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L562>)

Allocates or reallocates memory for a field based on specified data and array sizes, ensuring no overflow occurs.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure, used for error reporting.
    - `pData`: A pointer to a pointer where the allocated memory address will be stored.
    - `data_size`: The size of each element to allocate.
    - `array_size`: The number of elements to allocate.
- **Logic and Control Flow**:
    - Check if `data_size` or `array_size` is zero and return an error if true.
    - For AVR systems, adjust `data_size` to 2 if both `data_size` and `array_size` are 1 to avoid a known bug.
    - Check for potential multiplication overflow by comparing `data_size` and `array_size` against a calculated limit.
    - If overflow is possible, perform a division check to ensure the total size does not exceed the maximum allowable size.
    - Attempt to allocate or reallocate memory using `pb_realloc` with the calculated total size.
    - If allocation fails, return an error.
    - Store the new memory address in `pData`.
- **Output**: Returns `true` if memory allocation is successful; otherwise, returns an error through the `stream`.


---
### initialize\_pointer\_field<!-- {{#callable:initialize_pointer_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L608>)

Initializes a pointer field based on its type, setting it to NULL for strings and bytes, or zeroing it for submessages.
- **Inputs**:
    - ``pItem``: A pointer to the item to initialize.
    - ``field``: A pointer to a `pb_field_iter_t` structure that describes the field type and data size.
- **Logic and Control Flow**:
    - Check if the field type is `PB_LTYPE_STRING` or `PB_LTYPE_BYTES` using `PB_LTYPE(field->type)`; if true, set the pointer `pItem` to NULL.
    - Check if the field type is a submessage using `PB_LTYPE_IS_SUBMSG(field->type)`; if true, use `memset` to zero out the memory at `pItem` for the size specified by `field->data_size`.
- **Output**: No return value; the function modifies the memory pointed to by `pItem`.


---
### decode\_pointer\_field<!-- {{#callable:checkreturn::decode_pointer_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L624>)

Decodes a pointer field from a Protocol Buffers input stream, handling different field types and memory allocation.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the field.
    - ``wire_type``: A `pb_wire_type_t` value indicating the wire type of the field being decoded.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field iterator for the field to decode.
- **Logic and Control Flow**:
    - If `PB_ENABLE_MALLOC` is not defined, return an error indicating no malloc support.
    - Switch on the field type using `PB_HTYPE(field->type)`.
    - For `PB_HTYPE_REQUIRED`, `PB_HTYPE_OPTIONAL`, and `PB_HTYPE_ONEOF` types, check if the field is a submessage and release any existing allocation.
    - For `PB_HTYPE_ONEOF`, set the field's tag in `pSize`.
    - If the field is a string or bytes, set `pData` to `pField` and call [`decode_basic_field`](<#checkreturndecode_basic_field>).
    - Otherwise, allocate memory for the field using [`allocate_field`](<#checkreturnallocate_field>), initialize it, and call [`decode_basic_field`](<#checkreturndecode_basic_field>).
    - For `PB_HTYPE_REPEATED`, handle packed arrays by creating a substream and iterating over it to decode each entry, reallocating memory as needed.
    - For non-packed repeated fields, allocate memory for one entry, initialize it, and decode it.
    - Return an error for invalid field types.
- **Output**: Returns `true` if the field is successfully decoded, otherwise `false` if an error occurs.
- **Functions Called**:
    - [`pb_release_single_field`](<#pb_release_single_field>)
    - [`checkreturn::decode_basic_field`](<#checkreturndecode_basic_field>)
    - [`checkreturn::allocate_field`](<#checkreturnallocate_field>)
    - [`initialize_pointer_field`](<#initialize_pointer_field>)
    - [`checkreturn::pb_make_string_substream`](<#checkreturnpb_make_string_substream>)
    - [`checkreturn::pb_close_string_substream`](<#checkreturnpb_close_string_substream>)


---
### decode\_callback\_field<!-- {{#callable:checkreturn::decode_callback_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L752>)

Processes a field in a Protocol Buffers stream using a callback function if available, otherwise skips the field.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which data is read.
    - ``wire_type``: A `pb_wire_type_t` value indicating the wire type of the field being processed.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field iterator for the current field.
- **Logic and Control Flow**:
    - Check if the field has a callback function; if not, skip the field using [`pb_skip_field`](<#checkreturnpb_skip_field>) and return the result.
    - If the `wire_type` is `PB_WT_STRING`, create a substream using [`pb_make_string_substream`](<#checkreturnpb_make_string_substream>).
    - Enter a loop to process the substream with the callback function until all bytes are processed or an error occurs.
    - If the callback fails, set an error message and return false.
    - Close the substream using [`pb_close_string_substream`](<#checkreturnpb_close_string_substream>) and return true if successful.
    - For non-string wire types, read the raw value into a buffer, create a substream from the buffer, and call the callback function with the substream.
- **Output**: Returns a boolean value indicating success (`true`) or failure (`false`) of the field processing.
- **Functions Called**:
    - [`checkreturn::pb_skip_field`](<#checkreturnpb_skip_field>)
    - [`checkreturn::pb_make_string_substream`](<#checkreturnpb_make_string_substream>)
    - [`checkreturn::pb_close_string_substream`](<#checkreturnpb_close_string_substream>)
    - [`checkreturn::read_raw_value`](<#checkreturnread_raw_value>)
    - [`pb_istream_from_buffer`](<#pb_istream_from_buffer>)


---
### decode\_field<!-- {{#callable:checkreturn::decode_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L798>)

Decodes a protobuf field from a stream based on its type and wire type.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the field.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the field to decode.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to decode.
- **Logic and Control Flow**:
    - If `PB_ENABLE_MALLOC` is defined and the field is a oneof type, release any old data associated with the field using [`pb_release_union_field`](<#pb_release_union_field>) before decoding.
    - Determine the allocation type of the field using `PB_ATYPE(field->type)`.
    - If the field is static, call [`decode_static_field`](<#checkreturndecode_static_field>) to decode it.
    - If the field is a pointer, call [`decode_pointer_field`](<#checkreturndecode_pointer_field>) to decode it.
    - If the field is a callback, call [`decode_callback_field`](<#checkreturndecode_callback_field>) to decode it.
    - If the field type is invalid, return an error using `PB_RETURN_ERROR`.
- **Output**: Returns a boolean value indicating success (`true`) or failure (`false`) of the decoding process.
- **Functions Called**:
    - [`pb_release_union_field`](<#pb_release_union_field>)
    - [`checkreturn::decode_static_field`](<#checkreturndecode_static_field>)
    - [`checkreturn::decode_pointer_field`](<#checkreturndecode_pointer_field>)
    - [`checkreturn::decode_callback_field`](<#checkreturndecode_callback_field>)


---
### default\_extension\_decoder<!-- {{#callable:checkreturn::default_extension_decoder}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L829>)

Decodes a protobuf extension field by checking its tag and wire type, and marking it as found if valid.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the extension.
    - ``extension``: A pointer to a `pb_extension_t` structure representing the extension to decode.
    - ``tag``: A `uint32_t` representing the tag of the field to decode.
    - ``wire_type``: A `pb_wire_type_t` representing the wire type of the field to decode.
- **Logic and Control Flow**:
    - Initialize a `pb_field_iter_t` iterator to iterate over the extension fields.
    - Call [`pb_field_iter_begin_extension`](<pb_common.c.md#pb_field_iter_begin_extension>) to start iterating over the extension fields.
    - If the iterator cannot begin, return an error using `PB_RETURN_ERROR`.
    - Check if the current field's tag matches the provided `tag` and if the field has a message descriptor.
    - If the tag does not match or there is no message, return `true` indicating no error but no decoding.
    - Mark the extension as found by setting `extension->found` to `true`.
    - Call [`decode_field`](<#checkreturndecode_field>) to decode the field using the provided `stream`, `wire_type`, and iterator.
- **Output**: Returns `true` if the extension is successfully decoded or if the tag does not match; otherwise, returns `false` if an error occurs.
- **Functions Called**:
    - [`pb_field_iter_begin_extension`](<pb_common.c.md#pb_field_iter_begin_extension>)
    - [`checkreturn::decode_field`](<#checkreturndecode_field>)


---
### decode\_extension<!-- {{#callable:checkreturn::decode_extension}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L846>)

Attempts to decode an unknown field as an extension field using a linked list of extension decoders.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which data is read.
    - ``tag``: A `uint32_t` representing the tag of the field to decode.
    - ``wire_type``: A `pb_wire_type_t` representing the wire type of the field to decode.
    - ``extension``: A pointer to a `pb_extension_t` structure representing the linked list of extensions to try decoding with.
- **Logic and Control Flow**:
    - Store the current position of `stream->bytes_left` in `pos`.
    - Enter a loop that continues as long as `extension` is not `NULL` and `pos` equals `stream->bytes_left`.
    - Check if the `decode` function pointer in `extension->type` is not `NULL`.
    - If `decode` is not `NULL`, call it with `stream`, `extension`, `tag`, and `wire_type` and store the result in `status`.
    - If `decode` is `NULL`, call [`default_extension_decoder`](<#checkreturndefault_extension_decoder>) with the same parameters and store the result in `status`.
    - If `status` is `false`, return `false`.
    - Move to the next extension in the linked list by setting `extension` to `extension->next`.
    - If the loop completes without returning `false`, return `true`.
- **Output**: Returns `true` if an extension successfully decodes the field, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::default_extension_decoder`](<#checkreturndefault_extension_decoder>)


---
### pb\_field\_set\_to\_default<!-- {{#callable:pb_field_set_to_default}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L869>)

Sets a protobuf field to its default value based on its type and attributes.
- **Inputs**:
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field to set to default.
- **Logic and Control Flow**:
    - Retrieve the type of the field from the `field` structure.
    - Check if the field is an extension type using `PB_LTYPE(type) == PB_LTYPE_EXTENSION`.
    - If it is an extension, iterate over each extension and set them to defaults using [`pb_message_set_to_defaults`](<#pb_message_set_to_defaults>).
    - If the field is static (`PB_ATYPE(type) == PB_ATYPE_STATIC`), determine if the field needs initialization based on its type (optional, repeated, or oneof).
    - For optional fields, set the `has_field` flag to false.
    - For repeated or oneof fields, set the size or which_field to 0 and skip initialization of contents.
    - If initialization is needed, check if the field is a submessage with default values or callbacks, and initialize it using [`pb_message_set_to_defaults`](<#pb_message_set_to_defaults>).
    - If not a submessage, initialize the field data to zeros using `memset`.
    - If the field is a pointer type (`PB_ATYPE(type) == PB_ATYPE_POINTER`), set the pointer to NULL and initialize the array count to 0 if it is repeated or oneof.
    - If the field is a callback type (`PB_ATYPE(type) == PB_ATYPE_CALLBACK`), do not overwrite the callback.
- **Output**: Returns `true` if the field is successfully set to its default value, otherwise `false` if any operation fails.
- **Functions Called**:
    - [`pb_field_iter_begin_extension`](<pb_common.c.md#pb_field_iter_begin_extension>)
    - [`pb_message_set_to_defaults`](<#pb_message_set_to_defaults>)
    - [`pb_field_iter_begin`](<pb_common.c.md#pb_field_iter_begin>)


---
### pb\_message\_set\_to\_defaults<!-- {{#callable:pb_message_set_to_defaults}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L951>)

Sets all fields of a protobuf message to their default values, using a field iterator.
- **Inputs**:
    - ``iter``: A pointer to a `pb_field_iter_t` structure that iterates over the fields of a protobuf message.
- **Logic and Control Flow**:
    - Initialize a `pb_istream_t` stream `defstream` to an empty state and set `tag` to 0, `wire_type` to `PB_WT_VARINT`, and `eof` to false.
    - Check if the `iter` descriptor has a `default_value`. If it does, create a stream from the default value buffer and decode the first tag from it.
    - Iterate over each field using a do-while loop, calling [`pb_field_set_to_default`](<#pb_field_set_to_default>) to set each field to its default value.
    - If a default value is available for the current field, decode it using [`decode_field`](<#checkreturndecode_field>) and update the tag for the next field.
    - If the field has a size pointer (`pSize`), set it to false after decoding the default value.
    - Continue iterating over fields until [`pb_field_iter_next`](<pb_common.c.md#pb_field_iter_next>) returns false, indicating no more fields.
- **Output**: Returns `true` if all fields are successfully set to their default values, otherwise returns `false` if any operation fails.
- **Functions Called**:
    - [`pb_istream_from_buffer`](<#pb_istream_from_buffer>)
    - [`checkreturn::pb_decode_tag`](<#checkreturnpb_decode_tag>)
    - [`pb_field_set_to_default`](<#pb_field_set_to_default>)
    - [`checkreturn::decode_field`](<#checkreturndecode_field>)
    - [`pb_field_iter_next`](<pb_common.c.md#pb_field_iter_next>)


---
### pb\_decode\_inner<!-- {{#callable:checkreturn::pb_decode_inner}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L990>)

Decodes a protobuf message from a stream into a destination structure, handling extensions and ensuring all required fields are present.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which the protobuf message is read.
    - ``fields``: A pointer to a `pb_msgdesc_t` structure that describes the fields of the protobuf message to decode.
    - ``dest_struct``: A pointer to the destination structure where the decoded message will be stored.
    - ``flags``: An unsigned integer representing flags that modify the decoding behavior, such as `PB_DECODE_NOINIT` and `PB_DECODE_NULLTERMINATED`.
- **Logic and Control Flow**:
    - Initialize variables for tracking extensions and repeated fixed count fields.
    - Begin iterating over the fields using [`pb_field_iter_begin`](<pb_common.c.md#pb_field_iter_begin>) and set defaults if `PB_DECODE_NOINIT` flag is not set.
    - While there are bytes left in the stream, decode the tag and wire type using [`pb_decode_tag`](<#checkreturnpb_decode_tag>).
    - If the tag is zero and `PB_DECODE_NULLTERMINATED` flag is set, break the loop; otherwise, return an error.
    - If the tag does not match any field, check for extensions and decode if applicable, or skip the field.
    - For repeated fixed count fields, track the size and ensure it matches the expected total size.
    - For required fields, mark them as seen in the `fields_seen` bitfield.
    - Decode the field using [`decode_field`](<#checkreturndecode_field>).
    - After processing all fields, verify that all required fields and fixed count fields are present and correctly sized.
    - Return true if decoding is successful, otherwise return false.
- **Output**: Returns a boolean value indicating success (`true`) or failure (`false`) of the decoding process.
- **Functions Called**:
    - [`pb_field_iter_begin`](<pb_common.c.md#pb_field_iter_begin>)
    - [`pb_message_set_to_defaults`](<#pb_message_set_to_defaults>)
    - [`checkreturn::pb_decode_tag`](<#checkreturnpb_decode_tag>)
    - [`pb_field_iter_find`](<pb_common.c.md#pb_field_iter_find>)
    - [`pb_field_iter_find_extension`](<pb_common.c.md#pb_field_iter_find_extension>)
    - [`checkreturn::decode_extension`](<#checkreturndecode_extension>)
    - [`checkreturn::pb_skip_field`](<#checkreturnpb_skip_field>)
    - [`checkreturn::decode_field`](<#checkreturndecode_field>)


---
### pb\_decode\_ex<!-- {{#callable:checkreturn::pb_decode_ex}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1154>)

Decodes a Protocol Buffers message from an input stream into a destination structure, with optional handling for delimited messages and memory allocation.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the message.
    - `fields`: A pointer to a `pb_msgdesc_t` structure that describes the fields of the message to decode.
    - `dest_struct`: A pointer to the destination structure where the decoded message will be stored.
    - `flags`: An unsigned integer representing flags that modify the decoding behavior, such as `PB_DECODE_DELIMITED` for handling delimited messages.
- **Logic and Control Flow**:
    - Check if the `PB_DECODE_DELIMITED` flag is set.
    - If the flag is not set, call [`pb_decode_inner`](<#checkreturnpb_decode_inner>) to decode the message directly from the input stream.
    - If the flag is set, create a substream using [`pb_make_string_substream`](<#checkreturnpb_make_string_substream>) to handle the delimited message.
    - Decode the message from the substream using [`pb_decode_inner`](<#checkreturnpb_decode_inner>).
    - Close the substream using [`pb_close_string_substream`](<#checkreturnpb_close_string_substream>).
    - If `PB_ENABLE_MALLOC` is defined and decoding fails, release any allocated memory using [`pb_release`](<#pb_release>).
    - Return the status of the decoding operation.
- **Output**: Returns a boolean value indicating the success (`true`) or failure (`false`) of the decoding operation.
- **Functions Called**:
    - [`checkreturn::pb_decode_inner`](<#checkreturnpb_decode_inner>)
    - [`checkreturn::pb_make_string_substream`](<#checkreturnpb_make_string_substream>)
    - [`checkreturn::pb_close_string_substream`](<#checkreturnpb_close_string_substream>)
    - [`pb_release`](<#pb_release>)


---
### pb\_decode<!-- {{#callable:checkreturn::pb_decode}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1182>)

Decodes a Protocol Buffers message from an input stream into a destination structure.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the message.
    - ``fields``: A pointer to a `pb_msgdesc_t` structure that describes the fields of the message to decode.
    - ``dest_struct``: A pointer to the destination structure where the decoded message will be stored.
- **Logic and Control Flow**:
    - Calls [`pb_decode_inner`](<#checkreturnpb_decode_inner>) to perform the actual decoding of the message from the input stream into the destination structure.
    - If `PB_ENABLE_MALLOC` is defined and decoding fails, calls [`pb_release`](<#pb_release>) to release any allocated memory associated with the destination structure.
    - Returns the status of the decoding operation, indicating success or failure.
- **Output**: Returns a boolean value indicating whether the decoding was successful (`true`) or not (`false`).
- **Functions Called**:
    - [`checkreturn::pb_decode_inner`](<#checkreturnpb_decode_inner>)
    - [`pb_release`](<#pb_release>)


---
### pb\_release\_union\_field<!-- {{#callable:pb_release_union_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1199>)

Releases the old data in a union field if it differs from the new data type.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure, which represents the input stream.
    - ``field``: A pointer to a `pb_field_iter_t` structure, which represents the current field in the protobuf message.
- **Logic and Control Flow**:
    - Store the current field iterator and the old tag value from `field->pSize`.
    - Compare the old tag with zero; if it is zero, return true as there is no old data to release.
    - Compare the old tag with the new tag; if they are the same, return true as the data types match and can be merged.
    - Attempt to find the old field using [`pb_field_iter_find`](<pb_common.c.md#pb_field_iter_find>); if it fails, return an error using `PB_RETURN_ERROR`.
    - Call [`pb_release_single_field`](<#pb_release_single_field>) to release the old field data.
    - If the field type is a pointer, set the field's pointer and data to NULL to ensure they are valid even if an error occurs.
    - Return true after successfully releasing the old data.
- **Output**: Returns `true` if the old data is successfully released or if no release is necessary; otherwise, it returns an error through `PB_RETURN_ERROR`.
- **Functions Called**:
    - [`pb_field_iter_find`](<pb_common.c.md#pb_field_iter_find>)
    - [`pb_release_single_field`](<#pb_release_single_field>)


---
### pb\_release\_single\_field<!-- {{#callable:pb_release_single_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1229>)

Releases resources associated with a single field in a protocol buffer message, handling different field types and memory management scenarios.
- **Inputs**:
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field to release.
- **Logic and Control Flow**:
    - Retrieve the field type from the `field` structure.
    - Check if the field is part of a `oneof` and if it is not the current field, return immediately.
    - If the field is an extension, iterate through all extensions and recursively release each one.
    - If the field is a submessage and not a callback, determine the number of elements to release and iterate through them, releasing each submessage.
    - If the field is a pointer type, handle repeated strings or bytes by releasing each entry and setting the size to 0.
    - Release the main pointer and set it to NULL.
- **Output**: No return value; the function operates directly on the provided `field` structure to release resources.
- **Functions Called**:
    - [`pb_field_iter_begin_extension`](<pb_common.c.md#pb_field_iter_begin_extension>)
    - [`pb_release_single_field`](<#pb_release_single_field>)
    - [`pb_release`](<#pb_release>)


---
### pb\_release<!-- {{#callable:pb_release}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1336>)

Releases resources associated with a protobuf message structure if dynamic memory allocation is enabled.
- **Inputs**:
    - ``fields``: A pointer to a `pb_msgdesc_t` structure that describes the fields of the protobuf message.
    - ``dest_struct``: A pointer to the destination structure where the protobuf message is stored.
- **Logic and Control Flow**:
    - Checks if `PB_ENABLE_MALLOC` is defined to determine if dynamic memory allocation is enabled.
    - If `PB_ENABLE_MALLOC` is not defined, the function does nothing and returns immediately.
    - If `PB_ENABLE_MALLOC` is defined, it would release any dynamically allocated memory associated with the protobuf message fields.
- **Output**: No output is returned as the function is of type `void`.


---
### pb\_decode\_bool<!-- {{#callable:pb_decode_bool}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1346>)

Decodes a boolean value from a protobuf input stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the boolean value.
    - ``dest``: A pointer to a boolean variable where the decoded value will be stored.
- **Logic and Control Flow**:
    - Calls [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) to decode a 32-bit variable-length integer from the input stream into `value`.
    - Checks if [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) returns false, indicating a failure to decode, and returns false in that case.
    - Casts the `dest` pointer to a boolean pointer and assigns it the result of the expression `(value != 0)`, which evaluates to true if `value` is non-zero and false otherwise.
    - Returns true to indicate successful decoding.
- **Output**: Returns a boolean value indicating whether the decoding was successful (`true`) or not (`false`).
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32`](<#checkreturnpb_decode_varint32>)


---
### pb\_decode\_svarint<!-- {{#callable:pb_decode_svarint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1356>)

Decodes a signed variable-length integer from a protobuf input stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the signed variable-length integer.
    - ``dest``: A pointer to a `pb_int64_t` variable where the decoded signed integer will be stored.
- **Logic and Control Flow**:
    - Call [`pb_decode_varint`](<#checkreturnpb_decode_varint>) to decode an unsigned variable-length integer from the `stream` into `value`.
    - Check if the least significant bit of `value` is set (i.e., `value & 1`).
    - If the least significant bit is set, store the bitwise negation of `value` right-shifted by 1 into `*dest`.
    - If the least significant bit is not set, store `value` right-shifted by 1 into `*dest`.
    - Return `true` to indicate successful decoding.
- **Output**: Returns `true` if the signed variable-length integer is successfully decoded and stored in `*dest`; otherwise, returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint`](<#checkreturnpb_decode_varint>)


---
### pb\_decode\_fixed32<!-- {{#callable:pb_decode_fixed32}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1370>)

Decodes a 32-bit fixed-length integer from a protobuf input stream into a destination variable.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the 32-bit fixed-length integer.
    - ``dest``: A pointer to a memory location where the decoded 32-bit integer will be stored.
- **Logic and Control Flow**:
    - Declare a union `u` with a 32-bit integer and a 4-byte array to facilitate byte manipulation.
    - Call [`pb_read`](<#checkreturnpb_read>) to read 4 bytes from the `stream` into `u.bytes`. If reading fails, return `false`.
    - If the system is little-endian, directly assign `u.fixed32` to the destination pointer `dest`.
    - If the system is not little-endian, manually construct the 32-bit integer from `u.bytes` by shifting and combining the bytes.
    - Return `true` to indicate successful decoding.
- **Output**: Returns `true` if the decoding is successful, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_decode\_fixed64<!-- {{#callable:pb_decode_fixed64}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1393>)

Decodes an 8-byte fixed-length value from a protobuf input stream into a 64-bit unsigned integer.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the 8-byte value.
    - ``dest``: A pointer to a memory location where the decoded 64-bit unsigned integer will be stored.
- **Logic and Control Flow**:
    - Declare a union `u` with a `uint64_t` member `fixed64` and an 8-byte array `bytes`.
    - Call [`pb_read`](<#checkreturnpb_read>) to read 8 bytes from `stream` into `u.bytes`. If [`pb_read`](<#checkreturnpb_read>) fails, return `false`.
    - If the system is little-endian, directly assign `u.fixed64` to the location pointed by `dest`.
    - If the system is not little-endian, manually construct the 64-bit integer from `u.bytes` and assign it to `dest`.
    - Return `true` to indicate successful decoding.
- **Output**: Returns `true` if the decoding is successful, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_dec\_bool<!-- {{#callable:checkreturn::pb_dec_bool}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1420>)

Decodes a boolean value from a protobuf input stream and stores it in the specified field.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the boolean value.
    - ``field``: A pointer to a `pb_field_iter_t` structure that contains the field where the decoded boolean value will be stored.
- **Logic and Control Flow**:
    - Calls the [`pb_decode_bool`](<#pb_decode_bool>) function, passing the `stream` and the address of the boolean data in `field->pData` as arguments.
    - Returns the result of the [`pb_decode_bool`](<#pb_decode_bool>) function call, which indicates success or failure of the decoding operation.
- **Output**: Returns a boolean value indicating whether the decoding operation was successful (`true`) or not (`false`).
- **Functions Called**:
    - [`pb_decode_bool`](<#pb_decode_bool>)


---
### pb\_dec\_varint<!-- {{#callable:checkreturn::pb_dec_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1425>)

Decodes a variable-length integer from a protobuf input stream and stores it in the specified field, handling both unsigned and signed varints.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the varint.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field where the decoded varint will be stored.
- **Logic and Control Flow**:
    - Check if the field type is `PB_LTYPE_UVARINT` for unsigned varints.
    - If unsigned, decode the varint using [`pb_decode_varint`](<#checkreturnpb_decode_varint>) and store it in `value`.
    - Cast `value` to the appropriate field size (`pb_uint64_t`, `uint32_t`, `uint_least16_t`, or `uint_least8_t`) and store it in `field->pData`.
    - Check for overflow by comparing `clamped` with `value`; return an error if they differ.
    - If the field type is not `PB_LTYPE_UVARINT`, check if it is `PB_LTYPE_SVARINT` for signed varints.
    - If signed, decode the varint using [`pb_decode_svarint`](<#pb_decode_svarint>) and store it in `svalue`.
    - If not signed, decode the varint using [`pb_decode_varint`](<#checkreturnpb_decode_varint>) and cast it to `svalue` based on the field size.
    - Cast `svalue` to the appropriate field size (`pb_int64_t`, `int32_t`, `int_least16_t`, or `int_least8_t`) and store it in `field->pData`.
    - Check for overflow by comparing `clamped` with `svalue`; return an error if they differ.
    - Return `true` if decoding and storage are successful.
- **Output**: Returns `true` if the varint is successfully decoded and stored in the field, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint`](<#checkreturnpb_decode_varint>)
    - [`pb_decode_svarint`](<#pb_decode_svarint>)


---
### pb\_dec\_bytes<!-- {{#callable:checkreturn::pb_dec_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1497>)

Decodes a byte array from a Protocol Buffers input stream into a specified field.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the byte array.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field where the decoded byte array will be stored.
- **Logic and Control Flow**:
    - Call [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) to read the size of the byte array from the stream.
    - Check if the size exceeds `PB_SIZE_MAX` and return an error if true.
    - Calculate `alloc_size` using `PB_BYTES_ARRAY_T_ALLOCSIZE(size)`.
    - Check if `size` exceeds `alloc_size` and return an error if true.
    - If the field type is a pointer and `PB_ENABLE_MALLOC` is defined, check if the stream has enough bytes left and allocate memory for the field using [`allocate_field`](<#checkreturnallocate_field>).
    - If the field type is not a pointer, check if `alloc_size` exceeds `field->data_size` and return an error if true.
    - Set `dest->size` to the decoded size.
    - Call [`pb_read`](<#checkreturnpb_read>) to read the byte array from the stream into `dest->bytes`.
- **Output**: Returns `true` if the byte array is successfully decoded and stored in the field, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32`](<#checkreturnpb_decode_varint32>)
    - [`checkreturn::allocate_field`](<#checkreturnallocate_field>)
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_dec\_string<!-- {{#callable:checkreturn::pb_dec_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1537>)

Decodes a string from a protobuf input stream and stores it in a specified field, handling memory allocation and UTF-8 validation if enabled.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which the string is decoded.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field where the decoded string will be stored.
- **Logic and Control Flow**:
    - Call [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) to read the size of the string from the stream.
    - Check if the size is valid and not too large, returning an error if it is.
    - Calculate the allocation size, including space for a null terminator, and check for overflow.
    - If the field type is a pointer and malloc is enabled, allocate memory for the string and update the destination pointer.
    - If the field type is not a pointer, check if the allocation size fits within the field's data size, returning an error if it does not.
    - Set the null terminator at the end of the destination buffer.
    - Call [`pb_read`](<#checkreturnpb_read>) to read the string data from the stream into the destination buffer.
    - If UTF-8 validation is enabled, call [`pb_validate_utf8`](<pb_common.c.md#pb_validate_utf8>) to check the validity of the string, returning an error if it is invalid.
    - Return true if all operations succeed.
- **Output**: Returns `true` if the string is successfully decoded and stored, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32`](<#checkreturnpb_decode_varint32>)
    - [`checkreturn::allocate_field`](<#checkreturnallocate_field>)
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)
    - [`pb_validate_utf8`](<pb_common.c.md#pb_validate_utf8>)


---
### pb\_dec\_submessage<!-- {{#callable:checkreturn::pb_dec_submessage}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1587>)

Decodes a submessage from a protobuf input stream, handling optional message-level callbacks and ensuring proper submessage initialization.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which the submessage is decoded.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field descriptor for the submessage to be decoded.
- **Logic and Control Flow**:
    - Initialize `status` to true and `submsg_consumed` to false.
    - Create a `substream` and attempt to make a string substream from `stream`. If unsuccessful, return false.
    - Check if `field->submsg_desc` is NULL, and if so, return an error using `PB_RETURN_ERROR`.
    - If the field type is `PB_LTYPE_SUBMSG_W_CB` and `field->pSize` is not NULL, retrieve the message callback and execute it if it exists.
    - If the callback is executed and `substream.bytes_left` is 0, set `submsg_consumed` to true.
    - If `status` is true and `submsg_consumed` is false, decode the submessage contents using [`pb_decode_inner`](<#checkreturnpb_decode_inner>).
    - Close the string substream using [`pb_close_string_substream`](<#checkreturnpb_close_string_substream>). If unsuccessful, return false.
    - Return the final `status`.
- **Output**: Returns a boolean indicating the success or failure of the submessage decoding process.
- **Functions Called**:
    - [`checkreturn::pb_make_string_substream`](<#checkreturnpb_make_string_substream>)
    - [`checkreturn::pb_decode_inner`](<#checkreturnpb_decode_inner>)
    - [`checkreturn::pb_close_string_substream`](<#checkreturnpb_close_string_substream>)


---
### pb\_dec\_fixed\_length\_bytes<!-- {{#callable:checkreturn::pb_dec_fixed_length_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1639>)

Decodes a fixed-length byte array from a protobuf input stream and verifies its size.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which to read the data.
    - ``field``: A pointer to a `pb_field_iter_t` structure representing the field metadata, including where to store the decoded data and the expected size of the byte array.
- **Logic and Control Flow**:
    - Call [`pb_decode_varint32`](<#checkreturnpb_decode_varint32>) to read the size of the byte array from the input stream.
    - If the size exceeds `PB_SIZE_MAX`, return an error indicating a bytes overflow.
    - If the size is zero, set the memory at `field->pData` to all zeros for the length specified by `field->data_size` and return true.
    - If the size does not match `field->data_size`, return an error indicating an incorrect fixed length bytes size.
    - Call [`pb_read`](<#checkreturnpb_read>) to read the byte array from the stream into `field->pData` and return the result.
- **Output**: Returns `true` if the byte array is successfully decoded and matches the expected size, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_decode_varint32`](<#checkreturnpb_decode_varint32>)
    - [`checkreturn::pb_read`](<#checkreturnpb_read>)


---
### pb\_decode\_double\_as\_float<!-- {{#callable:pb_decode_double_as_float}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L1663>)

Converts a double-precision floating-point number from a stream into a single-precision floating-point number.
- **Inputs**:
    - ``stream``: A pointer to a `pb_istream_t` structure representing the input stream from which the double value is read.
    - ``dest``: A pointer to a float where the converted single-precision floating-point number will be stored.
- **Logic and Control Flow**:
    - Call [`pb_decode_fixed64`](<#pb_decode_fixed64>) to read a 64-bit value from the `stream` into `value`.
    - Extract the sign bit from `value` and store it in `sign`.
    - Extract the exponent bits from `value`, adjust the bias, and store it in `exponent`.
    - Extract the highest 24 bits of the mantissa from `value` and store it in `mantissa`.
    - Check if the `exponent` indicates a special value (e.g., infinity or NaN) and adjust `exponent` and `mantissa` accordingly.
    - If `exponent` is too large, set `exponent` to represent infinity and `mantissa` to zero.
    - If `exponent` is too small, set `exponent` to represent zero and `mantissa` to zero.
    - If `exponent` is in the denormalized range, adjust `mantissa` and set `exponent` to represent a denormalized number.
    - Round the `mantissa` by adding 1 and shifting right by 1.
    - If `mantissa` exceeds the maximum representable value, adjust `exponent` and `mantissa`.
    - Combine `mantissa`, `exponent`, and `sign` into a 32-bit integer `out.i`.
    - Store the resulting float in `dest`.
    - Return `true` to indicate successful conversion.
- **Output**: Returns `true` if the conversion is successful, otherwise `false`.
- **Functions Called**:
    - [`pb_decode_fixed64`](<#pb_decode_fixed64>)


# Function Declarations (Public API)

---
### buf\_read<!-- {{#callable_declaration:checkreturn::buf_read}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L25>)

Reads bytes from a stream into a buffer.
- **Description**: Use this function to read a specified number of bytes from a given input stream into a buffer. It updates the stream's state to reflect the number of bytes read. If the buffer is not null, the function copies the bytes into it. This function always returns true, indicating successful reading, but it is important to ensure that the stream has enough bytes available before calling this function.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. The stream's state is updated to reflect the bytes read. Must not be null.
    - `buf`: A pointer to a buffer where the read bytes will be stored. Can be null if the bytes do not need to be stored.
    - `count`: The number of bytes to read from the stream. Must be a non-negative value.
- **Output**: Returns true to indicate successful reading of bytes.
- **See Also**: [`checkreturn::buf_read`](<#checkreturnbuf_read>)  (Implementation)


---
### pb\_decode\_varint32\_eof<!-- {{#callable_declaration:checkreturn::pb_decode_varint32_eof}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L26>)

Decodes a 32-bit varint from a protobuf stream.
- **Description**: Use this function to decode a 32-bit varint from a protobuf input stream. It reads from the stream and stores the decoded value in the provided destination. If the stream reaches the end without reading a complete varint, it sets the EOF flag if provided. This function must be called with a valid input stream and destination pointer. It returns false if it encounters an error, such as an overflow or end-of-stream without a complete varint.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null and must be properly initialized.
    - `dest`: A pointer to a `uint32_t` where the decoded varint will be stored. Must not be null.
    - `eof`: An optional pointer to a `bool` that will be set to true if the end of the stream is reached without reading a complete varint. Can be null if not needed.
- **Output**: Returns a boolean value: true if the varint is successfully decoded, false if an error occurs (e.g., end-of-stream or varint overflow).
- **See Also**: [`checkreturn::pb_decode_varint32_eof`](<#checkreturnpb_decode_varint32_eof>)  (Implementation)


---
### read\_raw\_value<!-- {{#callable_declaration:checkreturn::read_raw_value}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L27>)

Reads a raw value from a protobuf input stream.
- **Description**: Use this function to read a raw value from a protobuf input stream based on the specified wire type. It supports reading varint, 64-bit, and 32-bit wire types. The function updates the size parameter to reflect the actual size of the data read. It returns false if an error occurs, such as an invalid wire type or if the stream ends unexpectedly. Ensure that the buffer provided is large enough to hold the data, as specified by the initial value of the size parameter.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the data to read. Valid values are `PB_WT_VARINT`, `PB_WT_64BIT`, and `PB_WT_32BIT`. `PB_WT_STRING` and other values are considered invalid.
    - `buf`: A pointer to a buffer where the function will store the read data. Must not be null and should have enough space as indicated by the initial value of `size`.
    - `size`: A pointer to a size_t variable that initially contains the maximum size of the buffer. The function updates it to the actual size of the data read. Must not be null.
- **Output**: Returns a boolean value: true if the read operation is successful, false otherwise.
- **See Also**: [`checkreturn::read_raw_value`](<#checkreturnread_raw_value>)  (Implementation)


---
### decode\_basic\_field<!-- {{#callable_declaration:checkreturn::decode_basic_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L28>)

Decodes a basic field from a protobuf stream.
- **Description**: Use this function to decode a basic field from a protobuf input stream. It supports various field types such as boolean, varint, fixed32, fixed64, bytes, string, submessage, and fixed-length bytes. The function checks the wire type against the expected type for the field and returns an error if they do not match. It is important to ensure that the stream and field parameters are correctly initialized before calling this function. The function returns a boolean indicating success or failure, and it is crucial to check this return value to handle errors appropriately.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null and should be properly initialized before calling.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the field to decode. Must match the expected wire type for the field type.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to decode. Must not be null and should be properly initialized before calling.
- **Output**: Returns a boolean value: `true` if the field is successfully decoded, `false` if an error occurs (e.g., wrong wire type or invalid field type).
- **See Also**: [`checkreturn::decode_basic_field`](<#checkreturndecode_basic_field>)  (Implementation)


---
### decode\_static\_field<!-- {{#callable_declaration:checkreturn::decode_static_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L29>)

Decodes a static field from a protobuf stream.
- **Description**: Use this function to decode a static field from a protobuf input stream. It handles different field types such as required, optional, repeated, and oneof. The function expects the stream to be properly initialized and the field iterator to point to a valid field. It manages packed arrays and ensures that repeated fields do not exceed their allocated size. If the field type is invalid, the function returns an error. This function must be used in contexts where the return value is checked to ensure successful decoding.
- **Inputs**:
    - `stream`: Pointer to a `pb_istream_t` structure representing the input stream. Must not be null and should be properly initialized.
    - `wire_type`: The wire type of the field being decoded. Must be a valid `pb_wire_type_t` value.
    - `field`: Pointer to a `pb_field_iter_t` structure representing the field to decode. Must not be null and should point to a valid field.
- **Output**: Returns a boolean value indicating success (true) or failure (false) of the decoding process.
- **See Also**: [`checkreturn::decode_static_field`](<#checkreturndecode_static_field>)  (Implementation)


---
### decode\_pointer\_field<!-- {{#callable_declaration:checkreturn::decode_pointer_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L30>)

Decodes a protobuf field with pointer allocation.
- **Description**: Use this function to decode a protobuf field that requires dynamic memory allocation. It handles different field types, including required, optional, oneof, and repeated fields. Ensure that `PB_ENABLE_MALLOC` is defined to enable memory allocation. If not, the function will return an error. This function is suitable for fields that may require memory allocation, such as strings, bytes, and submessages. It manages memory allocation and initialization for these fields, ensuring that old allocations are released when necessary.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the field. Must be a valid wire type.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to decode. Must not be null and must be properly initialized.
- **Output**: Returns `true` if the field is successfully decoded; otherwise, returns `false` if an error occurs, such as memory allocation failure or invalid field type.
- **See Also**: [`checkreturn::decode_pointer_field`](<#checkreturndecode_pointer_field>)  (Implementation)


---
### decode\_callback\_field<!-- {{#callable_declaration:checkreturn::decode_callback_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L31>)

Processes a field using a callback if available.
- **Description**: Use this function to process a field in a protocol buffer stream when a callback is defined for the field. If the field's wire type is `PB_WT_STRING`, it creates a substream to handle the string data. For other wire types, it reads the raw value into a buffer and processes it. If no callback is defined, it skips the field. This function must be used within the context of decoding a protocol buffer message and assumes that the stream and field iterator are correctly initialized.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null and should be properly initialized with data to decode.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the field. Must be a valid wire type for the field being processed.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field iterator. Must not be null and should point to a valid field descriptor with a potential callback.
- **Output**: Returns `true` if the field is successfully processed or skipped, and `false` if an error occurs during processing.
- **See Also**: [`checkreturn::decode_callback_field`](<#checkreturndecode_callback_field>)  (Implementation)


---
### decode\_field<!-- {{#callable_declaration:checkreturn::decode_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L32>)

Decodes a protobuf field from the input stream.
- **Description**: Use this function to decode a single field from a protobuf input stream. It handles different field types, including static, pointer, and callback fields. The function must be called with a valid input stream, wire type, and field iterator. It returns a boolean indicating success or failure, and it is important to check this return value to ensure the field was decoded correctly. The function may modify the field iterator to reflect the decoded data.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null and should be properly initialized with data to decode.
    - `wire_type`: A `pb_wire_type_t` value indicating the wire type of the field to decode. Must be a valid wire type for the field.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to decode. Must not be null and should point to a valid field iterator.
- **Output**: Returns a boolean value: `true` if the field was successfully decoded, `false` otherwise.
- **See Also**: [`checkreturn::decode_field`](<#checkreturndecode_field>)  (Implementation)


---
### default\_extension\_decoder<!-- {{#callable_declaration:checkreturn::default_extension_decoder}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L33>)

Decodes a protobuf extension field.
- **Description**: Use this function to decode a protobuf extension field from a given input stream. It checks if the extension matches the specified tag and wire type, and if so, marks the extension as found and decodes the field. This function must be called with a valid extension and stream, and it assumes that the extension has a single field described by a message descriptor. It returns a boolean indicating success or failure, and the caller must handle the return value to ensure proper error handling.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null. The function reads from this stream.
    - `extension`: A pointer to a `pb_extension_t` structure representing the extension to decode. Must not be null. The function checks and updates this extension.
    - `tag`: A `uint32_t` value representing the expected tag of the extension field. The function uses this to verify the field.
    - `wire_type`: A `pb_wire_type_t` value representing the expected wire type of the extension field. The function uses this to verify the field.
- **Output**: Returns a boolean value: `true` if the extension was successfully decoded or if the tag does not match; `false` if an error occurred during decoding.
- **See Also**: [`checkreturn::default_extension_decoder`](<#checkreturndefault_extension_decoder>)  (Implementation)


---
### decode\_extension<!-- {{#callable_declaration:checkreturn::decode_extension}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L34>)

Decodes a protobuf extension field.
- **Description**: Use this function to decode a protobuf extension field from a given input stream. It attempts to decode the field using the provided extension decoders. If a decoder is not specified, it uses a default decoder. The function processes each extension in the linked list until it successfully decodes the field or exhausts the list. It returns a boolean indicating success or failure, which must be checked by the caller.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. It must be valid and initialized before calling this function.
    - `tag`: A `uint32_t` representing the tag of the field to decode. It must be a valid tag value.
    - `wire_type`: A `pb_wire_type_t` representing the wire type of the field. It must be a valid wire type for the field.
    - `extension`: A pointer to a `pb_extension_t` structure representing the extension to decode. It can be null, in which case the function will not attempt to decode any extensions.
- **Output**: Returns `true` if the extension is successfully decoded, otherwise `false`. The caller must check the return value to ensure correct decoding.
- **See Also**: [`checkreturn::decode_extension`](<#checkreturndecode_extension>)  (Implementation)


---
### pb\_field\_set\_to\_default<!-- {{#callable_declaration:pb_field_set_to_default}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L35>)

Sets a protobuf field to its default value.
- **Description**: Use this function to reset a protobuf field to its default state. It handles different field types, including extensions, static fields, pointers, and callbacks. This function is useful when you need to ensure that a field is in its initial state before processing or reusing it. It must be called with a valid `pb_field_iter_t` structure that represents the field to reset. The function returns a boolean indicating success or failure, which should be checked to ensure the operation completed successfully.
- **Inputs**:
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to reset. Must not be null. The function expects this structure to be properly initialized and valid.
- **Output**: Returns `true` if the field was successfully set to its default value, or `false` if an error occurred during the process.
- **See Also**: [`pb_field_set_to_default`](<#pb_field_set_to_default>)  (Implementation)


---
### pb\_message\_set\_to\_defaults<!-- {{#callable_declaration:pb_message_set_to_defaults}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L36>)

Sets all fields in a protobuf message to their default values.
- **Description**: Use this function to initialize all fields in a protobuf message to their default values as specified in the message descriptor. This function must be called before any other operations on the message to ensure that all fields are in a known state. It handles optional fields, repeated fields, and fields with default values. If a field has a default value specified, it will be set accordingly. The function returns a boolean indicating success or failure, which should be checked to ensure that the operation completed successfully.
- **Inputs**:
    - `iter`: A pointer to a `pb_field_iter_t` structure that iterates over the fields of the message. Must not be null. The iterator should be properly initialized to point to the first field of the message.
- **Output**: Returns `true` if all fields are successfully set to their default values, or `false` if an error occurs during the process.
- **See Also**: [`pb_message_set_to_defaults`](<#pb_message_set_to_defaults>)  (Implementation)


---
### pb\_dec\_bool<!-- {{#callable_declaration:checkreturn::pb_dec_bool}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L37>)

Decodes a boolean value from a protobuf stream.
- **Description**: Use this function to decode a boolean value from a protobuf input stream and store it in the specified field. It is important to ensure that the `stream` and `field` parameters are valid and properly initialized before calling this function. The function will return a boolean indicating the success of the decoding operation. This function is typically used in the context of decoding protobuf messages where a boolean field is expected.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which the boolean value is to be decoded. Must not be null and should be properly initialized.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field where the decoded boolean value will be stored. The `pData` member of this structure must point to a valid memory location where the boolean value can be stored.
- **Output**: Returns a boolean value indicating whether the decoding was successful. `true` if successful, `false` otherwise.
- **See Also**: [`checkreturn::pb_dec_bool`](<#checkreturnpb_dec_bool>)  (Implementation)


---
### pb\_dec\_varint<!-- {{#callable_declaration:checkreturn::pb_dec_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L38>)

Decodes a varint from the input stream and stores it in the field.
- **Description**: Use this function to decode a varint from a protobuf input stream and store the result in the specified field. The function checks the field type and size to ensure correct decoding and handles both unsigned and signed varints. It also checks for overflow and invalid data sizes, returning false if any errors occur. This function must be called with a valid input stream and field iterator, and it is important to check the return value to ensure successful decoding.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null. The function reads from this stream.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to store the decoded varint. Must not be null. The function writes the decoded value to the location specified by this field.
- **Output**: Returns a boolean value: true if decoding is successful, false if an error occurs (e.g., overflow, invalid data size).
- **See Also**: [`checkreturn::pb_dec_varint`](<#checkreturnpb_dec_varint>)  (Implementation)


---
### pb\_dec\_bytes<!-- {{#callable_declaration:checkreturn::pb_dec_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L39>)

Decodes a byte array from a protobuf stream.
- **Description**: Use this function to decode a byte array from a protobuf input stream and store it in the specified field. Ensure that the stream has enough bytes available for the operation. If the field is a pointer type and dynamic memory allocation is enabled, the function will allocate memory for the byte array. Otherwise, the function will store the byte array directly in the provided field. Handle any errors that occur during decoding, such as size overflows or end-of-stream conditions.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null and must have sufficient bytes left for the operation.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field where the decoded byte array will be stored. Must not be null. The field type determines whether memory allocation is required.
- **Output**: Returns `true` if the byte array is successfully decoded and stored; otherwise, returns `false` if an error occurs, such as a size overflow or end-of-stream condition.
- **See Also**: [`checkreturn::pb_dec_bytes`](<#checkreturnpb_dec_bytes>)  (Implementation)


---
### pb\_dec\_string<!-- {{#callable_declaration:checkreturn::pb_dec_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L40>)

Decodes a string from a protobuf input stream.
- **Description**: Use this function to decode a string field from a protobuf input stream into a specified field. It reads the string length as a varint and then reads the string data. If the field is a pointer type and dynamic memory allocation is enabled, it allocates memory for the string. The function ensures the string is null-terminated and validates UTF-8 encoding if enabled. It returns false if any error occurs, such as end-of-stream, size overflow, or invalid UTF-8.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null. The stream should have enough bytes left to read the string.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to decode into. Must not be null. The field's `pData` should point to a buffer or a pointer where the decoded string will be stored.
- **Output**: Returns a boolean value: true if the string is successfully decoded, false otherwise.
- **See Also**: [`checkreturn::pb_dec_string`](<#checkreturnpb_dec_string>)  (Implementation)


---
### pb\_dec\_submessage<!-- {{#callable_declaration:checkreturn::pb_dec_submessage}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L41>)

Decodes a submessage from a protobuf input stream.
- **Description**: Use this function to decode a submessage from a protobuf input stream. It requires a valid field descriptor for the submessage. If the field descriptor is null, the function will return an error. The function supports message-level callbacks for submessages, which are executed before decoding the message. This is useful for setting callback fields inside oneofs. Ensure that the input stream is properly initialized and contains the expected submessage data.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null and should be properly initialized with the data to decode.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field descriptor for the submessage. Must not be null and must contain a valid submessage descriptor.
- **Output**: Returns a boolean value indicating success or failure of the decoding process. Returns false if the submessage cannot be decoded or if any errors occur during the process.
- **See Also**: [`checkreturn::pb_dec_submessage`](<#checkreturnpb_dec_submessage>)  (Implementation)


---
### pb\_dec\_fixed\_length\_bytes<!-- {{#callable_declaration:checkreturn::pb_dec_fixed_length_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L42>)

Decodes fixed-length byte arrays from a stream.
- **Description**: Use this function to decode a fixed-length byte array from a protobuf input stream. It checks that the size of the byte array in the stream matches the expected fixed length specified by the field. If the size is zero, it initializes the field's data to all zeros. This function must be called with a valid input stream and field iterator, and it expects the field's data size to match the size specified in the stream. If the sizes do not match, or if the size exceeds the maximum allowed, the function returns an error.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null. The function reads from this stream.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to decode. Must not be null. The function writes the decoded bytes to the location specified by `field->pData`.
- **Output**: Returns `true` if the decoding is successful, otherwise returns `false` if there is an error, such as size mismatch or stream read failure.
- **See Also**: [`checkreturn::pb_dec_fixed_length_bytes`](<#checkreturnpb_dec_fixed_length_bytes>)  (Implementation)


---
### pb\_skip\_varint<!-- {{#callable_declaration:checkreturn::pb_skip_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L43>)

Skips over a varint in the input stream.
- **Description**: Use this function to skip a varint in a protobuf input stream without decoding it. This is useful when you want to ignore certain fields in a protobuf message. The function reads bytes from the stream until it encounters a byte that does not have the continuation bit set. Ensure that the input stream is valid and has enough bytes to read a complete varint. If the stream ends before a complete varint is read, the function returns false.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. Must not be null. The stream should be properly initialized and have enough bytes left to read a complete varint. If the stream is invalid or ends prematurely, the function returns false.
- **Output**: Returns `true` if the varint was successfully skipped, or `false` if an error occurred (e.g., end of stream).
- **See Also**: [`checkreturn::pb_skip_varint`](<#checkreturnpb_skip_varint>)  (Implementation)


---
### pb\_skip\_string<!-- {{#callable_declaration:checkreturn::pb_skip_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L44>)

Skips a string field in a protobuf input stream.
- **Description**: Use this function to skip over a string field in a protobuf input stream without processing its content. This is useful when you do not need the data of the string field but want to continue processing the rest of the stream. The function must be called with a valid input stream that has been initialized. It returns false if it encounters an error, such as an invalid varint or if the size of the string is too large to handle. Ensure that the stream is correctly positioned at the start of a string field before calling this function.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream. The stream must be valid and properly initialized. The function will return false if the stream is null or if an error occurs during processing.
- **Output**: Returns a boolean value: true if the string was successfully skipped, or false if an error occurred.
- **See Also**: [`checkreturn::pb_skip_string`](<#checkreturnpb_skip_string>)  (Implementation)


---
### allocate\_field<!-- {{#callable_declaration:checkreturn::allocate_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L47>)

Allocates or resizes memory for a field.
- **Description**: Use this function to allocate or resize memory for a field in a protocol buffer stream. It is important to ensure that both `data_size` and `array_size` are greater than zero before calling this function. The function will return an error if the requested size is too large or if memory allocation fails. The caller is responsible for freeing the memory, even if an error occurs.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure that represents the input stream. It must not be null.
    - `pData`: A pointer to a pointer where the allocated memory address will be stored. The caller retains ownership and must ensure it is not null.
    - `data_size`: The size of each element to allocate. Must be greater than zero. If zero, the function returns an error.
    - `array_size`: The number of elements to allocate. Must be greater than zero. If zero, the function returns an error.
- **Output**: Returns `true` if memory allocation is successful. Returns `false` and sets an error message in the stream if allocation fails or if input sizes are invalid.
- **See Also**: [`checkreturn::allocate_field`](<#checkreturnallocate_field>)  (Implementation)


---
### initialize\_pointer\_field<!-- {{#callable_declaration:initialize_pointer_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L48>)

Initializes a pointer field based on its type.
- **Description**: Use this function to initialize a pointer field in a protocol buffer message. It sets the pointer to NULL if the field is of type string or bytes. For submessage types, it zeroes out the memory to ensure any callbacks are set to NULL. This function is typically used during the allocation of fields to ensure they are in a known state before use.
- **Inputs**:
    - `pItem`: A pointer to the memory location of the field to initialize. Must not be null.
    - `field`: A pointer to a `pb_field_iter_t` structure that describes the field. Must not be null.
- **Output**: None
- **See Also**: [`initialize_pointer_field`](<#initialize_pointer_field>)  (Implementation)


---
### pb\_release\_single\_field<!-- {{#callable_declaration:pb_release_single_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_decode.c#L50>)

Releases resources associated with a protobuf field.
- **Description**: Use this function to release any dynamically allocated resources associated with a protobuf field. It is important to call this function when you are done with a field to prevent memory leaks. This function handles different field types, including extensions, submessages, and repeated fields. It must be called only if dynamic memory allocation is enabled (`PB_ENABLE_MALLOC` is defined). Ensure that the `field` parameter is correctly initialized and points to a valid `pb_field_iter_t` structure.
- **Inputs**:
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to release. Must not be null and must be properly initialized. The function does not check for null pointers, so passing a null pointer will result in undefined behavior.
- **Output**: None
- **See Also**: [`pb_release_single_field`](<#pb_release_single_field>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)