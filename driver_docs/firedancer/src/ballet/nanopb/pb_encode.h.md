<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions and structures for encoding protocol buffers, including custom output streams and field callbacks.

# Purpose
The `pb_encode.h` file is a C header file that provides function declarations and data structures for encoding protocol buffers using the nanopb library. It defines the `pb_ostream_s` structure, which is used to create custom output streams for writing encoded data to various storage mediums, such as files or network sockets. The main function, [`pb_encode`](<#pb_encode>), encodes a protocol buffer message from a C structure into a stream, while [`pb_encode_ex`](<#pb_encode_ex>) offers additional options for encoding, such as delimited or null-terminated messages. The file also includes utility functions for creating output streams, measuring message sizes, and encoding various data types, such as integers, strings, and submessages. Additionally, it provides macros and functions for backward compatibility and stream manipulation.
# Imports and Dependencies

---
- `pb_firedancer.h`


# Data Structures

---
### pb\_ostream\_s
- **Type**: ``struct``
- **Members**:
    - `callback`: A function pointer used for writing bytes to storage, or an int pointer in buffer-only configuration.
    - `state`: A user-defined field for storing data used by the callback function.
    - `max_size`: The maximum number of bytes that can be written to the stream.
    - `bytes_written`: The number of bytes that have been written to the stream so far.
    - `errmsg`: A pointer to a constant string that holds an error message when decoding fails.
- **Description**: Defines a custom output stream for encoding protocol buffers, allowing users to specify a callback function for writing data to various storage mediums, such as files or network sockets. The structure includes fields for managing the state of the stream, limiting the size of the output, and tracking the number of bytes written. It also provides an optional error message field for reporting decoding errors.


# Function Declarations (Public API)

---
### pb\_get\_encoded\_size<!-- {{#callable_declaration:pb_get_encoded_size}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.h#L101>)

Calculates the size of an encoded protocol buffer message.
- **Description**: Use this function to determine the size of a protocol buffer message when encoded, without actually storing the encoded data. This is useful for allocating the correct amount of memory for the encoded message. Ensure that the `fields` parameter accurately describes the structure of `src_struct`, and that all required fields in `src_struct` are filled. The function returns false if encoding fails, which can occur if the message structure does not match the field descriptions.
- **Inputs**:
    - `size`: A pointer to a `size_t` variable where the function will store the size of the encoded message. Must not be null.
    - `fields`: A pointer to a `pb_msgdesc_t` structure that describes the fields of the message. Must not be null and must accurately describe the `src_struct`.
    - `src_struct`: A pointer to the source structure that contains the data to encode. Must not be null and must match the description in `fields`.
- **Output**: Returns true if the size calculation is successful and stores the size in the variable pointed to by `size`. Returns false if encoding fails.
- **See Also**: [`pb_get_encoded_size`](<pb_encode.c.md#pb_get_encoded_size>)  (Implementation)


---
### pb\_ostream\_from\_buffer<!-- {{#callable_declaration:pb_ostream_from_buffer}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.h#L114>)

Creates an output stream for writing into a memory buffer.
- **Description**: Use this function to initialize an output stream that writes data into a specified memory buffer. This is useful when encoding protocol buffer messages directly into memory. The function sets up the stream with the provided buffer and its size, and initializes the number of bytes written to zero. This function is typically called before encoding a message with `pb_encode`. Ensure that the buffer is large enough to hold the encoded data to prevent overflow.
- **Inputs**:
    - `buf`: A pointer to the memory buffer where the stream will write data. Must not be null, and the caller retains ownership of the buffer.
    - `bufsize`: The size of the buffer in bytes. Must be a positive value that indicates the maximum number of bytes the stream can write.
- **Output**: Returns a `pb_ostream_t` structure initialized to write to the specified buffer.
- **See Also**: [`pb_ostream_from_buffer`](<pb_encode.c.md#pb_ostream_from_buffer>)  (Implementation)


---
### pb\_encode\_tag\_for\_field<!-- {{#callable_declaration:pb_encode_tag_for_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.h#L143>)

Encodes a field header based on its type and field number.
- **Description**: Use this function to encode the header of a protocol buffer field before writing its contents. It determines the wire type based on the field's type and encodes the field's tag into the provided output stream. This function must be called with a valid output stream and field iterator. If the field type is invalid, the function returns false and sets an error message in the stream if error messages are enabled.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure representing the output stream. Must not be null. The stream must be properly initialized and ready for writing. The function will update the stream with the encoded tag or an error message if encoding fails.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to encode. Must not be null. The field must have a valid type and tag. If the field type is invalid, the function returns false.
- **Output**: Returns true if the field header is successfully encoded; otherwise, returns false if an invalid field type is encountered.
- **See Also**: [`pb_encode_tag_for_field`](<pb_encode.c.md#pb_encode_tag_for_field>)  (Implementation)


---
### pb\_encode\_float\_as\_double<!-- {{#callable_declaration:pb_encode_float_as_double}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.h#L181>)

Encodes a float value as a double in a protocol buffer stream.
- **Description**: Use this function to encode a 32-bit floating-point value as a 64-bit double-precision floating-point value in a protocol buffer stream. This is useful when you need to ensure compatibility with systems that expect double precision. The function requires a valid output stream and a float value to encode. It handles special float values like NaN and zero appropriately. Ensure the stream is properly initialized before calling this function.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream. Must not be null. The stream must be initialized and ready for writing.
    - `value`: A 32-bit floating-point value to encode. Can be any valid float, including special values like NaN or zero.
- **Output**: Returns `true` if the encoding is successful, or `false` if an error occurs during writing to the stream.
- **See Also**: [`pb_encode_float_as_double`](<pb_encode.c.md#pb_encode_float_as_double>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)