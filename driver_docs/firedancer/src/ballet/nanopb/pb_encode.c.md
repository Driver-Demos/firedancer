<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implementation of protobuf encoding functions using minimal resources, with support for various data types and extensions.

# Purpose
The `pb_encode.c` file is responsible for encoding Protocol Buffers (protobuf) messages using minimal resources. It provides functions to serialize data structures into the protobuf binary format, which is efficient for storage and transmission. The file includes several static functions that handle the encoding of different data types and structures, such as arrays, basic fields, and extension fields. It also includes helper functions to manage the encoding of variable-length integers and fixed-size data types.

The file defines the `pb_ostream_t` structure and functions like [`pb_ostream_from_buffer`](<#pb_ostream_from_buffer>), [`pb_write`](<#checkreturnpb_write>), and [`pb_encode`](<#checkreturnpb_encode>) to manage the output stream and perform the encoding process. The [`pb_encode`](<#checkreturnpb_encode>) function is a key component that iterates over message fields and encodes them based on their type and presence. The file also includes conditional compilation directives to handle different compiler attributes and configurations, such as 64-bit support and buffer-only mode. The use of the `checkreturn` attribute ensures that the return values of encoding functions are checked, which helps in error handling during the encoding process.
# Imports and Dependencies

---
- `pb_firedancer.h`
- `pb_encode.h`
- `pb_common.h`


# Functions

---
### buf\_write<!-- {{#callable:checkreturn::buf_write}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L53>)

Writes a specified number of bytes from a buffer to a stream and updates the stream's state.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream.
    - `buf`: A pointer to a buffer of type `pb_byte_t` containing the data to write.
    - `count`: The number of bytes to write from the buffer to the stream.
- **Logic and Control Flow**:
    - Cast the `state` of the `stream` to a `pb_byte_t` pointer and assign it to `dest`.
    - Update the `state` of the `stream` by adding `count` to `dest`.
    - Copy `count` bytes from `buf` to `dest` using `memcpy`.
    - Return `true` to indicate successful writing.
- **Output**: Returns `true` to indicate that the write operation was successful.


---
### pb\_ostream\_from\_buffer<!-- {{#callable:pb_ostream_from_buffer}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L63>)

Initializes a `pb_ostream_t` structure for writing to a buffer.
- **Inputs**:
    - `buf`: A pointer to a buffer where the stream will write data.
    - `bufsize`: The size of the buffer in bytes.
- **Logic and Control Flow**:
    - Declare a `pb_ostream_t` variable named `stream`.
    - Check if `PB_BUFFER_ONLY` is defined; if so, set `stream.callback` to a static non-NULL marker to indicate a buffer stream.
    - If `PB_BUFFER_ONLY` is not defined, set `stream.callback` to the `buf_write` function.
    - Set `stream.state` to the provided buffer `buf`.
    - Set `stream.max_size` to the provided buffer size `bufsize`.
    - Initialize `stream.bytes_written` to 0.
    - If `PB_NO_ERRMSG` is not defined, set `stream.errmsg` to NULL.
    - Return the initialized `stream`.
- **Output**: A `pb_ostream_t` structure initialized for writing to the specified buffer.


---
### pb\_write<!-- {{#callable:checkreturn::pb_write}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L84>)

Writes a buffer to a protobuf output stream, checking for overflow and using a callback for the actual write operation.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure representing the output stream.
    - `buf`: A pointer to a buffer of type `pb_byte_t` containing the data to write.
    - `count`: The number of bytes to write from the buffer.
- **Logic and Control Flow**:
    - Check if `count` is greater than 0 and if the `callback` in `stream` is not NULL.
    - Verify that adding `count` to `stream->bytes_written` does not cause an overflow or exceed `stream->max_size`. If it does, return an error indicating the stream is full.
    - If `PB_BUFFER_ONLY` is defined, use [`buf_write`](<#checkreturnbuf_write>) to write the buffer to the stream; otherwise, use the `callback` function in `stream`. If the write operation fails, return an I/O error.
    - Increment `stream->bytes_written` by `count`.
- **Output**: Returns `true` if the write operation is successful; otherwise, it returns an error through the `PB_RETURN_ERROR` macro.
- **Functions Called**:
    - [`checkreturn::buf_write`](<#checkreturnbuf_write>)


---
### safe\_read\_bool<!-- {{#callable:safe_read_bool}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L115>)

Reads a boolean value from a memory location safely, avoiding undefined behavior.
- **Inputs**:
    - `pSize`: A pointer to the memory location from which to read the boolean value.
- **Logic and Control Flow**:
    - Casts the input pointer `pSize` to a `const char*` pointer `p`.
    - Iterates over each byte in the memory location up to the size of a `bool`.
    - Checks if any byte in the memory location is non-zero.
    - Returns `true` if any byte is non-zero, otherwise returns `false`.
- **Output**: A `bool` value indicating whether any byte in the specified memory location is non-zero.


---
### encode\_array<!-- {{#callable:checkreturn::encode_array}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L128>)

Encodes a static array into a protobuf stream, handling size calculations and packing if necessary.
- **Inputs**:
    - `stream`: A pointer to `pb_ostream_t`, which represents the output stream where the encoded data will be written.
    - `field`: A pointer to `pb_field_iter_t`, which contains information about the field to be encoded, including its type, size, and data.
- **Logic and Control Flow**:
    - Retrieve the count of elements in the array from `field->pSize`.
    - If the count is zero, return true immediately as there is nothing to encode.
    - Check if the array type is not a pointer and if the count exceeds `field->array_size`, return an error indicating the array max size is exceeded.
    - If arrays are not unpacked and the field type is packable, encode the array in packed format by first encoding the tag and calculating the total size of the packed array.
    - If the field type is `PB_LTYPE_FIXED32` or `PB_LTYPE_FIXED64`, calculate the size directly based on the count and element size.
    - For other types, iterate over the array to calculate the size using a sizing stream and encode the size as a varint.
    - If the stream callback is NULL, write the size and return true for sizing purposes.
    - Iterate over the array elements and encode each element using [`pb_enc_fixed`](<#checkreturnpb_enc_fixed>) or [`pb_enc_varint`](<#checkreturnpb_enc_varint>) based on the field type.
    - For unpacked fields, iterate over the array and encode each element using [`encode_basic_field`](<#checkreturnencode_basic_field>), handling pointer-type string and bytes fields by dereferencing pointers to get actual data.
    - Return true if all elements are successfully encoded.
- **Output**: Returns `true` if the array is successfully encoded into the stream, otherwise returns `false` if an error occurs during encoding.
- **Functions Called**:
    - [`checkreturn::pb_encode_tag`](<#checkreturnpb_encode_tag>)
    - [`checkreturn::pb_enc_varint`](<#checkreturnpb_enc_varint>)
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)
    - [`checkreturn::pb_enc_fixed`](<#checkreturnpb_enc_fixed>)
    - [`pb_encode_tag_for_field`](<#pb_encode_tag_for_field>)
    - [`checkreturn::encode_basic_field`](<#checkreturnencode_basic_field>)


---
### pb\_check\_proto3\_default\_value<!-- {{#callable:checkreturn::pb_check_proto3_default_value}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L244>)

Determines if a field in a proto3 message has its default value.
- **Inputs**:
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to check.
- **Logic and Control Flow**:
    - Retrieve the field type from the `field` structure.
    - Check if the field is of static allocation type (`PB_ATYPE_STATIC`).
    - For static fields, handle different field types (`PB_HTYPE`) such as required, repeated, oneof, optional, and check for default values.
    - For singular fields, check if the field data is zeroed out for integer/float, bytes, string, fixed-length bytes, or submessage types.
    - If the field is a pointer type (`PB_ATYPE_POINTER`), check if the data pointer is `NULL`.
    - If the field is a callback type (`PB_ATYPE_CALLBACK`), check if the callback is `NULL` or if the extension is `NULL`.
    - Return `false` as a default for unhandled cases.
- **Output**: Returns `true` if the field has its default value, otherwise `false`.
- **Functions Called**:
    - [`safe_read_bool`](<#safe_read_bool>)
    - [`pb_field_iter_begin`](<pb_common.c.md#pb_field_iter_begin>)
    - [`pb_field_iter_next`](<pb_common.c.md#pb_field_iter_next>)


---
### encode\_basic\_field<!-- {{#callable:checkreturn::encode_basic_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L362>)

Encodes a basic field in a Protocol Buffers stream based on its type.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - `field`: A pointer to a `pb_field_iter_t` structure that contains information about the field to encode, including its type and data.
- **Logic and Control Flow**:
    - Check if `field->pData` is NULL; if so, return true as there is no data to encode.
    - Call [`pb_encode_tag_for_field`](<#pb_encode_tag_for_field>) to encode the field's tag into the stream; return false if it fails.
    - Use a switch statement to determine the field's type using `PB_LTYPE(field->type)`.
    - For each case in the switch statement, call the appropriate encoding function ([`pb_enc_bool`](<#checkreturnpb_enc_bool>), [`pb_enc_varint`](<#checkreturnpb_enc_varint>), [`pb_enc_fixed`](<#checkreturnpb_enc_fixed>), [`pb_enc_bytes`](<#checkreturnpb_enc_bytes>), [`pb_enc_string`](<#checkreturnpb_enc_string>), [`pb_enc_submessage`](<#checkreturnpb_enc_submessage>), [`pb_enc_fixed_length_bytes`](<#checkreturnpb_enc_fixed_length_bytes>)) based on the field's type.
    - If the field type is not recognized, call `PB_RETURN_ERROR` with an error message indicating an invalid field type.
- **Output**: Returns a boolean value indicating success (true) or failure (false) of the encoding process.
- **Functions Called**:
    - [`pb_encode_tag_for_field`](<#pb_encode_tag_for_field>)
    - [`checkreturn::pb_enc_bool`](<#checkreturnpb_enc_bool>)
    - [`checkreturn::pb_enc_varint`](<#checkreturnpb_enc_varint>)
    - [`checkreturn::pb_enc_fixed`](<#checkreturnpb_enc_fixed>)
    - [`checkreturn::pb_enc_bytes`](<#checkreturnpb_enc_bytes>)
    - [`checkreturn::pb_enc_string`](<#checkreturnpb_enc_string>)
    - [`checkreturn::pb_enc_submessage`](<#checkreturnpb_enc_submessage>)
    - [`checkreturn::pb_enc_fixed_length_bytes`](<#checkreturnpb_enc_fixed_length_bytes>)


---
### encode\_callback\_field<!-- {{#callable:checkreturn::encode_callback_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L407>)

Executes a callback function for a field if the callback is defined.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream.
    - ``field``: A pointer to a `pb_field_iter_t` structure that represents the field to encode.
- **Logic and Control Flow**:
    - Check if the `field_callback` in the field's descriptor is not `NULL`.
    - If the callback is not `NULL`, call the callback function with `NULL`, `stream`, and `field` as arguments.
    - If the callback function returns `false`, call `PB_RETURN_ERROR` with `stream` and the message "callback error".
    - Return `true` if the callback is `NULL` or if the callback function executes successfully.
- **Output**: Returns `true` if the callback is `NULL` or executes successfully; otherwise, it returns `false` and sets an error message in the stream.


---
### encode\_field<!-- {{#callable:checkreturn::encode_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L418>)

Encodes a protobuf field based on its type and presence.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - ``field``: A pointer to a `pb_field_iter_t` structure that represents the field to be encoded, containing information about the field's type, tag, and data.
- **Logic and Control Flow**:
    - Check if the field is a `ONEOF` type and if its tag matches the expected tag; if not, return `true` to skip encoding.
    - For `OPTIONAL` fields, check if the field is present using `pSize`; if not present, return `true` to skip encoding.
    - If the field data pointer `pData` is `NULL` and the field is `REQUIRED`, return an error; otherwise, return `true` to skip encoding.
    - Determine the field's allocation type (`CALLBACK`, `REPEATED`, or basic) and call the appropriate encoding function ([`encode_callback_field`](<#checkreturnencode_callback_field>), [`encode_array`](<#checkreturnencode_array>), or [`encode_basic_field`](<#checkreturnencode_basic_field>)).
- **Output**: Returns `true` if the field is successfully encoded or skipped, and `false` if an error occurs during encoding.
- **Functions Called**:
    - [`safe_read_bool`](<#safe_read_bool>)
    - [`checkreturn::pb_check_proto3_default_value`](<#checkreturnpb_check_proto3_default_value>)
    - [`checkreturn::encode_callback_field`](<#checkreturnencode_callback_field>)
    - [`checkreturn::encode_array`](<#checkreturnencode_array>)
    - [`checkreturn::encode_basic_field`](<#checkreturnencode_basic_field>)


---
### default\_extension\_encoder<!-- {{#callable:checkreturn::default_extension_encoder}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L474>)

Encodes a protobuf extension field using a default handler.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - ``extension``: A pointer to a `pb_extension_t` structure that represents the extension field to be encoded.
- **Logic and Control Flow**:
    - Initialize a `pb_field_iter_t` iterator to iterate over the fields of the extension.
    - Call [`pb_field_iter_begin_extension_const`](<pb_common.c.md#pb_field_iter_begin_extension_const>) to start iterating over the extension fields.
    - If the iterator initialization fails, return an error using `PB_RETURN_ERROR`.
    - Call [`encode_field`](<#checkreturnencode_field>) to encode the field pointed to by the iterator.
    - Return the result of [`encode_field`](<#checkreturnencode_field>).
- **Output**: Returns a boolean value indicating success (`true`) or failure (`false`) of the encoding process.
- **Functions Called**:
    - [`pb_field_iter_begin_extension_const`](<pb_common.c.md#pb_field_iter_begin_extension_const>)
    - [`checkreturn::encode_field`](<#checkreturnencode_field>)


---
### encode\_extension\_field<!-- {{#callable:checkreturn::encode_extension_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L487>)

Encodes all registered extensions for a given field into a protobuf stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - ``field``: A pointer to a `pb_field_iter_t` structure that represents the field containing the extensions to encode.
- **Logic and Control Flow**:
    - Retrieve the extension from the field's data pointer.
    - Iterate over each extension in the linked list of extensions.
    - For each extension, check if it has a custom encode function.
    - If a custom encode function exists, call it with the stream and extension as arguments.
    - If no custom encode function exists, use the [`default_extension_encoder`](<#checkreturndefault_extension_encoder>) to encode the extension.
    - If encoding any extension fails, return `false`.
    - If all extensions are successfully encoded, return `true`.
- **Output**: Returns `true` if all extensions are successfully encoded, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::default_extension_encoder`](<#checkreturndefault_extension_encoder>)


---
### pb\_encode<!-- {{#callable:checkreturn::pb_encode}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L512>)

Encodes a Protocol Buffers message from a source structure into a stream.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded message will be written.
    - `fields`: A pointer to a `pb_msgdesc_t` structure that describes the fields of the message to encode.
    - `src_struct`: A pointer to the source structure containing the data to encode.
- **Logic and Control Flow**:
    - Initialize a `pb_field_iter_t` iterator to traverse the fields of the message using [`pb_field_iter_begin_const`](<pb_common.c.md#pb_field_iter_begin_const>).
    - If the message type is empty, return `true`.
    - Iterate over each field in the message using a `do-while` loop and [`pb_field_iter_next`](<pb_common.c.md#pb_field_iter_next>).
    - For each field, check if it is an extension field using `PB_LTYPE`.
    - If it is an extension field, call [`encode_extension_field`](<#checkreturnencode_extension_field>) to encode it; if encoding fails, return `false`.
    - If it is a regular field, call [`encode_field`](<#checkreturnencode_field>) to encode it; if encoding fails, return `false`.
    - Continue the loop until all fields are processed.
    - Return `true` after successfully encoding all fields.
- **Output**: Returns `true` if the message is successfully encoded, otherwise `false` if an error occurs during encoding.
- **Functions Called**:
    - [`pb_field_iter_begin_const`](<pb_common.c.md#pb_field_iter_begin_const>)
    - [`checkreturn::encode_extension_field`](<#checkreturnencode_extension_field>)
    - [`checkreturn::encode_field`](<#checkreturnencode_field>)
    - [`pb_field_iter_next`](<pb_common.c.md#pb_field_iter_next>)


---
### pb\_encode\_ex<!-- {{#callable:checkreturn::pb_encode_ex}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L536>)

Encodes a protobuf message with optional flags for delimited or null-terminated encoding.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream for encoding.
    - ``fields``: A pointer to a `pb_msgdesc_t` structure that describes the fields of the protobuf message to encode.
    - ``src_struct``: A pointer to the source structure containing the data to encode.
    - ``flags``: An unsigned integer that specifies encoding options, such as `PB_ENCODE_DELIMITED` or `PB_ENCODE_NULLTERMINATED`.
- **Logic and Control Flow**:
    - Checks if the `flags` argument has the `PB_ENCODE_DELIMITED` bit set.
    - If `PB_ENCODE_DELIMITED` is set, calls [`pb_encode_submessage`](<#checkreturnpb_encode_submessage>) to encode the message as a submessage.
    - If `PB_ENCODE_NULLTERMINATED` is set, calls [`pb_encode`](<#checkreturnpb_encode>) to encode the message, then writes a null byte to the stream using [`pb_write`](<#checkreturnpb_write>).
    - If neither flag is set, calls [`pb_encode`](<#checkreturnpb_encode>) to encode the message without additional processing.
- **Output**: Returns `true` if the encoding is successful, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_encode_submessage`](<#checkreturnpb_encode_submessage>)
    - [`checkreturn::pb_encode`](<#checkreturnpb_encode>)
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)


---
### pb\_get\_encoded\_size<!-- {{#callable:pb_get_encoded_size}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L557>)

Calculates the encoded size of a protobuf message without actually encoding it.
- **Inputs**:
    - ``size``: A pointer to a `size_t` variable where the function will store the calculated size of the encoded message.
    - ``fields``: A pointer to a `pb_msgdesc_t` structure that describes the fields of the protobuf message.
    - ``src_struct``: A pointer to the source structure containing the data to be encoded.
- **Logic and Control Flow**:
    - Initialize a `pb_ostream_t` stream with `PB_OSTREAM_SIZING` to calculate the size without writing data.
    - Call [`pb_encode`](<#checkreturnpb_encode>) with the stream, fields, and source structure to perform the size calculation.
    - If [`pb_encode`](<#checkreturnpb_encode>) returns false, return false indicating failure.
    - If [`pb_encode`](<#checkreturnpb_encode>) is successful, store the number of bytes written in the `size` variable.
    - Return true indicating success.
- **Output**: Returns a boolean value: true if the size calculation is successful, false otherwise.
- **Functions Called**:
    - [`checkreturn::pb_encode`](<#checkreturnpb_encode>)


---
### pb\_encode\_varint\_32<!-- {{#callable:checkreturn::pb_encode_varint_32}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L573>)

Encodes a 32-bit varint from two 32-bit integers into a buffer and writes it to a stream.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure where the encoded varint will be written.
    - `low`: A 32-bit unsigned integer representing the lower part of the varint to encode.
    - `high`: A 32-bit unsigned integer representing the higher part of the varint to encode.
- **Logic and Control Flow**:
    - Initialize a buffer and a byte variable to store the encoded varint.
    - Extract the least significant 7 bits from `low` and store it in `byte`.
    - Shift `low` right by 7 bits.
    - Enter a loop to encode up to 4 bytes while `low` or `high` is not zero.
    - In each iteration, set the most significant bit of `byte` to 1, store `byte` in the buffer, and update `byte` with the next 7 bits of `low`.
    - Shift `low` right by 7 bits after each iteration.
    - If `high` is non-zero, encode additional bytes by combining bits from `high` with `byte` and shifting `high` right by 3 bits.
    - Continue encoding until `high` becomes zero.
    - Store the final `byte` in the buffer.
    - Write the buffer to the stream using [`pb_write`](<#checkreturnpb_write>).
- **Output**: Returns `true` if the varint is successfully written to the stream, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)


---
### pb\_encode\_varint<!-- {{#callable:checkreturn::pb_encode_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L607>)

Encodes a 64-bit unsigned integer as a variable-length integer into a protobuf output stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded varint will be written.
    - ``value``: A `pb_uint64_t` value representing the 64-bit unsigned integer to encode.
- **Logic and Control Flow**:
    - Check if `value` is less than or equal to `0x7F` (127 in decimal).
    - If true, cast `value` to `pb_byte_t` and write it as a single byte to `stream` using [`pb_write`](<#checkreturnpb_write>).
    - If false, check if `PB_WITHOUT_64BIT` is defined.
    - If `PB_WITHOUT_64BIT` is defined, call [`pb_encode_varint_32`](<#checkreturnpb_encode_varint_32>) with `value` and 0 as arguments.
    - If `PB_WITHOUT_64BIT` is not defined, call [`pb_encode_varint_32`](<#checkreturnpb_encode_varint_32>) with the lower 32 bits and the upper 32 bits of `value`.
- **Output**: Returns `true` if the encoding and writing to the stream are successful, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)
    - [`checkreturn::pb_encode_varint_32`](<#checkreturnpb_encode_varint_32>)


---
### pb\_encode\_svarint<!-- {{#callable:checkreturn::pb_encode_svarint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L625>)

Encodes a signed integer as a zigzag-encoded varint and writes it to a protobuf output stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded varint will be written.
    - ``value``: A signed 64-bit integer (`pb_int64_t`) that is the value to be encoded.
- **Logic and Control Flow**:
    - Initialize a `mask` variable to handle integer sanitization.
    - Check if `value` is negative; if true, apply zigzag encoding by negating and shifting the value, then store it in `zigzagged`.
    - If `value` is non-negative, shift it left by one and store it in `zigzagged`.
    - Call [`pb_encode_varint`](<#checkreturnpb_encode_varint>) with `stream` and `zigzagged` to write the encoded value to the stream.
- **Output**: Returns a boolean indicating success (`true`) or failure (`false`) of the encoding operation.
- **Functions Called**:
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)


---
### pb\_encode\_fixed32<!-- {{#callable:checkreturn::pb_encode_fixed32}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L637>)

Encodes a 32-bit fixed-width integer into a protobuf stream, considering endianness.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - `value`: A pointer to the 32-bit integer value to encode.
- **Logic and Control Flow**:
    - Checks if the system is little-endian and 8-bit, and if so, directly writes the 4 bytes of `value` to `stream` using [`pb_write`](<#checkreturnpb_write>).
    - If the system is not little-endian, reads the 32-bit integer from `value`, splits it into 4 bytes, and stores them in the `bytes` array.
    - Writes the `bytes` array to `stream` using [`pb_write`](<#checkreturnpb_write>).
- **Output**: Returns `true` if the encoding and writing to the stream are successful, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)


---
### pb\_encode\_fixed64<!-- {{#callable:checkreturn::pb_encode_fixed64}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L654>)

Encodes a 64-bit fixed-width integer into a protobuf stream, considering endianness.
- **Inputs**:
    - `stream`: A pointer to `pb_ostream_t`, which represents the output stream where the encoded data will be written.
    - `value`: A pointer to the 64-bit integer value to encode.
- **Logic and Control Flow**:
    - Checks if the system is little-endian with 8-bit bytes using the `PB_LITTLE_ENDIAN_8BIT` macro.
    - If the system is little-endian, directly writes the 64-bit value to the stream using [`pb_write`](<#checkreturnpb_write>).
    - If the system is not little-endian, manually converts the 64-bit integer to a byte array in little-endian order.
    - Writes the byte array to the stream using [`pb_write`](<#checkreturnpb_write>).
- **Output**: Returns `true` if the encoding and writing to the stream are successful, otherwise returns `false`.
- **Functions Called**:
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)


---
### pb\_encode\_tag<!-- {{#callable:checkreturn::pb_encode_tag}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L675>)

Encodes a Protobuf tag by combining a field number and wire type, then writes it as a varint to the output stream.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded tag will be written.
    - `wiretype`: A `pb_wire_type_t` value representing the wire type of the field.
    - `field_number`: A `uint32_t` value representing the field number to be encoded.
- **Logic and Control Flow**:
    - Calculate the tag by shifting the `field_number` left by 3 bits and performing a bitwise OR with `wiretype`.
    - Call [`pb_encode_varint`](<#checkreturnpb_encode_varint>) with `stream` and the calculated `tag` to encode and write the tag as a varint to the stream.
    - Return the result of [`pb_encode_varint`](<#checkreturnpb_encode_varint>), which indicates success or failure.
- **Output**: Returns a boolean value indicating whether the tag was successfully encoded and written to the stream.
- **Functions Called**:
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)


---
### pb\_encode\_tag\_for\_field<!-- {{#callable:pb_encode_tag_for_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L681>)

Encodes a protobuf field's tag based on its type and writes it to the output stream.
- **Inputs**:
    - `stream`: A pointer to `pb_ostream_t`, which represents the output stream where the encoded tag will be written.
    - `field`: A pointer to `pb_field_iter_t`, which contains information about the field, including its type and tag.
- **Logic and Control Flow**:
    - Determine the wire type based on the field's type using a switch statement.
    - For `PB_LTYPE_BOOL`, `PB_LTYPE_VARINT`, `PB_LTYPE_UVARINT`, and `PB_LTYPE_SVARINT`, set the wire type to `PB_WT_VARINT`.
    - For `PB_LTYPE_FIXED32`, set the wire type to `PB_WT_32BIT`.
    - For `PB_LTYPE_FIXED64`, set the wire type to `PB_WT_64BIT`.
    - For `PB_LTYPE_BYTES`, `PB_LTYPE_STRING`, `PB_LTYPE_SUBMESSAGE`, `PB_LTYPE_SUBMSG_W_CB`, and `PB_LTYPE_FIXED_LENGTH_BYTES`, set the wire type to `PB_WT_STRING`.
    - If the field type is invalid, return an error using `PB_RETURN_ERROR`.
    - Call [`pb_encode_tag`](<#checkreturnpb_encode_tag>) with the determined wire type and the field's tag to encode the tag and write it to the stream.
- **Output**: Returns `true` if the tag is successfully encoded and written to the stream; otherwise, returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_encode_tag`](<#checkreturnpb_encode_tag>)


---
### pb\_encode\_string<!-- {{#callable:checkreturn::pb_encode_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L716>)

Encodes a string into a protobuf stream by first encoding its length as a varint and then writing the string data.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - `buffer`: A pointer to a `pb_byte_t` array containing the string data to encode.
    - `size`: The size of the string data in bytes.
- **Logic and Control Flow**:
    - Call [`pb_encode_varint`](<#checkreturnpb_encode_varint>) to encode the size of the string as a varint and write it to the stream.
    - If [`pb_encode_varint`](<#checkreturnpb_encode_varint>) returns false, return false to indicate failure.
    - Call [`pb_write`](<#checkreturnpb_write>) to write the string data from `buffer` to the stream.
    - Return the result of [`pb_write`](<#checkreturnpb_write>), which indicates success or failure.
- **Output**: Returns a boolean value indicating success (true) or failure (false) of the encoding process.
- **Functions Called**:
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)


---
### pb\_encode\_submessage<!-- {{#callable:checkreturn::pb_encode_submessage}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L724>)

Encodes a submessage into a protobuf stream, ensuring the size is consistent and within limits.
- **Inputs**:
    - `stream`: A pointer to `pb_ostream_t`, which represents the output stream for encoding.
    - `fields`: A pointer to `pb_msgdesc_t`, which describes the fields of the message to encode.
    - `src_struct`: A pointer to the source structure containing the data to encode.
- **Logic and Control Flow**:
    - Initialize a non-writing substream to calculate the message size.
    - Call [`pb_encode`](<#checkreturnpb_encode>) to encode the message into the substream and check for errors.
    - Store the number of bytes written in `size`.
    - Encode the size as a varint into the main stream and check for errors.
    - If the stream's callback is NULL, write the size to the stream and return.
    - Check if the stream can accommodate the new data size; return an error if not.
    - Set up the substream with the main stream's callback, state, and size limits.
    - Call [`pb_encode`](<#checkreturnpb_encode>) again to encode the message into the substream and check for errors.
    - Update the main stream's state and bytes written with the substream's results.
    - Check if the substream's bytes written matches the calculated size; return an error if not.
    - Return the status of the encoding operation.
- **Output**: Returns `true` if the submessage is successfully encoded, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_encode`](<#checkreturnpb_encode>)
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)
    - [`checkreturn::pb_write`](<#checkreturnpb_write>)


---
### pb\_enc\_bool<!-- {{#callable:checkreturn::pb_enc_bool}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L776>)

Encodes a boolean value from a field into a protobuf varint format.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - `field`: A pointer to a `pb_field_iter_t` structure that contains the field data to be encoded.
- **Logic and Control Flow**:
    - Reads a boolean value from the field's data using [`safe_read_bool`](<#safe_read_bool>) function.
    - Converts the boolean value to a `uint32_t` where `true` becomes `1` and `false` becomes `0`.
    - Calls [`pb_encode_varint`](<#checkreturnpb_encode_varint>) to encode the `uint32_t` value as a varint and writes it to the output stream.
- **Output**: Returns `true` if the encoding is successful, otherwise returns `false`.
- **Functions Called**:
    - [`safe_read_bool`](<#safe_read_bool>)
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)


---
### pb\_enc\_varint<!-- {{#callable:checkreturn::pb_enc_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L783>)

Encodes a field as a varint, handling both unsigned and signed integer types based on the field's type.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded varint will be written.
    - `field`: A pointer to a `pb_field_iter_t` structure that contains information about the field to be encoded, including its type and data size.
- **Logic and Control Flow**:
    - Check if the field type is `PB_LTYPE_UVARINT` for unsigned varint encoding.
    - If unsigned, determine the integer value from the field's data based on its size (8, 16, 32, or 64 bits).
    - If the data size is invalid, return an error using `PB_RETURN_ERROR`.
    - Encode the unsigned integer value using [`pb_encode_varint`](<#checkreturnpb_encode_varint>).
    - If the field type is not `PB_LTYPE_UVARINT`, treat it as a signed integer.
    - Determine the signed integer value from the field's data based on its size (8, 16, 32, or 64 bits).
    - If the data size is invalid, return an error using `PB_RETURN_ERROR`.
    - If the field type is `PB_LTYPE_SVARINT`, encode the signed integer using [`pb_encode_svarint`](<#checkreturnpb_encode_svarint>).
    - If the `PB_WITHOUT_64BIT` flag is defined and the value is negative, encode using [`pb_encode_varint_32`](<#checkreturnpb_encode_varint_32>).
    - Otherwise, encode the signed integer as an unsigned varint using [`pb_encode_varint`](<#checkreturnpb_encode_varint>).
- **Output**: Returns `true` if the encoding is successful, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`checkreturn::pb_encode_varint`](<#checkreturnpb_encode_varint>)
    - [`checkreturn::pb_encode_svarint`](<#checkreturnpb_encode_svarint>)
    - [`checkreturn::pb_encode_varint_32`](<#checkreturnpb_encode_varint_32>)


---
### pb\_enc\_fixed<!-- {{#callable:checkreturn::pb_enc_fixed}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L831>)

Encodes fixed-size numeric data into a protobuf stream based on the data size and type.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - ``field``: A pointer to a `pb_field_iter_t` structure that contains information about the field to be encoded, including its data size and type.
- **Logic and Control Flow**:
    - If `PB_CONVERT_DOUBLE_FLOAT` is defined and the field's data size is `sizeof(float)` with a type of `PB_LTYPE_FIXED64`, call [`pb_encode_float_as_double`](<#pb_encode_float_as_double>) to encode the float as a double.
    - If the field's data size is `sizeof(uint32_t)`, call [`pb_encode_fixed32`](<#checkreturnpb_encode_fixed32>) to encode the data as a 32-bit fixed-size integer.
    - If `PB_WITHOUT_64BIT` is not defined and the field's data size is `sizeof(uint64_t)`, call [`pb_encode_fixed64`](<#checkreturnpb_encode_fixed64>) to encode the data as a 64-bit fixed-size integer.
    - If none of the conditions match, return an error indicating an invalid data size.
- **Output**: Returns `true` if the encoding is successful, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`pb_encode_float_as_double`](<#pb_encode_float_as_double>)
    - [`checkreturn::pb_encode_fixed32`](<#checkreturnpb_encode_fixed32>)
    - [`checkreturn::pb_encode_fixed64`](<#checkreturnpb_encode_fixed64>)


---
### pb\_enc\_bytes<!-- {{#callable:checkreturn::pb_enc_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L856>)

Encodes a field of type bytes into a protobuf stream, handling null pointers and size constraints.
- **Inputs**:
    - `stream`: A pointer to `pb_ostream_t`, which represents the output stream where the encoded data will be written.
    - `field`: A pointer to `pb_field_iter_t`, which contains information about the field to be encoded, including its data and type.
- **Logic and Control Flow**:
    - Retrieve the bytes data from the field's `pData` pointer and cast it to `pb_bytes_array_t` type.
    - Check if the bytes data is null; if so, encode an empty string into the stream and return the result.
    - If the field type is static and the size of the bytes data exceeds the allowed size, return an error indicating 'bytes size exceeded'.
    - Encode the bytes data into the stream using [`pb_encode_string`](<#checkreturnpb_encode_string>), passing the bytes and their size.
- **Output**: Returns a boolean indicating success (`true`) or failure (`false`) of the encoding process.
- **Functions Called**:
    - [`checkreturn::pb_encode_string`](<#checkreturnpb_encode_string>)


---
### pb\_enc\_string<!-- {{#callable:checkreturn::pb_enc_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L877>)

Encodes a string field into a protobuf stream, ensuring it is properly terminated and optionally validating UTF-8.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded string will be written.
    - ``field``: A pointer to a `pb_field_iter_t` structure that contains information about the field being encoded, including its type, data size, and data pointer.
- **Logic and Control Flow**:
    - Initialize `size` to 0 and `max_size` to the field's data size.
    - Check if the field type is a pointer; if so, set `max_size` to the maximum possible size.
    - If the field type is not a pointer, ensure `max_size` is greater than zero to allow space for a null terminator.
    - If the string pointer `str` is NULL, treat it as an empty string by setting `size` to 0.
    - If `str` is not NULL, iterate through the string to calculate its length, ensuring it does not exceed `max_size`.
    - If the string is not null-terminated within `max_size`, return an error for an unterminated string.
    - If `PB_VALIDATE_UTF8` is defined, validate the string as UTF-8 and return an error if invalid.
    - Encode the string using [`pb_encode_string`](<#checkreturnpb_encode_string>) with the calculated `size`.
- **Output**: Returns `true` if the string is successfully encoded into the stream, otherwise returns `false` if an error occurs.
- **Functions Called**:
    - [`pb_validate_utf8`](<pb_common.c.md#pb_validate_utf8>)
    - [`checkreturn::pb_encode_string`](<#checkreturnpb_encode_string>)


---
### pb\_enc\_submessage<!-- {{#callable:checkreturn::pb_enc_submessage}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L930>)

Encodes a submessage field in a Protocol Buffers stream, handling optional callback encoding if specified.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - ``field``: A pointer to a `pb_field_iter_t` structure that contains information about the field to be encoded, including its type, data, and descriptor.
- **Logic and Control Flow**:
    - Check if `field->submsg_desc` is `NULL`; if so, return an error using `PB_RETURN_ERROR` with the message 'invalid field descriptor'.
    - Check if the field type is `PB_LTYPE_SUBMSG_W_CB` and `field->pSize` is not `NULL`.
    - If the above condition is true, retrieve the callback function stored before `pSize` and check if the `encode` function is defined.
    - If the `encode` function is defined, call it with `stream`, `field`, and `callback->arg`. If it returns `false`, return `false`.
    - Call [`pb_encode_submessage`](<#checkreturnpb_encode_submessage>) with `stream`, `field->submsg_desc`, and `field->pData` to encode the submessage.
- **Output**: Returns `true` if the submessage is successfully encoded, otherwise returns `false` if an error occurs during encoding.
- **Functions Called**:
    - [`checkreturn::pb_encode_submessage`](<#checkreturnpb_encode_submessage>)


---
### pb\_enc\_fixed\_length\_bytes<!-- {{#callable:checkreturn::pb_enc_fixed_length_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L949>)

Encodes a fixed-length byte array into a protobuf stream.
- **Inputs**:
    - ``stream``: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written.
    - ``field``: A pointer to a `pb_field_iter_t` structure that contains the data and metadata for the field to be encoded, including a pointer to the data (`pData`) and the size of the data (`data_size`).
- **Logic and Control Flow**:
    - Calls the [`pb_encode_string`](<#checkreturnpb_encode_string>) function with the `stream`, a cast of `field->pData` to `pb_byte_t*`, and `field->data_size` as arguments.
    - Returns the result of the [`pb_encode_string`](<#checkreturnpb_encode_string>) function call.
- **Output**: Returns a boolean value indicating the success (`true`) or failure (`false`) of the encoding operation.
- **Functions Called**:
    - [`checkreturn::pb_encode_string`](<#checkreturnpb_encode_string>)


---
### pb\_encode\_float\_as\_double<!-- {{#callable:pb_encode_float_as_double}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L955>)

Encodes a `float` value as a `double` and writes it to a protobuf output stream.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure where the encoded `double` value will be written.
    - `value`: The `float` value to encode as a `double`.
- **Logic and Control Flow**:
    - Decompose the `float` value into its sign, exponent, and mantissa components using bit manipulation.
    - Check if the exponent indicates a special value (e.g., NaN) and adjust the exponent accordingly.
    - Handle denormalized numbers by adjusting the mantissa and exponent until the mantissa is normalized.
    - Combine the sign, adjusted exponent, and mantissa into a 64-bit `double` representation.
    - Write the 64-bit `double` representation to the output stream using [`pb_encode_fixed64`](<#checkreturnpb_encode_fixed64>).
- **Output**: Returns `true` if the encoding and writing to the stream are successful, otherwise `false`.
- **Functions Called**:
    - [`checkreturn::pb_encode_fixed64`](<#checkreturnpb_encode_fixed64>)


# Function Declarations (Public API)

---
### buf\_write<!-- {{#callable_declaration:checkreturn::buf_write}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L24>)

Writes data to a protobuf output stream.
- **Description**: Use this function to write a specified number of bytes from a buffer to a protobuf output stream. It updates the stream's state to reflect the new position after writing. Ensure that the stream's state is correctly initialized and that the buffer contains at least the specified number of bytes to avoid undefined behavior.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure representing the output stream. The stream's state must be correctly initialized before calling this function.
    - `buf`: A pointer to a buffer containing the data to write. The buffer must contain at least `count` bytes.
    - `count`: The number of bytes to write from the buffer to the stream. Must be a positive value.
- **Output**: Returns `true` if the operation is successful. Always returns `true` in this implementation.
- **See Also**: [`checkreturn::buf_write`](<#checkreturnbuf_write>)  (Implementation)


---
### encode\_array<!-- {{#callable_declaration:checkreturn::encode_array}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L25>)

Encodes a protobuf array field into the output stream.
- **Description**: Use this function to encode an array field from a protobuf message into a given output stream. It handles both packed and unpacked array types, depending on the field's data type. Ensure that the `stream` is properly initialized and that the `field` points to a valid field iterator with the correct array size. The function returns `true` on success and `false` if an error occurs, such as exceeding the maximum array size or encountering a null pointer in a required field.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream. Must not be null and should be properly initialized before calling this function.
    - `field`: A pointer to a `pb_field_iter_t` structure that represents the field iterator for the array to encode. Must not be null and should point to a valid field with a correct array size.
- **Output**: Returns `true` if the array is successfully encoded into the stream, otherwise returns `false` if an error occurs.
- **See Also**: [`checkreturn::encode_array`](<#checkreturnencode_array>)  (Implementation)


---
### pb\_check\_proto3\_default\_value<!-- {{#callable_declaration:checkreturn::pb_check_proto3_default_value}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L26>)

Checks if a protobuf field has a default value in proto3.
- **Description**: Use this function to determine if a given protobuf field in a proto3 message is set to its default value. This is important for encoding, as proto3 fields are only encoded if they are not set to their default values. The function examines various field types, including static, pointer, and callback types, and handles special cases such as required fields in proto2 submessages and optional fields with default values. It returns a boolean indicating whether the field is at its default state.
- **Inputs**:
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to check. This parameter must not be null, and it should point to a valid field descriptor. The function expects the field to be part of a protobuf message structure.
- **Output**: Returns `true` if the field is at its default value in a proto3 message, otherwise returns `false`. The return value must be used to ensure correct encoding behavior.
- **See Also**: [`checkreturn::pb_check_proto3_default_value`](<#checkreturnpb_check_proto3_default_value>)  (Implementation)


---
### encode\_basic\_field<!-- {{#callable_declaration:checkreturn::encode_basic_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L27>)

Encodes a basic protobuf field into the output stream.
- **Description**: Use this function to encode a basic field of a protobuf message into the provided output stream. It handles different field types such as boolean, varint, fixed32, fixed64, bytes, string, submessage, and fixed-length bytes. The function must be called with a valid field iterator and output stream. If the field's data pointer is null, the function returns true, indicating no data to encode. The function returns false if encoding fails due to an invalid field type or if the tag encoding fails.
- **Inputs**:
    - `stream`: A pointer to `pb_ostream_t`, representing the output stream where the encoded data will be written. Must not be null.
    - `field`: A pointer to `pb_field_iter_t`, representing the field to encode. Must not be null and must have a valid `pData` pointer unless the field is optional.
- **Output**: Returns a boolean value: true if the field is successfully encoded or if the field's data pointer is null, false if an error occurs during encoding.
- **See Also**: [`checkreturn::encode_basic_field`](<#checkreturnencode_basic_field>)  (Implementation)


---
### encode\_callback\_field<!-- {{#callable_declaration:checkreturn::encode_callback_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L28>)

Encodes a field using a callback function if available.
- **Description**: Use this function to encode a field that has an associated callback function. It checks if the field's descriptor has a callback function and calls it to perform the encoding. If the callback function is not present, the function does nothing. This function must be called with a valid `pb_ostream_t` stream and a `pb_field_iter_t` field. It is important to handle the return value to check for any errors during the callback execution.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream. Must not be null.
    - `field`: A pointer to a `pb_field_iter_t` structure that represents the field to encode. Must not be null and must have a valid descriptor with a potential callback function.
- **Output**: Returns `true` if the encoding is successful or if no callback is present. Returns `false` if the callback function fails, and sets an error message in the stream.
- **See Also**: [`checkreturn::encode_callback_field`](<#checkreturnencode_callback_field>)  (Implementation)


---
### encode\_field<!-- {{#callable_declaration:checkreturn::encode_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L29>)

Encodes a protobuf field into the output stream.
- **Description**: Use this function to encode a single protobuf field into the provided output stream. It handles different field types, including optional, required, repeated, and oneof fields. The function checks for field presence and encodes the field contents accordingly. It must be called with valid field and stream pointers, and the field data must be correctly initialized. If a required field is missing, the function returns an error. The function returns a boolean indicating success or failure, and the caller must check this return value to ensure correct encoding.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream. Must not be null. The stream must be properly initialized before calling this function.
    - `field`: A pointer to a `pb_field_iter_t` structure that represents the field to encode. Must not be null. The field must be correctly initialized and contain valid data for encoding.
- **Output**: Returns a boolean value: `true` if the field was successfully encoded, or `false` if an error occurred during encoding.
- **See Also**: [`checkreturn::encode_field`](<#checkreturnencode_field>)  (Implementation)


---
### encode\_extension\_field<!-- {{#callable_declaration:checkreturn::encode_extension_field}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L30>)

Encodes extension fields into a protobuf stream.
- **Description**: Use this function to encode all registered extension fields into a given protobuf output stream. It processes each extension field in the provided field iterator, encoding it using either a custom encoder or a default encoder if no custom encoder is available. This function must be called with a valid output stream and a field iterator that points to the extension fields. It returns a boolean indicating success or failure, and it is important to check this return value to ensure that the encoding process completed successfully.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written. Must not be null.
    - `field`: A pointer to a `pb_field_iter_t` structure that represents the current field iterator pointing to the extension fields to encode. Must not be null and must point to a valid extension field.
- **Output**: Returns `true` if all extension fields are successfully encoded; otherwise, returns `false` if an error occurs during encoding.
- **See Also**: [`checkreturn::encode_extension_field`](<#checkreturnencode_extension_field>)  (Implementation)


---
### default\_extension\_encoder<!-- {{#callable_declaration:checkreturn::default_extension_encoder}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L31>)

Encodes a protobuf extension field.
- **Description**: Use this function to encode a protobuf extension field into a given output stream. It is necessary to call this function when you have an extension field that needs encoding. The function checks if the extension is valid and then encodes it using the provided stream. Ensure that the `stream` and `extension` parameters are correctly initialized before calling this function.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the encoded data will be written. Must not be null.
    - `extension`: A pointer to a `pb_extension_t` structure that represents the extension field to encode. Must not be null and must point to a valid extension.
- **Output**: Returns `true` if the encoding is successful, otherwise returns `false` if an error occurs, such as an invalid extension.
- **See Also**: [`checkreturn::default_extension_encoder`](<#checkreturndefault_extension_encoder>)  (Implementation)


---
### pb\_encode\_varint\_32<!-- {{#callable_declaration:checkreturn::pb_encode_varint_32}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L32>)

Encodes a 32-bit varint into a protobuf stream.
- **Description**: Use this function to encode a 32-bit varint into a protobuf stream. It takes two 32-bit unsigned integers, `low` and `high`, which represent the lower and higher parts of a 64-bit integer, respectively. The function writes the encoded varint to the provided `stream`. Ensure that the `stream` is properly initialized and has enough space to accommodate the encoded data. The function returns a boolean indicating the success of the write operation.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure where the encoded varint will be written. Must not be null and should be properly initialized.
    - `low`: A 32-bit unsigned integer representing the lower part of the varint to encode. No specific range restrictions, but typically used as part of a 64-bit value.
    - `high`: A 32-bit unsigned integer representing the higher part of the varint to encode. No specific range restrictions, but typically used as part of a 64-bit value.
- **Output**: Returns a boolean value: `true` if the varint was successfully written to the stream, `false` otherwise.
- **See Also**: [`checkreturn::pb_encode_varint_32`](<#checkreturnpb_encode_varint_32>)  (Implementation)


---
### pb\_enc\_bool<!-- {{#callable_declaration:checkreturn::pb_enc_bool}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L33>)

Encodes a boolean field into a protobuf stream.
- **Description**: Use this function to encode a boolean field into a protobuf stream. It reads the boolean value from the provided field data and encodes it as a varint into the stream. This function must be called with a valid output stream and a field iterator pointing to a boolean field. Ensure that the stream is properly initialized and has enough space to accommodate the encoded data. The function returns a boolean indicating the success of the encoding operation.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure representing the output stream. Must not be null and should be properly initialized before calling this function.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to encode. Must not be null and should point to a valid boolean field.
- **Output**: Returns `true` if the encoding is successful, otherwise returns `false`.
- **See Also**: [`checkreturn::pb_enc_bool`](<#checkreturnpb_enc_bool>)  (Implementation)


---
### pb\_enc\_varint<!-- {{#callable_declaration:checkreturn::pb_enc_varint}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L34>)

Encodes a field as a varint into the output stream.
- **Description**: Use this function to encode a field as a varint into the provided output stream. It handles both unsigned and signed integer types based on the field's type. The function expects the field's data size to match one of the supported integer sizes. If the data size is invalid, the function returns an error. This function must be called with a valid `pb_ostream_t` stream and a `pb_field_iter_t` field that contains the data to encode.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure where the encoded varint will be written. Must not be null.
    - `field`: A pointer to a `pb_field_iter_t` structure that contains the field data to encode. The `type` field determines if the data is treated as unsigned or signed. The `data_size` must match one of the supported sizes (8, 16, 32, or 64 bits).
- **Output**: Returns `true` if the encoding is successful; otherwise, returns `false` if an error occurs, such as an invalid data size.
- **See Also**: [`checkreturn::pb_enc_varint`](<#checkreturnpb_enc_varint>)  (Implementation)


---
### pb\_enc\_fixed<!-- {{#callable_declaration:checkreturn::pb_enc_fixed}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L35>)

Encodes a fixed-size field into a protobuf stream.
- **Description**: Use this function to encode a fixed-size field into a protobuf stream. It supports encoding 32-bit and 64-bit fixed-size fields, depending on the data size. If the data size is invalid, the function returns an error. This function is typically used within a protobuf encoding process to handle fields with fixed sizes. Ensure that the `stream` and `field` parameters are correctly initialized before calling this function.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream. Must not be null. The function writes encoded data to this stream.
    - `field`: A pointer to a `pb_field_iter_t` structure that represents the field to encode. Must not be null. The `data_size` member determines the encoding method, and the `pData` member provides the data to encode.
- **Output**: Returns `true` if the encoding is successful; otherwise, returns `false` if an error occurs, such as an invalid data size.
- **See Also**: [`checkreturn::pb_enc_fixed`](<#checkreturnpb_enc_fixed>)  (Implementation)


---
### pb\_enc\_bytes<!-- {{#callable_declaration:checkreturn::pb_enc_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L36>)

Encodes a bytes field into a protobuf stream.
- **Description**: Use this function to encode a bytes field from a protobuf message into a given output stream. It handles null pointers by treating them as empty byte fields. Ensure that the size of the bytes does not exceed the allocated data size for static fields, as this will result in an error. This function must be called with a valid stream and field iterator, and it is important to check the return value to ensure successful encoding.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure that represents the output stream where the bytes will be encoded. Must not be null.
    - `field`: A pointer to a `pb_field_iter_t` structure that contains the field data to encode. Must not be null and should point to a valid bytes field.
- **Output**: Returns `true` if the bytes are successfully encoded into the stream; otherwise, returns `false` if an error occurs, such as exceeding the allowed size for static fields.
- **See Also**: [`checkreturn::pb_enc_bytes`](<#checkreturnpb_enc_bytes>)  (Implementation)


---
### pb\_enc\_string<!-- {{#callable_declaration:checkreturn::pb_enc_string}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L37>)

Encodes a string field into a protobuf stream.
- **Description**: Use this function to encode a string field into a protobuf stream. It handles both pointer and static string types, ensuring that the string is null-terminated if required. If the string is null, it treats it as an empty string. The function checks for string termination and validates UTF-8 encoding if enabled. It must be called with a valid `pb_ostream_t` stream and `pb_field_iter_t` field, and it returns false if encoding fails due to errors like unterminated strings or invalid UTF-8.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure representing the output stream. Must not be null. The function writes the encoded string to this stream.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to encode. Must not be null. The `pData` member should point to the string data, and `data_size` should specify the maximum size for static strings.
- **Output**: Returns a boolean value: true if the string is successfully encoded, false if an error occurs (e.g., unterminated string, invalid UTF-8).
- **See Also**: [`checkreturn::pb_enc_string`](<#checkreturnpb_enc_string>)  (Implementation)


---
### pb\_enc\_submessage<!-- {{#callable_declaration:checkreturn::pb_enc_submessage}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L38>)

Encodes a submessage field into a protobuf stream.
- **Description**: Use this function to encode a submessage field into a protobuf stream. It requires a valid field descriptor and a stream to write to. If the field type is a submessage with a callback, the function will execute the callback to encode the data. This function must be called with a valid `pb_ostream_t` stream and a `pb_field_iter_t` field that has a non-null `submsg_desc`. If the field descriptor is invalid, the function will return an error.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure where the encoded data will be written. Must not be null.
    - `field`: A pointer to a `pb_field_iter_t` structure representing the field to encode. The `submsg_desc` member must not be null. If the field type is `PB_LTYPE_SUBMSG_W_CB`, `pSize` must not be null.
- **Output**: Returns `true` if the submessage is successfully encoded; otherwise, returns `false` if an error occurs.
- **See Also**: [`checkreturn::pb_enc_submessage`](<#checkreturnpb_enc_submessage>)  (Implementation)


---
### pb\_enc\_fixed\_length\_bytes<!-- {{#callable_declaration:checkreturn::pb_enc_fixed_length_bytes}} -->
[View Source →](<../../../../../src/ballet/nanopb/pb_encode.c#L39>)

Encodes fixed-length byte data into a protobuf stream.
- **Description**: Use this function to encode a fixed-length byte array into a protobuf stream. It is important to ensure that the `stream` is properly initialized and has enough space to accommodate the data. The `field` parameter must point to a valid `pb_field_iter_t` structure with `pData` pointing to the byte data and `data_size` indicating the size of the data. This function returns a boolean indicating success or failure, and it is crucial to check this return value to handle any encoding errors.
- **Inputs**:
    - `stream`: A pointer to a `pb_ostream_t` structure representing the output stream. Must be initialized and have sufficient space for the data.
    - `field`: A pointer to a `pb_field_iter_t` structure. `pData` must point to the byte data to encode, and `data_size` must specify the size of this data. Must not be null.
- **Output**: Returns `true` if encoding is successful, otherwise `false`.
- **See Also**: [`checkreturn::pb_enc_fixed_length_bytes`](<#checkreturnpb_enc_fixed_length_bytes>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)