<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests and benchmarks for the ChaCha random number generator implementation.

# Purpose
The code is an executable C program that tests and benchmarks a random number generator (RNG) based on the ChaCha algorithm. It includes the necessary headers for the ChaCha RNG functionality and initializes the program with `fd_boot`. The main components of the code involve creating and validating a `fd_chacha_rng` instance, initializing it with a key, and performing tests to ensure the RNG produces expected outputs. The code uses `FD_TEST` macros to assert the correctness of various operations, such as memory alignment and mode validity.

The program also benchmarks the performance of the RNG using different ChaCha variants (`fd_chacha20_rng_ulong` and `fd_chacha8_rng_ulong`) and refill methods (`fd_chacha8_rng_refill_avx512`, `fd_chacha20_rng_refill_avx512`, etc.) depending on the available hardware capabilities (e.g., AVX512, AVX). The benchmarks measure the throughput in gigabits per second and the time per ulong generated. The code concludes by testing the proper cleanup of the RNG instance with `fd_chacha_rng_leave` and `fd_chacha_rng_delete`, ensuring that resources are correctly released.
# Imports and Dependencies

---
- `../fd_ballet.h`
- `fd_chacha.h`
- `fd_chacha_rng.h`


# Global Variables

---
### iter
- **Type**: `ulong`
- **Description**: `iter` is a global variable of type `ulong` that is used to specify the number of iterations for benchmarking functions.
- **Use**: Used to control the number of iterations in performance tests for random number generation functions.


---
### dt
- **Type**: `long`
- **Description**: Represents the elapsed time in wall clock time during a benchmark test.
- **Use**: Used to measure the time taken for a specific number of iterations of a function call in a benchmark test.


---
### gbps
- **Type**: `double`
- **Description**: Represents the gigabits per second (Gbps) throughput calculated during a benchmark test. It is computed by multiplying the stride and iteration count by 8, and dividing by the elapsed time `dt`. This calculation is used to measure the data processing speed of the random number generator.
- **Use**: Used to log the Gbps throughput per core during the execution of the `REFILL_TEST` macro.


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/chacha/test_chacha_rng.c#L6>)

Initializes, tests, benchmarks, and cleans up a ChaCha-based random number generator.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: The array of command-line arguments.
- **Logic and Control Flow**:
    - Call `fd_boot` to initialize the environment with command-line arguments.
    - Declare a `fd_chacha_rng_t` array `_rng` and verify its alignment and size using `FD_TEST`.
    - Test invalid memory and mode cases for [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>) and verify expected failures.
    - Create a new ChaCha RNG with [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>) and join it with [`fd_chacha_rng_join`](<fd_chacha_rng.c.md#fd_chacha_rng_join>), verifying the operation with `FD_TEST`.
    - Initialize the RNG with a predefined 32-byte key using [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>).
    - Test the RNG output with [`fd_chacha20_rng_ulong`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong>) and verify the results using `FD_TEST`.
    - Define a macro `RNG_TEST` to benchmark RNG functions, logging performance metrics.
    - Use `RNG_TEST` to benchmark [`fd_chacha20_rng_ulong`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong>) and `fd_chacha8_rng_ulong`.
    - Define a macro `REFILL_TEST` to benchmark RNG refill functions with different strides, logging performance metrics.
    - Conditionally compile and run `REFILL_TEST` for AVX512 and AVX if available, and always for sequential refill.
    - Test the leave and delete operations for the RNG with `fd_chacha_rng_leave` and `fd_chacha_rng_delete`, verifying with `FD_TEST`.
    - Log a 'pass' message and call `fd_halt` to clean up before returning 0.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_chacha_rng_align`](<fd_chacha_rng.c.md#fd_chacha_rng_align>)
    - [`fd_chacha_rng_footprint`](<fd_chacha_rng.c.md#fd_chacha_rng_footprint>)
    - [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>)
    - [`fd_chacha_rng_join`](<fd_chacha_rng.c.md#fd_chacha_rng_join>)
    - [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>)
    - [`fd_chacha20_rng_ulong`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)