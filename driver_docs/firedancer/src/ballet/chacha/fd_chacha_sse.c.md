<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements ChaCha8 and ChaCha20 block functions using SSE optimizations.

# Purpose
The code implements the ChaCha stream cipher, specifically optimized for SSE (Streaming SIMD Extensions) instructions. It defines a static function [`fd_chacha_block_sse`](<#fd_chacha_block_sse>) that performs the core ChaCha block transformation using SSE intrinsics. The function takes a block of data, a key, an index and nonce, and a round count as inputs. It constructs the initial ChaCha20 block state matrix, performs the ChaCha round function iteratively, and updates the block with the transformed state. The function uses specific rotation and shuffle operations to optimize the performance of the ChaCha algorithm on SSE-capable processors.

Additionally, the code provides two public functions, [`fd_chacha8_block`](<#fd_chacha8_block>) and [`fd_chacha20_block`](<#fd_chacha20_block>), which are interfaces to the [`fd_chacha_block_sse`](<#fd_chacha_block_sse>) function. These functions specify the number of rounds to be 8 and 20, respectively, aligning with the ChaCha8 and ChaCha20 variants of the cipher. The code is intended to be part of a library that can be used to encrypt or decrypt data using the ChaCha cipher, leveraging SIMD instructions for enhanced performance.
# Imports and Dependencies

---
- `fd_chacha.h`
- `../../util/simd/fd_sse.h`


# Functions

---
### fd\_chacha\_block\_sse<!-- {{#callable:fd_chacha_block_sse}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_sse.c#L5>)

Implements the ChaCha20 block function using SSE instructions for optimized performance.
- **Inputs**:
    - `_block`: A pointer to the memory location where the output block will be stored, assumed to be 64-byte aligned.
    - `_key`: A pointer to the 256-bit key used in the ChaCha20 algorithm, assumed to be 32-byte aligned.
    - `_idx_nonce`: A pointer to the 128-bit index and nonce, assumed to be 16-byte aligned.
    - `rnd2_cnt`: The number of double rounds (column and diagonal) to perform, typically 10 for ChaCha20.
- **Logic and Control Flow**:
    - Aligns the input pointers `_block`, `_key`, and `_idx_nonce` to 64, 32, and 16 bytes respectively using `__builtin_assume_aligned`.
    - Initializes the ChaCha20 state matrix with constants, the key, and the index/nonce.
    - Defines macros for rotating bits left by 16, 8, 12, and 7 positions using SSE instructions for efficiency.
    - Performs the ChaCha20 round function `rnd2_cnt` times, which includes both column and diagonal rounds.
    - In each round, updates the state matrix using addition, XOR, and bit rotation operations.
    - After completing the rounds, adds the initial state to the final state to complete the block transformation.
    - Stores the final state back into the `_block` memory location.
    - Returns the pointer to the `_block`.
- **Output**: Returns a pointer to the transformed block, which is the same as the input `_block` pointer.


---
### fd\_chacha8\_block<!-- {{#callable:fd_chacha8_block}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_sse.c#L90>)

Generates a ChaCha8 block using the provided key and nonce.
- **Inputs**:
    - `_block`: A pointer to the memory location where the generated ChaCha8 block will be stored.
    - `_key`: A pointer to the 256-bit key used for the ChaCha8 block generation.
    - `_idx_nonce`: A pointer to the 128-bit index and nonce used for the ChaCha8 block generation.
- **Logic and Control Flow**:
    - Calls the [`fd_chacha_block_sse`](<#fd_chacha_block_sse>) function with the provided `_block`, `_key`, `_idx_nonce`, and a round count of 4.
    - Returns the result of the [`fd_chacha_block_sse`](<#fd_chacha_block_sse>) function call.
- **Output**: Returns a pointer to the generated ChaCha8 block.
- **Functions Called**:
    - [`fd_chacha_block_sse`](<#fd_chacha_block_sse>)


---
### fd\_chacha20\_block<!-- {{#callable:fd_chacha20_block}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_sse.c#L97>)

Generates a ChaCha20 block using the provided key and nonce.
- **Inputs**:
    - `_block`: A pointer to the memory location where the generated ChaCha20 block will be stored.
    - `_key`: A pointer to the memory location containing the 256-bit key used for encryption.
    - `_idx_nonce`: A pointer to the memory location containing the 128-bit index and nonce used for encryption.
- **Logic and Control Flow**:
    - Calls the [`fd_chacha_block_sse`](<#fd_chacha_block_sse>) function with `_block`, `_key`, `_idx_nonce`, and a round count of 10.
    - The [`fd_chacha_block_sse`](<#fd_chacha_block_sse>) function constructs the initial ChaCha20 block state using constants, the key, and the nonce.
    - Performs 10 iterations of the ChaCha round function, each consisting of a column round and a diagonal round.
    - Completes the block by adding the initial state to the final state after the rounds.
    - Stores the resulting state back into the memory location pointed to by `_block`.
- **Output**: Returns a pointer to the memory location where the ChaCha20 block is stored.
- **Functions Called**:
    - [`fd_chacha_block_sse`](<#fd_chacha_block_sse>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)