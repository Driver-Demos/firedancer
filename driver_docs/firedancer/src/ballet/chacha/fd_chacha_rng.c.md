<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for managing and refilling a ChaCha-based random number generator.

# Purpose
The code provides functionality for managing and using a ChaCha-based random number generator (RNG). It includes functions to handle memory alignment and footprint calculations for the `fd_chacha_rng_t` structure, which is central to the RNG's operation. The code defines functions to create ([`fd_chacha_rng_new`](<#fd_chacha_rng_new>)), join ([`fd_chacha_rng_join`](<#fd_chacha_rng_join>)), leave ([`fd_chacha_rng_leave`](<#fd_chacha_rng_leave>)), and delete ([`fd_chacha_rng_delete`](<#fd_chacha_rng_delete>)) instances of the RNG, ensuring proper memory management and alignment. The [`fd_chacha20_rng_init`](<#fd_chacha20_rng_init>) function initializes the RNG with a given key, setting up the internal state for generating random numbers.

The code also includes functions to refill the RNG's buffer with random data using different ChaCha block functions (`fd_chacha8_block` and `fd_chacha20_block`). The [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>) function is a helper that performs the buffer refill operation, and it is called by [`fd_chacha8_rng_refill_seq`](<#fd_chacha8_rng_refill_seq>) and [`fd_chacha20_rng_refill_seq`](<#fd_chacha20_rng_refill_seq>) to use specific ChaCha variants. The code is designed to be part of a larger system, likely as a library, providing a consistent interface for ChaCha-based random number generation.
# Imports and Dependencies

---
- `fd_chacha_rng.h`


# Functions

---
### fd\_chacha\_rng\_align<!-- {{#callable:fd_chacha_rng_align}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L3>)

Returns the alignment requirement of the `fd_chacha_rng_t` type.
- **Inputs**: None
- **Logic and Control Flow**:
    - Use the `alignof` operator to get the alignment requirement of the `fd_chacha_rng_t` type.
    - Return the alignment value.
- **Output**: The function returns an `ulong` representing the alignment requirement of the `fd_chacha_rng_t` type.


---
### fd\_chacha\_rng\_footprint<!-- {{#callable:fd_chacha_rng_footprint}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L8>)

Returns the size in bytes of the `fd_chacha_rng_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calculate the size of the `fd_chacha_rng_t` structure using the `sizeof` operator.
    - Return the calculated size.
- **Output**: The function returns an `ulong` representing the size of the `fd_chacha_rng_t` structure.


---
### fd\_chacha\_rng\_new<!-- {{#callable:fd_chacha_rng_new}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L13>)

Initializes a new ChaCha random number generator in shared memory with a specified mode.
- **Inputs**:
    - `shmem`: A pointer to the shared memory where the random number generator will be initialized.
    - `mode`: An integer representing the mode of the random number generator, which must be either `FD_CHACHA_RNG_MODE_MOD` or `FD_CHACHA_RNG_MODE_SHIFT`.
- **Logic and Control Flow**:
    - Check if `shmem` is NULL; if true, log a warning and return NULL.
    - Check if `shmem` is aligned to the alignment requirements of `fd_chacha_rng_t`; if not, log a warning and return NULL.
    - Initialize the memory at `shmem` to zero using `memset`.
    - Check if `mode` is valid (either `FD_CHACHA_RNG_MODE_MOD` or `FD_CHACHA_RNG_MODE_SHIFT`); if not, log a warning and return NULL.
    - Set the `mode` field of the `fd_chacha_rng_t` structure at `shmem` to the specified `mode`.
    - Return the `shmem` pointer.
- **Output**: Returns a pointer to the initialized shared memory if successful, or NULL if an error occurs.


---
### fd\_chacha\_rng\_join<!-- {{#callable:fd_chacha_rng_join}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L33>)

Converts a shared memory pointer to a `fd_chacha_rng_t` pointer if it is not NULL.
- **Inputs**:
    - `shrng`: A pointer to shared memory that is expected to be of type `fd_chacha_rng_t`.
- **Logic and Control Flow**:
    - Check if `shrng` is NULL using `FD_UNLIKELY`.
    - If `shrng` is NULL, log a warning message 'NULL shrng' and return NULL.
    - If `shrng` is not NULL, cast `shrng` to a `fd_chacha_rng_t` pointer and return it.
- **Output**: Returns a pointer to `fd_chacha_rng_t` if `shrng` is not NULL; otherwise, returns NULL.


---
### fd\_chacha\_rng\_leave<!-- {{#callable:fd_chacha_rng_leave}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L42>)

Returns the input `fd_chacha_rng_t` pointer if it is not NULL, otherwise logs a warning and returns NULL.
- **Inputs**:
    - `rng`: A pointer to an `fd_chacha_rng_t` structure that represents the ChaCha random number generator instance to leave.
- **Logic and Control Flow**:
    - Check if the `rng` pointer is NULL using `FD_UNLIKELY`.
    - If `rng` is NULL, log a warning message 'NULL rng' and return NULL.
    - If `rng` is not NULL, cast it to a `void *` and return it.
- **Output**: A `void *` pointer to the `fd_chacha_rng_t` structure if `rng` is not NULL; otherwise, NULL.


---
### fd\_chacha\_rng\_delete<!-- {{#callable:fd_chacha_rng_delete}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L51>)

Clears and returns a pointer to a `fd_chacha_rng_t` structure if it is not NULL.
- **Inputs**:
    - `shrng`: A pointer to a `fd_chacha_rng_t` structure that needs to be cleared.
- **Logic and Control Flow**:
    - Check if `shrng` is NULL using `FD_UNLIKELY`; if true, log a warning and return NULL.
    - Use `memset` to clear the memory of the `fd_chacha_rng_t` structure pointed to by `shrng`.
    - Return the `shrng` pointer.
- **Output**: Returns the pointer `shrng` if it is not NULL, otherwise returns NULL.


---
### fd\_chacha20\_rng\_init<!-- {{#callable:fd_chacha20_rng_init}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L61>)

Initializes a ChaCha20 random number generator with a given key.
- **Inputs**:
    - `rng`: A pointer to an `fd_chacha_rng_t` structure that will be initialized.
    - `key`: A constant pointer to the key used for initializing the random number generator, with a size defined by `FD_CHACHA20_KEY_SZ`.
- **Logic and Control Flow**:
    - Copies the provided `key` into the `rng->key` field using `memcpy` with a size of `FD_CHACHA20_KEY_SZ`.
    - Sets `rng->buf_off` to 0, indicating the start of the buffer.
    - Sets `rng->buf_fill` to 0, indicating that the buffer is initially empty.
    - Calls `fd_chacha20_rng_private_refill` to fill the buffer with initial random data.
    - Returns the pointer to the initialized `fd_chacha_rng_t` structure.
- **Output**: Returns a pointer to the initialized `fd_chacha_rng_t` structure.


---
### fd\_chacha\_rng\_refill\_seq<!-- {{#callable:fd_chacha_rng_refill_seq}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L71>)

Refills the buffer of a ChaCha-based random number generator using a specified block function.
- **Inputs**:
    - ``rng``: A pointer to an `fd_chacha_rng_t` structure representing the random number generator state.
    - ``block_fn``: A function pointer to a block function that processes the buffer, key, and nonce to generate random data.
- **Logic and Control Flow**:
    - Calculate `fill_target` as the difference between `FD_CHACHA_RNG_BUFSZ` and `FD_CHACHA_BLOCK_SZ`.
    - Enter a loop that continues until the available buffer (`buf_avail`) is less than `fill_target`.
    - In each iteration, calculate `idx` as the quotient of `rng->buf_fill` divided by 64.
    - Initialize `idx_nonce` with `idx` and three zeros, ensuring it is 16-byte aligned.
    - Call `block_fn` with the current buffer position, the key, and `idx_nonce` to fill the buffer with random data.
    - Increment `rng->buf_fill` by `FD_CHACHA_BLOCK_SZ` after each block function call.
- **Output**: No direct output; modifies the buffer within the `rng` structure to contain new random data.


---
### fd\_chacha8\_rng\_refill\_seq<!-- {{#callable:fd_chacha8_rng_refill_seq}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L88>)

Calls [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>) with `fd_chacha8_block` to refill the random number generator buffer.
- **Inputs**:
    - `rng`: A pointer to an `fd_chacha_rng_t` structure representing the random number generator state.
- **Logic and Control Flow**:
    - Calls the [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>) function with `rng` and `fd_chacha8_block` as arguments.
    - The [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>) function refills the buffer of the random number generator using the `fd_chacha8_block` function to generate random data blocks.
- **Output**: No return value.
- **Functions Called**:
    - [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>)


---
### fd\_chacha20\_rng\_refill\_seq<!-- {{#callable:fd_chacha20_rng_refill_seq}} -->
[View Source →](<../../../../../src/ballet/chacha/fd_chacha_rng.c#L93>)

Calls [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>) with `fd_chacha20_block` to refill the random number generator buffer.
- **Inputs**:
    - `rng`: A pointer to an `fd_chacha_rng_t` structure that represents the random number generator state.
- **Logic and Control Flow**:
    - Calls the [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>) function with the `rng` pointer and the `fd_chacha20_block` function as arguments.
- **Output**: No output is returned as the function has a `void` return type.
- **Functions Called**:
    - [`fd_chacha_rng_refill_seq`](<#fd_chacha_rng_refill_seq>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)