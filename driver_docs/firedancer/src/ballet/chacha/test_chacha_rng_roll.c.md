<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the ChaCha20 random number generator, including command-line usage and validation against Rust samples.

# Purpose
The code is a C program designed to test and demonstrate the functionality of a ChaCha20-based random number generator (RNG). It includes a main function that processes command-line arguments to configure the RNG's range, count, and key. The program uses the `fd_chacha_rng` library to create and manage the RNG, and it performs a series of tests to ensure the RNG's output matches expected values derived from a Rust implementation. The tests include [`test_matches_rust_sample_single`](<#test_matches_rust_sample_single>), [`test_matches_rust_sample`](<#test_matches_rust_sample>), and [`test_iterated`](<#test_iterated>), which validate the RNG's behavior against pre-determined sequences of numbers.

The program also includes a [`usage`](<#usage>) function that provides instructions on how to run the program with the correct parameters. The main function initializes the RNG with a key, rolls the RNG a specified number of times, and logs the results. The program is structured to handle errors and clean up resources before exiting. The use of `FD_TEST` macros indicates that the program includes built-in assertions to verify the correctness of the RNG operations. The code is intended to be executed as a standalone application, and it does not define public APIs or external interfaces for use by other programs.
# Imports and Dependencies

---
- `stdio.h`
- `fd_chacha_rng.h`


# Functions

---
### usage<!-- {{#callable:usage}} -->
[View Source →](<../../../../../src/ballet/chacha/test_chacha_rng_roll.c#L5>)

Displays usage information for the `test_chacha_rng_roll` command-line tool and returns an error code.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `fprintf` to print usage instructions to the standard error stream `stderr`.
    - The usage message includes details about the command-line arguments `--range`, `--count`, and `--key`.
    - Returns the integer `1` to indicate an error or help request.
- **Output**: Returns `1` to indicate that the function has displayed usage information and the program should terminate with an error code.


---
### test\_matches\_rust\_sample\_single<!-- {{#callable:test_matches_rust_sample_single}} -->
[View Source →](<../../../../../src/ballet/chacha/test_chacha_rng_roll.c#L19>)

Validates the output of a ChaCha20 random number generator against expected values derived from a Rust implementation.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha20 random number generator with a predefined key.
    - Generate random numbers using [`fd_chacha20_rng_ulong_roll`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong_roll>) with two different ranges: 0 to 10 and 0 to 4294967231.
    - Compare each generated number to expected values using `FD_TEST` to ensure they match the output from a Rust implementation.
    - Clean up the random number generator by leaving and deleting it.
- **Output**: No output is returned; the function performs internal tests and assertions.
- **Functions Called**:
    - [`fd_chacha_rng_join`](<fd_chacha_rng.c.md#fd_chacha_rng_join>)
    - [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>)
    - [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>)
    - [`fd_chacha20_rng_ulong_roll`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong_roll>)
    - [`fd_chacha_rng_delete`](<fd_chacha_rng.c.md#fd_chacha_rng_delete>)
    - [`fd_chacha_rng_leave`](<fd_chacha_rng.c.md#fd_chacha_rng_leave>)


---
### test\_matches\_rust\_sample<!-- {{#callable:test_matches_rust_sample}} -->
[View Source →](<../../../../../src/ballet/chacha/test_chacha_rng_roll.c#L76>)

Validates the output of a ChaCha20 random number generator against expected values derived from a Rust implementation.
- **Inputs**: None
- **Logic and Control Flow**:
    - Declare and initialize a ChaCha20 random number generator (`fd_chacha_rng_t`) with mode `FD_CHACHA_RNG_MODE_MOD`.
    - Check if the random number generator (`rng`) is successfully initialized using `FD_TEST`.
    - Create a 32-byte key filled with the value `0x41` and initialize the random number generator with this key using [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>).
    - Perform a series of tests using `FD_TEST` to verify that the output of [`fd_chacha20_rng_ulong_roll`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong_roll>) matches expected values for two different ranges: `10UL` and `4294967231UL`.
    - After all tests, clean up the random number generator by leaving and deleting it, ensuring the pointer matches the original `_rng` array.
- **Output**: No output is returned; the function performs internal tests and assertions.
- **Functions Called**:
    - [`fd_chacha_rng_join`](<fd_chacha_rng.c.md#fd_chacha_rng_join>)
    - [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>)
    - [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>)
    - [`fd_chacha20_rng_ulong_roll`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong_roll>)
    - [`fd_chacha_rng_delete`](<fd_chacha_rng.c.md#fd_chacha_rng_delete>)
    - [`fd_chacha_rng_leave`](<fd_chacha_rng.c.md#fd_chacha_rng_leave>)


---
### test\_iterated<!-- {{#callable:test_iterated}} -->
[View Source →](<../../../../../src/ballet/chacha/test_chacha_rng_roll.c#L128>)

Performs a series of random number generations using a ChaCha20-based RNG and verifies the final result against an expected value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha20 RNG with a predefined mode and key.
    - Set an initial value `n` to 100,000,000.
    - Iterate 1,000,000,000 times, updating `n` by rolling the RNG and applying a mathematical transformation.
    - Verify that the final value of `n` matches the expected result `10620388038139726539UL`.
- **Output**: No output is returned; the function performs an internal test and asserts the correctness of the RNG operations.
- **Functions Called**:
    - [`fd_chacha_rng_join`](<fd_chacha_rng.c.md#fd_chacha_rng_join>)
    - [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>)
    - [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>)
    - [`fd_chacha20_rng_ulong_roll`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong_roll>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/chacha/test_chacha_rng_roll.c#L159>)

Initializes the program, processes command-line arguments, runs tests, and performs random number generation using the ChaCha20 algorithm.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Checks if the '--help' argument is present and calls `usage()` if true.
    - Initializes the program with `fd_boot`.
    - Sets the logging level for both logfile and stderr to debug mode.
    - Runs three test functions: [`test_matches_rust_sample_single`](<#test_matches_rust_sample_single>), [`test_matches_rust_sample`](<#test_matches_rust_sample>), and [`test_iterated`](<#test_iterated>).
    - Logs a notice indicating that built-in tests have passed.
    - Reads command-line parameters '--range', '--count', and '--key' using `fd_env_strip_cmdline_ulong`.
    - Checks if the values for 'n' and 'c' are valid; if not, calls `usage()`.
    - Initializes a ChaCha20 random number generator with the provided key.
    - Performs 'c' number of random number generations within the range 'n'.
    - Cleans up the random number generator and halts the program.
- **Output**: Returns 0 upon successful execution or 1 if the '--help' argument is provided or if required parameters are missing.
- **Functions Called**:
    - [`usage`](<#usage>)
    - [`test_matches_rust_sample_single`](<#test_matches_rust_sample_single>)
    - [`test_matches_rust_sample`](<#test_matches_rust_sample>)
    - [`test_iterated`](<#test_iterated>)
    - [`fd_chacha_rng_join`](<fd_chacha_rng.c.md#fd_chacha_rng_join>)
    - [`fd_chacha_rng_new`](<fd_chacha_rng.c.md#fd_chacha_rng_new>)
    - [`fd_chacha20_rng_init`](<fd_chacha_rng.c.md#fd_chacha20_rng_init>)
    - [`fd_chacha20_rng_ulong_roll`](<fd_chacha_rng.h.md#fd_chacha20_rng_ulong_roll>)
    - [`fd_chacha_rng_delete`](<fd_chacha_rng.c.md#fd_chacha_rng_delete>)
    - [`fd_chacha_rng_leave`](<fd_chacha_rng.c.md#fd_chacha_rng_leave>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)