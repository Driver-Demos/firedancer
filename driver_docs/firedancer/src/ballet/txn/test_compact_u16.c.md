<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the decoding function `fd_cu16_dec` for correctness and domain validation against encoding.

# Purpose
The code is a test suite for verifying the correctness of a decoding function, `fd_cu16_dec`, which is part of a system that encodes and decodes 16-bit unsigned integers (`ushort`) into a compact byte representation. The test suite ensures that the decoding function is both injective and surjective within its proper domain. This means that each encoded byte pattern should map to a unique `ushort` value (injective), and every possible `ushort` value should be represented by some byte pattern (surjective). The code tests the decoding function by comparing its output against the expected results from the encoding function, `fd_cu16_enc`, and checks that the decoding function correctly rejects invalid inputs.

The test suite initializes a random number generator and iterates over a range of possible encoded byte patterns, checking that the decoding function produces the expected results. It logs progress and verifies that each `ushort` value is correctly decoded from its corresponding byte pattern. The code also ensures that the decoding function does not accept byte patterns outside its valid domain. The test concludes by confirming that all expected `ushort` values have been encountered and logs a success message if all tests pass.
# Imports and Dependencies

---
- `fd_compact_u16.h`


# Global Variables

---
### compact\_u16
- **Type**: ``uchar``
- **Description**: An array of unsigned characters (`uchar`) with dimensions defined by `TEST_U16_MAX` and `TEST_U16_BUF_SZ`. It is used to store compact representations of 16-bit unsigned integers.
- **Use**: Stores the compact representation of 16-bit unsigned integers for encoding and decoding operations.


---
### found
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size defined by `TEST_U16_MAX`. It is used to track which `ushort` values have been successfully decoded by the `fd_cu16_dec` function.
- **Use**: Used to mark `ushort` values that have been decoded correctly by setting the corresponding index to 1.


---
### encoded\_sz
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters (`uchar`) with a size defined by `TEST_U16_MAX`. Each element in the array stores the encoded size of a corresponding `ushort` value after it is processed by the `fd_cu16_enc` function.
- **Use**: Used to store the encoded size of each `ushort` value for later verification in the decoding process.


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/txn/test_compact_u16.c#L11>)

Tests the [`fd_cu16_dec`](<fd_compact_u16.h.md#fd_cu16_dec>) function to ensure it is the inverse of the encoding function and correctly handles inputs within and outside its domain.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Initializes a random number generator `rng`.
    - Encodes each `ushort` value up to `TEST_U16_MAX` using [`fd_cu16_enc`](<fd_compact_u16.h.md#fd_cu16_enc>) and stores the encoded size in `encoded_sz`.
    - Iterates over possible buffer sizes from 0 to `TEST_U16_BUF_SZ`.
    - For each buffer size, iterates over all possible values that fit in the buffer size.
    - Logs progress for the largest buffer size when certain conditions are met.
    - Decodes each buffer using [`fd_cu16_dec`](<fd_compact_u16.h.md#fd_cu16_dec>) and checks if the consumed size matches the encoded size.
    - Verifies injectivity by ensuring no duplicate decoding results and that the buffer matches the expected encoded value.
    - Marks the decoded result as found.
    - Checks surjectivity by ensuring all expected integers are found and no unexpected integers are found.
    - Deletes the random number generator.
    - Logs a success message and halts the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_cu16_enc`](<fd_compact_u16.h.md#fd_cu16_enc>)
    - [`fd_cu16_dec`](<fd_compact_u16.h.md#fd_cu16_dec>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)