<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for transaction account categories and size calculations in the Firedancer codebase.

# Purpose
The code is a C source file that implements a test suite for validating the functionality of transaction structures and operations in a system, likely related to a blockchain or distributed ledger. It includes static assertions to ensure that certain size and alignment constraints are met, which are critical for the correct operation of the transaction processing system. The code defines macros to calculate the minimum payload size and parsed size of transactions, ensuring they fit within specified limits.

The main components of the code include functions to iterate over account categories and test the correctness of account counting and iteration logic. The [`iterate_all_acct_categories`](<#iterate_all_acct_categories>) function generates various combinations of account categories and applies a given function to test these combinations. The [`test_cnt`](<#test_cnt>) and [`test_iter`](<#test_iter>) functions verify that the transaction structure correctly counts and iterates over different types of accounts, such as writable signers, readonly signers, and alternate accounts. The [`main`](<#main>) function initializes the test environment, performs tests on transaction structures, and checks that the calculated sizes conform to the defined maximums. The code concludes by logging a success message if all tests pass.
# Imports and Dependencies

---
- `fd_txn.h`


# Functions

---
### iterate\_all\_acct\_categories<!-- {{#callable:iterate_all_acct_categories}} -->
[View Source →](<../../../../../src/ballet/txn/test_txn.c#L51>)

Iterates over all possible account category combinations and applies a given function to each combination.
- **Inputs**:
    - `fn`: A pointer to a function that takes a pointer to `fd_txn_t` and six `ulong` values as arguments.
- **Logic and Control Flow**:
    - Initializes a loop that iterates 128 times, corresponding to all possible combinations of account categories.
    - For each iteration, calculates the number of writable signers (`ws`), readonly signers (`rs`), writable non-signers (`wi`), readonly non-signers (`ri`), writable address table entries (`wa`), and readonly address table entries (`ra`) using bitwise operations on the loop index `x`.
    - Initializes a `fd_txn_t` structure with specific values for transaction version, signature count, readonly signed count, readonly unsigned count, account address count, address table lookup count, additional writable count, and additional count based on the calculated values.
    - Calls the provided function `fn` with the initialized `fd_txn_t` structure and the calculated values `ws`, `rs`, `wi`, `ri`, `wa`, and `ra`.
- **Output**: No return value; the function operates by side effects through the provided function pointer `fn`.


---
### test\_cnt<!-- {{#callable:test_cnt}} -->
[View Source →](<../../../../../src/ballet/txn/test_txn.c#L75>)

Validates that the account counts in a transaction match expected values for various account categories.
- **Inputs**:
    - `txn`: A pointer to an `fd_txn_t` structure representing the transaction to test.
    - `ws`: The expected count of writable signer accounts.
    - `rs`: The expected count of readonly signer accounts.
    - `wi`: The expected count of writable non-signer immediate accounts.
    - `ri`: The expected count of readonly non-signer immediate accounts.
    - `wa`: The expected count of writable alternate accounts.
    - `ra`: The expected count of readonly alternate accounts.
- **Logic and Control Flow**:
    - Calls [`fd_txn_account_cnt`](<fd_txn.h.md#fd_txn_account_cnt>) for each account category and compares the result to the expected count using `FD_TEST`.
    - Checks individual categories: writable signer, readonly signer, writable non-signer immediate, readonly non-signer immediate, writable alternate, and readonly alternate.
    - Checks combined categories: writable, readonly, signer, non-signer, immediate, alternate, all, and none.
    - Verifies that the sum of specific categories matches the expected total for combined categories.
- **Output**: No output is returned; the function uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_txn_account_cnt`](<fd_txn.h.md#fd_txn_account_cnt>)


---
### test\_iter<!-- {{#callable:test_iter}} -->
[View Source →](<../../../../../src/ballet/txn/test_txn.c#L100>)

Validates the iteration over different account categories in a transaction using expected indices.
- **Inputs**:
    - ``txn``: A pointer to a `fd_txn_t` structure representing the transaction to test.
    - ``ws``: The number of writable signer accounts.
    - ``rs``: The number of readonly signer accounts.
    - ``wi``: The number of writable non-signer immediate accounts.
    - ``ri``: The number of readonly non-signer immediate accounts.
    - ``wa``: The number of writable alternate accounts.
    - ``ra``: The number of readonly alternate accounts.
- **Logic and Control Flow**:
    - Initialize an array `expected` to store expected indices and a counter `expected_cnt` to zero.
    - Define macros `RESET`, `INCLUDE`, and `SKIP` to manage index calculations and expected count.
    - Iterate over each account category using [`fd_txn_acct_iter_init`](<fd_txn.h.md#fd_txn_acct_iter_init>) and [`fd_txn_acct_iter_next`](<fd_txn.h.md#fd_fn_constfd_txn_acct_iter_next>).
    - For each category, reset counters and determine expected indices using `INCLUDE` and `SKIP`.
    - Compare each index from the iterator with the expected index using `FD_TEST`.
    - Ensure the number of indices iterated matches the expected count.
- **Output**: No return value; the function performs validation checks using `FD_TEST`.
- **Functions Called**:
    - [`fd_txn_acct_iter_init`](<fd_txn.h.md#fd_txn_acct_iter_init>)
    - [`FD_FN_CONST::fd_txn_acct_iter_end`](<fd_txn.h.md#fd_fn_constfd_txn_acct_iter_end>)
    - [`FD_FN_CONST::fd_txn_acct_iter_next`](<fd_txn.h.md#fd_fn_constfd_txn_acct_iter_next>)
    - [`FD_FN_CONST::fd_txn_acct_iter_idx`](<fd_txn.h.md#fd_fn_constfd_txn_acct_iter_idx>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/txn/test_txn.c#L207>)

Initializes the system, performs various tests on transaction structures, and logs the results before halting.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the system with command-line arguments.
    - Initializes a transaction `txn1` and performs tests to verify address table offsets and footprint size.
    - Initializes another transaction `txn2`, sets instruction and address table lookup counts, and performs similar tests with calculated sizes.
    - Iterates over possible instruction and address table counts, testing payload and parsed sizes against maximum allowed sizes.
    - Calls [`iterate_all_acct_categories`](<#iterate_all_acct_categories>) with `test_cnt` and `test_iter` functions to perform additional tests on account categories.
    - Logs a notice indicating the tests passed.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_txn_get_address_tables_const`](<fd_txn.h.md#fd_txn_get_address_tables_const>)
    - [`fd_txn_footprint`](<fd_txn.h.md#fd_txn_footprint>)
    - [`iterate_all_acct_categories`](<#iterate_all_acct_categories>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)