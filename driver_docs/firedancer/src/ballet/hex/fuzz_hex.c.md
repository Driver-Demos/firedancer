<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Fuzz testing for hex encoding and decoding with initialization and validation functions.

# Purpose
The code is a fuzz testing module designed to test the robustness of hexadecimal encoding and decoding functions. It includes a function [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) that sets up the environment for fuzz testing by configuring logging and initializing necessary components. The function [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>) is the main entry point for the fuzzing process. It takes an input data buffer, checks if the size exceeds a predefined maximum, and then processes the data as a hexadecimal string. The function [`check_hex_encoding`](<#check_hex_encoding>) verifies the validity of the hexadecimal encoding, ensuring that all characters are valid hexadecimal digits. The `fd_hex_decode` function is used to decode the hexadecimal string, and the result is checked against the expected size derived from the encoding check.

The module includes necessary headers and utility functions from external sources, such as `fd_util.h` and `fd_fuzz.h`, indicating that it relies on a broader framework for its operation. The code is structured to be used with LLVM's libFuzzer, a library for fuzz testing, as indicated by the function names and the initialization pattern. The use of assertions and logging configurations suggests that the module is intended to identify and report errors or unexpected behavior during the fuzz testing process.
# Imports and Dependencies

---
- `assert.h`
- `stdio.h`
- `stdlib.h`
- `../../util/fd_util.h`
- `../../util/sanitize/fd_fuzz.h`
- `fd_hex.h`


# Functions

---
### LLVMFuzzerInitialize<!-- {{#callable:LLVMFuzzerInitialize}} -->
[View Source →](<../../../../../src/ballet/hex/fuzz_hex.c#L13>)

Initializes the fuzzer environment by setting environment variables, booting the system, registering an exit function, and setting the log level.
- **Inputs**:
    - `argc`: A pointer to the argument count, typically from the command line.
    - `argv`: A pointer to the argument vector, typically from the command line.
- **Logic and Control Flow**:
    - Sets the environment variable `FD_LOG_BACKTRACE` to `0` to disable backtraces in logs.
    - Calls `fd_boot` with `argc` and `argv` to initialize the system.
    - Registers the `fd_halt` function to be called at program exit using `atexit`.
    - Sets the core log level to `3` using `fd_log_level_core_set`, which causes the program to crash on warning logs.
    - Returns `0` to indicate successful initialization.
- **Output**: Returns `0` to indicate successful initialization.


---
### check\_hex\_encoding<!-- {{#callable:check_hex_encoding}} -->
[View Source →](<../../../../../src/ballet/hex/fuzz_hex.c#L26>)

Validates if a given string is a valid hexadecimal encoding and returns the size or the index of the first invalid character.
- **Inputs**:
    - `enc`: A pointer to a constant character array representing the string to check for hexadecimal encoding.
    - `sz`: An unsigned long integer representing the size of the string to check.
- **Logic and Control Flow**:
    - Initialize a loop counter `i` to 0.
    - Iterate over each character in the string `enc` up to `sz`.
    - For each character `c`, check if it is a valid hexadecimal character ('0'-'9', 'a'-'f', 'A'-'F').
    - If `c` is valid, continue to the next character.
    - If `c` is not valid, return the current index `i`.
    - If all characters are valid, return `sz`.
- **Output**: Returns the size `sz` if the string is a valid hexadecimal encoding; otherwise, returns the index of the first invalid character.


---
### LLVMFuzzerTestOneInput<!-- {{#callable:LLVMFuzzerTestOneInput}} -->
[View Source →](<../../../../../src/ballet/hex/fuzz_hex.c#L42>)

Processes input data by decoding it from hexadecimal format and verifies its validity.
- **Inputs**:
    - `data`: A pointer to the input data in hexadecimal format.
    - `size`: The size of the input data in bytes.
- **Logic and Control Flow**:
    - Check if `size` exceeds `MAX_DATA_SZ`; if true, return -1.
    - Cast `data` to a `char` pointer `encoded`.
    - Adjust `size` to be even by clearing the least significant bit.
    - Decode the `encoded` data into `decoded` using [`fd_hex_decode`](<fd_hex.c.md#fd_hex_decode>), with half of the adjusted `size`.
    - Assert that the decoded size matches the result of [`check_hex_encoding`](<#check_hex_encoding>) divided by 2.
    - Invoke `FD_FUZZ_MUST_BE_COVERED` to ensure code coverage.
- **Output**: Returns 0 if the input data is processed successfully, otherwise returns -1 if the size exceeds `MAX_DATA_SZ`.
- **Functions Called**:
    - [`fd_hex_decode`](<fd_hex.c.md#fd_hex_decode>)
    - [`check_hex_encoding`](<#check_hex_encoding>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)