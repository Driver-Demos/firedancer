<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Fuzz testing for SHA-512 hashing functions with single and batch message processing.

# Purpose
The code is a fuzz testing suite for the SHA-512 hashing algorithm. It is designed to test the robustness and correctness of the SHA-512 implementation by processing random input data. The code includes two main functions: [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) and [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>). The [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) function sets up the environment for the fuzzer by configuring logging and initializing necessary resources. The [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>) function is the core of the fuzz testing process, where it takes random input data, hashes it using the SHA-512 algorithm, and verifies the consistency of the hashing process by comparing the results of different hashing methods.

The code uses both single message hashing and batch message hashing to ensure comprehensive testing. It initializes a SHA-512 context, processes the input data, and finalizes the hash computation. For batch processing, it divides the input data into multiple messages, hashes each message, and verifies the results against reference hashes. The code includes assertions to ensure that the hashing functions behave as expected, and it uses the `FD_FUZZ_MUST_BE_COVERED` macro to mark sections of the code that must be executed during fuzz testing. The code is intended to be used in a hosted environment, as indicated by the preprocessor directive checking for `FD_HAS_HOSTED`.
# Imports and Dependencies

---
- `assert.h`
- `stdio.h`
- `stdlib.h`
- `../../util/fd_util.h`
- `../../util/sanitize/fd_fuzz.h`
- `fd_sha512.h`


# Global Variables

---
### batch\_sha
- **Type**: ``fd_sha512_batch_t` array`
- **Description**: An array of type `fd_sha512_batch_t` with a single element, used for batch processing of SHA-512 hashes.
- **Use**: Used to initialize and manage batch SHA-512 hashing operations.


---
### hash1
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters with a size defined by `FD_SHA512_HASH_SZ`. It is used to store the result of a SHA-512 hash operation.
- **Use**: Stores the hash result of a single message processed by the `fd_sha512_fini` function.


---
### hash2
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters with a size defined by `FD_SHA512_HASH_SZ`. It is used to store the result of a SHA-512 hash operation.
- **Use**: Stores the hash result of the `fd_sha512_hash` function for comparison with another hash result.


---
### ref\_hash
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters with a size defined by `FD_SHA512_HASH_SZ`. It is used to store a reference hash value for comparison purposes.
- **Use**: Used to store the result of a SHA-512 hash operation for validation against other hash computations.


---
### hash\_mem
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters (`uchar`) with a size of `FD_SHA512_HASH_SZ * BATCH_CNT`. It is used to store hash values for batch processing.
- **Use**: Stores hash values for each batch in the SHA-512 batch hashing process.


---
### hashes
- **Type**: ``uchar *` array`
- **Description**: An array of pointers to unsigned characters, where each pointer in the array is intended to point to a memory location that stores a SHA-512 hash. The array has a size defined by the `BATCH_CNT` macro, which is set to 32.
- **Use**: Used to store the resulting hashes from batch processing of messages in the `LLVMFuzzerTestOneInput` function.


---
### messages
- **Type**: ``char const *` array`
- **Description**: An array of constant character pointers, `messages` holds the addresses of message data to be processed in batch operations. The array size is defined by the `BATCH_CNT` macro, which specifies the number of messages to be processed in a batch.
- **Use**: Used to store pointers to message data for batch processing in SHA-512 hashing operations.


---
### msg\_sizes
- **Type**: ``ulong` array`
- **Description**: An array of unsigned long integers with a size defined by the `BATCH_CNT` macro, which is set to 32. Each element in the array represents the size of a message in a batch of messages to be hashed.
- **Use**: Stores the sizes of individual messages in a batch for SHA-512 hashing operations.


# Functions

---
### LLVMFuzzerInitialize<!-- {{#callable:LLVMFuzzerInitialize}} -->
[View Source →](<../../../../../src/ballet/sha512/fuzz_sha512.c#L24>)

Initializes the fuzzer environment by setting environment variables, booting the system, registering an exit function, and setting the log level.
- **Inputs**:
    - `argc`: A pointer to the argument count, typically passed from the main function.
    - `argv`: A pointer to the argument vector, typically passed from the main function.
- **Logic and Control Flow**:
    - Set the environment variable `FD_LOG_BACKTRACE` to `0` to disable backtraces in logs.
    - Call `fd_boot` with `argc` and `argv` to initialize the system.
    - Register `fd_halt` to be called on program exit using `atexit`.
    - Set the core log level to `3` using `fd_log_level_core_set`, which will cause the program to crash on warning logs.
    - Return `0` to indicate successful initialization.
- **Output**: Returns `0` to indicate successful initialization.


---
### LLVMFuzzerTestOneInput<!-- {{#callable:LLVMFuzzerTestOneInput}} -->
[View Source →](<../../../../../src/ballet/sha512/fuzz_sha512.c#L35>)

Processes input data by hashing it using SHA-512, both individually and in batches, and verifies the consistency of the hashes.
- **Inputs**:
    - `fuzz_data`: A pointer to the input data to be hashed.
    - `fuzz_sz`: The size of the input data in bytes.
- **Logic and Control Flow**:
    - Converts `fuzz_data` to a message pointer `msg`.
    - Initializes a SHA-512 context `sha` and appends the message `msg` to it.
    - Finalizes the SHA-512 hash into `hash1` and computes a direct hash into `hash2`.
    - Compares `hash1` and `hash2` to ensure they are identical.
    - If `fuzz_sz` is greater than or equal to `BATCH_CNT`, initializes a batch SHA-512 context `batch_sha`.
    - Divides the input data into `BATCH_CNT` segments and processes each segment individually.
    - Adds each segment to the batch SHA-512 context and finalizes the batch hash.
    - Verifies each batch hash against a reference hash `ref_hash`.
    - Returns 0 after processing.
- **Output**: Returns 0 after processing the input data.
- **Functions Called**:
    - [`fd_sha512_init`](<fd_sha512.c.md#fd_sha512_init>)
    - [`fd_sha512_append`](<fd_sha512.c.md#fd_sha512_append>)
    - [`fd_sha512_fini`](<fd_sha512.c.md#fd_sha512_fini>)
    - [`fd_sha512_hash`](<fd_sha512.c.md#fd_sha512_hash>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)