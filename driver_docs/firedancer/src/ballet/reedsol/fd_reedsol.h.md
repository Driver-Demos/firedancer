<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for Reed-Solomon encoding and recovery of data shreds, optimized for Solana's Turbine.

# Purpose
The `fd_reedsol.h` file provides an interface for Reed-Solomon encoding and decoding operations. It defines a set of APIs to produce Reed-Solomon encoded parity data and to reconstruct missing data from parity data. The encoding process is optimized for specific use cases, such as those typical in the Solana blockchain, where data is divided into units called "shreds." The file includes definitions for maximum data and parity shreds, alignment, and footprint requirements, as well as error codes for handling recovery operations.

The file defines a structure, `fd_reedsol_t`, which is used to manage the state of encoding and recovery operations. It includes functions to initialize, add data and parity shreds, and finalize or abort encoding and recovery processes. The encoding functions allow for the addition of data and parity shreds, while the recovery functions handle received and erased shreds. The file also provides utility functions to get error descriptions and to check alignment and footprint requirements. The APIs are designed to handle operations in a consistent and efficient manner, ensuring that data integrity is maintained during encoding and recovery processes.
# Imports and Dependencies

---
- `../fd_ballet_base.h`


# Data Structures

---
### fd\_reedsol\_private
- **Type**: ``struct``
- **Members**:
    - ``scratch``: An array of 1024 unsigned characters used for high-performance operations.
    - ``shred_sz``: The size of each shred in bytes, with all shreds being the same size.
    - ``data_shred_cnt``: The number of data shreds added to the current operation.
    - ``parity_shred_cnt``: The number of parity shreds added to the current operation.
    - ``encode``: A structure containing pointers to the first byte of each data and parity shred for encoding.
    - ``recover``: A structure containing pointers to shreds and an array indicating if a shred is an erasure for recovery operations.
- **Description**: The `fd_reedsol_private` structure is used in Reed-Solomon encoding and recovery operations. It contains fields for managing shred sizes and counts, as well as unionized structures for encoding and recovery processes. The `encode` structure holds pointers to data and parity shreds for encoding, while the `recover` structure manages shreds and tracks erasures for recovery. This structure is aligned according to `FD_REEDSOL_ALIGN` to optimize performance.


---
### fd\_reedsol\_t
- **Type**: ``struct``
- **Members**:
    - ``scratch``: An array of 1024 unsigned characters used for high-performance implementation.
    - ``shred_sz``: The size of each shred in bytes, with all shreds being the same size.
    - ``data_shred_cnt``: The number of data shreds added to the current operation.
    - ``parity_shred_cnt``: The number of parity shreds added to the current operation.
    - ``encode.data_shred``: An array of pointers to the first byte of each data shred for encoding.
    - ``encode.parity_shred``: An array of pointers to the first byte of each parity shred for encoding.
    - ``recover.shred``: An array of pointers to shreds used in the recovery process.
    - ``recover.erased``: An array indicating whether each shred is an erasure, used only for decoding operations.
- **Description**: `fd_reedsol_t` is a structure used in Reed-Solomon encoding and recovery operations, optimized for handling data and parity shreds in Solana's blockchain context. It contains fields for managing the size and count of data and parity shreds, as well as arrays for storing pointers to these shreds during encoding and recovery processes. The structure supports high-performance operations by using a scratch space and is aligned to a specific byte boundary for efficiency. It facilitates both encoding of data into parity shreds and recovery of missing data from available shreds.


# Functions

---
### fd\_reedsol\_align<!-- {{#callable:fd_reedsol_align}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L73>)

Returns the alignment requirement in bytes for a `fd_reedsol_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the constant `FD_REEDSOL_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment requirement in bytes.


---
### fd\_reedsol\_footprint<!-- {{#callable:fd_reedsol_footprint}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L79>)

Returns the constant footprint size required for a `fd_reedsol_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_REEDSOL_FOOTPRINT`.
- **Output**: The function returns an `ulong` representing the footprint size in bytes, which is defined by the macro `FD_REEDSOL_FOOTPRINT`.


---
### fd\_reedsol\_encode\_init<!-- {{#callable:fd_reedsol_encode_init}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L91>)

Initializes a Reed-Solomon encoding operation with a specified shred size.
- **Inputs**:
    - `mem`: A pointer to a memory block that meets alignment and size constraints for the encoder.
    - `shred_sz`: The size of each shred in bytes, which must be at least 32.
- **Logic and Control Flow**:
    - Checks if `shred_sz` is less than 32; if true, returns `NULL`.
    - Casts `mem` to a `fd_reedsol_t` pointer and assigns it to `rs`.
    - Sets `rs->shred_sz` to `shred_sz`.
    - Initializes `rs->data_shred_cnt` and `rs->parity_shred_cnt` to 0.
    - Returns the initialized `rs` pointer.
- **Output**: Returns a pointer to the initialized `fd_reedsol_t` structure or `NULL` if `shred_sz` is less than 32.


---
### fd\_reedsol\_encode\_add\_data\_shred<!-- {{#callable:fd_reedsol_encode_add_data_shred}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L118>)

Adds a data shred to the in-process Reed-Solomon encoding operation.
- **Inputs**:
    - `rs`: A pointer to an initialized `fd_reedsol_t` structure representing the current encoding operation.
    - `ptr`: A pointer to the memory location of the data shred to be added.
- **Logic and Control Flow**:
    - The function casts `ptr` to a `uchar const*` and assigns it to the `data_shred` array at the index specified by `data_shred_cnt` in the `rs` structure.
    - The `data_shred_cnt` is then incremented by 1 to reflect the addition of the new data shred.
    - The function returns the updated `rs` pointer.
- **Output**: Returns the updated `fd_reedsol_t` pointer with the new data shred added.


---
### fd\_reedsol\_encode\_add\_parity\_shred<!-- {{#callable:fd_reedsol_encode_add_parity_shred}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L139>)

Adds a memory block as a parity shred to an ongoing Reed-Solomon encoding operation.
- **Inputs**:
    - `rs`: A pointer to an initialized `fd_reedsol_t` structure representing the current encoding operation.
    - `ptr`: A pointer to the memory block that will be used as the destination for a parity shred.
- **Logic and Control Flow**:
    - Accesses the `parity_shred` array within the `encode` union of the `fd_reedsol_t` structure.
    - Assigns the `ptr` to the current index of the `parity_shred` array, which is determined by `parity_shred_cnt`.
    - Increments the `parity_shred_cnt` to reflect the addition of a new parity shred.
    - Returns the updated `fd_reedsol_t` pointer.
- **Output**: Returns the updated `fd_reedsol_t` pointer with the new parity shred added.


---
### fd\_reedsol\_encode\_abort<!-- {{#callable:fd_reedsol_encode_abort}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L152>)

Resets the data and parity shred counts in a Reed-Solomon encoding operation to zero, effectively aborting the operation.
- **Inputs**:
    - `rs`: A pointer to an `fd_reedsol_t` structure representing the current Reed-Solomon encoding operation.
- **Logic and Control Flow**:
    - Set `rs->data_shred_cnt` to 0UL.
    - Set `rs->parity_shred_cnt` to 0UL.
- **Output**: No return value; the function modifies the `fd_reedsol_t` structure pointed to by `rs`.


---
### fd\_reedsol\_recover\_init<!-- {{#callable:fd_reedsol_recover_init}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L178>)

Initializes a Reed-Solomon recovery operation with specified shred size.
- **Inputs**:
    - ``mem``: A pointer to a memory block that will be used for the recovery operation; it must meet alignment and size constraints.
    - ``shred_sz``: The size of each shred in bytes, which must be at least 32.
- **Logic and Control Flow**:
    - Check if `shred_sz` is less than 32; if true, return `NULL`.
    - Cast `mem` to a `fd_reedsol_t` pointer and assign it to `rs`.
    - Set `rs->shred_sz` to `shred_sz`.
    - Initialize `rs->data_shred_cnt` and `rs->parity_shred_cnt` to 0.
    - Return the initialized `rs` pointer.
- **Output**: Returns a pointer to an initialized `fd_reedsol_t` structure for recovery operations, or `NULL` if `shred_sz` is less than 32.


---
### fd\_reedsol\_recover\_add\_rcvd\_shred<!-- {{#callable:fd_reedsol_recover_add_rcvd_shred}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L213>)

Adds a received shred to the Reed-Solomon recovery operation, updating the data or parity shred count based on the shred type.
- **Inputs**:
    - ``rs``: A pointer to a `fd_reedsol_t` structure, which represents the current state of the Reed-Solomon recovery operation.
    - ``is_data_shred``: An integer indicating whether the shred is a data shred (non-zero) or a parity shred (zero).
    - ``ptr``: A constant pointer to the memory location of the shred to be added.
- **Logic and Control Flow**:
    - Store the shred pointer in the `rs->recover.shred` array at the index determined by the sum of `rs->data_shred_cnt` and `rs->parity_shred_cnt`.
    - Set the corresponding index in `rs->recover.erased` to 0, indicating the shred is not erased.
    - Increment `rs->data_shred_cnt` if `is_data_shred` is non-zero, otherwise increment `rs->parity_shred_cnt`.
    - Return the updated `rs` pointer.
- **Output**: Returns the updated `fd_reedsol_t` pointer, reflecting the addition of the received shred.


---
### fd\_reedsol\_recover\_add\_erased\_shred<!-- {{#callable:fd_reedsol_recover_add_erased_shred}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L259>)

Adds an erased shred to the Reed-Solomon recovery operation and updates the shred counts.
- **Inputs**:
    - ``rs``: A pointer to a `fd_reedsol_t` structure representing the current recovery operation.
    - ``is_data_shred``: An integer indicating if the shred is a data shred (non-zero) or a parity shred (zero).
    - ``ptr``: A pointer to the memory block representing the erased shred to be added.
- **Logic and Control Flow**:
    - Store the pointer `ptr` in the `shred` array at the index `rs->data_shred_cnt + rs->parity_shred_cnt`.
    - Set the corresponding index in the `erased` array to 1, indicating the shred is erased.
    - Increment `data_shred_cnt` if `is_data_shred` is non-zero, otherwise increment `parity_shred_cnt`.
- **Output**: Returns the updated `fd_reedsol_t` pointer `rs`.


---
### fd\_reedsol\_recover\_abort<!-- {{#callable:fd_reedsol_recover_abort}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L281>)

Resets the data and parity shred counts in a Reed-Solomon recovery operation to zero, effectively aborting the operation.
- **Inputs**:
    - `rs`: A pointer to an `fd_reedsol_t` structure representing the current Reed-Solomon recovery operation.
- **Logic and Control Flow**:
    - Set `rs->data_shred_cnt` to 0UL.
    - Set `rs->parity_shred_cnt` to 0UL.
- **Output**: No return value; the function modifies the `fd_reedsol_t` structure pointed to by `rs`.


# Function Declarations (Public API)

---
### fd\_reedsol\_encode\_fini<!-- {{#callable_declaration:fd_reedsol_encode_fini}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L165>)

Completes the Reed-Solomon encoding operation.
- **Description**: Use this function to finalize an in-progress Reed-Solomon encoding operation. It processes the data and parity shreds that have been added to the encoder and fills the parity shreds with the correct encoded parity data. This function must be called after all data and parity shreds have been added using `fd_reedsol_encode_add_data_shred` and `fd_reedsol_encode_add_parity_shred`. After calling this function, the encoder will release any read or write interests in the shreds, and the encoder will no longer be initialized.
- **Inputs**:
    - `rs`: A pointer to an `fd_reedsol_t` structure that has been initialized as an encoder using `fd_reedsol_encode_init`. Must not be null. The function assumes that the structure is properly initialized and that the data and parity shreds have been correctly added.
- **Output**: None
- **See Also**: [`fd_reedsol_encode_fini`](<fd_reedsol.c.md#fd_reedsol_encode_fini>)  (Implementation)


---
### fd\_reedsol\_recover\_fini<!-- {{#callable_declaration:fd_reedsol_recover_fini}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L320>)

Completes a Reed-Solomon recovery operation.
- **Description**: Use this function to finalize a Reed-Solomon recovery operation. It attempts to recover missing data shreds using available data and parity shreds. Ensure that the recovery operation was properly initialized and that all necessary shreds have been added in the correct order before calling this function. The function will return a success code if recovery is successful, or an error code if it fails due to insufficient data or corruption. After this call, the recovery operation is complete, and the structure is no longer initialized.
- **Inputs**:
    - `rs`: A pointer to an initialized `fd_reedsol_t` structure representing the recovery operation. Must not be null. The structure should have been initialized with `fd_reedsol_recover_init` and populated with shreds using `fd_reedsol_recover_add_rcvd_shred` and `fd_reedsol_recover_add_erased_shred`.
- **Output**: Returns `FD_REEDSOL_SUCCESS` if recovery is successful, `FD_REEDSOL_ERR_CORRUPT` if the shreds are inconsistent, or `FD_REEDSOL_ERR_PARTIAL` if there is insufficient data to recover all data shreds. The contents of erased shreds are undefined if an error occurs.
- **See Also**: [`fd_reedsol_recover_fini`](<fd_reedsol.c.md#fd_reedsol_recover_fini>)  (Implementation)


---
### fd\_reedsol\_strerror<!-- {{#callable_declaration:fd_reedsol_strerror}} -->
[View Source →](<../../../../../src/ballet/reedsol/fd_reedsol.h#L330>)

Converts an error code to a human-readable string.
- **Description**: Use this function to obtain a human-readable description of an error code returned by Reed-Solomon operations. This is useful for logging or displaying error messages to users. The function accepts a predefined error code and returns a constant string describing the error. It handles known error codes and returns "unknown" for any unrecognized codes.
- **Inputs**:
    - `err`: An integer representing the error code. Valid values are `FD_REEDSOL_SUCCESS`, `FD_REEDSOL_ERR_CORRUPT`, and `FD_REEDSOL_ERR_PARTIAL`. Any other value will result in the return of "unknown".
- **Output**: A constant string describing the error code. The string is always non-NULL and has an infinite lifetime.
- **See Also**: [`fd_reedsol_strerror`](<fd_reedsol.c.md#fd_reedsol_strerror>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)