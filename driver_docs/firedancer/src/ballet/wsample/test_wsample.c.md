<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for weighted sampling functions, including chi-squared tests and various sampling scenarios.

# Purpose
The code is a C test suite designed to validate the functionality of a weighted sampling library. It includes various test functions that assess different aspects of the library's behavior, such as sampling with and without replacement, handling of edge cases like empty or poisoned data sets, and ensuring the statistical validity of the sampling process through a chi-squared goodness-of-fit test. The code uses a pseudo-random number generator (`fd_chacha_rng_t`) to facilitate the sampling processes and tests the library's ability to handle different configurations and scenarios.

The test suite is structured to cover a wide range of scenarios, including tests for probability distribution replacement and non-replacement, compatibility with specific configurations (e.g., Solana), and the ability to handle shared resources and restoration of states. It also includes tests for the library's footprint calculation and its behavior when dealing with indeterminate states. The main function initializes the test environment, runs all the test cases, and logs the results. The code is intended to be executed as a standalone program, as indicated by the presence of the [`main`](<#main>) function, which orchestrates the execution of the test cases and ensures that the library functions as expected.
# Imports and Dependencies

---
- `../fd_ballet_base.h`
- `fd_wsample.h`
- `math.h`


# Global Variables

---
### \_shmem
- **Type**: `uchar array`
- **Description**: An array of unsigned characters with a size defined by `MAX_FOOTPRINT`, which is calculated based on a constant `MAX` and other parameters. The array is aligned to a 128-byte boundary.
- **Use**: Used as a shared memory buffer for operations involving weighted sampling functions.


---
### \_shmem2
- **Type**: `uchar`
- **Description**: Defines a global array of unsigned characters with a size of `MAX_FOOTPRINT`, aligned to 128 bytes.
- **Use**: Used as a shared memory buffer for operations involving weighted sampling.


---
### weights
- **Type**: `ulong[MAX]`
- **Description**: An array of unsigned long integers with a size defined by the constant `MAX`. Each element in the array can store a weight value.
- **Use**: Used to store weight values for sampling operations in the program.


---
### counts
- **Type**: `ulong[MAX]`
- **Description**: `counts` is an array of unsigned long integers with a size defined by the constant `MAX`, which is set to 1024. This array is used to store count values for statistical analysis and sampling operations.
- **Use**: Used to store and update count values during statistical tests and sampling operations.


---
### seed
- **Type**: `uchar[32]`
- **Description**: An array of 32 unsigned characters initialized with values from 0 to 31. This array serves as a seed for random number generation.
- **Use**: Used to initialize the random number generator in the `fd_chacha20_rng_init` function.


# Functions

---
### chi\_squared\_test<!-- {{#callable:chi_squared_test}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L33>)

Performs a chi-squared goodness of fit test to compare observed and expected counts, using a pre-computed critical value for a given count.
- **Inputs**:
    - ``observed``: An array of unsigned long integers representing the observed counts.
    - ``expected``: An array of unsigned long integers representing the expected counts.
    - ``cnt``: An unsigned long integer representing the number of elements in the `observed` and `expected` arrays.
- **Logic and Control Flow**:
    - Initialize a float variable `stat` to 0.0f to accumulate the chi-squared statistic.
    - Iterate over each element in the `observed` and `expected` arrays, converting them to floats, and update `stat` with the squared difference between observed and expected values divided by the expected value.
    - Determine the `critical_value` based on the `cnt` using a switch statement with pre-computed values for specific counts.
    - Log the `cnt`, `stat`, and `critical_value` using `FD_LOG_NOTICE`.
    - Use `FD_TEST` to assert that `stat` is less than `critical_value`, indicating the null hypothesis is not rejected.
- **Output**: No return value; the function logs results and performs an assertion to test the hypothesis.


---
### test\_probability\_dist\_replacement<!-- {{#callable:test_probability_dist_replacement}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L63>)

Tests the probability distribution of weighted sampling with replacement using a chi-squared test for statistical validation.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initializes a ChaCha random number generator with a predefined seed.
    - Calculates weights for 1024 elements using a power-law distribution.
    - Iterates over different sample sizes, initializing a weighted sample tree for each size.
    - For each sample size, calculates the sum of weights and performs sampling with replacement, updating counts for each sample.
    - Performs a chi-squared test to validate the distribution of sampled counts against expected weights.
    - Repeats the sampling process in batches of 100 samples, updating counts and performing another chi-squared test.
    - Cleans up by deleting the weighted sample tree for each sample size.
- **Output**: No output is returned; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_sample`](<fd_wsample.c.md#fd_wsample_sample>)
    - [`chi_squared_test`](<#chi_squared_test>)
    - [`fd_wsample_sample_many`](<fd_wsample.c.md#fd_wsample_sample_many>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### test\_probability\_dist\_noreplacement<!-- {{#callable:test_probability_dist_noreplacement}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L100>)

Tests the probability distribution of sampling without replacement using a weighted sampling method.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initializes a random number generator `rng` using `fd_chacha_rng_join` and `fd_chacha20_rng_init` with a predefined seed.
    - Iterates over sample sizes from 1 to 1023, incrementing by 113 each time.
    - For each sample size, initializes a weighted sampling structure `partial` using [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>) with a power-law removal hint.
    - Adds weights to the sampling structure using [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>), inversely proportional to the index plus one.
    - Finalizes the sampling structure with [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>) and joins it to create a sampling tree `tree`.
    - Samples each element without replacement using [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>), ensuring each element is sampled exactly once.
    - Restores all elements in the sampling tree using [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>).
    - Samples multiple elements at once using [`fd_wsample_sample_and_remove_many`](<fd_wsample.c.md#fd_wsample_sample_and_remove_many>), ensuring all elements are sampled exactly once.
    - Deletes the sampling tree using [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>).
    - Tests a specific 4-element set to ensure the distribution of sampled 4-tuples matches expected probabilities.
    - Performs a chi-squared test on the observed and expected counts to validate the distribution.
- **Output**: No output is returned; the function performs tests and validations internally.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>)
    - [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>)
    - [`fd_wsample_sample_and_remove_many`](<fd_wsample.c.md#fd_wsample_sample_and_remove_many>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)
    - [`chi_squared_test`](<#chi_squared_test>)


---
### test\_matches\_solana<!-- {{#callable:test_matches_solana}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L185>)

Tests the functionality of weighted sampling using a specific random number generator and verifies the results against expected outcomes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initializes a ChaCha RNG with mode `FD_CHACHA_RNG_MODE_MOD` and a zero seed.
    - Creates a weighted sample tree with two elements and seeds it with the zero seed.
    - Performs a series of tests to ensure the sample tree returns expected values, specifically testing repeated sampling of the same element and a different element.
    - Deletes the sample tree and RNG resources.
    - Reinitializes the RNG with mode `FD_CHACHA_RNG_MODE_SHIFT` and a different seed.
    - Creates a new weighted sample tree with 18 elements, each with specified weights, and seeds it with the new seed.
    - Performs a series of tests to ensure the sample tree returns expected values in a specific order when sampling and removing elements.
    - Deletes the sample tree and RNG resources.
- **Output**: No output is returned; the function performs tests and uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_seed_rng`](<fd_wsample.c.md#fd_wsample_seed_rng>)
    - [`fd_wsample_get_rng`](<fd_wsample.c.md#fd_wsample_get_rng>)
    - [`fd_wsample_sample`](<fd_wsample.c.md#fd_wsample_sample>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)
    - [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>)


---
### test\_sharing<!-- {{#callable:test_sharing}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L248>)

Tests the interchangeability of two weighted sampling structures using the same random number generator and weights.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a random number generator `rng` with a zero seed.
    - Create two weighted sampling structures `ws1` and `ws2` using the same random number generator and weights.
    - Perform a series of tests to ensure that samples from `ws1` and `ws2` are interchangeable and produce expected results.
    - Delete the weighted sampling structures and the random number generator after testing.
- **Output**: No output is returned as the function is void and primarily performs tests with assertions.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_sample`](<fd_wsample.c.md#fd_wsample_sample>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### test\_restore\_disabled<!-- {{#callable:test_restore_disabled}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L280>)

Tests the behavior of the [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>) function when restoring samples from two weighted sample sets, one of which is disabled.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha RNG with a zero seed.
    - Create two weighted sample sets (`ws1` and `ws2`) using [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>), [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>), and [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>).
    - Sample and remove elements from both `ws1` and `ws2` until they are empty, verifying that samples are not empty until the sets are exhausted.
    - Attempt to restore all samples in `ws1` and `ws2` using [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>), checking that `ws1` returns `NULL` and `ws2` returns `ws2`.
    - Verify that `ws1` remains empty after restoration, while `ws2` is not empty.
    - Clean up by deleting the sample sets and the RNG.
- **Output**: No output is returned; the function performs tests and assertions to verify expected behavior.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>)
    - [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### test\_remove\_idx<!-- {{#callable:test_remove_idx}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L313>)

Tests the functionality of removing an index from a weighted sample and verifies the behavior of the sampling operations.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha RNG with a zero seed.
    - Create a weighted sample with two elements and add weights to them.
    - Remove the element at index 1 from the sample.
    - Verify that sampling the sample does not return the removed index 1.
    - Attempt to remove index 1 again, which is a no-op, and verify that sampling returns only index 0.
    - Sample and remove elements from the sample until it is empty, verifying the results.
    - Restore all elements in the sample and verify that sampling and removing works as expected until the sample is empty again.
    - Clean up by deleting the sample and RNG.
- **Output**: No direct output; the function uses assertions to verify the correctness of operations.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_remove_idx`](<fd_wsample.c.md#fd_wsample_remove_idx>)
    - [`fd_wsample_sample`](<fd_wsample.c.md#fd_wsample_sample>)
    - [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>)
    - [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### test\_map<!-- {{#callable:test_map}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L351>)

Tests the mapping of weighted samples to indices using a power-law distribution without removal.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha RNG with mode `FD_CHACHA_RNG_MODE_SHIFT`.
    - Set the sample size `sz` to 1018.
    - Initialize a weighted sample structure `partial` with power-law distribution hint and no removal.
    - Add weights to `partial` in a loop, where each weight is `2000000 / (i+1)`.
    - Finalize the weighted sample structure and join it to create `tree`.
    - Iterate over each index `i` and for each weight `j`, test that `fd_wsample_map_sample(tree, x++)` returns `i`.
    - Delete the weighted sample structure and RNG after testing.
- **Output**: No output is returned; the function performs tests using assertions.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_map_sample`](<fd_wsample.c.md#fd_wsample_map_sample>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### test\_empty<!-- {{#callable:test_empty}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L368>)

Tests the behavior of the weighted sampling functions when the sample set is empty.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha RNG with mode `FD_CHACHA_RNG_MODE_SHIFT`.
    - Create a new weighted sample structure with zero elements and join it to form a tree.
    - Verify that sampling from the tree returns `FD_WSAMPLE_EMPTY`.
    - Delete the tree and repeat the process with a poisoned tree, ensuring it still returns `FD_WSAMPLE_EMPTY`.
    - Clean up by deleting the RNG.
- **Output**: No output is returned as the function is void; it performs internal tests using `FD_TEST` assertions.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_sample`](<fd_wsample.c.md#fd_wsample_sample>)
    - [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### test\_footprint<!-- {{#callable:test_footprint}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L392>)

Verifies that the `FD_WSAMPLE_FOOTPRINT` macro and [`fd_wsample_footprint`](<fd_wsample.c.md#fd_wsample_footprint>) function produce the same results for various input values.
- **Inputs**: None
- **Logic and Control Flow**:
    - Iterates over integers from 0 to 999 and checks if `FD_WSAMPLE_FOOTPRINT(i, 0)` equals `fd_wsample_footprint(i, 0)` and `FD_WSAMPLE_FOOTPRINT(i, 1)` equals `fd_wsample_footprint(i, 1)`.
    - Iterates over integers starting from 729, multiplying by 3 each time, up to `UINT_MAX`, and checks the equality of `FD_WSAMPLE_FOOTPRINT` and [`fd_wsample_footprint`](<fd_wsample.c.md#fd_wsample_footprint>) for `i-1`, `i`, and `i+1` with both 0 and 1 as the second argument.
    - Iterates over integers starting from 512, multiplying by 2 each time, up to `UINT_MAX`, and performs the same checks as the previous loop.
- **Output**: No output is returned; the function uses assertions to verify correctness.
- **Functions Called**:
    - [`fd_wsample_footprint`](<fd_wsample.c.md#fd_wsample_footprint>)


---
### test\_poison<!-- {{#callable:test_poison}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L418>)

Tests the behavior of a weighted sampling tree with a focus on indeterminate outcomes and poison weights.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a ChaCha RNG and seed it with a predefined value.
    - Create a weighted sampling tree with 23 elements and a poison weight for the 24th element.
    - Calculate the sum of all weights.
    - Perform a sampling test to ensure the probability of indeterminate outcomes is correct, using a chi-squared test for validation.
    - Conduct a test to verify that once an indeterminate outcome is reached, it remains indeterminate in subsequent samples.
    - Restore the sampling tree after each test iteration.
    - Verify that the total number of indeterminate outcomes is less than a specified threshold.
    - Clean up by deleting the sampling tree and RNG.
- **Output**: No output is returned; the function performs tests and assertions internally.
- **Functions Called**:
    - [`fd_wsample_new_init`](<fd_wsample.c.md#fd_wsample_new_init>)
    - [`fd_wsample_new_add`](<fd_wsample.c.md#fd_wsample_new_add>)
    - [`fd_wsample_join`](<fd_wsample.c.md#fd_wsample_join>)
    - [`fd_wsample_new_fini`](<fd_wsample.c.md#fd_wsample_new_fini>)
    - [`fd_wsample_sample`](<fd_wsample.c.md#fd_wsample_sample>)
    - [`chi_squared_test`](<#chi_squared_test>)
    - [`fd_wsample_sample_and_remove`](<fd_wsample.c.md#fd_wsample_sample_and_remove>)
    - [`fd_wsample_restore_all`](<fd_wsample.c.md#fd_wsample_restore_all>)
    - [`fd_wsample_delete`](<fd_wsample.c.md#fd_wsample_delete>)
    - [`fd_wsample_leave`](<fd_wsample.c.md#fd_wsample_leave>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L466>)

Initializes the environment, runs a series of tests on weighted sampling functions, and logs the results before halting.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Performs a footprint test using [`fd_wsample_footprint`](<fd_wsample.c.md#fd_wsample_footprint>) and checks its result against `MAX_FOOTPRINT`.
    - Executes a series of test functions: [`test_matches_solana`](<#test_matches_solana>), [`test_map`](<#test_map>), [`test_sharing`](<#test_sharing>), [`test_restore_disabled`](<#test_restore_disabled>), [`test_remove_idx`](<#test_remove_idx>), [`test_empty`](<#test_empty>), [`test_footprint`](<#test_footprint>), and [`test_poison`](<#test_poison>).
    - Runs additional tests for probability distributions with and without replacement using [`test_probability_dist_replacement`](<#test_probability_dist_replacement>) and [`test_probability_dist_noreplacement`](<#test_probability_dist_noreplacement>).
    - Logs a notice message indicating the tests passed using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_wsample_footprint`](<fd_wsample.c.md#fd_wsample_footprint>)
    - [`test_matches_solana`](<#test_matches_solana>)
    - [`test_map`](<#test_map>)
    - [`test_sharing`](<#test_sharing>)
    - [`test_restore_disabled`](<#test_restore_disabled>)
    - [`test_remove_idx`](<#test_remove_idx>)
    - [`test_empty`](<#test_empty>)
    - [`test_footprint`](<#test_footprint>)
    - [`test_poison`](<#test_poison>)
    - [`test_probability_dist_replacement`](<#test_probability_dist_replacement>)
    - [`test_probability_dist_noreplacement`](<#test_probability_dist_noreplacement>)


# Function Declarations (Public API)

---
### fd\_wsample\_map\_sample<!-- {{#callable_declaration:fd_wsample_map_sample}} -->
[View Source →](<../../../../../src/ballet/wsample/test_wsample.c#L349>)

Maps a query to a sample index using a weighted sampler.
- **Description**: Use this function to obtain a sample index from a weighted sampler based on a given query. This function is useful when you need to map a specific query to a sample index in a probabilistic manner. Ensure that the sampler is properly initialized and configured before calling this function. The function does not modify the sampler or the query.
- **Inputs**:
    - `sampler`: A pointer to a `fd_wsample_t` structure representing the weighted sampler. Must not be null. The caller retains ownership.
    - `query`: An unsigned long integer representing the query to map. The function does not impose specific constraints on the value of the query.
- **Output**: Returns an unsigned long integer representing the index of the sample corresponding to the query.
- **See Also**: [`fd_wsample_map_sample`](<fd_wsample.c.md#fd_wsample_map_sample>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)