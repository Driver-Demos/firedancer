<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for Zstandard decompression functionality using predefined test vectors and validation checks.

# Purpose
The code is a C program that tests the functionality of Zstandard (ZSTD) decompression using a custom implementation. It includes headers for Zstandard and utility functions, and it checks for the presence of Zstandard support. The program defines static test vectors, which are compressed data samples, and uses these to verify the decompression process. The [`test_decompress`](<#test_decompress>) function is a key component that performs various decompression tests, including successful decompression, byte-by-byte decompression, and handling of partial compressions. It uses assertions to ensure that the decompression results match expected outputs.

The [`main`](<#main>) function initializes the environment, performs a series of tests on the Zstandard decompression stream, and logs the results. It includes a loop to estimate the size of the compression context for different compression levels, demonstrating the use of Zstandard's API. The program concludes by logging a success message and halting the execution. This code is intended to be an executable test suite for verifying the correctness and performance of Zstandard decompression in a controlled environment.
# Imports and Dependencies

---
- `fd_zstd.h`
- `fd_zstd_private.h`
- `../../util/fd_util.h`
- `stdalign.h`
- `stddef.h`
- `zstd.h`


# Global Variables

---
### test\_zstd\_comp\_0
- **Type**: ``uchar const[]``
- **Description**: An array of unsigned characters that contains the Zstandard compressed data for the string "AAAA".
- **Use**: Used as a test vector for decompression functions in the code.


---
### test\_zstd\_comp\_1
- **Type**: ``uchar const[]``
- **Description**: An array of unsigned characters that contains the Zstandard compressed data of the string "ABCD". The array is initialized with specific hexadecimal values representing the compressed form of the input string.
- **Use**: Used as a test vector for decompression functions to verify the correctness of Zstandard decompression.


# Functions

---
### test\_decompress<!-- {{#callable:test_decompress}} -->
[View Source →](<../../../../../src/ballet/zstd/test_zstd.c#L28>)

Tests the decompression functionality of a Zstandard decompression stream using predefined compressed data.
- **Inputs**: None
- **Logic and Control Flow**:
    - Verify the alignment of the decompression stream using `FD_TEST` and [`fd_zstd_dstream_align`](<fd_zstd.c.md#fd_zstd_dstream_align>).
    - Calculate the memory size required for the decompression stream using [`fd_zstd_dstream_footprint`](<fd_zstd.c.md#fd_zstd_dstream_footprint>) and allocate memory accordingly.
    - Create a new decompression stream with [`fd_zstd_dstream_new`](<fd_zstd.c.md#fd_zstd_dstream_new>) and verify its creation and properties using `FD_TEST`.
    - Perform a successful decompression test by reading from `test_zstd_comp_0` and verifying the output matches "AAAAAAAA".
    - Test decompression by reading input and output byte by byte from `test_zstd_comp_1`, verifying the output matches "ABCDABCD".
    - Repeat the byte-by-byte decompression test to ensure consistency.
    - Test decompression by reading output byte by byte, verifying the output matches "ABCD".
    - Test aborting a partial decompression, resetting the stream, and verifying the output matches "AAAA" after reset.
    - Delete the decompression stream with [`fd_zstd_dstream_delete`](<fd_zstd.c.md#fd_zstd_dstream_delete>) and verify the memory is released.
- **Output**: No output is returned as this function is a test function that uses assertions to verify decompression behavior.
- **Functions Called**:
    - [`fd_zstd_dstream_align`](<fd_zstd.c.md#fd_zstd_dstream_align>)
    - [`fd_zstd_dstream_footprint`](<fd_zstd.c.md#fd_zstd_dstream_footprint>)
    - [`fd_zstd_dstream_new`](<fd_zstd.c.md#fd_zstd_dstream_new>)
    - [`fd_zstd_dstream_read`](<fd_zstd.c.md#fd_zstd_dstream_read>)
    - [`fd_zstd_dstream_reset`](<fd_zstd.c.md#fd_zstd_dstream_reset>)
    - [`fd_zstd_dstream_delete`](<fd_zstd.c.md#fd_zstd_dstream_delete>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/zstd/test_zstd.c#L136>)

Initializes the environment, tests Zstandard compression and decompression, logs context size estimates, and terminates the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Initializes a `fd_zstd_peek_t` structure and tests [`fd_zstd_peek`](<fd_zstd.h.md#fd_zstd_peek>) with various input sizes, checking for expected results.
    - Calls [`test_decompress`](<#test_decompress>) to perform decompression tests on predefined test vectors.
    - Iterates over compression levels from 0 to 19, logging the estimated context size for each level using `ZSTD_estimateCCtxSize`.
    - Logs a notice message indicating the tests passed.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_zstd_peek`](<fd_zstd.h.md#fd_zstd_peek>)
    - [`test_decompress`](<#test_decompress>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)