<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Fuzz testing for SHA-256 hashing functions with single and batch message processing.

# Purpose
This code is a fuzz testing suite for the SHA-256 hashing algorithm. It is designed to test the robustness and correctness of the SHA-256 implementation by using fuzzing techniques. The code includes the necessary headers and checks for the `FD_HAS_HOSTED` macro to ensure that the target environment supports hosted execution. It initializes the fuzzing environment with [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>), which sets up the logging and signal handling environment, and registers a cleanup function to be called at program exit.

The main function, [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>), processes input data by hashing it using the SHA-256 algorithm. It performs both single message hashing and batch message hashing. For single message hashing, it initializes a SHA-256 context, appends the input data, and finalizes the hash, ensuring that the computed hash matches the expected result. For batch hashing, the input data is divided into multiple messages, each hashed separately, and the results are verified against reference hashes. The code uses assertions to validate the correctness of each step, and it includes macros like `FD_FUZZ_MUST_BE_COVERED` to ensure that all code paths are exercised during fuzz testing.
# Imports and Dependencies

---
- `assert.h`
- `stdio.h`
- `stdlib.h`
- `../../util/fd_util.h`
- `../../util/sanitize/fd_fuzz.h`
- `fd_sha256.h`


# Global Variables

---
### batch\_sha
- **Type**: ``fd_sha256_batch_t` array`
- **Description**: `batch_sha` is a static array of type `fd_sha256_batch_t` with a size of 1. It is used to store the state for batch processing of SHA-256 hashes.
- **Use**: Used to initialize, add messages to, and finalize a batch of SHA-256 hash computations.


---
### hash1
- **Type**: ``uchar` array`
- **Description**: `hash1` is a static array of unsigned characters with a size defined by `FD_SHA256_HASH_SZ`. It stores the result of a SHA-256 hash operation.
- **Use**: Used to store the hash output of a single message processed by the `fd_sha256_fini` function.


---
### hash2
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters with a size defined by `FD_SHA256_HASH_SZ`. It is used to store the result of a SHA-256 hash operation.
- **Use**: Stores the SHA-256 hash of input data for comparison and verification purposes.


---
### ref\_hash
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters with a size defined by `FD_SHA256_HASH_SZ`. It is used to store a reference hash value for comparison purposes.
- **Use**: Used to store the reference hash value for verifying the correctness of batch hash computations.


---
### hash\_mem
- **Type**: ``uchar` array`
- **Description**: An array of unsigned characters (`uchar`) with a size of `FD_SHA256_HASH_SZ * BATCH_CNT`. It is used to store hash values for batch processing.
- **Use**: Stores hash values for each batch entry during SHA-256 batch hashing operations.


---
### hashes
- **Type**: `uchar *`
- **Description**: An array of pointers to unsigned characters, where each pointer in the array corresponds to a hash output for a batch of messages.
- **Use**: Used to store the hash results of each message in a batch during the batch hashing process.


---
### messages
- **Type**: ``char const *` array`
- **Description**: An array of constant character pointers, `messages` holds pointers to the start of each message in a batch of data to be hashed. The size of the array is defined by the constant `BATCH_CNT`, which is set to 32.
- **Use**: Used to store pointers to message data for batch processing in SHA-256 hashing operations.


---
### msg\_sizes
- **Type**: ``ulong` array`
- **Description**: An array of unsigned long integers that stores the sizes of individual messages in a batch for SHA-256 hashing.
- **Use**: Used to keep track of the size of each message in a batch during the batch hashing process.


# Functions

---
### LLVMFuzzerInitialize<!-- {{#callable:LLVMFuzzerInitialize}} -->
[View Source →](<../../../../../src/ballet/sha256/fuzz_sha256.c#L24>)

Initializes the fuzzer environment by setting environment variables, booting the system, registering an exit function, and setting the log level.
- **Inputs**:
    - `argc`: A pointer to the argument count, typically passed from the main function.
    - `argv`: A pointer to the argument vector, typically passed from the main function.
- **Logic and Control Flow**:
    - Set the environment variable `FD_LOG_BACKTRACE` to `0` to disable backtrace logging.
    - Call `fd_boot` with `argc` and `argv` to initialize the system.
    - Register `fd_halt` to be called on program exit using `atexit`.
    - Set the core log level to `3` using `fd_log_level_core_set`, which will cause the program to crash on a warning log.
- **Output**: Returns `0` to indicate successful initialization.


---
### LLVMFuzzerTestOneInput<!-- {{#callable:LLVMFuzzerTestOneInput}} -->
[View Source →](<../../../../../src/ballet/sha256/fuzz_sha256.c#L35>)

Processes input data by computing SHA-256 hashes for both single and batch messages, verifying consistency between them.
- **Inputs**:
    - `fuzz_data`: A pointer to the input data to be hashed.
    - `fuzz_sz`: The size of the input data in bytes.
- **Logic and Control Flow**:
    - Casts `fuzz_data` to a `char` pointer `msg`.
    - Initializes a SHA-256 context `sha` and appends `msg` to it, finalizing the hash into `hash1`.
    - Computes a direct SHA-256 hash of `fuzz_data` into `hash2` and verifies that `hash1` and `hash2` are identical.
    - Checks if `fuzz_sz` is greater than or equal to `BATCH_CNT` to decide on batch processing.
    - If batch processing is applicable, initializes a batch SHA-256 context `batch_sha`.
    - Divides `fuzz_data` into `BATCH_CNT` segments, computes hashes for each segment, and stores them in `hashes`.
    - Finalizes the batch hash and verifies each segment's hash against a reference hash `ref_hash`.
    - If batch processing is not applicable, executes a placeholder `FD_FUZZ_MUST_BE_COVERED`.
- **Output**: Returns 0 to indicate successful processing.
- **Functions Called**:
    - [`fd_sha256_init`](<fd_sha256.c.md#fd_sha256_init>)
    - [`fd_sha256_append`](<fd_sha256.c.md#fd_sha256_append>)
    - [`fd_sha256_fini`](<fd_sha256.c.md#fd_sha256_fini>)
    - [`fd_sha256_hash`](<fd_sha256.c.md#fd_sha256_hash>)
    - [`fd_sha256_batch_add`](<fd_sha256.h.md#fd_sha256_batch_add>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)