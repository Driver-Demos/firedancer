<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs and data structures for SHA-256 hashing, including batch processing with AVX and AVX-512 support.

# Purpose
The code is a C header file that provides an API for performing SHA-256 hashing operations. It defines constants, data structures, and function prototypes necessary for initializing, updating, and finalizing SHA-256 hash calculations. The file includes definitions for memory alignment and footprint requirements, which are important for efficient memory usage and performance optimization. The `fd_sha256_t` structure is used to maintain the state of an ongoing SHA-256 calculation, and functions such as [`fd_sha256_init`](<#fd_sha256_init>), [`fd_sha256_append`](<#fd_sha256_append>), and [`fd_sha256_fini`](<#fd_sha256_fini>) are provided to manage the lifecycle of a hash computation.

Additionally, the file includes batch processing capabilities for SHA-256 calculations, which are optimized for different hardware capabilities such as AVX and AVX-512. This allows for efficient processing of multiple hash calculations in parallel, which is useful in high-performance computing contexts. The batch API includes functions for initializing a batch, adding messages to the batch, and finalizing or aborting the batch processing. The file also contains conditional compilation directives to select the appropriate implementation based on the available hardware features.
# Imports and Dependencies

---
- `../fd_ballet_base.h`


# Data Structures

---
### fd\_sha256\_private
- **Type**: ``struct``
- **Members**:
    - ``buf``: An array of unsigned characters used as a buffer with a maximum size defined by `FD_SHA256_PRIVATE_BUF_MAX`.
    - ``state``: An array of unsigned integers representing the current state of the SHA-256 hash computation.
    - ``magic``: An unsigned long integer that holds a constant value `FD_SHA256_MAGIC` to identify the structure.
    - ``buf_used``: An unsigned long integer indicating the number of bytes currently used in the buffer.
    - ``bit_cnt``: An unsigned long integer that tracks the total number of bits appended to the hash computation.
- **Description**: Defines a private data structure for managing the state of a SHA-256 hash computation, including a buffer for data, a state array for the hash computation, and counters for tracking the number of bytes and bits processed.


---
### fd\_sha256\_t
- **Type**: ``struct``
- **Members**:
    - ``buf``: An array of unsigned characters used as an internal buffer for SHA-256 computation.
    - ``state``: An array of unsigned integers representing the current state of the SHA-256 hash computation.
    - ``magic``: A magic number used to verify the integrity of the SHA-256 computation state.
    - ``buf_used``: A counter indicating the number of bytes currently buffered.
    - ``bit_cnt``: A counter tracking the total number of bits processed in the SHA-256 computation.
- **Description**: `fd_sha256_t` is a structure that represents the state of an ongoing SHA-256 hash computation. It includes a buffer for storing data, a state array for the hash computation, and counters for tracking the number of buffered bytes and total bits processed. The structure is aligned to 128 bytes to optimize memory access and reduce false sharing. The `magic` field is used to ensure the integrity of the computation state.


---
### fd\_sha256\_batch\_t
- **Type**: ``struct``
- **Members**:
    - ``data``: An array of pointers to the data to be hashed, aligned for AVX or AVX-512.
    - ``sz``: An array of sizes corresponding to each data element, aligned for AVX or AVX-512.
    - ``hash``: An array of pointers where the resulting hashes will be stored, aligned for AVX or AVX-512.
    - ``cnt``: A counter indicating the number of elements currently in the batch.
- **Description**: `fd_sha256_batch_t` is a structure used to manage a batch of SHA-256 hash calculations, optimized for high-performance computing contexts using AVX or AVX-512 instructions. It holds arrays of data pointers, sizes, and hash result pointers, along with a counter to track the number of elements in the batch. The structure is aligned to facilitate efficient processing and is designed to handle multiple hash calculations simultaneously, allowing for performance optimizations such as inlining and background processing.


---
### fd\_sha256\_private\_batch
- **Type**: ``struct``
- **Members**:
    - ``data``: An array of pointers to constant data, aligned for AVX, with a size defined by `FD_SHA256_BATCH_MAX`.
    - ``sz``: An array of unsigned long integers representing the size of each data element, aligned for AVX, with a size defined by `FD_SHA256_BATCH_MAX`.
    - ``hash``: An array of pointers to hash results, aligned for AVX, with a size defined by `FD_SHA256_BATCH_MAX`.
    - ``cnt``: An unsigned long integer representing the current count of elements in the batch.
- **Description**: Facilitates batch processing of SHA-256 calculations using AVX or AVX-512 acceleration, storing data, size, and hash pointers for a set of messages, with a counter to track the number of messages in the batch.


# Functions

---
### fd\_sha256\_batch\_align<!-- {{#callable:fd_sha256_batch_align}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L414>)

Returns the alignment requirement for a memory region to hold a `fd_sha256_batch_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `alignof` on `fd_sha256_batch_t` to determine its alignment requirement.
    - Returns the alignment value.
- **Output**: An `ulong` representing the alignment requirement for `fd_sha256_batch_t`.


---
### fd\_sha256\_batch\_footprint<!-- {{#callable:fd_sha256_batch_footprint}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L415>)

Returns the memory footprint size required for a `fd_sha256_batch_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the size of the `fd_sha256_batch_t` structure using the `sizeof` operator.
- **Output**: The function returns an `ulong` representing the size in bytes of the `fd_sha256_batch_t` structure.


---
### fd\_sha256\_batch\_init<!-- {{#callable:fd_sha256_batch_init}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L417>)

Initializes a new SHA-256 batch calculation state in the provided memory region.
- **Inputs**:
    - `mem`: A pointer to a memory region where the SHA-256 batch calculation state will be initialized.
- **Logic and Control Flow**:
    - Cast the `mem` pointer to a `fd_sha256_batch_t` pointer and assign it to `batch`.
    - Set the `cnt` field of `batch` to 0, indicating no calculations are in progress.
    - Return the `batch` pointer.
- **Output**: A pointer to the initialized `fd_sha256_batch_t` structure.


---
### fd\_sha256\_batch\_add<!-- {{#callable:fd_sha256_batch_add}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L424>)

Adds a message to a batch of SHA-256 calculations and processes the batch if it reaches its maximum size.
- **Inputs**:
    - ``batch``: A pointer to the `fd_sha256_batch_t` structure representing the current batch of SHA-256 calculations.
    - ``data``: A pointer to the message data to be added to the batch.
    - ``sz``: The size of the message data in bytes.
    - ``hash``: A pointer to the memory location where the hash result will be stored.
- **Logic and Control Flow**:
    - Retrieve the current count of messages in the batch from `batch->cnt`.
    - Store the `data`, `sz`, and `hash` in the respective arrays at the current batch count index.
    - Increment the batch count.
    - Check if the batch count has reached `FD_SHA256_BATCH_MAX`.
    - If the batch count equals `FD_SHA256_BATCH_MAX`, call [`fd_sha256_private_batch_avx512`](<fd_sha256_batch_avx512.c.md#fd_sha256_private_batch_avx512>) to process the batch and reset the batch count to 0.
    - Update `batch->cnt` with the new batch count.
- **Output**: Returns a pointer to the updated `fd_sha256_batch_t` structure.
- **Functions Called**:
    - [`fd_sha256_private_batch_avx512`](<fd_sha256_batch_avx512.c.md#fd_sha256_private_batch_avx512>)


---
### fd\_sha256\_batch\_fini<!-- {{#callable:fd_sha256_batch_fini}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L442>)

Completes a batch of SHA-256 calculations and returns a pointer to the batch state.
- **Inputs**:
    - ``batch``: A pointer to an `fd_sha256_batch_t` structure representing the batch of SHA-256 calculations.
- **Logic and Control Flow**:
    - Retrieve the count of messages in the batch from `batch->cnt`.
    - If `batch_cnt` is non-zero, call [`fd_sha256_private_batch_avx512`](<fd_sha256_batch_avx512.c.md#fd_sha256_private_batch_avx512>) to process the batch of messages.
    - Return a pointer to the `batch` structure.
- **Output**: A pointer to the `fd_sha256_batch_t` structure used to hold the calculation state.
- **Functions Called**:
    - [`fd_sha256_private_batch_avx512`](<fd_sha256_batch_avx512.c.md#fd_sha256_private_batch_avx512>)


---
### fd\_sha256\_batch\_abort<!-- {{#callable:fd_sha256_batch_abort}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L449>)

Returns a pointer to the memory region used for an in-progress SHA-256 batch calculation, indicating the batch is no longer in progress.
- **Inputs**:
    - ``batch``: A pointer to an `fd_sha256_batch_t` structure representing the in-progress SHA-256 batch calculation.
- **Logic and Control Flow**:
    - Casts the `batch` pointer to a `void *` type.
    - Returns the casted pointer, indicating the batch calculation is aborted.
- **Output**: A `void *` pointer to the memory region used for the batch calculation, with contents undefined.


# Function Declarations (Public API)

---
### fd\_sha256\_align<!-- {{#callable_declaration:fd_sha256_align}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L64>)

Returns the alignment requirement for SHA-256 memory regions.
- **Description**: Use this function to obtain the alignment requirement for memory regions that will hold SHA-256 calculation states. This alignment is necessary to ensure proper memory access and performance. The function is constant and does not depend on any input parameters or external state.
- **Inputs**: None
- **Output**: Returns an unsigned long integer representing the alignment requirement, which is a power of 2.
- **See Also**: [`fd_sha256_align`](<fd_sha256.c.md#fd_sha256_align>)  (Implementation)


---
### fd\_sha256\_footprint<!-- {{#callable_declaration:fd_sha256_footprint}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L72>)

Returns the memory footprint required for a SHA-256 calculation state.
- **Description**: Use this function to determine the size of memory needed to store a SHA-256 calculation state. This is useful for allocating memory regions that will hold the state of a SHA-256 computation. The function does not require any parameters and can be called at any time to retrieve the constant footprint size.
- **Inputs**: None
- **Output**: Returns an unsigned long integer representing the memory footprint size in bytes.
- **See Also**: [`fd_sha256_footprint`](<fd_sha256.c.md#fd_sha256_footprint>)  (Implementation)


---
### fd\_sha256\_new<!-- {{#callable_declaration:fd_sha256_new}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L75>)

Initializes a SHA-256 calculation state in shared memory.
- **Description**: Use this function to initialize a SHA-256 calculation state in a provided shared memory region. The memory region must be properly aligned and have sufficient footprint as defined by `fd_sha256_align` and `fd_sha256_footprint`. This function must be called before any SHA-256 operations are performed on the memory region. If the memory is null or misaligned, the function will return null and log a warning.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region where the SHA-256 state will be initialized. The memory must be aligned to `fd_sha256_align()` and have a size of at least `fd_sha256_footprint()`. The caller retains ownership of the memory. If null or misaligned, the function returns null.
- **Output**: Returns a pointer to the initialized SHA-256 state on success, or null if the input is invalid.
- **See Also**: [`fd_sha256_new`](<fd_sha256.c.md#fd_sha256_new>)  (Implementation)


---
### fd\_sha256\_join<!-- {{#callable_declaration:fd_sha256_join}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L78>)

Joins a shared SHA-256 calculation state.
- **Description**: Use this function to access a SHA-256 calculation state from a shared memory region. Ensure the memory region is properly aligned and initialized with the correct magic number before calling. This function checks for null pointers, alignment, and a valid magic number to ensure the integrity of the SHA-256 state. If any of these checks fail, it returns null and logs a warning.
- **Inputs**:
    - `shsha`: A pointer to a shared memory region that holds a SHA-256 calculation state. Must not be null, must be aligned according to `fd_sha256_align()`, and must have a valid magic number (`FD_SHA256_MAGIC`). If these conditions are not met, the function returns null.
- **Output**: Returns a pointer to a `fd_sha256_t` structure if successful, or null if the input is invalid.
- **See Also**: [`fd_sha256_join`](<fd_sha256.c.md#fd_sha256_join>)  (Implementation)


---
### fd\_sha256\_leave<!-- {{#callable_declaration:fd_sha256_leave}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L81>)

Returns a pointer to the SHA-256 calculation state.
- **Description**: Use this function to safely leave a SHA-256 calculation state. It is important to ensure that the `sha` parameter is not null before calling this function. If `sha` is null, the function will log a warning and return null. This function is typically used after completing operations on a SHA-256 calculation state to return a pointer to the state.
- **Inputs**:
    - `sha`: A pointer to a `fd_sha256_t` structure representing the SHA-256 calculation state. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a pointer to the `fd_sha256_t` structure if `sha` is valid; otherwise, returns null.
- **See Also**: [`fd_sha256_leave`](<fd_sha256.c.md#fd_sha256_leave>)  (Implementation)


---
### fd\_sha256\_delete<!-- {{#callable_declaration:fd_sha256_delete}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L84>)

Deletes a SHA-256 calculation state.
- **Description**: Use this function to delete a SHA-256 calculation state that was previously initialized. It checks if the provided pointer is non-null, properly aligned, and has a valid magic number before proceeding. If any of these checks fail, it logs a warning and returns null. This function should be called when the SHA-256 calculation state is no longer needed to ensure proper cleanup.
- **Inputs**:
    - `shsha`: A pointer to the SHA-256 calculation state to delete. It must not be null, must be aligned according to `fd_sha256_align()`, and must have a valid magic number. If these conditions are not met, the function logs a warning and returns null.
- **Output**: Returns the pointer to the deleted SHA-256 calculation state if successful, or null if the input is invalid.
- **See Also**: [`fd_sha256_delete`](<fd_sha256.c.md#fd_sha256_delete>)  (Implementation)


---
### fd\_sha256\_init<!-- {{#callable_declaration:fd_sha256_init}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L94>)

Initializes a SHA-256 calculation state.
- **Description**: Use this function to start a new SHA-256 calculation. It prepares the given SHA-256 state object for a new hashing operation by resetting its internal state. Ensure that the `sha` parameter is a valid pointer to a `fd_sha256_t` structure that is currently joined to a local SHA-256 calculation state. This function discards any preexisting state, so call it only when you want to start a new calculation. Avoid concurrent modifications to the `sha` state while this function executes.
- **Inputs**:
    - `sha`: A pointer to a `fd_sha256_t` structure representing the SHA-256 calculation state. Must be a valid, non-null pointer to a state that is currently joined locally. The caller retains ownership and must ensure no concurrent modifications occur during execution.
- **Output**: Returns the same `fd_sha256_t` pointer passed in, now initialized for a new SHA-256 calculation.
- **See Also**: [`fd_sha256_init`](<fd_sha256.c.md#fd_sha256_init>)  (Implementation)


---
### fd\_sha256\_append<!-- {{#callable_declaration:fd_sha256_append}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L113>)

Appends data to an ongoing SHA-256 calculation.
- **Description**: Use this function to add data to an ongoing SHA-256 hash calculation. Ensure that the SHA-256 state is valid and not concurrently modified by other operations during execution. The function can handle zero-length data, in which case it performs no operation. For optimal performance, append as many bytes as possible at once, ideally in multiples of 64 bytes, except for the final append which should be less than 56 bytes if possible.
- **Inputs**:
    - `sha`: A pointer to a valid `fd_sha256_t` structure representing the current SHA-256 calculation state. Must be a local join with no concurrent modifications.
    - `data`: A pointer to the data to append. Can be `NULL` if `sz` is zero. The data is not modified and no reference is retained after the function returns.
    - `sz`: The size in bytes of the data to append. Can be zero, in which case the function does nothing.
- **Output**: Returns the updated `fd_sha256_t` pointer with the new state of the ongoing calculation.
- **See Also**: [`fd_sha256_append`](<fd_sha256.c.md#fd_sha256_append>)  (Implementation)


---
### fd\_sha256\_fini<!-- {{#callable_declaration:fd_sha256_fini}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L129>)

Completes a SHA-256 hash calculation and stores the result.
- **Description**: Use this function to finalize a SHA-256 hash calculation that is in progress. It must be called after initializing the SHA-256 state and appending all data to be hashed. The function writes the resulting 32-byte hash to the specified memory location. Ensure that no other operations modify the SHA-256 state while this function executes. After completion, the SHA-256 state will no longer have an in-progress calculation.
- **Inputs**:
    - `sha`: A pointer to a `fd_sha256_t` structure representing the SHA-256 calculation state. It must be a valid local join to a SHA-256 state with no concurrent modifications.
    - `hash`: A pointer to a 32-byte memory region where the resulting hash will be stored. It must be valid and non-null.
- **Output**: Returns the `hash` pointer, which now contains the 32-byte SHA-256 hash result.
- **See Also**: [`fd_sha256_fini`](<fd_sha256.c.md#fd_sha256_fini>)  (Implementation)


---
### fd\_sha256\_hash<!-- {{#callable_declaration:fd_sha256_hash}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L146>)

Computes the SHA-256 hash of the given data.
- **Description**: Use this function to compute the SHA-256 hash of a data block in a single operation. It is optimized for small messages by reducing function call overheads and other inefficiencies. Ensure that the input data and the output buffer are valid and properly allocated before calling this function. This function is suitable when you need a quick hash computation without the need for incremental updates.
- **Inputs**:
    - `data`: Pointer to the data to hash. Must not be null if sz is greater than zero. The caller retains ownership and the data is not modified.
    - `sz`: Size of the data in bytes. Can be zero, in which case data can be null.
    - `hash`: Pointer to a 32-byte buffer where the hash result will be stored. Must not be null and must be properly allocated by the caller.
- **Output**: Returns a pointer to the hash buffer containing the 32-byte SHA-256 hash result.
- **See Also**: [`fd_sha256_hash`](<fd_sha256.c.md#fd_sha256_hash>)  (Implementation)


---
### fd\_sha256\_hash\_32\_repeated<!-- {{#callable_declaration:fd_sha256_hash_32_repeated}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L165>)

Hashes 32 bytes repeatedly and stores the final hash.
- **Description**: Use this function to perform repeated SHA-256 hashing on a 32-byte data block. It hashes the data, then hashes the resulting hash, repeating this process for a specified number of times. This function is useful when you need to apply multiple rounds of hashing to the same data. It requires valid, non-null pointers for both the input data and the output hash, even if the repeat count is zero. When the repeat count is zero, the function simply copies the input data to the output hash.
- **Inputs**:
    - `data`: Pointer to the 32-byte data block to hash. Must be a valid, non-null pointer.
    - `hash`: Pointer to a 32-byte memory region where the final hash will be stored. Must be a valid, non-null pointer.
    - `cnt`: Number of times to repeat the hashing process. Can be zero, in which case the function copies the data to the hash.
- **Output**: Returns a pointer to the hash, which contains the final 32-byte hash result.
- **See Also**: [`fd_sha256_hash_32_repeated`](<fd_sha256.c.md#fd_sha256_hash_32_repeated>)  (Implementation)


---
### fd\_sha256\_private\_batch\_avx<!-- {{#callable_declaration:fd_sha256_private_batch_avx}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L329>)

Processes a batch of SHA-256 hashes using AVX acceleration.
- **Description**: Use this function to compute SHA-256 hashes for a batch of messages efficiently using AVX instructions. It is suitable for high-performance computing contexts where processing multiple messages in parallel is beneficial. The function requires a minimum batch size to operate efficiently, and if the batch size is below this threshold, it processes each message sequentially. Ensure that the input data, sizes, and output hash pointers are valid and properly aligned as expected by the function.
- **Inputs**:
    - `batch_cnt`: The number of messages in the batch to process. Must be at least 2 if SHA-NI instructions are not available, or 6 if they are. If the count is below the minimum, the function processes messages sequentially.
    - `_batch_data`: A pointer to an array of pointers, each pointing to the data of a message to hash. The data must be aligned as required by the function.
    - `batch_sz`: A pointer to an array of sizes, each representing the size of the corresponding message in the batch. Sizes must be valid and correspond to the data provided.
    - `_batch_hash`: A pointer to an array of pointers, each pointing to a memory region where the resulting hash will be stored. Each region must be 32 bytes in size and properly aligned.
- **Output**: None
- **See Also**: [`fd_sha256_private_batch_avx`](<fd_sha256_batch_avx.c.md#fd_sha256_private_batch_avx>)  (Implementation)


---
### fd\_sha256\_private\_batch\_avx512<!-- {{#callable_declaration:fd_sha256_private_batch_avx512}} -->
[View Source →](<../../../../../src/ballet/sha256/fd_sha256.h#L401>)

Processes a batch of messages using SHA-256 with AVX-512 acceleration.
- **Description**: Use this function to compute SHA-256 hashes for a batch of messages efficiently using AVX-512 instructions. It is designed for high-performance computing contexts where processing multiple messages in parallel is beneficial. The function requires a minimum batch size to operate efficiently, and if the batch size is below this threshold, it will fall back to a narrower implementation. Ensure that all input pointers are valid and properly aligned as expected by the function.
- **Inputs**:
    - `batch_cnt`: The number of messages in the batch. Must be between 1 and FD_SHA256_BATCH_MAX inclusive. If less than the minimum required batch size, the function will use a different implementation.
    - `_batch_data`: A pointer to an array of pointers, each pointing to the data of a message to be hashed. The array must have at least 'batch_cnt' valid entries.
    - `batch_sz`: A pointer to an array of unsigned long integers, each representing the size of the corresponding message in '_batch_data'. The array must have at least 'batch_cnt' valid entries.
    - `_batch_hash`: A pointer to an array of pointers, each pointing to a memory region where the hash of the corresponding message will be stored. Each region must be at least 32 bytes long and the array must have at least 'batch_cnt' valid entries.
- **Output**: None
- **See Also**: [`fd_sha256_private_batch_avx512`](<fd_sha256_batch_avx512.c.md#fd_sha256_private_batch_avx512>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)