<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests and benchmarks for the BLAKE3 hash function implementation, including various compression and hashing methods.

# Purpose
The code is a C test suite for the BLAKE3 cryptographic hash function, specifically designed to test and benchmark various implementations and optimizations of the BLAKE3 algorithm. It includes tests for different hashing scenarios, such as single-shot, incremental, and streamlined hashing, as well as tests for specific hardware optimizations using AVX, AVX512, and SSE instructions. The code also includes benchmarks to measure the performance of these implementations under different conditions.

The test suite is structured to verify the correctness of the BLAKE3 hash function by comparing computed hashes against expected values for a variety of input sizes. It uses a series of static functions to perform these tests, including [`check_fixture`](<#check_fixture>), [`test_constructor`](<#test_constructor>), and [`test_small_fixtures`](<#test_small_fixtures>), among others. The suite also includes performance benchmarks, such as [`bench_incremental`](<#bench_incremental>) and [`bench_streamlined`](<#bench_streamlined>), which measure the throughput and efficiency of the hashing operations. The code is designed to be executed as a standalone program, with a [`main`](<#main>) function that initializes random data, runs the tests, and logs the results.
# Imports and Dependencies

---
- `../fd_ballet.h`
- `fd_blake3.h`
- `fd_blake3_private.h`
- `fd_blake3_test_vector.c`


# Global Variables

---
### rand\_buf
- **Type**: ``uchar` array`
- **Description**: A static array of unsigned characters with a size of 16,777,216 bytes (1<<24). The array is aligned to a 64-byte boundary.
- **Use**: Used as a buffer for random data in various hashing and compression tests.


---
### rng
- **Type**: ``fd_rng_t[1]``
- **Description**: Represents an array of one `fd_rng_t` element, which is a type used for random number generation.
- **Use**: Used to generate random numbers in various functions throughout the code.


---
### test\_fixtures
- **Type**: ``static const struct { ulong sz; uchar hash[32]; }``
- **Description**: Defines an array of structures where each structure contains a size (`sz`) and a 32-byte hash (`hash`). The array is used to store test fixtures for verifying hash computations.
- **Use**: Used to provide predefined test cases for hash verification in the `check_fixture` function.


---
### bench\_sz
- **Type**: ``ulong[]``
- **Description**: An array of unsigned long integers that contains predefined sizes for benchmarking purposes. The array includes various sizes ranging from 64 to 524288.
- **Use**: Used to define the sizes of data blocks for benchmarking hash functions.


---
### bench\_cnt
- **Type**: `ulong`
- **Description**: `bench_cnt` is a global variable of type `ulong` that stores the number of elements in the `bench_sz` array.
- **Use**: Used to determine the number of benchmark sizes available for testing.


---
### tests
- **Type**: ``struct test_fn const[]``
- **Description**: An array of `struct test_fn` that contains test function names and their corresponding function pointers. Each element in the array represents a test case with a name and a function to execute.
- **Use**: Used to store and organize test functions for execution in the program.


# Data Structures

---
### test\_fn
- **Type**: ``struct``
- **Members**:
    - ``name``: Pointer to a constant character string representing the name of the test function.
    - ``fn``: Pointer to a function that takes no arguments and returns void, representing the test function to execute.
- **Description**: Defines a structure to hold a test function's name and a pointer to the function itself, allowing for organized execution of multiple test functions.


# Functions

---
### check\_fixture<!-- {{#callable:check_fixture}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L26>)

Validates the BLAKE3 hash implementation by comparing computed hashes against expected values using single-shot, incremental, and streamlined hashing methods.
- **Inputs**:
    - `expected`: A pointer to the expected hash value of 32 bytes.
    - `msg`: A pointer to the message data to hash.
    - `sz`: The size of the message data in bytes.
    - `blake`: A pointer to an `fd_blake3_t` structure used for hashing operations.
    - `rng`: A pointer to an `fd_rng_t` structure used for generating random numbers.
- **Logic and Control Flow**:
    - Initialize the `blake` structure for hashing and append the entire message `msg` of size `sz` to it.
    - Finalize the hash computation and store the result in `hash`, then compare it with `expected`. If they do not match, log an error.
    - Reset `hash` to zero and reinitialize `blake` for incremental hashing.
    - Iteratively append random-sized chunks of `msg` to `blake` until the entire message is processed, occasionally appending zero-length data to test edge cases.
    - Finalize the incremental hash computation and compare the result with `expected`. Log an error if they do not match.
    - Perform a streamlined hash of `msg` and compare the result with `expected`. Log an error if they do not match.
- **Output**: No return value; logs errors if computed hashes do not match expected values.
- **Functions Called**:
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini`](<fd_blake3.c.md#fd_blake3_fini>)
    - [`fd_blake3_hash`](<fd_blake3.c.md#fd_blake3_hash>)


---
### test\_constructor<!-- {{#callable:test_constructor}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L89>)

Validates the construction, joining, leaving, and deletion of `fd_blake3_t` objects using various test cases.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if `fd_blake3_align()` returns `FD_BLAKE3_ALIGN` and `fd_blake3_footprint()` returns `FD_BLAKE3_FOOTPRINT` to ensure alignment and footprint are correct.
    - Declares a `fd_blake3_t` array `mem` with one element for testing purposes.
    - Tests `fd_blake3_new()` with `NULL` and misaligned memory, expecting `NULL` returns, and then with `mem`, expecting a valid object.
    - Tests `fd_blake3_join()` with `NULL` and misaligned memory, expecting `NULL` returns, and then with a valid object, expecting a valid `fd_blake3_t` pointer.
    - Tests `fd_blake3_leave()` with `NULL`, expecting `NULL`, and with a valid `fd_blake3_t` pointer, expecting the original object pointer.
    - Tests `fd_blake3_delete()` with `NULL` and misaligned memory, expecting `NULL` returns, and then with a valid object, expecting the original memory pointer.
- **Output**: No output is returned; the function performs tests and uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_blake3_align`](<fd_blake3.c.md#fd_blake3_align>)
    - [`fd_blake3_footprint`](<fd_blake3.c.md#fd_blake3_footprint>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)


---
### test\_small\_fixtures<!-- {{#callable:test_small_fixtures}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L114>)

Iterates over a set of test vectors to verify the correctness of the BLAKE3 hash function implementation using small fixtures.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_blake3_t` structure `blake_` and join it to a `fd_blake3_t` pointer `blake`.
    - Iterate over each test vector in `fd_blake3_test_vector` until a vector with a null message is encountered.
    - For each test vector, call [`check_fixture`](<#check_fixture>) with the expected hash, message, size, `blake` pointer, and `rng`.
    - After processing all test vectors, leave and delete the `blake` structure.
- **Output**: No output is returned as the function is of type `void`.
- **Functions Called**:
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`check_fixture`](<#check_fixture>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)


---
### test\_avx\_compress8\_fast<!-- {{#callable:test_avx_compress8_fast}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L126>)

Tests the [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>) function by compressing data blocks and verifying the hash result.
- **Inputs**: None
- **Logic and Control Flow**:
    - Declare a 512-byte array `block_res` aligned to 32 bytes.
    - Set `block_in` to point to `rand_buf`.
    - Call [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>) with `block_in`, `block_res`, `0UL`, and `0` to compress the first block.
    - Call [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>) with `block_in+8192`, `block_res+256`, `8UL`, and `0` to compress the second block.
    - Compute the hash of `block_res` using `fd_hash` and store the result in `chunks_16_have`.
    - Compare `chunks_16_have` with `chunks_16_hash` and log an error if they do not match.
- **Output**: No output is returned; the function logs an error if the hash verification fails.
- **Functions Called**:
    - [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>)


---
### test\_avx\_compress8<!-- {{#callable:test_avx_compress8}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L139>)

Tests the [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) function by compressing data in two batches and verifying the result against an expected hash.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `block_res` as a 512-byte array aligned to 32 bytes.
    - Set `block_in` to point to `rand_buf`.
    - Initialize `batch_data`, `batch_sz`, `batch_hash`, `ctr_vec`, and `batch_flags` arrays for the first batch of 8 elements each.
    - Call [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) with the first batch of data.
    - Update `batch_data`, `batch_hash`, and `ctr_vec` for the second batch of data.
    - Call [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) with the second batch of data.
    - Compute the hash of `block_res` using `fd_hash`.
    - Compare the computed hash with `chunks_16_hash` and log an error if they do not match.
- **Output**: No direct output; logs an error if the computed hash does not match the expected value.
- **Functions Called**:
    - [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>)


---
### test\_avx\_compress8\_xof2048\_para<!-- {{#callable:test_avx_compress8_xof2048_para}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L161>)

Tests the [`fd_blake3_lthash_batch8`](<fd_blake3.c.md#fd_blake3_lthash_batch8>) function for correctness by comparing its output with a manually computed hash over multiple iterations.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize an array `data` with 16 pointers to segments of `rand_buf`, each offset by 1024 bytes.
    - Initialize an array `sz` with eight elements, each set to 1024.
    - Compute two hash batches using [`fd_blake3_lthash_batch8`](<fd_blake3.c.md#fd_blake3_lthash_batch8>) on the first and second halves of `data`, storing results in `lthash0` and `lthash1`.
    - Sum the corresponding elements of `lthash0` and `lthash1`.
    - Verify the hash of `lthash0` against a predefined constant `lthash_1024_16_hash`.
    - Iterate 100,000 times, each time updating `data` and `sz` with random values, computing a hash batch, and verifying it against a manually computed hash.
- **Output**: No output is returned; the function logs an error if the computed hash does not match the expected value.
- **Functions Called**:
    - [`fd_blake3_lthash_batch8`](<fd_blake3.c.md#fd_blake3_lthash_batch8>)
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini_2048`](<fd_blake3.c.md#fd_blake3_fini_2048>)


---
### test\_avx\_compress8\_xof2048\_seq<!-- {{#callable:test_avx_compress8_xof2048_seq}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L199>)

Performs a sequence of BLAKE3 hash compressions using AVX2 instructions and verifies the result against a known hash value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initializes a zeroed array `lthash` of 1024 `ushort` elements.
    - Iterates 16 times, each time processing a 1024-byte segment of `rand_buf`.
    - For each segment, initializes a BLAKE3 context and appends the segment to it.
    - Finalizes the BLAKE3 context to produce a 64-byte `root_msg` and a 32-byte `root_cv_pre`.
    - Prepares data for batch processing, including `batch_data`, `batch_sz`, `ctr_vec`, `batch_flags`, `batch_cv`, and `batch_hash`.
    - Performs four AVX2 compressions using [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>), each processing 8 blocks of data.
    - Accumulates the results into `lthash` by adding the `xof2048` results to it.
    - After processing all segments, computes the hash of `lthash` and compares it to `lthash_1024_16_hash`.
    - Logs an error if the computed hash does not match the expected value.
- **Output**: No return value; logs an error if the computed hash does not match the expected value.
- **Functions Called**:
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini_xof_compress`](<fd_blake3.c.md#fd_blake3_fini_xof_compress>)
    - [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>)


---
### test\_avx512\_compress16\_fast<!-- {{#callable:test_avx512_compress16_fast}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L234>)

Tests the [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>) function and verifies its output against an expected hash value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Declare a 512-byte array `block_res` aligned to 32 bytes.
    - Call [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>) with `rand_buf`, `block_res`, `0UL`, and `0` as arguments.
    - Compute the hash of `block_res` using `fd_hash` and store the result in `chunks_16_have`.
    - Compare `chunks_16_have` with `chunks_16_hash`.
    - If they are not equal, log an error message indicating the mismatch.
- **Output**: No output is returned; the function logs an error if the test fails.
- **Functions Called**:
    - [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>)


---
### test\_avx512\_compress16<!-- {{#callable:test_avx512_compress16}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L245>)

Tests the [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) function by preparing input data, executing the compression, and verifying the output against an expected hash value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize arrays `block_res`, `batch_data`, `batch_sz`, `batch_hash`, `ctr_vec`, and `batch_flags` with specific values and alignments.
    - Fill `batch_data` with pointers to segments of `rand_buf`, `batch_sz` with the size 1024, `batch_hash` with pointers to `block_res`, `ctr_vec` with sequential numbers, and `batch_flags` with zeros.
    - Call [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) with the initialized arrays and other parameters to perform the compression.
    - Compute the hash of the resulting `block_res` using `fd_hash`.
    - Compare the computed hash `chunks_16_have` with the expected `chunks_16_hash`.
    - Log an error if the computed hash does not match the expected hash.
- **Output**: No direct output; logs an error if the hash verification fails.
- **Functions Called**:
    - [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>)


---
### test\_avx512\_compress16\_xof2048\_para<!-- {{#callable:test_avx512_compress16_xof2048_para}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L262>)

Tests the AVX-512 implementation of the BLAKE3 hash function by compressing 16 blocks of data in parallel and verifying the results.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize an array `data` with 16 pointers, each pointing to a different 1024-byte segment of `rand_buf`.
    - Initialize an array `sz` with 16 elements, each set to 1024.
    - Compute a batch hash of the 16 data blocks using [`fd_blake3_lthash_batch16`](<fd_blake3.c.md#fd_blake3_lthash_batch16>) and store the result in `lthash`.
    - Verify the computed hash against a known hash value `lthash_1024_16_hash`. If they do not match, log a warning and an error.
    - Run a loop 100,000 times, where in each iteration, randomize the data pointers and sizes, compute the batch hash, and verify it against a sequential hash computation.
    - If any verification fails, log an error with the incorrect sizes.
- **Output**: No output is returned; the function logs errors if the computed hashes do not match expected values.
- **Functions Called**:
    - [`fd_blake3_lthash_batch16`](<fd_blake3.c.md#fd_blake3_lthash_batch16>)
    - [`fd_blake3_hash`](<fd_blake3.c.md#fd_blake3_hash>)
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini_2048`](<fd_blake3.c.md#fd_blake3_fini_2048>)


---
### test\_avx512\_compress16\_xof2048\_seq<!-- {{#callable:test_avx512_compress16_xof2048_seq}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L303>)

Executes a sequence of BLAKE3 hash compressions using AVX-512 instructions and verifies the result against a known hash value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a zeroed array `lthash` of 1024 `ushort` elements.
    - Iterate 16 times, each time processing a 1024-byte segment of `rand_buf`.
    - For each iteration, initialize BLAKE3 context `blake`, append a 1024-byte segment from `rand_buf`, and finalize the hash to produce `root_msg` and `root_cv_pre`.
    - Prepare arrays `batch_data`, `batch_sz`, `ctr_vec`, `batch_flags`, `batch_cv`, and `batch_hash` for batch processing.
    - Call [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) twice to perform hash compression on the prepared data.
    - Accumulate the results into `lthash` by adding corresponding elements from `xof2048`.
    - After the loop, verify if the hash of `lthash` matches `lthash_1024_16_hash` and log an error if it does not.
- **Output**: No direct output; logs an error if the computed hash does not match the expected value.
- **Functions Called**:
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini_xof_compress`](<fd_blake3.c.md#fd_blake3_fini_xof_compress>)
    - [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>)


---
### test\_rand\_fixtures<!-- {{#callable:test_rand_fixtures}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L380>)

Iterates over a set of test fixtures to verify the correctness of BLAKE3 hash computations using a random buffer.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a BLAKE3 hash object `blake_` and join it to `blake`.
    - Iterate over `test_fixtures` array until a fixture with size zero is encountered.
    - For each fixture, call [`check_fixture`](<#check_fixture>) with the expected hash, `rand_buf`, fixture size, `blake`, and `rng`.
    - After processing all fixtures, leave and delete the BLAKE3 hash object `blake`.
- **Output**: No output is returned as the function is of type `void`.
- **Functions Called**:
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`check_fixture`](<#check_fixture>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)


---
### test\_reduced<!-- {{#callable:test_reduced}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L390>)

Tests the BLAKE3 hashing function by comparing results from different hashing methods for messages of varying sizes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a BLAKE3 hashing context using [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>) and [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>).
    - Create two arrays, `hash` and `hash2`, to store hash results, both aligned to 32 bytes.
    - Fill a buffer `buf` with random data using `fd_rng_ulong`.
    - Iterate over message sizes from 0 to 524289 bytes, incrementing by 61 bytes each time.
    - For each message size, perform streamlined hashing using [`fd_blake3_hash`](<fd_blake3.c.md#fd_blake3_hash>) and store the result in `hash`.
    - Perform single-shot hashing by initializing, appending, and finalizing the BLAKE3 context, storing the result in `hash2`, and compare it with `hash` using `FD_TEST` and `memcmp`.
    - Perform incremental hashing by repeatedly appending parts of the message to the BLAKE3 context, finalizing it, storing the result in `hash2`, and comparing it with `hash`.
    - Delete the BLAKE3 context using [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>) and [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>).
- **Output**: No output is returned; the function performs internal tests and uses assertions to verify correctness.
- **Functions Called**:
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`fd_blake3_hash`](<fd_blake3.c.md#fd_blake3_hash>)
    - [`fd_blake3_fini`](<fd_blake3.c.md#fd_blake3_fini>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)


---
### test\_reduced\_xof2048<!-- {{#callable:test_reduced_xof2048}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L429>)

Tests the BLAKE3 hash function by generating random input data, computing a 2048-byte hash, and verifying the result against an expected value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Set `acc` to 0 and declare arrays `input` and `hash` for storing input data and hash results, respectively.
    - Iterate over sizes from 0 to 65536, filling `input` with random bytes for each size using `fd_rng_uchar`.
    - Initialize a BLAKE3 hash context `blake` with [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>), append the `input` data to it, and finalize the hash into `hash` using [`fd_blake3_fini_2048`](<fd_blake3.c.md#fd_blake3_fini_2048>).
    - Update `acc` by XORing it with the hash of `hash` using `fd_hash`.
    - Verify that `acc` equals the expected value `0x79836ea1df1a342aUL` using `FD_TEST`.
    - Clean up the random number generator with `fd_rng_delete` and `fd_rng_leave`.
- **Output**: No direct output; the function performs a test and asserts the correctness of the hash computation.
- **Functions Called**:
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini_2048`](<fd_blake3.c.md#fd_blake3_fini_2048>)


---
### test\_lthash<!-- {{#callable:test_lthash}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L450>)

Tests the correctness of the `fd_blake3` hashing functions by comparing computed hash values against expected results.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_blake3_t` object using [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>) and [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>).
    - Set `in` to point to `rand_buf` and initialize `lthash` array to zero.
    - Loop 16 times, each time processing 1024 bytes from `in` using `fd_blake3` functions.
    - In each iteration, initialize the `blake` object, append 1024 bytes from `in`, and finalize to get a 32-byte hash in `ele2`.
    - Reinitialize `blake`, append the same 1024 bytes, and finalize to get a 2048-byte hash in `ele`.
    - Verify that the first 32 bytes of `ele` match `ele2` using `fd_memeq`.
    - Accumulate the 2048-byte hash into `lthash`.
    - After the loop, verify that the hash of `lthash` matches `lthash_1024_16_hash`.
    - Clean up by deleting the `blake` object using [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>) and [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>).
- **Output**: No output is returned; the function performs internal tests and assertions.
- **Functions Called**:
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_fini`](<fd_blake3.c.md#fd_blake3_fini>)
    - [`fd_blake3_fini_2048`](<fd_blake3.c.md#fd_blake3_fini_2048>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)


---
### bench\_incremental<!-- {{#callable:bench_incremental}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L490>)

Benchmarks the performance of the BLAKE3 hashing algorithm using incremental hashing for various input sizes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a BLAKE3 hashing context using [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>) and [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>).
    - Log a notice indicating the start of benchmarking for incremental hashing.
    - Iterate over each size in `bench_sz` to perform benchmarking.
    - For each size, calculate the target number of iterations based on the size and a fixed value `1UL<<28`.
    - Perform a warmup phase by hashing the data `iter_target / 100` times and measure the time taken.
    - Perform the actual benchmarking by hashing the data `iter_target` times and measure the time taken.
    - Log the results, including the throughput in Gbps per core and the time per byte in nanoseconds.
    - Clean up the BLAKE3 hashing context using [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>) and [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>).
- **Output**: No output is returned; results are logged using `FD_LOG_NOTICE`.
- **Functions Called**:
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`fd_blake3_fini`](<fd_blake3.c.md#fd_blake3_fini>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)


---
### bench\_incremental\_xof\_2048<!-- {{#callable:bench_incremental_xof_2048}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L523>)

Benchmarks the performance of the incremental BLAKE3 XOF (2048) hashing process for various input sizes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a BLAKE3 hashing context using [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>) and [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>).
    - Log a notice indicating the start of benchmarking for incremental XOF(2048).
    - Iterate over a predefined set of input sizes stored in `bench_sz`.
    - For each input size, calculate the target number of iterations based on the size and a fixed value `1UL<<28`.
    - Perform a warmup phase where the hash is computed for a fraction of the target iterations to stabilize performance.
    - Measure the time taken to complete the warmup iterations using `fd_log_wallclock`.
    - Perform the actual benchmarking by computing the hash for the full target number of iterations.
    - Measure the time taken for the actual benchmarking iterations.
    - Log the performance metrics including input and total throughput in Gbps, and time per byte in nanoseconds.
    - Clean up the BLAKE3 hashing context using [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>) and [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>).
- **Output**: No output is returned; performance metrics are logged using `FD_LOG_NOTICE`.
- **Functions Called**:
    - [`fd_blake3_join`](<fd_blake3.c.md#fd_blake3_join>)
    - [`fd_blake3_new`](<fd_blake3.c.md#fd_blake3_new>)
    - [`fd_blake3_fini_2048`](<fd_blake3.c.md#fd_blake3_fini_2048>)
    - [`fd_blake3_append`](<fd_blake3.c.md#fd_blake3_append>)
    - [`fd_blake3_init`](<fd_blake3.c.md#fd_blake3_init>)
    - [`fd_blake3_delete`](<fd_blake3.c.md#fd_blake3_delete>)
    - [`fd_blake3_leave`](<fd_blake3.c.md#fd_blake3_leave>)


---
### bench\_streamlined<!-- {{#callable:bench_streamlined}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L557>)

Benchmarks the performance of the [`fd_blake3_hash`](<fd_blake3.c.md#fd_blake3_hash>) function using various input sizes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the benchmarking process with a notice message.
    - Iterates over a predefined set of input sizes stored in `bench_sz`.
    - For each input size, calculates the target number of iterations based on the size.
    - Performs a warmup phase by hashing a random buffer multiple times and measuring the time taken.
    - Performs the actual benchmarking by hashing the random buffer the calculated number of times and measuring the time taken.
    - Calculates the throughput in gigabits per second and the time per byte in nanoseconds.
    - Logs the results for each input size with a notice message.
- **Output**: No return value; outputs benchmarking results to the log.
- **Functions Called**:
    - [`fd_blake3_hash`](<fd_blake3.c.md#fd_blake3_hash>)


---
### bench\_avx512\_compress16\_fast<!-- {{#callable:bench_avx512_compress16_fast}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L585>)

Benchmarks the performance of the [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>) function using different input sizes and logs the throughput and block processing rate.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the benchmarking process for the AVX512 backend with a notice message.
    - Initializes a `batch_hash` array of 1024 bytes aligned to 64 bytes.
    - Iterates over sizes starting from 1024 and divides by 16 until the size is greater than 4.
    - Sets `flags` to `FD_BLAKE3_FLAG_PARENT` if the size is 64, otherwise sets it to 0.
    - Performs a warmup loop 100 times calling [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>) with `rand_buf`, `batch_hash`, 0, and `flags`.
    - Sets `iter` to 100000 and starts a timer by calling `fd_log_wallclock`.
    - Performs the main benchmarking loop `iter` times, calling [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>) with `rand_buf`, `batch_hash`, 0, and `flags`.
    - Stops the timer and calculates the elapsed time.
    - Logs the throughput in Gbps and the block processing rate per second per core for the current size.
- **Output**: No output is returned from this function; it logs benchmarking results to the console.
- **Functions Called**:
    - [`fd_blake3_avx512_compress16_fast`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16_fast>)


---
### bench\_avx512\_compress16<!-- {{#callable:bench_avx512_compress16}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L605>)

Benchmarks the AVX512 backend for the `compress16` function by measuring throughput and block processing speed for different data sizes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs a notice indicating the start of benchmarking for the AVX512 backend with `compress16`.
    - Iterates over data sizes starting from 1024 and divides by 16 until the size is greater than 4.
    - Initializes arrays `block_res`, `batch_data2`, `batch_sz`, `batch_hash`, `ctr_vec`, and `batch_flags` for benchmarking.
    - Performs a warmup loop 100 times calling [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) with the initialized arrays.
    - Sets `iter` to 100000 and records the start time using `fd_log_wallclock`.
    - Executes the main benchmarking loop `iter` times, calling [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) each time.
    - Calculates the elapsed time and logs the throughput and block processing speed using `FD_LOG_NOTICE`.
- **Output**: No output is returned from the function; it logs benchmarking results to the console.
- **Functions Called**:
    - [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>)


---
### bench\_avx512\_lthash<!-- {{#callable:bench_avx512_lthash}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L629>)

Benchmarks the AVX512 backend for LtHash by performing a series of hash updates and measuring the performance.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the AVX512 backend benchmarking for LtHash.
    - Initializes arrays `batch_data2`, `batch_sz`, `ctr_vec`, and `batch_flags` with specific values for the benchmark.
    - Performs a warmup loop 100 times using [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) to prepare the system for accurate benchmarking.
    - Sets `iter` to 100,000 and records the start time using `fd_log_wallclock`.
    - Executes the main benchmarking loop `iter` times, calling [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>) in each iteration.
    - Calculates the elapsed time by adding the current wall clock time to `dt`.
    - Logs the number of LtHash updates per second per core based on the elapsed time and number of iterations.
- **Output**: No return value; outputs performance metrics to the log.
- **Functions Called**:
    - [`fd_blake3_avx512_compress16`](<fd_blake3_avx512.c.md#fd_blake3_avx512_compress16>)


---
### bench\_avx\_compress8\_fast<!-- {{#callable:bench_avx_compress8_fast}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L656>)

Benchmarks the performance of the [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>) function using different input sizes and logs the throughput and block processing rate.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs a notice indicating the start of benchmarking for the AVX2 backend with `compress8_fast`.
    - Iterates over different sizes (`sz`) starting from 1024 and reducing by a factor of 16 until it is greater than 4.
    - For each size, initializes a `batch_hash` array aligned to 32 bytes and sets `flags` to `FD_BLAKE3_FLAG_PARENT` if `sz` is 64, otherwise 0.
    - Performs a warmup loop 100 times calling [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>) with `rand_buf`, `batch_hash`, 0, and `flags`.
    - Sets `iter` to 100000 and records the start time using `fd_log_wallclock`.
    - Performs the main benchmarking loop `iter` times, calling [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>) with the same parameters as the warmup.
    - Calculates the elapsed time by adding the current wall clock time to the negative start time.
    - Logs the throughput in Gbps and the block processing rate per second per core for the current size.
- **Output**: No output is returned from this function; it logs benchmarking results to the console.
- **Functions Called**:
    - [`fd_blake3_avx_compress8_fast`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8_fast>)


---
### bench\_avx\_compress8<!-- {{#callable:bench_avx_compress8}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L676>)

Benchmarks the AVX2 backend for the `compress8` function by measuring throughput and performance metrics for different data sizes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs a notice indicating the start of benchmarking for the AVX2 backend with `compress8`.
    - Iterates over different sizes (`sz`) starting from 1024 and reducing by a factor of 16 until greater than 4.
    - Initializes arrays `batch_data2`, `batch_sz`, `batch_hash`, `ctr_vec`, and `batch_flags` for 8 elements each, with specific values for benchmarking.
    - Performs a warmup loop 100 times calling [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) with the initialized arrays and parameters.
    - Sets `iter` to 100000 and records the start time using `fd_log_wallclock`.
    - Executes the main benchmarking loop `iter` times, calling [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) with the same parameters as the warmup.
    - Calculates the elapsed time and logs the throughput and performance metrics for the current size `sz`.
- **Output**: No return value; outputs performance metrics to the log.
- **Functions Called**:
    - [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>)


---
### bench\_avx\_lthash<!-- {{#callable:bench_avx_lthash}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L701>)

Benchmarks the AVX2 backend for LtHash by performing a series of hash updates and measuring the performance.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the AVX2 backend benchmarking for LtHash.
    - Initializes arrays `batch_data`, `batch_sz`, `batch_ctr`, and `batch_flags` with specific values for the benchmark.
    - Performs a warmup loop 100 times using [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) to prepare the system for accurate benchmarking.
    - Executes the main benchmarking loop 100,000 times, calling [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>) to perform hash updates.
    - Calculates the elapsed time for the benchmarking loop using `fd_log_wallclock`.
    - Logs the performance results in terms of LtHash updates per second per core.
- **Output**: No return value; outputs performance metrics to the log.
- **Functions Called**:
    - [`fd_blake3_avx_compress8`](<fd_blake3_avx2.c.md#fd_blake3_avx_compress8>)


---
### bench\_sse\_compress1<!-- {{#callable:bench_sse_compress1}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L728>)

Benchmarks the SSE4.1 backend for the [`fd_blake3_sse_compress1`](<fd_blake3_sse41.c.md#fd_blake3_sse_compress1>) function by measuring its throughput and block processing rate.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the benchmarking process for the SSE4.1 backend.
    - Initializes a `batch_hash` array of 32 bytes aligned to 16 bytes.
    - Performs a warmup loop 100 times calling [`fd_blake3_sse_compress1`](<fd_blake3_sse41.c.md#fd_blake3_sse_compress1>) with `batch_hash`, `rand_buf`, and other parameters.
    - Sets `iter` to 100,000 and records the start time using `fd_log_wallclock`.
    - Runs a loop `iter` times calling [`fd_blake3_sse_compress1`](<fd_blake3_sse41.c.md#fd_blake3_sse_compress1>) with the same parameters as the warmup.
    - Calculates the elapsed time by adding the current wall clock time to `dt`.
    - Logs the throughput in Gbps and the number of blocks processed per second per core.
- **Output**: No return value; outputs are logged to the console.
- **Functions Called**:
    - [`fd_blake3_sse_compress1`](<fd_blake3_sse41.c.md#fd_blake3_sse_compress1>)


---
### bench\_ref\_compress1<!-- {{#callable:bench_ref_compress1}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L750>)

Benchmarks the reference backend of the BLAKE3 hash function using the [`fd_blake3_ref_compress1`](<fd_blake3_ref.c.md#fd_blake3_ref_compress1>) function.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of benchmarking for the reference backend with a notice message.
    - Initializes a `batch_hash` array of 32 `uchar` elements to store hash results.
    - Performs a warmup loop 100 times, calling [`fd_blake3_ref_compress1`](<fd_blake3_ref.c.md#fd_blake3_ref_compress1>) with `batch_hash`, `rand_buf`, and other parameters.
    - Sets `iter` to 100,000 and records the start time using `fd_log_wallclock`.
    - Runs a loop `iter` times, calling [`fd_blake3_ref_compress1`](<fd_blake3_ref.c.md#fd_blake3_ref_compress1>) with the same parameters as the warmup.
    - Calculates the elapsed time by adding the current wall clock time to `dt`.
    - Logs the throughput in Gbps and the number of blocks processed per second per core.
- **Output**: No return value; outputs are logged to the console.
- **Functions Called**:
    - [`fd_blake3_ref_compress1`](<fd_blake3_ref.c.md#fd_blake3_ref_compress1>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/blake3/test_blake3.c#L816>)

Initializes the environment, runs a series of tests and benchmarks, and then cleans up resources.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Creates a random number generator `rng2` and fills `rand_buf` with random bytes.
    - Deletes `rng2` after use.
    - Creates another random number generator `rng` for subsequent operations.
    - Iterates over a list of test functions, executing each one and logging the result.
    - Deletes `rng` after all tests are complete.
    - Logs a final notice indicating all tests passed.
    - Calls `fd_halt` to clean up and terminate the program.
- **Output**: Returns 0 to indicate successful execution.



---
Made with ❤️ by [Driver](https://www.driver.ai/)