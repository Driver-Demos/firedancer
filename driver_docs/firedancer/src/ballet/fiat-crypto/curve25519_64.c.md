<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements arithmetic operations for the Curve25519 elliptic curve using 64-bit machine words.

# Purpose
The code is a C implementation of arithmetic operations for the Curve25519 elliptic curve, specifically using the "unsaturated Solinas" method. It provides functions to perform arithmetic operations such as addition, subtraction, multiplication, squaring, and modular reduction on field elements. These operations are essential for cryptographic algorithms that use Curve25519, such as key exchange protocols. The code defines types for field elements with both loose and tight bounds, and it includes functions to convert between these types, as well as to serialize and deserialize field elements to and from byte arrays.

The code is structured as a collection of static inline functions, which suggests it is intended to be included in other C files rather than compiled as a standalone executable. The functions are designed to work with 64-bit machine words and are optimized for performance using inline assembly and compiler-specific extensions. The code also includes conditional compilation directives to ensure compatibility with different compilers and systems. The functions are named with the prefix `fiat_25519_`, indicating they are part of the Fiat Cryptography library, which is a project that generates formally verified cryptographic code.
# Imports and Dependencies

---
- `stdint.h`


# Global Variables

---
### fiat\_25519\_int128
- **Type**: ``typedef signed __int128 fiat_25519_int128``
- **Description**: Defines a type alias for a signed 128-bit integer using the `__int128` type, which is an extension provided by compilers like GCC and Clang. This type is used to represent large integers that require more than the standard 64-bit integer size.
- **Use**: Used in arithmetic operations that require handling of large integers, such as those in cryptographic computations.


---
### fiat\_25519\_uint128
- **Type**: ``unsigned __int128``
- **Description**: Represents an unsigned 128-bit integer type, which is used to perform arithmetic operations that require more than the standard 64-bit integer range. This type is particularly useful in cryptographic computations where large integer arithmetic is common.
- **Use**: Used in functions that perform arithmetic operations on large integers, such as multiplication and reduction in cryptographic algorithms.


# Functions

---
### fiat\_25519\_value\_barrier\_u64<!-- {{#callable:fiat_25519_value_barrier_u64}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L42>)

Acts as a compiler barrier to prevent certain optimizations on the input value.
- **Inputs**:
    - `a`: A 64-bit unsigned integer to be used as an input and output.
- **Logic and Control Flow**:
    - Uses an inline assembly statement to create a compiler barrier.
    - The assembly statement has no effect on the value of `a`, but it prevents the compiler from optimizing away the variable or reordering operations around it.
    - Returns the input value `a` unchanged.
- **Output**: Returns the same 64-bit unsigned integer that was input.


---
### fiat\_25519\_addcarryx\_u51<!-- {{#callable:fiat_25519_addcarryx_u51}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L66>)

Performs addition with carry for three inputs and outputs the result modulo 2^51 and the carry.
- **Inputs**:
    - `out1`: Pointer to a `uint64_t` where the result of the addition modulo 2^51 is stored.
    - `out2`: Pointer to a `fiat_25519_uint1` where the carry from the addition is stored.
    - `arg1`: A `fiat_25519_uint1` representing the first input to the addition.
    - `arg2`: A `uint64_t` representing the second input to the addition.
    - `arg3`: A `uint64_t` representing the third input to the addition.
- **Logic and Control Flow**:
    - Calculate the sum of `arg1`, `arg2`, and `arg3` and store it in `x1`.
    - Compute `x2` as `x1` modulo 2^51 by applying a bitwise AND with `0x7ffffffffffff`.
    - Compute `x3` as the carry by right-shifting `x1` by 51 bits.
    - Store `x2` in the location pointed to by `out1`.
    - Store `x3` in the location pointed to by `out2`.
- **Output**: The function outputs the result of the addition modulo 2^51 in `out1` and the carry in `out2`.


---
### fiat\_25519\_subborrowx\_u51<!-- {{#callable:fiat_25519_subborrowx_u51}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L92>)

Performs subtraction with borrow on two 51-bit integers and computes the result modulo 2^51.
- **Inputs**:
    - `out1`: Pointer to a `uint64_t` where the result of the subtraction will be stored.
    - `out2`: Pointer to a `fiat_25519_uint1` where the borrow flag will be stored.
    - `arg1`: A `fiat_25519_uint1` representing the first operand, which is subtracted from the second operand.
    - `arg2`: A `uint64_t` representing the second operand.
    - `arg3`: A `uint64_t` representing the third operand, which is subtracted from the second operand.
- **Logic and Control Flow**:
    - Calculate `x1` as the result of `arg2 - arg1 - arg3` cast to `int64_t` to handle potential negative values.
    - Shift `x1` right by 51 bits to determine the borrow flag `x2`.
    - Mask `x1` with `0x7ffffffffffff` to compute the result modulo 2^51 and store it in `x3`.
    - Store `x3` in the location pointed to by `out1`.
    - Store the negation of `x2` in the location pointed to by `out2`.
- **Output**: Stores the result of the subtraction in `out1` and the borrow flag in `out2`.


---
### fiat\_25519\_cmovznz\_u64<!-- {{#callable:fiat_25519_cmovznz_u64}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L116>)

Performs a conditional move of two 64-bit unsigned integers based on a single-bit condition.
- **Inputs**:
    - ``out1``: Pointer to a 64-bit unsigned integer where the result will be stored.
    - ``arg1``: A single-bit unsigned integer (0 or 1) that determines which value to select.
    - ``arg2``: A 64-bit unsigned integer to select if `arg1` is 0.
    - ``arg3``: A 64-bit unsigned integer to select if `arg1` is 1.
- **Logic and Control Flow**:
    - Convert `arg1` to a boolean value `x1` by negating it twice.
    - Calculate `x2` as the bitwise AND of the negated `x1` and the maximum 64-bit unsigned integer value.
    - Use [`fiat_25519_value_barrier_u64`](<#fiat_25519_value_barrier_u64>) to apply a value barrier to `x2` and its negation, ensuring no optimization removes the conditional logic.
    - Compute `x3` as the bitwise OR of the masked `arg3` and `arg2`, using `x2` and its negation as masks.
    - Store the result `x3` in the location pointed to by `out1`.
- **Output**: The function outputs the selected 64-bit unsigned integer through the pointer `out1`, based on the value of `arg1`.
- **Functions Called**:
    - [`fiat_25519_value_barrier_u64`](<#fiat_25519_value_barrier_u64>)


---
### fiat\_25519\_carry\_mul<!-- {{#callable:fiat_25519_carry_mul}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L133>)

Multiplies two field elements and reduces the result modulo `2^255 - 19`.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array to store the result.
    - `arg1`: A `fiat_25519_loose_field_element` array representing the first operand.
    - `arg2`: A `fiat_25519_loose_field_element` array representing the second operand.
- **Logic and Control Flow**:
    - Initialize multiple `fiat_25519_uint128` variables to store intermediate multiplication results.
    - Compute cross-products of elements from `arg1` and `arg2`, applying a factor of `0x13` to certain terms to account for the modulus `2^255 - 19`.
    - Sum the computed products to form partial results, and store them in `x26`, `x29`, `x30`, `x31`, and `x32`.
    - Perform a series of reductions by shifting and masking to ensure each element of the result fits within 51 bits.
    - Apply a final reduction step to ensure the result is within the field bounds, using a carry and a factor of `0x13`.
    - Store the reduced results into the `out1` array.
- **Output**: A `fiat_25519_tight_field_element` array containing the reduced product of `arg1` and `arg2`.


---
### fiat\_25519\_carry\_square<!-- {{#callable:fiat_25519_carry_square}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L252>)

Squares a field element and reduces the result modulo `2^255 - 19`.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array to store the result.
    - `arg1`: A `fiat_25519_loose_field_element` array representing the field element to square.
- **Logic and Control Flow**:
    - Calculate intermediate values by multiplying elements of `arg1` with constants and other elements, storing results in `fiat_25519_uint128` variables.
    - Sum specific combinations of these intermediate values to form partial results.
    - Shift and mask these partial results to fit within 51-bit boundaries, propagating carries to higher-order terms.
    - Apply a final reduction step to ensure the result fits within the field's bounds, using a constant factor of `0x13` for the carry from the highest term.
    - Store the reduced results in the `out1` array.
- **Output**: The function outputs a `fiat_25519_tight_field_element` array `out1` containing the reduced result of the squared input field element.


---
### fiat\_25519\_carry<!-- {{#callable:fiat_25519_carry}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L367>)

Reduces a loose field element to a tight field element by performing a series of carry operations.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of size 5 to store the reduced field element.
    - `arg1`: A `fiat_25519_loose_field_element` array of size 5 representing the input field element to be reduced.
- **Logic and Control Flow**:
    - Initialize `x1` to `arg1[0]` and calculate `x2` as the sum of `x1` right-shifted by 51 and `arg1[1]`.
    - Calculate `x3` as the sum of `x2` right-shifted by 51 and `arg1[2]`.
    - Calculate `x4` as the sum of `x3` right-shifted by 51 and `arg1[3]`.
    - Calculate `x5` as the sum of `x4` right-shifted by 51 and `arg1[4]`.
    - Calculate `x6` as the sum of `x1` bitwise AND with `0x7ffffffffffff` and `x5` right-shifted by 51 multiplied by 19.
    - Calculate `x7` as the sum of `x6` right-shifted by 51 and `x2` bitwise AND with `0x7ffffffffffff`.
    - Calculate `x8` as `x6` bitwise AND with `0x7ffffffffffff`.
    - Calculate `x9` as `x7` bitwise AND with `0x7ffffffffffff`.
    - Calculate `x10` as the sum of `x7` right-shifted by 51 and `x3` bitwise AND with `0x7ffffffffffff`.
    - Calculate `x11` as `x4` bitwise AND with `0x7ffffffffffff`.
    - Calculate `x12` as `x5` bitwise AND with `0x7ffffffffffff`.
    - Assign `x8`, `x9`, `x10`, `x11`, and `x12` to `out1[0]`, `out1[1]`, `out1[2]`, `out1[3]`, and `out1[4]` respectively.
- **Output**: A `fiat_25519_tight_field_element` array of size 5 containing the reduced field element.


---
### fiat\_25519\_add<!-- {{#callable:fiat_25519_add}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L406>)

Adds two `fiat_25519_tight_field_element` arrays element-wise and stores the result in a `fiat_25519_loose_field_element` array.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array where the result of the addition is stored.
    - `arg1`: A `fiat_25519_tight_field_element` array representing the first operand in the addition.
    - `arg2`: A `fiat_25519_tight_field_element` array representing the second operand in the addition.
- **Logic and Control Flow**:
    - Initialize five `uint64_t` variables `x1` to `x5` to store intermediate results.
    - Compute the sum of corresponding elements from `arg1` and `arg2` and store them in `x1` to `x5`.
    - Assign the computed sums `x1` to `x5` to the corresponding elements of `out1`.
- **Output**: The function does not return a value; it modifies the `out1` array in place to contain the result of the addition.


---
### fiat\_25519\_sub<!-- {{#callable:fiat_25519_sub}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L431>)

Subtracts two field elements with specific constants added to each element of the first operand.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array of size 5 to store the result.
    - `arg1`: A `fiat_25519_tight_field_element` array of size 5 representing the first operand.
    - `arg2`: A `fiat_25519_tight_field_element` array of size 5 representing the second operand.
- **Logic and Control Flow**:
    - Calculate `x1` by adding `0xfffffffffffda` to `arg1[0]` and subtracting `arg2[0]`.
    - Calculate `x2` by adding `0xffffffffffffe` to `arg1[1]` and subtracting `arg2[1]`.
    - Calculate `x3` by adding `0xffffffffffffe` to `arg1[2]` and subtracting `arg2[2]`.
    - Calculate `x4` by adding `0xffffffffffffe` to `arg1[3]` and subtracting `arg2[3]`.
    - Calculate `x5` by adding `0xffffffffffffe` to `arg1[4]` and subtracting `arg2[4]`.
    - Store the results `x1`, `x2`, `x3`, `x4`, and `x5` in `out1[0]`, `out1[1]`, `out1[2]`, `out1[3]`, and `out1[4]` respectively.
- **Output**: A `fiat_25519_loose_field_element` array of size 5 containing the result of the subtraction.


---
### fiat\_25519\_opp<!-- {{#callable:fiat_25519_opp}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L456>)

Negates a field element by subtracting each component from a constant value.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array of size 5 to store the result.
    - `arg1`: A `fiat_25519_tight_field_element` array of size 5 representing the field element to negate.
- **Logic and Control Flow**:
    - Calculate `x1` as the difference between `0xfffffffffffda` and the first element of `arg1`.
    - Calculate `x2` as the difference between `0xffffffffffffe` and the second element of `arg1`.
    - Calculate `x3` as the difference between `0xffffffffffffe` and the third element of `arg1`.
    - Calculate `x4` as the difference between `0xffffffffffffe` and the fourth element of `arg1`.
    - Calculate `x5` as the difference between `0xffffffffffffe` and the fifth element of `arg1`.
    - Assign `x1` to the first element of `out1`.
    - Assign `x2` to the second element of `out1`.
    - Assign `x3` to the third element of `out1`.
    - Assign `x4` to the fourth element of `out1`.
    - Assign `x5` to the fifth element of `out1`.
- **Output**: The negated field element is stored in `out1` as a `fiat_25519_loose_field_element` array of size 5.


---
### fiat\_25519\_selectznz<!-- {{#callable:fiat_25519_selectznz}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L487>)

Selects between two 5-element arrays based on a condition.
- **Inputs**:
    - `out1`: An array of 5 `uint64_t` elements where the result is stored.
    - `arg1`: A `fiat_25519_uint1` condition flag (0 or 1) used to select between `arg2` and `arg3`.
    - `arg2`: A constant array of 5 `uint64_t` elements, one of the options for selection.
    - `arg3`: A constant array of 5 `uint64_t` elements, the other option for selection.
- **Logic and Control Flow**:
    - Declare five `uint64_t` variables `x1` to `x5` to store intermediate results.
    - For each index from 0 to 4, call [`fiat_25519_cmovznz_u64`](<#fiat_25519_cmovznz_u64>) to conditionally select between `arg2[i]` and `arg3[i]` based on `arg1`, storing the result in `x[i+1]`.
    - Assign the values of `x1` to `x5` to the corresponding indices of `out1`.
- **Output**: The `out1` array is filled with elements from `arg2` if `arg1` is 0, or from `arg3` if `arg1` is 1.
- **Functions Called**:
    - [`fiat_25519_cmovznz_u64`](<#fiat_25519_cmovznz_u64>)


---
### fiat\_25519\_to\_bytes<!-- {{#callable:fiat_25519_to_bytes}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L514>)

Serializes a `fiat_25519_tight_field_element` into a 32-byte array in little-endian order.
- **Inputs**:
    - `out1`: A 32-byte array to store the serialized output.
    - `arg1`: A `fiat_25519_tight_field_element` representing the field element to serialize.
- **Logic and Control Flow**:
    - Subtracts each element of `arg1` from a constant to ensure the result is within bounds.
    - Uses conditional move to adjust the result based on the borrow flag.
    - Adds carry to each element to finalize the field element representation.
    - Shifts and combines the elements to form a 64-bit integer representation.
    - Extracts each byte from the 64-bit integers and stores them in `out1` in little-endian order.
- **Output**: A 32-byte array `out1` containing the serialized field element in little-endian order.
- **Functions Called**:
    - [`fiat_25519_subborrowx_u51`](<#fiat_25519_subborrowx_u51>)
    - [`fiat_25519_cmovznz_u64`](<#fiat_25519_cmovznz_u64>)
    - [`fiat_25519_addcarryx_u51`](<#fiat_25519_addcarryx_u51>)


---
### fiat\_25519\_from\_bytes<!-- {{#callable:fiat_25519_from_bytes}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L730>)

Deserializes a 32-byte array into a `fiat_25519_tight_field_element` by interpreting the bytes in little-endian order and reducing the result modulo `2^255 - 19`.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of size 5 that will store the deserialized field element.
    - `arg1`: A 32-byte array of type `uint8_t` representing the serialized field element in little-endian order.
- **Logic and Control Flow**:
    - Extracts and shifts each byte from `arg1` to form 64-bit integers, applying specific bit shifts to align them correctly.
    - Combines these 64-bit integers into larger values, ensuring that each part of the field element is correctly formed.
    - Applies a bitmask `0x7ffffffffffff` to each part to ensure it fits within the required bounds of a `fiat_25519_tight_field_element`.
    - Handles carry bits by shifting them to the next part of the field element, ensuring proper reduction modulo `2^255 - 19`.
    - Stores the resulting values into the `out1` array.
- **Output**: A `fiat_25519_tight_field_element` array `out1` containing the deserialized field element.


---
### fiat\_25519\_relax<!-- {{#callable:fiat_25519_relax}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L887>)

Copies elements from a tight field element to a loose field element without modification.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array where the result is stored.
    - `arg1`: A `fiat_25519_tight_field_element` array that provides the input values.
- **Logic and Control Flow**:
    - Assigns the first element of `arg1` to the first element of `out1`.
    - Assigns the second element of `arg1` to the second element of `out1`.
    - Assigns the third element of `arg1` to the third element of `out1`.
    - Assigns the fourth element of `arg1` to the fourth element of `out1`.
    - Assigns the fifth element of `arg1` to the fifth element of `out1`.
- **Output**: The `out1` array contains the same elements as `arg1`, effectively converting a tight field element to a loose field element.


---
### fiat\_25519\_carry\_scmul\_121666<!-- {{#callable:fiat_25519_carry_scmul_121666}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/curve25519_64.c#L912>)

Multiplies a field element by 121666 and reduces the result modulo `2^255 - 19`.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of size 5 to store the result.
    - `arg1`: A `fiat_25519_loose_field_element` array of size 5 representing the input field element to be multiplied.
- **Logic and Control Flow**:
    - Calculate the product of each element in `arg1` with 121666, storing intermediate results in `fiat_25519_uint128` variables `x1` to `x5`.
    - Perform a series of right shifts and bitwise AND operations to reduce each intermediate result to 51 bits, storing the results in `uint64_t` variables `x6` to `x27`.
    - Accumulate carries from higher bits into lower bits, adjusting for the modulus `2^255 - 19` by multiplying the carry by 19 and adding it to the least significant part.
    - Store the final reduced results in the `out1` array.
- **Output**: The function outputs a `fiat_25519_tight_field_element` array `out1` containing the reduced result of the multiplication.



---
Made with ❤️ by [Driver](https://www.driver.ai/)