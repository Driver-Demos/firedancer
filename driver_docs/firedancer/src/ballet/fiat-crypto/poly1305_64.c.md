<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements arithmetic operations for the Poly1305 cryptographic function using 64-bit machine words.

# Purpose
The code is an implementation of arithmetic operations for the Poly1305 cryptographic function, which is used for message authentication. It is specifically designed to work with a 64-bit machine word size and operates over the finite field defined by the prime `2^130 - 5`. The code provides a set of functions to perform operations such as addition, subtraction, multiplication, squaring, and conditional moves on field elements. These operations are implemented with specific bounds and carry handling to ensure correctness within the field's constraints.

The code defines two types of field elements: `fiat_poly1305_loose_field_element` and `fiat_poly1305_tight_field_element`, which differ in their bounds. The functions include [`fiat_poly1305_addcarryx_u44`](<#fiat_poly1305_addcarryx_u44>), [`fiat_poly1305_subborrowx_u44`](<#fiat_poly1305_subborrowx_u44>), [`fiat_poly1305_carry_mul`](<#fiat_poly1305_carry_mul>), [`fiat_poly1305_carry_square`](<#fiat_poly1305_carry_square>), and others, each performing specific arithmetic operations with carry or borrow handling. Additionally, the code includes functions for converting field elements to and from byte arrays ([`fiat_poly1305_to_bytes`](<#fiat_poly1305_to_bytes>) and [`fiat_poly1305_from_bytes`](<#fiat_poly1305_from_bytes>)), as well as a function to relax tight field elements into loose ones. The code is intended to be used as part of a larger cryptographic library, providing the necessary arithmetic operations for the Poly1305 algorithm.
# Imports and Dependencies

---
- `stdint.h`


# Global Variables

---
### fiat\_poly1305\_int128
- **Type**: ``signed __int128``
- **Description**: `fiat_poly1305_int128` is a typedef for a signed 128-bit integer type. It is defined using the `__int128` type, which is an extension provided by compilers like GCC and Clang to support 128-bit integer arithmetic.
- **Use**: Used to perform arithmetic operations that require 128-bit signed integer precision in the Poly1305 cryptographic algorithm.


---
### fiat\_poly1305\_uint128
- **Type**: ``unsigned __int128``
- **Description**: Represents an unsigned 128-bit integer type, which is used to store large integer values that require more than the standard 64-bit integer size. This type is typically used in cryptographic operations where large numbers are involved.
- **Use**: Used in cryptographic functions to handle large integer calculations, such as those required in the Poly1305 algorithm.


# Functions

---
### fiat\_poly1305\_value\_barrier\_u64<!-- {{#callable:fiat_poly1305_value_barrier_u64}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L42>)

Acts as a value barrier for a 64-bit unsigned integer to prevent certain compiler optimizations.
- **Inputs**:
    - `a`: A 64-bit unsigned integer to be used as an input and output.
- **Logic and Control Flow**:
    - Uses an inline assembly statement to create a barrier for the input value `a`, preventing the compiler from optimizing it away or reordering it.
    - The assembly statement does not perform any operations on `a`, but the `+r` constraint indicates that `a` is both an input and an output operand.
- **Output**: Returns the same 64-bit unsigned integer `a` that was passed as input.


---
### fiat\_poly1305\_addcarryx\_u44<!-- {{#callable:fiat_poly1305_addcarryx_u44}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L66>)

Performs addition of three numbers with carry, reducing the result modulo 2^44.
- **Inputs**:
    - `out1`: Pointer to a `uint64_t` where the result of the addition modulo 2^44 is stored.
    - `out2`: Pointer to a `fiat_poly1305_uint1` where the carry-out of the addition is stored.
    - `arg1`: A `fiat_poly1305_uint1` representing the first addend, which is either 0 or 1.
    - `arg2`: A `uint64_t` representing the second addend, with a maximum value of 0xfffffffffff.
    - `arg3`: A `uint64_t` representing the third addend, with a maximum value of 0xfffffffffff.
- **Logic and Control Flow**:
    - Calculate the sum of `arg1`, `arg2`, and `arg3`, storing the result in `x1`.
    - Compute `x2` as `x1` modulo 2^44, which is the lower 44 bits of `x1`.
    - Compute `x3` as the carry-out by right-shifting `x1` by 44 bits.
    - Store `x2` in the location pointed to by `out1`.
    - Store `x3` in the location pointed to by `out2`.
- **Output**: Stores the result of the addition modulo 2^44 in `out1` and the carry-out in `out2`.


---
### fiat\_poly1305\_subborrowx\_u44<!-- {{#callable:fiat_poly1305_subborrowx_u44}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L92>)

Performs subtraction with borrow on two 44-bit integers and a borrow flag, producing a result and a borrow output.
- **Inputs**:
    - `out1`: Pointer to a `uint64_t` where the result of the subtraction will be stored.
    - `out2`: Pointer to a `fiat_poly1305_uint1` where the borrow output will be stored.
    - `arg1`: A `fiat_poly1305_uint1` representing the initial borrow flag, with a value of either 0 or 1.
    - `arg2`: A `uint64_t` representing the first 44-bit integer operand.
    - `arg3`: A `uint64_t` representing the second 44-bit integer operand to be subtracted.
- **Logic and Control Flow**:
    - Calculate `x1` as the result of subtracting `arg1` and `arg3` from `arg2`, casting all operands to `int64_t` to handle potential negative values.
    - Shift `x1` right by 44 bits to determine the borrow, storing the result in `x2`.
    - Mask `x1` with `0xfffffffffff` to extract the lower 44 bits, storing the result in `x3`.
    - Store `x3` in the location pointed to by `out1`.
    - Calculate the negation of `x2` and store it in the location pointed to by `out2`.
- **Output**: The function outputs the result of the subtraction in `out1` and the borrow flag in `out2`.


---
### fiat\_poly1305\_addcarryx\_u43<!-- {{#callable:fiat_poly1305_addcarryx_u43}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L118>)

Performs addition with carry for three inputs and outputs the result modulo 2^43 and the carry.
- **Inputs**:
    - `out1`: Pointer to a `uint64_t` where the result of the addition modulo 2^43 will be stored.
    - `out2`: Pointer to a `fiat_poly1305_uint1` where the carry resulting from the addition will be stored.
    - `arg1`: A `fiat_poly1305_uint1` representing the first input value, which is either 0 or 1.
    - `arg2`: A `uint64_t` representing the second input value, which is in the range [0, 0x7ffffffffff].
    - `arg3`: A `uint64_t` representing the third input value, which is in the range [0, 0x7ffffffffff].
- **Logic and Control Flow**:
    - Calculate the sum of `arg1`, `arg2`, and `arg3` and store it in `x1`.
    - Compute `x2` as `x1` modulo 2^43 by applying a bitwise AND with `0x7ffffffffff`.
    - Determine the carry `x3` by right-shifting `x1` by 43 bits.
    - Store the result `x2` in the location pointed to by `out1`.
    - Store the carry `x3` in the location pointed to by `out2`.
- **Output**: The function outputs the result of the addition modulo 2^43 in `out1` and the carry in `out2`.


---
### fiat\_poly1305\_subborrowx\_u43<!-- {{#callable:fiat_poly1305_subborrowx_u43}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L144>)

Performs a subtraction with borrow on three inputs, producing a result modulo 2^43 and a borrow indicator.
- **Inputs**:
    - `out1`: Pointer to a `uint64_t` where the result of the subtraction will be stored.
    - `out2`: Pointer to a `fiat_poly1305_uint1` where the borrow indicator will be stored.
    - `arg1`: A `fiat_poly1305_uint1` representing the initial borrow input.
    - `arg2`: A `uint64_t` representing the minuend.
    - `arg3`: A `uint64_t` representing the subtrahend.
- **Logic and Control Flow**:
    - Calculate `x1` as the result of subtracting `arg1` and `arg3` from `arg2`, cast to `int64_t`.
    - Shift `x1` right by 43 bits to determine the borrow `x2`.
    - Mask `x1` with `0x7ffffffffff` to get the result `x3` modulo 2^43.
    - Store `x3` in the location pointed to by `out1`.
    - Store the negation of `x2` in the location pointed to by `out2`.
- **Output**: Stores the result of the subtraction modulo 2^43 in `out1` and the borrow indicator in `out2`.


---
### fiat\_poly1305\_cmovznz\_u64<!-- {{#callable:fiat_poly1305_cmovznz_u64}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L168>)

Selects between two 64-bit unsigned integers based on a condition.
- **Inputs**:
    - `out1`: Pointer to a 64-bit unsigned integer where the result will be stored.
    - `arg1`: Condition flag, a single-bit unsigned integer (0 or 1).
    - `arg2`: First 64-bit unsigned integer option.
    - `arg3`: Second 64-bit unsigned integer option.
- **Logic and Control Flow**:
    - Check if `arg1` is non-zero and store the result in `x1`.
    - Compute `x2` as the bitwise AND of the negation of `x1` and the maximum 64-bit unsigned integer value.
    - Compute `x3` as the bitwise OR of the bitwise AND of `x2` and `arg3`, and the bitwise AND of the negation of `x2` and `arg2`.
    - Store the result `x3` in the location pointed to by `out1`.
- **Output**: Stores the selected 64-bit unsigned integer in the location pointed to by `out1`.
- **Functions Called**:
    - [`fiat_poly1305_value_barrier_u64`](<#fiat_poly1305_value_barrier_u64>)


---
### fiat\_poly1305\_carry\_mul<!-- {{#callable:fiat_poly1305_carry_mul}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L185>)

Multiplies two field elements and reduces the result modulo `2^130 - 5`.
- **Inputs**:
    - `out1`: A `fiat_poly1305_tight_field_element` array to store the result of the multiplication.
    - `arg1`: A `fiat_poly1305_loose_field_element` array representing the first operand.
    - `arg2`: A `fiat_poly1305_loose_field_element` array representing the second operand.
- **Logic and Control Flow**:
    - Calculate intermediate products `x1` to `x9` using elements of `arg1` and `arg2`, applying specific multipliers (e.g., `0x5`, `0xa`, `0x2`).
    - Sum the intermediate products to form `x10`, `x13`, and `x14`.
    - Perform bitwise operations to split and reduce the results, storing them in `x11`, `x12`, `x16`, `x17`, `x19`, `x20`, `x23`, `x24`, `x26`, `x27`, and `x28`.
    - Store the final reduced results in `out1[0]`, `out1[1]`, and `out1[2]`.
- **Output**: A `fiat_poly1305_tight_field_element` array `out1` containing the reduced result of the multiplication.


---
### fiat\_poly1305\_carry\_square<!-- {{#callable:fiat_poly1305_carry_square}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L254>)

Squares a field element and reduces the result modulo a specific prime.
- **Inputs**:
    - `out1`: A `fiat_poly1305_tight_field_element` array to store the result of the operation.
    - `arg1`: A `fiat_poly1305_loose_field_element` array representing the field element to be squared.
- **Logic and Control Flow**:
    - Calculate `x1` as `arg1[2] * 0x5` and `x2` as `x1 * 0x2` for later use in multiplication.
    - Compute intermediate products `x5` to `x10` using `fiat_poly1305_uint128` to handle large values resulting from squaring and multiplying elements of `arg1`.
    - Sum the products `x10` and `x6` to get `x11`, then split `x11` into `x12` and `x13` using bitwise operations to handle overflow.
    - Calculate `x14` and `x15` by summing other intermediate products, then add `x12` to `x15` to get `x16`, splitting it into `x17` and `x18`.
    - Add `x17` to `x14` to get `x19`, then split `x19` into `x20` and `x21`.
    - Multiply `x20` by `0x5` and add to `x13` to get `x23`, then split `x23` into `x24` and `x25`.
    - Add `x24` to `x18` to get `x26`, split it into `x27` and `x28`, and finally add `x27` to `x21` to get `x29`.
    - Store the results `x25`, `x28`, and `x29` in `out1`.
- **Output**: A `fiat_poly1305_tight_field_element` array containing the reduced result of the squared field element.


---
### fiat\_poly1305\_carry<!-- {{#callable:fiat_poly1305_carry}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L325>)

Reduces a loose field element to a tight field element by performing carry operations.
- **Inputs**:
    - `out1`: A `fiat_poly1305_tight_field_element` array where the result is stored.
    - `arg1`: A `fiat_poly1305_loose_field_element` array representing the input field element to be reduced.
- **Logic and Control Flow**:
    - Extracts the first element of `arg1` into `x1`.
    - Calculates `x2` by shifting `x1` right by 44 bits and adding the second element of `arg1`.
    - Calculates `x3` by shifting `x2` right by 43 bits and adding the third element of `arg1`.
    - Calculates `x4` by masking `x1` with `0xfffffffffff` and adding the product of `x3` shifted right by 43 bits and 5.
    - Calculates `x5` by adding the result of `x4` shifted right by 44 bits to `x2` masked with `0x7ffffffffff`.
    - Calculates `x6` by masking `x4` with `0xfffffffffff`.
    - Calculates `x7` by masking `x5` with `0x7ffffffffff`.
    - Calculates `x8` by adding the result of `x5` shifted right by 43 bits to `x3` masked with `0x7ffffffffff`.
    - Stores `x6`, `x7`, and `x8` in `out1` as the reduced field element.
- **Output**: A `fiat_poly1305_tight_field_element` array containing the reduced field element.


---
### fiat\_poly1305\_add<!-- {{#callable:fiat_poly1305_add}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L354>)

Adds two `fiat_poly1305_tight_field_element` arrays and stores the result in a `fiat_poly1305_loose_field_element` array.
- **Inputs**:
    - `out1`: A `fiat_poly1305_loose_field_element` array where the result of the addition is stored.
    - `arg1`: A `fiat_poly1305_tight_field_element` array representing the first operand.
    - `arg2`: A `fiat_poly1305_tight_field_element` array representing the second operand.
- **Logic and Control Flow**:
    - Initialize three `uint64_t` variables `x1`, `x2`, and `x3` to store intermediate results.
    - Compute the sum of the first elements of `arg1` and `arg2` and store it in `x1`.
    - Compute the sum of the second elements of `arg1` and `arg2` and store it in `x2`.
    - Compute the sum of the third elements of `arg1` and `arg2` and store it in `x3`.
    - Assign the values of `x1`, `x2`, and `x3` to the corresponding elements of `out1`.
- **Output**: The function does not return a value but modifies the `out1` array to contain the sum of `arg1` and `arg2`.


---
### fiat\_poly1305\_sub<!-- {{#callable:fiat_poly1305_sub}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L373>)

Subtracts two field elements with specific bounds and stores the result in a loose field element.
- **Inputs**:
    - `out1`: A `fiat_poly1305_loose_field_element` array where the result of the subtraction is stored.
    - `arg1`: A `fiat_poly1305_tight_field_element` array representing the minuend.
    - `arg2`: A `fiat_poly1305_tight_field_element` array representing the subtrahend.
- **Logic and Control Flow**:
    - Calculate `x1` by adding `0x1ffffffffff6` to `arg1[0]` and subtracting `arg2[0]`.
    - Calculate `x2` by adding `0xffffffffffe` to `arg1[1]` and subtracting `arg2[1]`.
    - Calculate `x3` by adding `0xffffffffffe` to `arg1[2]` and subtracting `arg2[2]`.
    - Store `x1`, `x2`, and `x3` in `out1[0]`, `out1[1]`, and `out1[2]` respectively.
- **Output**: The result is stored in the `out1` array, which is a `fiat_poly1305_loose_field_element`.


---
### fiat\_poly1305\_opp<!-- {{#callable:fiat_poly1305_opp}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L392>)

Negates a field element by subtracting each component from a constant value.
- **Inputs**:
    - `out1`: A `fiat_poly1305_loose_field_element` array where the result is stored.
    - `arg1`: A `fiat_poly1305_tight_field_element` array representing the field element to negate.
- **Logic and Control Flow**:
    - Calculate `x1` as the difference between `0x1ffffffffff6` and the first element of `arg1`.
    - Calculate `x2` as the difference between `0xffffffffffe` and the second element of `arg1`.
    - Calculate `x3` as the difference between `0xffffffffffe` and the third element of `arg1`.
    - Store `x1`, `x2`, and `x3` in `out1` at indices 0, 1, and 2, respectively.
- **Output**: The negated field element is stored in `out1` as a `fiat_poly1305_loose_field_element`.


---
### fiat\_poly1305\_selectznz<!-- {{#callable:fiat_poly1305_selectznz}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L417>)

Selects elements from two arrays based on a condition and stores the result in an output array.
- **Inputs**:
    - `out1`: An array of three `uint64_t` elements where the result is stored.
    - `arg1`: A `fiat_poly1305_uint1` condition flag that determines which array to select from.
    - `arg2`: An array of three `uint64_t` elements representing the first option for selection.
    - `arg3`: An array of three `uint64_t` elements representing the second option for selection.
- **Logic and Control Flow**:
    - Declare three `uint64_t` variables `x1`, `x2`, and `x3` to hold intermediate results.
    - Use [`fiat_poly1305_cmovznz_u64`](<#fiat_poly1305_cmovznz_u64>) to conditionally select between `arg2[0]` and `arg3[0]` based on `arg1`, storing the result in `x1`.
    - Repeat the conditional selection for `arg2[1]` and `arg3[1]`, storing the result in `x2`.
    - Repeat the conditional selection for `arg2[2]` and `arg3[2]`, storing the result in `x3`.
    - Assign `x1`, `x2`, and `x3` to `out1[0]`, `out1[1]`, and `out1[2]` respectively.
- **Output**: An array `out1` of three `uint64_t` elements, each selected from either `arg2` or `arg3` based on the value of `arg1`.
- **Functions Called**:
    - [`fiat_poly1305_cmovznz_u64`](<#fiat_poly1305_cmovznz_u64>)


---
### fiat\_poly1305\_to\_bytes<!-- {{#callable:fiat_poly1305_to_bytes}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L438>)

Serializes a `fiat_poly1305_tight_field_element` into a 17-byte array in little-endian order.
- **Inputs**:
    - `out1`: A 17-byte array to store the serialized output.
    - `arg1`: A `fiat_poly1305_tight_field_element` representing the field element to serialize.
- **Logic and Control Flow**:
    - Subtracts constants from each element of `arg1` using [`fiat_poly1305_subborrowx_u44`](<#fiat_poly1305_subborrowx_u44>) and [`fiat_poly1305_subborrowx_u43`](<#fiat_poly1305_subborrowx_u43>) to handle potential underflows.
    - Uses [`fiat_poly1305_cmovznz_u64`](<#fiat_poly1305_cmovznz_u64>) to conditionally set a mask based on the result of the subtraction.
    - Adds the mask to the results of the subtraction using [`fiat_poly1305_addcarryx_u44`](<#fiat_poly1305_addcarryx_u44>) and [`fiat_poly1305_addcarryx_u43`](<#fiat_poly1305_addcarryx_u43>) to ensure the values are within bounds.
    - Shifts and masks the results to extract individual bytes, storing them in `out1` in little-endian order.
- **Output**: A 17-byte array `out1` containing the serialized field element.
- **Functions Called**:
    - [`fiat_poly1305_subborrowx_u44`](<#fiat_poly1305_subborrowx_u44>)
    - [`fiat_poly1305_subborrowx_u43`](<#fiat_poly1305_subborrowx_u43>)
    - [`fiat_poly1305_cmovznz_u64`](<#fiat_poly1305_cmovznz_u64>)
    - [`fiat_poly1305_addcarryx_u44`](<#fiat_poly1305_addcarryx_u44>)
    - [`fiat_poly1305_addcarryx_u43`](<#fiat_poly1305_addcarryx_u43>)


---
### fiat\_poly1305\_from\_bytes<!-- {{#callable:fiat_poly1305_from_bytes}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L559>)

Deserializes a 17-byte array into a 3-element field element in little-endian order.
- **Inputs**:
    - `out1`: A `fiat_poly1305_tight_field_element` array to store the deserialized field element.
    - `arg1`: A 17-byte array representing the serialized field element in little-endian order.
- **Logic and Control Flow**:
    - Shift and combine bytes from `arg1` to form three 64-bit integers `x22`, `x29`, and `x37` using bitwise operations.
    - Mask `x22` with `0xfffffffffff` to get the first element of `out1`.
    - Shift `x22` right by 44 bits to get a carry byte `x24`.
    - Add `x24` to the next set of shifted bytes to form `x29`, then mask `x29` with `0x7ffffffffff` to get the second element of `out1`.
    - Shift `x29` right by 43 bits to get a carry bit `x31`.
    - Add `x31` to the next set of shifted bytes to form `x37`, which becomes the third element of `out1`.
- **Output**: A `fiat_poly1305_tight_field_element` array `out1` containing the deserialized field element.


---
### fiat\_poly1305\_relax<!-- {{#callable:fiat_poly1305_relax}} -->
[View Source →](<../../../../../src/ballet/fiat-crypto/poly1305_64.c#L646>)

Copies elements from a tight field element to a loose field element without modification.
- **Inputs**:
    - `out1`: A `fiat_poly1305_loose_field_element` array where the function will store the copied elements.
    - `arg1`: A `fiat_poly1305_tight_field_element` array containing the elements to copy.
- **Logic and Control Flow**:
    - Assigns the first element of `arg1` to the first element of `out1`.
    - Assigns the second element of `arg1` to the second element of `out1`.
    - Assigns the third element of `arg1` to the third element of `out1`.
- **Output**: The `out1` array contains the same elements as `arg1`, effectively relaxing the bounds from tight to loose.



---
Made with ❤️ by [Driver](https://www.driver.ai/)