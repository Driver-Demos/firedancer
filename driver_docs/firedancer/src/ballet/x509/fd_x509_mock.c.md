<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements mock X.509 certificate generation and public key extraction functions.

# Purpose
The code defines a mock implementation for handling X.509 certificates, specifically for testing or simulation purposes. It includes a static template of a mock X.509 certificate, `fd_x509_mock_tpl`, which is used to generate certificates with a specified public key. The function [`fd_x509_mock_cert`](<#fd_x509_mock_cert>) copies this template into a buffer and inserts a given public key at a predefined offset. This allows the creation of mock certificates that can be used in testing environments without the need for real certificate generation.

The code also provides functions to extract the public key from a certificate. The function [`fd_x509_mock_pubkey`](<#fd_x509_mock_pubkey>) attempts to find the public key in a given certificate by first checking if it matches the version 1 prefix using [`fd_x509_mock_pubkey_v1`](<#fd_x509_mock_pubkey_v1>), and if not, it checks against the version 2 template using [`fd_x509_mock_pubkey_v2`](<#fd_x509_mock_pubkey_v2>). These functions use the `memmem` and `memcmp` functions to locate the public key within the certificate data. The code is designed to work with certificates that conform to the mock template, ensuring that the public key can be reliably extracted for testing purposes.
# Imports and Dependencies

---
- `fd_x509_mock.h`
- `string.h`


# Global Variables

---
### fd\_x509\_mock\_tpl
- **Type**: ``uchar const` array`
- **Description**: Contains a mock X.509 certificate template in binary format. The template includes various certificate fields such as version, serial number, signature algorithm, issuer name, validity period, subject public key info, and extensions.
- **Use**: Used to generate mock X.509 certificates by copying the template and inserting a public key at a specified offset.


---
### fd\_x509\_mock\_v1\_prefix
- **Type**: ``uchar const[]``
- **Description**: An array of unsigned characters that represents a prefix used in the mock X.509 certificate for version 1. This prefix includes encoded data such as the algorithm identifier, issuer name, validity period, and subject name.
- **Use**: Used to match the beginning of a certificate to identify and extract the public key in version 1 of the mock X.509 certificate.


# Functions

---
### fd\_x509\_mock\_cert<!-- {{#callable:fd_x509_mock_cert}} -->
[View Source →](<../../../../../src/ballet/x509/fd_x509_mock.c#L128>)

Copies a mock X.509 certificate template into a buffer and inserts a given public key at a specified offset.
- **Inputs**:
    - `buf`: A buffer with a size of `FD_X509_MOCK_CERT_SZ` where the mock certificate will be stored.
    - `public_key`: A 32-byte array containing the public key to insert into the certificate.
- **Logic and Control Flow**:
    - Copy the contents of `fd_x509_mock_tpl` into the `buf` buffer using `fd_memcpy` with a size of `FD_X509_MOCK_CERT_SZ`.
    - Copy the `public_key` into the `buf` buffer at the offset `FD_X509_MOCK_PUBKEY_OFF` using `fd_memcpy` with a size of 32 bytes.
- **Output**: No return value; the function modifies the `buf` buffer in place.


---
### fd\_x509\_mock\_pubkey\_v1<!-- {{#callable:fd_x509_mock_pubkey_v1}} -->
[View Source →](<../../../../../src/ballet/x509/fd_x509_mock.c#L135>)

Extracts the public key from a mock X.509 certificate if it matches a specific prefix pattern.
- **Inputs**:
    - ``cert``: A pointer to the certificate data to search for the public key.
    - ``cert_sz``: The size of the certificate data in bytes.
- **Logic and Control Flow**:
    - Calculate the end of the certificate data by adding `cert_sz` to `cert`.
    - Search for the `fd_x509_mock_v1_prefix` within the certificate data using `memmem`.
    - If the prefix is not found, return `NULL`.
    - Calculate the position of the public key by adding the size of the prefix to the match position.
    - Check if the public key extends beyond the end of the certificate data; if so, return `NULL`.
    - Return the pointer to the start of the public key.
- **Output**: A pointer to the start of the public key within the certificate data, or `NULL` if the prefix is not found or the public key is out of bounds.


---
### fd\_x509\_mock\_pubkey\_v2<!-- {{#callable:fd_x509_mock_pubkey_v2}} -->
[View Source →](<../../../../../src/ballet/x509/fd_x509_mock.c#L146>)

Validates a certificate against a mock template and returns the public key if valid.
- **Inputs**:
    - ``cert``: Pointer to the certificate data to validate.
    - ``cert_sz``: Size of the certificate data in bytes.
- **Logic and Control Flow**:
    - Check if `cert_sz` is equal to `FD_X509_MOCK_CERT_SZ`; if not, return `NULL`.
    - Initialize `off` to 0 and compare the initial part of `cert` with `fd_x509_mock_tpl` up to `FD_X509_MOCK_PUBKEY_OFF`; store the result in `match0`.
    - Increment `off` by `FD_X509_MOCK_PUBKEY_OFF` and 32, then compare the remaining part of `cert` with `fd_x509_mock_tpl`; store the result in `match1`.
    - If either `match0` or `match1` is false, return `NULL`.
    - Return the pointer to the public key within `cert` at offset `FD_X509_MOCK_PUBKEY_OFF`.
- **Output**: Pointer to the public key within the certificate if valid, otherwise `NULL`.


---
### fd\_x509\_mock\_pubkey<!-- {{#callable:fd_x509_mock_pubkey}} -->
[View Source →](<../../../../../src/ballet/x509/fd_x509_mock.c#L162>)

Extracts the public key from a mock X.509 certificate by checking against two different template versions.
- **Inputs**:
    - ``cert``: A pointer to the certificate data from which to extract the public key.
    - ``cert_sz``: The size of the certificate data in bytes.
- **Logic and Control Flow**:
    - Call [`fd_x509_mock_pubkey_v1`](<#fd_x509_mock_pubkey_v1>) with `cert` and `cert_sz` to attempt to find a public key using the version 1 template.
    - If [`fd_x509_mock_pubkey_v1`](<#fd_x509_mock_pubkey_v1>) returns a non-null pointer, return this pointer as the public key location.
    - If [`fd_x509_mock_pubkey_v1`](<#fd_x509_mock_pubkey_v1>) returns null, call [`fd_x509_mock_pubkey_v2`](<#fd_x509_mock_pubkey_v2>) with `cert` and `cert_sz` to attempt to find a public key using the version 2 template.
    - If [`fd_x509_mock_pubkey_v2`](<#fd_x509_mock_pubkey_v2>) returns a non-null pointer, return this pointer as the public key location.
    - If both [`fd_x509_mock_pubkey_v1`](<#fd_x509_mock_pubkey_v1>) and [`fd_x509_mock_pubkey_v2`](<#fd_x509_mock_pubkey_v2>) return null, return null indicating no public key was found.
- **Output**: A pointer to the location of the public key within the certificate if found, otherwise null.
- **Functions Called**:
    - [`fd_x509_mock_pubkey_v1`](<#fd_x509_mock_pubkey_v1>)
    - [`fd_x509_mock_pubkey_v2`](<#fd_x509_mock_pubkey_v2>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)