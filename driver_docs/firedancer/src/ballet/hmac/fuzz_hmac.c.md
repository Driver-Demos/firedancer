<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Fuzz testing for HMAC implementations using SHA-256, SHA-384, and SHA-512 algorithms.

# Purpose
The code is a fuzz testing suite for validating the HMAC (Hash-based Message Authentication Code) implementations using SHA-256, SHA-384, and SHA-512 hashing algorithms. It is designed to be used with a fuzzing tool, such as LLVM's libFuzzer, to test the robustness and correctness of the HMAC functions. The code initializes the fuzzing environment with [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>), which sets up the necessary logging and environment configurations. The main function, [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>), processes input data to extract a key and message, then computes HMACs using the specified SHA algorithms. It verifies the consistency of the HMAC outputs by comparing the results of multiple computations to ensure they match.

The code includes several important components: it defines a structure `hmac_test_t` to represent test cases, and it uses assertions to validate the correctness of the HMAC computations. The code also includes checks to ensure that the input data is of sufficient size before processing. The use of `fd_hmac_sha256`, `fd_hmac_sha384`, and `fd_hmac_sha512` functions indicates that these are part of an external library, which the code tests for correctness. The inclusion of headers such as `fd_util.h`, `fd_fuzz.h`, and `fd_hmac.h` suggests that these provide necessary utilities and function declarations for the fuzz testing process.
# Imports and Dependencies

---
- `assert.h`
- `stdio.h`
- `stdlib.h`
- `../../util/fd_util.h`
- `../../util/sanitize/fd_fuzz.h`
- `fd_hmac.h`
- `../sha256/fd_sha256.h`
- `../sha512/fd_sha512.h`


# Data Structures

---
### hmac\_test
- **Type**: ``struct``
- **Members**:
    - `key_sz`: Stores the size of the key in bytes.
    - `key`: Holds the key data as an array of unsigned characters.
- **Description**: Defines a structure for HMAC testing, containing a key size and a flexible array member for the key data. The `hmac_test` structure is used to facilitate HMAC operations by providing a container for the key size and key data, which are essential for generating HMAC hashes.


---
### hmac\_test\_t
- **Type**: ``struct``
- **Members**:
    - ``key_sz``: Stores the size of the key in bytes.
    - ``key``: An array of unsigned characters representing the key.
- **Description**: Defines a structure used for HMAC testing, containing a key size and a flexible array member for the key itself. The structure is used to facilitate HMAC operations by providing the necessary key information.


# Functions

---
### LLVMFuzzerInitialize<!-- {{#callable:LLVMFuzzerInitialize}} -->
[View Source →](<../../../../../src/ballet/hmac/fuzz_hmac.c#L15>)

Initializes the fuzzer environment by setting environment variables, booting the system, registering an exit function, and setting the log level.
- **Inputs**:
    - `argc`: A pointer to the argument count, typically passed to the main function.
    - `argv`: A pointer to the argument vector, typically passed to the main function.
- **Logic and Control Flow**:
    - Set the environment variable `FD_LOG_BACKTRACE` to `0` to disable backtraces in logs.
    - Call `fd_boot` with `argc` and `argv` to initialize the system.
    - Register `fd_halt` to be called on program exit using `atexit`.
    - Set the core log level to `3` using `fd_log_level_core_set`, which will cause the program to crash on warning logs.
    - Return `0` to indicate successful initialization.
- **Output**: Returns `0` to indicate successful initialization.


---
### LLVMFuzzerTestOneInput<!-- {{#callable:LLVMFuzzerTestOneInput}} -->
[View Source →](<../../../../../src/ballet/hmac/fuzz_hmac.c#L35>)

Tests HMAC implementations by verifying that the same input produces identical hash outputs for SHA-256, SHA-384, and SHA-512 algorithms.
- **Inputs**:
    - `data`: A pointer to the input data, expected to be structured as an `hmac_test_t`.
    - `size`: The size of the input data in bytes.
- **Logic and Control Flow**:
    - Check if `size` is less than 64; if true, return -1.
    - Cast `data` to `hmac_test_t` and calculate `key_size` using `test->key_sz` masked with `KEY_MAX-1UL`.
    - Check if `size` is less than 64 plus `key_size`; if true, return -1.
    - Determine `key` and `msg` pointers based on `key_size` and `msg_size`.
    - Initialize two 64-byte arrays `hash1` and `hash2` for storing hash results.
    - Compute HMAC-SHA-256 for `msg` and `key`, store results in `hash1` and `hash2`, and assert they are equal.
    - Compute HMAC-SHA-384 for `msg` and `key`, store results in `hash1` and `hash2`, and assert they are equal.
    - Compute HMAC-SHA-512 for `msg` and `key`, store results in `hash1` and `hash2`, and assert they are equal.
    - Ensure all code paths are covered with `FD_FUZZ_MUST_BE_COVERED`.
    - Return 0 to indicate successful execution.
- **Output**: Returns 0 if the input data passes all tests, otherwise returns -1 if the input size is insufficient.



---
Made with ❤️ by [Driver](https://www.driver.ai/)