<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions to initialize and process shreds in a deshredder structure.

# Purpose
The code defines functions for initializing and processing a `fd_deshredder_t` structure, which is used to handle and process data shreds. The [`fd_deshredder_init`](<#fd_deshredder_init>) function initializes a `fd_deshredder_t` instance by setting up its buffer, buffer size, and the array of shreds to be processed. It also sets an initial result status. The [`fd_deshredder_next`](<#fd_deshredder_next>) function processes the shreds by iterating over them, checking their type, and copying their payloads into a buffer. It ensures that the buffer has enough space for each shred's payload and updates the buffer and shred pointers accordingly. The function also checks for specific flags to determine when a batch of shreds is complete, updating the result status as needed.

This code is part of a larger system that deals with data shreds, likely for data reconstruction or processing purposes. It includes error handling for various conditions, such as invalid shred types or insufficient buffer space. The code relies on external functions and constants, such as `fd_shred_type`, `fd_shred_is_data`, and error codes like `FD_SHRED_EPIPE`, which are likely defined in the included headers `fd_shred.h` and `fd_deshredder.h`. The functions do not define public APIs but are intended to be used internally within a system that processes data shreds.
# Imports and Dependencies

---
- `fd_shred.h`
- `fd_deshredder.h`


# Functions

---
### fd\_deshredder\_init<!-- {{#callable:fd_deshredder_init}} -->
[View Source →](<../../../../../src/ballet/shred/fd_deshredder.c#L4>)

Initializes a `fd_deshredder_t` structure with provided buffer and shred information.
- **Inputs**:
    - `shredder`: A pointer to a `fd_deshredder_t` structure to initialize.
    - `buf`: A pointer to a buffer where data will be stored.
    - `bufsz`: The size of the buffer in bytes.
    - `shreds`: A pointer to an array of `fd_shred_t` pointers, representing the shreds to process.
    - `shred_cnt`: The number of shreds in the `shreds` array.
- **Logic and Control Flow**:
    - Assigns the `shreds` pointer to the `shreds` field of the `shredder` structure.
    - Casts `shred_cnt` to `uint` and assigns it to the `shred_cnt` field of the `shredder` structure.
    - Assigns the `buf` pointer to the `buf` field of the `shredder` structure.
    - Assigns `bufsz` to the `bufsz` field of the `shredder` structure.
    - Sets the `result` field of the `shredder` structure to `FD_SHRED_EPIPE`.
- **Output**: No return value; the function initializes the `fd_deshredder_t` structure in place.


---
### fd\_deshredder\_next<!-- {{#callable:fd_deshredder_next}} -->
[View Source →](<../../../../../src/ballet/shred/fd_deshredder.c#L17>)

Processes shreds by appending their data to a buffer until a complete entry is formed or an error occurs.
- **Inputs**:
    - `shredder`: A pointer to an `fd_deshredder_t` structure that contains the shredder state, including the buffer, buffer size, shreds, and shred count.
- **Logic and Control Flow**:
    - Store the initial position of the buffer in `orig_buf`.
    - Enter an infinite loop to process shreds.
    - Check if `shred_cnt` is zero; if true, set `result` to `FD_SHRED_EPIPE` and break the loop.
    - Retrieve the current shred from `shreds`.
    - Check if the shred type is not a data shred; if true, return `-FD_SHRED_EINVAL`.
    - Check if the buffer size is less than the payload size of the shred; if true, return `-FD_SHRED_ENOMEM`.
    - Copy the shred's data payload into the buffer.
    - Update the buffer pointer and size by the payload size.
    - Advance the shred pointer and decrement the shred count.
    - Check if the shred's flags indicate the end of a slot or batch; if true, set `result` to `FD_SHRED_ESLOT` or `FD_SHRED_EBATCH` respectively and break the loop.
    - Return the number of bytes written to the buffer.
- **Output**: Returns the number of bytes written to the buffer, or a negative error code if an error occurs.
- **Functions Called**:
    - [`fd_shred_type`](<fd_shred.h.md#fd_shred_type>)
    - [`fd_shred_is_data`](<fd_shred.h.md#fd_shred_is_data>)
    - [`fd_shred_payload_sz`](<fd_shred.h.md#fd_shred_payload_sz>)
    - [`fd_shred_data_payload`](<fd_shred.h.md#fd_shred_data_payload>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)