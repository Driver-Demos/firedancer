<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the deshredding process by reading, parsing, and verifying shred data from binary archives.

# Purpose
The code is an executable C program that processes binary data known as "shreds" from archive files. It uses the `fd_deshredder_t` structure to concatenate and process these shreds. The program imports binary data from specific files using the `FD_IMPORT_BINARY` macro and reads them using the `fmemopen` function. It initializes the deshredder with an empty list of shreds and processes each shred one-by-one, although it notes that production code would handle multiple shreds in batches. The program verifies the integrity of the processed data by checking the size of the defragmented batch and the number of shreds, and it compares the deshredded content with expected results using `memcmp`.

The program includes several key components: it initializes the deshredder, reads shreds from archives, parses them, and refills the deshredder with parsed shreds. It uses the `fd_ar_read_next` function to iterate over the shreds in the archive and checks for errors using `FD_TEST`. The program logs progress and results using `FD_LOG_NOTICE` and ensures that the archive is consumed gracefully by checking for the `ENOENT` error. The main function concludes by halting the program with `fd_halt` and returning 0 to indicate successful execution.
# Imports and Dependencies

---
- `fd_shred.h`
- `errno.h`
- `stdio.h`
- `../../util/archive/fd_ar.h`


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/shred/test_deshredder.c#L13>)

Processes and deshreds binary data from multiple archive files, verifying the integrity and size of the resulting batches.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Opens the first archive file `localnet_shreds_0` for reading and initializes the archive reader.
    - Initializes a `fd_deshredder_t` structure to manage the deshredding process.
    - Reads shreds one-by-one from the archive, parses them, and feeds them into the deshredder.
    - Verifies that the archive reading ends gracefully with `ENOENT`.
    - Checks the size and content of the deshredded batch against expected values.
    - Repeats the process for two more archive files: `localnet_v14_shreds_0` and `localnet_v14_shreds_1`.
    - Logs progress and results using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_shred_parse`](<fd_shred.c.md#fd_shred_parse>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)