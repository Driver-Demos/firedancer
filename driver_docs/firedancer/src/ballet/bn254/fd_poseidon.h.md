<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implementation of the Poseidon hash function over the BN254 scalar field with initialization, appending, and finalization functions.

# Purpose
The code is a C header file that defines the implementation of the Poseidon hash function over the BN254 scalar field. It is based on the Rust library `light-poseidon` and the Circom library. The file provides the necessary data structures and function prototypes to perform hashing operations using the Poseidon algorithm. The key components include the `fd_poseidon` structure, which maintains the state of the hash calculation, and the `fd_poseidon_par` structure, which holds parameters like the Ark and MDS matrices used in the Poseidon algorithm.

The file defines several functions to manage the Poseidon hash calculation process. The `fd_poseidon_init` function initializes the hash state, allowing the user to specify the endianness of the input and output data. The [`fd_poseidon_append`](<#fd_poseidon_append>) function adds data to the hash calculation, supporting up to 12 elements, each representing a 256-bit integer in the BN254 field. The [`fd_poseidon_fini`](<#fd_poseidon_fini>) function finalizes the hash calculation and stores the result in a specified memory location. Additionally, the file provides a convenience function, [`fd_poseidon_hash`](<#fd_poseidon_hash>), to hash a series of bytes in a single operation. The header file is intended to be included in other C source files that require Poseidon hashing functionality.
# Imports and Dependencies

---
- `../fd_ballet_base.h`
- `./fd_bn254_scalar.h`


# Data Structures

---
### fd\_poseidon\_hash\_result
- **Type**: ``struct``
- **Members**:
    - ``v``: An array of unsigned characters with a size defined by `FD_POSEIDON_HASH_SZ`.
- **Description**: Represents the result of a Poseidon hash calculation, storing the hash value as an array of unsigned characters with a fixed size.


---
### fd\_poseidon\_hash\_result\_t
- **Type**: ``struct``
- **Members**:
    - ``v``: An array of unsigned characters with a size defined by `FD_POSEIDON_HASH_SZ`.
- **Description**: Represents the result of a Poseidon hash calculation, stored as an array of unsigned characters (`uchar`) with a fixed size of 32 bytes, corresponding to the size of the hash output in the BN254 scalar field.


---
### fd\_poseidon\_t
- **Type**: ``struct``
- **Members**:
    - ``state``: An array of `fd_bn254_scalar_t` representing the current state of the Poseidon hash calculation.
    - ``cnt``: A `ulong` that counts how many elements have been appended to the hash calculation.
    - ``big_endian``: An `int` indicating the endianness of the input and output, where 0 is little endian and 1 is big endian.
- **Description**: Defines the state and configuration for a Poseidon hash calculation over the BN254 scalar field, including the current state, the number of elements appended, and the endianness of the data.


---
### fd\_poseidon\_par
- **Type**: ``struct``
- **Members**:
    - ``ark``: A pointer to an array of `fd_bn254_scalar_t` representing the round constants for the Poseidon hash function.
    - ``mds``: A pointer to an array of `fd_bn254_scalar_t` representing the mix matrix for the Poseidon hash function.
- **Description**: Defines parameters for the Poseidon hash function, specifically the round constants (`ark`) and the mix matrix (`mds`), both of which are essential for the hash computation over the BN254 scalar field.


---
### fd\_poseidon\_par\_t
- **Type**: ``struct``
- **Members**:
    - ``ark``: Pointer to an array of `fd_bn254_scalar_t` representing the round constants.
    - ``mds``: Pointer to an array of `fd_bn254_scalar_t` representing the MDS matrix.
- **Description**: Defines parameters for the Poseidon hash function, specifically the round constants (`ark`) and the MDS matrix (`mds`), which are essential for the cryptographic operations performed by the hash function.


# Functions

---
### fd\_poseidon\_hash<!-- {{#callable:fd_poseidon_hash}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_poseidon.h#L94>)

Computes the Poseidon hash of a given byte array and stores the result in a specified structure.
- **Inputs**:
    - `result`: A pointer to `fd_poseidon_hash_result_t` where the hash result will be stored.
    - `bytes`: A pointer to the byte array that will be hashed.
    - `bytes_len`: The length of the byte array to be hashed.
    - `big_endian`: An integer indicating the endianness of the input and output; non-zero for big-endian, zero for little-endian.
- **Logic and Control Flow**:
    - Initialize a `fd_poseidon_t` structure with the specified endianness using `fd_poseidon_init`.
    - Iterate over the byte array in chunks of 32 bytes, appending each chunk to the Poseidon state using [`fd_poseidon_append`](<fd_poseidon.c.md#fd_poseidon_append>).
    - Finalize the Poseidon hash calculation with [`fd_poseidon_fini`](<fd_poseidon.c.md#fd_poseidon_fini>), storing the result in the provided `result` structure.
    - Return the negation of the result of [`fd_poseidon_fini`](<fd_poseidon.c.md#fd_poseidon_fini>) to indicate success or failure.
- **Output**: Returns an integer indicating success (0) or failure (non-zero) of the hash operation.
- **Functions Called**:
    - [`fd_poseidon_append`](<fd_poseidon.c.md#fd_poseidon_append>)
    - [`fd_poseidon_fini`](<fd_poseidon.c.md#fd_poseidon_fini>)


# Function Declarations (Public API)

---
### fd\_poseidon\_append<!-- {{#callable_declaration:fd_poseidon_append}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_poseidon.h#L73>)

Appends data to an in-progress Poseidon hash calculation.
- **Description**: Use this function to add data to a Poseidon hash calculation that is currently in progress. The function expects a valid Poseidon state object and data representing a BN254 scalar. The data can be up to 32 bytes long and will be padded with zeros if shorter. The function can be called up to 12 times on the same state object. If the state object is null, the data size is zero or greater than 32, or the state has reached its maximum capacity, the function returns null.
- **Inputs**:
    - `pos`: A pointer to a Poseidon state object. Must not be null. Represents the current state of the hash calculation.
    - `data`: A pointer to the data to append. Represents a BN254 scalar. Can be null if sz is zero. The data is not modified by the function.
    - `sz`: The size of the data in bytes. Must be between 1 and 32 inclusive. If zero or greater than 32, the function returns null.
- **Output**: Returns a pointer to the updated Poseidon state object on success, or null if an error occurs.
- **See Also**: [`fd_poseidon_append`](<fd_poseidon.c.md#fd_poseidon_append>)  (Implementation)


---
### fd\_poseidon\_fini<!-- {{#callable_declaration:fd_poseidon_fini}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_poseidon.h#L89>)

Completes a Poseidon hash calculation and stores the result.
- **Description**: Use this function to finalize a Poseidon hash calculation after all necessary data has been appended. It must be called on a valid Poseidon calculation state that has been initialized and has had data appended to it. The function writes the hash result to the provided buffer. If the input state is null or invalid, the function returns null and does not modify the hash buffer. Ensure that the hash buffer is correctly aligned and has sufficient space to store the 32-byte result.
- **Inputs**:
    - `pos`: A pointer to a `fd_poseidon_t` structure representing the current state of a Poseidon hash calculation. Must not be null and should have a valid state with appended data. If null, the function returns null.
    - `hash`: A pointer to a 32-byte buffer where the hash result will be stored. The buffer must be aligned to `FD_UINT256_ALIGNED` and have sufficient space for the result. The function does not modify the buffer if `pos` is null.
- **Output**: Returns a pointer to the hash buffer if successful, or null if the input state is null or invalid.
- **See Also**: [`fd_poseidon_fini`](<fd_poseidon.c.md#fd_poseidon_fini>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)