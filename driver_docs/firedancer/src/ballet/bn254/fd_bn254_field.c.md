<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements operations and constants for the BN254 base field, including addition, subtraction, multiplication, and square root calculations.

# Purpose
The code is a C source file that provides functionality for arithmetic operations in the finite field associated with the BN254 elliptic curve. It includes definitions and operations for field elements, such as addition, subtraction, negation, and multiplication, both in and out of Montgomery form. The file defines several constants used in these operations, such as the field modulus `fd_bn254_const_p`, its inverse `fd_bn254_const_p_inv`, and other constants used for specific calculations like square roots and field element validation.

The file also includes functions for converting field elements to and from byte arrays, checking equality, and performing modular exponentiation. The operations are implemented using inline functions for efficiency, and the code relies on external functions from the `fiat-crypto` library for some arithmetic operations. The file is intended to be part of a larger library or application that requires cryptographic operations on the BN254 curve, and it does not define a public API or external interfaces directly. Instead, it provides low-level operations that can be used by other components of the system.
# Imports and Dependencies

---
- `./fd_bn254.h`
- `../fiat-crypto/bn254_64.c`


# Global Variables

---
### fd\_bn254\_const\_zero
- **Type**: ``fd_bn254_fp_t``
- **Description**: Represents a constant zero value in the base field `Fp` of the BN254 curve. It is defined as an array of four unsigned long integers, all set to zero.
- **Use**: Used as a constant zero value in arithmetic operations within the BN254 curve's base field.


---
### fd\_bn254\_const\_p
- **Type**: ``fd_bn254_fp_t``
- **Description**: Represents a constant value `p` used to validate a field element in the BN254 base field. It is defined as an array of four 64-bit unsigned integers, which together form a 256-bit number. This constant is not in Montgomery form.
- **Use**: Used to validate field elements and perform arithmetic operations in the BN254 base field.


---
### fd\_bn254\_const\_p\_inv
- **Type**: ``ulong``
- **Description**: `fd_bn254_const_p_inv` is a static constant variable of type `ulong` that holds the value `0x87D20782E4866389UL`. This value represents the modular inverse of the constant `p` used in the CIOS multiplication algorithm.
- **Use**: Used in the implementation of the CIOS multiplication algorithm to perform modular arithmetic operations.


---
### fd\_bn254\_const\_one\_mont
- **Type**: ``fd_bn254_fp_t``
- **Description**: Represents the constant value of one in the Montgomery form for the BN254 field. It is defined as an array of four 64-bit unsigned integers.
- **Use**: Used in arithmetic operations within the BN254 field in Montgomery form.


---
### fd\_bn254\_const\_x
- **Type**: ``const fd_bn254_scalar_t``
- **Description**: A constant scalar value represented as an array of four 64-bit unsigned integers. The first element is initialized to `0x44e992b44a6909f1`, and the remaining elements are zero.
- **Use**: Used by the function `fd_bn254_g2_frombytes_check()` as a scalar value in non-Montgomery form.


---
### fd\_bn254\_const\_b\_mont
- **Type**: ``fd_bn254_fp_t``
- **Description**: Represents the constant 'b' in the elliptic curve equation y^2 = x^3 + b, in Montgomery form. It is defined as an array of four 64-bit unsigned integers.
- **Use**: Used in elliptic curve computations to represent the constant 'b' in Montgomery form.


---
### fd\_bn254\_const\_p\_minus\_one\_mont
- **Type**: ``fd_bn254_fp_t``
- **Description**: Represents the constant value of `p-1` in the Montgomery form for the BN254 field. This constant is used to check if a square root exists in the field.
- **Use**: Used in the `fd_bn254_fp_sqrt` function to verify the existence of a square root for a given field element.


---
### fd\_bn254\_const\_p\_minus\_one\_half
- **Type**: ``fd_bn254_fp_t``
- **Description**: Represents the constant value of (p-1)/2 in the base field Fp for the BN254 curve. This value is not in Montgomery form and is used in field arithmetic operations.
- **Use**: Used to check if an element is positive or negative and to calculate square roots in Fp2.


---
### fd\_bn254\_const\_sqrt\_exp
- **Type**: ``fd_uint256_t``
- **Description**: Represents the constant value `(p-3)/4` used in the calculation of square roots in the finite fields `Fp` and `Fp2`. This constant is stored as a 256-bit unsigned integer array with one element.
- **Use**: Used in the `fd_bn254_fp_sqrt` function to calculate square roots in the finite fields `Fp` and `Fp2`.


# Functions

---
### fd\_bn254\_fp\_is\_neg\_nm<!-- {{#callable:fd_bn254_fp_is_neg_nm}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L62>)

Determines if a field element is negative by comparing it to a constant value.
- **Inputs**:
    - ``x``: A pointer to a `fd_bn254_fp_t` structure representing the field element to check.
- **Logic and Control Flow**:
    - Calls the function `fd_uint256_cmp` to compare the field element `x` with the constant `fd_bn254_const_p_minus_one_half`.
    - Returns a positive integer if `x` is greater than `fd_bn254_const_p_minus_one_half`, indicating that `x` is negative.
- **Output**: An integer indicating whether the field element is negative (greater than `fd_bn254_const_p_minus_one_half`).


---
### fd\_bn254\_fp\_frombytes\_be\_nm<!-- {{#callable:fd_bn254_fp_frombytes_be_nm}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L67>)

Converts a 32-byte big-endian buffer to a field element, checking for special flags and validity.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``buf``: A constant 32-byte array representing the big-endian input data.
    - ``is_inf``: A pointer to an integer that will be set to indicate if the input represents infinity (optional).
    - ``is_neg``: A pointer to an integer that will be set to indicate if the input represents a negative value (optional).
- **Logic and Control Flow**:
    - Check if `is_inf` and `is_neg` are not NULL, then set `*is_inf` and `*is_neg` based on the flags in `buf[0]`.
    - If both `is_inf` and `is_neg` flags are set, return NULL to indicate an error.
    - Copy the 32-byte `buf` into `r` and perform a byte swap on `r`.
    - If `is_inf` is not NULL, mask the last byte of `r` with `FLAG_MASK`.
    - Compare `r` with `fd_bn254_const_p` to ensure it is a valid field element; return NULL if it is not valid.
    - Return the pointer `r` if all checks pass.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r`, or NULL if an error occurs.


---
### fd\_bn254\_fp\_tobytes\_be\_nm<!-- {{#callable:fd_bn254_fp_tobytes_be_nm}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L96>)

Converts a field element to a big-endian byte array.
- **Inputs**:
    - ``buf``: A 32-byte array where the function will store the big-endian representation of the field element.
    - ``a``: A pointer to the field element (`fd_bn254_fp_t`) to convert to a byte array.
- **Logic and Control Flow**:
    - Calls `fd_uint256_bswap` to swap the byte order of the field element `a` in place.
    - Copies the byte-swapped field element `a` into the `buf` array using `fd_memcpy`.
    - Returns the `buf` array containing the big-endian byte representation of the field element.
- **Output**: A pointer to the `buf` array containing the big-endian byte representation of the field element.


---
### fd\_bn254\_fp\_eq<!-- {{#callable:fd_bn254_fp_eq}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L104>)

Compares two `fd_bn254_fp_t` field elements for equality.
- **Inputs**:
    - `r`: A pointer to the first `fd_bn254_fp_t` field element to compare.
    - `a`: A pointer to the second `fd_bn254_fp_t` field element to compare.
- **Logic and Control Flow**:
    - Calls the `fd_uint256_eq` function with `r` and `a` as arguments to check if they are equal.
- **Output**: Returns an integer indicating whether the two field elements are equal (non-zero if equal, zero if not).


---
### fd\_bn254\_fp\_from\_mont<!-- {{#callable:fd_bn254_fp_from_mont}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L110>)

Converts a field element from its Montgomery representation to its standard representation.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the field element in Montgomery form.
- **Logic and Control Flow**:
    - Calls the function `fiat_bn254_from_montgomery` to convert the limbs of `a` from Montgomery form to standard form and stores the result in `r`.
    - Returns the pointer `r` containing the converted field element.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the field element in standard representation.


---
### fd\_bn254\_fp\_to\_mont<!-- {{#callable:fd_bn254_fp_to_mont}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L117>)

Converts a field element from standard representation to Montgomery representation.
- **Inputs**:
    - ``r``: A pointer to a `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the field element to convert.
- **Logic and Control Flow**:
    - Calls the function `fiat_bn254_to_montgomery` with the `limbs` of `r` and `a` to perform the conversion.
    - Returns the pointer `r` containing the converted field element.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the field element in Montgomery representation.


---
### fd\_bn254\_fp\_neg\_nm<!-- {{#callable:fd_bn254_fp_neg_nm}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L124>)

Computes the negation of a field element in the base field of BN254, handling the special case where the input is zero.
- **Inputs**:
    - `r`: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - `a`: A pointer to a constant `fd_bn254_fp_t` structure representing the field element to negate.
- **Logic and Control Flow**:
    - Check if the input `a` is zero using `fd_bn254_fp_is_zero`; if true, set `r` to zero using `fd_bn254_fp_set_zero` and return `r`.
    - If `a` is not zero, iterate over the four limbs of the field element.
    - For each limb, compute the negation by subtracting the limb value from the corresponding limb of the constant `p`, adjusting for carry if necessary.
    - Store the result in the corresponding limb of `r`.
    - Return the pointer `r`.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the negated field element.


---
### fd\_bn254\_fp\_set<!-- {{#callable:fd_bn254_fp_set}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L142>)

Copies the field element from source `a` to destination `r`.
- **Inputs**:
    - `r`: A pointer to the destination `fd_bn254_fp_t` structure where the field element will be copied.
    - `a`: A pointer to the source `fd_bn254_fp_t` structure from which the field element will be copied.
- **Logic and Control Flow**:
    - Copy the first limb of `a` to the first limb of `r`.
    - Copy the second limb of `a` to the second limb of `r`.
    - Copy the third limb of `a` to the third limb of `r`.
    - Copy the fourth limb of `a` to the fourth limb of `r`.
    - Return the pointer `r`.
- **Output**: Returns a pointer to the destination `fd_bn254_fp_t` structure `r`.


---
### fd\_bn254\_fp\_add<!-- {{#callable:fd_bn254_fp_add}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L152>)

Adds two field elements in the BN254 base field and stores the result in the provided result variable.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the first operand.
    - ``b``: A pointer to a constant `fd_bn254_fp_t` structure representing the second operand.
- **Logic and Control Flow**:
    - Calls the `fiat_bn254_add` function to perform the addition of the limbs of `a` and `b`, storing the result in the limbs of `r`.
    - Returns the pointer `r` containing the result of the addition.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the sum of `a` and `b`.


---
### fd\_bn254\_fp\_sub<!-- {{#callable:fd_bn254_fp_sub}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L160>)

Subtracts two field elements in the BN254 base field and stores the result in the first argument.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the minuend.
    - ``b``: A pointer to a constant `fd_bn254_fp_t` structure representing the subtrahend.
- **Logic and Control Flow**:
    - Calls the `fiat_bn254_sub` function to perform the subtraction of the limbs of `a` and `b`, storing the result in the limbs of `r`.
    - Returns the pointer `r` containing the result of the subtraction.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the result of the subtraction.


---
### fd\_bn254\_fp\_neg<!-- {{#callable:fd_bn254_fp_neg}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L168>)

Computes the negation of a field element in the BN254 base field.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the field element to negate.
- **Logic and Control Flow**:
    - Calls the function `fiat_bn254_opp` to compute the negation of the field element `a` and stores the result in `r`.
    - Returns the pointer `r` containing the negated field element.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the negated field element.


---
### fd\_bn254\_fp\_halve<!-- {{#callable:fd_bn254_fp_halve}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L175>)

Halves a field element in the base field of BN254, adjusting for odd values by adding the field modulus.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A constant pointer to an `fd_bn254_fp_t` structure representing the field element to halve.
- **Logic and Control Flow**:
    - Check if the least significant bit of `a->limbs[0]` is odd by performing a bitwise AND with `0x1`.
    - If `a` is odd, add the field modulus `fd_bn254_const_p` to `a` using `fd_uint256_add`; otherwise, add zero.
    - Shift each limb of `r` to the right by one bit, carrying over the most significant bit from the next limb to the left.
- **Output**: Returns a pointer to the `fd_bn254_fp_t` structure `r` containing the halved field element.


---
### fd\_bn254\_fp\_sqr<!-- {{#callable:fd_bn254_fp_sqr}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L189>)

Calculates the square of a field element in the BN254 base field.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A constant pointer to an `fd_bn254_fp_t` structure representing the field element to be squared.
- **Logic and Control Flow**:
    - Calls the `fd_bn254_fp_mul` function with `r`, `a`, and `a` as arguments to compute the square of `a`.
- **Output**: Returns a pointer to the `fd_bn254_fp_t` structure `r` containing the squared result.


---
### fd\_bn254\_fp\_pow<!-- {{#callable:fd_bn254_fp_pow}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L195>)

Computes the power of a field element `a` raised to an exponent `b` in the BN254 field.
- **Inputs**:
    - `r`: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - `a`: A constant pointer to an `fd_bn254_fp_t` structure representing the base of the exponentiation.
    - `b`: A constant pointer to an `fd_uint256_t` structure representing the exponent.
- **Logic and Control Flow**:
    - Initialize `r` to one using `fd_bn254_fp_set_one` function.
    - Set `i` to 255, the highest bit index of the 256-bit exponent `b`.
    - Decrement `i` until a set bit is found in `b`.
    - Iterate from the highest set bit down to 0.
    - In each iteration, square `r` using [`fd_bn254_fp_sqr`](<#fd_bn254_fp_sqr>).
    - If the current bit of `b` is set, multiply `r` by `a` using `fd_bn254_fp_mul`.
    - Return the result stored in `r`.
- **Output**: A pointer to the `fd_bn254_fp_t` structure `r` containing the result of the exponentiation.
- **Functions Called**:
    - [`fd_bn254_fp_sqr`](<#fd_bn254_fp_sqr>)


---
### fd\_bn254\_fp\_inv<!-- {{#callable:fd_bn254_fp_inv}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L212>)

Calculates the multiplicative inverse of a field element in the BN254 base field.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the field element to invert.
- **Logic and Control Flow**:
    - Initialize a `fd_uint256_t` array `p_minus_2` with the constant prime `fd_bn254_const_p`.
    - Subtract 2 from the least significant limb of `p_minus_2`.
    - Call [`fd_bn254_fp_pow`](<#fd_bn254_fp_pow>) with `r`, `a`, and `p_minus_2` to compute the inverse of `a` and store it in `r`.
- **Output**: Returns a pointer to the `fd_bn254_fp_t` structure `r` containing the inverse of the input field element `a`.
- **Functions Called**:
    - [`fd_bn254_fp_set`](<#fd_bn254_fp_set>)
    - [`fd_bn254_fp_pow`](<#fd_bn254_fp_pow>)


---
### fd\_bn254\_fp\_sqrt<!-- {{#callable:fd_bn254_fp_sqrt}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_field.c#L221>)

Calculates the square root of a field element in the BN254 base field, if it exists.
- **Inputs**:
    - ``r``: A pointer to an `fd_bn254_fp_t` structure where the result will be stored.
    - ``a``: A pointer to a constant `fd_bn254_fp_t` structure representing the field element whose square root is to be calculated.
- **Logic and Control Flow**:
    - Declare temporary variables `a0` and `a1` as arrays of `fd_bn254_fp_t` with one element each.
    - Compute `a1` as `a` raised to the power of `fd_bn254_const_sqrt_exp` using [`fd_bn254_fp_pow`](<#fd_bn254_fp_pow>).
    - Square `a1` and store the result in `a0` using [`fd_bn254_fp_sqr`](<#fd_bn254_fp_sqr>).
    - Multiply `a0` by `a` and store the result back in `a0` using `fd_bn254_fp_mul`.
    - Check if `a0` is equal to `fd_bn254_const_p_minus_one_mont` using [`fd_bn254_fp_eq`](<#fd_bn254_fp_eq>); if true, return `NULL` indicating no square root exists.
    - Multiply `a1` by `a` and store the result in `r` using `fd_bn254_fp_mul`.
    - Return `r` as the result.
- **Output**: A pointer to `fd_bn254_fp_t` containing the square root of `a`, or `NULL` if no square root exists.
- **Functions Called**:
    - [`fd_bn254_fp_pow`](<#fd_bn254_fp_pow>)
    - [`fd_bn254_fp_sqr`](<#fd_bn254_fp_sqr>)
    - [`fd_bn254_fp_eq`](<#fd_bn254_fp_eq>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)