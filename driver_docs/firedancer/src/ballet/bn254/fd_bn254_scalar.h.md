<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implementation of BN254 scalar field operations, including validation, arithmetic, and Montgomery conversions.

# Purpose
The code defines a C header file for operations on the BN254 scalar field, which is used in cryptographic computations. It provides functionality for scalar validation and arithmetic operations such as addition, multiplication, and conversion to and from Montgomery form. The scalar field is represented as a 32-byte buffer, or an array of four unsigned long integers on little-endian platforms. The code is intended for use in the Firedancer VM, specifically for Solana syscalls, and it ensures that inputs are little-endian and aligned.

The implementation relies on the `fiat-crypto` library for most operations, but it includes a custom multiplication implementation when the `uint128` type is available, due to performance issues with the `fiat-crypto` multiplication on GCC. The header file defines constants such as `fd_bn254_const_r` for scalar validation and `fd_bn254_const_r_inv` for Montgomery multiplication. The file includes function prototypes for scalar validation and arithmetic operations, which are implemented as inline functions to optimize performance.
# Imports and Dependencies

---
- `../fd_ballet_base.h`
- `../bigint/fd_uint256.h`
- `../fiat-crypto/bn254_scalar_64.c`


# Global Variables

---
### fd\_bn254\_const\_r
- **Type**: ``fd_bn254_scalar_t``
- **Description**: A static constant array of type `fd_bn254_scalar_t` with a single element, representing a specific scalar value in the BN254 scalar field. This value is used for scalar validation and is not in Montgomery form.
- **Use**: Used to validate that a scalar field element is within the valid range for the BN254 scalar field.


---
### fd\_bn254\_const\_r\_inv
- **Type**: ``ulong``
- **Description**: A constant unsigned long integer representing the modular inverse of `r` in the BN254 scalar field. It is used in the context of CIOS (Cunningham Inverse of a Scalar) multiplication.
- **Use**: Used to perform modular arithmetic operations in the BN254 scalar field, specifically for CIOS multiplication.


# Functions

---
### fd\_bn254\_scalar\_validate<!-- {{#callable:fd_bn254_scalar_validate}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_scalar.h#L37>)

Validates if a scalar is within the range of 0 to r-1, inclusive.
- **Inputs**:
    - `s`: A pointer to a `fd_bn254_scalar_t` type, representing the scalar to validate.
- **Logic and Control Flow**:
    - Compares the scalar `s` with the constant `fd_bn254_const_r` using `fd_uint256_cmp`.
    - Returns a value less than 0 if `s` is less than `fd_bn254_const_r`, indicating that `s` is within the valid range.
- **Output**: An integer indicating whether the scalar `s` is within the valid range (0 to r-1).


---
### fd\_bn254\_scalar\_from\_mont<!-- {{#callable:fd_bn254_scalar_from_mont}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_scalar.h#L48>)

Converts a scalar from Montgomery representation to standard representation.
- **Inputs**:
    - `r`: A pointer to an `fd_bn254_scalar_t` structure where the result will be stored.
    - `a`: A pointer to a constant `fd_bn254_scalar_t` structure representing the scalar in Montgomery form to be converted.
- **Logic and Control Flow**:
    - Calls the function `fiat_bn254_scalar_from_montgomery` with `r->limbs` and `a->limbs` to perform the conversion from Montgomery form to standard form.
    - Returns the pointer `r` containing the converted scalar.
- **Output**: A pointer to the `fd_bn254_scalar_t` structure `r` containing the scalar in standard representation.


---
### fd\_bn254\_scalar\_to\_mont<!-- {{#callable:fd_bn254_scalar_to_mont}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_scalar.h#L55>)

Converts a scalar from standard representation to Montgomery representation.
- **Inputs**:
    - `r`: A pointer to an `fd_bn254_scalar_t` where the result will be stored.
    - `a`: A pointer to a constant `fd_bn254_scalar_t` representing the scalar to convert.
- **Logic and Control Flow**:
    - Calls the function `fiat_bn254_scalar_to_montgomery` with `r->limbs` and `a->limbs` to perform the conversion.
    - Returns the pointer `r` containing the converted scalar.
- **Output**: A pointer to `fd_bn254_scalar_t` containing the scalar in Montgomery representation.


---
### fd\_bn254\_scalar\_add<!-- {{#callable:fd_bn254_scalar_add}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_scalar.h#L62>)

Performs addition of two BN254 scalar values and stores the result in a third scalar.
- **Inputs**:
    - `r`: A pointer to an `fd_bn254_scalar_t` where the result of the addition will be stored.
    - `a`: A pointer to a constant `fd_bn254_scalar_t` representing the first scalar operand.
    - `b`: A pointer to a constant `fd_bn254_scalar_t` representing the second scalar operand.
- **Logic and Control Flow**:
    - Calls the `fiat_bn254_scalar_add` function to perform the addition of the limbs of scalars `a` and `b`, storing the result in the limbs of scalar `r`.
    - Returns the pointer `r` containing the result of the addition.
- **Output**: Returns a pointer to `fd_bn254_scalar_t` containing the result of the addition.


---
### fd\_bn254\_scalar\_mul<!-- {{#callable:fd_bn254_scalar_mul}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_scalar.h#L72>)

Performs multiplication of two BN254 scalar values and stores the result in a given scalar.
- **Inputs**:
    - `r`: A pointer to `fd_bn254_scalar_t` where the result of the multiplication will be stored.
    - `a`: A constant pointer to `fd_bn254_scalar_t` representing the first scalar operand.
    - `b`: A constant pointer to `fd_bn254_scalar_t` representing the second scalar operand.
- **Logic and Control Flow**:
    - Calls the `fiat_bn254_scalar_mul` function with the `limbs` of `r`, `a`, and `b` to perform the multiplication.
    - Returns the pointer `r` containing the result of the multiplication.
- **Output**: A pointer to `fd_bn254_scalar_t` containing the result of the scalar multiplication.


---
### fd\_bn254\_scalar\_sqr<!-- {{#callable:fd_bn254_scalar_sqr}} -->
[View Source →](<../../../../../src/ballet/bn254/fd_bn254_scalar.h#L91>)

Computes the square of a BN254 scalar value and stores the result in the provided output buffer.
- **Inputs**:
    - `r`: A pointer to an `fd_bn254_scalar_t` where the result will be stored.
    - `a`: A pointer to a constant `fd_bn254_scalar_t` representing the scalar value to be squared.
- **Logic and Control Flow**:
    - Calls the [`fd_bn254_scalar_mul`](<#fd_bn254_scalar_mul>) function with `r`, `a`, and `a` as arguments to compute the square of the scalar `a`.
    - Returns the pointer `r` containing the squared result.
- **Output**: A pointer to `fd_bn254_scalar_t` containing the squared result of the input scalar `a`.
- **Functions Called**:
    - [`fd_bn254_scalar_mul`](<#fd_bn254_scalar_mul>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)