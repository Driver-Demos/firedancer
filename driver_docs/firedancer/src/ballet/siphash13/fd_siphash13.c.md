<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements the SipHash-1-3 cryptographic hash function with initialization, appending, and finalization.

# Purpose
The code implements the SipHash-1-3 cryptographic hash function, which is a variant of the SipHash family designed for fast hashing of short messages. It provides a set of functions to initialize, update, and finalize the hash computation. The [`fd_siphash13_init`](<#fd_siphash13_init>) function initializes the hash state with a given key, while [`fd_siphash13_append`](<#fd_siphash13_append>) and [`fd_siphash13_append_fast`](<#fd_siphash13_append_fast>) allow for incremental addition of data to the hash. The [`fd_siphash13_fini`](<#fd_siphash13_fini>) function finalizes the hash computation and returns the resulting hash value. Additionally, the [`fd_siphash13_hash`](<#fd_siphash13_hash>) function provides a one-shot interface to compute the hash of a complete data block in a single call.

The code is structured to handle data in blocks, optimizing for aligned data access, and includes mechanisms to handle any remaining bytes after processing full blocks. The use of `FD_SIPHASH_ROUND` indicates that the core hash computation involves multiple rounds of mixing the state. The code is intended to be part of a library, as indicated by the inclusion of a header file `fd_siphash13.h`, and it defines a public API for external use. The implementation is a modified version of an existing SipHash implementation, with contributions from multiple authors over several years.
# Imports and Dependencies

---
- `fd_siphash13.h`


# Global Variables

---
### fd\_siphash13\_initial
- **Type**: ``static const ulong[4]``
- **Description**: An array of four unsigned long integers, each initialized with a specific 64-bit constant value. These values are used as the initial state for the SipHash-1-3 algorithm.
- **Use**: Used to initialize the state vector in the `fd_siphash13_init` function for the SipHash-1-3 hashing process.


# Functions

---
### fd\_siphash13\_init<!-- {{#callable:fd_siphash13_init}} -->
[View Source →](<../../../../../src/ballet/siphash13/fd_siphash13.c#L20>)

Initializes a `fd_siphash13_t` structure with given keys and default values.
- **Inputs**:
    - `sip`: A pointer to a `fd_siphash13_t` structure to initialize.
    - `k0`: The first 64-bit key used for initialization.
    - `k1`: The second 64-bit key used for initialization.
- **Logic and Control Flow**:
    - Set all bytes of the `sip` structure to zero using `memset`.
    - Assign a pointer `v` to the `v` array within the `sip` structure.
    - Copy the default initial values from `fd_siphash13_initial` into the `v` array.
    - Apply XOR operation on `v[3]` with `k1`, `v[2]` with `k0`, `v[1]` with `k1`, and `v[0]` with `k0`.
    - Return the pointer to the initialized `sip` structure.
- **Output**: Returns a pointer to the initialized `fd_siphash13_t` structure.


---
### fd\_siphash1N\_core<!-- {{#callable:fd_siphash1N_core}} -->
[View Source →](<../../../../../src/ballet/siphash13/fd_siphash13.c#L41>)

Processes a buffer of data using the SipHash algorithm by iterating over each block and applying a round function.
- **Inputs**:
    - `v`: An array of 4 unsigned long integers used as the internal state for the SipHash algorithm.
    - `buf`: A pointer to a constant unsigned char array representing the input data buffer to be processed.
    - `n`: An unsigned long integer representing the number of 8-byte blocks in the buffer to process.
- **Logic and Control Flow**:
    - Initialize a variable `m` to store each 8-byte block from the buffer.
    - Iterate over each block in the buffer using a loop that runs `n` times.
    - In each iteration, extract an 8-byte block from `buf` and store it in `m`.
    - XOR the third element of `v` with `m`.
    - Call the `FD_SIPHASH_ROUND` macro with `v` to perform a round of the SipHash algorithm.
    - XOR the first element of `v` with `m`.
- **Output**: No direct output; the function modifies the `v` array in place to update the internal state of the SipHash algorithm.


---
### fd\_siphash13\_append<!-- {{#callable:fd_siphash13_append}} -->
[View Source →](<../../../../../src/ballet/siphash13/fd_siphash13.c#L54>)

Appends data to a SipHash state, processing it in blocks and updating the hash state accordingly.
- **Inputs**:
    - `sip`: A pointer to the `fd_siphash13_t` structure representing the current state of the SipHash.
    - `data`: A pointer to the data to append to the hash state.
    - `sz`: The size of the data to append, in bytes.
- **Logic and Control Flow**:
    - Retrieve the current hash state and buffer usage from `sip`.
    - Increment the total byte count `sip->n` by `sz`.
    - If there are leftover bytes in the buffer (`buf_used` is non-zero), check if the new data can complete the current block.
    - If the new data is insufficient to complete the block, copy it to the buffer and return.
    - If the new data completes the block, copy enough bytes to complete the block, update the hash using [`fd_siphash1N_core`](<#fd_siphash1n_core>), and adjust `data` and `sz` to process remaining bytes.
    - Process the bulk of the data in 8-byte blocks using [`fd_siphash1N_core`](<#fd_siphash1n_core>).
    - Copy any remaining bytes to the buffer for future processing.
- **Output**: Returns a pointer to the updated `fd_siphash13_t` structure.
- **Functions Called**:
    - [`fd_siphash1N_core`](<#fd_siphash1n_core>)


---
### fd\_siphash13\_append\_fast<!-- {{#callable:fd_siphash13_append_fast}} -->
[View Source →](<../../../../../src/ballet/siphash13/fd_siphash13.c#L101>)

Appends data to a SipHash state and processes it in 8-byte blocks.
- **Inputs**:
    - ``sip``: A pointer to the `fd_siphash13_t` structure representing the SipHash state.
    - ``data``: A pointer to the data to append to the SipHash state.
    - ``sz``: The size of the data in bytes.
- **Logic and Control Flow**:
    - Increment the `n` field of the `sip` structure by `sz` to update the total number of bytes processed.
    - Call [`fd_siphash1N_core`](<#fd_siphash1n_core>) to process the data in 8-byte blocks, passing the `v` array from the `sip` structure, the `data` pointer, and the number of 8-byte blocks (`sz >> 3`).
    - Return the updated `sip` structure.
- **Output**: Returns a pointer to the updated `fd_siphash13_t` structure.
- **Functions Called**:
    - [`fd_siphash1N_core`](<#fd_siphash1n_core>)


---
### fd\_siphash13\_fini<!-- {{#callable:fd_siphash13_fini}} -->
[View Source →](<../../../../../src/ballet/siphash13/fd_siphash13.c#L111>)

Finalizes the SipHash-1-3 computation and returns the hash value.
- **Inputs**:
    - ``sip``: A pointer to an `fd_siphash13_t` structure containing the state of the hash computation.
- **Logic and Control Flow**:
    - Unpack the internal state from the `sip` structure, including the hash state `v`, buffer `buf`, total byte count `n`, and the number of bytes used in the buffer `buf_used`.
    - Initialize a variable `b` with the total byte count `n` shifted left by 56 bits.
    - Use a switch statement to process the remaining bytes in the buffer `buf` and update `b` accordingly, using fallthrough to handle each byte position.
    - Call [`fd_siphash1N_core`](<#fd_siphash1n_core>) to process the last block of data with the updated `b`.
    - XOR the third element of `v` with `0xff` to prepare for finalization.
    - Perform three rounds of the `FD_SIPHASH_ROUND` macro on `v` to finalize the hash computation.
    - Compute the final hash value by XORing all elements of `v` and return the result.
- **Output**: Returns the final hash value as an `ulong`.
- **Functions Called**:
    - [`fd_siphash1N_core`](<#fd_siphash1n_core>)


---
### fd\_siphash13\_hash<!-- {{#callable:fd_siphash13_hash}} -->
[View Source →](<../../../../../src/ballet/siphash13/fd_siphash13.c#L146>)

Computes a SipHash-1-3 hash for the given data using two 64-bit keys.
- **Inputs**:
    - `data`: Pointer to the input data to hash.
    - `data_sz`: Size of the input data in bytes.
    - `k0`: First 64-bit key for the hash function.
    - `k1`: Second 64-bit key for the hash function.
- **Logic and Control Flow**:
    - Initialize a 4-element array `v` with predefined constants from `fd_siphash13_initial` and modify it using the keys `k0` and `k1`.
    - Iterate over the input data in 8-byte blocks, updating the hash state `v` for each block using the `FD_SIPHASH_ROUND` macro.
    - Handle any remaining bytes (less than 8) by constructing a final block `b` and updating the hash state `v` with it.
    - Finalize the hash by performing additional rounds of `FD_SIPHASH_ROUND` and combining the elements of `v` to produce the final hash value.
- **Output**: Returns a 64-bit unsigned long integer representing the computed hash value.



---
Made with ❤️ by [Driver](https://www.driver.ai/)