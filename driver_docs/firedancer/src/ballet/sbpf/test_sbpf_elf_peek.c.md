<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for verifying SBPF ELF version handling and parsing using various configurations and binaries.

# Purpose
The code is a C program designed to test the functionality of loading and interpreting eBPF (extended Berkeley Packet Filter) programs from ELF (Executable and Linkable Format) files. It includes several test functions that verify the compatibility and versioning of different eBPF programs by using the `fd_sbpf_elf_peek` function. The program imports binary ELF files using the `FD_IMPORT_BINARY` macro and checks their compatibility with specified sBPF (Solana BPF) versions. The tests ensure that the ELF files are correctly interpreted according to the specified version constraints, such as `FD_SBPF_V0`, `FD_SBPF_V2`, and `FD_SBPF_V3`.

The program includes a strict parser test that decodes a hex representation of an ELF file and verifies its structure and content. The [`test_sbpf_elf_peek_strict_hex`](<#test_sbpf_elf_peek_strict_hex>) function checks the ELF header and program headers to ensure they conform to expected values, such as the text section offset and size. The [`main`](<#main>) function initializes the testing environment, executes the test functions, and then terminates the program. The code is structured to be part of a larger testing suite, focusing on validating the loading and versioning of eBPF programs within the Solana blockchain environment.
# Imports and Dependencies

---
- `fd_sbpf_loader.h`
- `../../util/fd_util.h`
- `../hex/fd_hex.h`


# Functions

---
### test\_sbpf\_version\_default<!-- {{#callable:test_sbpf_version_default}} -->
[View Source →](<../../../../../src/ballet/sbpf/test_sbpf_elf_peek.c#L13>)

Tests the default behavior of the SBPF version handling in ELF files using a specific configuration.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_sbpf_elf_info_t` structure `info` to store ELF information.
    - Set up `fd_sbpf_loader_config_t` structure `config` with `elf_deploy_checks` enabled and both `sbpf_min_version` and `sbpf_max_version` set to `FD_SBPF_V0`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_elf` and check if `info.sbpf_version` is `FD_SBPF_V0`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_sbpf_v2_elf` and check if `info.sbpf_version` is `FD_SBPF_V0`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_old_sbpf_v2_elf` and check if the result is negative, indicating unsupported version.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `ptoken_program_v3_elf` and check if `info.sbpf_version` is `FD_SBPF_V0`.
- **Output**: No output is returned; the function performs tests and uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>)


---
### test\_sbpf\_version\_from\_elf\_header<!-- {{#callable:test_sbpf_version_from_elf_header}} -->
[View Source →](<../../../../../src/ballet/sbpf/test_sbpf_elf_peek.c#L34>)

Tests the SBPF version of ELF headers against expected versions using a configuration with specified minimum and maximum SBPF versions.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_sbpf_elf_info_t` structure `info` to store ELF information.
    - Set up `fd_sbpf_loader_config_t` structure `config` with `elf_deploy_checks` enabled, `sbpf_min_version` set to `FD_SBPF_V0`, and `sbpf_max_version` set to `FD_SBPF_V3`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_elf` and check if `info.sbpf_version` equals `FD_SBPF_V0`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_sbpf_v2_elf` and check if `info.sbpf_version` equals `FD_SBPF_V2`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_old_sbpf_v2_elf` and check if the result is less than 0, indicating unsupported version.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `ptoken_program_v3_elf` and check if `info.sbpf_version` equals `FD_SBPF_V3`.
- **Output**: No output is returned; the function performs tests and uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>)


---
### test\_sbpf\_version\_from\_elf\_header\_with\_min<!-- {{#callable:test_sbpf_version_from_elf_header_with_min}} -->
[View Source →](<../../../../../src/ballet/sbpf/test_sbpf_elf_peek.c#L55>)

Tests the SBPF version compatibility of ELF files against a specified minimum and maximum version range.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `fd_sbpf_elf_info_t` structure `info` to store ELF information.
    - Configure `fd_sbpf_loader_config_t` with `elf_deploy_checks` set to 1, `sbpf_min_version` set to `FD_SBPF_V2`, and `sbpf_max_version` set to `FD_SBPF_V3`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_elf` and check if the result is less than 0, indicating an unsupported version.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_sbpf_v2_elf` and verify that the `sbpf_version` is `FD_SBPF_V2`.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `hello_solana_program_old_sbpf_v2_elf` and check if the result is less than 0, indicating an unsupported version.
    - Call [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) with `ptoken_program_v3_elf` and verify that the `sbpf_version` is `FD_SBPF_V3`.
- **Output**: No output is returned; the function performs assertions to validate SBPF version compatibility.
- **Functions Called**:
    - [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>)


---
### test\_sbpf\_elf\_peek\_strict\_hex<!-- {{#callable:test_sbpf_elf_peek_strict_hex}} -->
[View Source →](<../../../../../src/ballet/sbpf/test_sbpf_elf_peek.c#L77>)

Tests the strict parsing of a 64-bit little-endian ELF file in hexadecimal format for sBPF compliance.
- **Inputs**: None
- **Logic and Control Flow**:
    - Defines a static hexadecimal string representing a 64-bit little-endian ELF file with specific program headers and a single instruction.
    - Calculates the binary size from the hexadecimal string and checks if it is less than or equal to 512 bytes.
    - Decodes the hexadecimal string into a binary array using `fd_hex_decode`.
    - Initializes an `fd_sbpf_loader_config_t` structure with minimum and maximum sBPF versions set to `FD_SBPF_V0` and `FD_SBPF_V3`, respectively.
    - Calls [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>) to parse the binary ELF data and populate the `fd_sbpf_elf_info_t` structure.
    - Verifies that the parsing results match expected values for text offset, size, count, and binary size using `FD_TEST`.
- **Output**: No output is returned; the function performs internal tests and assertions.
- **Functions Called**:
    - [`fd_sbpf_elf_peek`](<fd_sbpf_loader.c.md#fd_sbpf_elf_peek>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/ballet/sbpf/test_sbpf_elf_peek.c#L128>)

Initializes the environment, runs a series of tests on SBPF ELF files, and then halts the environment.
- **Inputs**:
    - `argc`: The count of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Executes [`test_sbpf_version_default`](<#test_sbpf_version_default>) to test SBPF version handling with default settings.
    - Executes [`test_sbpf_version_from_elf_header`](<#test_sbpf_version_from_elf_header>) to test SBPF version handling based on ELF headers.
    - Executes [`test_sbpf_version_from_elf_header_with_min`](<#test_sbpf_version_from_elf_header_with_min>) to test SBPF version handling with a minimum version constraint.
    - Executes [`test_sbpf_elf_peek_strict_hex`](<#test_sbpf_elf_peek_strict_hex>) to test strict hex-based parsing of SBPF ELF files.
    - Calls `fd_halt` to terminate the environment.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_sbpf_version_default`](<#test_sbpf_version_default>)
    - [`test_sbpf_version_from_elf_header`](<#test_sbpf_version_from_elf_header>)
    - [`test_sbpf_version_from_elf_header_with_min`](<#test_sbpf_version_from_elf_header_with_min>)
    - [`test_sbpf_elf_peek_strict_hex`](<#test_sbpf_elf_peek_strict_hex>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)