<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the compute budget program, including transaction parsing and validation of compute unit limits and fees.

# Purpose
The code is a C program designed to test the functionality of a compute budget program, which is likely part of a larger system dealing with transaction processing. It imports binary transaction data from several files and uses these transactions to test the compute budget program's ability to parse and process transaction instructions. The program includes a main function that initializes a random number generator, runs a series of tests on different transactions, and checks for expected outcomes such as compute unit limits, fees, and loaded accounts data costs.

The program defines two main functions: [`test_txn`](<#test_txn>) and [`test_duplicate`](<#test_duplicate>). The [`test_txn`](<#test_txn>) function tests individual transactions by parsing them, initializing the compute budget program state, and verifying that the computed results match expected values. The [`test_duplicate`](<#test_duplicate>) function checks for the validity of different instruction sets by parsing them multiple times and ensuring that the results are consistent. The program uses macros like `FD_TEST` to assert that the results of these operations meet the expected conditions. The main function orchestrates these tests and logs the results, ensuring that the compute budget program behaves as expected under various scenarios.
# Imports and Dependencies

---
- `fd_compute_budget_program.h`


# Global Variables

---
### parsed
- **Type**: `uchar array`
- **Description**: An array of unsigned characters with a size defined by the constant `FD_TXN_MAX_SZ`. This array is used to store parsed transaction data.
- **Use**: Stores the result of parsing a transaction payload in the `test_txn` function.


# Functions

---
### test\_txn<!-- {{#callable:test_txn}} -->
[View Source →](<../../../../../src/disco/pack/test_compute_budget_program.c#L13>)

Validates a transaction's compute budget program against expected values for compute units, fees, and loaded accounts data cost.
- **Inputs**:
    - ``payload``: A pointer to the transaction data to be parsed and validated.
    - ``payload_sz``: The size of the transaction data in bytes.
    - ``builtin_instr_cnt``: The number of built-in instructions in the transaction.
    - ``expected_max_cu``: The expected maximum compute units for the transaction.
    - ``expected_fee_lamports``: The expected fee in lamports for the transaction.
    - ``expected_loaded_accounts_data_cost``: The expected cost of loaded accounts data for the transaction.
- **Logic and Control Flow**:
    - Parse the transaction from the `payload` using `fd_txn_parse` and store it in `parsed`.
    - Initialize a compute budget program state using [`fd_compute_budget_program_init`](<fd_compute_budget_program.h.md#fd_compute_budget_program_init>).
    - Iterate over each instruction in the transaction to check if it matches the compute budget program ID.
    - If a match is found, parse the instruction's data using [`fd_compute_budget_program_parse`](<fd_compute_budget_program.h.md#fd_compute_budget_program_parse>).
    - Initialize variables `rewards`, `compute`, and `loaded_accounts_data_cost` to zero.
    - Finalize the compute budget program state using [`fd_compute_budget_program_finalize`](<fd_compute_budget_program.h.md#fd_compute_budget_program_finalize>), updating `rewards`, `compute`, and `loaded_accounts_data_cost`.
    - Validate that `rewards`, `compute`, and `loaded_accounts_data_cost` match the expected values using `FD_TEST`.
- **Output**: No return value; the function performs validation checks and asserts conditions using `FD_TEST`.
- **Functions Called**:
    - [`fd_compute_budget_program_init`](<fd_compute_budget_program.h.md#fd_compute_budget_program_init>)
    - [`fd_compute_budget_program_parse`](<fd_compute_budget_program.h.md#fd_compute_budget_program_parse>)
    - [`fd_compute_budget_program_finalize`](<fd_compute_budget_program.h.md#fd_compute_budget_program_finalize>)


---
### test\_duplicate<!-- {{#callable:test_duplicate}} -->
[View Source →](<../../../../../src/disco/pack/test_compute_budget_program.c#L39>)

Validates a series of predefined instruction sets against a compute budget program state and returns whether all validations are successful.
- **Inputs**:
    - `request_units_deprecated_cnt`: The number of times to validate the `request_units_deprecated` instruction set.
    - `request_heap_frame_cnt`: The number of times to validate the `request_heap_frame` instruction set.
    - `set_compute_unit_limit_cnt`: The number of times to validate the `set_compute_unit_limit` instruction set.
    - `set_compute_unit_price_cnt`: The number of times to validate the `set_compute_unit_price` instruction set.
    - `set_max_loaded_data_cnt`: The number of times to validate the `set_max_loaded_data` instruction set.
- **Logic and Control Flow**:
    - Initialize a `fd_compute_budget_program_state_t` structure and call [`fd_compute_budget_program_init`](<fd_compute_budget_program.h.md#fd_compute_budget_program_init>) to set it up.
    - Set `all_valid` to 1, indicating that all validations are initially assumed to be successful.
    - Iterate over each instruction set count provided as input, calling [`fd_compute_budget_program_parse`](<fd_compute_budget_program.h.md#fd_compute_budget_program_parse>) for each instruction set the specified number of times.
    - For each call to [`fd_compute_budget_program_parse`](<fd_compute_budget_program.h.md#fd_compute_budget_program_parse>), update `all_valid` with the result using a bitwise AND operation.
    - Return the value of `all_valid`, which indicates whether all instruction sets were successfully validated.
- **Output**: Returns an integer indicating whether all instruction sets were successfully validated (1 for success, 0 for failure).
- **Functions Called**:
    - [`fd_compute_budget_program_init`](<fd_compute_budget_program.h.md#fd_compute_budget_program_init>)
    - [`fd_compute_budget_program_parse`](<fd_compute_budget_program.h.md#fd_compute_budget_program_parse>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/disco/pack/test_compute_budget_program.c#L67>)

Initializes the environment, tests various transactions and duplicate conditions, and logs the results before halting.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Creates a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Executes [`test_txn`](<#test_txn>) with different transaction data and parameters to validate transaction processing.
    - Copies `txn2` data to `_txn2` and modifies specific fields to test various conditions with [`test_txn`](<#test_txn>).
    - Executes [`test_duplicate`](<#test_duplicate>) with different parameters to check for duplicate conditions and validates the results using `FD_TEST`.
    - Deletes the random number generator using `fd_rng_delete` and `fd_rng_leave`.
    - Logs a notice message "pass" using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_txn`](<#test_txn>)
    - [`test_duplicate`](<#test_duplicate>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)