<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall control based on architecture and specific syscalls.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific architecture. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The code uses conditional compilation to set the `ARCH_NR` macro based on the target architecture, such as `AUDIT_ARCH_I386`, `AUDIT_ARCH_X86_64`, or `AUDIT_ARCH_AARCH64`.

The main functionality is provided by the [`populate_sock_filter_policy_fd_pack_tile`](<#populate_sock_filter_policy_fd_pack_tile>) function, which initializes a BPF filter array with 14 instructions. This filter is designed to enforce security policies by allowing or denying specific system calls. The filter checks if the architecture of the executing script matches the runtime architecture and allows only certain system calls, such as `SYS_write` and `SYS_fsync`, under specific conditions. If the conditions are not met, the filter will terminate the process using `SECCOMP_RET_KILL_PROCESS`. The function uses `fd_memcpy` to copy the filter instructions to the output buffer, ensuring that the security policy is applied correctly.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_pack\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: The `sock_filter_policy_fd_pack_tile_instr_cnt` is a constant variable that holds the number of instructions in a socket filter policy. It is set to 14, indicating the number of filter instructions used in the `populate_sock_filter_policy_fd_pack_tile` function.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_pack_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_pack\_tile<!-- {{#callable:populate_sock_filter_policy_fd_pack_tile}} -->
[View Source →](<../../../../../../src/disco/pack/generated/fd_pack_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call permissions.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 14.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor to be checked against syscall arguments for write and fsync operations.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; allow the syscall if true, otherwise jump to `RET_KILL_PROCESS`.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; allow the syscall if true, otherwise jump to `RET_KILL_PROCESS`.
    - Use `fd_memcpy` to copy the `filter` array to the `out` array.
- **Output**: The `out` array is populated with the seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)