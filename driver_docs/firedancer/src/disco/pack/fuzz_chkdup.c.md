<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Fuzz testing for duplicate checking functionality using LLVM's libFuzzer.

# Purpose
The code is a fuzz testing module designed for use with LLVM's libFuzzer. It includes two main functions: [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) and [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>). The [`LLVMFuzzerInitialize`](<#llvmfuzzerinitialize>) function sets up the environment by disabling signal handlers, initializing the application with `fd_boot`, and setting a log level that causes the program to crash on warnings. It also registers `fd_halt` to be called at program exit. The [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>) function is the core of the fuzz testing process. It processes input data to test the functionality of the `fd_chkdup` library, which appears to be related to checking for duplicate entries in lists of account addresses.

The [`LLVMFuzzerTestOneInput`](<#llvmfuzzertestoneinput>) function first checks if the input data is large enough to contain necessary metadata. It then extracts a sequence number, an index, and a split value from the input data. The function divides the remaining data into two lists of account addresses, using the split value to determine the division point. It initializes a random number generator and a `fd_chkdup` instance, which are used to perform duplicate checks on the two lists. The function compares the results of a regular check and a slow check to ensure consistency, while a fast check is performed without differential testing due to potential false positives. The module is intended to be used in a hosted environment, as indicated by the preprocessor directive checking for `FD_HAS_HOSTED`.
# Imports and Dependencies

---
- `fd_chkdup.h`
- `math.h`
- `assert.h`
- `stdio.h`
- `stdlib.h`
- `stdint.h`


# Functions

---
### LLVMFuzzerInitialize<!-- {{#callable:LLVMFuzzerInitialize}} -->
[View Source →](<../../../../../src/disco/pack/fuzz_chkdup.c#L13>)

Initializes the fuzzer environment by setting environment variables, booting the system, registering an exit function, and setting the log level.
- **Inputs**:
    - `argc`: A pointer to the argument count, typically from the command line.
    - `argv`: A pointer to the argument vector, typically from the command line.
- **Logic and Control Flow**:
    - Set the environment variable `FD_LOG_BACKTRACE` to `0` to disable backtraces in logs.
    - Call `fd_boot` with `argc` and `argv` to initialize the system.
    - Register `fd_halt` to be called on program exit using `atexit`.
    - Set the core log level to `3` using `fd_log_level_core_set`, which causes the program to crash on warning logs.
    - Return `0` to indicate successful initialization.
- **Output**: Returns `0` to indicate successful initialization.


---
### LLVMFuzzerTestOneInput<!-- {{#callable:LLVMFuzzerTestOneInput}} -->
[View Source →](<../../../../../src/disco/pack/fuzz_chkdup.c#L24>)

Processes input data to perform duplicate checking on two lists of account addresses using different methods and verifies the results.
- **Inputs**:
    - `data`: A pointer to an array of unsigned characters representing the input data.
    - `data_sz`: The size of the input data in bytes.
- **Logic and Control Flow**:
    - Calculate `metadata_size` as the sum of the sizes of `uint`, `ulong`, and `uint8_t`.
    - Check if `data_sz` is less than `metadata_size`; if true, return 0.
    - Load `seq`, `idx`, and `split` from the `data` array using `FD_LOAD`.
    - Adjust `data_sz` by subtracting `metadata_size`.
    - Calculate `total_addrs` as the number of `fd_acct_addr_t` structures in the remaining data; if zero, return 0.
    - Determine `split_index` using `split` modulo `total_addrs + 1`.
    - Divide the data into two lists, `list0` and `list1`, based on `split_index`.
    - Initialize a random number generator `rng` using `seq` and `idx`.
    - Create a duplicate checker `chkdup` using the random number generator.
    - Perform duplicate checks on the two lists using [`fd_chkdup_check`](<fd_chkdup.h.md#fd_chkdup_check>), [`fd_chkdup_check_slow`](<fd_chkdup.h.md#fd_chkdup_check_slow>), and `fd_chkdup_check_fast`.
    - Verify that the results of [`fd_chkdup_check`](<fd_chkdup.h.md#fd_chkdup_check>) and [`fd_chkdup_check_slow`](<fd_chkdup.h.md#fd_chkdup_check_slow>) are equal using `FD_TEST`.
    - Delete the duplicate checker and return 0.
- **Output**: Always returns 0 after processing the input data.
- **Functions Called**:
    - [`fd_chkdup_join`](<fd_chkdup.h.md#fd_chkdup_join>)
    - [`fd_chkdup_new`](<fd_chkdup.h.md#fd_chkdup_new>)
    - [`fd_chkdup_check`](<fd_chkdup.h.md#fd_chkdup_check>)
    - [`fd_chkdup_check_slow`](<fd_chkdup.h.md#fd_chkdup_check_slow>)
    - [`fd_chkdup_delete`](<fd_chkdup.h.md#fd_chkdup_delete>)
    - [`fd_chkdup_leave`](<fd_chkdup.h.md#fd_chkdup_leave>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)