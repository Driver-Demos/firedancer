<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for transaction packing, scheduling, and validation in the Firedancer codebase, including performance and edge case scenarios.

# Purpose
The code is a C test suite for a transaction packing system. It includes various tests to validate the functionality and performance of the transaction packing mechanism. The code is structured to test different aspects of the system, such as transaction insertion, scheduling, and validation of microblocks. It also includes performance tests to measure the efficiency of the transaction packing process under different conditions.

The code defines several constants and data structures, such as `pack_outcome_t`, to manage the state and results of the packing process. It uses functions like [`make_transaction`](<#make_transaction>), [`insert`](<#insert>), and [`schedule_validate_microblock`](<#schedule_validate_microblock>) to create transactions, insert them into the pack, and validate the scheduling of microblocks, respectively. The code also includes tests for specific scenarios, such as handling of nonce transactions, duplicate signatures, and system variable writes. Additionally, it contains performance tests to evaluate the system's behavior with varying transaction loads and configurations. The test suite is designed to ensure the correctness and efficiency of the transaction packing system.
# Imports and Dependencies

---
- `../../ballet/fd_ballet.h`
- `fd_pack.h`
- `fd_pack_cost.h`
- `fd_compute_budget_program.h`
- `../../ballet/txn/fd_txn.h`
- `../../ballet/base58/fd_base58.h`
- `../../disco/metrics/fd_metrics.h`
- `math.h`
- `../../util/tmpl/fd_smallset.c`


# Global Variables

---
### txnp\_scratch
- **Type**: ``fd_txn_p_t` array`
- **Description**: An array of `fd_txn_p_t` structures, with a size defined by the `MAX_TEST_TXNS` macro. Each element in the array represents a transaction pointer used in various transaction operations.
- **Use**: Used to store and manage transaction pointers for processing and scheduling transactions in the system.


---
### txn\_scratch
- **Type**: `uchar`
- **Description**: `txn_scratch` is a two-dimensional array of unsigned characters (`uchar`) with dimensions defined by `MAX_TEST_TXNS` and `FD_TXN_MAX_SZ`. It is used to store transaction data in a dense format for performance optimization.
- **Use**: Stores transaction data for up to `MAX_TEST_TXNS` transactions, each with a maximum size of `FD_TXN_MAX_SZ`.


---
### payload\_scratch
- **Type**: ``uchar``
- **Description**: An array of unsigned characters used to store payload data for transactions. The array is two-dimensional, with the first dimension having a size of `MAX_TEST_TXNS` and the second dimension having a size of `DUMMY_PAYLOAD_MAX_SZ`. This allows for the storage of multiple payloads, each with a maximum size defined by `DUMMY_PAYLOAD_MAX_SZ`. The `payload_scratch` array is used to temporarily hold transaction payloads during processing.
- **Use**: Stores temporary payload data for transactions in a two-dimensional array.


---
### payload\_sz
- **Type**: `ulong`
- **Description**: An array of unsigned long integers with a size defined by the constant `MAX_TEST_TXNS`. Each element in the array represents the size of a payload associated with a transaction.
- **Use**: Stores the size of each transaction payload in the `payload_scratch` array.


---
### pack\_scratch
- **Type**: `uchar[]`
- **Description**: An array of unsigned characters (`uchar`) with a size defined by `PACK_SCRATCH_SZ`, which is 400 megabytes. The array is aligned to a 128-byte boundary using the `__attribute__((aligned(128)))` directive.
- **Use**: Used as a scratch space for packing operations, ensuring data alignment and efficient memory access.


---
### pack\_verify\_scratch
- **Type**: `uchar`
- **Description**: `pack_verify_scratch` is a global array of unsigned characters (`uchar`) with a size defined by `PACK_SCRATCH_SZ`. It is aligned to a 128-byte boundary using the `__attribute__((aligned(128)))` directive.
- **Use**: Used as a scratch space for verification operations in the `fd_pack_verify` function.


---
### metrics\_scratch
- **Type**: `uchar`
- **Description**: An array of unsigned characters used as a scratch space for metrics operations.
- **Use**: Used to store temporary data for metrics operations, aligned according to `FD_METRICS_ALIGN`.


---
### SIGNATURE\_SUFFIX
- **Type**: `const char`
- **Description**: A constant character array that holds a string used as a suffix for transaction signatures.
- **Use**: Used to append a specific message to transaction signatures, indicating a fake signature for a transaction number.


---
### WORK\_PROGRAM\_ID
- **Type**: `const char`
- **Description**: Represents a constant character array with a size defined by `FD_TXN_ACCT_ADDR_SZ`. The array is initialized with the string "Work Program Id Consumes 1<<j CU".
- **Use**: Used as a program identifier in transaction processing, specifically in the `make_transaction1` function.


---
### \_rng
- **Type**: ``fd_rng_t``
- **Description**: The `_rng` variable is an array of type `fd_rng_t` with a size of 1. It is used to store a random number generator state.
- **Use**: Used to initialize and manage the state of a random number generator for the application.


---
### rng
- **Type**: `fd_rng_t *`
- **Description**: The `rng` variable is a pointer to an instance of the `fd_rng_t` type, which is used for random number generation.
- **Use**: Used to provide random number generation capabilities throughout the program.


---
### extra\_verify
- **Type**: `int`
- **Description**: The `extra_verify` variable is an integer that is declared globally.
- **Use**: It is used to determine whether additional verification should be performed in the `schedule_validate_microblock` function.


---
### outcome
- **Type**: ``pack_outcome_t``
- **Description**: The `pack_outcome_t` structure is a data type that holds the results of a transaction packing operation. It contains a count of microblocks, arrays for tracking read and write accounts in use, and an array to store the results of transactions.
- **Use**: Stores the outcome of transaction packing, including microblock count and account usage.


# Data Structures

---
### pack\_outcome
- **Type**: ``struct``
- **Members**:
    - ``microblock_cnt``: Counts the number of microblocks processed.
    - ``r_accts_in_use``: An array of read account sets in use, indexed by bank tile.
    - ``w_accts_in_use``: An array of write account sets in use, indexed by bank tile.
    - ``results``: An array storing transaction results, with a fixed size of 1024.
- **Description**: The `pack_outcome` structure is used to track the outcome of a transaction packing process. It maintains a count of microblocks processed, and arrays of read and write account sets in use, indexed by bank tile. Additionally, it stores the results of transactions in a fixed-size array. This structure is essential for managing and verifying the state of transactions during the packing process.


---
### pack\_outcome\_t
- **Type**: ``struct``
- **Members**:
    - ``microblock_cnt``: Counts the number of microblocks processed.
    - ``r_accts_in_use``: Stores read accounts in use for each bank tile.
    - ``w_accts_in_use``: Stores write accounts in use for each bank tile.
    - ``results``: Holds the results of processed transactions.
- **Description**: `pack_outcome_t` is a structure that tracks the outcome of transaction packing operations. It maintains a count of microblocks processed, and arrays of read and write accounts in use for each bank tile. Additionally, it stores the results of transactions that have been processed.


# Functions

---
### init\_all<!-- {{#callable:init_all}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L59>)

Initializes a `fd_pack_t` structure with specified parameters and prepares a `pack_outcome_t` structure for use.
- **Inputs**:
    - `pack_depth`: The depth of the pack, which determines the number of transactions that can be processed.
    - `bank_tile_cnt`: The number of bank tiles to be used in the pack.
    - `max_txn_per_microblock`: The maximum number of transactions allowed per microblock.
    - `outcome`: A pointer to a `pack_outcome_t` structure that will store the outcome of the initialization.
- **Logic and Control Flow**:
    - Defines `fd_pack_limits_t` with specific limits for cost, vote cost, write cost, data bytes, transactions per microblock, and microblocks per block.
    - Calculates the `footprint` using [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>) with the given parameters and limits.
    - Checks if the `footprint` exceeds `PACK_SCRATCH_SZ` and logs an error if it does; otherwise, logs a notice if detailed status messages are enabled.
    - Creates a new `fd_pack_t` using [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>) and joins it using [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>).
    - Initializes the `microblock_cnt` of `outcome` to 0.
    - Iterates over `FD_PACK_MAX_BANK_TILES` to set `r_accts_in_use` and `w_accts_in_use` in `outcome` to `aset_null`.
    - Returns the initialized `fd_pack_t` structure.
- **Output**: Returns a pointer to the initialized `fd_pack_t` structure.
- **Functions Called**:
    - [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>)
    - [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>)
    - [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>)


---
### make\_transaction1<!-- {{#callable:make_transaction1}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L105>)

Creates a transaction with specified parameters, including accounts to read and write, compute budget, and priority, and stores it in the provided transaction structure.
- **Inputs**:
    - ``txnp``: Pointer to the transaction structure where the transaction will be stored.
    - ``i``: Unique identifier for the transaction.
    - ``compute``: Requested compute units for the transaction.
    - ``loaded_data_sz``: Size of the account data to be loaded.
    - ``priority``: Priority level for the transaction, affecting its fee.
    - ``writes``: String of characters representing writable accounts.
    - ``reads``: String of characters representing readonly accounts.
    - ``priority_fees``: Pointer to store the calculated priority fee in lamports, if not null.
    - ``pack_cost_estimate``: Pointer to store the estimated cost for packing the transaction, if not null.
- **Logic and Control Flow**:
    - Initialize pointers `p` and `p_base` to the payload of `txnp` and set up the transaction structure `t`.
    - Set the transaction version, signature count, and offsets in the transaction structure `t`.
    - Calculate the number of programs to include and set the account address count in `t`.
    - Add the signer to the payload and increment the pointer `p`.
    - Iterate over `writes` to add writable accounts to the payload.
    - Add the compute budget and work program IDs to the payload.
    - Iterate over `reads` to add readonly accounts to the payload.
    - Set various offsets and counts in the transaction structure `t`.
    - Calculate the rewards per compute unit based on `priority` and `compute`, and add it to the payload.
    - Add instructions to the transaction structure `t` for setting compute unit price and loaded accounts data size limit.
    - Iterate over bits in `compute` to add additional instructions for each set bit.
    - Calculate the total payload size and store it in `txnp->payload_sz`.
    - Store the calculated priority fee and pack cost estimate if the respective pointers are not null.
- **Output**: The function does not return a value but modifies the transaction structure pointed to by `txnp` and optionally stores the priority fee and pack cost estimate in the provided pointers.
- **Functions Called**:
    - [`fd_pack_compute_cost`](<fd_pack_cost.h.md#fd_pack_compute_cost>)


---
### make\_transaction<!-- {{#callable:make_transaction}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L211>)

Calls [`make_transaction1`](<#make_transaction1>) to create a transaction with specified parameters and store it in `txnp_scratch`.
- **Inputs**:
    - `i`: Index in the `txnp_scratch` array where the transaction will be stored.
    - `compute`: Requested compute units for the transaction.
    - `loaded_data_sz`: Size of the account data to be loaded for the transaction.
    - `priority`: Priority level of the transaction, influencing its scheduling order.
    - `writes`: String representing accounts to be written to, with each character corresponding to an account.
    - `reads`: String representing accounts to be read from, with each character corresponding to an account.
    - `priority_fees`: Pointer to store the calculated priority fee in lamports, if non-null.
    - `pack_cost_estimate`: Pointer to store the estimated cost used by the pack when packing blocks, if non-null.
- **Logic and Control Flow**:
    - Calls [`make_transaction1`](<#make_transaction1>) with the provided parameters and the address of `txnp_scratch[i]`.
- **Output**: No return value; the function operates via side effects on `txnp_scratch` and optionally on `priority_fees` and `pack_cost_estimate`.
- **Functions Called**:
    - [`make_transaction1`](<#make_transaction1>)


---
### make\_vote\_transaction1<!-- {{#callable:make_vote_transaction1}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L223>)

Creates a vote transaction with a unique signature and writable accounts, then parses it.
- **Inputs**:
    - ``txnp``: A pointer to an `fd_txn_p_t` structure where the transaction will be stored.
    - ``i``: An unsigned long integer used to make the transaction unique.
- **Logic and Control Flow**:
    - Copies the `sample_vote` data into the transaction's payload.
    - Sets the payload size to `sample_vote_sz`.
    - Modifies specific bytes in the payload to make the signature and two writable accounts unique based on the input `i`.
    - Calls `fd_txn_parse` to parse the transaction and ensure it is valid.
- **Output**: The function does not return a value but modifies the `txnp` structure to contain a unique vote transaction.


---
### make\_vote\_transaction<!-- {{#callable:make_vote_transaction}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L237>)

Calls [`make_vote_transaction1`](<#make_vote_transaction1>) to create a vote transaction using the `txnp_scratch` array at index `i`.
- **Inputs**:
    - `i`: An unsigned long integer representing the index in the `txnp_scratch` array where the transaction will be stored.
- **Logic and Control Flow**:
    - Calls the function [`make_vote_transaction1`](<#make_vote_transaction1>) with two arguments: a pointer to `txnp_scratch[i]` and the index `i`.
- **Output**: No output is returned as the function is of type `void`.
- **Functions Called**:
    - [`make_vote_transaction1`](<#make_vote_transaction1>)


---
### make\_nonce\_transaction1<!-- {{#callable:make_nonce_transaction1}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L248>)

Creates a durable nonce transaction with specified parameters and stores it in the transaction payload.
- **Inputs**:
    - ``txnp``: Pointer to the transaction payload structure where the transaction will be stored.
    - ``i``: Index of the transaction, used in the transaction payload.
    - ``priority``: Priority of the transaction, affecting the rewards per compute unit.
    - ``nonce_acct_idx``: Index of the nonce account, used in the transaction instructions.
    - ``nonce_auth_idx``: Index of the nonce authority, used in the transaction instructions.
    - ``recent_blockhash``: Character used to fill the recent blockhash field in the transaction.
- **Logic and Control Flow**:
    - Initialize pointers `p` and `p_base` to the start of the transaction payload.
    - Set `loaded_data_sz` to 10000 and `compute` to 10001.
    - Write the transaction type, index `i`, signature suffix, and compute value into the payload.
    - Fill a section of the payload with the character 'b'.
    - Set various fields in the transaction structure `t`, including version, signature count, and account address count.
    - Add the recent blockhash to the payload, filled with the character `recent_blockhash`.
    - Add account addresses to the payload, each filled with a unique character from 'c' to 'j'.
    - Add system and compute budget program IDs to the payload.
    - Set instruction count and initialize instruction details for system and budget programs.
    - Calculate `rewards_per_cu` based on `priority` and `compute`.
    - Fill instruction data for compute budget program with compute, rewards per CU, and loaded data size.
    - Set the payload size in the transaction payload structure.
- **Output**: The function does not return a value but modifies the transaction payload and its size in the `txnp` structure.


---
### make\_nonce\_transaction<!-- {{#callable:make_nonce_transaction}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L332>)

Creates a durable nonce transaction using specified parameters and stores it in a transaction scratch space.
- **Inputs**:
    - ``i``: Index in the `txnp_scratch` array where the transaction will be stored.
    - ``priority``: Priority level of the transaction, influencing its scheduling order.
    - ``nonce_acct_idx``: Index of the nonce account, which must be in the range [0, 8).
    - ``nonce_auth_idx``: Index of the nonce authority, which must be in the range [0, 8).
    - ``recent_blockhash``: Character used to create a 32-byte repeated blockhash for the transaction.
- **Logic and Control Flow**:
    - Calls [`make_nonce_transaction1`](<#make_nonce_transaction1>) with the provided parameters and a reference to the `txnp_scratch` array at index `i`.
- **Output**: No return value; the function modifies the `txnp_scratch` array in place.
- **Functions Called**:
    - [`make_nonce_transaction1`](<#make_nonce_transaction1>)


---
### insert1<!-- {{#callable:insert1}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L341>)

Inserts a transaction into a specified slot in a transaction pack.
- **Inputs**:
    - ``txnp``: A pointer to a `fd_txn_p_t` structure representing the transaction to insert.
    - ``i``: An unsigned long integer representing the index or position in the pack where the transaction should be inserted.
    - ``pack``: A pointer to a `fd_pack_t` structure representing the transaction pack where the transaction will be inserted.
- **Logic and Control Flow**:
    - Calls [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>) with `pack` to initialize a slot for the transaction.
    - Copies the transaction data from `txnp` to the initialized slot using `memcpy`.
    - Calls [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>) with `pack`, the initialized slot, `i`, and a pointer to `_deleted` to finalize the insertion.
- **Output**: Returns an integer status code from [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>), indicating the result of the insertion operation.
- **Functions Called**:
    - [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)
    - [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)


---
### insert<!-- {{#callable:insert}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L351>)

Calls the [`insert1`](<#insert1>) function to insert a transaction from the `txnp_scratch` array into a given `fd_pack_t` structure.
- **Inputs**:
    - `i`: An index of type `ulong` that specifies which transaction from the `txnp_scratch` array to insert.
    - `pack`: A pointer to an `fd_pack_t` structure where the transaction will be inserted.
- **Logic and Control Flow**:
    - Accesses the transaction at index `i` in the `txnp_scratch` array.
    - Calls the [`insert1`](<#insert1>) function with the transaction pointer, index `i`, and the `pack` pointer.
    - Returns the result of the [`insert1`](<#insert1>) function call.
- **Output**: Returns an `int` which is the result of the [`insert1`](<#insert1>) function call.
- **Functions Called**:
    - [`insert1`](<#insert1>)


---
### schedule\_validate\_microblock<!-- {{#callable:schedule_validate_microblock}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L357>)

Validates and schedules a microblock by processing transactions, checking constraints, and updating account states.
- **Inputs**:
    - ``pack``: A pointer to the `fd_pack_t` structure representing the transaction pack.
    - ``total_cus``: The total compute units available for scheduling.
    - ``vote_fraction``: The fraction of votes to be considered during scheduling.
    - ``min_txns``: The minimum number of transactions required to be scheduled.
    - ``min_rewards``: The minimum rewards required from the scheduled transactions.
    - ``bank_tile``: The index of the bank tile for which the microblock is being scheduled.
    - ``outcome``: A pointer to the `pack_outcome_t` structure where the results of the scheduling will be stored.
- **Logic and Control Flow**:
    - Retrieve the count of available transactions before scheduling using [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>).
    - Complete the current microblock for the specified bank tile using [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>).
    - Schedule the next microblock and retrieve the count of scheduled transactions using [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>).
    - Retrieve the count of available transactions after scheduling.
    - Log the scheduling details if `DETAILED_STATUS_MESSAGES` is enabled.
    - Verify that the number of scheduled transactions meets the minimum required transactions and that the difference in available transactions matches the scheduled count.
    - Initialize total rewards and account sets for read and write operations.
    - Iterate over each scheduled transaction to process its instructions and compute rewards, updating the total rewards and account sets accordingly.
    - Verify that the total rewards meet the minimum required rewards.
    - Ensure there are no conflicts between read and write account sets.
    - Check for conflicts with microblocks on other bank tiles by ensuring no intersection between account sets.
    - Update the outcome structure with the new read and write account sets for the bank tile and increment the microblock count.
    - Perform an extra verification step if `extra_verify` is enabled.
- **Output**: The function does not return a value but updates the `outcome` structure with the results of the microblock scheduling.
- **Functions Called**:
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>)
    - [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>)
    - [`fd_compute_budget_program_init`](<fd_compute_budget_program.h.md#fd_compute_budget_program_init>)
    - [`fd_compute_budget_program_parse`](<fd_compute_budget_program.h.md#fd_compute_budget_program_parse>)
    - [`fd_compute_budget_program_finalize`](<fd_compute_budget_program.h.md#fd_compute_budget_program_finalize>)
    - [`fd_pack_bank_tile_cnt`](<fd_pack.c.md#fd_pack_bank_tile_cnt>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test0<!-- {{#callable:test0}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L454>)

Executes a series of transactions and schedules microblocks to validate transaction packing and conflict resolution.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of test 0 with `FD_LOG_NOTICE`.
    - Initializes a transaction pack with [`init_all`](<#init_all>) using specific parameters.
    - Sets up variables for transaction indices, rewards, and cost estimates.
    - Creates and inserts several transactions into the pack, updating total cost and rewards.
    - Schedules and validates a microblock with the current total cost and rewards.
    - Attempts to schedule additional microblocks, handling conflicts and resolving them.
    - Verifies the pack integrity with `FD_TEST` and [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No output; the function performs operations and validations internally.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test1<!-- {{#callable:test1}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L475>)

Executes a series of transactions and validates microblocks to test the transaction packing and scheduling system.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of 'TEST 1' using `FD_LOG_NOTICE`.
    - Initializes a transaction pack with [`init_all`](<#init_all>) using specific parameters.
    - Sets up variables for transaction indices, cost estimates, and rewards.
    - Creates two transactions with [`make_transaction`](<#make_transaction>), inserting them into the pack and updating the total cost estimate.
    - Schedules and validates two microblocks using [`schedule_validate_microblock`](<#schedule_validate_microblock>), each with one of the rewards from the transactions.
    - Verifies the integrity of the transaction pack with `FD_TEST` and [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No output; the function performs operations and validations on the transaction pack.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test2<!-- {{#callable:test2}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L489>)

Executes a series of transactions, inserts them into a pack, and validates microblocks with specific cost estimates.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of 'TEST 2'.
    - Initializes a pack with specific parameters using [`init_all`](<#init_all>).
    - Sets initial values for transaction index `i`, priority `j`, and cost estimates.
    - Creates and inserts four transactions with decreasing priority values and specific read/write accounts.
    - Accumulates the cost estimates of each transaction into `total_cost_estimate`.
    - Schedules and validates two microblocks with specific parameters, including total cost estimates and reward sums.
    - Verifies the pack using [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No return value; the function performs operations and validations on transactions and microblocks.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test\_vote<!-- {{#callable:test_vote}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L509>)

Tests the functionality of vote transactions by creating, inserting, and validating them within a transaction pack.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test with 'TEST VOTE'.
    - Initializes a transaction pack with specific parameters using [`init_all`](<#init_all>).
    - Sets up a loop to create and insert four vote transactions into the pack, updating the `pack_cost_estimate` with each transaction's cost.
    - Verifies that the pack contains four transactions using `FD_TEST` and [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>).
    - Schedules and validates microblocks with different vote fractions (0.0, 0.25, 1.0) and checks the transaction count after each scheduling.
    - Asserts that the flags of the first three outcomes are `FD_TXN_P_FLAGS_IS_SIMPLE_VOTE`.
    - Verifies the integrity of the pack using [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No output is returned; the function performs tests and assertions to validate the behavior of vote transactions.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_vote_transaction`](<#make_vote_transaction>)
    - [`fd_pack_compute_cost`](<fd_pack_cost.h.md#fd_pack_compute_cost>)
    - [`insert`](<#insert>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### txnp\_get\_signatures<!-- {{#callable:txnp_get_signatures}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L535>)

Retrieves the signatures from a transaction payload.
- **Inputs**:
    - ``txnp``: A pointer to a constant `fd_txn_p_t` structure representing the transaction from which to retrieve signatures.
- **Logic and Control Flow**:
    - Calls the `TXN` macro with `txnp` to obtain a pointer to the transaction structure.
    - Calls `fd_txn_get_signatures` with the transaction structure and the payload from `txnp` to retrieve the signatures.
- **Output**: Returns a pointer to a constant `fd_ed25519_sig_t` structure containing the signatures from the transaction payload.


---
### test\_delete<!-- {{#callable:test_delete}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L540>)

Tests the deletion of transactions from a transaction pack and verifies the correct behavior of transaction scheduling and deletion.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a transaction pack with [`init_all`](<#init_all>) and set `total_cost_estimate` to 0.
    - Create and insert six transactions into the pack, updating `total_cost_estimate` with each transaction's cost estimate.
    - Verify that the pack contains six transactions using [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>).
    - Retrieve signatures for transactions at indices 0, 2, and 4 using [`txnp_get_signatures`](<#txnp_get_signatures>).
    - Delete transactions with these signatures using [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>) and verify that they cannot be deleted again.
    - Check that the pack now contains three transactions.
    - Schedule a microblock with [`schedule_validate_microblock`](<#schedule_validate_microblock>) and verify that the pack is empty.
    - Attempt to delete transactions at indices 1, 3, and 5, which should fail as they were scheduled.
    - Verify that the pack remains empty.
    - Re-insert six new transactions, updating `total_cost_estimate` accordingly.
    - Schedule a microblock and verify that five transactions remain in the pack.
    - Adjust `total_cost_estimate` by subtracting the costs of certain transactions and attempt to delete transactions again, verifying the pack's transaction count.
    - Schedule additional microblocks to process remaining transactions and verify the pack is empty.
    - Verify the pack's integrity with [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No output is returned as this function is a static void function used for testing purposes.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`txnp_get_signatures`](<#txnp_get_signatures>)
    - [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test\_expiration<!-- {{#callable:test_expiration}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L615>)

Tests the expiration of transactions in a transaction pack and verifies the correct handling of expired transactions.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a transaction pack with [`init_all`](<#init_all>) and log the start of the test.
    - Create and insert six transactions into the pack with varying priorities and account interactions.
    - Verify that the pack contains six transactions using [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>).
    - Expire transactions with indices less than 2 using [`fd_pack_expire_before`](<fd_pack.c.md#fd_pack_expire_before>) and verify that two transactions are expired.
    - Attempt to delete an expired transaction and verify that it fails.
    - Verify that four transactions remain in the pack.
    - Schedule and validate a microblock, then verify that no transactions remain in the pack.
    - Attempt to expire transactions with indices less than 10 and verify that no transactions are expired.
    - Attempt to insert four expired transactions and verify that they are rejected.
    - Insert three new transactions and verify that three transactions are in the pack.
    - Schedule and validate microblocks, verifying the number of transactions remaining after each operation.
    - Insert 200 transactions to test the penalty treap and expire 100 of them.
    - Schedule and validate microblocks for the remaining transactions.
    - Verify the pack using [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No direct output; the function performs tests and assertions to verify transaction expiration behavior.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`fd_pack_expire_before`](<fd_pack.c.md#fd_pack_expire_before>)
    - [`txnp_get_signatures`](<#txnp_get_signatures>)
    - [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### performance\_test2<!-- {{#callable:performance_test2}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L679>)

Simulates the insertion and scheduling of a large number of minimal transactions to test the performance of the transaction packing system.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the performance test with a notice message.
    - Initializes `fd_pack_limits_t` with specific limits for the test, including maximum costs and transaction counts.
    - Creates 1024 transactions with unique fee payers and minimal data to satisfy the packing requirements.
    - Calculates the payload size for each transaction and stores it in `payload_sz`.
    - Verifies that the footprint of the pack is less than the scratch size using `FD_TEST`.
    - Defines `INNER_ROUNDS` and `OUTER_ROUNDS` for the test iterations.
    - Initializes a pack using [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>) and [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>).
    - Runs nested loops for `OUTER_ROUNDS` and `INNER_ROUNDS` to insert and schedule transactions.
    - Inserts transactions into the pack, copies payload and transaction data, and finalizes the insertion.
    - Schedules microblocks and completes them, ensuring all transactions are scheduled.
    - Logs the elapsed time for the test and calculates the time per transaction.
    - Ends the block for the pack after each outer round.
    - Verifies the pack using [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>) to ensure no errors occurred.
- **Output**: No output is returned as the function is `void`, but it logs performance metrics and verifies the pack.
- **Functions Called**:
    - [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>)
    - [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>)
    - [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>)
    - [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)
    - [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)
    - [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>)
    - [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>)
    - [`fd_pack_end_block`](<fd_pack.c.md#fd_pack_end_block>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### performance\_test<!-- {{#callable:performance_test}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L762>)

Conducts a performance test by creating transactions, inserting them into a workspace, and measuring various performance metrics under different conditions.
- **Inputs**:
    - `extra_bench`: An integer flag that determines whether to perform additional benchmarking, affecting the maximum heap size and linear increment values.
- **Logic and Control Flow**:
    - Logs the start of the performance test.
    - Creates two transactions with specific parameters and stores their costs in `tx1_cost` and `tx2_cost`.
    - Copies transaction data to dense arrays for efficient access.
    - Creates an anonymous workspace with a specified size.
    - Determines `max_heap_sz` and `linear_inc` based on the `extra_bench` flag and workspace availability.
    - Logs the column headers for performance metrics.
    - Iterates over different heap sizes, doubling or incrementing by `linear_inc` each time, up to `max_heap_sz`.
    - For each heap size, calculates the footprint and allocates memory in the workspace or uses a scratch space if the workspace is unavailable.
    - Initializes timing variables for different operations (preinsert, insert, end_block, skip0, skip1, skip2, schedule).
    - Performs a series of iterations to warm up and measure performance, including inserting transactions, scheduling microblocks, and completing microblocks.
    - Logs the performance metrics for each heap size.
    - Frees the allocated memory in the workspace if it was used.
    - Deletes the anonymous workspace if it was created.
- **Output**: No return value; the function logs performance metrics to the console.
- **Functions Called**:
    - [`make_transaction`](<#make_transaction>)
    - [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>)
    - [`fd_pack_align`](<fd_pack.h.md#fd_pack_align>)
    - [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>)
    - [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)
    - [`fd_pack_insert_txn_cancel`](<fd_pack.c.md#fd_pack_insert_txn_cancel>)
    - [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)
    - [`fd_pack_end_block`](<fd_pack.c.md#fd_pack_end_block>)
    - [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>)
    - [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>)


---
### performance\_end\_block<!-- {{#callable:performance_end_block}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L947>)

Measures the performance of ending a block in a transaction packing system by simulating various writer counts and logging the time taken.
- **Inputs**:
    - `void`: No input parameters.
- **Logic and Control Flow**:
    - Creates a new anonymous workspace using `fd_wksp_new_anonymous` with specified parameters.
    - Checks if the workspace creation was successful; if not, logs a notice and exits the function.
    - Logs the start of the performance test for ending a block.
    - Defines transaction packing limits in a `fd_pack_limits_t` structure.
    - Calculates the memory footprint required for the pack using [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>).
    - Allocates memory for the pack using `fd_wksp_alloc_laddr`.
    - Creates a transaction using [`make_transaction`](<#make_transaction>) and copies it to scratch buffers.
    - Logs the header for the performance results table.
    - Joins a new pack using [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>) and [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>).
    - Iterates over a range of writer counts, doubling each time, to simulate different scenarios.
    - For each writer count, iterates a set number of times to simulate multiple transactions.
    - Within each iteration, modifies the transaction payload to ensure uniqueness.
    - Inserts the transaction into the pack using [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>) and [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>).
    - Schedules and completes microblocks until no transactions are available using [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>) and [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>).
    - Measures the time taken to end a block using [`fd_pack_end_block`](<fd_pack.c.md#fd_pack_end_block>) and logs the result.
    - Frees the allocated memory and deletes the workspace.
- **Output**: Logs the time taken to end a block for different writer counts in milliseconds per call.
- **Functions Called**:
    - [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>)
    - [`fd_pack_align`](<fd_pack.h.md#fd_pack_align>)
    - [`make_transaction`](<#make_transaction>)
    - [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>)
    - [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>)
    - [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)
    - [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>)
    - [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>)
    - [`fd_pack_end_block`](<fd_pack.c.md#fd_pack_end_block>)


---
### heap\_overflow\_test<!-- {{#callable:heap_overflow_test}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1012>)

Tests the behavior of a transaction pack when subjected to a heap overflow scenario by inserting low and high priority transactions and validating their scheduling.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the heap overflow test with `FD_LOG_NOTICE`.
    - Initializes a transaction pack with [`init_all`](<#init_all>) using specific parameters.
    - Inserts 1024 low-priority transactions into the pack using a loop and [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>) and [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>).
    - Asserts that the pack contains 1024 transactions using `FD_TEST`.
    - Inserts 1024 high-priority transactions, which probabilistically replace the low-priority ones due to conflicts, using a loop and [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>) and [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>).
    - Asserts again that the pack contains 1024 transactions using `FD_TEST`.
    - Schedules microblocks with [`schedule_validate_microblock`](<#schedule_validate_microblock>) in a loop, ensuring that only one transaction fits due to a constraint of 30000 compute units.
    - Asserts that the pack is empty after scheduling using `FD_TEST`.
    - Verifies the pack's integrity with [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>) and asserts the result using `FD_TEST`.
- **Output**: No output is returned from this function.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)
    - [`make_transaction1`](<#make_transaction1>)
    - [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test\_gap<!-- {{#callable:test_gap}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1046>)

Tests the behavior of transaction scheduling and validation with varying gaps between bank tiles.
- **Inputs**:
    - `void`: No input parameters.
- **Logic and Control Flow**:
    - Logs the start of the test with 'TEST GAP'.
    - Iterates over a range of gaps from 1 to `FD_PACK_MAX_BANK_TILES`.
    - For each gap, initializes a `fd_pack_t` structure with [`init_all`](<#init_all>) using a depth of 10240, the current gap, and 2 transactions per microblock.
    - Creates two transactions with [`make_transaction`](<#make_transaction>), inserting them into the pack.
    - Verifies the pack with [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>) to ensure it is in a valid state.
    - Schedules a microblock with [`schedule_validate_microblock`](<#schedule_validate_microblock>), allowing only one transaction to fit due to a limit of 12000 CUs.
    - Iterates over the range from 1 to the current gap, scheduling microblocks with no transactions to simulate the gap.
    - Checks that only one transaction is available in the pack with [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>).
    - Schedules another microblock to fit the second transaction.
    - Verifies the pack again to ensure it is still in a valid state.
- **Output**: No return value.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)


---
### test\_limits<!-- {{#callable:test_limits}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1070>)

Tests various limits and constraints on transaction processing in a blockchain system.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test with `FD_LOG_NOTICE`.
    - Initializes a rebate sum and a report structure for transaction rebates.
    - Tests the maximum transactions per microblock by iterating over a range of maximum values, creating and inserting non-conflicting vote transactions, and validating the microblock schedule.
    - Tests the compute unit (CU) limit by initializing a pack, inserting non-conflicting vote transactions, and gradually increasing the CU limit to validate the correct number of votes scheduled.
    - Tests the block vote limit by inserting vote transactions, scheduling microblocks, and checking the expected number of votes based on consumed costs.
    - Tests the block writer limit by inserting transactions with estimated costs, scheduling microblocks, and checking if transactions fit within the write cost per account limit.
    - Tests the total cost block limit by inserting transactions in batches, scheduling microblocks, and checking if additional transactions fit within the total cost limit.
    - Tests the data size limit by inserting transactions with specific payload sizes, scheduling microblocks, and checking the remaining transaction count.
- **Output**: No output is returned; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_pack_rebate_sum_new`](<fd_pack_rebate_sum.c.md#fd_pack_rebate_sum_new>)
    - [`init_all`](<#init_all>)
    - [`make_vote_transaction`](<#make_vote_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`schedule_validate_microblock`](<#schedule_validate_microblock>)
    - [`fd_pack_end_block`](<fd_pack.c.md#fd_pack_end_block>)
    - [`make_transaction`](<#make_transaction>)
    - [`fd_pack_rebate_sum_add_txn`](<fd_pack_rebate_sum.c.md#fd_pack_rebate_sum_add_txn>)
    - [`fd_pack_rebate_sum_report`](<fd_pack_rebate_sum.c.md#fd_pack_rebate_sum_report>)
    - [`fd_pack_rebate_cus`](<fd_pack.c.md#fd_pack_rebate_cus>)


---
### test\_vote\_qos<!-- {{#callable:test_vote_qos}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1256>)

Tests the Quality of Service (QoS) rules for vote and non-vote transactions in a transaction pack.
- **Inputs**:
    - `void`: No input parameters.
- **Logic and Control Flow**:
    - Logs the start of the test with the message 'TEST VOTE QOS'.
    - Initializes a transaction pack with a depth of 16, 1 bank tile, and a maximum of 128 transactions per microblock.
    - Fills the pack with 16 vote transactions, ensuring each insertion is accepted as a vote add.
    - Attempts to insert non-vote transactions, which are accepted due to an imbalanced treap, until the treap becomes balanced.
    - Inserts a non-vote transaction that is rejected due to priority comparison with other non-votes.
    - Replaces initial non-votes with more lucrative non-vote transactions, maintaining 12 pending votes.
    - Attempts to delete transactions from the pack, ensuring they are not deleted.
    - Replaces 8 votes with non-votes, maintaining exactly 25% votes, which is allowed by QoS rules.
    - Attempts to insert another non-vote transaction, which is rejected due to low vote percentage.
    - Verifies the pack to ensure it is in a consistent state.
- **Output**: No output is returned.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_vote_transaction`](<#make_vote_transaction>)
    - [`insert`](<#insert>)
    - [`make_transaction`](<#make_transaction>)
    - [`txnp_get_signatures`](<#txnp_get_signatures>)
    - [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test\_reject\_writes\_to\_sysvars<!-- {{#callable:test_reject_writes_to_sysvars}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1304>)

Tests if transactions that attempt to write to system variables are correctly rejected.
- **Inputs**:
    - `void`: No input parameters.
- **Logic and Control Flow**:
    - Logs a notice with the message 'TEST SYSVARS'.
    - Initializes a `fd_pack_t` object using [`init_all`](<#init_all>) with specific parameters.
    - Defines an array `sysvars` containing 31 system variable names.
    - Iterates over each system variable name in `sysvars`.
    - For each system variable, creates a transaction using [`make_transaction`](<#make_transaction>).
    - Replaces a part of the transaction payload with the system variable name using `fd_base58_decode_32`.
    - Modifies the transaction payload to ensure it is not the compute budget program.
    - Inserts the transaction into the pack and checks if it is rejected with `FD_PACK_INSERT_REJECT_WRITES_SYSVAR`.
    - Verifies that no transactions are available in the pack after each insertion attempt.
- **Output**: No output is returned, but the function performs assertions to ensure transactions are rejected as expected.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)


---
### test\_reject<!-- {{#callable:test_reject}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1358>)

Logs a notice message and tests various transaction rejection scenarios in a transaction pack.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the message 'TEST REJECT' using `FD_LOG_NOTICE`.
    - Initializes a transaction pack with [`init_all`](<#init_all>) using specific parameters.
    - Creates a transaction with [`make_transaction`](<#make_transaction>) and modifies its payload to simulate an estimation failure, then tests insertion with [`insert`](<#insert>) expecting a rejection due to estimation failure.
    - Increments the transaction index and creates another transaction with specific parameters, modifies its address table counts to exceed limits, and tests insertion expecting a rejection due to account count limits.
    - Increments the transaction index again, creates a transaction with duplicate accounts, and tests insertion expecting a rejection due to duplicate accounts.
    - Clears the transaction payloads in `txnp_scratch` for all tested transactions.
- **Output**: No output is returned from this function.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)


---
### test\_duplicate\_sig<!-- {{#callable:test_duplicate_sig}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1385>)

Tests the handling of duplicate transaction signatures in a transaction pack.
- **Inputs**:
    - `void`: No input parameters.
- **Logic and Control Flow**:
    - Logs the start of the test with `FD_LOG_NOTICE`.
    - Initializes a transaction pack with [`init_all`](<#init_all>) using specific parameters.
    - Creates a transaction with [`make_transaction`](<#make_transaction>) and inserts it into the pack multiple times using [`insert`](<#insert>).
    - Verifies that the transaction count in the pack is as expected using `FD_TEST` and [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>).
    - Retrieves the signature of the first transaction using [`txnp_get_signatures`](<#txnp_get_signatures>).
    - Deletes the transaction using [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>) and verifies the deletion with `FD_TEST`.
    - Re-inserts the transaction and duplicates it in the scratch space.
    - Increments the transaction index and inserts a new transaction with an expiration time.
    - Verifies the transaction count and expiration behavior using [`fd_pack_expire_before`](<fd_pack.c.md#fd_pack_expire_before>).
    - Deletes the transaction again and verifies the pack's state with `FD_TEST`.
    - Verifies the pack's integrity using [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
- **Output**: No return value; the function performs tests and assertions.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_transaction`](<#make_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`txnp_get_signatures`](<#txnp_get_signatures>)
    - [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)
    - [`fd_pack_expire_before`](<fd_pack.c.md#fd_pack_expire_before>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test\_nonce<!-- {{#callable:test_nonce}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1416>)

Tests the handling of duplicate nonces in transactions by inserting various nonce transactions into a pack and verifying the expected outcomes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test with the message 'TEST DUPLICATE NONCE'.
    - Initializes a pack with specific parameters using [`init_all`](<#init_all>).
    - Sets a counter `i` to 0 for transaction indexing.
    - Creates and inserts a nonce transaction with specific parameters and checks if it is accepted with `FD_PACK_INSERT_ACCEPT_NONCE_NONVOTE_ADD`.
    - Attempts to insert another nonce transaction with the same parameters but lower priority and checks if it is rejected with `FD_PACK_INSERT_REJECT_NONCE_PRIORITY`.
    - Inserts a nonce transaction with the same parameters but higher priority and checks if it replaces the previous one with `FD_PACK_INSERT_ACCEPT_NONCE_NONVOTE_REPLACE`.
    - Creates and inserts nonce transactions with different parameters to ensure they are treated as different nonces and checks if they are accepted.
    - Attempts to insert a nonce transaction with invalid parameters and checks if it is rejected with `FD_PACK_INSERT_REJECT_INVALID_NONCE`.
    - Verifies the pack using [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>) to ensure no errors.
- **Output**: No output is returned from this function as it is a test function that logs results and performs assertions.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`make_nonce_transaction`](<#make_nonce_transaction>)
    - [`insert`](<#insert>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)


---
### test\_bundle\_nonce\_conflict\_detect<!-- {{#callable:test_bundle_nonce_conflict_detect}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1434>)

Detects nonce conflicts in a bundle of transactions and verifies the handling of such conflicts.
- **Inputs**:
    - ``pack``: A pointer to an `fd_pack_t` structure representing the transaction pack.
    - ``txn_cnt``: The total number of transactions in the bundle.
    - ``dup_idx_0``: The index of the first transaction in the bundle that is a duplicate.
    - ``dup_idx_1``: The index of the second transaction in the bundle that is a duplicate.
- **Logic and Control Flow**:
    - Verify that `txn_cnt` is greater than 1, `dup_idx_0` and `dup_idx_1` are different, and both are less than `txn_cnt`.
    - Swap `dup_idx_0` and `dup_idx_1` if `dup_idx_0` is greater than `dup_idx_1`.
    - Ensure that the available transaction count in `pack` is zero.
    - Initialize a bundle of transactions with `txn_cnt` transactions, all as nonce transactions.
    - Create nonce transactions for each index in the bundle, with duplicates at `dup_idx_0` and `dup_idx_1`.
    - Finalize the bundle insertion and check for a nonce conflict rejection result.
    - Repeat the process with non-nonce transactions and verify the same rejection result.
    - Modify one of the duplicate transactions to ensure no false positive conflict and verify acceptance.
- **Output**: No return value; the function uses assertions to verify expected behavior.
- **Functions Called**:
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`fd_pack_insert_bundle_init`](<fd_pack.c.md#fd_pack_insert_bundle_init>)
    - [`make_nonce_transaction1`](<#make_nonce_transaction1>)
    - [`fd_pack_insert_bundle_fini`](<fd_pack.c.md#fd_pack_insert_bundle_fini>)
    - [`make_vote_transaction1`](<#make_vote_transaction1>)
    - [`txnp_get_signatures`](<#txnp_get_signatures>)
    - [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)


---
### test\_bundle\_nonce<!-- {{#callable:test_bundle_nonce}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1480>)

Tests the handling of nonce transactions in a transaction pack, including insertion, scheduling, and conflict detection.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a transaction pack with a depth of 32 using [`init_all`](<#init_all>) and set it ready for bundles with [`fd_pack_set_initializer_bundles_ready`](<fd_pack.c.md#fd_pack_set_initializer_bundles_ready>).
    - Verify the pack is in a valid state using `FD_TEST` and [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>).
    - Insert a bundle of nonce transactions and verify the insertion result and transaction count.
    - Attempt to insert a bundle with a duplicate nonce and verify it is rejected due to nonce priority.
    - Attempt to insert a transaction with a duplicate nonce and verify it is rejected due to nonce priority.
    - Schedule transactions and verify the scheduled transaction count and flags.
    - Insert a new transaction after scheduling and verify it is accepted.
    - Insert a bundle to displace existing nonce transactions and verify the result and transaction count.
    - Delete a transaction from a bundle and verify all related transactions are removed.
    - Attempt to insert a bundle with duplicate nonces and verify it is rejected due to nonce conflict.
    - Insert transactions to fill the pack and then insert a bundle to replace them, verifying the result and transaction count.
    - Schedule and complete microblocks to clear the pack and verify the state.
    - Test the [`fd_pack_clear_all`](<fd_pack.c.md#fd_pack_clear_all>) function to clear all transactions and verify the state.
    - Test custom nonce conflict detection by generating all possible conflicts and verifying the results.
    - Delete the transaction pack using [`fd_pack_delete`](<fd_pack.c.md#fd_pack_delete>).
- **Output**: No output is returned as this function is a test function that uses assertions to verify behavior.
- **Functions Called**:
    - [`init_all`](<#init_all>)
    - [`fd_pack_set_initializer_bundles_ready`](<fd_pack.c.md#fd_pack_set_initializer_bundles_ready>)
    - [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)
    - [`fd_pack_insert_bundle_init`](<fd_pack.c.md#fd_pack_insert_bundle_init>)
    - [`make_nonce_transaction1`](<#make_nonce_transaction1>)
    - [`fd_pack_insert_bundle_fini`](<fd_pack.c.md#fd_pack_insert_bundle_fini>)
    - [`fd_pack_avail_txn_cnt`](<fd_pack.h.md#fd_pack_avail_txn_cnt>)
    - [`make_vote_transaction1`](<#make_vote_transaction1>)
    - [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)
    - [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)
    - [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>)
    - [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>)
    - [`txnp_get_signatures`](<#txnp_get_signatures>)
    - [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)
    - [`fd_pack_clear_all`](<fd_pack.c.md#fd_pack_clear_all>)
    - [`test_bundle_nonce_conflict_detect`](<#test_bundle_nonce_conflict_detect>)
    - [`fd_pack_delete`](<fd_pack.c.md#fd_pack_delete>)
    - [`fd_pack_leave`](<fd_pack.c.md#fd_pack_leave>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/disco/pack/test_pack.c#L1609>)

Initializes the environment, runs a series of tests, and performs cleanup operations.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Call `fd_boot` to initialize the environment with `argc` and `argv`.
    - Create a new random number generator with `fd_rng_new` and join it with `fd_rng_join`.
    - Register metrics using `fd_metrics_register`.
    - Check for the presence of `--extra-bench` and `--extra-verify` in the command-line arguments and set `extra_benchmark` and `extra_verify` accordingly.
    - Execute a series of test functions: [`test0`](<#test0>), [`test1`](<#test1>), [`test2`](<#test2>), [`test_vote`](<#test_vote>), [`heap_overflow_test`](<#heap_overflow_test>), [`test_delete`](<#test_delete>), [`test_expiration`](<#test_expiration>), [`test_gap`](<#test_gap>), [`test_limits`](<#test_limits>), [`test_reject_writes_to_sysvars`](<#test_reject_writes_to_sysvars>), [`test_reject`](<#test_reject>), [`test_duplicate_sig`](<#test_duplicate_sig>), [`test_nonce`](<#test_nonce>), [`test_bundle_nonce`](<#test_bundle_nonce>).
    - Optionally execute [`test_vote_qos`](<#test_vote_qos>) if the condition is met.
    - Run performance tests [`performance_test`](<#performance_test>), [`performance_test2`](<#performance_test2>), and [`performance_end_block`](<#performance_end_block>).
    - Delete the random number generator with `fd_rng_delete` and leave it with `fd_rng_leave`.
    - Log a notice indicating the tests passed with `FD_LOG_NOTICE`.
    - Call `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test0`](<#test0>)
    - [`test1`](<#test1>)
    - [`test2`](<#test2>)
    - [`test_vote`](<#test_vote>)
    - [`heap_overflow_test`](<#heap_overflow_test>)
    - [`test_delete`](<#test_delete>)
    - [`test_expiration`](<#test_expiration>)
    - [`test_gap`](<#test_gap>)
    - [`test_limits`](<#test_limits>)
    - [`test_vote_qos`](<#test_vote_qos>)
    - [`test_reject_writes_to_sysvars`](<#test_reject_writes_to_sysvars>)
    - [`test_reject`](<#test_reject>)
    - [`test_duplicate_sig`](<#test_duplicate_sig>)
    - [`test_nonce`](<#test_nonce>)
    - [`test_bundle_nonce`](<#test_bundle_nonce>)
    - [`performance_test`](<#performance_test>)
    - [`performance_test2`](<#performance_test2>)
    - [`performance_end_block`](<#performance_end_block>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)