<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines methods for prioritizing and ordering Solana transactions to maximize validator profitability.

# Purpose
The code is a C header file that defines the interface for a module responsible for managing and scheduling Solana transactions to optimize the profitability of a validator. The module, referred to as `fd_pack`, provides functionality to prioritize, select, and order transactions, ensuring they adhere to specific constraints and limits imposed by the Solana network and the Firedancer implementation. The header file includes definitions for constants, data structures, and function prototypes that facilitate the creation, management, and execution of transaction bundles and microblocks.

Key components of the module include the `fd_pack_limits_t` structure, which encapsulates various constraints such as maximum cost per block and maximum transactions per microblock. The module also defines several functions for initializing and managing transaction packs, inserting transactions and bundles, scheduling microblocks, and handling transaction expiration and deletion. The module supports advanced features like initializer bundles, which help prepare on-chain state for transaction execution. Additionally, the module provides mechanisms for adjusting compute unit accounting and resetting state between blocks. The header file is intended to be included in other C source files that require transaction scheduling capabilities, and it defines a public API for interacting with the `fd_pack` module.
# Imports and Dependencies

---
- `../../ballet/fd_ballet_base.h`
- `../../ballet/txn/fd_txn.h`
- `../shred/fd_shred_batch.h`
- `fd_est_tbl.h`
- `fd_microblock.h`
- `fd_pack_rebate_sum.h`


# Data Structures

---
### fd\_pack\_limits
- **Type**: ``struct``
- **Members**:
    - ``max_cost_per_block``: Defines the maximum cost units a block can consume.
    - ``max_vote_cost_per_block``: Specifies the maximum cost units for vote transactions in a block.
    - ``max_write_cost_per_acct``: Limits the cost units for transactions writing to a single account in a block.
    - ``max_data_bytes_per_block``: Sets the maximum data bytes allowed in a block, including headers.
    - ``max_txn_per_microblock``: Determines the maximum number of transactions in a microblock.
    - ``max_microblocks_per_block``: Specifies the maximum number of non-empty microblocks in a block.
- **Description**: Defines consensus-critical and implementation limits for blocks and microblocks in the Firedancer system, ensuring that blocks do not exceed specified cost units, data bytes, and transaction counts, which helps manage memory consumption and maintain system stability.


---
### fd\_pack\_limits\_t
- **Type**: ``struct``
- **Members**:
    - `max_cost_per_block`: Maximum cost units allowed per block.
    - `max_vote_cost_per_block`: Maximum cost units allowed for vote transactions per block.
    - `max_write_cost_per_acct`: Maximum cost units allowed for transactions writing to a single account per block.
    - `max_data_bytes_per_block`: Maximum data bytes allowed per block, derived from shred limits.
    - `max_txn_per_microblock`: Maximum transactions allowed per microblock.
    - `max_microblocks_per_block`: Maximum non-empty microblocks allowed per block.
- **Description**: Groups several consensus-critical and implementation-specific limits for Solana transaction packing, ensuring that blocks do not exceed predefined cost, data, and transaction limits.


---
### fd\_pack\_t
- **Type**: ``fd_pack_t``
- **Members**:
    - ``fd_pack_private``: An opaque structure used to define `fd_pack_t`.
- **Description**: `fd_pack_t` is a typedef for a forward-declared opaque structure `fd_pack_private`, which is used in the context of managing Solana transactions. The structure is part of a system that prioritizes, selects, and orders transactions to maximize validator profitability. The details of `fd_pack_private` are not exposed, making `fd_pack_t` an opaque handle for operations related to transaction scheduling and management.


# Functions

---
### fd\_pack\_align<!-- {{#callable:fd_pack_align}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L128>)

Returns the alignment requirement for a memory region to be used as a pack object.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the constant value `FD_PACK_ALIGN`, which is defined as `128UL`.
- **Output**: An unsigned long integer representing the alignment requirement, specifically `128UL`.


---
### fd\_pack\_avail\_txn\_cnt<!-- {{#callable:fd_pack_avail_txn_cnt}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L167>)

Returns the number of transactions available to schedule in a pack object that have not yet been scheduled.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` structure representing the pack object.
- **Logic and Control Flow**:
    - Calculate the memory address by adding the offset `FD_PACK_PENDING_TXN_CNT_OFF` to the base address of `pack`.
    - Cast the calculated address to a pointer to `ulong const`.
    - Dereference the pointer to obtain the number of available transactions.
- **Output**: The function returns an `ulong` representing the number of transactions available to schedule.


# Function Declarations (Public API)

---
### fd\_pack\_footprint<!-- {{#callable_declaration:fd_pack_footprint}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L130>)

Calculates the memory footprint for a pack object.
- **Description**: Use this function to determine the memory size required to store a pack object with specified parameters. It is important to ensure that `pack_depth` is at least 4 and `bank_tile_cnt` is within the range [1, FD_PACK_MAX_BANK_TILES]. If `bank_tile_cnt` is 0 or exceeds `FD_PACK_MAX_BANK_TILES`, or if `pack_depth` is less than 4, the function returns 0, indicating an invalid configuration. This function does not modify any input parameters and is safe to call multiple times with the same or different parameters.
- **Inputs**:
    - `pack_depth`: Specifies the maximum number of pending transactions the pack can store. Must be at least 4.
    - `bundle_meta_sz`: Defines the size of the metadata region reserved for each bundle. If non-zero, bundle-related functions can be used.
    - `bank_tile_cnt`: Indicates the number of bank tiles available for scheduling transactions. Must be in the range [1, FD_PACK_MAX_BANK_TILES]. If outside this range, the function returns 0.
    - `limits`: A pointer to a `fd_pack_limits_t` structure that sets various limits for blocks and microblocks. Must not be null.
- **Output**: Returns the required memory footprint in bytes for the pack object, or 0 if the input parameters are invalid.
- **See Also**: [`fd_pack_footprint`](<fd_pack.c.md#fd_pack_footprint>)  (Implementation)


---
### fd\_pack\_new<!-- {{#callable_declaration:fd_pack_new}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L147>)

Formats memory for use as a pack object.
- **Description**: Use this function to initialize a memory region for a pack object, which is used to manage and schedule Solana transactions. Ensure the memory region is non-null, properly aligned, and has the required footprint. The function requires parameters to define the pack's depth, bundle metadata size, bank tile count, and operational limits. A random number generator is also needed for internal operations. On success, the function returns the formatted memory region; on failure, it returns null and logs details. The caller is not joined to the pack object upon return.
- **Inputs**:
    - `mem`: A non-null pointer to a memory region with the required alignment and footprint. The caller retains ownership.
    - `pack_depth`: An unsigned long specifying the maximum number of pending transactions. Must be at least 4.
    - `bundle_meta_sz`: An unsigned long specifying the size of metadata for each bundle. If non-zero, bundle-related functions can be used.
    - `bank_tile_cnt`: An unsigned long specifying the number of bank tiles for transaction scheduling. Must be between 1 and FD_PACK_MAX_BANK_TILES.
    - `limits`: A pointer to a constant `fd_pack_limits_t` structure defining various operational limits. Must not be null.
    - `rng`: A pointer to a `fd_rng_t` random number generator for internal use. Must not be null.
- **Output**: Returns the `mem` pointer formatted as a pack object on success, or null on failure.
- **See Also**: [`fd_pack_new`](<fd_pack.c.md#fd_pack_new>)  (Implementation)


---
### fd\_pack\_join<!-- {{#callable_declaration:fd_pack_join}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L156>)

Joins the caller to a pack object.
- **Description**: Use this function to join a caller to a pack object that has been previously initialized. This function must be called before performing any operations on the pack object. Ensure that every successful call to this function is matched with a corresponding call to leave the pack object. This function returns a pointer to the pack object, allowing the caller to interact with it.
- **Inputs**:
    - `mem`: A non-null pointer to a memory region that has been formatted as a pack object. The memory must have the required alignment and footprint as specified by the pack object requirements. If the memory is not properly formatted, the behavior is undefined.
- **Output**: Returns a pointer to the joined pack object, allowing further operations on it.
- **See Also**: [`fd_pack_join`](<fd_pack.c.md#fd_pack_join>)  (Implementation)


---
### fd\_pack\_current\_block\_cost<!-- {{#callable_declaration:fd_pack_current_block_cost}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L178>)

Returns the current block's cumulative cost in compute units.
- **Description**: Use this function to obtain the number of compute units (CUs) that have been scheduled in the current block, adjusted for any rebates. This value can help monitor the block's resource usage and ensure it does not exceed the maximum allowed cost per block. The function should be called on a valid local join of a `fd_pack_t` object. The returned value is expected to be between 0 and the maximum cost per block, although it may temporarily exceed this due to cost model adjustments.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join, and it must not be null.
- **Output**: The function returns an unsigned long integer representing the cumulative compute units scheduled in the current block, net of any rebates.
- **See Also**: [`fd_pack_current_block_cost`](<fd_pack.c.md#fd_pack_current_block_cost>)  (Implementation)


---
### fd\_pack\_bank\_tile\_cnt<!-- {{#callable_declaration:fd_pack_bank_tile_cnt}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L184>)

Returns the number of bank tiles configured for transaction scheduling.
- **Description**: Use this function to obtain the number of bank tiles that were set during the initialization of the pack object. This value is crucial for understanding the distribution of transactions across bank tiles. Ensure that the pack object is a valid local join before calling this function. The function will return a value within the range of 1 to `FD_PACK_MAX_BANK_TILES`, as specified during the pack object's creation.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join of a pack object. The function does not modify the pack object.
- **Output**: The function returns an unsigned long integer representing the number of bank tiles configured for the pack object, within the range [1, FD_PACK_MAX_BANK_TILES].
- **See Also**: [`fd_pack_bank_tile_cnt`](<fd_pack.c.md#fd_pack_bank_tile_cnt>)  (Implementation)


---
### fd\_pack\_set\_block\_limits<!-- {{#callable_declaration:fd_pack_set_block_limits}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L206>)

Updates block limits for a pack object.
- **Description**: Use this function to update the block limits of a pack object with new values. This function should typically be called immediately after ending a block with `fd_pack_end_block`. If called after some microblocks have been produced for the current block and the block already exceeds the new limits, all remaining microblocks will be empty, but the call is still valid. The pack object must be a valid local join when calling this function.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join. The caller retains ownership.
    - `limits`: A pointer to a `fd_pack_limits_t` structure containing the new block limits. The structure must not be null and must contain valid limit values as per the constraints defined in `fd_pack_limits_t`.
- **Output**: None
- **See Also**: [`fd_pack_set_block_limits`](<fd_pack.c.md#fd_pack_set_block_limits>)  (Implementation)


---
### fd\_pack\_insert\_txn\_init<!-- {{#callable_declaration:fd_pack_insert_txn_init}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L336>)

Acquires a transaction element from the transaction pool.
- **Description**: Use this function to obtain a transaction element from the transaction pool associated with the given pack object. This function is typically called when you need to initialize a new transaction for insertion into the pack. Ensure that the pack object is a valid local join before calling this function. The function does not fail from the caller's perspective, but the returned transaction element must be managed according to the pack's transaction lifecycle rules.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object representing the pack from which to acquire a transaction element. Must be a valid local join. The caller retains ownership and responsibility for ensuring the pack is properly initialized and joined.
- **Output**: A pointer to an `fd_txn_e_t` structure representing the acquired transaction element. The caller is responsible for managing this element according to the pack's transaction lifecycle rules.
- **See Also**: [`fd_pack_insert_txn_init`](<fd_pack.c.md#fd_pack_insert_txn_init>)  (Implementation)


---
### fd\_pack\_insert\_txn\_fini<!-- {{#callable_declaration:fd_pack_insert_txn_fini}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L337>)

Finalizes the insertion of a transaction into the pack object.
- **Description**: Use this function to complete the process of adding a transaction to the pack object, making it available for scheduling. It must be called after `fd_pack_insert_txn_init` and before any other transaction operations. The function checks various conditions such as transaction expiration, nonce validity, and priority, and it may reject the transaction based on these checks. The caller must provide a valid `pack` object and a transaction initialized by `fd_pack_insert_txn_init`. The function returns a code indicating acceptance or rejection of the transaction.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. Must be a valid local join of a pack object.
    - `txne`: A pointer to a `fd_txn_e_t` object representing the transaction. Must be initialized by `fd_pack_insert_txn_init`.
    - `expires_at`: An unsigned long representing the expiration time of the transaction. If this value is less than the last call to `fd_pack_expire_before`, the transaction will be rejected.
    - `delete_cnt`: A pointer to an unsigned long where the function will store the number of transactions deleted as a side effect of the insertion. Must not be null.
- **Output**: Returns an integer code indicating the result of the transaction insertion. Non-negative values indicate acceptance, while negative values indicate rejection for specific reasons.
- **See Also**: [`fd_pack_insert_txn_fini`](<fd_pack.c.md#fd_pack_insert_txn_fini>)  (Implementation)


---
### fd\_pack\_insert\_txn\_cancel<!-- {{#callable_declaration:fd_pack_insert_txn_cancel}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L338>)

Cancels a transaction insertion process.
- **Description**: Use this function to abort the insertion of a transaction into the pool of available transactions for scheduling. This function should be called if the transaction insertion process, initiated by a prior call to `fd_pack_insert_txn_init`, needs to be terminated without finalizing the transaction. It is important to ensure that the `txn` pointer provided to this function is the same as the one returned by the most recent call to `fd_pack_insert_txn_init`. After calling this function, the caller should not retain any interest in the transaction.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object representing the pack. This must be a valid local join of a pack object.
    - `txn`: A pointer to a `fd_txn_e_t` object representing the transaction to cancel. This must be the same pointer returned by the most recent call to `fd_pack_insert_txn_init`. The caller should not use this pointer after calling this function.
- **Output**: None
- **See Also**: [`fd_pack_insert_txn_cancel`](<fd_pack.c.md#fd_pack_insert_txn_cancel>)  (Implementation)


---
### fd\_pack\_insert\_bundle\_init<!-- {{#callable_declaration:fd_pack_insert_bundle_init}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L415>)

Initializes a bundle for transaction insertion.
- **Description**: Use this function to prepare a bundle for inserting multiple transactions into a pack object. Ensure that the `txn_cnt` does not exceed `FD_PACK_MAX_TXN_PER_BUNDLE` and that the pack has enough free transaction elements to accommodate the bundle. This function must be followed by a call to either `fd_pack_insert_bundle_fini` or `fd_pack_insert_bundle_cancel` to finalize or cancel the insertion process.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. Must be a valid local join of a pack object.
    - `bundle`: A pointer to the first element of an array of at least `txn_cnt` pointers. The function populates this array with pointers to `fd_txn_e_t` structs.
    - `txn_cnt`: The number of transactions in the bundle. Must be between 1 and `FD_PACK_MAX_TXN_PER_BUNDLE`, inclusive.
- **Output**: Returns the `bundle` pointer populated with transaction pointers. The caller must not modify these pointers.
- **See Also**: [`fd_pack_insert_bundle_init`](<fd_pack.c.md#fd_pack_insert_bundle_init>)  (Implementation)


---
### fd\_pack\_insert\_bundle\_fini<!-- {{#callable_declaration:fd_pack_insert_bundle_fini}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L416>)

Finalizes the insertion of a transaction bundle into the pack.
- **Description**: Use this function to complete the process of inserting a bundle of transactions into a pack object, making them available for scheduling. Ensure that the bundle was previously initialized with `fd_pack_insert_bundle_init`. The function checks for various conditions such as expiration and priority, and may reject the bundle if any transaction fails validation. If `initializer_bundle` is set, the bundle is prioritized and exempt from certain checks. The function also handles metadata if provided. It returns a status code indicating acceptance or rejection, and updates `delete_cnt` with the number of transactions removed as a side effect.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. Must be a valid local join of a pack object.
    - `bundle`: A pointer to an array of `fd_txn_e_t *` pointers, representing the transactions in the bundle. Must not be null and should match the bundle initialized with `fd_pack_insert_bundle_init`.
    - `txn_cnt`: The number of transactions in the bundle. Must be between 1 and `FD_PACK_MAX_TXN_PER_BUNDLE`.
    - `expires_at`: An unsigned long representing the expiration time for the transactions in the bundle. Must be greater than or equal to the last call to `fd_pack_expire_before`.
    - `initializer_bundle`: An integer flag indicating if the bundle is an initializer bundle. Non-zero values prioritize the bundle and exempt it from blacklist checks.
    - `bundle_meta`: A constant pointer to metadata associated with the bundle. Can be null if no metadata is provided. If non-null, the size must match `bundle_meta_sz` specified during pack initialization.
    - `delete_cnt`: A pointer to an unsigned long where the function will store the number of transactions deleted as a side effect of the insertion. Must not be null.
- **Output**: Returns an integer status code indicating the result of the insertion, which can be one of the `FD_PACK_INSERT_ACCEPT_*` or `FD_PACK_INSERT_REJECT_*` codes.
- **See Also**: [`fd_pack_insert_bundle_fini`](<fd_pack.c.md#fd_pack_insert_bundle_fini>)  (Implementation)


---
### fd\_pack\_insert\_bundle\_cancel<!-- {{#callable_declaration:fd_pack_insert_bundle_cancel}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L418>)

Cancels the insertion of a transaction bundle.
- **Description**: Use this function to abort the insertion of a transaction bundle into the pack object. This function should be called if the bundle insertion process needs to be terminated before completion. It must be paired with a prior call to `fd_pack_insert_bundle_init` and should be used when the bundle is no longer needed or if an error occurs during the preparation of the bundle. This function ensures that the resources allocated for the bundle are released properly. The function does not return any value and does not modify the state of the pack object beyond canceling the bundle insertion.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join of a pack object. The caller retains ownership.
    - `bundle`: A pointer to the first element of an array of `fd_txn_e_t` pointers. This must be the same bundle that was returned by a prior call to `fd_pack_insert_bundle_init` with the same `txn_cnt`. The caller retains ownership.
    - `txn_cnt`: The number of transactions in the bundle. Must be in the range [1, FD_PACK_MAX_TXN_PER_BUNDLE].
- **Output**: None
- **See Also**: [`fd_pack_insert_bundle_cancel`](<fd_pack.c.md#fd_pack_insert_bundle_cancel>)  (Implementation)


---
### fd\_pack\_peek\_bundle\_meta<!-- {{#callable_declaration:fd_pack_peek_bundle_meta}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L504>)

Returns metadata for the next bundle to be scheduled.
- **Description**: Use this function to get a constant pointer to the metadata of the bundle that is next in line for scheduling. It returns NULL if there are no bundles, if the next bundle is an initializer bundle, or if the bundle state is 'Pending' or 'Failed'. The pointer remains valid until the next modification to the pack object, such as an insert, schedule, delete, or expire operation. Ensure that the pack object was initialized with a non-zero `bundle_meta_sz` to use this function.
- **Inputs**:
    - `pack`: A pointer to a constant `fd_pack_t` structure. It must not be null and should be a valid local join of a pack object.
- **Output**: A constant pointer to the bundle metadata, or NULL if conditions for returning metadata are not met.
- **See Also**: [`fd_pack_peek_bundle_meta`](<fd_pack.c.md#fd_pack_peek_bundle_meta>)  (Implementation)


---
### fd\_pack\_set\_initializer\_bundles\_ready<!-- {{#callable_declaration:fd_pack_set_initializer_bundles_ready}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L510>)

Sets the initializer bundle state to ready.
- **Description**: Use this function to transition the initializer bundle state machine to the [Ready] state. This is useful when you want to bypass the need for an initializer bundle and directly prepare the system to schedule the next bundle. Ensure that the `pack` object is a valid local join before calling this function.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. Must be a valid local join. The function does not handle null pointers, so ensure `pack` is not null before calling.
- **Output**: None
- **See Also**: [`fd_pack_set_initializer_bundles_ready`](<fd_pack.c.md#fd_pack_set_initializer_bundles_ready>)  (Implementation)


---
### fd\_pack\_schedule\_next\_microblock<!-- {{#callable_declaration:fd_pack_schedule_next_microblock}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L578>)

Schedules pending transactions into a microblock or bundle.
- **Description**: Use this function to schedule transactions from a pack object into a microblock or bundle based on specified criteria. The function considers vote transactions, bundles, and normal transactions according to the provided scheduling flags. It respects block-level limits and ensures that the scheduled transactions do not exceed specified compute unit limits. The function must be called with a valid local join of a pack object, and the scheduling flags must be a valid combination of defined scheduling types. The function returns the number of transactions scheduled, which may be zero if no eligible transactions are available.
- **Inputs**:
    - `pack`: A pointer to a valid local join of a `fd_pack_t` object. The caller must ensure this is not null and is properly initialized.
    - `total_cus`: The maximum number of compute units allowed for the scheduled transactions. The function clamps this value to ensure it does not exceed block limits.
    - `vote_fraction`: A float representing the fraction of the total compute units and transactions that can be allocated to vote transactions. Must be between 0.0 and 1.0.
    - `bank_tile`: An unsigned long indicating the bank tile index where transactions will be scheduled. Must be within the valid range of bank tiles initialized in the pack object.
    - `schedule_flags`: An integer representing a bitwise combination of scheduling flags (`FD_PACK_SCHEDULE_VOTE`, `FD_PACK_SCHEDULE_BUNDLE`, `FD_PACK_SCHEDULE_TXN`). Determines which types of transactions to consider for scheduling.
    - `out`: A pointer to an array of `fd_txn_p_t` where the scheduled transactions will be copied. The caller must ensure this array is large enough to hold the maximum number of transactions that can be scheduled.
- **Output**: Returns the number of transactions scheduled into the microblock or bundle. Returns 0 if no transactions are scheduled.
- **See Also**: [`fd_pack_schedule_next_microblock`](<fd_pack.c.md#fd_pack_schedule_next_microblock>)  (Implementation)


---
### fd\_pack\_rebate\_cus<!-- {{#callable_declaration:fd_pack_rebate_cus}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L611>)

Adjusts compute unit accounting based on actual usage after execution.
- **Description**: Use this function to update the compute unit (CU) accounting for transactions after execution, reflecting the actual CUs consumed. This adjustment allows unused CUs to be available for other transactions within the same block. Ensure that this function is called after `fd_pack_schedule_next_microblock` and before `fd_pack_end_block` for the same block. The function does not affect microblock completion and can be called independently of `fd_pack_microblock_complete`. It is important to note that CU limits reset at the end of each block, so do not call this function for transactions from a previous block.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join of a pack object.
    - `rebate`: A pointer to a `fd_pack_rebate_t` structure containing the rebate information. This must be a valid rebate report produced by `fd_pack_rebate_sum_t`.
- **Output**: None
- **See Also**: [`fd_pack_rebate_cus`](<fd_pack.c.md#fd_pack_rebate_cus>)  (Implementation)


---
### fd\_pack\_microblock\_complete<!-- {{#callable_declaration:fd_pack_microblock_complete}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L621>)

Signals the completion of a microblock for a specific bank tile.
- **Description**: Use this function to indicate that a microblock previously scheduled for a specific bank tile has completed. This allows the scheduling of new transactions that may conflict with the completed microblock. It is safe to call this function multiple times for the same bank tile or if no microblock was scheduled; in such cases, the function acts as a no-op and returns 0. Call this function before scheduling another microblock to the same bank tile.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` structure representing the pack object. Must not be null and must be a valid local join.
    - `bank_tile`: An unsigned long integer representing the index of the bank tile. Must be within the range of bank tiles initialized for the pack object.
- **Output**: Returns 1 if the bank tile had an outstanding microblock to mark as completed, otherwise returns 0.
- **See Also**: [`fd_pack_microblock_complete`](<fd_pack.c.md#fd_pack_microblock_complete>)  (Implementation)


---
### fd\_pack\_expire\_before<!-- {{#callable_declaration:fd_pack_expire_before}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L628>)

Deletes transactions with expiration times before a specified threshold.
- **Description**: Use this function to remove transactions from the pack object that have an expiration time earlier than the specified `expire_before` value. This is useful for cleaning up expired transactions and ensuring that only valid transactions remain available for scheduling. The function must be called with a valid pack object that the caller has joined locally. It returns the number of transactions that were deleted. If called with the same or a smaller `expire_before` value as a previous call, the function will perform no operations.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join of a pack object. The caller retains ownership and must ensure it is not null.
    - `expire_before`: An unsigned long integer representing the expiration threshold. Transactions with expiration times strictly less than this value will be deleted.
- **Output**: Returns the number of transactions deleted as an unsigned long integer.
- **See Also**: [`fd_pack_expire_before`](<fd_pack.c.md#fd_pack_expire_before>)  (Implementation)


---
### fd\_pack\_delete\_transaction<!-- {{#callable_declaration:fd_pack_delete_transaction}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L635>)

Removes a transaction from the pool of available transactions.
- **Description**: Use this function to delete a transaction from the pool of available transactions by its first signature. It is useful when you need to remove a transaction that is no longer valid or needed. The function returns the number of transactions deleted, which can be greater than one if the deletion of a transaction causes a bundle to be deleted. Ensure that the `pack` object is a valid local join before calling this function.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object representing the transaction pool. Must be a valid local join.
    - `sig0`: A constant pointer to a `fd_ed25519_sig_t` representing the first signature of the transaction to delete. Must not be null.
- **Output**: Returns a nonzero count of the number of transactions deleted if the transaction was found and removed, or 0 if not found.
- **See Also**: [`fd_pack_delete_transaction`](<fd_pack.c.md#fd_pack_delete_transaction>)  (Implementation)


---
### fd\_pack\_end\_block<!-- {{#callable_declaration:fd_pack_end_block}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L642>)

Resets the state of a pack object for the next block.
- **Description**: Use this function to prepare a pack object for a new block by resetting its state and clearing per-block limits. This function should be called at the end of processing a block to ensure that subsequent microblocks can be scheduled without conflicts from the previous block. It is important to call this function before scheduling new transactions for the next block.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join of a pack object. The function does not handle null pointers, so ensure `pack` is not null before calling.
- **Output**: None
- **See Also**: [`fd_pack_end_block`](<fd_pack.c.md#fd_pack_end_block>)  (Implementation)


---
### fd\_pack\_clear\_all<!-- {{#callable_declaration:fd_pack_clear_all}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L648>)

Resets the state of a pack object.
- **Description**: Use this function to clear all pending transactions and reset all limits associated with a pack object. This is useful when you need to start fresh with a new set of transactions or after processing a block. Ensure that the pack object is a valid local join before calling this function. This function does not return any value and does not indicate success or failure, so it is important to ensure the pack object is in a valid state before calling.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object. This must be a valid local join and must not be null. The function will not check for null pointers, so passing a null pointer will result in undefined behavior.
- **Output**: None
- **See Also**: [`fd_pack_clear_all`](<fd_pack.c.md#fd_pack_clear_all>)  (Implementation)


---
### fd\_pack\_metrics\_write<!-- {{#callable_declaration:fd_pack_metrics_write}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L653>)

Writes periodic metric values to the metrics system.
- **Description**: Use this function to update the metrics system with the current state of transactions in the pack object. This function should be called periodically to ensure that the metrics reflect the latest transaction counts and statuses. The function requires a valid local join of a `fd_pack_t` object. It does not return any value or modify the input pack object.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object representing the pack whose metrics are to be written. Must be a valid local join and must not be null.
- **Output**: None
- **See Also**: [`fd_pack_metrics_write`](<fd_pack.c.md#fd_pack_metrics_write>)  (Implementation)


---
### fd\_pack\_leave<!-- {{#callable_declaration:fd_pack_leave}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L658>)

Leaves a local join of a pack object.
- **Description**: Use this function to leave a local join of a pack object when it is no longer needed. This function should be called after all operations on the pack object are complete and before the memory is released or reused. It is important to ensure that every successful join has a corresponding leave to maintain proper resource management.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object representing the pack to leave. Must be a valid local join. The function returns this pointer.
- **Output**: Returns the `pack` pointer that was passed in.
- **See Also**: [`fd_pack_leave`](<fd_pack.c.md#fd_pack_leave>)  (Implementation)


---
### fd\_pack\_delete<!-- {{#callable_declaration:fd_pack_delete}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L661>)

Unformats a memory region used for a pack object.
- **Description**: Use this function to release a memory region that was previously formatted as a pack object, returning the memory ownership back to the caller. This function should be called when the pack object is no longer needed, ensuring that any resources associated with it are properly released. The function returns the original memory pointer, allowing for further use or deallocation by the caller.
- **Inputs**:
    - `mem`: A pointer to a memory region that was previously formatted as a pack object. The pointer must not be null, and the memory must have been allocated and formatted correctly before calling this function.
- **Output**: Returns the original memory pointer `mem`, indicating that the memory is now unformatted and available for other uses.
- **See Also**: [`fd_pack_delete`](<fd_pack.c.md#fd_pack_delete>)  (Implementation)


---
### fd\_pack\_verify<!-- {{#callable_declaration:fd_pack_verify}} -->
[View Source →](<../../../../../src/disco/pack/fd_pack.h#L668>)

Checks the integrity of a pack object against several invariants.
- **Description**: Use this function to verify that a `fd_pack_t` object maintains its expected state and invariants. This function is primarily for debugging purposes and should be used when you suspect that the pack object may be in an inconsistent state. The function requires a scratch memory area that meets the same alignment and footprint constraints as the pack object. It returns 0 if all invariants are satisfied and a negative value if any invariant is violated, logging a warning with details.
- **Inputs**:
    - `pack`: A pointer to a `fd_pack_t` object to verify. Must not be null and must be a valid local join.
    - `scratch`: A pointer to a memory area used for temporary storage during verification. Must meet the same alignment and footprint constraints as the `pack` object.
- **Output**: Returns 0 if all invariants are satisfied. Returns a negative value if any invariant is violated, with a warning logged.
- **See Also**: [`fd_pack_verify`](<fd_pack.c.md#fd_pack_verify>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)