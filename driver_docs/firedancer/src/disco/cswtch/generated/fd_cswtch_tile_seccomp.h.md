<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall access control on different architectures.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_cswtch_tile`](<#populate_sock_filter_policy_fd_cswtch_tile>), initializes a BPF filter array with 35 instructions. These instructions enforce security policies by allowing or denying specific system calls based on predefined conditions.

The filter checks the architecture of the executing environment and compares it with the expected architecture. It then evaluates system calls such as `write`, `fsync`, `lseek`, `read`, and `clock_nanosleep`. For each system call, the filter checks specific arguments to determine whether to allow the call or terminate the process. The filter uses BPF statements and jumps to implement these checks, and it uses `SECCOMP_RET_ALLOW` and `SECCOMP_RET_KILL_PROCESS` to specify the action for each case. The function `fd_memcpy` is used to copy the filter instructions into the provided output buffer.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_cswtch\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: This variable is a constant unsigned integer that represents the number of instructions in a socket filter policy for a context switch tile. It is set to the value 35.
- **Use**: Used to define the size of the `filter` array in the `populate_sock_filter_policy_fd_cswtch_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_cswtch\_tile<!-- {{#callable:populate_sock_filter_policy_fd_cswtch_tile}} -->
[View Source →](<../../../../../../src/disco/cswtch/generated/fd_cswtch_tile_seccomp.h#L26>)

Populates a socket filter policy with specific rules for system call filtering based on architecture and file descriptor checks.
- **Inputs**:
    - `out_cnt`: The number of elements in the output filter array, which must be at least 35.
    - `out`: A pointer to an array of `struct sock_filter` where the filter rules will be copied.
    - `logfile_fd`: The file descriptor used in the filter rules to allow or kill processes based on system call arguments.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 35 using `FD_TEST` macro.
    - Define a `struct sock_filter` array `filter` with 35 elements to hold the BPF instructions.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check if it matches `SYS_write`, `SYS_fsync`, `SYS_lseek`, `SYS_read`, or `SYS_clock_nanosleep`; if none match, jump to `RET_KILL_PROCESS`.
    - For each allowed syscall, load the first argument and compare it with specific values (e.g., `2`, `logfile_fd`); based on the comparison, either allow the syscall or kill the process.
    - For `SYS_lseek`, also check the second and third arguments to ensure they match `0` and `SEEK_SET`, respectively.
    - For `SYS_clock_nanosleep`, check additional arguments to ensure they match `0`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it populates the `out` array with the defined filter rules.



---
Made with ❤️ by [Driver](https://www.driver.ai/)