<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall verification on different architectures.

# Purpose
This code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific architecture. The file is automatically generated and should not be edited manually. It includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The code uses conditional compilation to set the `ARCH_NR` macro based on the target architecture, such as `AUDIT_ARCH_I386`, `AUDIT_ARCH_X86_64`, or `AUDIT_ARCH_AARCH64`.

The main functionality is provided by the [`populate_sock_filter_policy_fd_verify_tile`](<#populate_sock_filter_policy_fd_verify_tile>) function, which initializes a BPF filter array. This filter enforces security policies by allowing or denying specific system calls based on their numbers and arguments. The filter checks if the architecture of the executing script matches the runtime architecture and allows only specific system calls like `SYS_write` and `SYS_fsync` under certain conditions. If the conditions are not met, the process is terminated using `SECCOMP_RET_KILL_PROCESS`. The function uses `fd_memcpy` to copy the filter configuration to the output buffer. This header file is intended to be included in other C files that require this specific seccomp filter policy.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_verify\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: Defines the number of instructions in the socket filter policy for verifying file descriptors in a tile.
- **Use**: Used to ensure the correct number of instructions are processed in the `populate_sock_filter_policy_fd_verify_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_verify\_tile<!-- {{#callable:populate_sock_filter_policy_fd_verify_tile}} -->
[View Source →](<../../../../../../src/disco/verify/generated/fd_verify_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to verify system calls against a specified architecture and file descriptor.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 14.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor to be checked against syscall arguments for write and fsync operations.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to hold the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; if not equal, jump to `RET_KILL_PROCESS`.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - If none of the conditions are met, execute `RET_KILL_PROCESS`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it populates the `out` array with the seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)