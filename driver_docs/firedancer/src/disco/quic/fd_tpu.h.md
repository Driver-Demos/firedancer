<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Server-side implementation of the TPU/QUIC protocol for transaction submission to a block producer.

# Purpose
The code defines a C header file for the server-side implementation of the TPU/QUIC protocol, which is used to submit transactions to a block producer. The file provides the necessary structures, constants, and function prototypes to handle the reassembly of transaction data fragments received over QUIC streams. The main component is the `fd_tpu_reasm_t` structure, which manages the reassembly process by maintaining an array of reassembly buffers, referred to as slots. These slots transition through different states (FREE, BUSY, PUB) as they handle incoming transaction data, ensuring that transactions are correctly reassembled and published for downstream processing.

The file also defines several macros for error codes and state management, as well as functions for creating, joining, and managing the lifecycle of reassembly slots. The functions include [`fd_tpu_reasm_new`](<#fd_tpu_reasm_new>), [`fd_tpu_reasm_join`](<#fd_tpu_reasm_join>), [`fd_tpu_reasm_prepare`](<#fd_tpu_reasm_prepare>), and [`fd_tpu_reasm_publish`](<#fd_tpu_reasm_publish>), among others. These functions facilitate the allocation and management of memory for reassembly, the handling of incoming data fragments, and the publication of completed transactions. The code also includes flow control and eviction policies to manage the reassembly process efficiently, ensuring that the system can handle transaction data within the constraints of available resources.
# Imports and Dependencies

---
- `../fd_txn_m.h`
- `../../tango/fd_tango_base.h`


# Data Structures

---
### fd\_tpu\_reasm\_key
- **Type**: ``struct``
- **Members**:
    - ``conn_uid``: A unique identifier for the connection, with `ULONG_MAX` indicating an invalid value.
    - ``stream_id``: A 48-bit field representing the stream identifier.
    - ``sz``: A 14-bit field indicating the size of the transaction payload data, excluding the size of `fd_txn_m_t`.
    - ``state``: A 2-bit field representing the state of the transaction.
- **Description**: The `fd_tpu_reasm_key` structure is used to manage key information for reassembling transactions in the TPU/QUIC protocol. It includes fields for connection and stream identification, the size of the transaction payload, and the state of the transaction. This structure is crucial for handling fragmented transactions over multiple packets in a QUIC stream.


---
### fd\_tpu\_reasm\_key\_t
- **Type**: ``struct``
- **Members**:
    - ``conn_uid``: Holds the unique identifier for the connection, with `ULONG_MAX` indicating an invalid connection.
    - ``stream_id``: A 48-bit field representing the stream identifier.
    - ``sz``: A 14-bit field indicating the size of the transaction payload data, excluding the size of `fd_txn_m_t`.
    - ``state``: A 2-bit field representing the state of the reassembly process.
- **Description**: Defines a key structure used in the reassembly process of TPU/QUIC streams, containing fields for connection identification, stream identification, payload size, and reassembly state.


---
### fd\_tpu\_reasm\_slot
- **Type**: ``struct``
- **Members**:
    - ``k``: Holds a compound key for the reassembly slot.
    - ``lru_prev``: Stores the index of the previous slot in the LRU list.
    - ``lru_next``: Stores the index of the next slot in the LRU list.
    - ``chain_next``: Stores the index of the next slot in the reassembly chain.
    - ``tsorig_comp``: Holds a timestamp or other original component data.
- **Description**: The `fd_tpu_reasm_slot` structure is used to manage a message reassembly buffer within the TPU/QUIC protocol. It includes a compound key (`k`) for identifying the slot, and several fields (`lru_prev`, `lru_next`, `chain_next`) for managing the slot's position in linked lists or chains, which are likely used for least-recently-used (LRU) eviction policies and reassembly chains. The `tsorig_comp` field is used to store timestamp or original component data related to the reassembly process.


---
### fd\_tpu\_reasm\_slot\_t
- **Type**: ``struct``
- **Members**:
    - ``k``: Holds a compound key for the reassembly slot, including connection UID, stream ID, size, and state.
    - ``lru_prev``: Stores the index of the previous slot in the LRU list.
    - ``lru_next``: Stores the index of the next slot in the LRU list.
    - ``chain_next``: Stores the index of the next slot in the hash chain.
    - ``tsorig_comp``: Stores a timestamp or other comparison value for ordering.
- **Description**: Holds a message reassembly buffer for the TPU/QUIC protocol, managing the state and order of reassembly slots in a linked list and hash chain for efficient access and eviction.


---
### fd\_tpu\_reasm
- **Type**: ``struct fd_tpu_reasm``
- **Members**:
    - ``magic``: A magic number used for validation, expected to be `FD_TPU_REASM_MAGIC`.
    - ``slots_off``: Offset to the memory region for slots.
    - ``pub_slots_off``: Offset to the memory region for published slots.
    - ``map_off``: Offset to the memory region for the map.
    - ``dcache``: Pointer to the first data cache byte in local address space.
    - ``depth``: Depth of the memory cache.
    - ``burst``: Maximum number of concurrent reassemblies.
    - ``head``: Index of the least recent reassembly.
    - ``tail``: Index of the most recent reassembly.
    - ``slot_cnt``: Count of slots.
    - ``orig``: Tango origin identifier.
- **Description**: Manages the reassembly of fragmented transactions in the TPU/QUIC protocol, handling memory offsets, cache pointers, and reassembly state tracking for efficient processing of incoming data streams.


---
### fd\_tpu\_reasm\_t
- **Type**: ``struct``
- **Members**:
    - ``magic``: A magic number used to identify the structure, expected to be `FD_TPU_REASM_MAGIC`.
    - ``slots_off``: Offset to the memory region for slots.
    - ``pub_slots_off``: Offset to the memory region for published slots.
    - ``map_off``: Offset to the memory region for the map.
    - ``dcache``: Pointer to the first data byte in the local address space of the dcache.
    - ``depth``: Depth of the mcache.
    - ``burst``: Maximum number of concurrent reassemblies.
    - ``head``: Index of the least recent reassembly.
    - ``tail``: Index of the most recent reassembly.
    - ``slot_cnt``: Count of slots.
    - ``orig``: Tango origin ID.
- **Description**: Handles incoming data fragments of TPU/QUIC streams, managing reassembly slots and dispatching reassembled messages to an mcache. It supports flow control and eviction policies to manage concurrent streams and ensure efficient reassembly and publication of transactions. The structure maintains offsets to various memory regions and tracks the state of reassembly slots, ensuring that the number of slots in different states is managed according to the specified depth and reassembly maximum.


# Functions

---
### fd\_tpu\_reasm\_slots\_laddr<!-- {{#callable:fd_tpu_reasm_slots_laddr}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L167>)

Calculates the local address of the reassembly slots in a `fd_tpu_reasm_t` structure.
- **Inputs**:
    - `reasm`: A pointer to a `fd_tpu_reasm_t` structure, which contains information about the reassembly process.
- **Logic and Control Flow**:
    - Calculate the local address of the reassembly slots by adding the `slots_off` offset to the base address of the `reasm` structure.
    - Cast the calculated address to a pointer of type `fd_tpu_reasm_slot_t *`.
- **Output**: Returns a pointer to the first reassembly slot in the `fd_tpu_reasm_t` structure.


---
### fd\_tpu\_reasm\_slots\_laddr\_const<!-- {{#callable:fd_tpu_reasm_slots_laddr_const}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L176>)

Returns a constant pointer to the reassembly slots of a given `fd_tpu_reasm_t` structure.
- **Inputs**:
    - `reasm`: A constant pointer to an `fd_tpu_reasm_t` structure, which contains information about the reassembly slots and their offset.
- **Logic and Control Flow**:
    - Calculate the address of the reassembly slots by adding the `slots_off` offset to the base address of the `reasm` structure.
    - Cast the calculated address to a constant pointer of type `fd_tpu_reasm_slot_t`.
    - Return the constant pointer to the reassembly slots.
- **Output**: A constant pointer to the `fd_tpu_reasm_slot_t` structure, representing the reassembly slots of the given `fd_tpu_reasm_t`.


---
### fd\_tpu\_reasm\_pub\_slots\_laddr<!-- {{#callable:fd_tpu_reasm_pub_slots_laddr}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L181>)

Calculates the local address of the public slots memory region within a TPU reassembly structure.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` structure, which represents the TPU reassembly context.
- **Logic and Control Flow**:
    - Cast the `reasm` pointer to an unsigned long integer.
    - Add the `pub_slots_off` offset from the `reasm` structure to the casted value.
    - Cast the result to a pointer to an unsigned integer (`uint *`).
    - Return the calculated pointer.
- **Output**: A pointer to the public slots memory region within the TPU reassembly structure.


---
### fd\_tpu\_reasm\_req\_data\_sz<!-- {{#callable:fd_tpu_reasm_req_data_sz}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L201>)

Calculates the required data size for TPU reassembly based on the given depth and maximum reassembly count.
- **Inputs**:
    - `depth`: The entry count of the target mcache, assumed to be in the range [1, 2^31).
    - `reasm_max`: The maximum number of transactions that can be reassembled concurrently, assumed to be in the range [1, 2^31).
- **Logic and Control Flow**:
    - Adds `depth` and `reasm_max` to determine the total number of slots needed.
    - Multiplies the sum by `FD_TPU_REASM_MTU` to calculate the total data size required for reassembly.
- **Output**: Returns the total data size required for TPU reassembly as an unsigned long integer.


---
### fd\_tpu\_reasm\_acquire<!-- {{#callable:fd_tpu_reasm_acquire}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L252>)

Acquires a reassembly slot for a given connection and stream, preparing a new slot if none exists.
- **Inputs**:
    - `reasm`: A pointer to the `fd_tpu_reasm_t` structure, which manages the reassembly slots.
    - `conn_uid`: An unsigned long integer representing the unique identifier for the connection.
    - `stream_id`: An unsigned long integer representing the identifier for the stream.
    - `tspub`: A long integer representing the timestamp for publication.
- **Logic and Control Flow**:
    - Call [`fd_tpu_reasm_query`](<fd_tpu_reasm.c.md#fd_tpu_reasm_query>) with `reasm`, `conn_uid`, and `stream_id` to find an existing reassembly slot.
    - If [`fd_tpu_reasm_query`](<fd_tpu_reasm.c.md#fd_tpu_reasm_query>) returns a non-null slot, return it.
    - If [`fd_tpu_reasm_query`](<fd_tpu_reasm.c.md#fd_tpu_reasm_query>) returns null, call [`fd_tpu_reasm_prepare`](<fd_tpu_reasm.c.md#fd_tpu_reasm_prepare>) with `reasm`, `conn_uid`, `stream_id`, and `tspub` to prepare a new slot.
    - Return the slot obtained from [`fd_tpu_reasm_prepare`](<fd_tpu_reasm.c.md#fd_tpu_reasm_prepare>).
- **Output**: Returns a pointer to an `fd_tpu_reasm_slot_t` structure, representing the acquired or newly prepared reassembly slot.
- **Functions Called**:
    - [`fd_tpu_reasm_query`](<fd_tpu_reasm.c.md#fd_tpu_reasm_query>)
    - [`fd_tpu_reasm_prepare`](<fd_tpu_reasm.c.md#fd_tpu_reasm_prepare>)


---
### fd\_tpu\_reasm\_key\_hash<!-- {{#callable:fd_tpu_reasm_key_hash}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L332>)

Computes a hash value for a given `fd_tpu_reasm_key_t` structure using a seed and a series of bitwise and arithmetic operations.
- **Inputs**:
    - `k`: A pointer to a `fd_tpu_reasm_key_t` structure containing the connection UID and stream ID to hash.
    - `seed`: An unsigned long integer used as the initial seed for the hash computation.
- **Logic and Control Flow**:
    - Initialize `h` with the sum of `seed`, `C5`, and 16.
    - Extract `conn_uid` from `k` into `w0` and `stream_id` into `w1`.
    - Multiply `w0` by `C2`, rotate left by 31 bits, multiply by `C1`, XOR with `h`, rotate `h` left by 27 bits, multiply by `C1`, and add `C4`.
    - Repeat the same operations for `w1` as done for `w0`.
    - Perform a series of bitwise XOR and multiplication operations on `h` to finalize the hash value.
    - Return the computed hash value `h`.
- **Output**: Returns an unsigned long integer representing the computed hash value.


# Function Declarations (Public API)

---
### fd\_tpu\_reasm\_align<!-- {{#callable_declaration:fd_tpu_reasm_align}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L194>)

Returns the alignment requirement for a TPU reassembly structure.
- **Description**: Use this function to determine the memory alignment requirement for a TPU reassembly structure. This is necessary when allocating memory for such structures to ensure proper alignment, which is critical for performance and correctness on many systems. Call this function before allocating memory for a `fd_tpu_reasm_t` to ensure the memory is correctly aligned.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement in bytes.
- **See Also**: [`fd_tpu_reasm_align`](<fd_tpu_reasm.c.md#fd_tpu_reasm_align>)  (Implementation)


---
### fd\_tpu\_reasm\_footprint<!-- {{#callable_declaration:fd_tpu_reasm_footprint}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L197>)

Calculates the memory footprint for a TPU reassembly structure.
- **Description**: Use this function to determine the memory size required for a TPU reassembly structure that can handle a specified number of concurrent transactions and a given depth of the target mcache. This function is useful when allocating memory for TPU reassembly operations. Ensure that the `depth` is a power of two and within the range of 1 to 2^31, and that `reasm_max` is between 1 and 2^31. If these conditions are not met, the function returns 0, indicating an invalid configuration.
- **Inputs**:
    - `depth`: The number of entries in the target mcache. Must be a power of two and within the range {2^0, 2^1, ..., 2^31}. If not, the function returns 0.
    - `reasm_max`: The maximum number of concurrent reassemblies. Must be in the range [1, 2^31). If not, the function returns 0.
- **Output**: Returns the required memory footprint in bytes for the TPU reassembly structure, or 0 if the input parameters are invalid.
- **See Also**: [`fd_tpu_reasm_footprint`](<fd_tpu_reasm.c.md#fd_tpu_reasm_footprint>)  (Implementation)


---
### fd\_tpu\_reasm\_new<!-- {{#callable_declaration:fd_tpu_reasm_new}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L216>)

Formats a memory region for use as a TPU reassembly object.
- **Description**: Use this function to initialize a memory region for TPU reassembly operations. The memory region must be non-null, properly aligned, and have the required footprint. The function requires parameters for depth, maximum reassemblies, origin ID, and a data cache. The data cache must have sufficient size to accommodate the required data size. If any precondition is not met, the function returns NULL.
- **Inputs**:
    - `shmem`: A non-null pointer to the memory region to format. Must be aligned to `FD_TPU_REASM_ALIGN`.
    - `depth`: The depth of the target mcache, assumed to be a power of two within the range {2^0, 2^1, ..., 2^32}.
    - `reasm_max`: The maximum number of concurrent reassemblies, assumed to be within the range [1, 2^32).
    - `orig`: The Tango origin ID for the reassembly object, assumed to be within the range [0, FD_FRAG_META_ORIG_MAX).
    - `dcache`: A pointer to a local join of an fd_dcache. Must have at least `fd_tpu_reasm_req_data_sz()` bytes of data size.
- **Output**: Returns a pointer to the initialized reassembly object on success, or NULL if any precondition fails.
- **See Also**: [`fd_tpu_reasm_new`](<fd_tpu_reasm.c.md#fd_tpu_reasm_new>)  (Implementation)


---
### fd\_tpu\_reasm\_join<!-- {{#callable_declaration:fd_tpu_reasm_join}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L223>)

Joins a TPU reassembly object from shared memory.
- **Description**: Use this function to obtain a pointer to a `fd_tpu_reasm_t` object from a shared memory region. This function checks if the memory region contains a valid TPU reassembly object by verifying its magic number. If the magic number is incorrect, the function logs a warning and returns `NULL`. This function is typically used after the memory region has been initialized with `fd_tpu_reasm_new`. Ensure that the shared memory region is correctly aligned and formatted before calling this function.
- **Inputs**:
    - `shreasm`: A pointer to the shared memory region that is expected to contain a `fd_tpu_reasm_t` object. The memory must be correctly aligned and initialized. If the magic number is incorrect, the function returns `NULL`.
- **Output**: Returns a pointer to a `fd_tpu_reasm_t` object if successful, or `NULL` if the magic number is incorrect.
- **See Also**: [`fd_tpu_reasm_join`](<fd_tpu_reasm.c.md#fd_tpu_reasm_join>)  (Implementation)


---
### fd\_tpu\_reasm\_leave<!-- {{#callable_declaration:fd_tpu_reasm_leave}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L226>)

Leaves the TPU reassembly context.
- **Description**: Use this function to exit the TPU reassembly context when it is no longer needed. This function should be called to properly leave the reassembly context after operations are complete. Ensure that the `reasm` parameter is valid and initialized before calling this function. This function does not perform any operations on the reassembly context other than returning it.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` structure representing the TPU reassembly context. Must be a valid and initialized pointer. The function does not modify the contents of the structure.
- **Output**: Returns the same pointer passed as the `reasm` parameter.
- **See Also**: [`fd_tpu_reasm_leave`](<fd_tpu_reasm.c.md#fd_tpu_reasm_leave>)  (Implementation)


---
### fd\_tpu\_reasm\_delete<!-- {{#callable_declaration:fd_tpu_reasm_delete}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L229>)

Deletes a TPU reassembly object.
- **Description**: Use this function to delete a TPU reassembly object when it is no longer needed. This function sets the internal state of the reassembly object to indicate it is no longer valid. It is important to ensure that the object is not used after calling this function, as it will not perform any further operations. This function must be called with a valid pointer to a TPU reassembly object, and it will return the same pointer if successful, or NULL if the input is invalid.
- **Inputs**:
    - `shreasm`: A pointer to a TPU reassembly object. Must not be null. If the pointer is null, the function returns null without performing any operations.
- **Output**: Returns the same pointer passed as input if the operation is successful, or NULL if the input pointer is null.
- **See Also**: [`fd_tpu_reasm_delete`](<fd_tpu_reasm.c.md#fd_tpu_reasm_delete>)  (Implementation)


---
### fd\_tpu\_reasm\_query<!-- {{#callable_declaration:fd_tpu_reasm_query}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L234>)

Queries a reassembly slot for a specific connection and stream.
- **Description**: Use this function to retrieve a reassembly slot associated with a specific connection and stream within a TPU/QUIC reassembly context. This function is useful when you need to access or manage the reassembly state of a particular stream. Ensure that the `reasm` parameter is a valid pointer to an initialized reassembly context. The function does not modify the state of the reassembly slots or the reassembly context.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` structure representing the reassembly context. Must not be null and should be properly initialized.
    - `conn_uid`: An unsigned long integer representing the unique identifier for the connection. Must be a valid connection ID.
    - `stream_id`: An unsigned long integer representing the stream identifier. Must be a valid stream ID within the connection.
- **Output**: Returns a pointer to an `fd_tpu_reasm_slot_t` structure if a matching reassembly slot is found, or null if no such slot exists.
- **See Also**: [`fd_tpu_reasm_query`](<fd_tpu_reasm.c.md#fd_tpu_reasm_query>)  (Implementation)


---
### fd\_tpu\_reasm\_prepare<!-- {{#callable_declaration:fd_tpu_reasm_prepare}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L246>)

Prepares a reassembly slot for a new QUIC stream.
- **Description**: Use this function to prepare a reassembly slot for handling a new QUIC stream in the TPU/QUIC protocol. This function should be called when a new QUIC stream is accepted, and it initializes a slot with the provided connection and stream identifiers. The function updates the slot's metadata and prepares it for receiving data fragments. Ensure that the `reasm` object is properly initialized and that there are available slots for reassembly. The function returns a pointer to the prepared slot, which can be used for further operations.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` object that manages the reassembly slots. Must not be null and should be properly initialized.
    - `conn_uid`: An unsigned long representing the unique identifier for the connection. It is used to identify the connection associated with the slot.
    - `stream_id`: An unsigned long representing the stream identifier. The function masks this value with `FD_TPU_REASM_SID_MASK` to ensure it fits within the expected range.
    - `tsorig`: A long integer representing the original timestamp. It is used to compute a timestamp component for the slot.
- **Output**: Returns a pointer to an `fd_tpu_reasm_slot_t` object, which is the prepared reassembly slot.
- **See Also**: [`fd_tpu_reasm_prepare`](<fd_tpu_reasm.c.md#fd_tpu_reasm_prepare>)  (Implementation)


---
### fd\_tpu\_reasm\_frag<!-- {{#callable_declaration:fd_tpu_reasm_frag}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L280>)

Appends a data fragment to a reassembly slot.
- **Description**: Use this function to add a new data fragment to an ongoing reassembly process in a specified slot. The function requires that the slot is in a busy state, indicating active reassembly. It checks for correct data offset and size constraints, ensuring that the data fits within the maximum transmission unit (MTU). If the data offset is incorrect or the combined size exceeds the MTU, the function cancels the reassembly and returns an error code. This function is typically called when handling fragmented data streams in a TPU/QUIC protocol context.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` structure representing the reassembly context. Must not be null.
    - `slot`: A pointer to an `fd_tpu_reasm_slot_t` structure representing the reassembly slot. Must be in a busy state; otherwise, the function returns an error.
    - `data`: A pointer to the data fragment to append. Must not be null.
    - `sz`: The size of the data fragment in bytes. Must be non-zero and, when added to the current size, must not exceed the MTU.
    - `off`: The offset of the data fragment within the stream. Must not exceed the current size of the data in the slot.
- **Output**: Returns an integer status code: `FD_TPU_REASM_SUCCESS` on success, `FD_TPU_REASM_ERR_SZ` if the size constraints are violated, `FD_TPU_REASM_ERR_SKIP` if the data offset is incorrect, or `FD_TPU_REASM_ERR_STATE` if the slot is not in a busy state.
- **See Also**: [`fd_tpu_reasm_frag`](<fd_tpu_reasm.c.md#fd_tpu_reasm_frag>)  (Implementation)


---
### fd\_tpu\_reasm\_publish<!-- {{#callable_declaration:fd_tpu_reasm_publish}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L294>)

Publishes a reassembled message to an mcache for downstream consumption.
- **Description**: Use this function to complete the reassembly of a stream and publish the message to an mcache for downstream processing. Ensure that the slot is in the BUSY state before calling this function. The function will return an error if the slot is not in the expected state or if there is mcache corruption. The base address must be aligned to FD_CHUNK_ALIGN. The function will abort if the base address is invalid for the given reassembly context. This function also manages the lifecycle of slots, marking the current slot as published and freeing the least recently published slot.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` structure representing the reassembly context. Must not be null.
    - `slot`: A pointer to an `fd_tpu_reasm_slot_t` structure representing the slot to publish. Must be in the BUSY state.
    - `mcache`: A pointer to an `fd_frag_meta_t` structure representing the metadata cache. Must not be null.
    - `base`: A pointer to the base address of the chunk, assumed to be aligned to FD_CHUNK_ALIGN. Must be valid for the reassembly context.
    - `seq`: An unsigned long representing the sequence number for the mcache fragment.
    - `tspub`: A long integer representing the publication timestamp.
    - `source_ipv4`: An unsigned integer representing the source IPv4 address.
    - `source_tpu`: An unsigned char representing the source TPU identifier.
- **Output**: Returns an integer indicating success or an error code. Returns FD_TPU_REASM_SUCCESS on success, or FD_TPU_REASM_ERR_STATE if the slot state is invalid or mcache corruption is detected.
- **See Also**: [`fd_tpu_reasm_publish`](<fd_tpu_reasm.c.md#fd_tpu_reasm_publish>)  (Implementation)


---
### fd\_tpu\_reasm\_publish\_fast<!-- {{#callable_declaration:fd_tpu_reasm_publish_fast}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L307>)

Publishes a transaction to the mcache for downstream consumption.
- **Description**: Use this function to publish a transaction to the mcache after reassembly. It is a streamlined version that combines acquiring a slot, adding a fragment, and publishing. Ensure that the `data` size does not exceed `FD_TPU_REASM_MTU`. The `base` pointer must be aligned to `FD_CHUNK_ALIGN`. The function returns specific error codes if the data size is too large or if there is a state error, which can occur due to mcache corruption or slot state issues.
- **Inputs**:
    - `reasm`: Pointer to an `fd_tpu_reasm_t` structure. Must not be null and should be properly initialized.
    - `data`: Pointer to the transaction data to be published. Must not be null and the size must not exceed `FD_TPU_REASM_MTU`.
    - `sz`: Size of the transaction data. Must be less than or equal to `FD_TPU_REASM_MTU`.
    - `mcache`: Pointer to an `fd_frag_meta_t` structure representing the mcache. Must not be null.
    - `base`: Pointer to the base address of the chunk, assumed to be aligned to `FD_CHUNK_ALIGN`. Must not be null.
    - `seq`: Sequence number for the mcache fragment. Must be a valid sequence number.
    - `tspub`: Timestamp for when the transaction is published. Must be a valid timestamp.
    - `source_ipv4`: IPv4 address of the source. Must be a valid IPv4 address.
    - `source_tpu`: TPU source identifier. Must be a valid identifier.
- **Output**: Returns an integer status code: `FD_TPU_REASM_SUCCESS` on success, `FD_TPU_REASM_ERR_SZ` if the data size is too large, or `FD_TPU_REASM_ERR_STATE` if there is a state error.
- **See Also**: [`fd_tpu_reasm_publish_fast`](<fd_tpu_reasm.c.md#fd_tpu_reasm_publish_fast>)  (Implementation)


---
### fd\_tpu\_reasm\_cancel<!-- {{#callable_declaration:fd_tpu_reasm_cancel}} -->
[View Source →](<../../../../../src/disco/quic/fd_tpu.h#L320>)

Cancels the specified stream reassembly.
- **Description**: Use this function to cancel an ongoing stream reassembly for a given slot. This is necessary when a stream reassembly is no longer needed or must be aborted due to errors or other conditions. The function should only be called if the slot is in a busy state, indicating active reassembly. After cancellation, the slot is reset to a free state and is available for new reassembly tasks.
- **Inputs**:
    - `reasm`: A pointer to an `fd_tpu_reasm_t` structure representing the reassembly context. The caller retains ownership and must ensure it is valid.
    - `slot`: A pointer to an `fd_tpu_reasm_slot_t` structure representing the reassembly slot to cancel. The slot must be in a busy state; otherwise, the function returns immediately without making changes.
- **Output**: None
- **See Also**: [`fd_tpu_reasm_cancel`](<fd_tpu_reasm.c.md#fd_tpu_reasm_cancel>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)