<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a client for keyguard operations, including initialization and signing requests.

# Purpose
The code defines a client interface for a keyguard system, which is responsible for handling cryptographic signing requests. It includes two main functions: [`fd_keyguard_client_new`](<#fd_keyguard_client_new>) and [`fd_keyguard_client_sign`](<#fd_keyguard_client_sign>). The [`fd_keyguard_client_new`](<#fd_keyguard_client_new>) function initializes a new keyguard client using shared memory and metadata caches for request and response handling. It sets up the necessary data structures and memory configurations to manage the request and response data flows. The function takes parameters for shared memory, request and response metadata caches, data caches, and the maximum transmission unit (MTU) for requests.

The [`fd_keyguard_client_sign`](<#fd_keyguard_client_sign>) function processes a signing request by copying the data to be signed into a designated memory location and publishing the request to a metadata cache. It waits for a response, ensuring that the request is not overrun or timed out. The function then retrieves the signature from the response cache and verifies the integrity of the response sequence. This code is part of a larger system that likely involves inter-process communication and shared memory management, as indicated by the use of shared memory and metadata caches. The code does not define public APIs or external interfaces but rather provides internal functionality for managing cryptographic signing operations within a specific application context.
# Imports and Dependencies

---
- `fd_keyguard_client.h`
- `../../tango/mcache/fd_mcache.h`
- `../../tango/dcache/fd_dcache.h`


# Functions

---
### fd\_keyguard\_client\_new<!-- {{#callable:fd_keyguard_client_new}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.c#L6>)

Initializes a `fd_keyguard_client_t` structure with request and response metadata and data cache information.
- **Inputs**:
    - `shmem`: A pointer to shared memory where the `fd_keyguard_client_t` structure will be initialized.
    - `request_mcache`: A pointer to the request metadata cache.
    - `request_dcache`: A pointer to the request data cache.
    - `response_mcache`: A pointer to the response metadata cache.
    - `response_dcache`: A pointer to the response data cache.
    - `request_mtu`: The maximum transmission unit size for the request.
- **Logic and Control Flow**:
    - Cast `shmem` to a `fd_keyguard_client_t` pointer and assign it to `client`.
    - Initialize `client->request` with `request_mcache`.
    - Set `client->request_depth` using `fd_mcache_depth` with `request_mcache`.
    - Initialize `client->request_seq` to 0.
    - Set `client->request_mem` using `fd_wksp_containing` with `request_dcache`.
    - Set `client->request_chunk0` using `fd_dcache_compact_chunk0` with `client->request_mem` and `request_dcache`.
    - Set `client->request_wmark` using `fd_dcache_compact_wmark` with `client->request_mem`, `request_dcache`, and `request_mtu`.
    - Initialize `client->request_chunk` with `client->request_chunk0`.
    - Set `client->request_mtu` with `request_mtu`.
    - Initialize `client->response` with `response_mcache`.
    - Set `client->response_depth` using `fd_mcache_depth` with `response_mcache`.
    - Initialize `client->response_seq` to 0.
    - Set `client->response_mem` using `fd_wksp_containing` with `response_dcache`.
    - Set `client->response_chunk0` using `fd_dcache_compact_chunk0` with `client->response_mem` and `response_dcache`.
    - Set `client->response_wmark` using `fd_dcache_compact_wmark` with `client->response_mem`, `response_dcache`, and a fixed value of 64.
- **Output**: Returns the `shmem` pointer, now initialized as a `fd_keyguard_client_t` structure.


---
### fd\_keyguard\_client\_sign<!-- {{#callable:fd_keyguard_client_sign}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.c#L34>)

Processes a signing request by copying data to a request memory, publishing it, and then retrieving the signature from the response memory.
- **Inputs**:
    - `client`: A pointer to an `fd_keyguard_client_t` structure that contains the client state and memory configurations.
    - `signature`: A pointer to a buffer where the resulting signature will be stored.
    - `sign_data`: A pointer to the data that needs to be signed.
    - `sign_data_len`: The length of the data to be signed.
    - `sign_type`: An integer representing the type of signature to be used.
- **Logic and Control Flow**:
    - Check if `sign_data_len` is less than or equal to `client->request_mtu` using `FD_TEST` macro.
    - Convert the current request chunk to a local address and copy `sign_data` into it.
    - Publish the request using `fd_mcache_publish` with the signature type and data length.
    - Increment the request sequence number and update the request chunk to the next available chunk.
    - Wait for a response using `FD_MCACHE_WAIT`, checking for timeouts or overruns.
    - Validate the response chunk is within the expected range using `FD_TEST`.
    - Copy the signature from the response memory to the `signature` buffer.
    - Check for overruns in the response sequence and increment the response sequence number.
- **Output**: The function does not return a value but writes the signature to the provided `signature` buffer.



---
Made with ❤️ by [Driver](https://www.driver.ai/)