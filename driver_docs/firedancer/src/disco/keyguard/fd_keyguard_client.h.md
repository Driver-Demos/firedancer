<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a blocking client for a remote signing server using shared memory for secure communication.

# Purpose
The `fd_keyguard_client.h` file defines a client interface for interacting with a remote signing server. This interface is designed to facilitate secure communication between a calling tile and a keyguard tile using shared memory. The file includes the definition of the `fd_keyguard_client_t` structure, which holds metadata and memory pointers for request and response operations. The client is responsible for sending signing requests to the server and receiving signatures in response. The design ensures that the shared memory used for communication is secure and exclusive to the involved tiles, with specific alignment and footprint requirements.

The file provides several functions for managing the lifecycle of a `fd_keyguard_client_t` instance, including [`fd_keyguard_client_new`](<#fd_keyguard_client_new>), [`fd_keyguard_client_join`](<#fd_keyguard_client_join>), [`fd_keyguard_client_leave`](<#fd_keyguard_client_leave>), and [`fd_keyguard_client_delete`](<#fd_keyguard_client_delete>). The [`fd_keyguard_client_sign`](<#fd_keyguard_client_sign>) function is a key component, as it sends a signing request and waits for a response. This function does not handle errors or timeouts, as it is designed to block until a response is received. The file also includes security guidelines to ensure that the memory regions used for requests and responses are properly isolated and formatted according to predefined roles.
# Imports and Dependencies

---
- `../../tango/fd_tango_base.h`


# Data Structures

---
### fd\_keyguard\_client
- **Type**: ``struct fd_keyguard_client``
- **Members**:
    - ``request``: Pointer to the request fragment metadata.
    - ``request_seq``: Sequence number for the request.
    - ``request_depth``: Depth of the request queue.
    - ``request_mem``: Pointer to the workspace memory for the request.
    - ``request_chunk``: Chunk identifier for the request.
    - ``request_chunk0``: Initial chunk identifier for the request.
    - ``request_wmark``: Watermark for the request.
    - ``request_mtu``: Maximum transmission unit for the request.
    - ``response``: Pointer to the response fragment metadata.
    - ``response_seq``: Sequence number for the response.
    - ``response_depth``: Depth of the response queue.
    - ``response_mem``: Pointer to the workspace memory for the response.
    - ``response_chunk0``: Initial chunk identifier for the response.
    - ``response_wmark``: Watermark for the response.
- **Description**: Represents a client structure for a remote signing server, managing request and response metadata, sequence numbers, memory workspaces, and other parameters necessary for communication with the server.


---
### fd\_keyguard\_client\_t
- **Type**: ``struct``
- **Members**:
    - ``request``: Pointer to `fd_frag_meta_t` for the request metadata cache.
    - ``request_seq``: Sequence number for the request.
    - ``request_depth``: Depth of the request queue.
    - ``request_mem``: Pointer to `fd_wksp_t` for the request memory workspace.
    - ``request_chunk``: Chunk identifier for the request.
    - ``request_chunk0``: Initial chunk identifier for the request.
    - ``request_wmark``: Watermark for the request.
    - ``request_mtu``: Maximum transmission unit for the request.
    - ``response``: Pointer to `fd_frag_meta_t` for the response metadata cache.
    - ``response_seq``: Sequence number for the response.
    - ``response_depth``: Depth of the response queue.
    - ``response_mem``: Pointer to `fd_wksp_t` for the response memory workspace.
    - ``response_chunk0``: Initial chunk identifier for the response.
    - ``response_wmark``: Watermark for the response.
- **Description**: Represents a client structure for interacting with a remote signing server, using shared memory for request and response handling. The structure includes metadata and memory management fields for both request and response operations, ensuring secure and exclusive access to shared resources between the calling tile and the keyguard tile.


# Functions

---
### fd\_keyguard\_client\_join<!-- {{#callable:fd_keyguard_client_join}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.h#L61>)

Casts a generic pointer to a `fd_keyguard_client_t` pointer.
- **Inputs**:
    - `shclient`: A pointer to a shared memory client object that needs to be cast to `fd_keyguard_client_t`.
- **Logic and Control Flow**:
    - Casts the input pointer `shclient` to a `fd_keyguard_client_t` pointer.
    - Returns the casted pointer.
- **Output**: A pointer of type `fd_keyguard_client_t`.


---
### fd\_keyguard\_client\_leave<!-- {{#callable:fd_keyguard_client_leave}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.h#L64>)

Converts a `fd_keyguard_client_t` pointer to a `void` pointer.
- **Inputs**:
    - `client`: A pointer to a `fd_keyguard_client_t` structure.
- **Logic and Control Flow**:
    - Casts the `client` pointer from `fd_keyguard_client_t` type to `void` type.
    - Returns the casted `void` pointer.
- **Output**: A `void` pointer that represents the input `fd_keyguard_client_t` pointer.


---
### fd\_keyguard\_client\_delete<!-- {{#callable:fd_keyguard_client_delete}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.h#L67>)

Returns the input pointer `shclient` without modification.
- **Inputs**:
    - `shclient`: A pointer to a shared client object that is to be deleted.
- **Logic and Control Flow**:
    - The function takes a single input parameter `shclient`.
    - It returns the same `shclient` pointer without any changes.
- **Output**: The same pointer `shclient` that was passed as input.


# Function Declarations (Public API)

---
### fd\_keyguard\_client\_new<!-- {{#callable_declaration:fd_keyguard_client_new}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.h#L51>)

Creates a new keyguard client in shared memory.
- **Description**: Use this function to initialize a keyguard client in a shared memory region for communication with a remote signing server. Ensure that the request and response memory caches and data regions are in shared memory maps accessible only to the calling and keyguard tiles, with appropriate read-only permissions. The function sets up the client with the provided request and response caches and data regions, and configures the request maximum transmission unit (MTU). This function must be called before any operations with the keyguard client.
- **Inputs**:
    - `shmem`: Pointer to a shared memory region where the keyguard client will be initialized. Must not be null.
    - `request_mcache`: Pointer to the request memory cache. Must not be null and should be in a shared memory map accessible only to the calling and keyguard tiles.
    - `request_dcache`: Pointer to the request data cache. Must not be null and should be in a shared memory map accessible only to the calling and keyguard tiles.
    - `response_mcache`: Pointer to the response memory cache. Must not be null and should be in a shared memory map accessible only to the calling and keyguard tiles.
    - `response_dcache`: Pointer to the response data cache. Must not be null and should be in a shared memory map accessible only to the calling and keyguard tiles.
    - `request_mtu`: Maximum transmission unit for requests. Must be a valid size for the data being transmitted.
- **Output**: Returns a pointer to the initialized keyguard client in the shared memory region.
- **See Also**: [`fd_keyguard_client_new`](<fd_keyguard_client.c.md#fd_keyguard_client_new>)  (Implementation)


---
### fd\_keyguard\_client\_sign<!-- {{#callable_declaration:fd_keyguard_client_sign}} -->
[View Source →](<../../../../../src/disco/keyguard/fd_keyguard_client.h#L90>)

Sends a signing request to a remote server and waits for the response.
- **Description**: Use this function to send data to a remote signing server for signing. The function blocks until it receives a response, which contains the signature. Ensure that the request and response memory regions are correctly set up and accessible only to the calling and keyguard tiles for security. The function does not handle errors or timeouts, so it will hang indefinitely if the server does not respond. The data to be signed must match the expected format for the assigned role, or the program will abort.
- **Inputs**:
    - `client`: A pointer to an `fd_keyguard_client_t` structure. Must not be null and must be properly initialized.
    - `signature`: A pointer to a buffer where the 64-byte signature will be stored. Must not be null and must have space for at least 64 bytes.
    - `sign_data`: A pointer to the data to be signed. Must not be null and must point to a buffer with at least `sign_data_len` bytes.
    - `sign_data_len`: The length of the data to be signed. Must be less than or equal to `client->request_mtu`.
    - `sign_type`: An integer representing the type of signing operation. Must be a valid value from `FD_KEYGUARD_SIGN_TYPE_{...}`.
- **Output**: None
- **See Also**: [`fd_keyguard_client_sign`](<fd_keyguard_client.c.md#fd_keyguard_client_sign>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)