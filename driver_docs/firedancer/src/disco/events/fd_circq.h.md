<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a fixed-size circular buffer for message queuing with push and pop operations, including metadata handling.

# Purpose
The code defines a C header file for a circular queue implementation, which is a data structure that manages a fixed-size queue of messages. The circular queue supports two primary operations: [`fd_circq_push_back`](<#fd_circq_push_back>) to add messages to the end of the queue and [`fd_circq_pop_front`](<#fd_circq_pop_front>) to remove messages from the front. The circular queue is designed to ensure that the `push_back` operation always succeeds by evicting the oldest messages if necessary to make space for new ones. This is achieved by storing both the message data and its metadata within the same buffer, which includes pointers to the next message in the queue.

The header file defines the structure `fd_circq_t`, which includes metadata such as the current count of elements, head and tail offsets, and metrics for dropped messages. It provides function prototypes for creating, joining, leaving, and deleting circular queues, as well as for pushing and popping messages. The [`fd_circq_push_back`](<#fd_circq_push_back>) function ensures that messages are aligned correctly and fit within the buffer, while [`fd_circq_pop_front`](<#fd_circq_pop_front>) retrieves the oldest message. The file also includes alignment and footprint functions to manage memory layout and size calculations.
# Imports and Dependencies

---
- `../fd_disco_base.h`


# Data Structures

---
### fd\_circq\_private
- **Type**: ``struct fd_circq_private``
- **Members**:
    - ``cnt``: Stores the current count of elements in the queue.
    - ``head``: Stores the offset of the metadata for the first message in the queue.
    - ``tail``: Stores the offset of the metadata for the last message in the queue.
    - ``size``: Represents the size of the circular queue.
    - ``metrics.drop_cnt``: Tracks the number of dropped messages in the queue.
- **Description**: A structure aligned to 4096 bytes, representing a circular queue with fixed size, where `cnt` tracks the number of elements, `head` and `tail` manage the offsets for the first and last messages, and `metrics.drop_cnt` records the number of dropped messages. The structure includes padding to align to 4k.


---
### fd\_circq\_t
- **Type**: ``struct``
- **Members**:
    - ``cnt``: Current count of elements in the queue.
    - ``head``: Offset of the metadata for the first message in the queue.
    - ``tail``: Offset of the metadata for the last message in the queue.
    - ``size``: Size of the circular buffer.
    - ``metrics.drop_cnt``: Count of dropped messages due to buffer overflow.
- **Description**: A circular buffer structure that stores a queue of messages with fixed size, supporting operations to push messages to the back and pop messages from the front. It ensures that `push_back` operations always succeed by evicting old messages if necessary. The buffer stores both message data and metadata within itself, with `head` and `tail` indicating the positions of the first and last messages, respectively. The structure is aligned to 4096 bytes and includes a metrics field to track dropped messages.


# Function Declarations (Public API)

---
### fd\_circq\_align<!-- {{#callable_declaration:fd_circq_align}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L54>)

Returns the alignment requirement for the circular buffer.
- **Description**: Use this function to obtain the alignment requirement for the circular buffer used in the circular queue implementation. This alignment value is necessary when allocating memory for the circular buffer to ensure proper alignment and performance. The function does not require any parameters and can be called at any time to retrieve the alignment value.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement for the circular buffer.
- **See Also**: [`fd_circq_align`](<fd_circq.c.md#fd_circq_align>)  (Implementation)


---
### fd\_circq\_footprint<!-- {{#callable_declaration:fd_circq_footprint}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L59>)

Calculates the memory footprint of a circular queue.
- **Description**: Use this function to determine the total memory size required to store a circular queue with a specified data buffer size. This is useful when allocating memory for the queue to ensure that the entire structure, including its metadata, fits within the allocated space. The function does not perform any validation on the input size, so ensure that the size is appropriate for your application's needs.
- **Inputs**:
    - `sz`: The size of the data buffer in bytes. Must be a non-negative value. The function does not validate this parameter, so the caller must ensure it is suitable for the intended use.
- **Output**: Returns the total memory size in bytes required for the circular queue, including its metadata.
- **See Also**: [`fd_circq_footprint`](<fd_circq.c.md#fd_circq_footprint>)  (Implementation)


---
### fd\_circq\_new<!-- {{#callable_declaration:fd_circq_new}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L62>)

Initializes a circular queue in shared memory.
- **Description**: Use this function to initialize a circular queue in a provided shared memory region. This function sets up the queue's internal counters and pointers, preparing it for use. The shared memory must be large enough to accommodate the queue structure and its metadata. The function does not allocate memory; it only initializes the provided memory region. Ensure that the shared memory is properly aligned and that the size parameter is correctly specified to avoid undefined behavior.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region where the circular queue will be initialized. Must not be null and must be properly aligned to `FD_CIRCQ_ALIGN`.
    - `sz`: The size of the circular queue. Must be a positive integer that specifies the number of elements the queue can hold.
- **Output**: Returns a pointer to the initialized shared memory region, which is the same as the input `shmem` pointer.
- **See Also**: [`fd_circq_new`](<fd_circq.c.md#fd_circq_new>)  (Implementation)


---
### fd\_circq\_join<!-- {{#callable_declaration:fd_circq_join}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L66>)

Joins a shared buffer to a circular queue.
- **Description**: Use this function to associate a shared memory buffer with a circular queue structure. This operation is necessary before performing any queue operations on the buffer. Ensure that the shared buffer is properly allocated and aligned according to the requirements of the circular queue. This function does not perform any validation on the input buffer, so incorrect usage may lead to undefined behavior.
- **Inputs**:
    - `shbuf`: A pointer to a shared memory buffer that will be used as the circular queue. The buffer must be properly allocated and aligned. The caller retains ownership of the buffer, and the function does not check for null or invalid pointers.
- **Output**: Returns a pointer to an `fd_circq_t` structure that represents the circular queue associated with the provided buffer.
- **See Also**: [`fd_circq_join`](<fd_circq.c.md#fd_circq_join>)  (Implementation)


---
### fd\_circq\_leave<!-- {{#callable_declaration:fd_circq_leave}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L69>)

Leaves the circular buffer context.
- **Description**: Use this function to leave the context of a circular buffer after operations are complete. It is typically called when the buffer is no longer needed in the current scope. This function does not modify the buffer or its contents, and it does not free any resources. Ensure that any necessary cleanup or resource deallocation is handled separately.
- **Inputs**:
    - `buf`: A pointer to an `fd_circq_t` structure representing the circular buffer. Must not be null. The caller retains ownership of the buffer, and the function does not validate the pointer.
- **Output**: Returns the same pointer that was passed in, cast to a `void *`. This can be used for further operations or cleanup.
- **See Also**: [`fd_circq_leave`](<fd_circq.c.md#fd_circq_leave>)  (Implementation)


---
### fd\_circq\_delete<!-- {{#callable_declaration:fd_circq_delete}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L72>)

Deletes a circular buffer.
- **Description**: Use this function to delete a circular buffer that was previously created. This function should be called when the buffer is no longer needed to release any associated resources. Ensure that the buffer is not in use by any other operations before calling this function to avoid undefined behavior.
- **Inputs**:
    - `shbuf`: A pointer to the shared memory buffer representing the circular buffer. Must not be null. The caller retains ownership of the memory, and the function returns this pointer unchanged.
- **Output**: Returns the same pointer passed as input, allowing for potential chaining of operations.
- **See Also**: [`fd_circq_delete`](<fd_circq.c.md#fd_circq_delete>)  (Implementation)


---
### fd\_circq\_push\_back<!-- {{#callable_declaration:fd_circq_push_back}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L83>)

Appends a message to the circular buffer, evicting old messages if necessary.
- **Description**: Use this function to add a new message to a circular buffer. It ensures that the message is appended even if it requires evicting older messages to make space. This function must be called with a valid circular buffer that has been properly initialized. The alignment must be a power of 2 and not exceed 4096. If the message size, including metadata, is too large to fit in the buffer, or if the alignment is invalid, the function will return NULL.
- **Inputs**:
    - `circq`: A pointer to a `fd_circq_t` structure representing the circular buffer. Must not be null and must point to a valid, initialized circular buffer.
    - `align`: Specifies the alignment for the message. Must be a power of 2 and not greater than 4096. If invalid, the function returns NULL.
    - `footprint`: The size of the message to append, in bytes. The total size including metadata must not exceed the buffer size. If it does, the function returns NULL.
- **Output**: Returns a pointer to the location in the buffer where the message is stored, or NULL if the operation fails due to invalid alignment or insufficient space.
- **See Also**: [`fd_circq_push_back`](<fd_circq.c.md#fd_circq_push_back>)  (Implementation)


---
### fd\_circq\_pop\_front<!-- {{#callable_declaration:fd_circq_pop_front}} -->
[View Source →](<../../../../../src/disco/events/fd_circq.h#L94>)

Removes and returns the oldest message from the circular buffer.
- **Description**: Use this function to retrieve and remove the oldest message from a circular buffer. It is important to call this function only when there are messages in the buffer, as it returns `NULL` if the buffer is empty. The returned message remains valid until the next call to `fd_circq_push_back`. This function is useful in scenarios where you need to process messages in a first-in, first-out (FIFO) order.
- **Inputs**:
    - `circq`: A pointer to an `fd_circq_t` structure representing the circular buffer. Must not be null. The buffer should be properly initialized and joined before calling this function.
- **Output**: Returns a pointer to the oldest message in the buffer, or `NULL` if the buffer is empty.
- **See Also**: [`fd_circq_pop_front`](<fd_circq.c.md#fd_circq_pop_front>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)