<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall handling with architecture-specific checks and conditions.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. The file is automatically generated and should not be edited manually. It includes several Linux headers related to auditing, capabilities, filtering, and seccomp, which are necessary for defining and applying the seccomp filter. The code is designed to work on specific architectures, such as `i386`, `x86_64`, and `aarch64`, and it will produce an error if the target architecture is unsupported.

The main functionality of the code is to populate a `sock_filter` array with a predefined set of instructions that enforce a security policy by allowing or denying specific system calls based on their arguments. The filter contains 97 instructions that check the architecture and various system calls like `read`, `write`, `recvmsg`, `sendmsg`, and others. Some system calls are allowed unconditionally, while others are allowed based on specific conditions. If a system call does not match any of the allowed conditions, the process is terminated. The function [`populate_sock_filter_policy_fd_bundle_tile`](<#populate_sock_filter_policy_fd_bundle_tile>) is responsible for copying the filter instructions into an output array, which can then be used to enforce the security policy at runtime.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_bundle\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: The variable `sock_filter_policy_fd_bundle_tile_instr_cnt` is a constant of type `unsigned int` with a value of 97. It represents the number of instructions in a socket filter policy.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_bundle_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_bundle\_tile<!-- {{#callable:populate_sock_filter_policy_fd_bundle_tile}} -->
[View Source →](<../../../../../../src/disco/bundle/generated/fd_bundle_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined set of BPF instructions to enforce a seccomp policy for system call filtering.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, expected to be at least 97.
    - `out`: A pointer to a `sock_filter` array where the BPF instructions will be copied.
    - `logfile_fd`: A file descriptor for a log file, used in the `fsync` check.
    - `keylog_fd`: A file descriptor for a key log, used in the `writev` check.
    - `etc_hosts_fd`: A file descriptor for the `/etc/hosts` file, used in the `lseek` check.
    - `etc_resolv_conf`: A file descriptor for the `/etc/resolv.conf` file, used in the `lseek` check.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 97 using `FD_TEST` macro.
    - Defines a `sock_filter` array `filter` with 97 BPF instructions.
    - Loads the architecture from `seccomp_data` and compares it with `ARCH_NR`; jumps to `RET_KILL_PROCESS` if they do not match.
    - Loads the syscall number and checks against a list of allowed syscalls, jumping to specific labels for further checks or directly to `RET_ALLOW`.
    - For certain syscalls like `recvmsg`, `writev`, `sendmsg`, `sendto`, `fsync`, `socket`, `shutdown`, `fcntl`, `bind`, `setsockopt`, and `lseek`, additional checks are performed on syscall arguments.
    - If no conditions are met, the default action is to jump to `RET_KILL_PROCESS`.
    - Copies the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)