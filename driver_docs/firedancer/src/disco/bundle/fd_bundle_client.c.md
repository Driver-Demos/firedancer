<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Handles gRPC tasks for a bundle client, including connection management, subscription handling, and transaction processing.

# Purpose
The `fd_bundle_client.c` file implements a client for handling gRPC connections related to bundle transactions. It is designed to manage network communication, specifically for subscribing to and processing packets and bundles from a server. The file includes functions for establishing and maintaining a TCP connection, handling SSL if enabled, and managing gRPC requests and responses. It also includes mechanisms for handling connection timeouts, backoff strategies, and logging connection status.

The code defines several key functions and structures, such as [`fd_bundle_client_reset`](<#fd_bundle_client_reset>), [`fd_bundle_client_create_conn`](<#fd_bundle_client_create_conn>), and [`fd_bundle_client_step`](<#fd_bundle_client_step>), which manage the lifecycle of the connection and the processing of incoming data. The file also includes callback functions for gRPC events, such as connection establishment and message reception. The client is responsible for subscribing to specific gRPC services, handling protobuf-encoded messages, and publishing transactions to a message bus. The code is structured to handle various network and protocol-related errors, ensuring robust communication with the server.
# Imports and Dependencies

---
- `fd_bundle_auth.h`
- `fd_bundle_tile_private.h`
- `proto/block_engine.pb.h`
- `proto/bundle.pb.h`
- `proto/packet.pb.h`
- `../fd_txn_m.h`
- `../plugin/fd_plugin.h`
- `../../waltz/h2/fd_h2_conn.h`
- `../../waltz/http/fd_url.h`
- `../../ballet/base58/fd_base58.h`
- `../../ballet/nanopb/pb_decode.h`
- `../../util/net/fd_ip4.h`
- `fcntl.h`
- `errno.h`
- `unistd.h`
- `poll.h`
- `sys/socket.h`
- `netinet/in.h`
- `netinet/ip.h`
- `netinet/tcp.h`


# Global Variables

---
### fd\_bundle\_client\_grpc\_callbacks
- **Type**: ``fd_grpc_client_callbacks_t``
- **Description**: Defines a set of callback functions for handling gRPC client events in the context of a bundle client. These callbacks manage connection establishment, connection termination, transmission completion, reception start, message reception, reception end, reception timeout, and ping acknowledgment.
- **Use**: Used to handle various gRPC client events for a bundle client.


# Functions

---
### fd\_bundle\_now<!-- {{#callable:fd_bundle_now}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L30>)

Returns the current wall clock time by calling `fd_log_wallclock()`.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the function `fd_log_wallclock()` to get the current wall clock time.
    - Returns the result of `fd_log_wallclock()`.
- **Output**: A `long` integer representing the current wall clock time.


---
### fd\_bundle\_client\_reset<!-- {{#callable:fd_bundle_client_reset}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L35>)

Resets the state of a `fd_bundle_tile_t` context, including closing TCP connections, resetting SSL, and clearing various flags and metrics.
- **Inputs**:
    - `ctx`: A pointer to a `fd_bundle_tile_t` structure representing the context to reset.
- **Logic and Control Flow**:
    - Checks if `ctx->tcp_sock` is open (>= 0) and attempts to close it, logging an error if the close operation fails.
    - Sets `ctx->tcp_sock` to -1 and `ctx->tcp_sock_connected` to 0 to indicate the socket is closed.
    - Resets various flags in `ctx` such as `defer_reset`, `builder_info_avail`, `builder_info_wait`, `packet_subscription_live`, `packet_subscription_wait`, `bundle_subscription_live`, and `bundle_subscription_wait` to 0.
    - Clears the `ctx->rtt` array using `memset`.
    - If OpenSSL is enabled and `ctx->ssl` is not NULL, frees the SSL object and sets `ctx->ssl` to NULL.
    - Calls [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>) to handle backoff logic with the current time.
    - Resets the `ctx->auther` and `ctx->grpc_client` using [`fd_bundle_auther_reset`](<fd_bundle_auth.c.md#fd_bundle_auther_reset>) and `fd_grpc_client_reset` respectively.
- **Output**: No return value; the function operates directly on the `ctx` structure to reset its state.
- **Functions Called**:
    - [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>)
    - [`fd_bundle_now`](<#fd_bundle_now>)
    - [`fd_bundle_auther_reset`](<fd_bundle_auth.c.md#fd_bundle_auther_reset>)


---
### fd\_bundle\_client\_do\_connect<!-- {{#callable:fd_bundle_client_do_connect}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L68>)

Attempts to establish a TCP connection to a server using the provided context and IP address.
- **Inputs**:
    - ``ctx``: A pointer to a constant `fd_bundle_tile_t` structure that contains the context for the connection, including the TCP socket and server port.
    - ``ip4_addr``: An unsigned integer representing the IPv4 address of the server to connect to.
- **Logic and Control Flow**:
    - Initializes a `sockaddr_in` structure with the IPv4 address, port (converted using `fd_ushort_bswap`), and address family `AF_INET`.
    - Sets the global `errno` variable to 0 to clear any previous error state.
    - Calls the `connect` function with the TCP socket from `ctx`, the address structure, and its size to attempt a connection.
    - Returns the value of `errno`, which indicates the success or failure of the connection attempt.
- **Output**: Returns an integer representing the error code from the `connect` function, with 0 indicating success and any other value indicating an error.


---
### fd\_bundle\_client\_create\_conn<!-- {{#callable:fd_bundle_client_create_conn}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L81>)

Establishes a TCP connection to a server, optionally using SSL, and initializes related settings and structures.
- **Inputs**:
    - `ctx`: A pointer to an `fd_bundle_tile_t` structure that contains context and configuration for the connection.
- **Logic and Control Flow**:
    - Calls [`fd_bundle_client_reset`](<#fd_bundle_client_reset>) to reset the client state.
    - Sets up `fd_addrinfo_t` with IPv4 family and calls `fd_getaddrinfo` to resolve the server's address.
    - Logs a warning and resets the client if address resolution fails, incrementing the transport failure count.
    - Extracts the IPv4 address from the resolved address and stores it in `ctx->server_ip4_addr`.
    - Creates a TCP socket with `SOCK_STREAM` and `SOCK_CLOEXEC` flags, logging an error if socket creation fails.
    - Stores the socket descriptor in `ctx->tcp_sock`.
    - Sets the socket receive buffer size using `setsockopt` and logs an error if it fails.
    - Enables TCP_NODELAY on the socket to disable Nagle's algorithm, logging an error if it fails.
    - Sets the socket to non-blocking mode using `fcntl`, logging an error if it fails.
    - Determines the connection scheme (HTTP or HTTPS) based on the `ctx->is_ssl` flag.
    - Logs the connection attempt with the server's IP address and port.
    - Calls [`fd_bundle_client_do_connect`](<#fd_bundle_client_do_connect>) to initiate the connection, handling errors and resetting the client if the connection fails immediately.
    - If SSL is enabled, creates a new SSL object, sets up the BIO, and configures SSL settings, logging errors if any step fails.
    - Resets the gRPC client and initializes keepalive settings.
- **Output**: No return value; modifies the `ctx` structure to reflect the connection state and settings.
- **Functions Called**:
    - [`fd_bundle_client_reset`](<#fd_bundle_client_reset>)
    - [`fd_bundle_client_do_connect`](<#fd_bundle_client_do_connect>)
    - [`fd_keepalive_init`](<fd_keepalive.h.md#fd_keepalive_init>)
    - [`fd_bundle_now`](<#fd_bundle_now>)


---
### fd\_bundle\_client\_drive\_io<!-- {{#callable:fd_bundle_client_drive_io}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L175>)

Handles gRPC I/O operations for a client, using either SSL or a regular socket based on the context.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that contains the context for the gRPC client, including connection details and state.
    - ``charge_busy``: A pointer to an integer that indicates whether the function should charge the client as busy.
- **Logic and Control Flow**:
    - Check if the context `ctx` is using SSL by evaluating `ctx->is_ssl`.
    - If SSL is enabled (`ctx->is_ssl` is true), call `fd_grpc_client_rxtx_ossl` with `ctx->grpc_client`, `ctx->ssl`, and `charge_busy` as arguments, and return its result.
    - If SSL is not enabled, call `fd_grpc_client_rxtx_socket` with `ctx->grpc_client`, `ctx->tcp_sock`, and `charge_busy` as arguments, and return its result.
- **Output**: Returns an integer status code from either `fd_grpc_client_rxtx_ossl` or `fd_grpc_client_rxtx_socket`, indicating the result of the I/O operation.


---
### fd\_bundle\_client\_request\_builder\_info<!-- {{#callable:fd_bundle_client_request_builder_info}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L187>)

Initiates a gRPC request to retrieve block builder fee information if the client is not blocked.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that contains the context for the gRPC client request.
- **Logic and Control Flow**:
    - Checks if the gRPC client request is blocked using `fd_grpc_client_request_is_blocked`; if blocked, the function returns immediately.
    - Initializes a `block_engine_BlockBuilderFeeInfoRequest` structure with default values.
    - Defines a static path string for the gRPC request endpoint.
    - Starts a gRPC request using `fd_grpc_client_request_start` with the specified path, request type, message, and authentication token.
    - If the request fails to start, the function returns immediately.
    - Sets a deadline for the gRPC request using `fd_grpc_client_deadline_set`.
    - Sets the `builder_info_wait` flag in the context to 1, indicating that the request is in progress.
- **Output**: No direct output; modifies the `ctx` structure to indicate the request status.


---
### fd\_bundle\_client\_subscribe\_packets<!-- {{#callable:fd_bundle_client_subscribe_packets}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L209>)

Initiates a gRPC request to subscribe to packet updates if the client is not blocked.
- **Inputs**:
    - `ctx`: A pointer to an `fd_bundle_tile_t` structure that contains the context for the gRPC client and subscription state.
- **Logic and Control Flow**:
    - Checks if the gRPC client request is blocked using `fd_grpc_client_request_is_blocked`; if blocked, the function returns immediately.
    - Initializes a `block_engine_SubscribePacketsRequest` structure with default values.
    - Defines a static path string for the gRPC request endpoint.
    - Starts a gRPC request using `fd_grpc_client_request_start` with the specified path, request type, message, and authentication token.
    - If the request fails to start, the function returns immediately.
    - Sets a deadline for the gRPC request using `fd_grpc_client_deadline_set` with a timeout value.
    - Sets the `packet_subscription_wait` flag in the context to 1, indicating that a subscription request is in progress.
- **Output**: No direct output; modifies the state of the `ctx` structure to reflect the subscription request status.


---
### fd\_bundle\_client\_subscribe\_bundles<!-- {{#callable:fd_bundle_client_subscribe_bundles}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L231>)

Initiates a gRPC request to subscribe to bundles if the client is not blocked and sets a deadline for the request.
- **Inputs**:
    - `ctx`: A pointer to an `fd_bundle_tile_t` structure that contains the context for the bundle client, including gRPC client and authentication details.
- **Logic and Control Flow**:
    - Checks if the gRPC client request is blocked using `fd_grpc_client_request_is_blocked`; if blocked, returns immediately.
    - Initializes a `block_engine_SubscribeBundlesRequest` structure with default values.
    - Defines a static path string for the gRPC request endpoint.
    - Starts a gRPC request using `fd_grpc_client_request_start` with the specified path, request type, message, and authentication token.
    - If the request fails to start, returns immediately.
    - Sets a deadline for the gRPC request using `fd_grpc_client_deadline_set` with a timeout value.
    - Sets the `bundle_subscription_wait` flag in the context to 1, indicating that a subscription request is in progress.
- **Output**: No direct output is returned; the function modifies the state of the `ctx` structure to reflect the subscription request status.


---
### fd\_bundle\_client\_send\_ping<!-- {{#callable:fd_bundle_client_send_ping}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L253>)

Sends a PING request to a gRPC client and updates the keepalive status if successful.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_bundle_tile_t` structure that contains the context for the gRPC client and keepalive information.
- **Logic and Control Flow**:
    - Check if `ctx->grpc_client` is NULL; if so, return immediately.
    - Retrieve the HTTP/2 connection from `ctx->grpc_client` using `fd_grpc_client_h2_conn` and check if it is NULL; if so, return.
    - Check if the connection's `flags` are set, indicating the connection is busy; if so, return.
    - Retrieve the transmission buffer `rbuf_tx` from `ctx->grpc_client` using `fd_grpc_client_rbuf_tx`.
    - Attempt to send a PING using `fd_h2_tx_ping` with the connection and transmission buffer; if successful, proceed.
    - Get the current time using [`fd_bundle_now`](<#fd_bundle_now>).
    - Call [`fd_keepalive_tx`](<fd_keepalive.h.md#fd_keepalive_tx>) to update the keepalive status with the current time.
    - Log a debug message with the remaining time until the keepalive deadline.
- **Output**: No return value; the function performs actions based on the state of the gRPC client and connection.
- **Functions Called**:
    - [`fd_bundle_now`](<#fd_bundle_now>)
    - [`fd_keepalive_tx`](<fd_keepalive.h.md#fd_keepalive_tx>)


---
### fd\_bundle\_client\_step\_reconnect<!-- {{#callable:fd_bundle_client_step_reconnect}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L268>)

Manages the reconnection process for a bundle client by checking authentication, requesting builder info, subscribing to packets and bundles, and sending keepalive pings.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_bundle_tile_t` structure that holds the context for the bundle client.
    - ``now``: A long integer representing the current time in nanoseconds.
- **Logic and Control Flow**:
    - Checks if the `auther` needs polling and calls [`fd_bundle_auther_poll`](<fd_bundle_auth.c.md#fd_bundle_auther_poll>) if necessary, returning 1 if polling is needed.
    - Verifies if the `auther` state is `FD_BUNDLE_AUTH_STATE_DONE_WAIT`; if not, returns 0.
    - Determines if builder info is expired or unavailable and not waiting, then requests builder info and returns 1.
    - Checks if packet subscription is not live and not waiting, then subscribes to packets and returns 1.
    - Checks if bundle subscription is not live and not waiting, then subscribes to bundles and returns 1.
    - Determines if a keepalive ping should be sent using [`fd_keepalive_should_tx`](<fd_keepalive.h.md#fd_keepalive_should_tx>), sends a ping if needed, and returns 1.
    - Returns 0 if no actions are taken.
- **Output**: Returns an integer indicating whether any reconnection steps were taken (1) or not (0).
- **Functions Called**:
    - [`fd_bundle_auther_poll`](<fd_bundle_auth.c.md#fd_bundle_auther_poll>)
    - [`fd_bundle_client_request_builder_info`](<#fd_bundle_client_request_builder_info>)
    - [`fd_bundle_client_subscribe_packets`](<#fd_bundle_client_subscribe_packets>)
    - [`fd_bundle_client_subscribe_bundles`](<#fd_bundle_client_subscribe_bundles>)
    - [`fd_keepalive_should_tx`](<fd_keepalive.h.md#fd_keepalive_should_tx>)
    - [`fd_bundle_client_send_ping`](<#fd_bundle_client_send_ping>)


---
### fd\_bundle\_client\_step1<!-- {{#callable:fd_bundle_client_step1}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L308>)

Manages the connection and communication with a gRPC server, handling socket connections, timeouts, and request readiness.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that holds the context for the bundle client.
    - ``charge_busy``: A pointer to an integer that indicates if the function has performed any busy work.
- **Logic and Control Flow**:
    - Checks if the TCP socket is connected; if not, it attempts to connect or handle connection errors.
    - If the gRPC client is not available, it attempts to reconnect or stall based on backoff logic.
    - Checks for HTTP/2 PING timeouts and logs a warning if a timeout occurs, then resets the connection.
    - Drives I/O operations, SSL handshakes, and inflight requests, resetting the connection if errors occur.
    - Checks if a new request can be issued and attempts to reconnect if necessary.
- **Output**: No direct output is returned, but the function modifies the state of `ctx` and updates `charge_busy` to indicate activity.
- **Functions Called**:
    - [`fd_bundle_client_do_connect`](<#fd_bundle_client_do_connect>)
    - [`fd_bundle_client_reset`](<#fd_bundle_client_reset>)
    - [`fd_bundle_now`](<#fd_bundle_now>)
    - [`fd_bundle_tile_should_stall`](<fd_bundle_tile_private.h.md#fd_bundle_tile_should_stall>)
    - [`fd_bundle_client_create_conn`](<#fd_bundle_client_create_conn>)
    - [`fd_keepalive_is_timeout`](<fd_keepalive.h.md#fd_keepalive_is_timeout>)
    - [`fd_bundle_client_drive_io`](<#fd_bundle_client_drive_io>)
    - [`fd_bundle_client_step_reconnect`](<#fd_bundle_client_step_reconnect>)


---
### fd\_bundle\_client\_log\_status<!-- {{#callable:fd_bundle_client_log_status}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L385>)

Logs the connection status change of a bundle client to a server with rate limiting.
- **Inputs**:
    - `ctx`: A pointer to an `fd_bundle_tile_t` structure that holds the context and state of the bundle client.
- **Logic and Control Flow**:
    - Retrieve the current connection status using [`fd_bundle_client_status`](<#fd_bundle_client_status>) function.
    - Determine if the connection status has changed by comparing `connected_now` and `connected_before`.
    - If the status has changed, check if the last log was more than 1 millisecond ago using `fd_log_wallclock`.
    - If the connection is now established, log a notice message; otherwise, log a warning message.
    - Update `ctx->last_bundle_status_log_nanos` with the current timestamp and `ctx->bundle_status_logged` with the current status.
- **Output**: No return value; the function logs messages to indicate connection status changes.
- **Functions Called**:
    - [`fd_bundle_client_status`](<#fd_bundle_client_status>)


---
### fd\_bundle\_client\_step<!-- {{#callable:fd_bundle_client_step}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L406>)

Executes a step in the bundle client process by performing edge-triggered logging with rate limiting.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that holds the context for the bundle client.
    - ``charge_busy``: A pointer to an integer that indicates whether the client is busy.
- **Logic and Control Flow**:
    - Calls [`fd_bundle_client_step1`](<#fd_bundle_client_step1>) with `ctx` and `charge_busy` to perform the main step logic.
    - Calls [`fd_bundle_client_log_status`](<#fd_bundle_client_log_status>) with `ctx` to log the status of the bundle client.
- **Output**: No return value; the function operates on the provided context and modifies the `charge_busy` flag.
- **Functions Called**:
    - [`fd_bundle_client_step1`](<#fd_bundle_client_step1>)
    - [`fd_bundle_client_log_status`](<#fd_bundle_client_log_status>)


---
### fd\_bundle\_tile\_backoff<!-- {{#callable:fd_bundle_tile_backoff}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L414>)

Calculates a backoff time for a network connection retry based on the current time and a random wait duration.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that holds the context for the backoff operation.
    - ``now``: A long integer representing the current time in nanoseconds.
- **Logic and Control Flow**:
    - Retrieve the current backoff iteration count from `ctx`.
    - If `now` is less than `ctx->backoff_reset`, reset the iteration count to 0.
    - Increment the iteration count.
    - Set a fixed wait duration of 2 seconds in nanoseconds.
    - Generate a random wait duration using `fd_rng_ulong` and bit manipulation to ensure it is within the range of the fixed wait duration.
    - Update `ctx->backoff_until` to the sum of `now` and the random wait duration.
    - Update `ctx->backoff_reset` to the sum of `now` and twice the random wait duration.
    - Store the updated iteration count back in `ctx`.
- **Output**: No return value; updates the `ctx` structure with new backoff timing information.


---
### fd\_bundle\_client\_grpc\_conn\_established<!-- {{#callable:fd_bundle_client_grpc_conn_established}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L431>)

Logs a message indicating that a gRPC connection has been established.
- **Inputs**: None
- **Logic and Control Flow**:
    - Casts the `app_ctx` parameter to void to indicate it is unused.
    - Logs the message 'Bundle gRPC connection established' using the `FD_LOG_INFO` macro.
- **Output**: No output is returned.


---
### fd\_bundle\_client\_grpc\_conn\_dead<!-- {{#callable:fd_bundle_client_grpc_conn_dead}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L437>)

Logs the closure of a gRPC connection and sets a flag to defer a reset.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, specifically a `fd_bundle_tile_t` structure.
    - ``h2_err``: An unsigned integer representing the HTTP/2 error code that caused the connection to close.
    - ``closed_by``: An integer indicating whether the connection was closed by the peer (non-zero) or due to an error (zero).
- **Logic and Control Flow**:
    - Cast `app_ctx` to a `fd_bundle_tile_t` pointer and store it in `ctx`.
    - Log an informational message indicating the closure of the gRPC connection, specifying whether it was closed by the peer or due to an error, and including the HTTP/2 error code and its string representation.
    - Set the `defer_reset` flag in the `ctx` structure to 1, indicating that a reset should be deferred.
- **Output**: No return value; the function operates by side effects on the `ctx` structure and logs a message.


---
### fd\_bundle\_tile\_publish\_bundle\_txn<!-- {{#callable:fd_bundle_tile_publish_bundle_txn}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L450>)

Publishes a bundle transaction to the tango message bus after preparing and verifying the transaction data.
- **Inputs**:
    - `ctx`: A pointer to the `fd_bundle_tile_t` context structure, which contains various state and configuration information.
    - `txn`: A constant pointer to the transaction data to be published.
    - `txn_sz`: The size of the transaction data, which must be less than or equal to `FD_TXN_MTU`.
    - `bundle_txn_cnt`: The count of transactions in the bundle.
    - `source_ipv4`: The source IPv4 address of the transaction.
- **Logic and Control Flow**:
    - Checks if `ctx->builder_info_avail` is false; if so, increments `ctx->metrics.missing_builder_info_fail_cnt` and returns.
    - Converts the chunk memory to a local address and initializes a `fd_txn_m_t` structure with transaction details, including payload size, source IPv4, and bundle information.
    - Copies the commission public key from `ctx->builder_pubkey` to the transaction structure and copies the transaction payload into the transaction structure.
    - Calculates the realized footprint size of the transaction and sets a signature value.
    - Checks if `ctx->stem` is null and logs a critical error if true.
    - Calculates the publication timestamp and publishes the transaction using `fd_stem_publish`.
    - Updates `ctx->verify_out.chunk` to the next compacted chunk and increments `ctx->metrics.txn_received_cnt`.
- **Output**: No return value; the function operates by side effects on the `ctx` structure and publishes the transaction.
- **Functions Called**:
    - [`fd_bundle_now`](<#fd_bundle_now>)


---
### fd\_bundle\_tile\_publish\_txn<!-- {{#callable:fd_bundle_tile_publish_txn}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L494>)

Publishes a transaction to the tango message bus with specific metadata and updates the context state.
- **Inputs**:
    - ``ctx``: A pointer to `fd_bundle_tile_t` structure, which holds the context for the transaction.
    - ``txn``: A constant pointer to the transaction data to be published.
    - ``txn_sz``: The size of the transaction data, which must be less than or equal to `FD_TXN_MTU`.
    - ``source_ipv4``: The source IPv4 address associated with the transaction.
- **Logic and Control Flow**:
    - Convert the memory chunk in `ctx->verify_out` to a local address and assign it to `txnm`.
    - Initialize `txnm` with metadata, including `reference_slot`, `payload_sz`, `txn_t_sz`, `source_ipv4`, `source_tpu`, and `block_engine` fields.
    - Copy the transaction data from `txn` to the payload of `txnm`.
    - Calculate the realized footprint size of `txnm` and store it in `sz`.
    - Check if `ctx->stem` is set; if not, log a critical error.
    - Compute the timestamp for publishing using `fd_bundle_now()` and store it in `tspub`.
    - Publish the transaction using `fd_stem_publish` with the calculated size and timestamp.
    - Update `ctx->verify_out.chunk` to the next compacted chunk using `fd_dcache_compact_next`.
    - Increment the transaction received count in `ctx->metrics.txn_received_cnt`.
- **Output**: No return value; the function updates the state of the `ctx` and publishes the transaction.
- **Functions Called**:
    - [`fd_bundle_now`](<#fd_bundle_now>)


---
### fd\_bundle\_client\_visit\_pb\_bundle\_txn\_preflight<!-- {{#callable:fd_bundle_client_visit_pb_bundle_txn_preflight}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L533>)

Increments the `bundle_txn_cnt` field of the `fd_bundle_tile_t` context structure.
- **Inputs**:
    - ``istream``: A pointer to a `pb_istream_t` structure, which is not used in this function.
    - ``field``: A pointer to a `pb_field_t` constant structure, which is not used in this function.
    - ``arg``: A pointer to a pointer to a `void`, which is expected to point to a `fd_bundle_tile_t` structure.
- **Logic and Control Flow**:
    - Cast the `arg` parameter to a `fd_bundle_tile_t` pointer and assign it to `ctx`.
    - Increment the `bundle_txn_cnt` field of the `ctx` structure.
    - Return `true` to indicate successful execution.
- **Output**: Returns `true` to indicate successful execution.


---
### fd\_bundle\_client\_visit\_pb\_bundle\_txn<!-- {{#callable:fd_bundle_client_visit_pb_bundle_txn}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L548>)

Processes a protobuf stream to decode and publish bundle transactions to a message bus.
- **Inputs**:
    - ``istream``: A pointer to a `pb_istream_t` structure representing the input stream from which to decode the protobuf data.
    - ``field``: A pointer to a `pb_field_t` structure, which is not used in this function.
    - ``arg``: A pointer to a pointer to a `fd_bundle_tile_t` structure, which holds the context for the bundle client.
- **Logic and Control Flow**:
    - Initialize a `packet_Packet` structure with default values.
    - Attempt to decode the protobuf data from `istream` into the `packet` structure.
    - If decoding fails, increment the `decode_fail_cnt` metric in the context and log a warning, then return `false`.
    - Check if the packet data size is zero; if so, log a warning and return `true` to ignore the packet.
    - Check if the packet data size exceeds `FD_TXN_MTU`; if so, log a warning and return `true` to ignore the packet.
    - Determine the source IPv4 address using the packet metadata or default to the server's IP address.
    - Call [`fd_bundle_tile_publish_bundle_txn`](<#fd_bundle_tile_publish_bundle_txn>) to publish the transaction data to the message bus.
    - Return `true` to indicate successful processing.
- **Output**: Returns a boolean value: `true` if the transaction is successfully processed or ignored due to size constraints, and `false` if there is a decoding failure.
- **Functions Called**:
    - [`fd_bundle_tile_publish_bundle_txn`](<#fd_bundle_tile_publish_bundle_txn>)


---
### fd\_bundle\_client\_sample\_rx\_delay<!-- {{#callable:fd_bundle_client_sample_rx_delay}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L585>)

Calculates the receive delay of a message by comparing the current cached timestamp with the original timestamp of the message.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that contains the context, including metrics for message receive delay.
    - ``ts``: A pointer to a `google_protobuf_Timestamp` structure that contains the original timestamp of the message, with seconds and nanoseconds fields.
- **Logic and Control Flow**:
    - Convert the original timestamp `ts` from seconds and nanoseconds to a single `ulong` value `tsorig` in nanoseconds.
    - Calculate the difference between the current cached timestamp `ctx->cached_ts` and `tsorig` using `fd_ulong_sat_sub`.
    - Record the calculated delay in the `msg_rx_delay` metric of the context `ctx` using `fd_histf_sample`.
- **Output**: No return value; the function updates the `msg_rx_delay` metric in the provided context.


---
### fd\_bundle\_client\_visit\_pb\_bundle\_uuid<!-- {{#callable:fd_bundle_client_visit_pb_bundle_uuid}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L596>)

Processes a Protobuf stream to count and publish transactions in a bundle.
- **Inputs**:
    - ``istream``: A pointer to a `pb_istream_t` structure representing the input stream to decode.
    - ``field``: A pointer to a `pb_field_t` structure, which is not used in this function.
    - ``arg``: A pointer to a pointer to a `fd_bundle_tile_t` structure, which holds the context for the bundle processing.
- **Logic and Control Flow**:
    - Initialize the bundle transaction count to zero in the context (`ctx`).
    - Perform a first decoding pass on the input stream (`istream`) to count the number of transactions in the bundle using `fd_bundle_client_visit_pb_bundle_txn_preflight`.
    - If the first decoding pass fails, increment the decode failure count in the context's metrics and log a warning, then return `false`.
    - If the transaction count exceeds the maximum allowed (`FD_BUNDLE_CLIENT_MAX_TXN_PER_BUNDLE`), return `true` without further processing.
    - Increment the bundle sequence number in the context.
    - Perform a second decoding pass to publish the transactions using `fd_bundle_client_visit_pb_bundle_txn`.
    - If the second decoding pass fails, increment the decode failure count in the context's metrics and log a warning, then return `false`.
    - Sample the receive delay using [`fd_bundle_client_sample_rx_delay`](<#fd_bundle_client_sample_rx_delay>).
    - Return `true` to indicate successful processing.
- **Output**: Returns `true` if the bundle is processed successfully, otherwise `false` if there is a decoding error.
- **Functions Called**:
    - [`fd_bundle_client_sample_rx_delay`](<#fd_bundle_client_sample_rx_delay>)


---
### fd\_bundle\_client\_handle\_bundle\_batch<!-- {{#callable:fd_bundle_client_handle_bundle_batch}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L657>)

Handles a batch of bundle responses from a gRPC call by decoding the protobuf stream and processing each bundle UUID.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that holds the context and state information for the bundle client.
    - ``istream``: A pointer to a `pb_istream_t` structure that represents the input stream from which the function decodes the protobuf message.
- **Logic and Control Flow**:
    - Check if `ctx->builder_info_avail` is false; if so, increment `ctx->metrics.missing_builder_info_fail_cnt` and return.
    - Initialize a `block_engine_SubscribeBundlesResponse` structure with default values.
    - Set the `bundles` field of the response to a callback that uses `fd_bundle_client_visit_pb_bundle_uuid` to process each bundle UUID.
    - Attempt to decode the protobuf message from `istream` into the response structure.
    - If decoding fails, increment `ctx->metrics.decode_fail_cnt`, log a warning, and return.
- **Output**: No return value; the function modifies the `ctx` structure and logs warnings if errors occur.


---
### fd\_bundle\_client\_visit\_pb\_packet<!-- {{#callable:fd_bundle_client_visit_pb_packet}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L682>)

Processes a Protobuf packet, validates its size, and publishes it if valid.
- **Inputs**:
    - ``istream``: A pointer to a `pb_istream_t` structure representing the input stream from which the Protobuf packet is read.
    - ``field``: A pointer to a `pb_field_t` structure, which is not used in this function.
    - ``arg``: A pointer to a pointer to a `fd_bundle_tile_t` structure, which holds the context for processing the packet.
- **Logic and Control Flow**:
    - Initialize a `packet_Packet` structure with default values.
    - Attempt to decode the Protobuf packet from `istream` into the `packet` structure.
    - If decoding fails, increment the `decode_fail_cnt` metric in the context and log a warning, then return `false`.
    - Check if the packet data size is zero; if so, log a warning and return `true`.
    - Check if the packet data size exceeds `FD_TXN_MTU`; if so, log a warning and return `true`.
    - Determine the source IPv4 address from the packet metadata if available, otherwise use zero.
    - Call [`fd_bundle_tile_publish_txn`](<#fd_bundle_tile_publish_txn>) to publish the transaction with the packet data and source IPv4 address.
    - Increment the `packet_received_cnt` metric in the context.
    - Return `true` to indicate successful processing.
- **Output**: Returns `true` if the packet is successfully processed and published, otherwise returns `false` if decoding fails.
- **Functions Called**:
    - [`fd_bundle_tile_publish_txn`](<#fd_bundle_tile_publish_txn>)


---
### fd\_bundle\_client\_handle\_packet\_batch<!-- {{#callable:fd_bundle_client_handle_packet_batch}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L718>)

Processes a batch of packets from a gRPC `SubscribePacketsResponse` message and updates metrics.
- **Inputs**:
    - ``ctx``: A pointer to an `fd_bundle_tile_t` structure that holds the context and state for the bundle client.
    - ``istream``: A pointer to a `pb_istream_t` structure that represents the input stream from which the function decodes the `SubscribePacketsResponse` message.
- **Logic and Control Flow**:
    - Initialize a `block_engine_SubscribePacketsResponse` structure with default values.
    - Set the `packets` field of the `batch` in the response to a callback function `fd_bundle_client_visit_pb_packet` with `ctx` as its argument.
    - Attempt to decode the `istream` into the `res` structure using `pb_decode`.
    - If decoding fails, increment the `decode_fail_cnt` metric in `ctx` and log a warning message, then return.
    - If decoding succeeds, call [`fd_bundle_client_sample_rx_delay`](<#fd_bundle_client_sample_rx_delay>) to sample the receive delay using the timestamp from the response header.
- **Output**: No return value; the function updates the context and metrics in `ctx`.
- **Functions Called**:
    - [`fd_bundle_client_sample_rx_delay`](<#fd_bundle_client_sample_rx_delay>)


---
### fd\_bundle\_client\_handle\_builder\_fee\_info<!-- {{#callable:fd_bundle_client_handle_builder_fee_info}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L740>)

Processes a `BlockBuilderFeeInfoResponse` message to update builder commission and public key information in the context.
- **Inputs**:
    - ``ctx``: A pointer to `fd_bundle_tile_t` structure that holds the context and state information for the bundle client.
    - ``istream``: A pointer to `pb_istream_t` structure that represents the input stream from which the `BlockBuilderFeeInfoResponse` message is decoded.
- **Logic and Control Flow**:
    - Initialize a `BlockBuilderFeeInfoResponse` structure with default values.
    - Attempt to decode the `BlockBuilderFeeInfoResponse` message from the input stream `istream`.
    - If decoding fails, increment the `decode_fail_cnt` metric in `ctx` and log a warning, then return.
    - Check if the `commission` field in the decoded response is greater than 100.
    - If the `commission` is out of range, increment the `decode_fail_cnt` metric in `ctx`, log a warning, and return.
    - Set the `builder_commission` in `ctx` to the `commission` value from the response.
    - Attempt to decode the `pubkey` field from the response using `fd_base58_decode_32`.
    - If decoding the `pubkey` fails, log a warning with a hex dump of the invalid `pubkey` and return.
    - Set `builder_info_avail` in `ctx` to 1, indicating that builder information is available.
    - Calculate the validity duration as 5 minutes in nanoseconds and set `builder_info_valid_until` in `ctx` to the current time plus the validity duration.
- **Output**: No return value; updates the `ctx` structure with builder commission and public key information if successful.
- **Functions Called**:
    - [`fd_bundle_now`](<#fd_bundle_now>)


---
### fd\_bundle\_client\_grpc\_tx\_complete<!-- {{#callable:fd_bundle_client_grpc_tx_complete}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L768>)

Marks the completion of a gRPC transaction without performing any operations.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, which is not used in this function.
    - ``request_ctx``: An unsigned long integer representing the request context, which is not used in this function.
- **Logic and Control Flow**:
    - The function takes two parameters, `app_ctx` and `request_ctx`, but does not use them.
    - The function body contains only two statements that cast the parameters to void, effectively ignoring them.
- **Output**: No output is produced as the function does not perform any operations.


---
### fd\_bundle\_client\_grpc\_rx\_start<!-- {{#callable:fd_bundle_client_grpc_rx_start}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L776>)

Updates the subscription status for packet or bundle requests based on the `request_ctx` value.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, specifically a `fd_bundle_tile_t` structure.
    - ``request_ctx``: An unsigned long integer representing the request context, which determines the type of subscription to update.
- **Logic and Control Flow**:
    - Cast `app_ctx` to a `fd_bundle_tile_t` pointer and store it in `ctx`.
    - Use a switch statement to check the value of `request_ctx`.
    - If `request_ctx` is `FD_BUNDLE_CLIENT_REQ_Bundle_SubscribePackets`, set `ctx->packet_subscription_live` to 1 and `ctx->packet_subscription_wait` to 0.
    - If `request_ctx` is `FD_BUNDLE_CLIENT_REQ_Bundle_SubscribeBundles`, set `ctx->bundle_subscription_live` to 1 and `ctx->bundle_subscription_wait` to 0.
- **Output**: No return value; the function modifies the state of the `fd_bundle_tile_t` structure pointed to by `app_ctx`.


---
### fd\_bundle\_client\_grpc\_rx\_msg<!-- {{#callable:fd_bundle_client_grpc_rx_msg}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L794>)

Processes incoming gRPC messages based on the request context and updates the application context accordingly.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, specifically a `fd_bundle_tile_t` structure.
    - ``protobuf``: A pointer to the buffer containing the protobuf message data.
    - ``protobuf_sz``: The size of the protobuf message data in bytes.
    - ``request_ctx``: An unsigned long integer representing the request context, which determines the type of gRPC message received.
- **Logic and Control Flow**:
    - Cast `app_ctx` to a `fd_bundle_tile_t` pointer and store it in `ctx`.
    - Create a protobuf input stream `istream` from the `protobuf` buffer and its size `protobuf_sz`.
    - Use a switch statement to handle different `request_ctx` values, which correspond to different gRPC request types.
    - For `FD_BUNDLE_CLIENT_REQ_Auth_GenerateAuthChallenge` and `FD_BUNDLE_CLIENT_REQ_Auth_GenerateAuthTokens`, call the respective handler functions and check their return values.
    - If the handler functions return false, increment the `decode_fail_cnt` metric and call [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>) to handle the failure.
    - For `FD_BUNDLE_CLIENT_REQ_Bundle_SubscribeBundles`, call [`fd_bundle_client_handle_bundle_batch`](<#fd_bundle_client_handle_bundle_batch>) with `ctx` and `istream`.
    - For `FD_BUNDLE_CLIENT_REQ_Bundle_SubscribePackets`, call [`fd_bundle_client_handle_packet_batch`](<#fd_bundle_client_handle_packet_batch>) with `ctx` and `istream`.
    - For `FD_BUNDLE_CLIENT_REQ_Bundle_GetBlockBuilderFeeInfo`, call [`fd_bundle_client_handle_builder_fee_info`](<#fd_bundle_client_handle_builder_fee_info>) with `ctx` and `istream`.
    - Log an error if `request_ctx` does not match any known request type.
- **Output**: No return value; the function updates the application context and metrics based on the processed message.
- **Functions Called**:
    - [`fd_bundle_auther_handle_challenge_resp`](<fd_bundle_auth.c.md#fd_bundle_auther_handle_challenge_resp>)
    - [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>)
    - [`fd_bundle_now`](<#fd_bundle_now>)
    - [`fd_bundle_auther_handle_tokens_resp`](<fd_bundle_auth.c.md#fd_bundle_auther_handle_tokens_resp>)
    - [`fd_bundle_client_handle_bundle_batch`](<#fd_bundle_client_handle_bundle_batch>)
    - [`fd_bundle_client_handle_packet_batch`](<#fd_bundle_client_handle_packet_batch>)
    - [`fd_bundle_client_handle_builder_fee_info`](<#fd_bundle_client_handle_builder_fee_info>)


---
### fd\_bundle\_client\_request\_failed<!-- {{#callable:fd_bundle_client_request_failed}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L830>)

Handles a failed client request by initiating a backoff and handling specific request failures.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_bundle_tile_t` structure representing the context of the bundle client.
    - ``request_ctx``: An unsigned long integer representing the context of the request that failed.
- **Logic and Control Flow**:
    - Calls [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>) with the current context and time to initiate a backoff period.
    - Uses a switch statement to check the `request_ctx` value.
    - If `request_ctx` is `FD_BUNDLE_CLIENT_REQ_Auth_GenerateAuthChallenge` or `FD_BUNDLE_CLIENT_REQ_Auth_GenerateAuthTokens`, calls [`fd_bundle_auther_handle_request_fail`](<fd_bundle_auth.c.md#fd_bundle_auther_handle_request_fail>) to handle the failure in the authentication process.
- **Output**: No return value; the function operates by modifying the state of the `ctx` structure.
- **Functions Called**:
    - [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>)
    - [`fd_bundle_now`](<#fd_bundle_now>)
    - [`fd_bundle_auther_handle_request_fail`](<fd_bundle_auth.c.md#fd_bundle_auther_handle_request_fail>)


---
### fd\_bundle\_client\_grpc\_rx\_end<!-- {{#callable:fd_bundle_client_grpc_rx_end}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L842>)

Handles the end of a gRPC response by checking HTTP and gRPC statuses, updating context states, and logging or resetting connections as needed.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, specifically a `fd_bundle_tile_t` structure.
    - ``request_ctx``: An unsigned long integer representing the context of the request, indicating the type of gRPC request.
    - ``resp``: A pointer to a `fd_grpc_resp_hdrs_t` structure containing the response headers from the gRPC call.
- **Logic and Control Flow**:
    - Cast `app_ctx` to `fd_bundle_tile_t *` and assign it to `ctx`.
    - Check if `resp->h2_status` is not 200; if true, log a warning, call [`fd_bundle_client_request_failed`](<#fd_bundle_client_request_failed>), and return.
    - Unescape the gRPC message in `resp->grpc_msg` and update `resp->grpc_msg_len`; if the length is zero, set a default error message.
    - Use a switch statement on `request_ctx` to handle different request types:
    - For `FD_BUNDLE_CLIENT_REQ_Bundle_SubscribePackets`, reset packet subscription states, call [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>), set `ctx->defer_reset`, log info, and return.
    - For `FD_BUNDLE_CLIENT_REQ_Bundle_SubscribeBundles`, reset bundle subscription states, call [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>), set `ctx->defer_reset`, log info, and return.
    - For `FD_BUNDLE_CLIENT_REQ_Bundle_GetBlockBuilderFeeInfo`, set `ctx->builder_info_wait` to 0.
    - If `resp->grpc_status` is not `FD_GRPC_STATUS_OK`, log the failure, call [`fd_bundle_client_request_failed`](<#fd_bundle_client_request_failed>), and reset the auther if the status indicates authentication issues.
- **Output**: No return value; the function operates through side effects on the context and logs.
- **Functions Called**:
    - [`fd_bundle_client_request_failed`](<#fd_bundle_client_request_failed>)
    - [`fd_bundle_tile_backoff`](<#fd_bundle_tile_backoff>)
    - [`fd_bundle_now`](<#fd_bundle_now>)
    - [`fd_bundle_auther_reset`](<fd_bundle_auth.c.md#fd_bundle_auther_reset>)


---
### fd\_bundle\_client\_grpc\_rx\_timeout<!-- {{#callable:fd_bundle_client_grpc_rx_timeout}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L898>)

Handles a gRPC request timeout by logging a warning and setting a flag to defer a reset of the application context.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, specifically a `fd_bundle_tile_t` structure.
    - ``request_ctx``: An unsigned long integer representing the context of the request that timed out, defined by `FD_BUNDLE_CLIENT_REQ_{...}`.
    - ``deadline_kind``: An integer indicating the type of deadline that was missed, either `FD_GRPC_DEADLINE_HEADER` or `FD_GRPC_DEADLINE_RX_END`.
- **Logic and Control Flow**:
    - Ignore the `deadline_kind` parameter as it is not used in the function.
    - Log a warning message indicating that the request has timed out, using the `request_ctx` to provide context.
    - Cast the `app_ctx` to a `fd_bundle_tile_t` pointer and set its `defer_reset` field to 1, indicating that a reset should be deferred.
- **Output**: No return value; the function operates by side effects on the application context.
- **Functions Called**:
    - [`fd_bundle_request_ctx_cstr`](<#fd_bundle_request_ctx_cstr>)


---
### fd\_bundle\_client\_grpc\_ping\_ack<!-- {{#callable:fd_bundle_client_grpc_ping_ack}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L910>)

Handles the acknowledgment of a gRPC ping by updating round-trip time metrics and logging the event.
- **Inputs**:
    - ``app_ctx``: A pointer to the application context, specifically a `fd_bundle_tile_t` structure.
- **Logic and Control Flow**:
    - Cast `app_ctx` to a `fd_bundle_tile_t` pointer and assign it to `ctx`.
    - Call [`fd_keepalive_rx`](<fd_keepalive.h.md#fd_keepalive_rx>) with `ctx->keepalive` and the current time from `fd_bundle_now()` to get the round-trip time (`rtt_sample`).
    - If `rtt_sample` is non-zero, call `fd_rtt_sample` to update the round-trip time metrics with `ctx->rtt`, the `rtt_sample` cast to a float, and a zero flag.
    - Log a debug message indicating a keepalive acknowledgment.
    - Increment the `ping_ack_cnt` metric in `ctx->metrics`.
- **Output**: No return value; the function updates metrics and logs events.
- **Functions Called**:
    - [`fd_keepalive_rx`](<fd_keepalive.h.md#fd_keepalive_rx>)
    - [`fd_bundle_now`](<#fd_bundle_now>)


---
### fd\_bundle\_client\_status<!-- {{#callable:fd_bundle_client_status}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L937>)

Determines the connection status of a bundle client based on various conditions and returns a status code.
- **Inputs**:
    - ``ctx``: A pointer to a constant `fd_bundle_tile_t` structure that contains the context for the bundle client.
- **Logic and Control Flow**:
    - Checks if the TCP socket is connected and if the gRPC client is available; if not, returns `DISCONNECTED`.
    - Retrieves the HTTP/2 connection from the gRPC client and checks if it is valid; if not, returns `DISCONNECTED`.
    - Checks if the connection flags indicate a dead connection or a GOAWAY signal; if so, returns `DISCONNECTED`.
    - Checks if the connection is in an initial state or waiting for settings acknowledgment; if so, returns `CONNECTING`.
    - Checks if the authentication state is not `FD_BUNDLE_AUTH_STATE_DONE_WAIT`; if so, returns `CONNECTING`.
    - Checks if builder information is unavailable or if packet or bundle subscriptions are not live; if so, returns `CONNECTING`.
    - Checks if a keepalive timeout has occurred; if so, returns `DISCONNECTED`.
    - Checks if the gRPC client is not connected; if so, returns `CONNECTING`.
    - If none of the above conditions are met, returns `CONNECTED`.
- **Output**: Returns an integer status code indicating the connection status: `DISCONNECTED`, `CONNECTING`, or `CONNECTED`.
- **Functions Called**:
    - [`fd_keepalive_is_timeout`](<fd_keepalive.h.md#fd_keepalive_is_timeout>)
    - [`fd_bundle_now`](<#fd_bundle_now>)


---
### fd\_bundle\_request\_ctx\_cstr<!-- {{#callable:fd_bundle_request_ctx_cstr}} -->
[View Source →](<../../../../../src/disco/bundle/fd_bundle_client.c#L988>)

Maps a request context identifier to its corresponding string representation.
- **Inputs**:
    - ``request_ctx``: An unsigned long integer representing the request context identifier.
- **Logic and Control Flow**:
    - Use a `switch` statement to check the value of `request_ctx`.
    - Return the corresponding string for known request context identifiers: `GenerateAuthChallenge`, `GenerateAuthTokens`, `SubscribePackets`, `SubscribeBundles`, and `GetBlockBuilderFeeInfo`.
    - Return "unknown" if `request_ctx` does not match any known identifiers.
- **Output**: A constant character pointer to the string representation of the request context.



---
Made with ❤️ by [Driver](https://www.driver.ai/)