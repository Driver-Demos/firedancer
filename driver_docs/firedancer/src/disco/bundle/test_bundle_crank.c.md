<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the `fd_bundle_crank` functionality, including transaction generation and duplicate checking.

# Purpose
The code is a C source file that appears to be part of a test suite for a system involving transaction generation and validation, likely in a blockchain or distributed ledger context. It includes several functions that test different aspects of transaction processing, such as [`test_repro_onchain`](<#test_repro_onchain>), [`test_no_duplicates`](<#test_no_duplicates>), and [`test_crank_cnt`](<#test_crank_cnt>). These functions use various helper functions and macros to initialize transaction generators, generate transactions, and verify their properties, such as ensuring no duplicate transactions and checking transaction counts.

The file imports several headers and binary data, which suggests it relies on external libraries or modules for its functionality. It defines static inline functions for testing purposes, which are not intended to be part of a public API but rather for internal validation. The code uses assertions to verify that transactions meet expected conditions, such as size and content equivalence. The [`main`](<#main>) function orchestrates the execution of these tests, initializing necessary components and logging the results. The use of static assertions and memory equality checks indicates a focus on ensuring data integrity and correctness in transaction handling.
# Imports and Dependencies

---
- `fd_bundle_crank.h`
- `../pack/fd_chkdup.h`
- `../../ballet/base64/fd_base64.h`
- `stddef.h`


# Global Variables

---
### \_3iPuTgpWaaC6jYEY7kd993QBthGsQTK3yPCrNJyPMhCD
- **Type**: ``fd_acct_addr_t` array`
- **Description**: An array of type `fd_acct_addr_t` with a single element, initialized with a specific 32-byte hexadecimal address. The address is stored in the `.b` field of the `fd_acct_addr_t` structure.
- **Use**: Used to store a specific account address for operations involving account address management.


---
### \_4R3gSG8BpU4t19KYj8CfnbtRpnT8gtk4dvTHxVRwc2r7
- **Type**: ``fd_acct_addr_t``
- **Description**: This variable is an array of `fd_acct_addr_t` structures, each containing a 32-byte array `b`. The array is initialized with a specific sequence of hexadecimal values.
- **Use**: Used to store a specific account address in the form of a 32-byte array for transaction processing.


---
### \_96gYZGLnJYVFmbjzopPSU6QiEV5fGqZNyN9nmNhvrZU5
- **Type**: ``fd_acct_addr_t``
- **Description**: Represents an array of one `fd_acct_addr_t` structure, initialized with a specific 32-byte hexadecimal address. The structure contains a member `b` which is an array of bytes.
- **Use**: Used to store a specific account address in a 32-byte format.


---
### \_DNVZMSqeRH18Xa4MCTrb1MndNf3Npg4MEwqswo23eWkf
- **Type**: ``fd_acct_addr_t``
- **Description**: Represents an array of one `fd_acct_addr_t` structure, initialized with a specific 32-byte address value. The address is stored in the `.b` field of the structure.
- **Use**: Used to store a specific account address in a 32-byte format for further processing or comparison in the program.


---
### \_feeywn2ffX8DivmRvBJ9i9YZnss7WBouTmujfQcEdeY
- **Type**: ``fd_acct_addr_t` array`
- **Description**: Contains a single element of type `fd_acct_addr_t`, which is a structure that holds a 32-byte array `b`. This array is initialized with specific hexadecimal values.
- **Use**: Used to store a specific account address in a 32-byte format for transaction processing.


---
### \_G8RaABmvrvNCcGu41NV5oKjCfHeBv1zNn58dFcZzyRRw
- **Type**: ``fd_acct_addr_t``
- **Description**: A global variable of type `fd_acct_addr_t` that is initialized with a specific 32-byte array. This array is likely used to represent an account address or similar identifier in the system.
- **Use**: Used in functions to compare or assign account addresses, such as in `fd_memeq` checks and `fd_bundle_crank_tip_payment_config_t` structures.


---
### \_GiLHMES95axFbFX7ogCTwL6QQ1uqspajz9SHMpt5dCGh
- **Type**: ``fd_acct_addr_t``
- **Description**: An array of `fd_acct_addr_t` structures, each containing a 32-byte array `b`. The array is initialized with a single element, which is a 32-byte hexadecimal value.
- **Use**: Used to store a specific account address in a 32-byte format.


---
### \_GwHH8ciFhR8vejWCqmg8FWZUCNtubPY2esALvy5tBvji
- **Type**: ``fd_acct_addr_t``
- **Description**: An array of type `fd_acct_addr_t` with a single element, initialized with a 32-byte hexadecimal value. The array is used to store a specific account address in a binary format.
- **Use**: Used to store and provide a specific account address for transaction processing.


---
### \_GZctHpWXmsZC1YHACTGGcHhYxjdRqQvTpYkb9LMvxDib
- **Type**: ``fd_acct_addr_t``
- **Description**: Represents an array of one `fd_acct_addr_t` structure, initialized with a specific byte sequence. The `fd_acct_addr_t` structure contains a member `b` which is an array of bytes.
- **Use**: Used to store a specific account address in the form of a byte array.


---
### \_HFqU5x63VTqvQss8hp11i4wVV8bD44PvwucfZ2bU7gRe
- **Type**: ``fd_acct_addr_t``
- **Description**: A global variable `_HFqU5x63VTqvQss8hp11i4wVV8bD44PvwucfZ2bU7gRe` is an array of type `fd_acct_addr_t` with a single element. This element is initialized with a 32-byte array of hexadecimal values, which likely represents a fixed account address or identifier used in the program.
- **Use**: Used to store a specific account address or identifier for operations within the program.


---
### \_HgzT81VF1xZ3FT9Eq1pHhea7Wcfq2bv4tWTP3VvJ8Y9D
- **Type**: ``fd_acct_addr_t``
- **Description**: An array of `fd_acct_addr_t` structures, each containing a 32-byte array `b`. The array is initialized with a single element, which is a 32-byte hexadecimal value.
- **Use**: Used to store a specific account address in a 32-byte format for transaction processing.


---
### \_T1pyyaTNZsKv2WcRAB8oVnk93mLJw2XzjtVYqCsaHqt
- **Type**: ``fd_acct_addr_t``
- **Description**: An array of type `fd_acct_addr_t` with a single element, initialized with a specific byte sequence. The byte sequence is a 32-byte array that represents an account address or similar identifier.
- **Use**: Used to store a specific account address or identifier in a fixed-size array.


# Functions

---
### test\_repro\_onchain<!-- {{#callable:test_repro_onchain}} -->
[View Source →](<../../../../../src/disco/bundle/test_bundle_crank.c#L60>)

Tests the generation and validation of blockchain transactions using a specific configuration and compares them for consistency.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_bundle_crank_gen_t` object `g` with specific parameters using [`fd_bundle_crank_gen_init`](<fd_bundle_crank.c.md#fd_bundle_crank_gen_init>).
    - Retrieve tip payment and receiver addresses using [`fd_bundle_crank_get_addresses`](<fd_bundle_crank.c.md#fd_bundle_crank_get_addresses>) and verify them with `FD_TEST` and `fd_memeq`.
    - Define an old tip payment configuration with specific parameters including a discriminator, tip receiver, block builder, commission percentage, and bumps.
    - Allocate memory for transaction payloads and transaction objects `txn` and `txn_2ni`.
    - Generate a transaction using [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>) and verify its size with `FD_TEST`.
    - Parse a pre-defined payload into `txn_2ni` and verify the parsing result.
    - Compare the instruction counts of `txn` and `txn_2ni` and verify account addresses, writability, and signer status using `FD_TEST` and `ASSERT_PUBKEY_EQ`.
    - Iterate over instructions to compare program IDs, account counts, data sizes, and payload data for `txn` and `txn_2ni`.
    - Parse the generated payload back into a transaction and verify its consistency with the original transaction.
    - Encode the payload into a base64 string and log it as a sample transaction.
- **Output**: No output is returned; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_bundle_crank_gen_init`](<fd_bundle_crank.c.md#fd_bundle_crank_gen_init>)
    - [`fd_bundle_crank_get_addresses`](<fd_bundle_crank.c.md#fd_bundle_crank_get_addresses>)
    - [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>)


---
### check\_duplicates<!-- {{#callable:check_duplicates}} -->
[View Source →](<../../../../../src/disco/bundle/test_bundle_crank.c#L129>)

Checks for duplicate account addresses in a generated transaction against specified old tip receiver and block builder addresses.
- **Inputs**:
    - ``g``: A pointer to an `fd_bundle_crank_gen_t` structure used for transaction generation.
    - ``rng``: A pointer to an `fd_rng_t` structure used for random number generation.
    - ``old_tip_receiver``: A constant pointer to an `fd_acct_addr_t` structure representing the old tip receiver's account address.
    - ``old_block_builder``: A constant pointer to an `fd_acct_addr_t` structure representing the old block builder's account address.
- **Logic and Control Flow**:
    - Initializes `old_tip_payment_config` with the given `old_tip_receiver` and `old_block_builder` addresses and other fixed parameters.
    - Generates a transaction using [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>) with the initialized configuration and stores it in `txn`.
    - Checks if the size of the generated transaction matches `sizeof(fd_bundle_crank_2_t)` using `FD_TEST`.
    - Retrieves account addresses from the transaction using `fd_txn_get_acct_addrs`.
    - Compares specific account addresses in the transaction payload with `old_tip_receiver` and `old_block_builder` using `fd_memeq`.
    - If any address comparison fails, returns 0 indicating a mismatch.
    - Initializes a `fd_chkdup_t` structure and joins it with `fd_chkdup_join`.
    - Checks for duplicate addresses using `fd_chkdup_check` and returns the negation of its result.
- **Output**: Returns 0 if any address comparison fails or if duplicates are found; otherwise, returns 1.
- **Functions Called**:
    - [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>)


---
### test\_no\_duplicates<!-- {{#callable:test_no_duplicates}} -->
[View Source →](<../../../../../src/disco/bundle/test_bundle_crank.c#L164>)

Verifies that no duplicate account addresses exist in generated transactions using a random number generator and a series of test cases.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_bundle_crank_gen_t` object `g` and a random number generator `rng`.
    - Call [`fd_bundle_crank_gen_init`](<fd_bundle_crank.c.md#fd_bundle_crank_gen_init>) to initialize the crank generator `g` with specific account addresses and parameters.
    - Perform a series of tests using `FD_TEST` and [`check_duplicates`](<#check_duplicates>) to verify that no duplicate account addresses exist in the generated transactions.
    - Each call to [`check_duplicates`](<#check_duplicates>) uses different combinations of account addresses to ensure comprehensive testing.
    - After all tests, clean up by deleting the random number generator `rng`.
- **Output**: No direct output; the function uses assertions to verify conditions and will terminate the program if any test fails.
- **Functions Called**:
    - [`fd_bundle_crank_gen_init`](<fd_bundle_crank.c.md#fd_bundle_crank_gen_init>)
    - [`check_duplicates`](<#check_duplicates>)


---
### test\_crank\_cnt<!-- {{#callable:test_crank_cnt}} -->
[View Source →](<../../../../../src/disco/bundle/test_bundle_crank.c#L186>)

Tests the generation of crank transactions with various configurations and validates the results.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `fd_bundle_crank_gen_t` object `g` with specific parameters using [`fd_bundle_crank_gen_init`](<fd_bundle_crank.c.md#fd_bundle_crank_gen_init>).
    - Define and initialize a `fd_bundle_crank_tip_payment_config_t` object `tip_payment_config` with specific values.
    - Declare arrays `payload` and `_txn` to hold transaction data, and cast `_txn` to a `fd_txn_t` pointer `txn`.
    - Declare and initialize an `fd_acct_addr_t` array `uncreated` with zero values.
    - Call [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>) with `uncreated` and check if the size matches `fd_bundle_crank_3_t`.
    - Call [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>) with `_4R3gSG8BpU4t19KYj8CfnbtRpnT8gtk4dvTHxVRwc2r7` and check if the result is zero.
    - Increment `commission_pct` in `tip_payment_config` and call [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>), checking if the size matches `fd_bundle_crank_2_t`, then decrement `commission_pct`.
    - Increment the second byte of `tip_receiver` in `tip_payment_config` and call [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>), checking if the size matches `fd_bundle_crank_2_t`, then decrement the byte.
    - Increment the third byte of `block_builder` in `tip_payment_config` and call [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>), checking if the size matches `fd_bundle_crank_2_t`, then decrement the byte.
    - Call [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>) again with `_4R3gSG8BpU4t19KYj8CfnbtRpnT8gtk4dvTHxVRwc2r7` and check if the result is zero.
- **Output**: No output is returned; the function performs tests and uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_bundle_crank_gen_init`](<fd_bundle_crank.c.md#fd_bundle_crank_gen_init>)
    - [`fd_bundle_crank_generate`](<fd_bundle_crank.c.md#fd_bundle_crank_generate>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/disco/bundle/test_bundle_crank.c#L232>)

Initializes the environment, runs a series of tests, logs a success message, and then halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Executes [`test_repro_onchain`](<#test_repro_onchain>) to test on-chain reproduction functionality.
    - Executes [`test_no_duplicates`](<#test_no_duplicates>) to ensure no duplicate transactions occur.
    - Executes [`test_crank_cnt`](<#test_crank_cnt>) to verify the crank count functionality.
    - Logs a notice message 'pass' using `FD_LOG_NOTICE`.
    - Calls `fd_halt` to clean up and halt the program.
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_repro_onchain`](<#test_repro_onchain>)
    - [`test_no_duplicates`](<#test_no_duplicates>)
    - [`test_crank_cnt`](<#test_crank_cnt>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)