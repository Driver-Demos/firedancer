<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Replays packets from a pcap file with flow control and diagnostic logging.

# Purpose
The code is a C source file that implements a function to replay packets from a PCAP file. It is designed to read packets from a specified PCAP file and publish them to a memory cache (`mcache`) for further processing or analysis. The function [`fd_pcap_replay_tile`](<#fd_pcap_replay_tile>) is the main component, which handles the initialization, execution, and termination of the packet replay process. It uses various diagnostic counters to track the number of packets published, filtered, and any backpressure events that occur during the replay.

The code includes several key components: initialization of command-and-control (`cnc`) state, management of input and output streams, and flow control. It uses a flow control mechanism (`fctl`) to manage the availability of credits for publishing packets downstream. The function also handles housekeeping tasks, such as updating synchronization information and processing command-and-control signals. The code is structured to ensure that the replay process can be halted and resumed based on external signals, making it suitable for integration into larger systems that require controlled packet replay from PCAP files.
# Imports and Dependencies

---
- `fd_pcap_replay.h`
- `../../util/net/fd_pcap.h`
- `stdio.h`
- `errno.h`


# Functions

---
### fd\_pcap\_replay\_tile\_scratch\_align<!-- {{#callable:fd_pcap_replay_tile_scratch_align}} -->
[View Source →](<../../../../../src/disco/pcap/fd_pcap_replay.c#L20>)

Returns the alignment requirement for the scratch space used in pcap replay tile operations.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_PCAP_REPLAY_TILE_SCRATCH_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment requirement for the scratch space.


---
### fd\_pcap\_replay\_tile\_scratch\_footprint<!-- {{#callable:fd_pcap_replay_tile_scratch_footprint}} -->
[View Source →](<../../../../../src/disco/pcap/fd_pcap_replay.c#L25>)

Calculates the memory footprint required for a pcap replay tile based on the number of output streams.
- **Inputs**:
    - `out_cnt`: The number of output streams for which the memory footprint is calculated.
- **Logic and Control Flow**:
    - Check if `out_cnt` exceeds `FD_PCAP_REPLAY_TILE_OUT_MAX`; if true, return 0.
    - Initialize `l` with `FD_LAYOUT_INIT`.
    - Append the alignment and footprint of flow control (`fd_fctl_align` and `fd_fctl_footprint`) to `l`.
    - Finalize the layout with `FD_LAYOUT_FINI` using the alignment from [`fd_pcap_replay_tile_scratch_align`](<#fd_pcap_replay_tile_scratch_align>) and return the result.
- **Output**: Returns the calculated memory footprint as an unsigned long integer, or 0 if `out_cnt` is too large.
- **Functions Called**:
    - [`fd_pcap_replay_tile_scratch_align`](<#fd_pcap_replay_tile_scratch_align>)


---
### fd\_pcap\_replay\_tile<!-- {{#callable:fd_pcap_replay_tile}} -->
[View Source →](<../../../../../src/disco/pcap/fd_pcap_replay.c#L33>)

Replays packets from a PCAP file stream, managing flow control and diagnostics, and publishes them to a specified output.
- **Inputs**:
    - `cnc`: A pointer to `fd_cnc_t`, used for command-and-control signaling and diagnostics.
    - `pcap_path`: A constant character pointer to the path of the PCAP file to be replayed.
    - `pkt_max`: An unsigned long specifying the maximum packet size to process.
    - `orig`: An unsigned long representing the origin identifier for the packet metadata.
    - `mcache`: A pointer to `fd_frag_meta_t`, used for managing metadata cache.
    - `dcache`: A pointer to an unsigned character array, used for data cache where packets are stored.
    - `out_cnt`: An unsigned long indicating the number of output sequences.
    - `out_fseq`: A pointer to an array of unsigned long pointers, each representing an output sequence.
    - `cr_max`: An unsigned long specifying the maximum flow control credits available.
    - `lazy`: A long integer that determines the housekeeping frequency in nanoseconds.
    - `rng`: A pointer to `fd_rng_t`, used for random number generation.
    - `scratch`: A void pointer to a scratch space for temporary allocations.
- **Logic and Control Flow**:
    - Initialize diagnostic and state variables for CNC, PCAP stream, and output fragment stream.
    - Check input parameters for validity and log warnings if any are invalid.
    - Open the PCAP file and create an iterator for reading packets.
    - Initialize flow control and housekeeping parameters.
    - Enter a loop to process packets from the PCAP file.
    - Perform housekeeping tasks periodically, including updating diagnostics and checking for control signals.
    - Check for backpressure and wait for flow control credits if necessary.
    - Read the next packet from the PCAP file and check if it should be filtered.
    - If not filtered, publish the packet metadata and update diagnostics.
    - Continue processing until a halt signal is received or the PCAP file is fully processed.
    - Clean up resources and close the PCAP file upon completion.
- **Output**: Returns 0 on successful completion, or 1 if an error occurs during initialization or processing.
- **Functions Called**:
    - [`fd_pcap_replay_tile_scratch_align`](<#fd_pcap_replay_tile_scratch_align>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)