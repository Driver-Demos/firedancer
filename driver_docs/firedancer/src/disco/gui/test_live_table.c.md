<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the live table implementation, including sorting and key management functionalities.

# Purpose
The code is a C program that implements and tests a data structure called `test_live_table`. This data structure is designed to manage and sort rows of data based on multiple keys. Each row is represented by the `test_live_table_row_t` structure, which includes fields such as `key`, `ipv4`, and `counter`, along with a set of treap nodes and a doubly linked list for internal management. The program defines comparison functions for sorting rows by these fields and uses macros to configure the table's properties, such as the number of columns and the sorting keys.

The main function initializes a `test_live_table` instance and performs a series of tests to verify its functionality. It checks the table's ability to insert, sort, and remove rows based on different sorting keys. The tests ensure that the table correctly maintains the order of rows according to the specified sort keys and directions. The program also includes validation checks to confirm the integrity of the table's operations, such as verifying the number of active sort keys and the correctness of row indices after sorting operations. The code is structured to be a standalone executable that tests the `test_live_table` implementation, ensuring its correctness and reliability in managing sorted data.
# Imports and Dependencies

---
- `../fd_disco.h`
- `fd_gui_live_table_tmpl.c`


# Global Variables

---
### scratch
- **Type**: `uchar[256]`
- **Description**: An array of unsigned characters with a size of 256 bytes, aligned to a 256-byte boundary.
- **Use**: Used as a memory buffer for operations related to the `test_live_table`.


# Data Structures

---
### test\_live\_table\_row
- **Type**: ``struct``
- **Members**:
    - ``treaps``: An array of structures, each containing `ulong` fields for `parent`, `left`, `right`, `prio`, `next`, and `prev`, used for treap data structure management.
    - ``sort_keys``: A `ulong` value representing the number of sort keys.
    - ``dlist``: A structure containing `ulong` fields `prev` and `next` for doubly linked list management.
    - ``key``: A `fd_pubkey_t` type representing a public key.
    - ``ipv4``: A `uint` representing an IPv4 address.
    - ``counter``: A `ulong` used as a counter for some metric.
- **Description**: Represents a row in a live table with fields for managing treaps, a doubly linked list, a public key, an IPv4 address, and a counter. The `treaps` array allows for sorting and organizing data using a treap structure, while the `dlist` structure facilitates linked list operations. The `key`, `ipv4`, and `counter` fields store specific data attributes for each row.


---
### test\_live\_table\_row\_t
- **Type**: ``struct``
- **Members**:
    - ``treaps``: An array of structures, each containing `parent`, `left`, `right`, `prio`, `next`, and `prev` fields, used for managing treap nodes.
    - ``sort_keys``: A `ulong` value representing the number of sort keys.
    - ``dlist``: A structure containing `prev` and `next` fields for managing a doubly linked list.
    - ``key``: A `fd_pubkey_t` type representing a public key.
    - ``ipv4``: A `uint` value representing an IPv4 address.
    - ``counter``: A `ulong` value used as a counter.
- **Description**: Defines a row in a live table with fields for managing treap nodes, a doubly linked list, a public key, an IPv4 address, and a counter. The `treaps` array allows for multiple sorting keys, while `dlist` facilitates list operations. The `key`, `ipv4`, and `counter` fields store specific data attributes for each row.


# Functions

---
### live\_table\_col\_pubkey\_lt<!-- {{#callable:live_table_col_pubkey_lt}} -->
[View Source →](<../../../../../src/disco/gui/test_live_table.c#L28>)

Compares two public keys and returns true if the first is less than the second.
- **Inputs**:
    - `a`: Pointer to the first public key to compare.
    - `b`: Pointer to the second public key to compare.
- **Logic and Control Flow**:
    - Casts the input pointers `a` and `b` to `fd_pubkey_t` pointers.
    - Uses `memcmp` to compare the two public keys over 32 bytes.
    - Returns true if the result of `memcmp` is less than 0, indicating the first key is less than the second.
- **Output**: Returns an integer that is true if the first public key is less than the second, otherwise false.


---
### live\_table\_col\_ipv4\_lt<!-- {{#callable:live_table_col_ipv4_lt}} -->
[View Source →](<../../../../../src/disco/gui/test_live_table.c#L29>)

Compares two IPv4 addresses to determine if the first is less than the second.
- **Inputs**:
    - `a`: Pointer to the first IPv4 address to compare, cast to `void const *`.
    - `b`: Pointer to the second IPv4 address to compare, cast to `void const *`.
- **Logic and Control Flow**:
    - Dereferences the pointer `a` and casts it to `uint` to obtain the first IPv4 address.
    - Dereferences the pointer `b` and casts it to `uint` to obtain the second IPv4 address.
    - Compares the two IPv4 addresses to check if the first is less than the second.
- **Output**: Returns a non-zero integer if the first IPv4 address is less than the second, otherwise returns zero.


---
### live\_table\_col\_counter\_lt<!-- {{#callable:live_table_col_counter_lt}} -->
[View Source →](<../../../../../src/disco/gui/test_live_table.c#L30>)

Compares two `ulong` values pointed to by `a` and `b` and returns true if the value pointed to by `a` is less than the value pointed to by `b`.
- **Inputs**:
    - `a`: A pointer to the first `ulong` value to compare.
    - `b`: A pointer to the second `ulong` value to compare.
- **Logic and Control Flow**:
    - Dereference the pointer `a` to obtain the first `ulong` value.
    - Dereference the pointer `b` to obtain the second `ulong` value.
    - Compare the two `ulong` values.
    - Return true if the value from `a` is less than the value from `b`.
- **Output**: An integer representing the result of the comparison: true (non-zero) if the value pointed to by `a` is less than the value pointed to by `b`, otherwise false (zero).


---
### test\_live\_table\_key<!-- {{#callable:test_live_table_key}} -->
[View Source →](<../../../../../src/disco/gui/test_live_table.c#L41>)

Validates that the indices of a forward iterator over a live table match an expected sequence of indices.
- **Inputs**:
    - ``table``: A pointer to a `test_live_table_t` structure representing the live table to iterate over.
    - ``key``: A constant pointer to a `test_live_table_sort_key_t` structure that specifies the sort key for the iteration.
    - ``pool``: A pointer to an array of `test_live_table_row_t` structures representing the pool of rows in the table.
    - ``expected``: A constant pointer to an array of `ulong` values representing the expected sequence of indices.
    - ``expected_sz``: A constant `ulong` value representing the size of the `expected` array.
- **Logic and Control Flow**:
    - Initialize a forward iterator `iter` using `test_live_table_fwd_iter_init` with the given `table`, `key`, and `pool`.
    - Iterate over the table using a for loop, checking if the iterator is done with `test_live_table_fwd_iter_done`.
    - In each iteration, check if the current index `i` is greater than or equal to `expected_sz`. If true, log a warning and return 0.
    - Compare the current index from the iterator `test_live_table_fwd_iter_idx` with the expected index from the `expected` array. If they do not match, log a warning and return 0.
    - If the loop completes without returning 0, return 1 to indicate success.
- **Output**: Returns 1 if the indices match the expected sequence, otherwise returns 0.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/disco/gui/test_live_table.c#L56>)

Initializes, tests, and manipulates a live table structure with various operations including insertion, sorting, and verification.
- **Inputs**:
    - `argc`: The number of command-line arguments passed to the program.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Ignore `argc` and `argv` by casting them to void.
    - Check if the size of `scratch` matches the footprint of the live table for `TEST_LIVE_TABLE_ROW_CNT`; log an error if not.
    - Create and join a new live table using `scratch` and `TEST_LIVE_TABLE_ROW_CNT`.
    - Verify column names and indices using `FD_TEST` assertions.
    - Initialize a pool of `test_live_table_row_t` structures with predefined values.
    - Define sorting keys with specific column indices and directions.
    - Seed the pool with a specific seed value and verify the initial element count of the table.
    - Insert rows from the pool into the table and verify the element count and maximum element count.
    - Test sorting keys by inserting and removing them, verifying the active sort key count after each operation.
    - Insert a new row and update an existing row, verifying the table's state after each operation.
    - Test the less-than function `test_live_table_lt` with different row comparisons.
    - Delete the live table and log a success message before returning 0.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_live_table_key`](<#test_live_table_key>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)