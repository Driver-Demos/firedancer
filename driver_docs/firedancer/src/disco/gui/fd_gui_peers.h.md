<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines methods and data structures for managing and updating metrics and metadata of Solana cluster peers on the Gossip network, including WebSocket client message handling.

# Purpose
The `fd_gui_peers.h` file is a C header file that defines structures and functions for managing and monitoring Solana cluster peers on the Gossip network. It provides methods to maintain metrics and metadata about active peers, which are updated through incoming messages from the gossip network. The file includes functionality to handle WebSocket client messages, allowing clients to view and sort the peer table based on custom keys. This header file is part of a larger system that interacts with various components, such as network headers, metrics, gossip types, and HTTP servers, as indicated by the included headers.

Key components defined in this file include structures for tracking peer metrics (`fd_gui_peers_metric_rate_t`), peer voting information (`fd_gui_peers_vote_t`), and node details (`fd_gui_peers_node_t`). It also defines structures for managing gossip statistics (`fd_gui_peers_gossip_stats_t`) and WebSocket connections (`fd_gui_peers_ws_conn_t`). The file provides several function prototypes for creating and managing peer contexts, handling gossip messages, and managing WebSocket connections. These functions facilitate the integration of peer data into a live table and bandwidth tracking system, allowing for real-time updates and client interactions.
# Imports and Dependencies

---
- `../../util/net/fd_net_headers.h`
- `../../disco/metrics/fd_metrics.h`
- `../../flamenco/gossip/fd_gossip_types.h`
- `../../discof/replay/fd_replay_tile.h`
- `../../flamenco/runtime/fd_runtime_const.h`
- `../../waltz/http/fd_http_server.h`
- `../topo/fd_topo.h`
- `../../util/tmpl/fd_map_chain.c`
- `fd_gui_live_table_tmpl.c`


# Data Structures

---
### fd\_gui\_peers\_metric\_rate
- **Type**: ``struct``
- **Members**:
    - `cur`: Stores the current value of the metric.
    - `ref`: Stores a reference value for the metric.
    - `rate`: Represents the rate of change in units per second and is used to sort table entries in live_table treaps.
- **Description**: The `fd_gui_peers_metric_rate` structure is used to track and manage metrics related to the rate of change of certain values over time. It contains fields for the current value (`cur`), a reference value (`ref`), and the rate of change (`rate`) in units per second. The `rate` field is particularly important as it is used to sort entries in live_table treaps, which are data structures that help manage and organize data efficiently.


---
### fd\_gui\_peers\_metric\_rate\_t
- **Type**: ``struct``
- **Members**:
    - `cur`: Stores the current value of the metric.
    - `ref`: Stores a reference value for the metric.
    - `rate`: Represents the rate of change of the metric in units per second.
- **Description**: The `fd_gui_peers_metric_rate_t` structure is used to track the rate of change of certain metrics over time. It contains fields for the current value (`cur`), a reference value (`ref`), and the calculated rate of change (`rate`). This structure is used in live tables to sort entries based on the rate of change of metrics.


---
### fd\_gui\_peers\_vote
- **Type**: ``struct``
- **Members**:
    - `node_account`: Holds the public key of the node account.
    - `vote_account`: Holds the public key of the vote account.
    - `stake`: Represents the amount of stake associated with the vote.
    - `last_vote_slot`: Indicates the slot number of the last vote.
    - `last_vote_timestamp`: Records the timestamp of the last vote.
    - `commission`: Specifies the commission rate for the vote.
    - `epoch`: Denotes the epoch number for the vote.
    - `epoch_credits`: Tracks the credits earned in the current epoch.
- **Description**: Stores information about a peer's voting activity in a Solana cluster, including account details, stake, voting history, and commission.


---
### fd\_gui\_peers\_vote\_t
- **Type**: ``struct``
- **Members**:
    - `node_account`: Stores the public key of the node account.
    - `vote_account`: Stores the public key of the vote account.
    - `stake`: Represents the amount of stake associated with the vote.
    - `last_vote_slot`: Indicates the slot number of the last vote.
    - `last_vote_timestamp`: Records the timestamp of the last vote.
    - `commission`: Specifies the commission rate for the vote.
    - `epoch`: Denotes the current epoch number.
    - `epoch_credits`: Tracks the credits earned in the current epoch.
- **Description**: Holds information about a peer's voting status in a Solana cluster, including account identifiers, stake, voting history, and commission details.


---
### fd\_gui\_peers\_node
- **Type**: ``struct``
- **Members**:
    - `valid`: Indicates if the node is valid.
    - `update_time_nanos`: Stores the last update time in nanoseconds.
    - `contact_info`: Holds contact information of the peer.
    - `gossvf_rx`: Array of gossip message receive rates.
    - `gossip_tx`: Array of gossip message transmit rates.
    - `gossvf_rx_sum`: Sum of the `gossvf_rx` rates.
    - `gossip_tx_sum`: Sum of the `gossip_tx` rates.
    - `has_val_info`: Indicates if validator information is available.
    - `name`: Stores the name of the validator.
    - `website`: Stores the website URL of the validator.
    - `details`: Stores additional details about the validator.
    - `icon_uri`: Stores the URI for the validator's icon.
    - `has_vote_info`: Indicates if vote information is available.
    - `vote_account`: Holds the vote account public key.
    - `stake`: Stores the stake amount.
    - `last_vote_slot`: Stores the last vote slot number.
    - `last_vote_timestamp`: Stores the timestamp of the last vote.
    - `commission`: Stores the commission percentage.
    - `epoch`: Stores the current epoch number.
    - `epoch_credits`: Stores the epoch credits.
    - `delinquent`: Indicates if the node is delinquent.
    - `pubkey_map`: Links to the next and previous nodes in the public key map.
    - `sock_map`: Links to the next and previous nodes in the socket map.
    - `treaps_live_table`: Array of treap nodes for the live table.
    - `dlist_live_table`: Doubly linked list for the live table.
    - `sort_keys_live_table`: Stores sort keys for the live table.
    - `treaps_bandwidth_tracking`: Array of treap nodes for bandwidth tracking.
    - `dlist_bandwidth_tracking`: Doubly linked list for bandwidth tracking.
    - `sort_keys_bandwidth_tracking`: Stores sort keys for bandwidth tracking.
- **Description**: Represents a node in the GUI peers system, maintaining metrics and metadata about Solana cluster peers active on the Gossip network. It includes fields for contact information, gossip message rates, validator and vote information, and structures for managing linked lists and treaps for sorting and tracking purposes.


---
### fd\_gui\_peers\_node\_t
- **Type**: ``struct``
- **Members**:
    - ``valid``: Indicates if the node is valid.
    - ``update_time_nanos``: Stores the last update time in nanoseconds.
    - ``contact_info``: Holds contact information for the peer.
    - ``gossvf_rx``: Array of metric rates for received gossip messages.
    - ``gossip_tx``: Array of metric rates for transmitted gossip messages.
    - ``gossvf_rx_sum``: Sum of received gossip message rates.
    - ``gossip_tx_sum``: Sum of transmitted gossip message rates.
    - ``has_val_info``: Indicates if validator information is available.
    - ``name``: Stores the name of the validator.
    - ``website``: Stores the website URL of the validator.
    - ``details``: Stores additional details about the validator.
    - ``icon_uri``: Stores the URI for the validator's icon.
    - ``has_vote_info``: Indicates if voting information is available.
    - ``vote_account``: Holds the public key of the vote account.
    - ``stake``: Represents the stake amount.
    - ``last_vote_slot``: Stores the slot number of the last vote.
    - ``last_vote_timestamp``: Stores the timestamp of the last vote.
    - ``commission``: Represents the commission percentage.
    - ``epoch``: Stores the current epoch number.
    - ``epoch_credits``: Stores the credits earned in the current epoch.
    - ``delinquent``: Indicates if the node is delinquent.
    - ``pubkey_map``: Links to the next and previous nodes in the public key map.
    - ``sock_map``: Links to the next and previous nodes in the socket map.
    - ``treaps_live_table``: Array of treap nodes for the live table.
    - ``dlist_live_table``: Doubly linked list for the live table.
    - ``sort_keys_live_table``: Stores the sort keys for the live table.
    - ``treaps_bandwidth_tracking``: Array of treap nodes for bandwidth tracking.
    - ``dlist_bandwidth_tracking``: Doubly linked list for bandwidth tracking.
    - ``sort_keys_bandwidth_tracking``: Stores the sort keys for bandwidth tracking.
- **Description**: Represents a node in the GUI peers system, containing various metrics and metadata about a peer in the Solana cluster. It includes fields for contact information, gossip message metrics, validator and voting information, and structures for managing linked lists and treaps for live table and bandwidth tracking. The structure is designed to handle updates and maintain a comprehensive view of peer activity and status.


---
### fd\_gui\_peers\_gossip\_stats
- **Type**: ``struct``
- **Members**:
    - `sample_time`: Records the time of the sample.
    - `network_health_pull_response_msg_rx_success`: Counts successful received pull response messages.
    - `network_health_pull_response_msg_rx_failure`: Counts failed received pull response messages.
    - `network_health_push_msg_rx_success`: Counts successful received push messages.
    - `network_health_push_msg_rx_failure`: Counts failed received push messages.
    - `network_health_push_crds_rx_duplicate`: Counts duplicate received push CRDS messages.
    - `network_health_pull_response_crds_rx_duplicate`: Counts duplicate received pull response CRDS messages.
    - `network_health_push_crds_rx_success`: Counts successful received push CRDS messages.
    - `network_health_push_crds_rx_failure`: Counts failed received push CRDS messages.
    - `network_health_pull_response_crds_rx_success`: Counts successful received pull response CRDS messages.
    - `network_health_pull_response_crds_rx_failure`: Counts failed received pull response CRDS messages.
    - `network_health_push_msg_tx`: Counts transmitted push messages.
    - `network_health_pull_response_msg_tx`: Counts transmitted pull response messages.
    - `network_health_total_stake`: Records the total network stake in lamports.
    - `network_health_total_peers`: Records the total number of peers in the network.
    - `network_health_connected_stake`: Records the connected network stake in lamports.
    - `network_health_connected_staked_peers`: Records the number of connected staked peers.
    - `network_health_connected_unstaked_peers`: Records the number of connected unstaked peers.
    - `network_ingress_total_bytes`: Records the total ingress bytes.
    - `network_ingress_peer_sz`: Records the size of ingress peers.
    - `network_ingress_peer_bytes_per_sec`: Records the ingress bytes per second for each peer.
    - `network_ingress_peer_names`: Stores the names of ingress peers.
    - `network_ingress_peer_identities`: Stores the identities of ingress peers.
    - `network_ingress_total_bytes_per_sec`: Records the total ingress bytes per second.
    - `network_egress_total_bytes`: Records the total egress bytes.
    - `network_egress_peer_sz`: Records the size of egress peers.
    - `network_egress_peer_bytes_per_sec`: Records the egress bytes per second for each peer.
    - `network_egress_peer_names`: Stores the names of egress peers.
    - `network_egress_peer_identities`: Stores the identities of egress peers.
    - `network_egress_total_bytes_per_sec`: Records the total egress bytes per second.
    - `storage_capacity`: Records the storage capacity.
    - `storage_expired_cnt`: Counts expired storage entries.
    - `storage_evicted_cnt`: Counts evicted storage entries.
    - `storage_active_cnt`: Counts active storage entries for each CRDS value.
    - `storage_cnt_tx`: Counts transmitted storage entries for each CRDS value.
    - `storage_bytes_tx`: Records transmitted storage bytes for each CRDS value.
    - `messages_push_rx_cnt`: Counts received push messages.
    - `messages_push_tx_cnt`: Counts transmitted push messages.
    - `messages_pull_response_rx_cnt`: Counts received pull response messages.
    - `messages_pull_response_tx_cnt`: Counts transmitted pull response messages.
    - `messages_bytes_rx`: Records received message bytes for each gossip message type.
    - `messages_count_rx`: Counts received messages for each gossip message type.
    - `messages_bytes_tx`: Records transmitted message bytes for each gossip message type.
    - `messages_count_tx`: Counts transmitted messages for each gossip message type.
- **Description**: Collects and maintains various statistics related to the health and performance of the network, including message transmission and reception success and failure counts, network stake and peer information, ingress and egress data rates, and storage metrics. It provides a comprehensive view of the network's operational status and performance metrics.


---
### fd\_gui\_peers\_gossip\_stats\_t
- **Type**: ``struct``
- **Members**:
    - ``sample_time``: Stores the timestamp of the sample.
    - ``network_health_pull_response_msg_rx_success``: Counts successful received pull response messages.
    - ``network_health_pull_response_msg_rx_failure``: Counts failed received pull response messages.
    - ``network_health_push_msg_rx_success``: Counts successful received push messages.
    - ``network_health_push_msg_rx_failure``: Counts failed received push messages.
    - ``network_health_push_crds_rx_duplicate``: Counts duplicate received push CRDS messages.
    - ``network_health_pull_response_crds_rx_duplicate``: Counts duplicate received pull response CRDS messages.
    - ``network_health_push_crds_rx_success``: Counts successful received push CRDS messages.
    - ``network_health_push_crds_rx_failure``: Counts failed received push CRDS messages.
    - ``network_health_pull_response_crds_rx_success``: Counts successful received pull response CRDS messages.
    - ``network_health_pull_response_crds_rx_failure``: Counts failed received pull response CRDS messages.
    - ``network_health_push_msg_tx``: Counts transmitted push messages.
    - ``network_health_pull_response_msg_tx``: Counts transmitted pull response messages.
    - ``network_health_total_stake``: Stores the total stake in lamports.
    - ``network_health_total_peers``: Counts the total number of peers.
    - ``network_health_connected_stake``: Stores the connected stake in lamports.
    - ``network_health_connected_staked_peers``: Counts the connected staked peers.
    - ``network_health_connected_unstaked_peers``: Counts the connected unstaked peers.
    - ``network_ingress_total_bytes``: Stores the total ingress bytes.
    - ``network_ingress_peer_sz``: Stores the size of ingress peers.
    - ``network_ingress_peer_bytes_per_sec``: Stores the ingress bytes per second for each peer.
    - ``network_ingress_peer_names``: Stores the names of ingress peers.
    - ``network_ingress_peer_identities``: Stores the identities of ingress peers.
    - ``network_ingress_total_bytes_per_sec``: Stores the total ingress bytes per second.
    - ``network_egress_total_bytes``: Stores the total egress bytes.
    - ``network_egress_peer_sz``: Stores the size of egress peers.
    - ``network_egress_peer_bytes_per_sec``: Stores the egress bytes per second for each peer.
    - ``network_egress_peer_names``: Stores the names of egress peers.
    - ``network_egress_peer_identities``: Stores the identities of egress peers.
    - ``network_egress_total_bytes_per_sec``: Stores the total egress bytes per second.
    - ``storage_capacity``: Stores the storage capacity.
    - ``storage_expired_cnt``: Counts expired storage entries.
    - ``storage_evicted_cnt``: Counts evicted storage entries.
    - ``storage_active_cnt``: Stores the count of active storage entries.
    - ``storage_cnt_tx``: Stores the count of transmitted storage entries.
    - ``storage_bytes_tx``: Stores the bytes of transmitted storage entries.
    - ``messages_push_rx_cnt``: Counts received push messages.
    - ``messages_push_tx_cnt``: Counts transmitted push messages.
    - ``messages_pull_response_rx_cnt``: Counts received pull response messages.
    - ``messages_pull_response_tx_cnt``: Counts transmitted pull response messages.
    - ``messages_bytes_rx``: Stores the bytes of received messages.
    - ``messages_count_rx``: Counts received messages.
    - ``messages_bytes_tx``: Stores the bytes of transmitted messages.
    - ``messages_count_tx``: Counts transmitted messages.
- **Description**: Collects and maintains various statistics related to the health and performance of the network, including message transmission and reception success and failure rates, network ingress and egress data, and storage metrics. It provides a comprehensive view of the network's operational status by tracking metrics such as total stake, peer counts, and data throughput for both ingress and egress operations. The structure is designed to support monitoring and analysis of network health in a Solana cluster environment.


---
### fd\_gui\_peers\_ws\_conn
- **Type**: ``struct``
- **Members**:
    - `connected`: Indicates if the WebSocket connection is active.
    - `connected_time`: Stores the time when the connection was established.
    - `start_row`: Specifies the starting row for the viewport in the peer table.
    - `row_cnt`: Indicates the number of rows in the viewport.
    - `viewport`: An array of `fd_gui_peers_node_t` representing the visible portion of the peer table.
    - `sort_key`: Defines the sorting key for ordering the peer table.
- **Description**: Manages the state and configuration of a WebSocket connection for viewing a subset of a peer table, including connection status, viewport details, and sorting preferences.


---
### fd\_gui\_peers\_ws\_conn\_t
- **Type**: ``struct``
- **Members**:
    - ``connected``: Indicates if the WebSocket connection is active.
    - ``connected_time``: Stores the timestamp when the connection was established.
    - ``start_row``: Specifies the starting row for the viewport in the peer table.
    - ``row_cnt``: Indicates the number of rows in the viewport.
    - ``viewport``: Holds an array of peer nodes visible in the current viewport.
    - ``sort_key``: Defines the sorting key for the live table view.
- **Description**: Manages the state and data for a WebSocket connection to a client, including connection status, timing, and the client's view of the peer table.


---
### fd\_gui\_peers\_ctx
- **Type**: ``struct``
- **Members**:
    - ``next_client_nanos``: Timestamp in nanoseconds for servicing the next WebSocket client.
    - ``next_metric_rate_update_nanos``: Timestamp in nanoseconds for the next update of rate-of-change metrics.
    - ``next_gossip_stats_update_nanos``: Timestamp in nanoseconds for the next broadcast of gossip stats message.
    - ``node_pubkey_map``: Pointer to a map of node public keys.
    - ``node_sock_map``: Pointer to a map of node sockets.
    - ``live_table``: Pointer to a live table structure for peer data.
    - ``bw_tracking``: Pointer to a bandwidth tracking structure.
    - ``http``: Pointer to an HTTP server structure.
    - ``topo``: Pointer to a topology structure.
    - ``max_ws_conn_cnt``: Maximum number of WebSocket connections allowed.
    - ``open_ws_conn_cnt``: Current number of open WebSocket connections.
    - ``active_ws_conn_id``: Identifier for the active WebSocket connection.
    - ``client_viewports``: Pointer to a 2D array representing client viewports for WebSocket connections.
    - ``gossip_stats``: Array containing gossip statistics.
    - ``contact_info_table``: Array containing contact information for nodes.
    - ``votes``: Array containing vote information for nodes.
    - ``votes_scratch``: Array used for fast stable sorting of votes.
- **Description**: Manages the context for GUI peers, including timestamps for client servicing and metric updates, maps for node public keys and sockets, live table and bandwidth tracking structures, HTTP server and topology pointers, WebSocket connection management, gossip statistics, contact information, and vote data.


---
### fd\_gui\_peers\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - `next_client_nanos`: Timestamp for the next WebSocket client service.
    - `next_metric_rate_update_nanos`: Timestamp for the next update of rate-of-change metrics.
    - `next_gossip_stats_update_nanos`: Timestamp for the next broadcast of gossip stats message.
    - `node_pubkey_map`: Pointer to a map of nodes by public key.
    - `node_sock_map`: Pointer to a map of nodes by socket.
    - `live_table`: Pointer to the live table of peers.
    - `bw_tracking`: Pointer to the bandwidth tracking table.
    - `http`: Pointer to the HTTP server.
    - `topo`: Pointer to the topology.
    - `max_ws_conn_cnt`: Maximum number of WebSocket connections.
    - `open_ws_conn_cnt`: Current number of open WebSocket connections.
    - `active_ws_conn_id`: ID of the active WebSocket connection.
    - `client_viewports`: Pointer to a 2D array of client viewports.
    - `gossip_stats`: Array containing gossip statistics.
    - `contact_info_table`: Array containing contact information for nodes.
    - `votes`: Array of vote information.
    - `votes_scratch`: Array for temporary storage during vote sorting.
- **Description**: Manages the context for GUI peers, including WebSocket connections, gossip statistics, and node information. It maintains mappings of nodes by public key and socket, tracks live table and bandwidth data, and handles HTTP server and topology interactions. It also manages WebSocket client viewports and vote information, providing a comprehensive context for peer management in a Solana cluster.


# Functions

---
### live\_table\_col\_pubkey\_lt<!-- {{#callable:live_table_col_pubkey_lt}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L205>)

Compares two public keys to determine if the first is less than the second.
- **Inputs**:
    - ``a``: A pointer to the first public key to compare, cast to `void const *`.
    - ``b``: A pointer to the second public key to compare, cast to `void const *`.
- **Logic and Control Flow**:
    - Casts `a` and `b` to `fd_pubkey_t *` and accesses their `uc` fields.
    - Uses `memcmp` to compare the `uc` fields of the two public keys over 32 bytes.
    - Returns true if the first public key is less than the second, otherwise false.
- **Output**: An integer that is true if the first public key is less than the second, otherwise false.


---
### live\_table\_col\_long\_lt<!-- {{#callable:live_table_col_long_lt}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L206>)

Compares two long integers pointed to by `a` and `b` to determine if the first is less than the second.
- **Inputs**:
    - `a`: Pointer to the first long integer to compare.
    - `b`: Pointer to the second long integer to compare.
- **Logic and Control Flow**:
    - Dereference the pointer `a` to obtain the first long integer value.
    - Dereference the pointer `b` to obtain the second long integer value.
    - Compare the two long integer values to check if the first is less than the second.
- **Output**: Returns a non-zero integer if the first long integer is less than the second, otherwise returns zero.


---
### live\_table\_col\_ipv4\_lt<!-- {{#callable:live_table_col_ipv4_lt}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L207>)

Compares two IPv4 addresses in network byte order to determine if the first is less than the second.
- **Inputs**:
    - ``a``: A pointer to the first IPv4 address to compare, represented as a `uint`.
    - ``b``: A pointer to the second IPv4 address to compare, represented as a `uint`.
- **Logic and Control Flow**:
    - Dereferences the pointer `a` to obtain the first IPv4 address as a `uint`.
    - Applies the `fd_uint_bswap` function to convert the first IPv4 address from network byte order to host byte order.
    - Dereferences the pointer `b` to obtain the second IPv4 address as a `uint`.
    - Applies the `fd_uint_bswap` function to convert the second IPv4 address from network byte order to host byte order.
    - Compares the two converted IPv4 addresses to check if the first is less than the second.
- **Output**: Returns a non-zero integer if the first IPv4 address is less than the second, otherwise returns zero.


# Function Declarations (Public API)

---
### fd\_gui\_peers\_align<!-- {{#callable_declaration:fd_gui_peers_align}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L278>)

Calculates the required memory alignment for peer-related data structures.
- **Description**: Use this function to determine the memory alignment needed for various data structures related to peer management in the GUI. This alignment ensures that all relevant data structures are properly aligned in memory, which is necessary for correct and efficient access. The function returns the maximum alignment requirement among several peer-related components, ensuring that any allocated memory block can accommodate all these components without alignment issues.
- **Inputs**: None
- **Output**: Returns the maximum alignment requirement as an unsigned long integer.
- **See Also**: [`fd_gui_peers_align`](<fd_gui_peers.c.md#fd_gui_peers_align>)  (Implementation)


---
### fd\_gui\_peers\_footprint<!-- {{#callable_declaration:fd_gui_peers_footprint}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L283>)

Calculates the memory footprint for managing WebSocket connections and peer data.
- **Description**: Use this function to determine the memory size needed to manage a specified number of WebSocket connections and associated peer data structures. This calculation is essential before allocating memory for these structures. Ensure that the `max_ws_conn_cnt` parameter accurately reflects the maximum number of WebSocket connections you plan to handle, as this directly affects the computed footprint.
- **Inputs**:
    - `max_ws_conn_cnt`: Specifies the maximum number of WebSocket connections to support. Must be a non-negative integer. The function uses this value to calculate the required memory footprint.
- **Output**: Returns the total memory footprint in bytes needed to manage the specified number of WebSocket connections and peer data.
- **See Also**: [`fd_gui_peers_footprint`](<fd_gui_peers.c.md#fd_gui_peers_footprint>)  (Implementation)


---
### fd\_gui\_peers\_new<!-- {{#callable_declaration:fd_gui_peers_new}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L286>)

Allocates and initializes shared memory for managing peer connections.
- **Description**: Use this function to allocate and initialize shared memory for managing peer connections in a Solana cluster's Gossip network. It sets up the necessary data structures for tracking WebSocket connections, peer metadata, and network metrics. Ensure that the `shmem` pointer is non-null and properly aligned before calling. This function must be called before any operations that require peer management. It returns the shared memory pointer on success or `NULL` if the input is invalid.
- **Inputs**:
    - `shmem`: Pointer to the shared memory region. Must not be null and must be aligned according to `fd_gui_peers_align()`.
    - `http`: Pointer to an `fd_http_server_t` structure. Caller retains ownership.
    - `topo`: Pointer to an `fd_topo_t` structure. Caller retains ownership.
    - `max_ws_conn_cnt`: Maximum number of WebSocket connections to manage. Must be a positive integer.
    - `now`: Current time in nanoseconds since the UNIX epoch. Used to initialize timestamps.
- **Output**: Returns the `shmem` pointer on success, or `NULL` if `shmem` is null or misaligned.
- **See Also**: [`fd_gui_peers_new`](<fd_gui_peers.c.md#fd_gui_peers_new>)  (Implementation)


---
### fd\_gui\_peers\_join<!-- {{#callable_declaration:fd_gui_peers_join}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L293>)

Joins a shared memory region as a GUI peers context.
- **Description**: Use this function to join a shared memory region that represents a GUI peers context. This function checks if the provided shared memory pointer is valid and properly aligned. If the pointer is null or misaligned, the function returns null. Ensure that the shared memory is correctly aligned according to the alignment requirements before calling this function.
- **Inputs**:
    - `shmem`: A pointer to the shared memory region to join. Must not be null and must be aligned according to `fd_gui_peers_align()`. If null or misaligned, the function returns null.
- **Output**: Returns a pointer to `fd_gui_peers_ctx_t` if successful, or null if the input is invalid.
- **See Also**: [`fd_gui_peers_join`](<fd_gui_peers.c.md#fd_gui_peers_join>)  (Implementation)


---
### fd\_gui\_peers\_handle\_gossip\_message<!-- {{#callable_declaration:fd_gui_peers_handle_gossip_message}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L308>)

Parses and tracks gossip message metrics for peers.
- **Description**: Use this function to parse gossip messages and update metrics for peers in a Solana cluster. It processes both incoming and outgoing messages, identified by the `is_rx` flag, and updates the corresponding metrics for the peer identified by `peer_sock`. The function requires a valid `peers` context and a non-null `payload` with a size specified by `payload_sz`. If the peer is unknown or the message is unparsable, the function does nothing. This function is typically used in network monitoring and management systems to maintain accurate metrics of peer communications.
- **Inputs**:
    - `peers`: A pointer to a `fd_gui_peers_ctx_t` structure representing the context for peer management. Must not be null.
    - `payload`: A pointer to the message data to be parsed. Must not be null.
    - `payload_sz`: The size of the `payload` in bytes. Must be a valid size for the given payload.
    - `peer_sock`: A pointer to a `fd_ip4_port_t` structure representing the IPv4 address and port of the peer. Must not be null.
    - `is_rx`: An integer flag indicating if the message is incoming (non-zero) or outgoing (zero).
- **Output**: None
- **See Also**: [`fd_gui_peers_handle_gossip_message`](<fd_gui_peers.c.md#fd_gui_peers_handle_gossip_message>)  (Implementation)


---
### fd\_gui\_peers\_handle\_gossip\_update<!-- {{#callable_declaration:fd_gui_peers_handle_gossip_update}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L318>)

Processes a gossip update message for peer management.
- **Description**: Use this function to handle incoming gossip update messages that modify the state of peers in the network. It updates the peer information based on the type of update message received, which can include adding, updating, or removing peer contact information. This function must be called with a valid context and update message. It ensures that the peer data remains consistent and broadcasts changes to WebSocket clients. Call this function when a new gossip update message is received to maintain an accurate and up-to-date peer table.
- **Inputs**:
    - `peers`: A pointer to a `fd_gui_peers_ctx_t` structure representing the current context of peers. Must not be null. The caller retains ownership.
    - `update`: A pointer to a constant `fd_gossip_update_message_t` structure containing the update message. Must not be null. The function expects the message to be well-formed and valid.
    - `now`: A long integer representing the current time in nanoseconds. Used to timestamp updates.
- **Output**: None
- **See Also**: [`fd_gui_peers_handle_gossip_update`](<fd_gui_peers.c.md#fd_gui_peers_handle_gossip_update>)  (Implementation)


---
### fd\_gui\_peers\_handle\_vote\_update<!-- {{#callable_declaration:fd_gui_peers_handle_vote_update}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L323>)

Updates peer information based on vote data.
- **Description**: Use this function to update the peer information in the context of a Solana cluster based on the provided vote data. This function processes the votes to deduplicate node accounts, calculates the stake-weighted 67th percentile of the last vote slot, and updates the peer information if there are changes in the vote data. It is important to ensure that the `peers` context is properly initialized before calling this function. The function does not handle invalid input values explicitly, so ensure that the input parameters are valid and within expected ranges.
- **Inputs**:
    - `peers`: A pointer to an `fd_gui_peers_ctx_t` structure representing the context of the peers. Must not be null. The caller retains ownership.
    - `votes`: A pointer to an array of `fd_gui_peers_vote_t` structures containing the vote data. Must not be null. The caller retains ownership.
    - `vote_cnt`: The number of votes in the `votes` array. Must be a non-negative value.
    - `now`: A timestamp representing the current time in nanoseconds. This parameter is not used in the function.
- **Output**: None
- **See Also**: [`fd_gui_peers_handle_vote_update`](<fd_gui_peers.c.md#fd_gui_peers_handle_vote_update>)  (Implementation)


---
### fd\_gui\_peers\_ws\_message<!-- {{#callable_declaration:fd_gui_peers_ws_message}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L334>)

Handles incoming WebSocket request payloads for peer-related responses.
- **Description**: Use this function to process incoming WebSocket messages that request information related to peers. It requires a valid context and connection ID, along with the JSON-formatted request data. The function parses the JSON data and determines the appropriate action based on the 'topic' and 'key' fields. It supports 'gossip' topics with 'query_sort' and 'query_scroll' keys. If the JSON is malformed or the topic/key is unrecognized, it returns an error code indicating a bad request or unknown method. Ensure the data is correctly formatted and the connection ID is valid before calling.
- **Inputs**:
    - `peers`: A pointer to a `fd_gui_peers_ctx_t` structure representing the current peer context. Must not be null.
    - `ws_conn_id`: An unsigned long integer representing the WebSocket connection ID of the requester. Must be a valid connection ID.
    - `data`: A pointer to an array of unsigned characters containing the JSON-formatted request payload. Must not be null.
    - `data_len`: An unsigned long integer representing the length of the request payload. Must accurately reflect the size of the data array.
- **Output**: Returns an integer status code. A successful operation returns a code specific to the request type, while errors return codes indicating a bad request or unknown method.
- **See Also**: [`fd_gui_peers_ws_message`](<fd_gui_peers.c.md#fd_gui_peers_ws_message>)  (Implementation)


---
### fd\_gui\_peers\_ws\_open<!-- {{#callable_declaration:fd_gui_peers_ws_open}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L344>)

Opens a WebSocket connection for a new client.
- **Description**: Use this function when a new client establishes a WebSocket connection. It initializes the client's viewport settings and marks the connection as active. This function should be called with the current time to record when the connection was established. It is important to ensure that the `ws_conn_id` is valid and within the range of allocated connections.
- **Inputs**:
    - `peers`: A pointer to an `fd_gui_peers_ctx_t` structure. This must not be null and should be properly initialized before calling this function. The caller retains ownership.
    - `ws_conn_id`: An unsigned long representing the WebSocket connection ID. It must be within the range of allocated connections in the `peers` context.
    - `now`: A long integer representing the current time in UNIX nanoseconds. This value is used to timestamp the connection.
- **Output**: None
- **See Also**: [`fd_gui_peers_ws_open`](<fd_gui_peers.c.md#fd_gui_peers_ws_open>)  (Implementation)


---
### fd\_gui\_peers\_ws\_close<!-- {{#callable_declaration:fd_gui_peers_ws_close}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L350>)

Closes a WebSocket connection for a client.
- **Description**: Use this function to close an existing WebSocket connection for a client identified by the connection ID. This function updates the internal state to reflect the disconnection by removing the client's sort key from the live table, marking the client as disconnected, and adjusting the connection round-robin structure. It is typically called when a client voluntarily closes their connection or when the server needs to terminate the connection.
- **Inputs**:
    - `peers`: A pointer to a `fd_gui_peers_ctx_t` structure that represents the context managing WebSocket connections and peer information. Must not be null.
    - `ws_conn_id`: An unsigned long integer representing the WebSocket connection ID of the client to close. It must be a valid ID corresponding to an active connection.
- **Output**: None
- **See Also**: [`fd_gui_peers_ws_close`](<fd_gui_peers.c.md#fd_gui_peers_ws_close>)  (Implementation)


---
### fd\_gui\_peers\_poll<!-- {{#callable_declaration:fd_gui_peers_poll}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_peers.h#L357>)

Periodically updates peer state and publishes WebSocket messages.
- **Description**: Use this function in the main loop of the tile to update the internal state of peers and send new WebSocket messages to clients. It requires a valid context and a current timestamp. The function manages client viewports, updates metrics, and broadcasts gossip statistics. It should be called regularly to ensure timely updates and message delivery.
- **Inputs**:
    - `peers`: A pointer to a `fd_gui_peers_ctx_t` structure representing the context of the peers. Must not be null.
    - `now`: A long integer representing the current time in UNIX nanoseconds. Must be a valid timestamp.
- **Output**: Returns an integer indicating whether any work was done (1) or not (0).
- **See Also**: [`fd_gui_peers_poll`](<fd_gui_peers.c.md#fd_gui_peers_poll>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)