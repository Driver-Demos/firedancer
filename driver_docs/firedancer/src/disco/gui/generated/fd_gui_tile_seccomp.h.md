<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall handling in a GUI application, generated by a script.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a graphical user interface (GUI) application. The file is automatically generated and should not be edited manually. It includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_gui_tile`](<#populate_sock_filter_policy_fd_gui_tile>), initializes a BPF filter array with 45 instructions that enforce security policies by allowing or denying specific system calls based on predefined conditions.

The filter checks the architecture of the executing environment and compares it with the expected architecture. It then evaluates system calls such as `write`, `fsync`, `accept4`, `read`, `sendto`, `close`, and `ppoll`. Each system call is conditionally allowed or denied based on the arguments passed to it, specifically checking against file descriptors for a log file and a GUI socket. If a system call does not match the allowed criteria, the process is terminated using `SECCOMP_RET_KILL_PROCESS`. If the conditions are met, the system call is allowed with `SECCOMP_RET_ALLOW`. This seccomp filter enhances the security of the application by restricting its ability to make potentially harmful system calls.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_gui\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: The `sock_filter_policy_fd_gui_tile_instr_cnt` is a constant unsigned integer that represents the number of instructions in a socket filter policy for a GUI tile. It is set to 45, indicating the total number of BPF (Berkeley Packet Filter) instructions used in the filter policy.
- **Use**: Used to define the size of the `filter` array in the `populate_sock_filter_policy_fd_gui_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_gui\_tile<!-- {{#callable:populate_sock_filter_policy_fd_gui_tile}} -->
[View Source →](<../../../../../../src/disco/gui/generated/fd_gui_tile_seccomp.h#L26>)

Populates a socket filter policy with specific rules for system call filtering based on file descriptors and architecture.
- **Inputs**:
    - `out_cnt`: The number of filter instructions expected in the output, must be at least 45.
    - `out`: A pointer to a `struct sock_filter` array where the filter policy will be stored.
    - `logfile_fd`: The file descriptor for the log file, used in syscall checks.
    - `gui_socket_fd`: The file descriptor for the GUI socket, used in syscall checks.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 45 using `FD_TEST` macro.
    - Define a `struct sock_filter` array `filter` with 45 elements to specify the seccomp filter rules.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; if not equal, jump to `RET_KILL_PROCESS`.
    - Load the syscall number and check against allowed syscalls (`write`, `fsync`, `accept4`, `read`, `sendto`, `close`, `ppoll`).
    - For each allowed syscall, load the first argument and compare it with specific values (e.g., `logfile_fd`, `gui_socket_fd`) to determine if the syscall should be allowed or the process should be killed.
    - Use `fd_memcpy` to copy the `filter` array to the `out` array.
- **Output**: The function does not return a value; it populates the `out` array with the defined seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)