<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a GUI tile for the Firedancer project, handling HTTP requests, WebSocket connections, and various message types for frontend and backend communication.

# Purpose
The code is a C source file that implements a graphical user interface (GUI) server for a distributed system. It is part of a larger software architecture, as indicated by the inclusion of multiple headers and the use of various components from different modules. The primary function of this code is to handle HTTP requests and WebSocket connections, serving static frontend assets and managing communication with other components of the system.

Key components of the code include the `fd_http_server_t` structure, which is used to configure and manage the HTTP server, and the `fd_gui_ctx_t` structure, which maintains the context for the GUI operations. The code defines several functions to handle different stages of HTTP and WebSocket communication, such as [`gui_http_request`](<#gui_http_request>), [`gui_ws_open`](<#gui_ws_open>), [`gui_ws_close`](<#gui_ws_close>), and [`gui_ws_message`](<#gui_ws_message>). It also includes logic for processing various types of messages and signals received from other parts of the system, using a set of predefined message kinds and signal types. The code is designed to be integrated into a larger system, as evidenced by the use of macros and functions for memory allocation, logging, and configuration management.
# Imports and Dependencies

---
- `../../disco/gui/generated/http_import_dist.h`
- `sys/socket.h`
- `stdlib.h`
- `generated/fd_gui_tile_seccomp.h`
- `../../disco/tiles.h`
- `../../disco/keyguard/fd_keyload.h`
- `../../disco/keyguard/fd_keyswitch.h`
- `../../disco/gui/fd_gui.h`
- `../../disco/plugin/fd_plugin.h`
- `../../discof/genesis/fd_genesi_tile.h`
- `../../waltz/http/fd_http_server.h`
- `../../ballet/json/cJSON.h`
- `../../util/clock/fd_clock.h`
- `../../discof/repair/fd_repair.h`
- `../../util/pod/fd_pod_format.h`
- `../../flamenco/gossip/fd_gossip_private.h`
- `../../flamenco/runtime/fd_bank.h`
- `../../disco/stem/fd_stem.c`


# Global Variables

---
### STATIC\_FILES
- **Type**: ``fd_http_static_file_t *``
- **Description**: A pointer to a list of static files used to serve the frontend of the application. This list is populated at boot based on the `development.gui.frontend_release_channel` option.
- **Use**: Accessed in the `gui_http_request` callback to serve frontend assets.


---
### cjson\_alloc\_ctx
- **Type**: ``fd_alloc_t *``
- **Description**: Points to an instance of `fd_alloc_t`, which is a type used for memory allocation management. It is declared as a static variable, meaning it is limited to the file scope and retains its value between function calls.
- **Use**: Used to manage memory allocation for the cJSON library, providing custom allocation and deallocation functions.


---
### fdctl\_version\_string
- **Type**: ``char const[]``
- **Description**: A constant character array that stores the version string for the `fdctl` component.
- **Use**: Used to store and provide the version information of the `fdctl` component.


---
### fd\_tile\_gui
- **Type**: ``fd_topo_run_tile_t``
- **Description**: Defines a structure for a GUI tile in the Firedancer system. It includes function pointers and parameters for resource limits, security policies, memory alignment, initialization, and execution.
- **Use**: Used to configure and manage the execution of a GUI tile within the Firedancer topology.


# Data Structures

---
### fd\_gui\_in\_ctx
- **Type**: ``struct``
- **Members**:
    - ``mem``: Pointer to a `fd_wksp_t` structure, representing a memory workspace.
    - ``mtu``: Unsigned long integer representing the maximum transmission unit.
    - ``chunk0``: Unsigned long integer representing the starting chunk index.
    - ``wmark``: Unsigned long integer representing the watermark or upper limit for chunks.
- **Description**: `fd_gui_in_ctx` is a structure that holds context information for GUI input operations, including a memory workspace pointer, maximum transmission unit, starting chunk index, and a watermark for chunk management.


---
### fd\_gui\_in\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``mem``: Pointer to a workspace (`fd_wksp_t`) used for memory management.
    - ``mtu``: Maximum transmission unit size for data chunks.
    - ``chunk0``: Initial chunk index for data processing.
    - ``wmark``: Watermark indicating the upper limit of chunk processing.
- **Description**: Manages input context for GUI operations, including memory workspace, data chunking, and processing limits.


---
### fd\_gui\_out\_ctx
- **Type**: ``struct``
- **Members**:
    - ``idx``: Stores an index value as an unsigned long integer.
    - ``mem``: Points to a memory workspace of type `fd_wksp_t`.
    - ``chunk0``: Holds the initial chunk value as an unsigned long integer.
    - ``wmark``: Represents a watermark value as an unsigned long integer.
    - ``chunk``: Stores the current chunk value as an unsigned long integer.
- **Description**: The `fd_gui_out_ctx` structure is used to manage output context in a GUI application. It includes an index, a pointer to a memory workspace, and several unsigned long integers to track chunk and watermark values. This structure is likely used to handle data output operations, ensuring that memory and data chunks are managed efficiently.


---
### fd\_gui\_out\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``idx``: Index of the output context.
    - ``mem``: Pointer to a workspace memory structure.
    - ``chunk0``: Initial chunk index for the output context.
    - ``wmark``: Watermark for the output context.
    - ``chunk``: Current chunk index for the output context.
- **Description**: `fd_gui_out_ctx_t` is a structure that manages the output context for GUI operations, including memory management and chunk handling. It contains fields for indexing, memory workspace, and chunk management, which are essential for handling data output in a GUI context.


---
### fd\_gui\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``topo``: Pointer to a `fd_topo_t` structure.
    - ``banks``: Pointer to a `fd_banks_t` structure.
    - ``is_full_client``: Indicates if the client is a full client.
    - ``snapshots_enabled``: Indicates if snapshots are enabled.
    - ``gui``: Pointer to a `fd_gui_t` structure.
    - ``peers``: Pointer to a `fd_gui_peers_ctx_t` structure.
    - ``ref_wallclock``: Reference wall clock time.
    - ``ref_tickcount``: Reference tick count.
    - ``clock``: Array of `fd_clock_t` for timing.
    - ``recal_next``: Next recalibration time in nanoseconds.
    - ``clock_mem``: Memory aligned for clock operations.
    - ``buf``: Buffer for message handling, aligned to 64 bytes.
    - ``gui_server``: Pointer to a `fd_http_server_t` structure.
    - ``next_poll_deadline``: Next poll deadline time.
    - ``version_string``: String for version information.
    - ``keyswitch``: Pointer to a `fd_keyswitch_t` structure.
    - ``identity_key``: Pointer to the identity key.
    - ``has_vote_key``: Indicates if a vote key is present.
    - ``vote_key``: Array of `fd_pubkey_t` for the vote key.
    - ``in_kind``: Array indicating the kind of input.
    - ``in_bank_idx``: Array of bank indices for input.
    - ``in``: Array of `fd_gui_in_ctx_t` structures for input context.
    - ``replay_out``: Array of `fd_gui_out_ctx_t` structures for replay output context.
- **Description**: `fd_gui_ctx_t` is a structure that manages the context for a graphical user interface (GUI) in a distributed system. It includes pointers to various components such as topology, banks, GUI, and peers, as well as timing and synchronization elements like clocks and tick counts. The structure also handles message buffering and server interactions, with fields for versioning, identity, and voting keys. It supports both full and partial client configurations, with specific fields for input and output contexts.


# Functions

---
### derive\_http\_params<!-- {{#callable:derive_http_params}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L59>)

Creates and returns an `fd_http_server_params_t` structure with parameters derived from the input `tile`.
- **Inputs**:
    - `tile`: A pointer to a constant `fd_topo_tile_t` structure containing GUI configuration parameters.
- **Logic and Control Flow**:
    - Accesses the `max_http_connections` from `tile->gui` and assigns it to `max_connection_cnt` in the returned structure.
    - Accesses the `max_websocket_connections` from `tile->gui` and assigns it to `max_ws_connection_cnt` in the returned structure.
    - Sets `max_request_len` to the constant `FD_HTTP_SERVER_GUI_MAX_REQUEST_LEN`.
    - Sets `max_ws_recv_frame_len` to the constant `FD_HTTP_SERVER_GUI_MAX_WS_RECV_FRAME_LEN`.
    - Sets `max_ws_send_frame_cnt` to the constant `FD_HTTP_SERVER_GUI_MAX_WS_SEND_FRAME_CNT`.
    - Calculates `outgoing_buffer_sz` by multiplying `tile->gui.send_buffer_size_mb` by 2^20 and assigns it to the corresponding field in the returned structure.
    - Assigns `tile->gui.websocket_compression` to `compress_websocket` in the returned structure.
- **Output**: Returns an `fd_http_server_params_t` structure with HTTP server parameters.


---
### scratch\_align<!-- {{#callable:scratch_align}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L138>)

Returns a constant alignment value of 128.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function does not take any inputs.
    - The function returns the constant value `128UL`.
- **Output**: A constant unsigned long integer value of 128.


---
### scratch\_footprint<!-- {{#callable:scratch_footprint}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L143>)

Calculates the memory footprint required for various GUI components based on the configuration of a given tile.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure containing configuration parameters for the GUI.
- **Logic and Control Flow**:
    - Derives HTTP server parameters from the `tile` configuration using [`derive_http_params`](<#derive_http_params>).
    - Calculates the HTTP server footprint using `fd_http_server_footprint` with the derived parameters.
    - Checks if the HTTP server footprint is valid; logs an error if not.
    - Initializes a layout with `FD_LAYOUT_INIT`.
    - Appends the footprint of `fd_gui_ctx_t` to the layout using `FD_LAYOUT_APPEND`.
    - Appends the HTTP server footprint to the layout.
    - Appends the footprint for GUI peers using `fd_gui_peers_footprint` and the maximum WebSocket connection count from the HTTP parameters.
    - Appends the footprint for the GUI using `fd_gui_footprint`.
    - Appends the footprint for memory allocation using `fd_alloc_footprint`.
    - Finalizes the layout with `FD_LAYOUT_FINI` and returns the total footprint.
- **Output**: Returns the total memory footprint as an `ulong`.
- **Functions Called**:
    - [`derive_http_params`](<#derive_http_params>)
    - [`scratch_align`](<#scratch_align>)


---
### loose\_footprint<!-- {{#callable:loose_footprint}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L158>)

Calculates the memory footprint required for the `cJSON` allocator, returning a fixed size of 256 MiB.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure, which is marked as unused in this function.
- **Logic and Control Flow**:
    - The function takes a single input parameter `tile`, which is not used in the function body.
    - It returns a constant value representing 256 MiB of memory, calculated as `256UL * (1UL<<20UL)`.
- **Output**: Returns an `ulong` representing 256 MiB of memory space.


---
### during\_housekeeping<!-- {{#callable:during_housekeeping}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L163>)

Updates the reference wallclock and tick count, recalibrates the clock if needed, and handles keyswitch state transitions.
- **Inputs**:
    - `ctx`: A pointer to an `fd_gui_ctx_t` structure that contains the context for the GUI, including clock, keyswitch, and other state information.
- **Logic and Control Flow**:
    - Update `ctx->ref_wallclock` with the current wallclock time using `fd_log_wallclock()`.
    - Update `ctx->ref_tickcount` with the current tick count using `fd_tickcount()`.
    - Check if the current clock time is greater than or equal to `ctx->recal_next` using `fd_clock_now()`.
    - If recalibration is needed, update `ctx->recal_next` with the next recalibration time using `fd_clock_default_recal()`.
    - Check if the keyswitch state is `FD_KEYSWITCH_STATE_SWITCH_PENDING` using `fd_keyswitch_state_query()`.
    - If the keyswitch state is pending, set the GUI identity using `fd_gui_set_identity()` and update the keyswitch state to `FD_KEYSWITCH_STATE_COMPLETED` using `fd_keyswitch_state()`.
- **Output**: No return value; the function modifies the state of the `ctx` structure.


---
### before\_credit<!-- {{#callable:before_credit}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L178>)

Monitors and updates the GUI context by polling the HTTP server and GUI components, and sets the `charge_busy` flag based on activity.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_gui_ctx_t` structure, which contains the GUI context and related data.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is not used in this function.
    - ``charge_busy``: A pointer to an integer where the function stores the result of the busy charge calculation.
- **Logic and Control Flow**:
    - Initialize `charge_busy_server` to 0 and get the current tick count in `now`.
    - Check if `now` is greater than or equal to `ctx->next_poll_deadline`; if true, poll the HTTP server and update `ctx->next_poll_deadline`.
    - Initialize `charge_poll` to 0 and poll the GUI; if `ctx->is_full_client` is true, also poll the GUI peers.
    - Combine `charge_busy_server` and `charge_poll` using a bitwise OR operation and store the result in `*charge_busy`.
- **Output**: The function outputs an integer value through the `charge_busy` pointer, indicating whether the server or GUI components are busy.


---
### before\_frag<!-- {{#callable:before_frag}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L198>)

Determines if a signal should be ignored based on the input kind and signal value.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_gui_ctx_t` structure that contains context information, including the `in_kind` array.
    - ``in_idx``: An unsigned long integer representing the index into the `in_kind` array of the context.
    - ``seq``: An unsigned long integer representing a sequence number, which is not used in this function.
    - ``sig``: An unsigned long integer representing a signal value to be checked.
- **Logic and Control Flow**:
    - The function ignores the `seq` parameter by casting it to void.
    - Checks if the `in_kind` at the index `in_idx` in the context is equal to `IN_KIND_PACK_POH` and if the `sig` is equal to `ULONG_MAX`.
    - If both conditions are true, the function returns 1, indicating the signal should be ignored.
    - If the conditions are not met, the function returns 0, indicating the signal should not be ignored.
- **Output**: Returns an integer, 1 if the signal should be ignored, otherwise 0.


---
### during\_frag<!-- {{#callable:during_frag}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L210>)

Processes incoming data fragments based on their type and signature, adjusting their size and copying them to a buffer.
- **Inputs**:
    - `ctx`: A pointer to the `fd_gui_ctx_t` context structure containing input and output configurations.
    - `in_idx`: The index of the input source in the context's input array.
    - `seq`: The sequence number of the fragment, marked as unused.
    - `sig`: The signature of the fragment, used to determine the type of message.
    - `chunk`: The chunk identifier for locating the data in memory.
    - `sz`: The size of the data fragment.
    - `gui`: A parameter marked as unused.
- **Logic and Control Flow**:
    - Convert the chunk identifier to a memory address using `fd_chunk_to_laddr` and store it in `src`.
    - Check the type of input (`in_kind`) and adjust the size (`sz`) based on the signature (`sig`) and message type.
    - For `IN_KIND_PLUGIN`, adjust `sz` based on the message type (e.g., `FD_PLUGIN_MSG_GOSSIP_UPDATE`, `FD_PLUGIN_MSG_VOTE_ACCOUNT_UPDATE`, `FD_PLUGIN_MSG_LEADER_SCHEDULE`).
    - For `IN_KIND_REPLAY_STAKE`, verify and adjust `sz` based on the leader schedule's staked count.
    - For `IN_KIND_GENESI_OUT`, adjust `sz` if the signature is `GENESI_SIG_BOOTSTRAP_COMPLETED`.
    - For `IN_KIND_REPLAY_OUT`, return early if the signature is not `REPLAY_SIG_SLOT_COMPLETED` or `REPLAY_SIG_BECAME_LEADER`.
    - For `IN_KIND_SHRED_OUT`, return early as the fragment type is distinguished by size.
    - Check if the chunk is within valid range and size limits; log an error if not.
    - Copy the data from `src` to the context's buffer using `fd_memcpy`.
- **Output**: No direct output; modifies the context's buffer with the processed data fragment.


---
### after\_frag<!-- {{#callable:after_frag}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L265>)

Processes different types of input signals and updates the GUI context accordingly.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_gui_ctx_t` structure, which holds the GUI context and related data.
    - ``in_idx``: An unsigned long integer representing the index of the input kind in the `ctx->in_kind` array.
    - ``seq``: An unsigned long integer representing the sequence number, which is not used in this function.
    - ``sig``: An unsigned long integer representing the signal type to process.
    - ``sz``: An unsigned long integer representing the size of the data buffer.
    - ``tsorig``: An unsigned long integer representing the original timestamp of the data.
    - ``tspub``: An unsigned long integer representing the publication timestamp of the data.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is not used in this function.
- **Logic and Control Flow**:
    - Ignores `seq` and `stem` parameters as they are not used in the function.
    - Switches on the input kind from `ctx->in_kind[in_idx]` to determine the processing path.
    - For `IN_KIND_PLUGIN`, checks if the client is not full and sends a plugin message to the GUI.
    - For `IN_KIND_REPLAY_OUT`, processes slot completion or leader signals, updates vote information, and publishes slot data.
    - For `IN_KIND_REPLAY_STAKE`, handles leader schedule updates.
    - For `IN_KIND_GENESI_OUT`, processes genesis hash updates based on the signal type.
    - For `IN_KIND_TOWER_OUT`, updates tower information in the GUI.
    - For `IN_KIND_SHRED_OUT`, processes shred data if the size is valid and updates the GUI with shred information.
    - For `IN_KIND_SNAPCT`, updates snapshot information in the GUI.
    - For `IN_KIND_REPAIR_NET`, processes repair messages and updates the GUI with repair slot information.
    - For `IN_KIND_NET_GOSSVF` and `IN_KIND_GOSSIP_NET`, processes gossip messages and updates peer information.
    - For `IN_KIND_GOSSIP_OUT`, processes gossip updates and updates peer information.
    - For `IN_KIND_POH_PACK`, processes leader signals and updates the GUI.
    - For `IN_KIND_PACK_POH`, processes unbecame leader signals and updates the GUI.
    - For `IN_KIND_PACK_BANK`, processes microblock execution begin signals and updates the GUI.
    - For `IN_KIND_BANK_POH`, processes microblock execution end signals and updates the GUI.
    - Logs an error if an unexpected input kind is encountered.
- **Output**: No return value; the function updates the GUI context and related structures based on the input kind and signal.


---
### gui\_http\_request<!-- {{#callable:gui_http_request}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L505>)

Handles HTTP requests by checking the request method and path, and returns an appropriate HTTP response.
- **Inputs**:
    - ``request``: A pointer to a `fd_http_server_request_t` structure that contains the HTTP request details, including method, path, and headers.
- **Logic and Control Flow**:
    - Check if the request method is not `GET`; if true, return a response with status 405 (Method Not Allowed).
    - Check if the request path is `/websocket`; if true, return a response with status 200, indicating a WebSocket upgrade, and set `compress_websocket` based on the request headers and compile-time options.
    - Check if the request path is `/favicon.svg`; if true, return a response with status 200, serving the `firedancer_svg` as a static body with content type `image/svg+xml`.
    - Determine if the request path corresponds to a Vite page by checking against a list of known paths and patterns.
    - Iterate over `STATIC_FILES` to find a matching static file for the request path; if found, determine the content type and cache control headers based on the file extension and path.
    - Check the request headers for accepted encodings (`zstd` and `gzip`) and adjust the response's content encoding and body data accordingly.
    - If a matching static file is found, return a response with status 200, including the static file data, content type, cache control, and content encoding.
    - If no conditions are met, return a response with status 404 (Not Found).
- **Output**: Returns a `fd_http_server_response_t` structure containing the HTTP response status, headers, and body based on the request details.


---
### gui\_ws\_open<!-- {{#callable:gui_ws_open}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L601>)

Opens a WebSocket connection for the GUI and, if applicable, for peers.
- **Inputs**:
    - ``conn_id``: The connection identifier for the WebSocket connection.
    - ``_ctx``: A pointer to the context, specifically a `fd_gui_ctx_t` structure.
- **Logic and Control Flow**:
    - Cast `_ctx` to a `fd_gui_ctx_t` pointer and store it in `ctx`.
    - Call `fd_gui_ws_open` with `ctx->gui` and `conn_id` to open the WebSocket connection for the GUI.
    - Check if `ctx->is_full_client` is true; if so, call `fd_gui_peers_ws_open` with `ctx->peers`, `conn_id`, and the current clock time to open the WebSocket connection for peers.
- **Output**: No return value (void function).


---
### gui\_ws\_close<!-- {{#callable:gui_ws_close}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L610>)

Closes a WebSocket connection for a GUI context if it is a full client.
- **Inputs**:
    - ``conn_id``: The unique identifier for the WebSocket connection to close.
    - ``reason``: The reason for closing the connection, which is not used in this function.
    - ``_ctx``: A pointer to the GUI context (`fd_gui_ctx_t`) associated with the connection.
- **Logic and Control Flow**:
    - Cast `_ctx` to `fd_gui_ctx_t` type and assign it to `ctx`.
    - Check if `ctx->is_full_client` is true, indicating a full client context.
    - If true, call `fd_gui_peers_ws_close` with `ctx->peers` and `conn_id` to close the WebSocket connection.
- **Output**: No return value; the function performs an action.


---
### gui\_ws\_message<!-- {{#callable:gui_ws_message}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L619>)

Handles WebSocket messages by processing them through the GUI context and closing the connection if necessary.
- **Inputs**:
    - ``ws_conn_id``: The WebSocket connection identifier.
    - ``data``: A pointer to the data received in the WebSocket message.
    - ``data_len``: The length of the data received.
    - ``_ctx``: A pointer to the GUI context (`fd_gui_ctx_t`).
- **Logic and Control Flow**:
    - Cast `_ctx` to `fd_gui_ctx_t` and store it in `ctx`.
    - Call `fd_gui_ws_message` with `ctx->gui`, `ws_conn_id`, `data`, and `data_len` to process the message and store the result in `reason`.
    - If `ctx->is_full_client` is true and `reason` equals `FD_HTTP_SERVER_CONNECTION_CLOSE_UNKNOWN_METHOD`, call `fd_gui_peers_ws_message` with `ctx->peers`, `ws_conn_id`, `data`, and `data_len` to process the message again and update `reason`.
    - If `reason` is less than 0, call `fd_http_server_ws_close` with `ctx->gui_server`, `ws_conn_id`, and `reason` to close the WebSocket connection.
- **Output**: No return value; the function performs actions based on the WebSocket message and may close the connection.


---
### privileged\_init<!-- {{#callable:privileged_init}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L632>)

Initializes a GUI server with HTTP and WebSocket capabilities, setting up necessary parameters and keys.
- **Inputs**:
    - ``topo``: A pointer to an `fd_topo_t` structure representing the topology configuration.
    - ``tile``: A pointer to an `fd_topo_tile_t` structure representing the tile configuration.
- **Logic and Control Flow**:
    - Obtain a scratch memory address using `fd_topo_obj_laddr` with `topo` and `tile->tile_obj_id`.
    - Initialize a scratch allocator with `FD_SCRATCH_ALLOC_INIT`.
    - Allocate memory for `fd_gui_ctx_t` and `fd_http_server_t` using `FD_SCRATCH_ALLOC_APPEND`.
    - Derive HTTP server parameters using [`derive_http_params`](<#derive_http_params>) with `tile`.
    - Create a new HTTP server with `fd_http_server_new`, passing the derived parameters and callback functions.
    - Join the HTTP server to the context using `fd_http_server_join`.
    - Start listening on the server using `fd_http_server_listen` with the address and port from `tile->gui`.
    - Log a notice message indicating the server is listening.
    - Check if `tile->gui.identity_key_path` is set; log an error if not.
    - Load the identity key using `fd_keyload_load` with `tile->gui.identity_key_path`.
    - Check if `tile->gui.vote_key_path` is set; if not, set `ctx->has_vote_key` to 0.
    - If `tile->gui.vote_key_path` is set, attempt to decode it using `fd_base58_decode_32`; if decoding fails, load the vote key using `fd_keyload_load` and copy it to `ctx->vote_key->uc`.
- **Output**: No return value; the function operates by side effects, initializing the server and context.
- **Functions Called**:
    - [`derive_http_params`](<#derive_http_params>)


---
### cjson\_alloc<!-- {{#callable:cjson_alloc}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L672>)

Allocates memory of a specified size using a custom allocator if available, otherwise defaults to standard `malloc`.
- **Inputs**:
    - `sz`: The size in bytes of the memory to allocate.
- **Logic and Control Flow**:
    - Checks if `cjson_alloc_ctx` is set, indicating a custom allocator is available.
    - If `cjson_alloc_ctx` is available, calls `fd_alloc_malloc` with `cjson_alloc_ctx`, alignment of 8 bytes, and the requested size `sz`.
    - If `cjson_alloc_ctx` is not available, calls the standard `malloc` function with the requested size `sz`.
- **Output**: A pointer to the allocated memory block, or `NULL` if the allocation fails.


---
### cjson\_free<!-- {{#callable:cjson_free}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L681>)

Frees memory allocated for a pointer using a custom allocator if available, otherwise uses the standard `free` function.
- **Inputs**:
    - `ptr`: A pointer to the memory block to be freed.
- **Logic and Control Flow**:
    - Checks if the custom allocator context `cjson_alloc_ctx` is available using `FD_LIKELY`.
    - If `cjson_alloc_ctx` is available, calls `fd_alloc_free` with `cjson_alloc_ctx` and `ptr` to free the memory.
    - If `cjson_alloc_ctx` is not available, calls the standard `free` function with `ptr`.
- **Output**: No return value; the function performs a memory deallocation operation.


---
### unprivileged\_init<!-- {{#callable:unprivileged_init}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L692>)

Initializes the unprivileged components of a GUI tile in a distributed system topology.
- **Inputs**:
    - ``topo``: A pointer to the `fd_topo_t` structure representing the system topology.
    - ``tile``: A pointer to the `fd_topo_tile_t` structure representing the specific tile to initialize.
- **Logic and Control Flow**:
    - Retrieve the local address of the tile object using `fd_topo_obj_laddr` and store it in `scratch`.
    - Determine the frontend release channel from the GUI tile and set the `STATIC_FILES` pointer accordingly.
    - Derive HTTP server parameters using [`derive_http_params`](<#derive_http_params>) based on the tile configuration.
    - Initialize scratch memory allocation using `FD_SCRATCH_ALLOC_INIT` and allocate memory for various components such as `fd_gui_ctx_t`, HTTP server, peers, GUI, and allocator using `FD_SCRATCH_ALLOC_APPEND`.
    - Set flags `is_full_client` and `snapshots_enabled` based on the presence of 'repair' and 'snapct' tiles in the topology.
    - Initialize the clock and set recalibration and reference timestamps using `fd_clock_default_init`, `fd_clock_recal_next`, `fd_log_wallclock`, and `fd_tickcount`.
    - Format the version string using `fd_cstr_printf_check`.
    - Join the GUI peers and GUI components using `fd_gui_peers_join` and `fd_gui_join`.
    - Join the keyswitch component using `fd_keyswitch_join`.
    - Initialize the JSON hooks for memory allocation using `cJSON_InitHooks`.
    - Set the next poll deadline using `fd_tickcount`.
    - Query the banks object ID and join the banks component if `is_full_client` is true.
    - Iterate over input links, determine their kind, and configure input contexts accordingly.
    - If `is_full_client`, find the output link index for 'gui_replay' and set it in the replay output context.
    - Finalize the scratch memory allocation and check for overflow using `FD_SCRATCH_ALLOC_FINI`.
- **Output**: No return value; the function initializes components and sets up the context for the GUI tile.
- **Functions Called**:
    - [`derive_http_params`](<#derive_http_params>)
    - [`scratch_footprint`](<#scratch_footprint>)


---
### populate\_allowed\_seccomp<!-- {{#callable:populate_allowed_seccomp}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L793>)

Initializes and populates a seccomp filter policy for a GUI tile in a topology.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure representing the topology.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure representing the tile within the topology.
    - ``out_cnt``: An unsigned long integer representing the count of output filters.
    - ``out``: A pointer to a `struct sock_filter` array where the seccomp filter policy will be populated.
- **Logic and Control Flow**:
    - Retrieve the local address of the tile object using `fd_topo_obj_laddr` and store it in `scratch`.
    - Initialize a scratch allocator with `FD_SCRATCH_ALLOC_INIT` using `scratch`.
    - Allocate memory for a `fd_gui_ctx_t` structure using `FD_SCRATCH_ALLOC_APPEND`.
    - Call [`populate_sock_filter_policy_fd_gui_tile`](<generated/fd_gui_tile_seccomp.h.md#populate_sock_filter_policy_fd_gui_tile>) to populate the seccomp filter policy with the given `out_cnt`, `out`, and file descriptors for logging and the GUI server.
    - Return the instruction count from `sock_filter_policy_fd_gui_tile_instr_cnt`.
- **Output**: Returns the number of instructions in the seccomp filter policy as an unsigned long integer.
- **Functions Called**:
    - [`populate_sock_filter_policy_fd_gui_tile`](<generated/fd_gui_tile_seccomp.h.md#populate_sock_filter_policy_fd_gui_tile>)


---
### populate\_allowed\_fds<!-- {{#callable:populate_allowed_fds}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L806>)

Populates an array with file descriptors for standard error, a log file, and a GUI server socket, returning the count of these descriptors.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure representing the topology.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure representing the tile configuration.
    - ``out_fds_cnt``: An unsigned long indicating the maximum number of file descriptors that can be stored in `out_fds`.
    - ``out_fds``: A pointer to an integer array where the function will store the allowed file descriptors.
- **Logic and Control Flow**:
    - Allocate scratch memory using `fd_topo_obj_laddr` and `FD_SCRATCH_ALLOC_INIT`.
    - Append a `fd_gui_ctx_t` structure to the scratch memory using `FD_SCRATCH_ALLOC_APPEND`.
    - Check if `out_fds_cnt` is less than 3; if so, log an error using `FD_LOG_ERR`.
    - Initialize `out_cnt` to 0 and set `out_fds[out_cnt++]` to 2 for standard error.
    - Check if the log file descriptor is valid using `fd_log_private_logfile_fd`; if valid, add it to `out_fds`.
    - Add the GUI server socket file descriptor to `out_fds` using `fd_http_server_fd`.
    - Return the count of file descriptors stored in `out_fds`.
- **Output**: Returns the number of file descriptors stored in `out_fds` as an unsigned long.


---
### rlimit\_file\_cnt<!-- {{#callable:rlimit_file_cnt}} -->
[View Source →](<../../../../../src/disco/gui/fd_gui_tile.c#L825>)

Calculates the total number of file descriptors needed for a GUI tile, including base descriptors and maximum HTTP and WebSocket connections.
- **Inputs**:
    - `topo`: A pointer to a `fd_topo_t` structure, which is not used in this function.
    - `tile`: A pointer to a `fd_topo_tile_t` structure that contains the GUI configuration, specifically `max_http_connections` and `max_websocket_connections`.
- **Logic and Control Flow**:
    - Initialize a base count of 5 file descriptors for pipefd, socket, stderr, logfile, and a spare for new accept() connections.
    - Add the maximum number of HTTP connections from `tile->gui.max_http_connections` to the base count.
    - Add the maximum number of WebSocket connections from `tile->gui.max_websocket_connections` to the total.
- **Output**: Returns the total number of file descriptors as an unsigned long integer.



---
Made with ❤️ by [Driver](https://www.driver.ai/)