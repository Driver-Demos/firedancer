<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Measures and prints incoming bandwidth from a WebSocket connection using Zstandard decompression.

# Purpose
The code is an asynchronous Python script that measures the bandwidth of incoming data over a WebSocket connection. It connects to a WebSocket server using the `websockets` library and supports the `compress-zstd` subprotocol for data compression. The script continuously receives data frames from the server, decompresses them using the `zstandard` library if they are in bytes, and parses them as JSON objects. It tracks the total number of bytes received for each unique combination of "topic" and "key" from the JSON data, as well as the overall total bytes received.

The script calculates and prints the bandwidth in megabits per second (Mbps) for each group and the overall bandwidth every second. It uses a dictionary to accumulate the byte counts for each group and resets these counts after each reporting interval. The script is designed to run indefinitely, providing real-time bandwidth monitoring for the specified WebSocket URI. The use of asynchronous programming allows it to handle high-throughput data streams efficiently.
# Imports and Dependencies

---
- `asyncio`
- `websockets`
- `time`
- `json`
- `collections.defaultdict`
- `zstandard`


# Functions

---
### measure\_bandwidth<!-- {{#callable:firedancer/src/disco/gui/bandwidth.measure_bandwidth}} -->
[View Source →](<../../../../../src/disco/gui/bandwidth.py#L8>)

Measures and prints the incoming bandwidth from a WebSocket connection.
- **Inputs**:
    - `uri`: A string representing the WebSocket URI to connect to.
- **Logic and Control Flow**:
    - Initialize a Zstandard decompressor and connect to the WebSocket using the specified URI with a maximum message size and a specific subprotocol.
    - Start a loop to continuously receive frames from the WebSocket connection.
    - Check if the received frame is in bytes; if so, decompress and decode it, otherwise decode it directly as a UTF-8 string.
    - Extract the 'topic' and 'key' from the decoded JSON data to form a group identifier.
    - Accumulate the size of each frame in bytes for each group and overall total bytes.
    - Calculate the elapsed time since the start of the measurement.
    - If the elapsed time is greater than or equal to one second, calculate the bandwidth in Mbps for each group and overall.
    - Sort the calculated bandwidths in descending order and print them.
    - Reset the start time and clear the accumulated byte counts for the next measurement cycle.
- **Output**: Prints the incoming bandwidth for each group and the total bandwidth in Mbps every second.



---
Made with ❤️ by [Driver](https://www.driver.ai/)