<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the FEC resolver and shredder functionalities, including performance and various edge cases.

# Purpose
The code is a C program designed to test and validate functionalities related to data shreds and forward error correction (FEC) in a distributed system, likely related to blockchain or distributed ledger technology. It includes several test functions that simulate different scenarios for processing data and parity shreds, verifying their integrity, and ensuring correct FEC set completion. The program uses various components such as `fd_shredder`, `fd_fec_resolver`, and cryptographic functions to handle and verify shreds, which are small pieces of data used in distributed systems for redundancy and error correction.

The program defines multiple test cases, such as [`test_one_batch`](<#test_one_batch>), [`test_interleaved`](<#test_interleaved>), and [`test_rolloff`](<#test_rolloff>), each focusing on different aspects of shred processing, including initialization, signing, and verification of shreds, as well as handling of FEC sets. It also includes performance testing and validation of new formats and shred versions. The code imports binary data for testing purposes and uses cryptographic functions to sign and verify data integrity. The main function initializes the testing environment, executes the test cases, and logs the results, ensuring that all tests pass before terminating.
# Imports and Dependencies

---
- `stdio.h`
- `fd_shredder.h`
- `fd_fec_resolver.h`
- `../../ballet/shred/fd_shred.h`
- `../../ballet/shred/fd_fec_set.h`
- `../../ballet/base58/fd_base58.h`
- `../../ballet/hex/fd_hex.h`
- `../../util/archive/fd_ar.h`
- `../../disco/metrics/fd_metrics.h`


# Global Variables

---
### perf\_test\_entry\_batch
- **Type**: `uchar array`
- **Description**: An array of unsigned characters with a size defined by the macro `PERF_TEST_SZ`, which is set to 10 megabytes. This array is used to store data for performance testing purposes.
- **Use**: Used in the `perf_test` function to initialize and store test data for performance evaluation.


---
### fec\_set\_memory
- **Type**: `uchar`
- **Description**: A global array of unsigned characters with a size determined by the product of 16, 2048, and the sum of `FD_REEDSOL_DATA_SHREDS_MAX` and `FD_REEDSOL_PARITY_SHREDS_MAX`. This array is used to store memory for FEC (Forward Error Correction) sets.
- **Use**: Used to allocate memory for FEC sets in the `allocate_fec_set` function.


---
### res\_mem
- **Type**: `uchar array`
- **Description**: `res_mem` is a global array of unsigned characters with a size of 1 megabyte (1024 * 1024 bytes). It is aligned according to the `FD_FEC_RESOLVER_ALIGN` attribute.
- **Use**: Used as a memory buffer for the Forward Error Correction (FEC) resolver operations.


---
### metrics\_scratch
- **Type**: `uchar[]`
- **Description**: An array of unsigned characters used as a scratch space for metrics operations. The size of the array is determined by the `FD_METRICS_FOOTPRINT` macro with parameters `(0, 0)`, and it is aligned according to `FD_METRICS_ALIGN`.
- **Use**: Used to store temporary data for metrics operations in the application.


---
### \_shredder
- **Type**: `fd_shredder_t`
- **Description**: Represents an array of `fd_shredder_t` structures with a single element. This structure is used to manage the shredding process in the application.
- **Use**: Used to initialize and manage the shredding process, including joining, setting shred version, and processing batches.


---
### fec\_set\_memory\_1
- **Type**: `uchar array`
- **Description**: An array of unsigned characters with a size determined by multiplying 2048 by the constant `FD_REEDSOL_DATA_SHREDS_MAX`. This array is used to store data shreds for Forward Error Correction (FEC) operations.
- **Use**: Used to allocate memory for data shreds in FEC operations.


---
### fec\_set\_memory\_2
- **Type**: `uchar`
- **Description**: An array of unsigned characters with a size determined by the product of 2048 and the constant `FD_REEDSOL_PARITY_SHREDS_MAX`. This array is used to store memory related to Forward Error Correction (FEC) parity shreds.
- **Use**: Stores memory for FEC parity shreds in the context of data redundancy and error correction.


# Data Structures

---
### signer\_ctx
- **Type**: ``struct``
- **Members**:
    - ``sha512``: An array of `fd_sha512_t` used for SHA-512 hashing.
    - ``public_key``: A pointer to an unsigned character array representing the public key.
    - ``private_key``: A pointer to an unsigned character array representing the private key.
- **Description**: The `signer_ctx` structure holds cryptographic context for signing operations, including SHA-512 hashing and key management. It contains an array for SHA-512 hashing, and pointers to the public and private keys, which are used in cryptographic signing processes.


---
### signer\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``sha512``: An array of `fd_sha512_t` used for SHA-512 hashing operations.
    - ``public_key``: A pointer to an unsigned character array representing the public key.
    - ``private_key``: A pointer to an unsigned character array representing the private key.
- **Description**: The `signer_ctx_t` structure is used to manage cryptographic signing contexts, specifically for operations involving SHA-512 hashing and Ed25519 signing. It holds a SHA-512 hashing context and pointers to the public and private keys necessary for signing operations. This structure is initialized with a private key, from which the public key is derived, and is used in functions that perform signing tasks.


# Functions

---
### signer\_ctx\_init<!-- {{#callable:signer_ctx_init}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L46>)

Initializes a `signer_ctx_t` structure with a SHA-512 context and assigns the private and public keys from a given private key.
- **Inputs**:
    - `ctx`: A pointer to a `signer_ctx_t` structure that will be initialized.
    - `private_key`: A pointer to a 64-byte array where the first 32 bytes are the private key and the next 32 bytes are the public key.
- **Logic and Control Flow**:
    - Calls `fd_sha512_new` with `ctx->sha512` to create a new SHA-512 context.
    - Initializes the SHA-512 context by calling `fd_sha512_init`.
    - Assigns the public key by setting `ctx->public_key` to point to the second half of the `private_key` array.
    - Assigns the private key by setting `ctx->private_key` to point to the first half of the `private_key` array.
- **Output**: No return value; the function initializes the `ctx` structure in place.


---
### test\_signer<!-- {{#callable:test_signer}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L54>)

Generates a digital signature for a given Merkle root using the Ed25519 algorithm and a provided context.
- **Inputs**:
    - `_ctx`: A pointer to a `signer_ctx_t` structure that contains the public and private keys and a SHA-512 context.
    - `signature`: A pointer to an array where the generated signature will be stored.
    - `merkle_root`: A pointer to a constant array representing the Merkle root to be signed.
- **Logic and Control Flow**:
    - Cast the `_ctx` pointer to a `signer_ctx_t` pointer to access the signing context.
    - Call the `fd_ed25519_sign` function with the `signature`, `merkle_root`, a fixed size of 32 bytes, and the public and private keys from the context, along with the SHA-512 context.
- **Output**: The function does not return a value; it outputs the generated signature in the `signature` array.


---
### sets\_eq<!-- {{#callable:sets_eq}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L63>)

Compares two `fd_fec_set_t` structures to determine if they are equal.
- **Inputs**:
    - `a`: A pointer to the first `fd_fec_set_t` structure to compare.
    - `b`: A pointer to the second `fd_fec_set_t` structure to compare.
- **Logic and Control Flow**:
    - Check if one of the inputs is `NULL` and the other is not; if so, return 0 (not equal).
    - Compare `data_shred_cnt` of both structures; if they differ, return 0.
    - Compare `parity_shred_cnt` of both structures; if they differ, return 0.
    - Iterate over each data shred in `a` and `b` and compare them using `fd_memeq`; if any differ, log the difference and return 0.
    - Iterate over each parity shred in `a` and `b` and compare them using `fd_memeq`; if any differ, log the difference and return 0.
    - If all checks pass, return 1 (equal).
- **Output**: Returns 1 if the two `fd_fec_set_t` structures are equal, otherwise returns 0.


---
### allocate\_fec\_set<!-- {{#callable:allocate_fec_set}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L86>)

Allocates memory for data and parity shreds in a forward error correction (FEC) set and returns the updated pointer.
- **Inputs**:
    - `set`: A pointer to an `fd_fec_set_t` structure where the function will store pointers to allocated data and parity shreds.
    - `ptr`: A pointer to a memory location where the function will start allocating memory for the shreds.
- **Logic and Control Flow**:
    - Iterate over `FD_REEDSOL_DATA_SHREDS_MAX` to allocate memory for data shreds, incrementing `ptr` by 2048 bytes for each allocation.
    - Iterate over `FD_REEDSOL_PARITY_SHREDS_MAX` to allocate memory for parity shreds, incrementing `ptr` by 2048 bytes for each allocation.
    - Check if the updated `ptr` is within the bounds of `fec_set_memory` to ensure memory safety.
    - Return the updated `ptr` after all allocations.
- **Output**: Returns the updated pointer after allocating memory for the FEC set.


---
### test\_one\_batch<!-- {{#callable:test_one_batch}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L113>)

Tests the functionality of processing a batch of data shreds and parity shreds using a shredder and FEC resolvers.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure and set it up with a private key.
    - Create a new shredder instance and join it, setting the shred version.
    - Initialize metadata for the entry batch and set the block as complete.
    - Initialize a batch in the shredder with test data and metadata.
    - Allocate memory for FEC sets and initialize them.
    - Create and join three FEC resolvers with different memory offsets and set their shred versions.
    - Iterate over a loop to process FEC sets, adding data and parity shreds to the resolvers and checking for completion.
    - Finalize the batch in the shredder.
    - Delete the FEC resolvers after processing.
- **Output**: No output is returned; the function performs tests and assertions internally.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_fec_resolver_footprint`](<fd_fec_resolver.c.md#fd_fec_resolver_footprint>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`sets_eq`](<#sets_eq>)
    - [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### test\_interleaved<!-- {{#callable:test_interleaved}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L179>)

Tests the interleaved processing of FEC sets using a shredder and resolver.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure and set up a shredder with a private key.
    - Create a shredder and set its version using [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>).
    - Initialize a batch with [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>) using test data and metadata.
    - Allocate memory for two FEC sets and four output FEC sets using [`allocate_fec_set`](<#allocate_fec_set>).
    - Retrieve two FEC sets from the shredder using [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>).
    - Finalize the batch with [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>).
    - Join a new FEC resolver and set its shred version.
    - Add data shreds from both FEC sets to the resolver using `ADD_SHRED`.
    - Add parity shreds to complete the FEC sets and verify with `FD_TEST`.
    - Delete the resolver after processing.
- **Output**: No output is returned; the function performs tests and uses assertions to verify correctness.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`sets_eq`](<#sets_eq>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### test\_rolloff<!-- {{#callable:test_rolloff}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L225>)

Tests the roll-off behavior of FEC sets in a shredder and resolver system.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure and a shredder with a private key.
    - Create and join a shredder, setting its version to `SHRED_VER`.
    - Initialize a batch with [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>) using a test binary and metadata.
    - Allocate memory for three FEC sets and four output FEC sets.
    - Retrieve three FEC sets using [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>) and finalize the batch.
    - Create and join a resolver with specific parameters and set its shred version.
    - Add data shreds from `set0` and `set1` to the resolver, marking them as 'OKAY'.
    - Add data shreds from `set2`, with the first one using `ADD_SHRED_SPILLS` to handle spills.
    - Add a parity shred from `set0` using `ADD_SHRED_SPILLS` and a parity shred from `set2`, marking it as 'COMPLETES'.
    - Verify that `set2` is complete and only `set0` is in progress.
    - Add data shreds from `set1` and a parity shred, marking it as 'COMPLETES'.
    - Verify that `set1` is complete and `set2` parity shred is ignored.
    - Delete the resolver after use.
- **Output**: No output is returned; the function performs tests and assertions.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`sets_eq`](<#sets_eq>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### perf\_test<!-- {{#callable:perf_test}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L288>)

Performs a performance test by initializing, processing, and finalizing batches of entry data using a shredder and FEC sets, and logs the time taken for processing.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `perf_test_entry_batch` with sequential values from 0 to `PERF_TEST_SZ`.
    - Create and initialize `fd_entry_batch_meta_t` and `signer_ctx_t` structures.
    - Initialize a shredder using [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>) and join it with [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>).
    - Set the shred version of the shredder using [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>).
    - Allocate memory for data and parity shreds in `fd_fec_set_t` structure.
    - Start a timer using `fd_log_wallclock` to measure performance.
    - Iterate 100 times, each time initializing a batch with [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>), counting FEC sets with [`fd_shredder_count_fec_sets`](<fd_shredder.h.md#fd_shredder_count_fec_sets>), processing each FEC set with [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>), and finalizing the batch with [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>).
    - Stop the timer and calculate the time taken for processing.
    - Log the performance results in terms of nanoseconds per 10 MB entry batch and Gbps.
- **Output**: Logs the performance results in terms of time taken per 10 MB entry batch and the corresponding data rate in Gbps.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`fd_shredder_count_fec_sets`](<fd_shredder.h.md#fd_shredder_count_fec_sets>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>)


---
### test\_new\_formats<!-- {{#callable:test_new_formats}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L324>)

Tests the functionality of processing new formats of shreds using a forward error correction (FEC) resolver.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure with a private key.
    - Allocate memory for four FEC sets using [`allocate_fec_set`](<#allocate_fec_set>).
    - Create and join a new FEC resolver with specific parameters and set its shred version.
    - Decode a base58 public key and store it in `pubkey`.
    - Open a file containing chained test data and initialize it for reading.
    - Iterate over the file, reading shreds, parsing them, and adding them to the resolver.
    - Check the return value of [`fd_fec_resolver_add_shred`](<fd_fec_resolver.c.md#fd_fec_resolver_add_shred>) to determine if a shred completes a set, is ignored, or is okay, updating `fec_sets` and `fec_done` accordingly.
    - Verify that the number of completed FEC sets is four and close the file.
    - Repeat the process for a file containing resigned test data, verifying that one FEC set is completed.
    - Delete the FEC resolver after processing.
- **Output**: No output is returned; the function performs tests and assertions internally.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_fec_resolver_add_shred`](<fd_fec_resolver.c.md#fd_fec_resolver_add_shred>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### test\_shred\_version<!-- {{#callable:test_shred_version}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L416>)

Tests the behavior of the shredder and FEC resolver when the shred version is set to an unexpected value.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure with the test private key.
    - Create a new shredder instance and join it, then set its shred version to the bitwise NOT of `SHRED_VER`.
    - Initialize a batch for the shredder with test data and metadata indicating the block is complete.
    - Allocate memory for FEC sets and initialize them.
    - Create a new FEC resolver and set its shred version to `SHRED_VER`.
    - Retrieve the next FEC set from the shredder and parse the first data shred.
    - Attempt to add the parsed shred to the FEC resolver and verify it is rejected due to the version mismatch.
    - Clean up by deleting the FEC resolver.
- **Output**: No output is returned; the function performs tests and uses assertions to validate behavior.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_fec_resolver_add_shred`](<fd_fec_resolver.c.md#fd_fec_resolver_add_shred>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### fake\_resign<!-- {{#callable:fake_resign}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L455>)

Computes a Merkle root for a given shred and updates its signature using a signing context.
- **Inputs**:
    - ``shred``: A pointer to an `fd_shred_t` structure representing the shred to be processed.
    - ``sign_ctx``: A pointer to a `signer_ctx_t` structure used for signing the shred.
- **Logic and Control Flow**:
    - Retrieve the `variant` and `shred_type` from the `shred` structure.
    - Determine if the shred is a data shred using `fd_shred_is_data`.
    - Calculate `in_type_idx` and `shred_idx` based on whether the shred is a data shred.
    - Compute `tree_depth` and `reedsol_protected_sz` using the variant and shred type.
    - Calculate `data_merkle_protected_sz` and `parity_merkle_protected_sz` based on the shred type and protection sizes.
    - Select `merkle_protected_sz` based on whether the shred is a data shred.
    - Initialize memory for a binary Merkle tree and compute the hash of the leaf node from the shred data.
    - Retrieve the Merkle proof nodes from the shred and initialize a Merkle tree commit structure.
    - Insert the leaf node into the Merkle tree with proof and compute the root hash.
    - Verify the result of the Merkle tree insertion with `FD_TEST`.
    - Sign the shred using [`test_signer`](<#test_signer>) with the computed Merkle root hash.
- **Output**: The function does not return a value; it modifies the `shred` structure in place by updating its signature.
- **Functions Called**:
    - [`test_signer`](<#test_signer>)


---
### test\_shred\_reject<!-- {{#callable:test_shred_reject}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L486>)

Tests the rejection and acceptance of shreds based on their validity and signature correctness.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure and a shredder context with a private key.
    - Create a new shredder and join it, setting the shred version.
    - Initialize a batch of shreds with metadata indicating a complete block and a parent offset.
    - Allocate memory for FEC sets and output sets.
    - Join a new FEC resolver and set its shred version.
    - Iterate over data shreds, parsing each shred and testing its acceptance or rejection based on its validity and signature.
    - Use macros `SIGN_ACCEPT` and `SIGN_REJECT` to test shreds after modifying their data or indices.
    - Test parity shreds similarly, checking their indices and code counts for acceptance or rejection.
    - Ensure malformed shreds are rejected by the parser or the resolver.
- **Output**: No direct output; the function uses assertions to validate shred acceptance or rejection.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_fec_resolver_add_shred`](<fd_fec_resolver.c.md#fd_fec_resolver_add_shred>)


---
### test\_merkle\_root<!-- {{#callable:test_merkle_root}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L596>)

Tests the correct writing of Merkle roots in shreds under various conditions.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `signer_ctx` with `test_private_key` and create a new `fd_shredder` instance.
    - Join the shredder and set its version using [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>).
    - Initialize `fd_entry_batch_meta_t` and set `parent_offset` and `block_complete`.
    - Initialize a batch in the shredder with [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>).
    - Allocate memory for FEC sets and join a new `fd_fec_resolver`.
    - Set the shred version for the resolver using [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>).
    - Parse the first data shred and add it to the resolver, checking if the Merkle root is written correctly on success.
    - Modify the data payload of the second data shred and check that the Merkle root is not written on rejection.
    - Repeat the process for ignored shreds and shreds with NULL Merkle root.
- **Output**: No output is returned; the function uses assertions to validate conditions.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_fec_resolver_add_shred`](<fd_fec_resolver.c.md#fd_fec_resolver_add_shred>)


---
### test\_force\_complete<!-- {{#callable:test_force_complete}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L666>)

Tests the force completion of a Forward Error Correction (FEC) set in a shredder-resolver system.
- **Inputs**:
    - `void`: No input parameters.
- **Logic and Control Flow**:
    - Initialize a `signer_ctx_t` structure with a private key.
    - Create a new shredder and join it, setting the shred version.
    - Initialize a batch in the shredder with test data and metadata indicating block completion.
    - Allocate memory for FEC sets and initialize them.
    - Retrieve the next FEC set from the shredder and finalize the batch.
    - Join a new FEC resolver and set its shred version.
    - Add shreds to the resolver, skipping the third shred, and test force completion with a non-last shred, expecting rejection due to missing shreds.
    - Test force completion with the last shred, expecting rejection due to missing shreds.
    - Add the missing shred and modify the last shred's signature, then test force completion again, expecting rejection due to signature error.
    - Restore the last shred's signature and test force completion, expecting success.
    - Delete the resolver.
- **Output**: No return value; the function performs tests and uses assertions to validate behavior.
- **Functions Called**:
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_fec_resolver_force_complete`](<fd_fec_resolver.c.md#fd_fec_resolver_force_complete>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### test\_chained\_merkle\_shreds<!-- {{#callable:test_chained_merkle_shreds}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L737>)

Tests the creation and validation of chained Merkle shreds, ensuring correct Merkle root updates and shred indexing.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `expected_final_chained_merkle_root` and `chained_merkle_root` with predefined values using `fd_hex_decode`.
    - Set `data_sz` to 30000 and verify the number of data and parity shreds using [`fd_shredder_count_data_shreds`](<fd_shredder.h.md#fd_shredder_count_data_shreds>), [`fd_shredder_count_parity_shreds`](<fd_shredder.h.md#fd_shredder_count_parity_shreds>), and [`fd_shredder_count_fec_sets`](<fd_shredder.h.md#fd_shredder_count_fec_sets>).
    - Initialize `perf_test_entry_batch` with sequential values and set up `meta` and `signer_ctx`.
    - Create a new shredder and join it, setting the shred version.
    - Allocate memory for data and parity shreds in `_set` and initialize them with a canary value.
    - Iterate over slots and sets, skipping slot 11, and adjust `meta->parent_offset` accordingly.
    - For each set, initialize a batch, generate the next FEC set, and finalize the batch.
    - Perform per-slot checks to ensure the correct number of data and parity shreds and validate shred indexes.
    - Join a new FEC resolver, set the shred version, and add shreds to the resolver, checking for overflow and index correctness.
    - Verify that the `chained_merkle_root` matches the `out_merkle_root` after each shred addition.
    - Ensure at least one coding shred is added to complete a set and verify the equality of sets using [`sets_eq`](<#sets_eq>).
    - Delete the resolver after processing each set.
    - Perform a final check to ensure the `chained_merkle_root` matches the `expected_final_chained_merkle_root`.
- **Output**: No output is returned; the function performs internal tests and validations.
- **Functions Called**:
    - [`fd_shredder_count_data_shreds`](<fd_shredder.h.md#fd_shredder_count_data_shreds>)
    - [`fd_shredder_count_parity_shreds`](<fd_shredder.h.md#fd_shredder_count_parity_shreds>)
    - [`fd_shredder_count_fec_sets`](<fd_shredder.h.md#fd_shredder_count_fec_sets>)
    - [`signer_ctx_init`](<#signer_ctx_init>)
    - [`fd_shredder_new`](<fd_shredder.c.md#fd_shredder_new>)
    - [`fd_shredder_join`](<fd_shredder.c.md#fd_shredder_join>)
    - [`fd_shredder_set_shred_version`](<fd_shredder.h.md#fd_shredder_set_shred_version>)
    - [`allocate_fec_set`](<#allocate_fec_set>)
    - [`fd_shredder_init_batch`](<fd_shredder.c.md#fd_shredder_init_batch>)
    - [`fd_shredder_next_fec_set`](<fd_shredder.c.md#fd_shredder_next_fec_set>)
    - [`fd_shredder_fini_batch`](<fd_shredder.c.md#fd_shredder_fini_batch>)
    - [`fd_fec_resolver_join`](<fd_fec_resolver.c.md#fd_fec_resolver_join>)
    - [`fd_fec_resolver_new`](<fd_fec_resolver.c.md#fd_fec_resolver_new>)
    - [`fd_fec_resolver_set_shred_version`](<fd_fec_resolver.c.md#fd_fec_resolver_set_shred_version>)
    - [`fd_fec_resolver_add_shred`](<fd_fec_resolver.c.md#fd_fec_resolver_add_shred>)
    - [`sets_eq`](<#sets_eq>)
    - [`fd_fec_resolver_delete`](<fd_fec_resolver.c.md#fd_fec_resolver_delete>)
    - [`fd_fec_resolver_leave`](<fd_fec_resolver.c.md#fd_fec_resolver_leave>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/disco/shred/test_fec_resolver.c#L881>)

Initializes the environment, registers metrics, and executes a series of test functions before logging success and halting.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Call `fd_boot` to initialize the environment with command-line arguments.
    - Register metrics using `fd_metrics_register` with a new metrics object.
    - Declare `perf_test` as unused with `(void)perf_test`.
    - Execute a series of test functions: [`test_interleaved`](<#test_interleaved>), [`test_one_batch`](<#test_one_batch>), [`test_rolloff`](<#test_rolloff>), [`test_new_formats`](<#test_new_formats>), [`test_shred_version`](<#test_shred_version>), [`test_shred_reject`](<#test_shred_reject>), [`test_merkle_root`](<#test_merkle_root>), [`test_force_complete`](<#test_force_complete>), and [`test_chained_merkle_shreds`](<#test_chained_merkle_shreds>).
    - Log a notice message "pass" using `FD_LOG_NOTICE`.
    - Call `fd_halt` to halt the program.
    - Return 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_interleaved`](<#test_interleaved>)
    - [`test_one_batch`](<#test_one_batch>)
    - [`test_rolloff`](<#test_rolloff>)
    - [`test_new_formats`](<#test_new_formats>)
    - [`test_shred_version`](<#test_shred_version>)
    - [`test_shred_reject`](<#test_shred_reject>)
    - [`test_merkle_root`](<#test_merkle_root>)
    - [`test_force_complete`](<#test_force_complete>)
    - [`test_chained_merkle_shreds`](<#test_chained_merkle_shreds>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)