<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a Forward Error Correction (FEC) resolver for managing and processing shreds, including functions for adding, querying, and completing FEC sets.

# Purpose
The code defines a module for managing Forward Error Correction (FEC) sets, specifically for handling shreds, which are data packets used in distributed systems. The primary structure in this module is `fd_fec_resolver_t`, which is responsible for tracking and managing FEC sets. It uses various data structures such as maps and deques to efficiently manage the lifecycle of FEC sets, including their creation, tracking, and completion. The module provides functions to initialize, join, and manage FEC sets, ensuring that shreds are processed correctly and efficiently.

The module includes several key components: `set_ctx_t` structures to maintain context for each FEC set, `fd_fec_resolver_t` to encapsulate the resolver's state, and functions like [`fd_fec_resolver_add_shred`](<#fd_fec_resolver_add_shred>) to add shreds to FEC sets. The code also handles the validation of shreds using Merkle trees and Reed-Solomon error correction, ensuring data integrity and consistency. The module is designed to be integrated into a larger system, providing a public API for managing FEC sets and ensuring that data packets are processed and reconstructed correctly.
# Imports and Dependencies

---
- `../../ballet/shred/fd_shred.h`
- `../../ballet/shred/fd_fec_set.h`
- `../../ballet/sha512/fd_sha512.h`
- `../../ballet/reedsol/fd_reedsol.h`
- `../metrics/fd_metrics.h`
- `fd_fec_resolver.h`
- `../../util/tmpl/fd_deque_dynamic.c`
- `../../util/tmpl/fd_map_dynamic.c`


# Global Variables

---
### null\_signature
- **Type**: `wrapped_sig_t`
- **Description**: A constant variable of type `wrapped_sig_t` initialized with a zeroed signature. It is defined as a static constant, meaning it is limited to the file scope and cannot be modified.
- **Use**: Used as a null or invalid signature value in the context of signature comparisons or checks.


# Data Structures

---
### wrapped\_sig\_t
- **Type**: `union`
- **Members**:
    - `u`: A member of type `fd_ed25519_sig_t`.
    - `l`: A member of type `ulong`.
- **Description**: A union that can store either an `fd_ed25519_sig_t` or a `ulong`. It is used to represent a signature in a flexible way, allowing access to the signature as either a structured type or a raw integer value.


---
### set\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``sig``: A union type `wrapped_sig_t` that contains a signature or a long integer.
    - ``set``: A pointer to an `fd_fec_set_t` structure.
    - ``tree``: A pointer to an `fd_bmtree_commit_t` structure.
    - ``root``: An `fd_bmtree_node_t` structure representing the root of a Merkle tree.
    - ``prev``: A pointer to the previous `set_ctx_t` in a linked list.
    - ``next``: A pointer to the next `set_ctx_t` in a linked list.
    - ``total_rx_shred_cnt``: A count of the total received shreds.
    - ``fec_set_idx``: An index for the FEC set.
    - ``parity_idx0``: The shred index of the first parity shred in this FEC set.
    - ``data_variant``: A variant type for data shreds.
    - ``parity_variant``: A variant type for parity shreds.
    - ``retransmitter_sig``: A `wrapped_sig_t` containing the signature of the root of the Merkle tree if the FEC set has resigned shreds.
- **Description**: Represents a context for managing Forward Error Correction (FEC) sets, including pointers to FEC set data, Merkle tree structures, and linked list navigation for managing multiple contexts. It also tracks metadata such as the total number of received shreds and indices for FEC and parity shreds, and it includes signature handling for retransmission scenarios.


---
### set\_ctx
- **Type**: ``struct``
- **Members**:
    - `sig`: Holds a wrapped signature of type `wrapped_sig_t`.
    - `set`: Points to an `fd_fec_set_t` structure.
    - `tree`: Points to an `fd_bmtree_commit_t` structure.
    - `root`: Stores the root node of the Merkle tree as an `fd_bmtree_node_t`.
    - `prev`: Points to the previous `set_ctx_t` in a linked list.
    - `next`: Points to the next `set_ctx_t` in a linked list.
    - `total_rx_shred_cnt`: Counts the total number of received shreds as an `ulong`.
    - `fec_set_idx`: Stores the index of the FEC set as an `ulong`.
    - `parity_idx0`: Stores the shred index of the first parity shred in the FEC set as an `ulong`.
    - `data_variant`: Stores the data variant as an `uchar`.
    - `parity_variant`: Stores the parity variant as an `uchar`.
    - `retransmitter_sig`: Holds the retransmitter's signature of the Merkle tree root as a `wrapped_sig_t`.
- **Description**: The `set_ctx` structure is aligned to 32 bytes and is used to manage the context of a Forward Error Correction (FEC) set. It includes pointers to the FEC set and Merkle tree structures, as well as linked list pointers for managing a list of contexts. It also tracks the total number of received shreds, the index of the FEC set, and the index of the first parity shred. Additionally, it stores data and parity variants and a retransmitter signature for the Merkle tree root.


---
### fd\_fec\_resolver
- **Type**: ``struct``
- **Members**:
    - ``depth``: Stores the number of FEC sets that can be tracked simultaneously.
    - ``partial_depth``: Stores the minimum size of the free FEC set list.
    - ``complete_depth``: Stores the size of the completed FEC set list.
    - ``done_depth``: Stores the depth of the done tcache, i.e., the number of done FEC set keys remembered.
    - ``expected_shred_version``: Specifies the shred version to accept, discarding others.
    - ``curr_map``: A map from tags of signatures to context objects, sized at 2*depth for performance.
    - ``curr_ll_sentinel``: A sentinel node for a circular doubly linked list of `curr_map` elements.
    - ``done_map``: Stores signatures of recently completed FEC sets, using a linked list.
    - ``done_ll_sentinel``: A sentinel node for a circular doubly linked list of `done_map` elements.
    - ``free_list``: A deque of FEC sets not in `curr_map` contexts.
    - ``complete_list``: A deque of completed FEC sets.
    - ``bmtree_free_list``: Stores footprints for bmtree objects not in `curr_map` contexts.
    - ``signer``: Used to sign shreds requiring a retransmitter signature.
    - ``sign_ctx``: Context provided as the first argument to the signer function.
    - ``max_shred_idx``: Exclusive upper bound for shred indices, rejecting shreds with index >= this value.
    - ``sha512``: Used for calculations while adding a shred, with indeterminate state outside calls.
    - ``reedsol``: Used for calculations while adding a shred, with indeterminate state outside calls.
- **Description**: The `fd_fec_resolver` struct is designed to manage Forward Error Correction (FEC) sets, tracking their states and handling shreds (data packets) within a network. It maintains various lists and maps to manage the lifecycle of FEC sets, including those in progress, completed, and free for use. The struct also handles signature verification and Merkle tree operations to ensure data integrity and authenticity. It is aligned to `FD_FEC_RESOLVER_ALIGN` for performance optimization.


---
### fd\_fec\_resolver\_t
- **Type**: ``struct``
- **Members**:
    - `depth`: Stores the number of FEC sets this resolver can track simultaneously.
    - `partial_depth`: Stores the minimum size of the free FEC set list.
    - `complete_depth`: Stores the size of the completed FEC set list.
    - `done_depth`: Stores the depth of the done tcache, i.e., the number of done FEC set keys remembered.
    - `expected_shred_version`: Specifies the shred version to accept, discarding others.
    - `curr_map`: A map from tags of signatures to the context object with its relevant data.
    - `curr_ll_sentinel`: A sentinel node for the circular doubly linked list of `curr_map` elements.
    - `done_map`: Stores signatures of recently completed FEC sets.
    - `done_ll_sentinel`: A sentinel node for the circular doubly linked list of `done_map` elements.
    - `free_list`: A deque of FEC sets not in contexts in `curr_map`.
    - `complete_list`: A deque of completed FEC sets.
    - `bmtree_free_list`: A deque of footprints for bmtree objects not in contexts in `curr_map`.
    - `signer`: Function pointer used to sign shreds requiring a retransmitter signature.
    - `sign_ctx`: Context provided as the first argument to the `signer` function.
    - `max_shred_idx`: Exclusive upper bound for shred indices, rejecting shreds with an index >= this value.
    - `sha512`: Used for calculations while adding a shred, with indeterminate state outside a call.
    - `reedsol`: Used for calculations while adding a shred, with indeterminate state outside a call.
- **Description**: Aligns and manages FEC (Forward Error Correction) sets, tracking their states and handling shreds (data packets) with specific constraints on depth, version, and indices. It uses maps and linked lists to manage current and completed FEC sets, and deques to manage free and complete lists of FEC sets and bmtree objects. The structure also includes mechanisms for signing shreds and verifying their integrity using SHA-512 and Reed-Solomon coding.


# Functions

---
### fd\_fec\_resolver\_footprint<!-- {{#callable:fd_fec_resolver_footprint}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L157>)

Calculates the memory footprint required for an FEC resolver based on given depth parameters.
- **Inputs**:
    - `depth`: The number of FEC sets the resolver can track simultaneously.
    - `partial_depth`: The minimum size of the free FEC set list.
    - `complete_depth`: The size of the completed FEC set list.
    - `done_depth`: The number of done FEC set keys the resolver remembers.
- **Logic and Control Flow**:
    - Check if any input depth is zero or exceeds a threshold to prevent overflow, returning 0 if true.
    - Calculate `lg_curr_map_cnt` and `lg_done_map_cnt` using the most significant bit of `depth` and `done_depth`, respectively, plus 2.
    - Determine `footprint_per_bmtree` using `fd_bmtree_commit_footprint` with a constant layer count.
    - Initialize `layout` with `FD_LAYOUT_INIT`.
    - Append various components to `layout` using `FD_LAYOUT_APPEND`, including the resolver structure, context maps, freelists, and bmtree lists, each with specific alignments and footprints.
    - Return the finalized layout size using `FD_LAYOUT_FINI`.
- **Output**: Returns the calculated memory footprint as an unsigned long integer.


---
### fd\_fec\_resolver\_align<!-- {{#callable:fd_fec_resolver_align}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L182>)

Returns the alignment requirement for the FEC resolver.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the constant `FD_FEC_RESOLVER_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment requirement for the FEC resolver.


---
### fd\_fec\_resolver\_new<!-- {{#callable:fd_fec_resolver_new}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L185>)

Initializes a new Forward Error Correction (FEC) resolver in shared memory with specified parameters and resources.
- **Inputs**:
    - ``shmem``: Pointer to shared memory where the FEC resolver will be initialized.
    - ``signer``: Function pointer for signing shreds that require a retransmitter signature.
    - ``sign_ctx``: Context for the signer function.
    - ``depth``: Number of FEC sets the resolver can track simultaneously.
    - ``partial_depth``: Minimum size of the free FEC set list.
    - ``complete_depth``: Size of the completed FEC set list.
    - ``done_depth``: Depth of the done cache, i.e., number of completed FEC set keys remembered.
    - ``sets``: Pointer to an array of FEC sets.
    - ``max_shred_idx``: Exclusive upper bound for shred indices.
- **Logic and Control Flow**:
    - Check if any of the depth parameters are zero or exceed a maximum value, returning `NULL` if so.
    - Calculate the logarithmic count of current and done maps based on `depth` and `done_depth`.
    - Initialize memory layout for the resolver and allocate necessary resources using `FD_SCRATCH_ALLOC_APPEND`.
    - Create a new `fd_fec_resolver_t` object and initialize its fields with the provided parameters.
    - Initialize context maps, freelists, and bmtree lists, logging warnings and returning `NULL` if any initialization fails.
    - Join freelists and bmtree lists, populating them with initial values from `sets` and `bmfootprint`.
    - Set up circular doubly linked list sentinels for current and done maps.
    - Assign input parameters to the resolver's fields and return the `shmem` pointer.
- **Output**: Returns a pointer to the initialized shared memory if successful, or `NULL` if any initialization step fails.


---
### fd\_fec\_resolver\_join<!-- {{#callable:fd_fec_resolver_join}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L250>)

Initializes and joins various data structures for a Forward Error Correction (FEC) resolver using shared memory.
- **Inputs**:
    - `shmem`: A pointer to shared memory where the FEC resolver and its associated data structures will be initialized and joined.
- **Logic and Control Flow**:
    - Cast `shmem` to a `fd_fec_resolver_t` pointer to access the resolver structure.
    - Retrieve `depth`, `partial_depth`, `complete_depth`, and `done_depth` from the resolver structure.
    - Calculate `lg_curr_map_cnt` and `lg_done_map_cnt` using `fd_ulong_find_msb` to determine the size of the current and done maps.
    - Initialize scratch memory allocation with `FD_SCRATCH_ALLOC_INIT` using `shmem`.
    - Append memory allocations for the resolver, current map, done map, free list, complete list, and bmtree free list using `FD_SCRATCH_ALLOC_APPEND`.
    - Finalize scratch memory allocation with `FD_SCRATCH_ALLOC_FINI`.
    - Join the current map, done map, free list, complete list, and bmtree free list using their respective join functions.
    - Check if any join operation fails using `FD_UNLIKELY`, and return `NULL` if any failure occurs.
    - Join the SHA-512 context using `fd_sha512_join` and return `NULL` if it fails.
    - Return the initialized `resolver` pointer.
- **Output**: A pointer to the initialized `fd_fec_resolver_t` structure, or `NULL` if any initialization step fails.


---
### fd\_fec\_resolver\_set\_shred\_version<!-- {{#callable:fd_fec_resolver_set_shred_version}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L280>)

Sets the `expected_shred_version` field of a `fd_fec_resolver_t` structure to a specified value.
- **Inputs**:
    - `resolver`: A pointer to a `fd_fec_resolver_t` structure whose `expected_shred_version` field will be set.
    - `expected_shred_version`: A `ushort` value representing the shred version to set in the resolver.
- **Logic and Control Flow**:
    - Assigns the value of `expected_shred_version` to the `expected_shred_version` field of the `resolver` structure.
- **Output**: No return value (void function).


---
### ctx\_ll\_remove<!-- {{#callable:ctx_ll_remove}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L293>)

Removes a node from a doubly linked list and returns it.
- **Inputs**:
    - ``r``: A pointer to the `set_ctx_t` node to remove from the linked list.
- **Logic and Control Flow**:
    - Set the `prev` pointer of the node after `r` to the node before `r`.
    - Set the `next` pointer of the node before `r` to the node after `r`.
    - Set the `next` and `prev` pointers of `r` to `NULL`.
    - Return the node `r`.
- **Output**: Returns the pointer to the removed node `r`.


---
### ctx\_ll\_insert<!-- {{#callable:ctx_ll_insert}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L303>)

Inserts a node `c` immediately after node `p` in a doubly linked list and returns `c`.
- **Inputs**:
    - `p`: A pointer to a `set_ctx_t` node after which the new node `c` will be inserted.
    - `c`: A pointer to a `set_ctx_t` node that will be inserted after node `p`.
- **Logic and Control Flow**:
    - Set `c->next` to `p->next`, linking `c` to the node following `p`.
    - Set `c->prev` to `p`, linking `c` back to `p`.
    - Set `p->next->prev` to `c`, updating the previous link of the node originally following `p` to point to `c`.
    - Set `p->next` to `c`, completing the insertion of `c` after `p`.
- **Output**: Returns the pointer `c`, which is the node that was inserted.


---
### fd\_fec\_resolver\_add\_shred<!-- {{#callable:fd_fec_resolver_add_shred}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L312>)

Processes a shred by verifying its validity, updating the FEC set, and handling reconstruction if necessary.
- **Inputs**:
    - ``resolver``: A pointer to the `fd_fec_resolver_t` structure that manages the FEC sets.
    - ``shred``: A constant pointer to the `fd_shred_t` structure representing the shred to be added.
    - ``shred_sz``: The size of the shred in bytes.
    - ``leader_pubkey``: A constant pointer to the leader's public key used for signature verification.
    - ``out_fec_set``: A pointer to a constant pointer to `fd_fec_set_t` where the function will store the FEC set if the shred completes it.
    - ``out_shred``: A pointer to a constant pointer to `fd_shred_t` where the function will store the processed shred.
    - ``out_merkle_root``: A pointer to `fd_bmtree_node_t` where the function will store the Merkle root if applicable.
    - ``out_spilled``: A pointer to `fd_fec_resolver_spilled_t` where the function will store information about any spilled FEC set.
- **Logic and Control Flow**:
    - Unpacks variables from the `resolver` structure for use in processing.
    - Checks if the shred's signature is invalid and rejects it if so.
    - Queries the `done_map` to see if the FEC set is already completed and ignores the shred if found.
    - Queries the `curr_map` to find the context for the current FEC set or prepares a new context if this is the first shred in the set.
    - Verifies the shred's type, version, and size, rejecting it if any checks fail.
    - Calculates the Merkle tree depth and protected sizes for the shred.
    - Hashes the shred's leaf node for Merkle tree verification.
    - Handles the case where the shred is the first in its FEC set, including resource allocation and Merkle root verification.
    - Handles the case where the shred is not the first, checking for duplicates and consistency with existing shreds in the set.
    - Copies the shred to the resolver's memory and updates the received shred count.
    - Checks if enough shreds have been received to begin reconstruction and performs reconstruction if possible.
    - Verifies the consistency of the reconstructed FEC set and updates the `done_map` and `complete_list` if successful.
    - Returns appropriate status codes based on the outcome of the processing.
- **Output**: Returns an integer status code indicating the result of the shred processing, such as `FD_FEC_RESOLVER_SHRED_OKAY`, `FD_FEC_RESOLVER_SHRED_COMPLETES`, or `FD_FEC_RESOLVER_SHRED_REJECTED`.
- **Functions Called**:
    - [`ctx_ll_remove`](<#ctx_ll_remove>)
    - [`ctx_ll_insert`](<#ctx_ll_insert>)


---
### fd\_fec\_resolver\_done\_contains<!-- {{#callable:fd_fec_resolver_done_contains}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L726>)

Checks if a given signature is present in the `done_map` of a `fd_fec_resolver_t` instance.
- **Inputs**:
    - `resolver`: A pointer to a `fd_fec_resolver_t` structure, which contains the `done_map` to query.
    - `signature`: A pointer to a constant `fd_ed25519_sig_t` structure representing the signature to check for in the `done_map`.
- **Logic and Control Flow**:
    - Cast the `signature` to a `wrapped_sig_t` pointer named `w_sig`.
    - Check if `w_sig` is invalid using `ctx_map_key_inval`; if invalid, return 0.
    - Query the `done_map` in `resolver` with `w_sig`; return 1 if found, otherwise return 0.
- **Output**: Returns an integer: 1 if the signature is found in the `done_map`, 0 otherwise.


---
### fd\_fec\_resolver\_shred\_query<!-- {{#callable:fd_fec_resolver_shred_query}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L734>)

Queries a shred from the current map of the resolver using a signature and shred index.
- **Inputs**:
    - `resolver`: A pointer to the `fd_fec_resolver_t` structure that manages the FEC sets.
    - `signature`: A pointer to a constant `fd_ed25519_sig_t` structure representing the signature of the shred to query.
    - `shred_idx`: An unsigned integer representing the index of the shred to query.
    - `out_shred`: A pointer to an `uchar` array where the queried shred data will be copied.
- **Logic and Control Flow**:
    - Cast the `signature` to a `wrapped_sig_t` pointer `w_sig`.
    - Check if the key in `w_sig` is invalid using `ctx_map_key_inval`; if so, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Query the `curr_map` of the `resolver` with `w_sig`; if no context is found, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Retrieve the `fd_fec_set_t` from the context and get the data shred at `shred_idx`.
    - Calculate the minimum size between the shred size and `FD_SHRED_MIN_SZ`.
    - Copy the shred data to `out_shred` using `fd_memcpy`.
    - Return `FD_FEC_RESOLVER_SHRED_OKAY` to indicate success.
- **Output**: Returns an integer status code: `FD_FEC_RESOLVER_SHRED_OKAY` if the query is successful, or `FD_FEC_RESOLVER_SHRED_REJECTED` if the query fails.


---
### fd\_fec\_resolver\_force\_complete<!-- {{#callable:fd_fec_resolver_force_complete}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L757>)

Attempts to forcefully complete an FEC set using the last shred provided, validating and updating the resolver state accordingly.
- **Inputs**:
    - `resolver`: A pointer to an `fd_fec_resolver_t` structure that manages the FEC sets.
    - `last_shred`: A pointer to a constant `fd_shred_t` structure representing the last shred in the FEC set.
    - `out_fec_set`: A pointer to a constant pointer to an `fd_fec_set_t` structure where the function will store the completed FEC set if successful.
    - `out_merkle_root`: A pointer to an `fd_bmtree_node_t` structure where the function will store the Merkle root if successful.
- **Logic and Control Flow**:
    - Calculate `idx_in_set` as the difference between `last_shred->idx` and `last_shred->fec_set_idx`.
    - Check if `idx_in_set` is greater than or equal to `FD_REEDSOL_DATA_SHREDS_MAX`; if so, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Validate the signature of `last_shred`; if invalid, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Check if the FEC set is already completed; if so, return `FD_FEC_RESOLVER_SHRED_IGNORED`.
    - Query the current map for the FEC set context; if not found, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Ensure no parity shreds have been received; if any are set, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Verify that all data shreds up to `idx_in_set` have been received; if any are missing, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Ensure no shreds with a higher index than `idx_in_set` have been received; if any are found, return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Parse the first data shred and validate all data shreds up to `idx_in_set` for consistency; if any validation fails, reject the FEC set.
    - Set `data_shred_cnt` and `parity_shred_cnt` in the context to reflect the completed state.
    - If validation fails, return memory to the pools and return `FD_FEC_RESOLVER_SHRED_REJECTED`.
    - Copy the Merkle root to `out_merkle_root` if provided.
    - Insert the context into the done map and remove it from the current map.
    - Push the tree and set to their respective free lists.
    - Set `*out_fec_set` to the completed FEC set and return `FD_FEC_RESOLVER_SHRED_COMPLETES`.
- **Output**: Returns an integer status code indicating the result of the operation, such as `FD_FEC_RESOLVER_SHRED_COMPLETES` for success or `FD_FEC_RESOLVER_SHRED_REJECTED` for failure.
- **Functions Called**:
    - [`ctx_ll_remove`](<#ctx_ll_remove>)
    - [`ctx_ll_insert`](<#ctx_ll_insert>)


---
### fd\_fec\_resolver\_leave<!-- {{#callable:fd_fec_resolver_leave}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L873>)

Releases resources associated with an `fd_fec_resolver_t` object and returns a pointer to the resolver.
- **Inputs**:
    - `resolver`: A pointer to an `fd_fec_resolver_t` object whose resources are to be released.
- **Logic and Control Flow**:
    - Call `fd_sha512_leave` to release resources associated with the `sha512` field of the resolver.
    - Call `bmtrlist_leave` to release resources associated with the `bmtree_free_list` field of the resolver.
    - Call `freelist_leave` to release resources associated with the `complete_list` field of the resolver.
    - Call `freelist_leave` to release resources associated with the `free_list` field of the resolver.
    - Call `ctx_map_leave` to release resources associated with the `done_map` field of the resolver.
    - Call `ctx_map_leave` to release resources associated with the `curr_map` field of the resolver.
    - Return a pointer to the `resolver`.
- **Output**: A pointer to the `fd_fec_resolver_t` object that was passed in.


---
### fd\_fec\_resolver\_delete<!-- {{#callable:fd_fec_resolver_delete}} -->
[View Source →](<../../../../../src/disco/shred/fd_fec_resolver.c#L884>)

Deallocates resources associated with a Forward Error Correction (FEC) resolver and returns the shared memory pointer.
- **Inputs**:
    - `shmem`: A pointer to the shared memory where the FEC resolver is located.
- **Logic and Control Flow**:
    - Cast the `shmem` pointer to a `fd_fec_resolver_t` pointer named `resolver`.
    - Retrieve the `depth`, `partial_depth`, `complete_depth`, and `done_depth` from the `resolver`.
    - Calculate `lg_curr_map_cnt` and `lg_done_map_cnt` using `fd_ulong_find_msb` on `depth` and `done_depth`, respectively, and add 2 to each result.
    - Initialize scratch allocation with `FD_SCRATCH_ALLOC_INIT` using `shmem`.
    - Append allocations for `curr`, `done`, `free`, `cmplst`, and `bmfree` using `FD_SCRATCH_ALLOC_APPEND` with appropriate alignments and footprints.
    - Finalize the scratch allocation with `FD_SCRATCH_ALLOC_FINI`.
    - Delete the SHA-512 context using `fd_sha512_delete`.
    - Delete the `bmfree`, `cmplst`, `free`, `done`, and `curr` contexts using their respective delete functions (`bmtrlist_delete`, `freelist_delete`, `ctx_map_delete`).
- **Output**: Returns the original `shmem` pointer after deallocating resources.



---
Made with ❤️ by [Driver](https://www.driver.ai/)