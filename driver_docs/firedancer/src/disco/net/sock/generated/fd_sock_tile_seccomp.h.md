<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for socket operations with architecture-specific checks and syscall allowances.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations and defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_sock_tile`](<#populate_sock_filter_policy_fd_sock_tile>), initializes a BPF filter array with 33 instructions. These instructions enforce security policies by allowing or denying specific system calls based on predefined conditions.

The filter checks the architecture of the executing environment and allows certain system calls like `ppoll`, `recvmmsg`, `sendmmsg`, `write`, and `fsync` under specific conditions. If a system call does not meet the criteria, the filter will terminate the process using `SECCOMP_RET_KILL_PROCESS`. The function uses macros and constants to define the behavior of the filter, ensuring that only allowed operations are executed, thereby enhancing the security of the application by restricting its interaction with the operating system.
# Imports and Dependencies

---
- `../../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_sock\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: Represents the number of instructions in the socket filter policy for the file descriptor socket tile. It is a constant value set to 33.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_sock_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_sock\_tile<!-- {{#callable:populate_sock_filter_policy_fd_sock_tile}} -->
[View Source →](<../../../../../../../src/disco/net/sock/generated/fd_sock_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call permissions based on file descriptors and architecture.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 33.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be stored.
    - `logfile_fd`: The file descriptor for the log file, used in the filter policy.
    - `tx_fd`: The file descriptor for transmission, used in the filter policy.
    - `rx_fd0`: The first receive file descriptor, used in the filter policy.
    - `rx_fd1`: The second receive file descriptor, used in the filter policy.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 33 to ensure the `out` array can hold the filter policy.
    - Defines a `sock_filter` array with 33 elements to specify the seccomp filter policy.
    - Loads the architecture from `seccomp_data` and compares it to `ARCH_NR`; if they do not match, the process is killed.
    - Loads the syscall number and checks if it matches `SYS_ppoll`, `SYS_recvmmsg`, `SYS_sendmmsg`, `SYS_write`, or `SYS_fsync`, allowing or further checking based on the syscall.
    - For `SYS_recvmmsg`, checks if the first argument is greater than or equal to `rx_fd0` and `rx_fd1`, and other conditions, to allow or kill the process.
    - For `SYS_sendmmsg`, checks if the first argument equals `tx_fd` and other conditions, to allow or kill the process.
    - For `SYS_write`, checks if the first argument equals 2 or `logfile_fd` to allow or kill the process.
    - For `SYS_fsync`, checks if the first argument equals `logfile_fd` to allow or kill the process.
    - Copies the defined filter policy into the `out` array using `fd_memcpy`.
- **Output**: The `out` array is populated with a seccomp filter policy that controls system call permissions based on the provided file descriptors and architecture.



---
Made with ❤️ by [Driver](https://www.driver.ai/)