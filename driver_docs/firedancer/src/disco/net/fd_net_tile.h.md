<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for XDP networking in a Firedancer topology using the 'net' tile, including packet handling.

# Purpose
The `fd_net_tile.h` file is a C header file that provides APIs for integrating XDP networking into a Firedancer topology using the 'net' tile. It includes definitions and functions to manage and interact with network tiles, specifically for handling RX packet bounds and translating packet fragments. The file defines a structure `fd_net_rx_bounds_t` to store bounds information for received packets and provides functions like [`fd_net_rx_bounds_init`](<#fd_net_rx_bounds_init>) and [`fd_net_rx_translate_frag`](<#fd_net_rx_translate_frag>) to initialize bounds and translate packet fragments, respectively. Additionally, it includes functions for appending network tiles to a topology, linking network tiles for packet reception, and finalizing network tile configurations. The header file ensures that network operations are performed within defined bounds and facilitates the setup of network tiles in a Firedancer topology.
# Imports and Dependencies

---
- `../fd_disco_base.h`
- `../../tango/dcache/fd_dcache.h`


# Global Variables

---
### FD\_PROTOTYPES\_BEGIN
- **Type**: `macro`
- **Description**: `FD_PROTOTYPES_BEGIN` is a macro used to mark the beginning of a section in the code where function prototypes are declared. It is typically used to manage the visibility or linkage of function prototypes in a consistent manner across different parts of the codebase.
- **Use**: Used to indicate the start of a block of function prototypes.


# Data Structures

---
### fd\_topo\_t
- **Type**: ``struct``
- **Members**:
    - `fd_topo_t`: A typedef for the `struct fd_topo`, representing a Firedancer topology.
- **Description**: The `fd_topo_t` is a typedef for a `struct fd_topo`, which is used in the Firedancer topology to manage and configure network tiles. This structure is part of the Firedancer's networking API, which provides XDP networking capabilities. The `fd_topo_t` is used in various functions to append network tiles, link network tiles to applications, and finalize network tile configurations.


---
### fd\_net\_rx\_bounds
- **Type**: ``struct``
- **Members**:
    - ``base``: Base address of the workspace containing the dcache.
    - ``pkt_lo``: Lowest permitted pointer to packet payload.
    - ``pkt_wmark``: Highest permitted pointer to packet payload.
- **Description**: Defines bounds for receiving packets in a network tile, including the base address of the workspace and the permissible range for packet payload pointers.


---
### fd\_net\_rx\_bounds\_t
- **Type**: ``struct``
- **Members**:
    - ``base``: Base address of the workspace containing the dcache.
    - ``pkt_lo``: Lowest permitted pointer to packet payload.
    - ``pkt_wmark``: Highest permitted pointer to packet payload.
- **Description**: Defines the bounds for receiving packets in a network tile, including the base address of the workspace and the permissible range for packet payload pointers.


---
### fd\_config\_net\_t
- **Type**: ``struct``
- **Members**:
    - `fd_config_net`: A forward declaration of a structure used for network configuration.
- **Description**: `fd_config_net_t` is a typedef for a structure named `fd_config_net`, which is used in the context of network configuration within the Firedancer topology. The structure is forward-declared in the provided code, indicating that its detailed definition is located elsewhere. It is used as a parameter in functions related to appending network tiles to a topology, suggesting its role in configuring network-related settings or parameters.


# Functions

---
### fd\_net\_rx\_bounds\_init<!-- {{#callable:fd_net_rx_bounds_init}} -->
[View Source →](<../../../../../src/disco/net/fd_net_tile.h#L23>)

Initializes a bounds checker for RX packets produced by the net tile.
- **Inputs**:
    - ``bounds``: A pointer to an `fd_net_rx_bounds_t` structure that will be initialized with bounds information for RX packets.
    - ``dcache``: A pointer to a local join to a dcache that will carry packet payloads.
- **Logic and Control Flow**:
    - Set `bounds->base` to the base address of the workspace containing `dcache` using `fd_wksp_containing` function.
    - Set `bounds->pkt_lo` to the address of `dcache`.
    - Calculate `bounds->pkt_wmark` as the sum of `bounds->pkt_lo` and the data size of `dcache` minus `FD_NET_MTU`.
    - If `bounds->base` is zero, log an error message indicating failure to find the workspace containing `dcache`.
- **Output**: No return value; the function initializes the `bounds` structure with calculated values.


---
### fd\_net\_rx\_translate\_frag<!-- {{#callable:fd_net_rx_translate_frag}} -->
[View Source →](<../../../../../src/disco/net/fd_net_tile.h#L46>)

Translates fragment metadata into a pointer to the packet payload in the local address space, ensuring it is within valid bounds.
- **Inputs**:
    - `bounds`: A pointer to an `fd_net_rx_bounds_t` structure that contains the base address and valid packet payload range.
    - `chunk`: An unsigned long integer representing the chunk index of the fragment.
    - `ctl`: An unsigned long integer representing the control offset within the chunk.
    - `sz`: An unsigned long integer representing the size of the fragment.
- **Logic and Control Flow**:
    - Calculate the pointer `p` by adding the base address from `bounds`, the shifted `chunk` value, and the `ctl` offset.
    - Check if `p` is within the valid range defined by `pkt_lo` and `pkt_wmark` in `bounds`, and if `sz` is less than or equal to `FD_NET_MTU`.
    - If the conditions are not met, log an error and terminate the application.
    - Return the calculated pointer `p` as a constant void pointer.
- **Output**: A constant void pointer to the first byte of the packet payload in the local address space.


# Function Declarations (Public API)

---
### fd\_topos\_net\_tiles<!-- {{#callable_declaration:fd_topos_net_tiles}} -->
[View Source →](<../../../../../src/disco/net/fd_net_tile.h#L75>)

Appends network and network link tiles to the topology for XDP networking.
- **Description**: Use this function to add network and network link tiles to a Firedancer topology, enabling fast XDP networking. This function configures the topology based on the specified network configuration and parameters. It must be called with a valid topology object and appropriate configuration settings. Ensure that the `net_cfg` provider is either 'xdp' or 'socket', as other values will result in an error. This function should be used when setting up the network components of a topology, and it assumes that the topology object is properly initialized.
- **Inputs**:
    - `topo`: A pointer to an `fd_topo_t` structure representing the topology. Must not be null.
    - `net_tile_cnt`: The number of network tiles to append. Must be a non-negative integer.
    - `net_config`: A pointer to a constant `fd_config_net_t` structure containing network configuration. Must not be null.
    - `netlnk_max_routes`: The maximum number of routes for the network link. Must be a non-negative integer.
    - `netlnk_max_peer_routes`: The maximum number of peer routes for the network link. Must be a non-negative integer.
    - `netlnk_max_neighbors`: The maximum number of neighbors for the network link. Must be a non-negative integer.
    - `tile_to_cpu`: An array mapping tile indices to CPU indices. The array size must be at least `FD_TILE_MAX`. Must not be null.
- **Output**: None
- **See Also**: [`fd_topos_net_tiles`](<fd_net_tile_topo.c.md#fd_topos_net_tiles>)  (Implementation)


---
### fd\_topos\_net\_rx\_link<!-- {{#callable_declaration:fd_topos_net_rx_link}} -->
[View Source →](<../../../../../src/disco/net/fd_net_tile.h#L87>)

Creates a network receive link in the topology.
- **Description**: Use this function to add a receive link for network packets in a Firedancer topology. It is necessary to call this function when setting up network communication between the 'net' tile and application tiles. The function must be called with a valid topology object and appropriate parameters for the link. It handles different configurations based on whether the topology uses XDP or not, ensuring the correct setup for packet reception.
- **Inputs**:
    - `topo`: A pointer to an `fd_topo_t` structure representing the topology. Must not be null.
    - `link_name`: A constant character pointer representing the name of the link. Must not be null.
    - `net_kind_id`: An unsigned long integer representing the network kind identifier. Must be a valid identifier within the topology.
    - `depth`: An unsigned long integer representing the depth of the link. Must be a positive value.
- **Output**: None
- **See Also**: [`fd_topos_net_rx_link`](<fd_net_tile_topo.c.md#fd_topos_net_rx_link>)  (Implementation)


---
### fd\_topos\_tile\_in\_net<!-- {{#callable_declaration:fd_topos_tile_in_net}} -->
[View Source →](<../../../../../src/disco/net/fd_net_tile.h#L95>)

Registers a net TX link with all net tiles.
- **Description**: Use this function to register a transmission link with all network tiles in a given topology. This function must be called after all application-to-network tile links have been created. It should be called once for each network tile to ensure proper registration. This function is essential for setting up the network topology for data transmission.
- **Inputs**:
    - `topo`: A pointer to an `fd_topo_t` structure representing the network topology. Must not be null.
    - `fseq_wksp`: A constant character pointer to the workspace sequence. Must not be null.
    - `link_name`: A constant character pointer to the name of the link. Must not be null.
    - `link_kind_id`: An unsigned long representing the kind ID of the link. Must be a valid kind ID.
    - `reliable`: An integer indicating if the link is reliable. Non-zero for reliable, zero otherwise.
    - `polled`: An integer indicating if the link is polled. Non-zero for polled, zero otherwise.
- **Output**: None
- **See Also**: [`fd_topos_tile_in_net`](<fd_net_tile_topo.c.md#fd_topos_tile_in_net>)  (Implementation)


---
### fd\_topos\_net\_tile\_finish<!-- {{#callable_declaration:fd_topos_net_tile_finish}} -->
[View Source →](<../../../../../src/disco/net/fd_net_tile.h#L106>)

Finalizes the setup of a network tile in the topology.
- **Description**: Use this function to complete the configuration of a network tile within a Firedancer topology. It must be called after all application-to-network tile links have been established. This function adjusts internal parameters related to queue sizes and memory caches based on the network kind identifier. It is important to ensure that the topology is in a state where all necessary links are created before invoking this function.
- **Inputs**:
    - `topo`: A pointer to an `fd_topo_t` structure representing the topology. Must not be null. The caller retains ownership.
    - `net_kind_id`: An unsigned long integer representing the network kind identifier. It determines specific configuration adjustments for the network tile.
- **Output**: None
- **See Also**: [`fd_topos_net_tile_finish`](<fd_net_tile_topo.c.md#fd_topos_net_tile_finish>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)