<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall control, generated by `generate_filters.py`.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a deduplication tile. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_dedup_tile`](<#populate_sock_filter_policy_fd_dedup_tile>), initializes a BPF filter array that enforces security policies by allowing or denying specific system calls based on the architecture and syscall number.

The filter policy is designed to restrict the execution of certain system calls, allowing only `SYS_write` and `SYS_fsync` under specific conditions. The function checks if the architecture of the script matches the runtime architecture and then evaluates the syscall number. If the syscall is `SYS_write` or `SYS_fsync`, it further checks the syscall arguments to determine if the call should be allowed. If the conditions are not met, the process is terminated using `SECCOMP_RET_KILL_PROCESS`. This setup enhances security by limiting the operations that can be performed by the deduplication tile, reducing the risk of unauthorized actions.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_dedup\_tile\_instr\_cnt
- **Type**: `unsigned int`
- **Description**: A constant unsigned integer that represents the number of instructions in a socket filter policy for deduplication.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_dedup_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_dedup\_tile<!-- {{#callable:populate_sock_filter_policy_fd_dedup_tile}} -->
[View Source →](<../../../../../../src/disco/dedup/generated/fd_dedup_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a seccomp filter policy to control system call permissions based on architecture and file descriptor checks.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 14.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be stored.
    - `logfile_fd`: The file descriptor to check against syscall arguments for write and fsync operations.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; allow or kill the process based on the result.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; allow or kill the process based on the result.
    - Use `fd_memcpy` to copy the `filter` array to the `out` array.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)