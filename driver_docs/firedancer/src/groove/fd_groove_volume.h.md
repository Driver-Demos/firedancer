<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for managing groove volumes in memory, supporting dynamic allocation and removal.

# Purpose
The code defines a C header file for managing "groove volumes" in a system that handles data storage. A groove volume is a data structure with a fixed size, defined by the constant `FD_GROOVE_VOLUME_FOOTPRINT`, and is identified by a unique index. The header file provides the structure `fd_groove_volume` which includes metadata such as a magic number, index, and user-defined information, as well as a data storage area. The code supports dynamic management of these volumes, allowing them to be added to or removed from a pool without disrupting ongoing operations. This is achieved through a lock-free stack mechanism for empty volumes, facilitating efficient scaling of storage capacity.

The file also includes function prototypes for managing groove volumes within a pool. The function [`fd_groove_volume_pool_add`](<#fd_groove_volume_pool_add>) adds a memory region to the pool, initializing its metadata, while [`fd_groove_volume_pool_remove`](<#fd_groove_volume_pool_remove>) removes an empty volume from the pool, transferring ownership to the caller. These operations are designed to be safe for concurrent use, ensuring that they do not block other operations. The header file is intended to be included in other C source files, providing a public API for managing groove volumes in a system that supports persistent and inter-process communication (IPC) data storage.
# Imports and Dependencies

---
- `fd_groove_base.h`
- `../util/tmpl/fd_pool_para.c`


# Data Structures

---
### fd\_groove\_volume
- **Type**: ``struct``
- **Members**:
    - `magic`: Indicates the state of the volume, whether it contains groove data allocations or not.
    - `idx`: Represents the volume index, mapped into the user's address space.
    - `next`: Managed by the groove volume pool for internal tracking.
    - `info_sz`: Specifies the size of the user information stored in the `info` array.
    - `info`: Stores user information up to `FD_GROOVE_VOLUME_INFO_MAX` bytes.
    - `data`: Holds the groove data up to `FD_GROOVE_VOLUME_DATA_MAX` bytes.
- **Description**: Aligned to `FD_GROOVE_VOLUME_ALIGN`, this structure represents a groove volume used to store groove data objects, with fields for managing state, indexing, and user information, as well as space for the actual data.


---
### fd\_groove\_volume\_t
- **Type**: ``struct``
- **Members**:
    - `magic`: Indicates the state of the volume, whether it contains groove data allocations or not.
    - `idx`: Specifies the unique index of the volume in the user's address space.
    - `next`: Managed by the groove volume pool for internal operations.
    - `info_sz`: Represents the size of the user information stored in the volume.
    - `info`: Holds user information up to a maximum size defined by `FD_GROOVE_VOLUME_INFO_MAX`.
    - `data`: Contains the actual data stored in the volume, with a maximum size defined by `FD_GROOVE_VOLUME_DATA_MAX`.
- **Description**: Defines a groove volume structure used to store groove data objects with a fixed footprint size and unique index, supporting dynamic addition and removal of volumes in a groove instance.


# Function Declarations (Public API)

---
### fd\_groove\_volume\_pool\_add<!-- {{#callable_declaration:fd_groove_volume_pool_add}} -->
[View Source →](<../../../../src/groove/fd_groove_volume.h#L92>)

Adds a memory region to the volume pool.
- **Description**: Use this function to add a memory region, specified by its starting address and size, to a volume pool. The function requires that the pool is a current local join and that the memory region is correctly aligned and does not overlap with existing volumes. The function initializes the volume info with the provided data, clamping the size if necessary, and zeroes any remaining space. The caller must ensure the memory region is properly initialized before calling. On success, the pool takes ownership of the volumes. The function is thread-safe and non-blocking.
- **Inputs**:
    - `pool`: A pointer to the `fd_groove_volume_pool_t` structure representing the volume pool. Must not be null. The pool must be a current local join.
    - `shmem`: A pointer to the start of the memory region to add. The region must be aligned and within the pool's address space.
    - `footprint`: The size of the memory region in bytes. Must be a multiple of `FD_GROOVE_VOLUME_FOOTPRINT`. If zero, the function does nothing and returns success.
    - `info`: A pointer to the user data to initialize the volume info. Can be null, in which case `info_sz` is treated as zero.
    - `info_sz`: The size of the user data in bytes. If greater than `FD_GROOVE_VOLUME_INFO_MAX`, it is clamped to `FD_GROOVE_VOLUME_INFO_MAX`. If `info` is null, this is treated as zero.
- **Output**: Returns `FD_GROOVE_SUCCESS` on success. On failure, returns a negative error code and logs details. Possible errors include invalid pool or memory region.
- **See Also**: [`fd_groove_volume_pool_add`](<fd_groove_volume.c.md#fd_groove_volume_pool_add>)  (Implementation)


---
### fd\_groove\_volume\_pool\_remove<!-- {{#callable_declaration:fd_groove_volume_pool_remove}} -->
[View Source →](<../../../../src/groove/fd_groove_volume.h#L144>)

Removes an empty volume from the pool.
- **Description**: Use this function to remove an empty volume from the specified pool. It is safe to call this function concurrently, and it will not block the caller or other concurrent users of the pool. The function returns the address of the removed volume in the caller's address space, transferring ownership to the caller. If the pool is empty or an error occurs, the function returns NULL and logs a warning.
- **Inputs**:
    - `pool`: A pointer to the `fd_groove_volume_pool_t` from which to remove a volume. Must not be null. If null, the function logs a warning and returns NULL.
- **Output**: Returns a pointer to the removed volume if successful, or NULL if no empty volumes are available or an error occurs.
- **See Also**: [`fd_groove_volume_pool_remove`](<fd_groove_volume.c.md#fd_groove_volume_pool_remove>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)