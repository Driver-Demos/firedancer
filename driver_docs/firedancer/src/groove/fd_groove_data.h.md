<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for managing groove data objects, including allocation, alignment, and verification.

# Purpose
The `fd_groove_data.h` file is a C header file that defines the structures, constants, and function prototypes necessary for managing groove data objects within a memory-mapped I/O system. It provides a detailed framework for handling memory allocation and management of groove data objects, which are stored in contiguous blocks and organized into size classes and superblocks. The file includes definitions for the alignment and footprint of these data objects, as well as the configuration of size classes through the `fd_groove_data_szc_cfg` structure. This structure specifies the footprint, object count, concurrency group mask, and parent size class for each size class.

The header file also defines several key structures, such as [`fd_groove_data_hdr`](<#fd_groove_data_hdr_tfd_groove_data_hdr>) and `fd_groove_data_shmem`, which are used to encode details about groove data objects and manage shared memory, respectively. The file provides function prototypes for creating, joining, leaving, and deleting groove data instances, as well as for allocating and freeing groove data objects. Additionally, it includes utility functions for verifying the integrity of groove data and volumes. The header file is designed to be used in conjunction with other components like `fd_groove_meta.h` and `fd_groove_volume.h`, which are included at the beginning of the file. Overall, the file serves as a comprehensive interface for managing groove data objects in a high-performance computing environment.
# Imports and Dependencies

---
- `fd_groove_meta.h`
- `fd_groove_volume.h`


# Global Variables

---
### fd\_groove\_data\_szc\_cfg
- **Type**: ``fd_groove_data_szc_cfg_t` array`
- **Description**: Specifies the configuration for each size class in the groove data system. Each element in the array represents a size class configuration, detailing the object footprint, the number of objects in a superblock, the concurrency group mask, and the parent size class.
- **Use**: Used to define the configuration of 32 different size classes for groove data objects.


# Data Structures

---
### fd\_groove\_data\_szc\_cfg
- **Type**: ``struct``
- **Members**:
    - ``obj_footprint``: Defines the footprint of an object, which is a multiple of `FD_GROOVE_BLOCK_FOOTPRINT`.
    - ``obj_cnt``: Specifies the number of objects in the superblock for this size class, ranging from 2 to 64.
    - ``cgroup_mask``: Indicates the number of concurrency groups for this size class superblock, represented as a power-of-2 minus 1.
    - ``parent_szc``: Represents the parent size class, with `SZC_CNT` indicating the use of an entire volume data region.
- **Description**: Configures the parameters for a specific size class in a groove data structure, including object footprint, object count, concurrency group mask, and parent size class.


---
### fd\_groove\_data\_szc\_cfg\_t
- **Type**: ``struct``
- **Members**:
    - ``obj_footprint``: Specifies the footprint of an object as a multiple of `FD_GROOVE_BLOCK_FOOTPRINT`.
    - ``obj_cnt``: Indicates the number of objects in the superblock for this size class, ranging from 2 to 64.
    - ``cgroup_mask``: Defines the number of concurrency groups for this size class superblock, as a power-of-2 minus 1.
    - ``parent_szc``: Specifies the parent size class, with `SZC_CNT` indicating the use of an entire volume data region.
- **Description**: Configures the parameters for a specific size class in the groove data structure, including object footprint, object count, concurrency group mask, and parent size class.


---
### fd\_groove\_data\_hdr
- **Type**: ``struct``
- **Members**:
    - ``bits``: Stores encoded information about the groove data object, including type, index, size class, alignment, and size.
    - ``info``: Holds additional information such as the object tag or the next superblock.
- **Description**: Encodes details about a groove data object, including its type, index, size class, alignment, and size, using the `bits` field, while the `info` field stores additional data like the object tag or the next superblock. This structure is aligned to `FD_GROOVE_DATA_HDR_ALIGN` and is used at the top of a `FD_GROOVE_BLOCK` to describe the object at the beginning of its first data block.


---
### fd\_groove\_data\_hdr\_t
- **Type**: ``struct``
- **Members**:
    - ``bits``: Encodes various attributes of a groove data object, including type, index, size class, alignment, and size.
    - ``info``: Stores additional information about the groove data object, such as an object tag or the next superblock.
- **Description**: Encodes details about a groove data object, including its type, index, size class, alignment, and size, using a compact bit field representation. The `info` field provides additional data, such as an object tag or the next superblock, depending on the type of the header. This structure is aligned to `FD_GROOVE_DATA_HDR_ALIGN` and has a footprint of `FD_GROOVE_DATA_HDR_FOOTPRINT`. It is used to manage groove data objects within a memory-mapped I/O system, ensuring efficient storage and retrieval of data blocks.


---
### fd\_groove\_data\_shmem
- **Type**: ``struct``
- **Members**:
    - ``magic``: Stores a magic number to identify the structure, expected to be `FD_GROOVE_DATA_MAGIC`.
    - ``active_slot``: An array indexed by size class and concurrency group, aligned to `FD_GROOVE_DATA_ALIGN`.
    - ``inactive_stack``: An array used for managing inactive superblocks, using the least significant 9 bits as an ABA tag.
    - ``volume_pool``: An array of `fd_groove_volume_pool_shmem_t` used for managing volume pools, aligned to `FD_GROOVE_DATA_ALIGN`.
- **Description**: The `fd_groove_data_shmem` structure is designed to manage groove data in shared memory, ensuring alignment and efficient handling of active and inactive data slots. It uses a magic number for identification and includes arrays for active slots and inactive stacks, which are indexed by size class and concurrency group. The structure also contains a volume pool for managing memory volumes, all aligned to a specified boundary to optimize memory access and management.


---
### fd\_groove\_data\_shmem\_t
- **Type**: ``struct``
- **Members**:
    - ``magic``: A magic number used to identify the structure, set to `FD_GROOVE_DATA_MAGIC`.
    - ``active_slot``: An array indexed by size class and concurrency group, aligned to `FD_GROOVE_DATA_ALIGN`.
    - ``inactive_stack``: An array for managing inactive superblocks, aligned to `FD_GROOVE_DATA_ALIGN`.
    - ``volume_pool``: A single-element array of `fd_groove_volume_pool_shmem_t`, aligned to `FD_GROOVE_DATA_ALIGN`.
- **Description**: The `fd_groove_data_shmem_t` structure is a shared memory representation of groove data, aligned to `FD_GROOVE_DATA_ALIGN`. It includes a magic number for identification, arrays for active slots and inactive stacks to manage groove data objects, and a volume pool for handling memory volumes. This structure is designed to support high-performance computing (HPC) memory-mapped I/O operations with lock-free algorithms.


---
### fd\_groove\_data
- **Type**: ``struct``
- **Members**:
    - `volume_pool`: An array of `fd_groove_volume_pool_t` representing the local join of the volume pool.
    - `active_slot`: A pointer to an array of `ulong` representing the active slot for a size class and concurrency group.
    - `inactive_stack`: A pointer to an array of `ulong` representing the inactive stack for a size class.
    - `cgroup_hint`: A `ulong` representing the concurrency group hint for this join.
- **Description**: The `fd_groove_data` structure manages groove data objects within a memory region, facilitating operations like allocation and deallocation. It uses a volume pool for managing memory volumes and maintains active and inactive slots for different size classes and concurrency groups. The `cgroup_hint` provides a hint for concurrency group management, optimizing memory operations in a concurrent environment.


---
### fd\_groove\_data\_t
- **Type**: ``struct``
- **Members**:
    - ``volume_pool``: An array of `fd_groove_volume_pool_t` representing the local join of the volume pool.
    - ``active_slot``: A pointer to an array of `ulong` representing the active slot for sizeclass and concurrency group.
    - ``inactive_stack``: A pointer to an array of `ulong` representing the inactive stack for sizeclass.
    - ``cgroup_hint``: A `ulong` representing the concurrency group hint for this join.
- **Description**: `fd_groove_data_t` is a data structure that manages groove data objects within a memory region. It includes a volume pool for managing memory volumes, pointers to active and inactive slots for handling sizeclass and concurrency groups, and a concurrency group hint to optimize memory allocation and access. This structure is designed to work with high-performance computing environments, supporting lock-free operations and efficient memory management.


# Functions

---
### fd\_groove\_data\_align<!-- {{#callable:fd_groove_data_align}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L169>)

Returns the alignment required for a memory region to hold a `fd_groove_data`'s state.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `alignof` on `fd_groove_data_shmem_t` to determine the alignment.
    - Returns the result of the `alignof` operation.
- **Output**: An unsigned long integer representing the alignment, which is a power of two.


---
### fd\_groove\_data\_footprint<!-- {{#callable:fd_groove_data_footprint}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L216>)

Returns the size in bytes of the `fd_groove_data_shmem_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function is defined as `static inline` and `FD_FN_CONST`, indicating it is a constant function that can be inlined by the compiler.
    - The function returns the result of the `sizeof` operator applied to the `fd_groove_data_shmem_t` type.
- **Output**: The function returns an `ulong` representing the size in bytes of the `fd_groove_data_shmem_t` structure.


---
### fd\_groove\_data\_shdata\_const<!-- {{#callable:fd_groove_data_shdata_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L231>)

Returns a constant pointer to the shared data memory location of a groove data object, adjusted by a defined alignment offset.
- **Inputs**:
    - `data`: A pointer to a constant `fd_groove_data_t` structure, representing the groove data object.
- **Logic and Control Flow**:
    - Casts the `active_slot` member of the `data` structure to an unsigned long integer.
    - Subtracts the constant `FD_GROOVE_DATA_ALIGN` from the `active_slot` value.
    - Casts the result to a constant void pointer and returns it.
- **Output**: A constant void pointer to the adjusted shared data memory location of the groove data object.


---
### fd\_groove\_data\_volume0\_const<!-- {{#callable:fd_groove_data_volume0_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L236>)

Returns a constant pointer to the start of the volume pool in a `fd_groove_data_t` structure.
- **Inputs**:
    - `data`: A pointer to a `fd_groove_data_t` structure, which contains the volume pool information.
- **Logic and Control Flow**:
    - Calls the function `fd_groove_volume_pool_shele_const` with `data->volume_pool` as the argument.
    - Returns the result of the `fd_groove_volume_pool_shele_const` function call.
- **Output**: A constant pointer to the start of the volume pool in the `fd_groove_data_t` structure.


---
### fd\_groove\_data\_volume1\_const<!-- {{#callable:fd_groove_data_volume1_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L241>)

Calculates the end address of the groove data region in a volume pool.
- **Inputs**:
    - `data`: A pointer to a constant `fd_groove_data_t` structure, representing the groove data context.
- **Logic and Control Flow**:
    - Calls `fd_groove_volume_pool_shele_const` with `data->volume_pool` to get the base address of the volume pool.
    - Calls `fd_groove_volume_pool_ele_max` with `data->volume_pool` to get the maximum number of elements in the volume pool.
    - Casts the base address to a `fd_groove_volume_t` pointer and adds the maximum number of elements to it.
    - Casts the result to a `void const *` and returns it.
- **Output**: A `void const *` pointer to the end of the groove data region in the volume pool.


---
### fd\_groove\_data\_volume\_max<!-- {{#callable:fd_groove_data_volume_max}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L247>)

Returns the maximum number of elements in the volume pool of a given `fd_groove_data_t` structure.
- **Inputs**:
    - `data`: A pointer to a constant `fd_groove_data_t` structure, which contains the volume pool to query.
- **Logic and Control Flow**:
    - Calls the function `fd_groove_volume_pool_ele_max` with the `volume_pool` member of the `data` structure as an argument.
    - Returns the result of the `fd_groove_volume_pool_ele_max` function call.
- **Output**: An unsigned long integer representing the maximum number of elements in the volume pool.


---
### fd\_groove\_data\_cgroup\_hint<!-- {{#callable:fd_groove_data_cgroup_hint}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L252>)

Retrieves the concurrency group hint from a `fd_groove_data_t` structure.
- **Inputs**:
    - `data`: A pointer to a constant `fd_groove_data_t` structure from which to retrieve the concurrency group hint.
- **Logic and Control Flow**:
    - Accesses the `cgroup_hint` member of the `fd_groove_data_t` structure pointed to by `data`.
    - Returns the value of `cgroup_hint`.
- **Output**: The function returns an `ulong` representing the concurrency group hint.


---
### fd\_groove\_data\_shdata<!-- {{#callable:fd_groove_data_shdata}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L257>)

Calculates and returns a pointer to the shared data memory location for a given `fd_groove_data_t` structure.
- **Inputs**:
    - `data`: A pointer to an `fd_groove_data_t` structure, which contains information about the active slot and other groove data details.
- **Logic and Control Flow**:
    - Subtracts `FD_GROOVE_DATA_ALIGN` from the address of `data->active_slot` to calculate the shared data memory location.
    - Casts the resulting address to a `void *` pointer type.
- **Output**: A `void *` pointer to the calculated shared data memory location.


---
### fd\_groove\_data\_volume0<!-- {{#callable:fd_groove_data_volume0}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L262>)

Returns the base address of the first volume in the volume pool of the given groove data.
- **Inputs**:
    - `data`: A pointer to an `fd_groove_data_t` structure, which contains the volume pool from which the base address of the first volume is retrieved.
- **Logic and Control Flow**:
    - Calls the function `fd_groove_volume_pool_shele` with `data->volume_pool` as the argument.
    - Returns the result of the `fd_groove_volume_pool_shele` function call.
- **Output**: A pointer to the base address of the first volume in the volume pool.


---
### fd\_groove\_data\_volume1<!-- {{#callable:fd_groove_data_volume1}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L267>)

Calculates the end address of the groove data region in the volume pool.
- **Inputs**:
    - `data`: A pointer to an `fd_groove_data_t` structure representing the current local join.
- **Logic and Control Flow**:
    - Retrieve the base address of the volume pool using `fd_groove_volume_pool_shele` with `data->volume_pool`.
    - Calculate the maximum number of elements in the volume pool using `fd_groove_volume_pool_ele_max` with `data->volume_pool`.
    - Add the base address and the maximum number of elements to get the end address of the groove data region.
- **Output**: Returns a `void *` pointer to the end of the groove data region in the volume pool.


---
### fd\_groove\_data\_hdr<!-- {{#callable:fd_groove_data_hdr_t::fd_groove_data_hdr}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L275>)

Encodes various parameters into a `fd_groove_data_hdr_t` structure for groove data objects.
- **Inputs**:
    - `type`: An unsigned long integer representing the magic type, assumed to be in the range [0, 2^16).
    - `idx`: An unsigned long integer representing the object index in the parent, assumed to be in the range [0, 2^6).
    - `szc`: An unsigned long integer representing the object size class, assumed to be in the range [0, 2^7).
    - `align`: An unsigned long integer representing the object alignment, assumed to be in the range [0, 2^10).
    - `sz`: An unsigned long integer representing the object size, assumed to be in the range [0, 2^25).
    - `info`: An unsigned long integer representing arbitrary information.
- **Logic and Control Flow**:
    - Initialize a `fd_groove_data_hdr_t` structure named `hdr`.
    - Calculate the `bits` field by combining `type`, `idx`, `szc`, `align`, and `sz` using bitwise operations and shifts.
    - Assign the `info` parameter to the `info` field of `hdr`.
    - Return the `hdr` structure.
- **Output**: Returns a `fd_groove_data_hdr_t` structure with encoded `bits` and `info` fields.
- **See also**: [`fd_groove_data_hdr_t`](<#fd_groove_data_hdr_t>)  (Data Structure)


---
### fd\_groove\_data\_hdr\_type<!-- {{#callable:fd_groove_data_hdr_type}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L290>)

Extracts the 16-bit magic type from the `bits` field of a `fd_groove_data_hdr_t` structure.
- **Inputs**:
    - `h`: A `fd_groove_data_hdr_t` structure containing the `bits` field from which to extract the magic type.
- **Logic and Control Flow**:
    - Extracts the `bits` field from the input `fd_groove_data_hdr_t` structure `h`.
    - Applies a bitwise AND operation with the constant `65535UL` to isolate the lower 16 bits of the `bits` field.
- **Output**: Returns an `ulong` representing the 16-bit magic type extracted from the `bits` field.


---
### fd\_groove\_data\_hdr\_idx<!-- {{#callable:fd_groove_data_hdr_idx}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L291>)

Extracts the 6-bit object index from the `bits` field of a `fd_groove_data_hdr_t` structure.
- **Inputs**:
    - `h`: A `fd_groove_data_hdr_t` structure containing the `bits` field from which the object index is extracted.
- **Logic and Control Flow**:
    - Shift the `bits` field of `h` right by 16 bits to align the object index to the least significant bits.
    - Apply a bitwise AND operation with `63UL` to isolate the 6-bit object index.
- **Output**: Returns an `ulong` representing the 6-bit object index extracted from the `bits` field.


---
### fd\_groove\_data\_hdr\_szc<!-- {{#callable:fd_groove_data_hdr_szc}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L292>)

Extracts the size class index from a `fd_groove_data_hdr_t` structure.
- **Inputs**:
    - `h`: A `fd_groove_data_hdr_t` structure containing encoded groove data object details.
- **Logic and Control Flow**:
    - Shift the `bits` field of the input `fd_groove_data_hdr_t` structure `h` right by 22 bits.
    - Apply a bitwise AND operation with `127UL` to extract the 7-bit size class index.
- **Output**: Returns an `ulong` representing the size class index, which is a value less than `2^7`.


---
### fd\_groove\_data\_hdr\_align<!-- {{#callable:fd_groove_data_hdr_align}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L293>)

Extracts the alignment value from a `fd_groove_data_hdr_t` structure by shifting and masking its `bits` field.
- **Inputs**:
    - `h`: A `fd_groove_data_hdr_t` structure containing encoded groove data object details.
- **Logic and Control Flow**:
    - Shift the `bits` field of `h` right by 29 positions.
    - Mask the result with `1023UL` to extract the 10-bit alignment value.
- **Output**: Returns an `ulong` representing the alignment value, which is less than `2^10`.


---
### fd\_groove\_data\_hdr\_sz<!-- {{#callable:fd_groove_data_hdr_sz}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L294>)

Extracts the size of a groove data object from a `fd_groove_data_hdr_t` structure.
- **Inputs**:
    - `h`: A `fd_groove_data_hdr_t` structure containing encoded details of a groove data object.
- **Logic and Control Flow**:
    - Right shifts the `bits` field of the input `fd_groove_data_hdr_t` structure by 39 bits.
    - Returns the result of the right shift operation, which represents the size of the groove data object.
- **Output**: An unsigned long integer representing the size of the groove data object, which is less than 2^25.


---
### fd\_groove\_data\_hdr\_info<!-- {{#callable:fd_groove_data_hdr_info}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L295>)

Retrieves the `info` field from a `fd_groove_data_hdr_t` structure.
- **Inputs**:
    - `h`: A `fd_groove_data_hdr_t` structure containing the header information of a groove data object.
- **Logic and Control Flow**:
    - Accesses the `info` field of the `fd_groove_data_hdr_t` structure `h`.
    - Returns the value of the `info` field.
- **Output**: The function returns an `ulong` representing the `info` field of the provided `fd_groove_data_hdr_t` structure.


---
### fd\_groove\_data\_object\_hdr\_const<!-- {{#callable:fd_groove_data_object_hdr_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L319>)

Returns a constant pointer to the header of a groove data object by aligning the given object pointer downwards.
- **Inputs**:
    - ``obj``: A constant pointer to the object whose header is to be retrieved.
- **Logic and Control Flow**:
    - Subtract `FD_GROOVE_DATA_HDR_FOOTPRINT` from the `obj` pointer to account for the header footprint.
    - Align the result downwards to the nearest multiple of `FD_GROOVE_BLOCK_ALIGN` using `fd_ulong_align_dn`.
    - Cast the aligned address to a `fd_groove_data_hdr_t const *` and return it.
- **Output**: A constant pointer to the `fd_groove_data_hdr_t` structure representing the header of the groove data object.


---
### fd\_groove\_data\_superblock\_hdr\_const<!-- {{#callable:fd_groove_data_superblock_hdr_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L324>)

Calculates the constant header pointer for a groove data superblock based on the object pointer, size class, and parent index.
- **Inputs**:
    - ``obj``: A constant pointer to the first byte of the object in the caller's address space.
    - ``obj_szc``: An unsigned long integer representing the object's size class.
    - ``parent_idx``: An unsigned long integer representing the object's index in its parent superblock.
- **Logic and Control Flow**:
    - Aligns the object pointer `obj` downwards by subtracting `FD_GROOVE_DATA_HDR_FOOTPRINT` and aligning to `FD_GROOVE_BLOCK_ALIGN`.
    - Calculates the offset by multiplying `parent_idx` with the footprint of the object size class from `fd_groove_data_szc_cfg` and subtracting `FD_GROOVE_BLOCK_FOOTPRINT`.
    - Returns the calculated address as a constant pointer to `fd_groove_data_hdr_t`.
- **Output**: A constant pointer to `fd_groove_data_hdr_t`, representing the header of the groove data superblock.


---
### fd\_groove\_data\_szc<!-- {{#callable:fd_groove_data_szc}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L338>)

Finds the index of the smallest size class that can accommodate a given footprint.
- **Inputs**:
    - `footprint`: The size of the object footprint to find the size class for.
- **Logic and Control Flow**:
    - Initialize `l` to 0 and `h` to `FD_GROOVE_DATA_SZC_CNT - 1`.
    - Iterate 5 times, assuming `FD_GROOVE_DATA_SZC_CNT` is less than or equal to 32.
    - In each iteration, calculate the midpoint `m` as `(l + h) >> 1`.
    - Check if the size class at index `m` can accommodate the `footprint` by comparing `fd_groove_data_szc_cfg[m].obj_footprint` with `footprint`.
    - Update `l` and `h` using conditional move operations based on the comparison result.
    - After the loop, return `h` as the index of the tightest fitting size class.
- **Output**: Returns the index of the tightest fitting size class for the given footprint, which is an unsigned long integer.


---
### fd\_groove\_data\_volume\_add<!-- {{#callable:fd_groove_data_volume_add}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L370>)

Adds a volume to the groove data's volume pool.
- **Inputs**:
    - ``data``: A pointer to a `fd_groove_data_t` structure representing the groove data.
    - ``volume``: A pointer to the volume to add.
    - ``footprint``: The size of the volume in bytes.
    - ``info``: A pointer to additional information about the volume.
    - ``info_sz``: The size of the additional information in bytes.
- **Logic and Control Flow**:
    - Checks if `data` is not NULL; if it is NULL, passes NULL to [`fd_groove_volume_pool_add`](<fd_groove_volume.c.md#fd_groove_volume_pool_add>) for the volume pool.
    - Calls [`fd_groove_volume_pool_add`](<fd_groove_volume.c.md#fd_groove_volume_pool_add>) with the volume pool from `data`, `volume`, `footprint`, `info`, and `info_sz`.
- **Output**: Returns the result of [`fd_groove_volume_pool_add`](<fd_groove_volume.c.md#fd_groove_volume_pool_add>), which is an integer indicating success or failure.
- **Functions Called**:
    - [`fd_groove_volume_pool_add`](<fd_groove_volume.c.md#fd_groove_volume_pool_add>)


---
### fd\_groove\_data\_volume\_remove<!-- {{#callable:fd_groove_data_volume_remove}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L379>)

Removes a volume from the `volume_pool` of a `fd_groove_data_t` structure.
- **Inputs**:
    - `data`: A pointer to a `fd_groove_data_t` structure, which contains a `volume_pool` from which a volume will be removed.
- **Logic and Control Flow**:
    - Checks if `data` is not NULL; if it is NULL, passes NULL to [`fd_groove_volume_pool_remove`](<fd_groove_volume.c.md#fd_groove_volume_pool_remove>).
    - Calls [`fd_groove_volume_pool_remove`](<fd_groove_volume.c.md#fd_groove_volume_pool_remove>) with `data->volume_pool` if `data` is not NULL, otherwise with NULL.
- **Output**: Returns a pointer to the removed volume from the `volume_pool`, or NULL if `data` is NULL.
- **Functions Called**:
    - [`fd_groove_volume_pool_remove`](<fd_groove_volume.c.md#fd_groove_volume_pool_remove>)


---
### fd\_groove\_data\_free<!-- {{#callable:fd_groove_data_free}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L430>)

Frees a groove data object in the groove data store.
- **Inputs**:
    - ``data``: A pointer to the `fd_groove_data_t` structure representing the groove data store.
    - ``obj``: A pointer to the first byte of the object to be freed in the caller's address space.
- **Logic and Control Flow**:
    - Calls the [`fd_groove_data_private_free`](<fd_groove_data.c.md#fd_groove_data_private_free>) function with `data`, `obj`, and `FD_GROOVE_DATA_HDR_TYPE_ALLOC` as arguments.
    - Returns the result of the [`fd_groove_data_private_free`](<fd_groove_data.c.md#fd_groove_data_private_free>) function call.
- **Output**: Returns `FD_GROOVE_SUCCESS` (0) on success or a negative `FD_GROOVE_ERR` code on failure.
- **Functions Called**:
    - [`fd_groove_data_private_free`](<fd_groove_data.c.md#fd_groove_data_private_free>)


---
### fd\_groove\_data\_alloc\_align<!-- {{#callable:fd_groove_data_alloc_align}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L440>)

Calculates the alignment of a groove data object by retrieving and using its header information.
- **Inputs**:
    - `obj`: A pointer to a constant object in memory, representing the groove data object whose alignment is to be calculated.
- **Logic and Control Flow**:
    - Retrieve the constant header of the groove data object using [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) with the input `obj`.
    - Extract the alignment information from the header using [`fd_groove_data_hdr_align`](<#fd_groove_data_hdr_align>).
    - Return the alignment value.
- **Output**: Returns an unsigned long integer representing the alignment of the groove data object.
- **Functions Called**:
    - [`fd_groove_data_hdr_align`](<#fd_groove_data_hdr_align>)
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)


---
### fd\_groove\_data\_alloc\_sz<!-- {{#callable:fd_groove_data_alloc_sz}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L445>)

Calculates the size of the allocated groove data object based on its header.
- **Inputs**:
    - ``obj``: A pointer to a constant object whose allocated size is to be determined.
- **Logic and Control Flow**:
    - Retrieve the constant header of the groove data object using [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) with `obj` as the argument.
    - Extract the size of the groove data object from the header using [`fd_groove_data_hdr_sz`](<#fd_groove_data_hdr_sz>).
    - Return the extracted size.
- **Output**: Returns an `ulong` representing the size of the allocated groove data object.
- **Functions Called**:
    - [`fd_groove_data_hdr_sz`](<#fd_groove_data_hdr_sz>)
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)


---
### fd\_groove\_data\_alloc\_tag<!-- {{#callable:fd_groove_data_alloc_tag}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L450>)

Retrieves the tag information from a groove data object's header.
- **Inputs**:
    - `obj`: A pointer to a constant object from which to retrieve the tag information.
- **Logic and Control Flow**:
    - Call [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) with `obj` to get a constant pointer to the object's header.
    - Dereference the header pointer to get the header structure.
    - Call [`fd_groove_data_hdr_info`](<#fd_groove_data_hdr_info>) with the header to extract the tag information.
- **Output**: Returns an unsigned long integer representing the tag information of the groove data object.
- **Functions Called**:
    - [`fd_groove_data_hdr_info`](<#fd_groove_data_hdr_info>)
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)


---
### fd\_groove\_data\_alloc\_start<!-- {{#callable:fd_groove_data_alloc_start}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L462>)

Calculates the starting address of a groove data allocation by adding 16 bytes to the header address of the object.
- **Inputs**:
    - ``obj``: A pointer to the object for which the starting address of the allocation is calculated.
- **Logic and Control Flow**:
    - Calls [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) with `obj` to get the constant header address of the object.
    - Casts the header address to an unsigned long and adds 16 to it.
    - Casts the result back to a void pointer and returns it.
- **Output**: A void pointer to the starting address of the groove data allocation.
- **Functions Called**:
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)


---
### fd\_groove\_data\_alloc\_stop<!-- {{#callable:fd_groove_data_alloc_stop}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L467>)

Calculates the end address of a groove data object based on its header and size class configuration.
- **Inputs**:
    - ``obj``: A pointer to the groove data object whose end address is to be calculated.
- **Logic and Control Flow**:
    - Retrieve the constant header of the groove data object using [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) with `obj` as input.
    - Determine the size class of the object by calling [`fd_groove_data_hdr_szc`](<#fd_groove_data_hdr_szc>) with the retrieved header.
    - Access the size class configuration from `fd_groove_data_szc_cfg` using the size class index.
    - Calculate the end address by adding the object's header address to the object's footprint from the size class configuration.
- **Output**: Returns a pointer to the end address of the groove data object.
- **Functions Called**:
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)
    - [`fd_groove_data_hdr_szc`](<#fd_groove_data_hdr_szc>)


---
### fd\_groove\_data\_alloc\_start\_const<!-- {{#callable:fd_groove_data_alloc_start_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L473>)

Calculates the starting address of a groove data allocation by adding 16 bytes to the aligned header address of the object.
- **Inputs**:
    - ``obj``: A constant pointer to the object whose allocation start address is to be calculated.
- **Logic and Control Flow**:
    - Call [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) with `obj` to get the aligned header address of the object.
    - Add 16 bytes to the aligned header address to calculate the start address of the allocation.
- **Output**: A constant pointer to the start address of the groove data allocation.
- **Functions Called**:
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)


---
### fd\_groove\_data\_alloc\_stop\_const<!-- {{#callable:fd_groove_data_alloc_stop_const}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L478>)

Calculates the end address of a groove data object based on its header and size class configuration.
- **Inputs**:
    - ``obj``: A pointer to the first byte of the groove data object in the caller's address space.
- **Logic and Control Flow**:
    - Retrieve the header of the groove data object using [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>) function.
    - Determine the size class of the object by calling [`fd_groove_data_hdr_szc`](<#fd_groove_data_hdr_szc>) with the retrieved header.
    - Access the size class configuration from `fd_groove_data_szc_cfg` using the size class index.
    - Calculate the end address by adding the object's header address to the object's footprint from the size class configuration.
- **Output**: A `void const *` pointer to the end address of the groove data object.
- **Functions Called**:
    - [`fd_groove_data_object_hdr_const`](<#fd_groove_data_object_hdr_const>)
    - [`fd_groove_data_hdr_szc`](<#fd_groove_data_hdr_szc>)


# Function Declarations (Public API)

---
### fd\_groove\_data\_new<!-- {{#callable_declaration:fd_groove_data_new}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L218>)

Formats a memory region into a groove data object.
- **Description**: Use this function to initialize a memory region as a groove data object. The memory region must be aligned according to the requirements of the groove data object and have a sufficient footprint. The function returns the pointer to the memory region on success, indicating that the groove data object has ownership of the memory. If the memory region is null, misaligned, or if there is a configuration issue, the function returns null and logs a warning. The caller is not joined to the groove data object upon return, and the object will contain no volumes or data allocations.
- **Inputs**:
    - `shmem`: Pointer to the memory region to format. Must not be null and must be aligned according to `fd_groove_data_align()`. The caller retains ownership of the pointer, but the groove data object takes ownership of the memory region on success.
- **Output**: Returns the pointer to the memory region on success, or null on failure.
- **See Also**: [`fd_groove_data_new`](<fd_groove_data.c.md#fd_groove_data_new>)  (Implementation)


---
### fd\_groove\_data\_join<!-- {{#callable_declaration:fd_groove_data_join}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L219>)

Joins a groove data object to a local memory region.
- **Description**: Use this function to join a groove data object to a local memory region, allowing access to the groove data's state. Ensure that the memory regions pointed to by `ljoin`, `shdata`, and `volume0` are properly aligned and non-null. The function will configure the local join with the provided concurrency group hint and map the specified number of volumes. If any input is invalid or misaligned, the function logs a warning and returns NULL.
- **Inputs**:
    - `ljoin`: Pointer to a memory region in the caller's address space for the local join's state. Must not be null and must be aligned to `fd_groove_data_t` alignment. Invalid input results in a warning and NULL return.
    - `shdata`: Pointer to the memory region containing the groove data. Must not be null and must be aligned to `fd_groove_data_align()`. Invalid input results in a warning and NULL return.
    - `volume0`: Pointer to the caller's address space reserved for mapping groove volumes. Must not be null and must be aligned to `fd_groove_volume_t` alignment. Invalid input results in a warning and NULL return.
    - `volume_max`: Maximum number of volumes that can be mapped starting at `volume0`. If zero, a maximal default is used. Must be a valid unsigned long value.
    - `cgroup_hint`: Concurrency group hint for the join. Must be a valid unsigned long value.
- **Output**: Returns a pointer to the local join on success, or NULL on failure. Logs details on failure.
- **See Also**: [`fd_groove_data_join`](<fd_groove_data.c.md#fd_groove_data_join>)  (Implementation)


---
### fd\_groove\_data\_leave<!-- {{#callable_declaration:fd_groove_data_leave}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L220>)

Leaves a groove data join and returns the memory used for the join.
- **Description**: Use this function to leave a current local join of a groove data object. It must be called when the join is no longer needed, allowing the caller to reclaim the memory used for the join. Ensure that the `join` parameter is not null before calling this function. If the function fails, it logs a warning and returns null, indicating that the join was not left successfully.
- **Inputs**:
    - `join`: A pointer to a `fd_groove_data_t` structure representing the current local join. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a pointer to the memory used for the local join on success, allowing the caller to reclaim it. Returns null on failure, indicating the join was not left.
- **See Also**: [`fd_groove_data_leave`](<fd_groove_data.c.md#fd_groove_data_leave>)  (Implementation)


---
### fd\_groove\_data\_delete<!-- {{#callable_declaration:fd_groove_data_delete}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L221>)

Unformats a memory region used as a groove data object.
- **Description**: Use this function to release a memory region previously formatted as a groove data object. Ensure that the memory region is not currently joined by any process globally before calling this function. This function returns the memory region to the caller, who then regains ownership of the memory and any associated volumes or data objects. If the function fails, it logs the error and does not change ownership.
- **Inputs**:
    - `shdata`: A pointer to the memory region containing the groove data object. Must not be null, must be aligned according to `fd_groove_data_align()`, and must have a valid magic number (`FD_GROOVE_DATA_MAGIC`). If these conditions are not met, the function logs a warning and returns null.
- **Output**: Returns the input pointer `shdata` on success, indicating the caller has regained ownership. Returns null on failure, with no change in ownership.
- **See Also**: [`fd_groove_data_delete`](<fd_groove_data.c.md#fd_groove_data_delete>)  (Implementation)


---
### fd\_groove\_data\_alloc<!-- {{#callable_declaration:fd_groove_data_alloc}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L404>)

Allocates a groove data object with specified alignment, size, and tag.
- **Description**: Use this function to create a groove data object in the groove data store with a specified alignment, size, and user-defined tag. The function requires that the `data` parameter is a current local join. The alignment must be a power of 2 and not exceed `FD_GROOVE_DATA_ALLOC_ALIGN_MAX`, or it can be 0 to use the default alignment. The function returns a pointer to the allocated object, which remains valid until the object is freed or the data store is destroyed. If the allocation fails, the function returns NULL and sets an error code in `_opt_err` if it is not NULL. Common reasons for failure include invalid input arguments or insufficient space in the groove data store.
- **Inputs**:
    - `data`: A pointer to a `fd_groove_data_t` structure representing the current local join. Must not be NULL.
    - `align`: The desired alignment for the allocation, which must be a power of 2 and not exceed `FD_GROOVE_DATA_ALLOC_ALIGN_MAX`. If 0, the default alignment is used.
    - `sz`: The size of the allocation in bytes. Must be less than or equal to `FD_GROOVE_DATA_ALLOC_FOOTPRINT_MAX`.
    - `tag`: An arbitrary user-defined tag associated with the allocation.
    - `_opt_err`: A pointer to an integer where the function will store an error code if the allocation fails. Can be NULL if the caller does not need error information.
- **Output**: Returns a pointer to the allocated object on success, or NULL on failure. If `_opt_err` is provided, it will contain an error code indicating the reason for failure.
- **See Also**: [`fd_groove_data_alloc`](<fd_groove_data.c.md#fd_groove_data_alloc>)  (Implementation)


---
### fd\_groove\_data\_private\_free<!-- {{#callable_declaration:fd_groove_data_private_free}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L425>)

Frees a groove data object.
- **Description**: Use this function to free a previously allocated groove data object. Ensure that the `data` and `obj` parameters are not null before calling. The function checks if the object is valid and marks it as free. It handles various error conditions, such as invalid inputs or potential data corruption, and logs warnings if necessary. This function is intended for internal use and should be used with caution to avoid double frees or corruption.
- **Inputs**:
    - `data`: A pointer to a `fd_groove_data_t` structure representing the groove data context. Must not be null. The caller retains ownership.
    - `obj`: A pointer to the object to be freed. Must not be null. The caller retains ownership.
    - `exp_type`: An unsigned long representing the expected type of the object. This is used for validation purposes.
- **Output**: Returns an integer indicating success or failure. `FD_GROOVE_SUCCESS` (0) on success, or a negative error code on failure, such as `FD_GROOVE_ERR_INVAL` for invalid inputs or `FD_GROOVE_ERR_CORRUPT` for data corruption.
- **See Also**: [`fd_groove_data_private_free`](<fd_groove_data.c.md#fd_groove_data_private_free>)  (Implementation)


---
### fd\_groove\_data\_verify<!-- {{#callable_declaration:fd_groove_data_verify}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L493>)

Verifies the integrity of a groove data instance.
- **Description**: Use this function to check if a groove data instance is valid and correctly configured. It verifies the join, the data volume pool, and the active and inactive superblocks. This function assumes that the groove data is idle and that the join is a current local join. It does not verify the entire contents of all volumes, but ensures that the structure and configuration of the groove data are correct.
- **Inputs**:
    - `data`: A pointer to a `fd_groove_data_t` structure representing the groove data instance to verify. Must not be null and must be aligned according to the alignment requirements of `fd_groove_data_t`. If the pointer is invalid or misaligned, the function will not proceed with verification.
- **Output**: Returns `FD_GROOVE_SUCCESS` if the groove data instance is valid. Returns `FD_GROOVE_ERR_CORRUPT` if the instance is invalid, with details logged.
- **See Also**: [`fd_groove_data_verify`](<fd_groove_data.c.md#fd_groove_data_verify>)  (Implementation)


---
### fd\_groove\_data\_volume\_verify<!-- {{#callable_declaration:fd_groove_data_volume_verify}} -->
[View Source →](<../../../../src/groove/fd_groove_data.h#L503>)

Verifies the integrity of a groove volume.
- **Description**: Use this function to check if a groove volume mapped into the caller's address space is valid. It must be called when the groove data is idle and assumes that the caller has a current local join. The function can be used in parallel to verify multiple volumes simultaneously, which is useful for large data sets.
- **Inputs**:
    - `data`: A pointer to a `fd_groove_data_t` structure representing the current local join. Must not be null.
    - `_volume`: A pointer to a `fd_groove_volume_t` structure representing the groove volume to verify. Must not be null and must point to a valid memory region within the groove data's volume range.
- **Output**: Returns `FD_GROOVE_SUCCESS` if the volume is valid, or `FD_GROOVE_ERR_CORRUPT` if the volume is invalid.
- **See Also**: [`fd_groove_data_volume_verify`](<fd_groove_data.c.md#fd_groove_data_volume_verify>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)