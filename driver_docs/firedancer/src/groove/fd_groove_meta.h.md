<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a 64-bit bitfield for groove key metadata and provides functions to manipulate it.

# Purpose
The code is a C header file that defines the metadata management for a key-value storage system, specifically focusing on the `fd_groove_meta` structure. It provides a compact representation of metadata using a 64-bit bitfield to store various attributes related to the keys, such as whether a key is used, if its value is stored in a cold or hot store, and the size and maximum size of the value. The bitfield is manipulated using a set of inline functions that pack and unpack these attributes, allowing efficient access and modification of the metadata.

Additionally, the file defines a structure `fd_groove_meta` that includes a key, the metadata bitfield, and an offset for the value in the cold store. It also sets up a map implementation for managing these metadata entries, using macros to define the map's behavior, such as checking if an element is free, freeing an element, and moving elements. The map is designed to handle concurrency with a defined maximum number of locks and includes a versioning system. The file includes another source file, `fd_map_slot_para.c`, which likely provides the implementation details for the map operations.
# Imports and Dependencies

---
- `fd_groove_base.h`
- `../util/tmpl/fd_map_slot_para.c`


# Data Structures

---
### fd\_groove\_meta\_t
- **Type**: ``struct``
- **Members**:
    - ``key``: Holds the key associated with the metadata.
    - ``bits``: Contains a 64-bit wide bitfield for storing metadata about the key.
    - ``val_off``: Indicates the offset in the cold store where the key's value is stored.
- **Description**: `fd_groove_meta_t` is a structure that encapsulates metadata for a key in a groove system. It uses a 64-bit bitfield to store various metadata attributes such as whether the key is used, and if its value is stored in a cold or hot store. The `val_off` member specifies the offset in the cold store where the value is located, ensuring that the value and its reserved space are within the cold store's address space.


# Functions

---
### fd\_groove\_meta\_bits<!-- {{#callable:fd_groove_meta_bits}} -->
[View Source →](<../../../../src/groove/fd_groove_meta.h#L28>)

Packs metadata components into a 64-bit bitfield for groove key metadata.
- **Inputs**:
    - `used`: An integer indicating if the map slot contains a key-meta pair; 0 for not used, non-zero for used.
    - `cold`: An integer indicating if the value for the key is present in the cold store; 0 for not present, non-zero for present.
    - `hot`: An integer indicating if the value for the key is present in the hot store; 0 for not present, non-zero for present.
    - `val_sz`: An unsigned long representing the number of bytes for the key's value, assumed to be in the range [0, 2^24).
    - `val_max`: An unsigned long representing the maximum number of bytes for the key's value, assumed to be in the range [0, 2^24).
- **Logic and Control Flow**:
    - Convert `used` to a boolean and cast to `ulong`, then place it in bit position 0.
    - Convert `cold` to a boolean and cast to `ulong`, then shift left by 1 and place it in bit position 1.
    - Convert `hot` to a boolean and cast to `ulong`, then shift left by 2 and place it in bit position 2.
    - Shift `val_sz` left by 16 bits and place it in bit positions 16 to 39.
    - Shift `val_max` left by 40 bits and place it in bit positions 40 to 63.
    - Combine all the above components using bitwise OR to form the final 64-bit bitfield.
- **Output**: Returns a 64-bit unsigned long representing the packed bitfield of the groove key metadata.


---
### fd\_groove\_meta\_bits\_used<!-- {{#callable:fd_groove_meta_bits_used}} -->
[View Source →](<../../../../src/groove/fd_groove_meta.h#L37>)

Extracts the 'used' status from a 64-bit metadata bitfield.
- **Inputs**:
    - `bits`: A 64-bit unsigned long integer representing the metadata bitfield.
- **Logic and Control Flow**:
    - Perform a bitwise AND operation between `bits` and `1UL` to isolate the least significant bit.
    - Cast the result to an integer to obtain the 'used' status.
- **Output**: An integer value of 0 or 1 indicating whether the 'used' bit is set in the metadata bitfield.


---
### fd\_groove\_meta\_bits\_cold<!-- {{#callable:fd_groove_meta_bits_cold}} -->
[View Source →](<../../../../src/groove/fd_groove_meta.h#L38>)

Extracts the 'cold' bit from a 64-bit metadata bitfield.
- **Inputs**:
    - `bits`: A 64-bit unsigned long integer representing the metadata bitfield.
- **Logic and Control Flow**:
    - Shift the input `bits` right by 1 position.
    - Perform a bitwise AND operation with `1UL` to isolate the 'cold' bit.
    - Cast the result to an integer and return it.
- **Output**: An integer value of 0 or 1, indicating whether the 'cold' bit is set in the metadata bitfield.


---
### fd\_groove\_meta\_bits\_hot<!-- {{#callable:fd_groove_meta_bits_hot}} -->
[View Source →](<../../../../src/groove/fd_groove_meta.h#L39>)

Extracts the 'hot' bit from a 64-bit metadata bitfield.
- **Inputs**:
    - `bits`: A 64-bit unsigned long integer representing the metadata bitfield.
- **Logic and Control Flow**:
    - Shift the input `bits` right by 2 positions.
    - Perform a bitwise AND operation with `1UL` to isolate the 'hot' bit.
    - Cast the result to an integer and return it.
- **Output**: An integer value of 0 or 1, indicating whether the 'hot' bit is set in the metadata bitfield.


---
### fd\_groove\_meta\_bits\_val\_sz<!-- {{#callable:fd_groove_meta_bits_val_sz}} -->
[View Source →](<../../../../src/groove/fd_groove_meta.h#L40>)

Extracts the `val_sz` field from a 64-bit metadata bitfield.
- **Inputs**:
    - `bits`: A 64-bit unsigned long integer representing the metadata bitfield.
- **Logic and Control Flow**:
    - Shift the `bits` value 16 positions to the right to align the `val_sz` field with the least significant bits.
    - Apply a bitwise AND operation with `16777215UL` (which is `0xFFFFFF` in hexadecimal) to isolate the 24-bit `val_sz` field.
- **Output**: Returns the 24-bit `val_sz` field as an unsigned long integer, representing the number of bytes for the key's value.


---
### fd\_groove\_meta\_bits\_val\_max<!-- {{#callable:fd_groove_meta_bits_val_max}} -->
[View Source →](<../../../../src/groove/fd_groove_meta.h#L41>)

Extracts the `val_max` field from a 64-bit metadata bitfield by right-shifting 40 bits.
- **Inputs**:
    - `bits`: A 64-bit unsigned long integer representing the metadata bitfield.
- **Logic and Control Flow**:
    - Right-shift the `bits` input by 40 bits to isolate the `val_max` field.
- **Output**: Returns the `val_max` field as an unsigned long integer, representing the maximum number of bytes for a key's value.



---
Made with ❤️ by [Driver](https://www.driver.ai/)