<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tracks and prints metadata for the last 256 slots in a circular buffer for repair metrics.

# Purpose
The code defines a C header file for managing and tracking repair metrics in a system. It provides a structure, `fd_repair_metrics_t`, which acts as a circular buffer to store metadata for the last 256 slots. Each slot is represented by the `fd_slot_metrics_t` structure, which records the slot number, timestamps for the start and completion of the slot, and counts for repairs and turbines. The primary purpose of this module is to facilitate the generation of a waterfall diagram that visualizes the progress of repair metrics.

The header file declares several functions for interacting with the repair metrics. These include [`fd_repair_metrics_new`](<#fd_repair_metrics_new>) for creating a new metrics object, [`fd_repair_metrics_join`](<#fd_repair_metrics_join>) for associating with an existing metrics object, and [`fd_repair_metrics_set_turbine_slot0`](<#fd_repair_metrics_set_turbine_slot0>) for setting a reference slot number. Additionally, [`fd_repair_metrics_print`](<#fd_repair_metrics_print>) is used to output the metrics, and [`fd_repair_metrics_add_slot`](<#fd_repair_metrics_add_slot>) is used to add a new slot's data to the buffer. The file also includes utility functions to determine the alignment and memory footprint of the metrics structures.
# Imports and Dependencies

---
- `../../util/fd_util_base.h`


# Data Structures

---
### fd\_slot\_metrics
- **Type**: ``struct``
- **Members**:
    - `slot`: Stores the slot number as an unsigned long integer.
    - `first_ts`: Records the first timestamp as a long integer.
    - `slot_complete_ts`: Holds the timestamp when the slot is complete, marked as a tick, as a long integer.
    - `repair_cnt`: Counts the number of repairs as an unsigned integer.
    - `turbine_cnt`: Counts the number of turbines as an unsigned integer.
- **Description**: Tracks metrics for a specific slot, including timestamps for the start and completion of the slot, and counts of repairs and turbines associated with the slot.


---
### fd\_slot\_metrics\_t
- **Type**: ``struct``
- **Members**:
    - `slot`: Stores the slot number.
    - `first_ts`: Records the timestamp when the slot processing started.
    - `slot_complete_ts`: Records the timestamp when the slot processing completed.
    - `repair_cnt`: Counts the number of repairs performed in the slot.
    - `turbine_cnt`: Counts the number of turbines processed in the slot.
- **Description**: Tracks metadata for individual slots, including timing and count metrics, to facilitate the generation of a waterfall diagram for repair progress.


---
### fd\_repair\_metrics\_t
- **Type**: ``struct``
- **Members**:
    - `slots`: An array of `fd_slot_metrics_t` structures that stores metadata for the last 256 slots.
    - `st`: An unsigned integer that indicates the start index of the circular buffer.
    - `en`: An unsigned integer that indicates the end index of the circular buffer.
    - `turbine_slot0`: An unsigned long integer that stores the initial turbine slot number.
- **Description**: Tracks metadata for the N most recent slots, specifically the time taken to complete each slot, using a circular buffer with a fixed size of 256 slots. This data structure is used to print a waterfall diagram of the repair metrics progress.


# Functions

---
### fd\_repair\_metrics\_align<!-- {{#callable:fd_repair_metrics_align}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L32>)

Returns the alignment requirement of the `fd_slot_metrics_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Use the `alignof` operator to determine the alignment requirement of the `fd_slot_metrics_t` structure.
    - Return the alignment value.
- **Output**: The function returns an `ulong` representing the alignment requirement of the `fd_slot_metrics_t` structure.


---
### fd\_repair\_metrics\_footprint<!-- {{#callable:fd_repair_metrics_footprint}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L37>)

Calculates the memory footprint of the `fd_repair_metrics_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Return the size of the `fd_repair_metrics_t` structure using the `sizeof` operator.
- **Output**: The function returns an `ulong` representing the size of the `fd_repair_metrics_t` structure in bytes.


# Function Declarations (Public API)

---
### fd\_repair\_metrics\_new<!-- {{#callable_declaration:fd_repair_metrics_new}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L42>)

Initializes a new repair metrics structure.
- **Description**: Use this function to initialize a new `fd_repair_metrics_t` structure in the provided memory. This function sets the initial state of the repair metrics, preparing it for tracking metadata on the most recent slots. Ensure that the memory provided is large enough to hold an `fd_repair_metrics_t` structure. This function does not allocate memory; it only initializes the structure at the given memory location.
- **Inputs**:
    - `mem`: A pointer to a memory block where the `fd_repair_metrics_t` structure will be initialized. The memory must be large enough to hold the structure. The caller retains ownership of the memory. If `mem` is null or not properly aligned, behavior is undefined.
- **Output**: Returns a pointer to the initialized `fd_repair_metrics_t` structure.
- **See Also**: [`fd_repair_metrics_new`](<fd_repair_metrics.c.md#fd_repair_metrics_new>)  (Implementation)


---
### fd\_repair\_metrics\_join<!-- {{#callable_declaration:fd_repair_metrics_join}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L45>)

Casts a pointer to a `fd_repair_metrics_t` type.
- **Description**: Use this function to convert a generic pointer to a `fd_repair_metrics_t` pointer. This is typically used when you have a pointer to memory that is known to contain a `fd_repair_metrics_t` structure and you need to work with it as such. Ensure that the input pointer is valid and points to a properly aligned and initialized `fd_repair_metrics_t` structure to avoid undefined behavior.
- **Inputs**:
    - `repair_metrics`: A pointer to memory that is expected to contain a `fd_repair_metrics_t` structure. The pointer must be valid and properly aligned. The caller retains ownership of the memory.
- **Output**: Returns a pointer to `fd_repair_metrics_t` cast from the input pointer.
- **See Also**: [`fd_repair_metrics_join`](<fd_repair_metrics.c.md#fd_repair_metrics_join>)  (Implementation)


---
### fd\_repair\_metrics\_set\_turbine\_slot0<!-- {{#callable_declaration:fd_repair_metrics_set_turbine_slot0}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L48>)

Sets the turbine slot index in the repair metrics.
- **Description**: Use this function to update the `turbine_slot0` field in a `fd_repair_metrics_t` structure. This field typically represents the index of the first turbine slot in the repair metrics. Ensure that the `repair_metrics` pointer is valid and points to an initialized `fd_repair_metrics_t` structure before calling this function. This function does not perform any validation on the `turbine_slot0` value, so it is the caller's responsibility to provide a meaningful value.
- **Inputs**:
    - `repair_metrics`: A pointer to a `fd_repair_metrics_t` structure. Must not be null and should point to a valid, initialized structure.
    - `turbine_slot0`: An unsigned long value representing the turbine slot index to set. No validation is performed on this value.
- **Output**: None
- **See Also**: [`fd_repair_metrics_set_turbine_slot0`](<fd_repair_metrics.c.md#fd_repair_metrics_set_turbine_slot0>)  (Implementation)


---
### fd\_repair\_metrics\_print<!-- {{#callable_declaration:fd_repair_metrics_print}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L51>)

Prints a waterfall diagram of repair metrics.
- **Description**: Use this function to display a visual representation of the repair metrics for the most recent slots. It prints a stacked depth chart showing the duration of each slot, with optional verbose output that includes repair and turbine counts. This function must be called with a valid `fd_repair_metrics_t` structure that has been properly initialized and populated with slot data. The `verbose` parameter controls the level of detail in the output. The function outputs directly to the standard output and flushes it after printing.
- **Inputs**:
    - `repair_metrics`: A pointer to an `fd_repair_metrics_t` structure containing the slot metrics to print. Must not be null and should be initialized with valid data.
    - `verbose`: An integer flag that controls the verbosity of the output. If non-zero, additional details about repair and turbine counts are included in the output.
- **Output**: None
- **See Also**: [`fd_repair_metrics_print`](<fd_repair_metrics.c.md#fd_repair_metrics_print>)  (Implementation)


---
### fd\_repair\_metrics\_add\_slot<!-- {{#callable_declaration:fd_repair_metrics_add_slot}} -->
[View Source →](<../../../../../src/discof/repair/fd_repair_metrics.h#L54>)

Adds a slot's metrics to the repair metrics data structure.
- **Description**: Use this function to record the metrics of a slot in the repair metrics data structure. It stores information about the slot, including timestamps and counts, in a circular buffer. This function must be called with a valid `fd_repair_metrics_t` structure. The function updates the buffer in a circular manner, overwriting the oldest data if the buffer is full. Ensure that the `repair_metrics` structure is properly initialized before calling this function.
- **Inputs**:
    - `repair_metrics`: A pointer to an `fd_repair_metrics_t` structure where the slot metrics will be stored. Must not be null and must point to a valid, initialized structure.
    - `slot`: An unsigned long integer representing the slot identifier. There are no specific constraints on its value.
    - `first_ts`: A long integer representing the timestamp when the slot was first encountered. There are no specific constraints on its value.
    - `slot_complete_ts`: A long integer representing the timestamp when the slot was completed. There are no specific constraints on its value.
    - `repair_cnt`: An unsigned integer representing the count of repairs for the slot. There are no specific constraints on its value.
    - `turbine_cnt`: An unsigned integer representing the count of turbines for the slot. There are no specific constraints on its value.
- **Output**: None
- **See Also**: [`fd_repair_metrics_add_slot`](<fd_repair_metrics.c.md#fd_repair_metrics_add_slot>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)