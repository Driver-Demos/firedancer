<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for various functionalities of the `fd_forest` data structure, including insertion, publishing, and iteration.

# Purpose
The code is a C source file that implements a series of tests for a data structure referred to as a "forest," which is likely a tree-like structure used for managing data blocks and their relationships. The file includes functions to test various operations on this forest, such as inserting data shreds, managing frontiers, handling forks, and verifying the integrity of the forest structure. The tests cover scenarios like publishing data, handling incremental updates, managing out-of-order data, and dealing with forks and orphaned nodes. The code also includes functions to print the forest structure and verify its correctness after operations.

The file defines several test functions, such as [`test_publish`](<#test_publish>), [`test_publish_incremental`](<#test_publish_incremental>), [`test_out_of_order`](<#test_out_of_order>), [`test_forks`](<#test_forks>), and others, each designed to validate specific aspects of the forest's behavior. These functions use a workspace (`fd_wksp_t`) to allocate memory for the forest and perform operations like inserting data shreds and FEC (Forward Error Correction) blocks. The tests ensure that the forest maintains its expected structure and behavior under various conditions, such as when data is inserted out of order or when the forest is branched. The main function initializes the test environment and executes all the test functions to validate the forest's implementation.
# Imports and Dependencies

---
- `fd_forest.h`
- `stdarg.h`
- `../../util/tmpl/fd_sort.c`


# Data Structures

---
### iter\_order
- **Type**: ``struct``
- **Members**:
    - `slot`: Stores an unsigned long integer representing a slot identifier.
    - `idx`: Stores an unsigned integer representing an index.
- **Description**: Defines a structure with two members, `slot` and `idx`, used to represent an iteration order with a slot identifier and an index.


---
### iter\_order\_t
- **Type**: ``struct``
- **Members**:
    - `slot`: An `ulong` representing the slot number in the forest.
    - `idx`: A `uint` representing the index within the slot.
- **Description**: `iter_order_t` is a structure that holds information about a specific slot and its index within a forest data structure. It is used to track the order of iteration over elements in a forest, where each element is identified by a slot number and an index. This structure is useful for iterating over a sequence of elements in a specific order, such as during traversal or processing of a forest.


# Functions

---
### fd\_forest\_blk\_data\_shred\_insert<!-- {{#callable:fd_forest_blk_data_shred_insert}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L18>)

Inserts a data shred into a forest block and returns the resulting block.
- **Inputs**:
    - ``forest``: A pointer to the `fd_forest_t` structure representing the forest where the block will be inserted.
    - ``slot``: An unsigned long integer representing the slot where the block will be inserted.
    - ``parent_slot``: An unsigned long integer representing the parent slot of the block to be inserted.
    - ``shred_idx``: An unsigned integer representing the index of the shred to be inserted.
    - ``fec_set_idx``: An unsigned integer representing the index of the FEC set.
    - ``data_complete``: An integer indicating if the data is complete; this parameter is unused.
    - ``slot_complete``: An integer indicating if the slot is complete.
- **Logic and Control Flow**:
    - Calls [`fd_forest_blk_insert`](<fd_forest.c.md#fd_forest_blk_insert>) to insert a block into the forest at the specified `slot` and `parent_slot`.
    - Calls [`fd_forest_data_shred_insert`](<fd_forest.c.md#fd_forest_data_shred_insert>) to insert a data shred into the forest block with the given parameters, including `shred_idx`, `fec_set_idx`, and `slot_complete`.
    - Returns the result of [`fd_forest_data_shred_insert`](<fd_forest.c.md#fd_forest_data_shred_insert>).
- **Output**: Returns a pointer to the `fd_forest_blk_t` structure representing the inserted block.
- **Functions Called**:
    - [`fd_forest_blk_insert`](<fd_forest.c.md#fd_forest_blk_insert>)
    - [`fd_forest_data_shred_insert`](<fd_forest.c.md#fd_forest_data_shred_insert>)


---
### fd\_forest\_blk\_fec\_insert<!-- {{#callable:fd_forest_blk_fec_insert}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L24>)

Inserts a block into a forest structure and then inserts a FEC (Forward Error Correction) block with additional parameters.
- **Inputs**:
    - ``forest``: A pointer to the `fd_forest_t` structure representing the forest where the block will be inserted.
    - ``slot``: An unsigned long integer representing the slot number where the block will be inserted.
    - ``parent_slot``: An unsigned long integer representing the parent slot number of the block to be inserted.
    - ``last_shred_idx``: An unsigned integer representing the index of the last shred in the FEC set.
    - ``fec_set_idx``: An unsigned integer representing the index of the FEC set.
    - ``slot_complete``: An integer indicating whether the slot is complete (non-zero) or not (zero).
- **Logic and Control Flow**:
    - Calls [`fd_forest_blk_insert`](<fd_forest.c.md#fd_forest_blk_insert>) to insert a block into the forest at the specified `slot` and `parent_slot`.
    - Calls [`fd_forest_fec_insert`](<fd_forest.c.md#fd_forest_fec_insert>) to insert a FEC block into the forest with the given parameters, including `last_shred_idx`, `fec_set_idx`, and `slot_complete`.
- **Output**: Returns a pointer to the `fd_forest_blk_t` structure representing the inserted FEC block.
- **Functions Called**:
    - [`fd_forest_blk_insert`](<fd_forest.c.md#fd_forest_blk_insert>)
    - [`fd_forest_fec_insert`](<fd_forest.c.md#fd_forest_fec_insert>)


---
### setup\_preorder<!-- {{#callable:setup_preorder}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L30>)

Initializes a forest and inserts a predefined sequence of data shreds into it, then verifies and prints the forest structure.
- **Inputs**:
    - ``forest``: A pointer to an `fd_forest_t` structure that represents the forest to initialize and populate.
- **Logic and Control Flow**:
    - Call [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>) to initialize the forest with a root slot of 0.
    - Insert data shreds into the forest using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>) for slots 1, 2, 4, 3, 5, and 6, establishing a specific tree structure.
    - Verify the integrity of the forest using [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>) and assert that it returns false, indicating no errors.
    - Print the forest structure using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>).
    - Return the pointer to the initialized and populated forest.
- **Output**: Returns the pointer to the initialized and populated `fd_forest_t` structure.
- **Functions Called**:
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)


---
### test\_publish<!-- {{#callable:test_publish}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L57>)

Tests the publishing functionality of a forest structure using predefined test cases.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Defines an array `publish_test_cases` with two test cases: 2 and 3.
    - Iterates over each test case in `publish_test_cases`.
    - For each test case, allocates memory in the workspace using `fd_wksp_alloc_laddr`.
    - Initializes a new forest structure with the allocated memory and a maximum element count of 8.
    - Joins the newly created forest and verifies its successful creation.
    - Publishes the forest using the current test case from `publish_test_cases`.
    - Verifies the integrity of the forest after publishing using [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>).
    - Prints the forest structure using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>).
    - Frees the allocated memory for the forest structure.
- **Output**: No return value; the function performs tests and prints results to the console.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_publish`](<fd_forest.c.md#fd_forest_publish>)
    - [`setup_preorder`](<#setup_preorder>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)
    - [`fd_forest_delete`](<fd_forest.c.md#fd_forest_delete>)
    - [`fd_forest_leave`](<fd_forest.c.md#fd_forest_leave>)
    - [`fd_forest_fini`](<fd_forest.c.md#fd_forest_fini>)


---
### test\_publish\_incremental<!-- {{#callable:test_publish_incremental}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L94>)

Tests the complications introduced by loading two incremental snapshots in a forest data structure.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for a forest data structure with a maximum of 32 elements.
    - Initialize the forest and insert a data shred into a non-existent slot (11) with parent slot 10.
    - Publish the forest with a new root at slot 1 and verify the root slot and queries for consumed, frontier, and subtrees.
    - Insert forward error correction (FEC) blocks into the forest to create a frontier at slot 3 and publish it, verifying the root slot and queries.
    - Insert data shreds to extend the ancestry and publish a new root at slot 6, verifying the root slot and queries.
    - Insert a data shred into an orphan slot (9) and publish a new root at slot 10, verifying the root slot and queries.
    - Insert data shreds to create a non-head orphan slot (16) and publish a new root at slot 15, verifying the root slot and queries.
- **Output**: No return value; the function performs tests and assertions on the forest data structure.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_publish`](<fd_forest.c.md#fd_forest_publish>)
    - [`fd_forest_root_slot`](<fd_forest.h.md#fd_forest_root_slot>)
    - [`fd_forest_query`](<fd_forest.c.md#fd_forest_query>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)


---
### consumed\_arr<!-- {{#callable:consumed_arr}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L222>)

Allocates and returns a sorted array of consumed slots from a forest structure.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
    - ``forest``: A pointer to a `fd_forest_t` structure representing the forest from which consumed slots are extracted.
- **Logic and Control Flow**:
    - Retrieve constant pointers to the consumed, conspool, and pool structures from the forest.
    - Determine the number of used slots in the pool using `fd_forest_pool_used`.
    - Verify the integrity of the forest frontier using `fd_forest_frontier_verify`.
    - Allocate memory for an array of unsigned long integers (`ulong`) using `fd_wksp_alloc_laddr`, with size based on the number of used slots.
    - Initialize an iterator for the consumed slots and iterate through them, storing each slot in the allocated array.
    - Ensure the index does not exceed the count of used slots with `FD_TEST`.
    - Fill any remaining slots in the array with `ULONG_MAX`.
    - Sort the array in place using `sort_inplace`.
- **Output**: A pointer to a sorted array of `ulong` integers representing the consumed slots, with unused slots filled with `ULONG_MAX`.
- **Functions Called**:
    - [`fd_forest_consumed_const`](<fd_forest.h.md#fd_forest_consumed_const>)
    - [`fd_forest_conspool_const`](<fd_forest.h.md#fd_forest_conspool_const>)
    - [`fd_forest_pool_const`](<fd_forest.h.md#fd_forest_pool_const>)
    - [`fd_forest_frontier_const`](<fd_forest.h.md#fd_forest_frontier_const>)


---
### test\_out\_of\_order<!-- {{#callable:test_out_of_order}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L243>)

Tests the behavior of a forest data structure when data is inserted out of order and verifies the integrity of the structure.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` and initialize it with [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>) and [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>).
    - Initialize the forest with [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>).
    - Insert data shreds into the forest using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>) and [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>) in a specific order to simulate out-of-order data arrival.
    - Print the forest state using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>) after each set of insertions to observe changes.
    - Retrieve and verify the consumed array using [`consumed_arr`](<#consumed_arr>) and check its contents with `FD_TEST`.
    - Verify the integrity of the forest with [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>) after each operation.
    - Free allocated memory using `fd_wksp_free_laddr` and clean up the forest with [`fd_forest_delete`](<fd_forest.c.md#fd_forest_delete>), [`fd_forest_leave`](<fd_forest.c.md#fd_forest_leave>), and [`fd_forest_fini`](<fd_forest.c.md#fd_forest_fini>).
- **Output**: No return value; the function performs tests and assertions to verify the forest's behavior and integrity.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)
    - [`consumed_arr`](<#consumed_arr>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)
    - [`fd_forest_delete`](<fd_forest.c.md#fd_forest_delete>)
    - [`fd_forest_leave`](<fd_forest.c.md#fd_forest_leave>)
    - [`fd_forest_fini`](<fd_forest.c.md#fd_forest_fini>)


---
### test\_forks<!-- {{#callable:test_forks}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L338>)

Tests the behavior of a forest data structure by inserting data and FEC shreds, advancing the frontier, and verifying the consumed elements.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` and initialize it with [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>) and [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>).
    - Initialize the forest with [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>) and insert data shreds into slots using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>).
    - Verify the frontier is at slot 1 using `fd_forest_consumed_ele_query`.
    - Iterate over consumed elements using `fd_forest_consumed_iter_init`, `fd_forest_consumed_iter_done`, and `fd_forest_consumed_iter_next`, counting the elements.
    - Advance the frontier to slot 3 by inserting FEC shreds with [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>).
    - Add a new fork off slot 1 and verify the frontier is at slot 5.
    - Add a fork off an orphan slot and verify the count of consumed elements remains consistent.
    - Print the forest structure using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>).
- **Output**: No return value; the function performs tests and assertions on the forest structure.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)


---
### test\_print\_tree<!-- {{#callable:test_print_tree}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L414>)

Initializes a forest data structure, inserts a series of data shreds to form a tree, verifies the structure, and prints the tree.
- **Inputs**:
    - ``wksp``: A pointer to a workspace (`fd_wksp_t`) used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` with alignment and footprint based on `ele_max`.
    - Verify memory allocation with `FD_TEST`.
    - Create and join a new forest using [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>) and [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>).
    - Initialize the forest with a root slot using [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>).
    - Insert multiple data shreds into the forest using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>), forming a tree structure.
    - Use a loop to insert additional shreds in a sequential manner.
    - Verify the forest structure with [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>).
    - Print the forest structure using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>).
- **Output**: No return value; the function performs operations on the forest and prints its structure.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)


---
### test\_large\_print\_tree<!-- {{#callable:test_large_print_tree}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L446>)

Creates a large tree structure in a workspace and prints it after verifying its integrity.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace where the tree will be created and manipulated.
- **Logic and Control Flow**:
    - Allocate memory in the workspace for a forest structure with a maximum of 512 elements.
    - Initialize the forest with a root slot of `330090532`.
    - Insert a series of slots into the forest, creating a tree structure with specific parent-child relationships.
    - Verify the integrity of the forest structure using [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>).
    - Print the forest structure using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>).
- **Output**: No return value; the function performs operations on the workspace and prints the forest structure.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)


---
### test\_linear\_forest\_iterator<!-- {{#callable:test_linear_forest_iterator}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L498>)

Tests the iteration order of a linear forest structure to ensure it matches the expected sequence.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` with alignment and footprint based on `ele_max`.
    - Initialize the forest with [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>) and insert data shreds into the forest using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>).
    - Define an expected iteration order in the `expected` array.
    - Initialize an iterator with [`fd_forest_iter_init`](<fd_forest.c.md#fd_forest_iter_init>) and iterate through the forest using a for-loop.
    - For each element in the iteration, compare the slot and index with the expected values using `FD_TEST`.
    - Log debug information for each iteration step.
    - Verify that the number of iterations matches the expected count.
- **Output**: No return value; the function performs tests and logs results.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_pool_const`](<fd_forest.h.md#fd_forest_pool_const>)
    - [`fd_forest_iter_init`](<fd_forest.c.md#fd_forest_iter_init>)
    - [`fd_forest_iter_done`](<fd_forest.c.md#fd_forest_iter_done>)
    - [`fd_forest_iter_next`](<fd_forest.c.md#fd_forest_iter_next>)


---
### test\_branched\_forest\_iterator<!-- {{#callable:test_branched_forest_iterator}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L545>)

Tests the behavior of a forest iterator in a branched chain structure, simulating a regular turbine operation.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for a forest structure with a maximum of 512 elements.
    - Initialize the forest with a branched chain structure using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>) to insert data shreds into specific slots.
    - Define the expected initial iterator order for the branched structure and verify it using a loop that iterates over the forest using [`fd_forest_iter_init`](<fd_forest.c.md#fd_forest_iter_init>), [`fd_forest_iter_done`](<fd_forest.c.md#fd_forest_iter_done>), and [`fd_forest_iter_next`](<fd_forest.c.md#fd_forest_iter_next>).
    - Advance the frontier by inserting additional data shreds and FEC (Forward Error Correction) data, then verify the new expected iterator order.
    - Insert a data shred in the middle of an iteration to test the effect on the frontier and verify the iteration is cut off as expected.
- **Output**: No return value; the function uses assertions (`FD_TEST`) to verify the expected behavior of the forest iterator.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_iter_init`](<fd_forest.c.md#fd_forest_iter_init>)
    - [`fd_forest_iter_done`](<fd_forest.c.md#fd_forest_iter_done>)
    - [`fd_forest_iter_next`](<fd_forest.c.md#fd_forest_iter_next>)
    - [`fd_forest_pool_const`](<fd_forest.h.md#fd_forest_pool_const>)
    - [`fd_forest_ver_const`](<fd_forest.h.md#fd_forest_ver_const>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)


---
### test\_frontier<!-- {{#callable:test_frontier}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L646>)

Tests the behavior of a forest data structure when elements are added to the frontier and checks for correct removal from ancestry.
- **Inputs**:
    - ``wksp``: A pointer to a workspace (`fd_wksp_t`) used for memory allocation and management.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` with alignment and footprint based on `ele_max`.
    - Initialize the forest with [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>) and insert data shreds and FEC blocks into the forest using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>) and [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>).
    - Set `frontier_slot` to 3 and verify the forest using [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>).
    - Query the frontier element using `fd_forest_frontier_ele_query` and check the result.
    - Insert a new frontier element at slot 4 and update `frontier_slot`.
    - Verify the forest again and query the consumed and ancestry elements using `fd_forest_consumed_ele_query` and `fd_forest_ancestry_ele_query`.
- **Output**: No return value; the function performs tests and assertions to verify the forest's behavior.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)


---
### test\_invalid\_frontier\_insert<!-- {{#callable:test_invalid_frontier_insert}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L673>)

Tests the behavior of the forest data structure when inserting nodes that should not advance the frontier due to pre-existing conditions.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace used for memory allocation and management.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` and initialize it with [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>) and [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>).
    - Initialize the forest with [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>) starting from slot 0.
    - Insert a data shred and FEC for slot 100 using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>) and [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>).
    - Simulate a pause in the turbine by inserting slot 109 as a child of 108, and verify its presence in subtrees using `fd_forest_subtrees_ele_query`.
    - Insert slot 101 as a child of 100 and verify the state of the forest.
    - Insert slot 108 as a child of 100 and verify that slot 109 is no longer in the subtrees.
    - Print the forest state and verify its integrity using [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>) and [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>).
    - Check that slots 101 and 108 are consumed and slot 109 is not using `fd_forest_consumed_ele_query`.
- **Output**: No return value; the function performs tests and assertions to verify the forest's behavior.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)
    - [`fd_forest_print`](<fd_forest.c.md#fd_forest_print>)
    - [`fd_forest_verify`](<fd_forest.c.md#fd_forest_verify>)


---
### test\_fec\_clear<!-- {{#callable:test_fec_clear}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L729>)

Tests the behavior of the `fd_forest` data structure when handling FEC (Forward Error Correction) operations, including insertion, clearing, and completion of data blocks.
- **Inputs**:
    - ``wksp``: A pointer to a `fd_wksp_t` workspace structure used for memory allocation and management.
- **Logic and Control Flow**:
    - Allocate memory for the forest using `fd_wksp_alloc_laddr` with alignment and footprint based on `ele_max`.
    - Initialize the forest with [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>).
    - Simulate the completion of block 1 with two FEC sets using [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>) and [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>).
    - Verify the consumption of elements using `fd_forest_consumed_ele_query`.
    - Clear FEC data for a completed block using [`fd_forest_fec_clear`](<fd_forest.c.md#fd_forest_fec_clear>) and verify that consumption is unaffected.
    - Insert additional FEC data and verify that the frontier does not advance until all necessary data is received.
    - Complete the slot by inserting the final FEC data and verify the consumption of the next slot.
- **Output**: No return value; the function performs tests and assertions to verify the behavior of the `fd_forest` data structure.
- **Functions Called**:
    - [`fd_forest_align`](<fd_forest.h.md#fd_forest_align>)
    - [`fd_forest_footprint`](<fd_forest.h.md#fd_forest_footprint>)
    - [`fd_forest_join`](<fd_forest.c.md#fd_forest_join>)
    - [`fd_forest_new`](<fd_forest.c.md#fd_forest_new>)
    - [`fd_forest_init`](<fd_forest.c.md#fd_forest_init>)
    - [`fd_forest_blk_data_shred_insert`](<#fd_forest_blk_data_shred_insert>)
    - [`fd_forest_blk_fec_insert`](<#fd_forest_blk_fec_insert>)
    - [`fd_forest_fec_clear`](<fd_forest.c.md#fd_forest_fec_clear>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/discof/forest/test_forest.c#L779>)

Initializes the environment, sets up a workspace, and runs a series of tests on forest data structures.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Sets `page_cnt` to 1 and `page_sz` to "gigantic".
    - Determines `numa_idx` using `fd_shmem_numa_idx` with an argument of 0.
    - Creates a new anonymous workspace `wksp` using `fd_wksp_new_anonymous` with the specified page size, page count, CPU index, and name.
    - Verifies the creation of the workspace with `FD_TEST`.
    - Executes a series of test functions ([`test_invalid_frontier_insert`](<#test_invalid_frontier_insert>), [`test_publish`](<#test_publish>), [`test_publish_incremental`](<#test_publish_incremental>), [`test_out_of_order`](<#test_out_of_order>), [`test_forks`](<#test_forks>), [`test_print_tree`](<#test_print_tree>), [`test_linear_forest_iterator`](<#test_linear_forest_iterator>), [`test_branched_forest_iterator`](<#test_branched_forest_iterator>), [`test_frontier`](<#test_frontier>), [`test_fec_clear`](<#test_fec_clear>)) using the workspace `wksp`.
    - Calls `fd_halt` to clean up and terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_invalid_frontier_insert`](<#test_invalid_frontier_insert>)
    - [`test_publish`](<#test_publish>)
    - [`test_publish_incremental`](<#test_publish_incremental>)
    - [`test_out_of_order`](<#test_out_of_order>)
    - [`test_forks`](<#test_forks>)
    - [`test_print_tree`](<#test_print_tree>)
    - [`test_linear_forest_iterator`](<#test_linear_forest_iterator>)
    - [`test_branched_forest_iterator`](<#test_branched_forest_iterator>)
    - [`test_frontier`](<#test_frontier>)
    - [`test_fec_clear`](<#test_fec_clear>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)