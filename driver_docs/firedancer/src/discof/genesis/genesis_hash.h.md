<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Computes the shred version and genesis hash from a file using SHA-256.

# Purpose
This C header file defines a function [`compute_shred_version`](<#compute_shred_version>) that calculates a hash from a file specified by `genesis_path` using the SHA-256 algorithm. The function reads the file in chunks, computes the SHA-256 hash, and optionally stores the hash in `opt_gen_hash`. It also computes a shred version by XORing parts of the hash and stores it in `opt_shred_version` if provided. The function handles file operations and errors, ensuring the file is opened, read, and closed correctly. The header includes necessary libraries for file operations and SHA-256 hashing, and it uses inline functions for efficient execution.
# Imports and Dependencies

---
- `../../ballet/sha256/fd_sha256.h`
- `errno.h`
- `fcntl.h`
- `unistd.h`


# Functions

---
### compute\_shred\_version<!-- {{#callable:compute_shred_version}} -->
[View Source →](<../../../../../src/discof/genesis/genesis_hash.h#L10>)

Computes a shred version and optionally a SHA-256 hash from a genesis file.
- **Inputs**:
    - `genesis_path`: A constant character pointer to the path of the genesis file to read.
    - `opt_shred_version`: An optional pointer to a ushort where the computed shred version will be stored.
    - `opt_gen_hash`: An optional pointer to a uchar array where the computed SHA-256 hash will be stored.
- **Logic and Control Flow**:
    - Initialize a SHA-256 context using `fd_sha256_new`, `fd_sha256_join`, and `fd_sha256_init`.
    - Open the file at `genesis_path` in read-only mode.
    - If the file cannot be opened, return -1.
    - Read the file in chunks of 4096 bytes into a buffer and append each chunk to the SHA-256 context using `fd_sha256_append`.
    - If a read error occurs, close the file and return -1.
    - If the end of the file is reached, break the loop.
    - Close the file and log an error if closing fails.
    - Finalize the SHA-256 hash computation with `fd_sha256_fini` and store the result in a union `hash`.
    - Delete the SHA-256 context using `fd_sha256_delete`.
    - If `opt_gen_hash` is provided, copy the computed hash to it.
    - Compute a shred version by XORing the 16 ushort elements of the hash.
    - Byte-swap the computed shred version using `fd_ushort_bswap`.
    - Ensure the shred version is not zero by incrementing it unless it is `USHORT_MAX`.
    - If `opt_shred_version` is provided, store the computed shred version in it.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success, or -1 if an error occurs while opening or reading the file.



---
Made with ❤️ by [Driver](https://www.driver.ai/)