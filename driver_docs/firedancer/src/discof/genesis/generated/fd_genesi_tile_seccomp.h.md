<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall access control, generated by `generate_filters.py`.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically and should not be edited manually. The file includes several Linux headers related to auditing, capabilities, filtering, and seccomp, which are necessary for defining and applying the seccomp filter. The filter is designed to restrict the system calls that a process can make, enhancing security by allowing only a predefined set of system calls and arguments.

The [`populate_sock_filter_policy_fd_genesi_tile`](<#populate_sock_filter_policy_fd_genesi_tile>) function is the main component of this file. It initializes a `sock_filter` array with 74 instructions that define the seccomp policy. The policy checks the architecture of the running process and allows or denies specific system calls based on predefined conditions. The allowed system calls include `write`, `fsync`, `fstat`, `close`, `read`, `exit`, `ppoll`, `sendto`, `recvfrom`, and `renameat2`. Each system call is checked against specific arguments to determine if it should be allowed or if the process should be terminated (`SECCOMP_RET_KILL_PROCESS`). The function uses `fd_memcpy` to copy the filter instructions into the provided output buffer. The file is intended to be included in other C source files where this seccomp policy is required.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_genesi\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: The variable `sock_filter_policy_fd_genesi_tile_instr_cnt` is a constant unsigned integer that holds the value 74. This value represents the number of instructions in a socket filter policy.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_genesi_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_genesi\_tile<!-- {{#callable:populate_sock_filter_policy_fd_genesi_tile}} -->
[View Source →](<../../../../../../src/discof/genesis/generated/fd_genesi_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined set of BPF instructions to enforce a seccomp policy for system call filtering.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 74.
    - `out`: A pointer to a `sock_filter` array where the function will copy the filter instructions.
    - `logfile_fd`: A file descriptor used in the filter to allow or deny certain syscalls.
    - `in_genesis_fd`: A file descriptor used in the filter to allow or deny certain syscalls.
    - `out_genesis_fd`: A file descriptor used in the filter to allow or deny certain syscalls.
    - `out_dir_fd`: A file descriptor used in the filter to allow or deny certain syscalls.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 74 using `FD_TEST` macro.
    - Defines a `sock_filter` array with 74 BPF instructions to enforce syscall filtering.
    - The filter checks the architecture and syscall numbers, allowing or denying based on predefined rules.
    - Specific syscalls like `write`, `fsync`, `fstat`, `close`, `read`, `exit`, `sendto`, `recvfrom`, and `renameat2` are conditionally allowed based on file descriptor checks.
    - If none of the conditions are met, the process is killed using `SECCOMP_RET_KILL_PROCESS`.
    - Copies the filter array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)