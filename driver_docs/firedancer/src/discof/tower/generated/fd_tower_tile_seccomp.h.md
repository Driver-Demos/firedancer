<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall access control based on architecture and syscall numbers.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_tower_tile`](<#populate_sock_filter_policy_fd_tower_tile>), initializes a BPF filter array that enforces security policies by allowing or denying specific system calls based on predefined rules.

The filter policy checks the architecture of the executing environment and allows certain system calls like `write`, `read`, `fstat`, and `fsync` only if they meet specific conditions. These conditions are based on the file descriptors provided as arguments to the function. If a system call does not match the allowed criteria, the filter will terminate the process using `SECCOMP_RET_KILL_PROCESS`. The function uses `fd_memcpy` to copy the filter rules into the provided output buffer. This header file is intended to be included in other C source files where the seccomp policy needs to be applied.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_tower\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: Defines the number of instructions in the socket filter policy for the `fd_tower_tile` component. This constant is used to ensure that the correct number of instructions are processed in the filter.
- **Use**: Used to validate the count of instructions in the `populate_sock_filter_policy_fd_tower_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_tower\_tile<!-- {{#callable:populate_sock_filter_policy_fd_tower_tile}} -->
[View Source →](<../../../../../../src/discof/tower/generated/fd_tower_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call permissions based on file descriptors.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, expected to be at least 24.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor for the log file, used in the filter policy to allow certain syscalls.
    - `checkpt_fd`: The file descriptor for the checkpoint, used in the filter policy to allow certain syscalls.
    - `restore_fd`: The file descriptor for the restore operation, used in the filter policy to allow certain syscalls.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 24 to ensure the `out` array can hold the filter policy.
    - Defines a `sock_filter` array `filter` with 24 elements to specify the seccomp filter policy.
    - Loads the architecture from `seccomp_data` and compares it with `ARCH_NR`; if they do not match, jumps to `RET_KILL_PROCESS`.
    - Loads the syscall number and checks if it matches `SYS_write`, `SYS_read`, `SYS_fstat`, or `SYS_fsync`; if not, jumps to `RET_KILL_PROCESS`.
    - For each allowed syscall, loads the first argument and checks if it matches `logfile_fd`, `checkpt_fd`, or `restore_fd`; if not, jumps to `RET_KILL_PROCESS`.
    - If a match is found, jumps to `RET_ALLOW` to permit the syscall.
    - Copies the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)