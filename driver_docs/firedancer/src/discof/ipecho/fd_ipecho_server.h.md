<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines structures and functions for an IP echo server, including metrics and server management.

# Purpose
This C header file defines the interface for an IP echo server, which is part of the Firedancer project. It includes function declarations and type definitions necessary for creating and managing an IP echo server. The file defines a structure `fd_ipecho_server` and its associated metrics structure [`fd_ipecho_server_metrics`](<#fd_ipecho_server_metrics>), which tracks server statistics such as connection count, bytes read and written, and connection closure statuses. The header provides function prototypes for server alignment, memory footprint calculation, server creation, initialization, and operation, including polling and metrics retrieval. It also includes a unique magic number `FD_IPECHO_SERVER_MAGIC` for server identification.
# Imports and Dependencies

---
- `../../util/fd_util_base.h`


# Data Structures

---
### fd\_ipecho\_server\_t
- **Type**: ``fd_ipecho_server_t``
- **Members**:
    - ``connection_cnt``: Counts the number of connections.
    - ``bytes_read``: Tracks the total number of bytes read.
    - ``bytes_written``: Tracks the total number of bytes written.
    - ``connections_closed_ok``: Counts the number of connections closed successfully.
    - ``connections_closed_error``: Counts the number of connections closed due to errors.
- **Description**: Represents a server structure for handling IP echo services, including metrics for connection management and data transfer statistics.


---
### fd\_ipecho\_server\_metrics
- **Type**: ``struct``
- **Members**:
    - `connection_cnt`: Counts the total number of connections.
    - `bytes_read`: Tracks the total number of bytes read.
    - `bytes_written`: Tracks the total number of bytes written.
    - `connections_closed_ok`: Counts the number of connections closed successfully.
    - `connections_closed_error`: Counts the number of connections closed due to errors.
- **Description**: The `fd_ipecho_server_metrics` structure collects metrics related to server connections, including the number of connections, bytes read and written, and the number of connections closed either successfully or due to errors.


---
### fd\_ipecho\_server\_metrics\_t
- **Type**: ``struct``
- **Members**:
    - `connection_cnt`: Counts the number of connections made to the server.
    - `bytes_read`: Tracks the total number of bytes read by the server.
    - `bytes_written`: Tracks the total number of bytes written by the server.
    - `connections_closed_ok`: Counts the number of connections closed without errors.
    - `connections_closed_error`: Counts the number of connections closed with errors.
- **Description**: Represents metrics for an IP echo server, including counts of connections, bytes read and written, and the status of closed connections.


# Function Declarations (Public API)

---
### fd\_ipecho\_server\_align<!-- {{#callable_declaration:fd_ipecho_server_align}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L21>)

Returns the required memory alignment for the server.
- **Description**: Use this function to obtain the memory alignment requirement for the `fd_ipecho_server` structure. This alignment value is necessary when allocating memory for the server to ensure proper access and performance. It is a constant value and does not depend on any input parameters.
- **Inputs**: None
- **Output**: Returns an `ulong` representing the memory alignment requirement, which is 128 bytes.
- **See Also**: [`fd_ipecho_server_align`](<fd_ipecho_server.c.md#fd_ipecho_server_align>)  (Implementation)


---
### fd\_ipecho\_server\_footprint<!-- {{#callable_declaration:fd_ipecho_server_footprint}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L24>)

Calculates the memory footprint required for a server instance.
- **Description**: Use this function to determine the amount of memory needed to accommodate a server instance with a specified maximum number of connections. This is useful for allocating sufficient memory resources before initializing the server. Ensure that the `max_connection_cnt` parameter is set to the desired maximum number of concurrent connections the server should handle.
- **Inputs**:
    - `max_connection_cnt`: Specifies the maximum number of concurrent connections the server will support. Must be a non-negative integer. If an invalid value is provided, the behavior is undefined.
- **Output**: Returns the size in bytes of the memory footprint required for the server instance.
- **See Also**: [`fd_ipecho_server_footprint`](<fd_ipecho_server.c.md#fd_ipecho_server_footprint>)  (Implementation)


---
### fd\_ipecho\_server\_new<!-- {{#callable_declaration:fd_ipecho_server_new}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L27>)

Creates a new IP echo server instance in shared memory.
- **Description**: Use this function to create a new IP echo server instance in a specified shared memory region. The function requires a pointer to a memory region and the maximum number of connections the server should handle. The memory region must be aligned according to the alignment requirements of the server. If the memory pointer is null or misaligned, the function returns null and logs a warning. This function initializes the server's internal structures and prepares it for operation.
- **Inputs**:
    - `shmem`: Pointer to a shared memory region where the server instance will be created. Must not be null and must be aligned according to `fd_ipecho_server_align()`. If null or misaligned, the function returns null.
    - `max_connection_cnt`: Maximum number of connections the server can handle. Must be a positive integer.
- **Output**: Returns a pointer to the newly created server instance, or null if the input is invalid.
- **See Also**: [`fd_ipecho_server_new`](<fd_ipecho_server.c.md#fd_ipecho_server_new>)  (Implementation)


---
### fd\_ipecho\_server\_join<!-- {{#callable_declaration:fd_ipecho_server_join}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L31>)

Joins a shared memory region as an IP echo server.
- **Description**: Use this function to join a shared memory region that represents an IP echo server. The shared memory pointer must be non-null, aligned according to the server's alignment requirements, and initialized with the correct magic number. This function is typically called after creating or initializing the server in shared memory. If the input does not meet these conditions, the function returns null and logs a warning.
- **Inputs**:
    - `shipe`: A pointer to the shared memory region representing the IP echo server. Must not be null, must be aligned according to `fd_ipecho_server_align()`, and must have been initialized with the correct magic number (`FD_IPECHO_SERVER_MAGIC`). If these conditions are not met, the function returns null.
- **Output**: Returns a pointer to the `fd_ipecho_server_t` structure if successful, or null if the input is invalid.
- **See Also**: [`fd_ipecho_server_join`](<fd_ipecho_server.c.md#fd_ipecho_server_join>)  (Implementation)


---
### fd\_ipecho\_server\_init<!-- {{#callable_declaration:fd_ipecho_server_init}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L34>)

Initialize a TCP echo server with specified address and port.
- **Description**: Use this function to set up a TCP echo server with a given network address and port. This function must be called before the server can accept connections. It configures the server's socket to be non-blocking and allows the reuse of the address. The function also sets the server's shred version, which should be non-zero if it has been previously set. Ensure that the server structure is properly allocated and that the address and port are valid for the network environment.
- **Inputs**:
    - `server`: A pointer to an `fd_ipecho_server_t` structure. Must not be null. The caller is responsible for allocating this structure before calling the function.
    - `address`: An unsigned integer representing the IPv4 address in network byte order. Must be a valid IPv4 address.
    - `port`: An unsigned short representing the port number in host byte order. Must be a valid port number.
    - `shred_version`: An unsigned short representing the shred version. If set to 0, it indicates that the shred version has not been set yet.
- **Output**: None
- **See Also**: [`fd_ipecho_server_init`](<fd_ipecho_server.c.md#fd_ipecho_server_init>)  (Implementation)


---
### fd\_ipecho\_server\_set\_shred\_version<!-- {{#callable_declaration:fd_ipecho_server_set_shred_version}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L40>)

Sets the shred version for the server.
- **Description**: Use this function to update the shred version of an existing server instance. This function must be called with a valid server object. It is typically used when the shred version needs to be changed after the server has been initialized. Ensure that the server pointer is not null before calling this function to avoid undefined behavior.
- **Inputs**:
    - `server`: A pointer to a `fd_ipecho_server_t` object. Must not be null. The caller retains ownership.
    - `shred_version`: A `ushort` value representing the new shred version to set. There are no specific constraints on the value.
- **Output**: None
- **See Also**: [`fd_ipecho_server_set_shred_version`](<fd_ipecho_server.c.md#fd_ipecho_server_set_shred_version>)  (Implementation)


---
### fd\_ipecho\_server\_poll<!-- {{#callable_declaration:fd_ipecho_server_poll}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L44>)

Polls the server for incoming connections and data readiness.
- **Description**: Use this function to check for incoming connections and data readiness on an IP echo server. It must be called after the server is initialized and the shred version is set. The function will block for up to `timeout_ms` milliseconds, waiting for events. If no events occur, or if the call is interrupted, it returns immediately. The function sets `charge_busy` to 1 if any events are processed, indicating that the server was busy handling connections or data.
- **Inputs**:
    - `server`: A pointer to an `fd_ipecho_server_t` structure representing the server. Must not be null and must be properly initialized.
    - `charge_busy`: A pointer to an integer that will be set to 1 if the server processes any events. Must not be null.
    - `timeout_ms`: The maximum time in milliseconds to wait for events. Must be a non-negative integer.
- **Output**: None
- **See Also**: [`fd_ipecho_server_poll`](<fd_ipecho_server.c.md#fd_ipecho_server_poll>)  (Implementation)


---
### fd\_ipecho\_server\_sockfd<!-- {{#callable_declaration:fd_ipecho_server_sockfd}} -->
[View Source →](<../../../../../src/discof/ipecho/fd_ipecho_server.h#L52>)

Returns the socket file descriptor of the server.
- **Description**: Use this function to obtain the socket file descriptor associated with a given server instance. This is useful when you need to perform operations directly on the socket, such as monitoring or configuring socket options. Ensure that the server instance is valid and properly initialized before calling this function.
- **Inputs**:
    - `server`: A pointer to a `fd_ipecho_server_t` instance. Must not be null. The server instance should be valid and initialized before use.
- **Output**: The socket file descriptor associated with the server instance.
- **See Also**: [`fd_ipecho_server_sockfd`](<fd_ipecho_server.c.md#fd_ipecho_server_sockfd>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)