<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall control, generated by a script, with architecture checks.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. The purpose of this file is to provide a set of rules that restrict the system calls that the application can make, enhancing security by limiting the potential attack surface. The file includes necessary headers for working with seccomp and BPF (Berkeley Packet Filter) and defines architecture-specific constants to ensure compatibility with the runtime environment.

The main function, [`populate_sock_filter_policy_fd_ipecho_tile`](<#populate_sock_filter_policy_fd_ipecho_tile>), initializes a `sock_filter` array with 54 instructions. These instructions define the seccomp filter policy, which allows or denies specific system calls based on their numbers and arguments. The policy permits certain system calls like `write`, `close`, `read`, `accept4`, `ppoll`, `sendto`, `recvfrom`, and `fsync`, with conditions on their arguments. If a system call does not match the allowed criteria, the policy will terminate the process using `SECCOMP_RET_KILL_PROCESS`. The function uses `fd_memcpy` to copy the filter instructions to the output buffer, ensuring the policy is applied correctly.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_ipecho\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: Defines the number of instructions in the socket filter policy for the `fd_ipecho_tile` component. This constant is used to ensure that the correct number of instructions is processed in the filter.
- **Use**: Used to verify that the output count is sufficient to hold all filter instructions in the `populate_sock_filter_policy_fd_ipecho_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_ipecho\_tile<!-- {{#callable:populate_sock_filter_policy_fd_ipecho_tile}} -->
[View Source →](<../../../../../../src/discof/ipecho/generated/fd_ipecho_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy for system call filtering.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 54.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor used in the filter policy to allow or kill certain system calls.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 54 using `FD_TEST` macro.
    - Defines a `sock_filter` array `filter` with 54 elements to specify the seccomp filter policy.
    - Loads the architecture from `seccomp_data` and compares it with `ARCH_NR`; if not equal, jumps to `RET_KILL_PROCESS`.
    - Loads the syscall number and checks against allowed syscalls like `write`, `close`, `read`, `accept4`, `ppoll`, `sendto`, `recvfrom`, and `fsync`.
    - For each allowed syscall, further checks are performed on syscall arguments, especially comparing them with `logfile_fd` or specific constants.
    - If none of the conditions match, the process is killed using `SECCOMP_RET_KILL_PROCESS`.
    - Copies the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)