<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall restrictions based on architecture and specific syscalls.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific architecture. It includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations and checks the architecture of the runtime environment to ensure compatibility. The file defines a static function [`populate_sock_filter_policy_fd_gossvf_tile`](<#populate_sock_filter_policy_fd_gossvf_tile>) that initializes a BPF filter array with 14 instructions. These instructions enforce a security policy by allowing or denying specific system calls based on their numbers and arguments. The policy specifically allows `SYS_write` and `SYS_fsync` system calls under certain conditions, while other calls result in the termination of the process.

The file is generated automatically and should not be edited manually. It uses conditional compilation to set the architecture number (`ARCH_NR`) based on the target architecture, such as `AUDIT_ARCH_I386`, `AUDIT_ARCH_X86_64`, or `AUDIT_ARCH_AARCH64`. The filter policy is designed to be used in environments where seccomp is employed to restrict the system calls that a process can make, enhancing security by reducing the attack surface. The function [`populate_sock_filter_policy_fd_gossvf_tile`](<#populate_sock_filter_policy_fd_gossvf_tile>) copies the filter instructions into a provided buffer, ensuring that the policy is applied correctly.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_gossvf\_tile\_instr\_cnt
- **Type**: `unsigned int`
- **Description**: A static constant unsigned integer that represents the number of instructions in a socket filter policy.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_gossvf_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_gossvf\_tile<!-- {{#callable:populate_sock_filter_policy_fd_gossvf_tile}} -->
[View Source →](<../../../../../../src/discof/gossip/generated/fd_gossvf_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call access.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 14.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor to be allowed for `write` and `fsync` system calls.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; if not equal, jump to `RET_KILL_PROCESS`.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - If none of the conditions are met, execute `RET_KILL_PROCESS`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The `out` array is populated with a seccomp filter policy that allows or denies specific system calls based on the architecture and file descriptor.



---
Made with ❤️ by [Driver](https://www.driver.ai/)