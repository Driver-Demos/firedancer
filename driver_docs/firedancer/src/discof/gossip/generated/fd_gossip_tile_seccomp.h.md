<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall restrictions based on architecture and specific syscalls.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application or process. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_gossip_tile`](<#populate_sock_filter_policy_fd_gossip_tile>), initializes a BPF filter array that enforces security policies by allowing or denying specific system calls based on predefined rules.

The filter policy checks the architecture of the executing environment and allows only specific system calls, such as `SYS_write` and `SYS_fsync`, under certain conditions. If the conditions are not met, the process is terminated using `SECCOMP_RET_KILL_PROCESS`. The function uses BPF statements and jumps to implement these checks, ensuring that only authorized operations are permitted. The filter is designed to enhance security by restricting the system calls that a process can make, thereby reducing the risk of exploitation.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_gossip\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: A static constant variable that holds the number of instructions in a socket filter policy for gossip tile security.
- **Use**: Used to verify the count of instructions in the `populate_sock_filter_policy_fd_gossip_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_gossip\_tile<!-- {{#callable:populate_sock_filter_policy_fd_gossip_tile}} -->
[View Source →](<../../../../../../src/discof/gossip/generated/fd_gossip_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a seccomp filter policy to control system call access based on architecture and specific system calls.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 14.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be stored.
    - `logfile_fd`: The file descriptor to be checked against syscall arguments for write and fsync operations.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; if not equal, jump to `RET_KILL_PROCESS`.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - If none of the conditions are met, the process is killed (`RET_KILL_PROCESS`).
    - If conditions are met, allow the syscall (`RET_ALLOW`).
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The `out` array is populated with a seccomp filter policy that allows or kills processes based on architecture and specific syscall checks.



---
Made with ❤️ by [Driver](https://www.driver.ai/)