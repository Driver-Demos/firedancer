<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a gossip protocol tile for network communication, including message handling, signing, and metrics tracking.

# Purpose
The code is a C source file that implements a gossip protocol tile within a distributed system. It is part of a larger framework, as indicated by the inclusion of multiple header files from different directories. The primary purpose of this code is to manage the communication and data exchange between nodes in a network using a gossip protocol. This involves sending and receiving messages, handling different types of data packets, and maintaining the state of the network.

Key components of the code include functions for sending and signing gossip messages ([`gossip_send_fn`](<#gossip_send_fn>) and [`gossip_sign_fn`](<#gossip_sign_fn>)), tracking changes in peer status ([`gossip_ping_tracker_change_fn`](<#gossip_ping_tracker_change_fn>)), and handling various types of incoming data ([`handle_shred_version`](<#handle_shred_version>), [`handle_local_vote`](<#handle_local_vote>), [`handle_stakes`](<#handle_stakes>), and [`handle_packet`](<#handle_packet>)). The code also includes initialization functions ([`privileged_init`](<#privileged_init>) and [`unprivileged_init`](<#unprivileged_init>)) to set up the gossip tile's context and resources. Additionally, the code defines a structure `fd_topo_run_tile_t` named `fd_tile_gossip`, which specifies the tile's name, security policies, and initialization routines. This structure is likely used to integrate the gossip tile into the larger system.
# Imports and Dependencies

---
- `fd_gossip_tile.h`
- `../../disco/metrics/fd_metrics.h`
- `generated/fd_gossip_tile_seccomp.h`
- `../../flamenco/gossip/crds/fd_crds.h`
- `../../flamenco/gossip/fd_gossip_out.h`
- `../../disco/keyguard/fd_keyload.h`
- `../../disco/shred/fd_stake_ci.h`
- `../../disco/fd_txn_m.h`
- `../../disco/stem/fd_stem.c`


# Global Variables

---
### firedancer\_major\_version
- **Type**: `ulong`
- **Description**: Represents the major version number of the Firedancer software.
- **Use**: Used to store and reference the major version number in the software's versioning system.


---
### firedancer\_minor\_version
- **Type**: `ulong`
- **Description**: Represents the minor version number of the Firedancer software.
- **Use**: Used to specify the minor version in the `version` structure of `my_contact_info`.


---
### firedancer\_patch\_version
- **Type**: `ulong`
- **Description**: Represents the patch version number of the Firedancer software.
- **Use**: Used to specify the patch version in the `version` structure of `my_contact_info`.


---
### firedancer\_commit\_ref
- **Type**: ``uint``
- **Description**: A constant unsigned integer that represents the commit reference for the Firedancer project.
- **Use**: Used to store the commit reference information for version tracking.


---
### fd\_tile\_gossip
- **Type**: ``fd_topo_run_tile_t``
- **Description**: Defines a `fd_topo_run_tile_t` structure named `fd_tile_gossip` with various function pointers and parameters for initializing and running a gossip tile in a network topology.
- **Use**: Used to configure and manage the execution of a gossip tile within a network topology.


# Functions

---
### scratch\_align<!-- {{#callable:scratch_align}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L23>)

Returns a constant alignment value of 128.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function is defined as `static inline`, indicating it is intended for use within the same translation unit and suggests potential inlining by the compiler.
    - The function is marked with `FD_FN_CONST`, indicating it has no side effects and its return value depends only on its parameters, which in this case are none.
- **Output**: Returns an `unsigned long` integer with the value `128UL`.


---
### scratch\_footprint<!-- {{#callable:scratch_footprint}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L28>)

Calculates the memory footprint required for a scratch space based on the given tile's gossip configuration.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure that contains the gossip configuration details, including `max_entries` and `entrypoints_cnt`.
- **Logic and Control Flow**:
    - Initialize `l` with `FD_LAYOUT_INIT`.
    - Append the size and alignment of `fd_gossip_tile_ctx_t` to `l` using `FD_LAYOUT_APPEND`.
    - Append the footprint and alignment of the gossip component to `l` using `FD_LAYOUT_APPEND`, calculated with `fd_gossip_footprint` and `fd_gossip_align`.
    - Append the size and alignment of the stake weights to `l` using `FD_LAYOUT_APPEND`, calculated as `MAX_STAKED_LEADERS` times the size of `fd_stake_weight_t`.
    - Finalize the layout with `FD_LAYOUT_FINI` using [`scratch_align`](<#scratch_align>) and return the result.
- **Output**: Returns an `ulong` representing the total memory footprint required for the scratch space.
- **Functions Called**:
    - [`scratch_align`](<#scratch_align>)


---
### gossip\_send\_fn<!-- {{#callable:gossip_send_fn}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L37>)

Prepares and sends a network packet with a given payload to a specified peer address using a gossip protocol.
- **Inputs**:
    - `ctx`: A pointer to the context, specifically a `fd_gossip_tile_ctx_t` structure, which contains the network output and other relevant data.
    - `stem`: A pointer to the `fd_stem_context_t` structure, used for publishing the packet.
    - `payload`: A pointer to the payload data to be sent.
    - `payload_sz`: The size of the payload data in bytes.
    - `peer_address`: A pointer to the `fd_ip4_port_t` structure containing the IP address and port of the peer to which the packet is sent.
    - `tsorig`: The original timestamp for the packet.
- **Logic and Control Flow**:
    - Cast `ctx` to `fd_gossip_tile_ctx_t` and retrieve the network output memory location and header.
    - Copy the network output header to the packet header.
    - Calculate and set the total length of the IP and UDP headers plus the payload size in the IP and UDP headers.
    - Set the destination address and port in the IP and UDP headers using `peer_address`.
    - Increment and set the IP header's ID field.
    - Calculate and set the IP header checksum.
    - Set the UDP checksum to zero.
    - Copy the payload data into the packet after the headers.
    - Calculate the publication timestamp and signature for the packet.
    - Publish the packet using `fd_stem_publish` with the calculated signature, size, and timestamps.
    - Update the chunk index for the next packet using `fd_dcache_compact_next`.
- **Output**: No return value; the function operates by side effects, sending a packet over the network.


---
### gossip\_sign\_fn<!-- {{#callable:gossip_sign_fn}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L72>)

Signs data using a specified signing type and outputs the signature.
- **Inputs**:
    - ``ctx``: A pointer to the context, specifically a `fd_gossip_tile_ctx_t` structure, which contains the `keyguard_client` used for signing.
    - ``data``: A pointer to the data that needs to be signed.
    - ``data_sz``: The size of the data to be signed, in bytes.
    - ``sign_type``: An integer representing the type of signing to be performed.
    - ``out_signature``: A pointer to the buffer where the resulting signature will be stored.
- **Logic and Control Flow**:
    - Cast the `ctx` pointer to a `fd_gossip_tile_ctx_t` pointer to access the `keyguard_client`.
    - Call `fd_keyguard_client_sign` with the `keyguard_client`, `out_signature`, `data`, `data_sz`, and `sign_type` to perform the signing operation.
- **Output**: The function does not return a value, but it writes the generated signature to the `out_signature` buffer.


---
### gossip\_ping\_tracker\_change\_fn<!-- {{#callable:gossip_ping_tracker_change_fn}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L82>)

Updates the gossip ping tracker with the peer's public key and address, and publishes the change based on the change type.
- **Inputs**:
    - `_ctx`: A pointer to the context of type `fd_gossip_tile_ctx_t`.
    - `peer_pubkey`: A constant pointer to the peer's public key, which is an array of unsigned characters.
    - `peer_address`: The peer's address of type `fd_ip4_port_t`.
    - `now`: A long integer representing the current time, which is not used in the function.
    - `change_type`: An integer indicating the type of change, used to determine if the peer is active or not.
- **Logic and Control Flow**:
    - Cast `_ctx` to `fd_gossip_tile_ctx_t` and store it in `ctx`.
    - Convert the chunk in `ctx->gossvf_out` to a local address and cast it to `fd_gossip_ping_update_t`, storing it in `ping_update`.
    - Copy the `peer_pubkey` into `ping_update->pubkey.uc`.
    - Set `ping_update->gossip_addr.l` to `peer_address.l`.
    - Set `ping_update->remove` to true if `change_type` is not `FD_PING_TRACKER_CHANGE_TYPE_ACTIVE`, otherwise set it to false.
    - Publish the `ping_update` using `fd_stem_publish` with the appropriate parameters from `ctx`.
    - Update `ctx->gossvf_out->chunk` to the next compact chunk using `fd_dcache_compact_next`.
- **Output**: No return value; the function operates by side effects on the context and publishes updates.


---
### during\_housekeeping<!-- {{#callable:during_housekeeping}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L101>)

Updates the context's wallclock and tick count, and handles a pending keyswitch state by updating contact information and completing the keyswitch.
- **Inputs**:
    - `ctx`: A pointer to a `fd_gossip_tile_ctx_t` structure, which holds the context for the gossip tile.
- **Logic and Control Flow**:
    - Update `ctx->last_wallclock` with the current wallclock time using `fd_log_wallclock()`.
    - Update `ctx->last_tickcount` with the current tick count using `fd_tickcount()`.
    - Check if the keyswitch state is `FD_KEYSWITCH_STATE_SWITCH_PENDING` using `fd_keyswitch_state_query()`.
    - If the keyswitch state is pending, copy the keyswitch bytes to the public key in `ctx->my_contact_info` using `fd_memcpy()`.
    - Set the contact information in the gossip context with `fd_gossip_set_my_contact_info()`, using the updated public key and wallclock time.
    - Change the keyswitch state to `FD_KEYSWITCH_STATE_COMPLETED` using `fd_keyswitch_state()`.
- **Output**: No return value; the function operates directly on the `ctx` structure to update its state.


---
### metrics\_write<!-- {{#callable:metrics_write}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L116>)

Writes various gossip-related metrics to the monitoring system.
- **Inputs**:
    - `ctx`: A pointer to `fd_gossip_tile_ctx_t`, which contains the context for the gossip tile.
- **Logic and Control Flow**:
    - Retrieve ping tracker metrics using `fd_gossip_ping_tracker_metrics` and store them in `ping_tracker_metrics`.
    - Set various metrics related to ping tracker counts and results using `FD_MGAUGE_SET` and `FD_MCNT_SET`.
    - Retrieve CRDS metrics using `fd_gossip_crds_metrics` and store them in `crds_metrics`.
    - Set various CRDS-related metrics using `FD_MGAUGE_ENUM_COPY`, `FD_MCNT_SET`, and `FD_MGAUGE_SET`.
    - Retrieve general gossip metrics using `fd_gossip_metrics` and store them in `metrics`.
    - Set various message transmission and reception metrics using `FD_MCNT_ENUM_COPY` and `FD_MCNT_SET`.
- **Output**: No return value; the function writes metrics to the monitoring system.


---
### after\_credit<!-- {{#callable:after_credit}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L168>)

Updates the `fd_gossip_tile_ctx_t` context with a new stem and advances the gossip state if the shred version is valid.
- **Inputs**:
    - `ctx`: A pointer to `fd_gossip_tile_ctx_t`, which holds the context for the gossip tile.
    - `stem`: A pointer to `fd_stem_context_t`, representing the stem context to be associated with the gossip context.
    - `opt_poll_in`: An optional pointer to an integer, marked as unused in this function.
    - `charge_busy`: An optional pointer to an integer, marked as unused in this function.
- **Logic and Control Flow**:
    - Assigns the `stem` to `ctx->stem`.
    - Checks if `ctx->my_contact_info->shred_version` is zero; if so, the function returns immediately.
    - Calculates the current time `now` using the difference between the current tick count and the last tick count, adjusted by `ctx->ticks_per_ns`.
    - Calls `fd_gossip_advance` with `ctx->gossip`, `now`, and `stem` to advance the gossip state.
- **Output**: No return value; the function operates by side effects on the `ctx` and `stem`.


---
### handle\_shred\_version<!-- {{#callable:handle_shred_version}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L181>)

Updates the shred version in the contact information and sets the current time for the gossip context.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_gossip_tile_ctx_t` structure that contains the gossip context and contact information.
    - ``sig``: An unsigned long integer representing the new shred version to be set.
- **Logic and Control Flow**:
    - Calculate the current time `now` by adding the last wallclock time to the elapsed time since the last tick count, converted to nanoseconds.
    - Set the `shred_version` field of `my_contact_info` in the context to the value of `sig`, cast to a `ushort`.
    - Call `fd_gossip_set_my_contact_info` with the updated contact information and the current time `now`.
- **Output**: No return value; the function updates the context's contact information in place.


---
### handle\_local\_vote<!-- {{#callable:handle_local_vote}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L189>)

Processes a local vote by calculating the current time and pushing the vote to the gossip system.
- **Inputs**:
    - `ctx`: A pointer to the `fd_gossip_tile_ctx_t` structure, which contains context information for the gossip tile.
    - `txn_m`: A constant pointer to the `fd_txn_m_t` structure, representing the transaction message to be processed.
    - `stem`: A pointer to the `fd_stem_context_t` structure, which provides context for the stem operation.
- **Logic and Control Flow**:
    - Calculate the current time `now` by adding the last wallclock time from `ctx` to the elapsed time since the last tick count, adjusted by the ticks per nanosecond.
    - Call `fd_gossip_push_vote` with the gossip context, the payload of the transaction message, the payload size, the stem context, and the calculated current time `now`.
- **Output**: No return value; the function operates by side effect, updating the gossip system with the local vote.


---
### handle\_stakes<!-- {{#callable:handle_stakes}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L197>)

Updates stake weights in the gossip context based on the provided message.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_gossip_tile_ctx_t` structure, which holds the context for the gossip tile.
    - ``msg``: A pointer to a constant `fd_stake_weight_msg_t` structure, which contains the stake weights and the count of staked entities.
- **Logic and Control Flow**:
    - Call `compute_id_weights_from_vote_weights` to convert vote weights from `msg` into stake weights stored in `ctx->stake_weights_converted` and get the count of stakes.
    - Call `fd_gossip_stakes_update` to update the gossip context with the converted stake weights and the count of stakes.
- **Output**: No return value; the function updates the gossip context with new stake weights.


---
### handle\_packet<!-- {{#callable:handle_packet}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L204>)

Processes incoming packets based on their signature kind and updates the gossip context accordingly.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_gossip_tile_ctx_t` structure, which holds the context for the gossip tile.
    - ``sig``: An unsigned long integer representing the signature of the packet, used to determine the kind of packet and its source.
    - ``payload``: A pointer to an array of unsigned characters representing the packet's payload data.
    - ``payload_sz``: An unsigned long integer indicating the size of the payload.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is used for publishing and managing gossip data.
- **Logic and Control Flow**:
    - Calculate the current time `now` using the last wallclock and tick count from the context.
    - Extract the peer's IP address and port from the signature using [`fd_gossvf_sig_addr`](<fd_gossip_tile.h.md#fd_gossvf_sig_addr>) and [`fd_gossvf_sig_port`](<fd_gossip_tile.h.md#fd_gossvf_sig_port>).
    - Determine the kind of packet using [`fd_gossvf_sig_kind`](<fd_gossip_tile.h.md#fd_gossvf_sig_kind>).
    - If the packet kind is 0, call `fd_gossip_rx` to process the packet and `fd_gossip_advance` to update the gossip context.
    - If the packet kind is 1, cast the payload to `fd_gossip_pingreq_t` and call `fd_gossip_ping_tracker_track` to track the ping request.
- **Output**: No return value; the function updates the gossip context and processes the packet based on its kind.
- **Functions Called**:
    - [`fd_gossvf_sig_addr`](<fd_gossip_tile.h.md#fd_gossvf_sig_addr>)
    - [`fd_gossvf_sig_port`](<fd_gossip_tile.h.md#fd_gossvf_sig_port>)
    - [`fd_gossvf_sig_kind`](<fd_gossip_tile.h.md#fd_gossvf_sig_kind>)


---
### returnable\_frag<!-- {{#callable:returnable_frag}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L230>)

Processes incoming fragments based on their type and performs specific actions or checks for each type.
- **Inputs**:
    - `ctx`: Pointer to a `fd_gossip_tile_ctx_t` structure that holds the context for the gossip tile.
    - `in_idx`: Index of the input source in the context's input array.
    - `seq`: Sequence number of the fragment (unused in this function).
    - `sig`: Signature associated with the fragment.
    - `chunk`: Chunk identifier for the fragment.
    - `sz`: Size of the fragment.
    - `ctl`: Control information for the fragment (unused in this function).
    - `tsorig`: Original timestamp of the fragment (unused in this function).
    - `tspub`: Publication timestamp of the fragment (unused in this function).
    - `stem`: Pointer to a `fd_stem_context_t` structure used for publishing or processing fragments.
- **Logic and Control Flow**:
    - Ignores `seq`, `ctl`, `tsorig`, and `tspub` parameters as they are not used in the function.
    - Checks if `chunk` is within the valid range defined by `chunk0` and `wmark` of the input source, and if `sz` is less than or equal to `mtu`; logs an error if not.
    - Returns 1 if `shred_version` is not set and the input kind is not `IN_KIND_SHRED_VERSION`.
    - Uses a switch statement to handle different kinds of input: `IN_KIND_SHRED_VERSION`, `IN_KIND_SEND`, `IN_KIND_STAKE`, and `IN_KIND_GOSSVF`.
    - Calls specific handler functions ([`handle_shred_version`](<#handle_shred_version>), [`handle_local_vote`](<#handle_local_vote>), [`handle_stakes`](<#handle_stakes>), [`handle_packet`](<#handle_packet>)) based on the input kind.
    - Returns 0 after processing the fragment.
- **Output**: Returns 0 if the fragment is processed successfully, or 1 if the `shred_version` check fails.
- **Functions Called**:
    - [`handle_shred_version`](<#handle_shred_version>)
    - [`handle_local_vote`](<#handle_local_vote>)
    - [`handle_stakes`](<#handle_stakes>)
    - [`handle_packet`](<#handle_packet>)


---
### privileged\_init<!-- {{#callable:privileged_init}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L261>)

Initializes a privileged gossip tile context with necessary configurations and security checks.
- **Inputs**:
    - ``topo``: A pointer to an `fd_topo_t` structure representing the topology configuration.
    - ``tile``: A pointer to an `fd_topo_tile_t` structure representing the tile configuration.
- **Logic and Control Flow**:
    - Retrieve the local address of the tile object using `fd_topo_obj_laddr` and store it in `scratch`.
    - Initialize the scratch allocator with `FD_SCRATCH_ALLOC_INIT` using `scratch`.
    - Allocate memory for `fd_gossip_tile_ctx_t` using `FD_SCRATCH_ALLOC_APPEND` and store the pointer in `ctx`.
    - Check if `tile->gossip.identity_key_path` is an empty string; if so, log an error and terminate using `FD_LOG_ERR`.
    - Load the public key from the identity key path using `fd_keyload_load` and copy it to `ctx->my_contact_info->pubkey.uc` using `fd_memcpy`.
    - Generate secure random values for `ctx->rng_seed` and `ctx->rng_idx` using `fd_rng_secure`.
- **Output**: No return value; the function initializes the context and performs security checks.


---
### out1<!-- {{#callable:out1}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L277>)

Finds the index of a specified output link by name in a tile's topology and returns a context structure with memory and cache details for that link.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure representing the network topology.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure representing the tile within the topology.
    - ``name``: A string representing the name of the output link to find.
- **Logic and Control Flow**:
    - Initialize `idx` to `ULONG_MAX` to indicate no link found initially.
    - Iterate over the output links of the tile using a loop from 0 to `tile->out_cnt`.
    - For each link, retrieve the link structure from `topo->links` using the link ID from `tile->out_link_id`.
    - Compare the link's name with the input `name` using `strcmp`.
    - If a match is found and `idx` is still `ULONG_MAX`, set `idx` to the current index; otherwise, log an error if multiple matches are found.
    - If no match is found after the loop, log an error indicating no link was found.
    - Retrieve the memory workspace and cache details for the link at the found index.
    - Calculate `chunk0` and `wmark` using `fd_dcache_compact_chunk0` and `fd_dcache_compact_wmark` functions.
    - Return a `fd_gossip_out_ctx_t` structure initialized with the found index, memory, `chunk0`, and `wmark`.
- **Output**: A `fd_gossip_out_ctx_t` structure containing the index of the found link, memory workspace, and cache details (`chunk0`, `wmark`, and `chunk`).


---
### unprivileged\_init<!-- {{#callable:unprivileged_init}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L300>)

Initializes the unprivileged context for a gossip tile in a network topology.
- **Inputs**:
    - ``topo``: A pointer to the `fd_topo_t` structure representing the network topology.
    - ``tile``: A pointer to the `fd_topo_tile_t` structure representing the specific tile to initialize.
- **Logic and Control Flow**:
    - Allocate scratch memory for the tile using `fd_topo_obj_laddr` and `FD_SCRATCH_ALLOC_INIT`.
    - Allocate and initialize the `fd_gossip_tile_ctx_t` context and other necessary memory regions using `FD_SCRATCH_ALLOC_APPEND`.
    - Initialize the random number generator context with `fd_rng_join` and `fd_rng_new`.
    - Iterate over input links of the tile to set up memory, chunk, watermark, and kind for each link.
    - Check for the presence of a 'sign_gossip' input link and log an error if not found.
    - Set up output links for the tile using the [`out1`](<#out1>) function.
    - Join the keyswitch and keyguard client contexts, logging an error if joining fails.
    - Initialize timing and version information in the context.
    - Set up contact information for the tile, including IP addresses and ports.
    - Join the gossip context using `fd_gossip_join` and `fd_gossip_new`, logging an error if joining fails.
    - Set metrics for gossip capacity using `FD_MGAUGE_SET`.
    - Initialize the network output header with `fd_ip4_udp_hdr_init`.
    - Finalize scratch memory allocation with `FD_SCRATCH_ALLOC_FINI` and check for overflow, logging an error if overflow occurs.
- **Output**: No return value; the function initializes the context and sets up the environment for the gossip tile.
- **Functions Called**:
    - [`out1`](<#out1>)
    - [`scratch_footprint`](<#scratch_footprint>)


---
### populate\_allowed\_seccomp<!-- {{#callable:populate_allowed_seccomp}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L428>)

Populates a seccomp filter policy for a gossip tile and returns the instruction count.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure, which is not used in this function.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure, which is not used in this function.
    - ``out_cnt``: An unsigned long integer representing the count of output filters.
    - ``out``: A pointer to an array of `struct sock_filter` where the function will store the seccomp filter policy.
- **Logic and Control Flow**:
    - Ignores the `topo` and `tile` inputs as they are not used in the function.
    - Calls [`populate_sock_filter_policy_fd_gossip_tile`](<generated/fd_gossip_tile_seccomp.h.md#populate_sock_filter_policy_fd_gossip_tile>) with `out_cnt`, `out`, and the file descriptor from `fd_log_private_logfile_fd()` to populate the seccomp filter policy.
    - Returns the value of `sock_filter_policy_fd_gossip_tile_instr_cnt`, which represents the number of instructions in the seccomp filter policy.
- **Output**: Returns an unsigned long integer representing the number of instructions in the seccomp filter policy.
- **Functions Called**:
    - [`populate_sock_filter_policy_fd_gossip_tile`](<generated/fd_gossip_tile_seccomp.h.md#populate_sock_filter_policy_fd_gossip_tile>)


---
### populate\_allowed\_fds<!-- {{#callable:populate_allowed_fds}} -->
[View Source →](<../../../../../src/discof/gossip/fd_gossip_tile.c#L440>)

Populates an array with file descriptors for `stderr` and optionally a logfile, returning the count of populated descriptors.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure, which is not used in this function.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure, which is not used in this function.
    - ``out_fds_cnt``: An unsigned long integer representing the maximum number of file descriptors that can be stored in `out_fds`.
    - ``out_fds``: A pointer to an integer array where the function will store the file descriptors.
- **Logic and Control Flow**:
    - Ignores the `topo` and `tile` inputs as they are not used in the function.
    - Checks if `out_fds_cnt` is less than 2; if true, logs an error and exits.
    - Initializes `out_cnt` to 0 and assigns the file descriptor for `stderr` (2) to `out_fds[0]`, then increments `out_cnt`.
    - Checks if the logfile file descriptor is valid (not -1); if true, assigns it to `out_fds[out_cnt]` and increments `out_cnt`.
    - Returns the value of `out_cnt`, which is the number of file descriptors populated.
- **Output**: Returns an unsigned long integer representing the number of file descriptors stored in `out_fds`.



---
Made with ❤️ by [Driver](https://www.driver.ai/)