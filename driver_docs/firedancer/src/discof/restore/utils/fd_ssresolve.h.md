<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for resolving snapshot slots from peers using HTTP requests and handling HTTP redirects.

# Purpose
The code is a C header file that defines the interface for a module responsible for resolving snapshot slots from a peer using HTTP requests and parsing HTTP redirect responses. The module is part of a larger system, as indicated by the inclusion of utility and network headers. The primary data structure defined is `fd_ssresolve_result_t`, which holds information about the snapshot slot and its base slot. The module provides several functions to manage the lifecycle and operations of the `fd_ssresolve_t` state machine, including initialization, joining, and advancing the state machine based on socket readiness for sending or receiving data.

The header file defines constants and macros such as `FD_SSRESOLVE_MAGIC` and `FD_SSRESOLVE_ALIGN` for internal use. It also specifies error codes for the state machine's advancement functions, such as `FD_SSRESOLVE_ADVANCE_ERROR`, `FD_SSRESOLVE_ADVANCE_AGAIN`, and `FD_SSRESOLVE_ADVANCE_SUCCESS`. The functions [`fd_ssresolve_align`](<#fd_ssresolve_align>) and [`fd_ssresolve_footprint`](<#fd_ssresolve_footprint>) provide alignment and memory footprint information, respectively. The [`fd_ssresolve_new`](<#fd_ssresolve_new>) and [`fd_ssresolve_join`](<#fd_ssresolve_join>) functions manage memory allocation and association with shared memory. The [`fd_ssresolve_init`](<#fd_ssresolve_init>) function initializes the state machine with network parameters, while [`fd_ssresolve_advance_poll_out`](<#fd_ssresolve_advance_poll_out>) and [`fd_ssresolve_advance_poll_in`](<#fd_ssresolve_advance_poll_in>) handle state transitions based on socket readiness. The [`fd_ssresolve_is_done`](<#fd_ssresolve_is_done>) function checks if the state machine has completed its operations.
# Imports and Dependencies

---
- `../../../util/fd_util_base.h`
- `../../../util/net/fd_net_headers.h`


# Data Structures

---
### fd\_ssresolve\_result
- **Type**: ``struct``
- **Members**:
    - `slot`: Holds the slot number of the snapshot.
    - `base_slot`: Holds the base slot number of an incremental snapshot or `ULONG_MAX` if not applicable.
- **Description**: Represents the result of resolving a snapshot, containing information about the slot and base slot of the snapshot or incremental snapshot.


---
### fd\_ssresolve\_result\_t
- **Type**: ``struct``
- **Members**:
    - `slot`: Slot of the snapshot.
    - `base_slot`: Base slot of incremental snapshot or `ULONG_MAX`.
- **Description**: The `fd_ssresolve_result_t` structure holds information about a snapshot, including its `slot` and `base_slot`. The `slot` member indicates the specific slot of the snapshot, while the `base_slot` member indicates the base slot of an incremental snapshot or is set to `ULONG_MAX` if not applicable. This structure is used in the context of resolving snapshot slots for peers in a networked environment.


---
### fd\_ssresolve\_t
- **Type**: ``struct``
- **Members**:
    - ``fd_ssresolve_private``: An opaque structure used internally to manage the state of the snapshot resolution process.
- **Description**: `fd_ssresolve_t` is a typedef for an opaque structure `fd_ssresolve_private`, which is used to manage the process of resolving snapshot slots from a peer by sending HTTP requests and parsing HTTP redirect responses. This structure is part of a state machine that interacts with socket file descriptors to send and receive data, and it is used by `fd_http_resolver_t` to resolve snapshot slots for each peer. The structure must be initialized with `fd_ssresolve_init` and can be advanced through its state machine using `fd_ssresolve_advance_poll_out` and `fd_ssresolve_advance_poll_in`. The process is complete when `fd_ssresolve_is_done` returns true, after which the structure must be reinitialized.


# Function Declarations (Public API)

---
### fd\_ssresolve\_align<!-- {{#callable_declaration:fd_ssresolve_align}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L25>)

Returns the required memory alignment for `fd_ssresolve_t` structures.
- **Description**: Use this function to obtain the memory alignment requirement for `fd_ssresolve_t` structures. This alignment value is necessary when allocating memory for these structures to ensure proper access and performance. The function does not require any initialization or parameters and can be called at any time.
- **Inputs**: None
- **Output**: The function returns an `ulong` representing the alignment requirement, which is 8 bytes.
- **See Also**: [`fd_ssresolve_align`](<fd_ssresolve.c.md#fd_ssresolve_align>)  (Implementation)


---
### fd\_ssresolve\_footprint<!-- {{#callable_declaration:fd_ssresolve_footprint}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L30>)

Calculates the memory footprint required for an `fd_ssresolve_t` instance.
- **Description**: Use this function to determine the amount of memory needed to store an `fd_ssresolve_t` instance. This is useful when allocating memory for the structure, ensuring that the allocation is correctly aligned and sized. The function does not require any parameters and can be called at any time to retrieve the footprint size.
- **Inputs**: None
- **Output**: Returns the size in bytes of the memory footprint required for an `fd_ssresolve_t` instance, including alignment considerations.
- **See Also**: [`fd_ssresolve_footprint`](<fd_ssresolve.c.md#fd_ssresolve_footprint>)  (Implementation)


---
### fd\_ssresolve\_new<!-- {{#callable_declaration:fd_ssresolve_new}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L33>)

Creates a new snapshot resolver in shared memory.
- **Description**: Use this function to create a new snapshot resolver object in a specified shared memory region. This function initializes the resolver's internal state and prepares it for use. The shared memory pointer must be non-null and aligned according to the alignment requirements of the resolver. If these conditions are not met, the function returns null and logs a warning. This function is typically used in conjunction with other resolver functions to manage snapshot resolution.
- **Inputs**:
    - `shmem`: Pointer to a shared memory region where the resolver will be created. Must not be null and must be aligned to `fd_ssresolve_align()`. If these conditions are not met, the function returns null.
- **Output**: Returns a pointer to the newly created resolver object, or null if the input is invalid.
- **See Also**: [`fd_ssresolve_new`](<fd_ssresolve.c.md#fd_ssresolve_new>)  (Implementation)


---
### fd\_ssresolve\_join<!-- {{#callable_declaration:fd_ssresolve_join}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L36>)

Validates and returns a pointer to a `fd_ssresolve_t` structure.
- **Description**: Use this function to obtain a valid pointer to a `fd_ssresolve_t` structure from a given memory address. This function checks if the provided pointer is non-null, properly aligned, and points to a structure with the correct magic number. If any of these conditions are not met, the function logs a warning and returns `NULL`. This function is typically called after allocating or obtaining a memory block intended to hold a `fd_ssresolve_t` structure.
- **Inputs**:
    - `ssresolve`: A pointer to a memory block expected to contain a `fd_ssresolve_t` structure. The pointer must not be null, must be aligned according to `fd_ssresolve_align()`, and must point to a structure with the magic number `FD_SSRESOLVE_MAGIC`. If these conditions are not met, the function returns `NULL`.
- **Output**: A pointer to a `fd_ssresolve_t` structure if the input is valid; otherwise, `NULL`.
- **See Also**: [`fd_ssresolve_join`](<fd_ssresolve.c.md#fd_ssresolve_join>)  (Implementation)


---
### fd\_ssresolve\_init<!-- {{#callable_declaration:fd_ssresolve_init}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L39>)

Initialize the snapshot resolver state.
- **Description**: Use this function to set up a snapshot resolver with the specified network address, socket file descriptor, and mode. This function prepares the resolver for operation by initializing its internal state. Call this function before using the resolver to ensure it is in a valid state. The function does not perform any validation on the input parameters, so ensure that the provided values are correct and valid for the intended use.
- **Inputs**:
    - `ssresolve`: A pointer to an `fd_ssresolve_t` structure that will be initialized. Must not be null. The caller retains ownership.
    - `addr`: An `fd_ip4_port_t` representing the network address to use. Must be a valid address.
    - `sockfd`: An integer representing the socket file descriptor. Must be a valid, open socket descriptor.
    - `full`: An integer indicating the mode of operation. Valid values are implementation-specific.
- **Output**: None
- **See Also**: [`fd_ssresolve_init`](<fd_ssresolve.c.md#fd_ssresolve_init>)  (Implementation)


---
### fd\_ssresolve\_advance\_poll\_out<!-- {{#callable_declaration:fd_ssresolve_advance_poll_out}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L51>)

Advances the state machine when the socket is ready for sending data.
- **Description**: Use this function to progress the state machine of `fd_ssresolve_t` when its associated socket file descriptor is ready to send data. This function should be called in response to a poll event indicating that the socket is writable. It handles different states of the state machine and returns a status code indicating the result of the operation. Ensure that the `ssresolve` object is properly initialized before calling this function.
- **Inputs**:
    - `ssresolve`: A pointer to an `fd_ssresolve_t` object. This object must be initialized and not null. The function will use this object to determine the current state and perform the necessary actions to advance the state machine.
- **Output**: Returns an integer status code: `FD_SSRESOLVE_ADVANCE_ERROR` for a fatal error, `FD_SSRESOLVE_ADVANCE_AGAIN` to try again, or `FD_SSRESOLVE_ADVANCE_SUCCESS` for success.
- **See Also**: [`fd_ssresolve_advance_poll_out`](<fd_ssresolve.c.md#fd_ssresolve_advance_poll_out>)  (Implementation)


---
### fd\_ssresolve\_advance\_poll\_in<!-- {{#callable_declaration:fd_ssresolve_advance_poll_in}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L56>)

Advances the state machine when the socket is ready for receiving data.
- **Description**: Use this function to progress the state machine of `fd_ssresolve_t` when the associated socket file descriptor is ready to receive data. This function should be called in response to a readiness event for receiving data on the socket. It is important to ensure that the `ssresolve` object is properly initialized before calling this function. The function handles different states of the state machine and returns a status code indicating the result of the operation. If the state machine is in an unexpected state, an error code is returned.
- **Inputs**:
    - `ssresolve`: A pointer to an `fd_ssresolve_t` object. This must be a valid, initialized object and must not be null. The function will modify the state of this object.
    - `result`: A pointer to an `fd_ssresolve_result_t` structure where the result of the operation will be stored. This must not be null. The function writes to this structure if the operation is successful.
- **Output**: Returns an integer status code: `FD_SSRESOLVE_ADVANCE_SUCCESS` on success, `FD_SSRESOLVE_ADVANCE_AGAIN` if the operation should be retried, or `FD_SSRESOLVE_ADVANCE_ERROR` on a fatal error.
- **See Also**: [`fd_ssresolve_advance_poll_in`](<fd_ssresolve.c.md#fd_ssresolve_advance_poll_in>)  (Implementation)


---
### fd\_ssresolve\_is\_done<!-- {{#callable_declaration:fd_ssresolve_is_done}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssresolve.h#L63>)

Checks if the state machine is completed.
- **Description**: Use this function to determine if the state machine has completed its operations. This is useful to know when the state machine needs reinitialization. Call this function after performing operations that advance the state machine to check if it has reached completion. Ensure that the `ssresolve` object is valid and properly initialized before calling this function.
- **Inputs**:
    - `ssresolve`: A pointer to a `fd_ssresolve_t` object. Must not be null and must point to a valid and initialized state machine object. The function checks the state of this object to determine if the state machine is done.
- **Output**: Returns a non-zero value if the state machine is completed, otherwise returns zero.
- **See Also**: [`fd_ssresolve_is_done`](<fd_ssresolve.c.md#fd_ssresolve_is_done>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)