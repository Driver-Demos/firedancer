<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the functionality of the `fd_ssmanifest_parser` by reading and parsing a manifest file.

# Purpose
The code is an executable C program designed to parse a manifest file. It uses the `fd_ssmanifest_parser` to read and process the contents of a specified manifest file. The program begins by initializing the environment and checking for the correct number of command-line arguments. It expects a single argument, which is the path to the manifest file. The program then retrieves the file's size and sets up a workspace for memory allocation using shared memory parameters, which can be configured via command-line options.

The program reads the manifest file into a buffer and uses the `fd_ssmanifest_parser` to parse the data. It allocates memory for a `fd_snapshot_manifest_t` structure to store the parsed manifest data. The parsing process is timed, and the program logs the time taken to decode the manifest. The code includes error handling to log and terminate the program if any system calls or parsing operations fail. This program is intended to be run as a standalone executable and does not define public APIs or external interfaces.
# Imports and Dependencies

---
- `fd_ssmanifest_parser.h`
- `../../../flamenco//types/fd_types.h`
- `../../../util/fd_util.h`
- `unistd.h`
- `fcntl.h`
- `errno.h`
- `stdlib.h`
- `sys/stat.h`


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_ssmanifest_parser.c#L11>)

Initializes the environment, reads a manifest file, and parses its contents using a shared memory workspace.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Checks if the number of arguments is not equal to 2 and logs an error if true, then exits with failure.
    - Uses `stat` to get the size of the manifest file specified in `argv[1]` and logs an error if `stat` fails.
    - Determines the CPU index and adjusts it if it exceeds the shared memory CPU count.
    - Extracts command-line options for page size, page count, and NUMA index with default values.
    - Converts the page size string to an actual size and logs an error if the conversion fails.
    - Creates a new anonymous workspace with the specified page size, page count, and NUMA index, and checks if it is successful.
    - Allocates a buffer in the workspace to hold the file contents and checks if the allocation is successful.
    - Opens the manifest file for reading and logs an error if the file cannot be opened.
    - Reads the file contents into the buffer in a loop until all bytes are read or an error occurs.
    - Allocates memory for a `fd_snapshot_manifest_t` structure and checks if the allocation is successful.
    - Logs a notice about the number of bytes being parsed from the file.
    - Creates and initializes a parser for the manifest data.
    - Starts a timer to measure the parsing duration.
    - Consumes the buffer data with the parser and logs an error if parsing fails.
    - Calculates the elapsed time for parsing and logs a notice with the duration.
- **Output**: No explicit return value; exits with `EXIT_FAILURE` on error conditions.
- **Functions Called**:
    - [`fd_ssmanifest_parser_join`](<fd_ssmanifest_parser.c.md#fd_ssmanifest_parser_join>)
    - [`fd_ssmanifest_parser_new`](<fd_ssmanifest_parser.c.md#fd_ssmanifest_parser_new>)
    - [`fd_ssmanifest_parser_align`](<fd_ssmanifest_parser.c.md#fd_ssmanifest_parser_align>)
    - [`fd_ssmanifest_parser_footprint`](<fd_ssmanifest_parser.c.md#fd_ssmanifest_parser_footprint>)
    - [`fd_ssmanifest_parser_init`](<fd_ssmanifest_parser.c.md#fd_ssmanifest_parser_init>)
    - [`fd_ssmanifest_parser_consume`](<fd_ssmanifest_parser.c.md#fd_ssmanifest_parser_consume>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)