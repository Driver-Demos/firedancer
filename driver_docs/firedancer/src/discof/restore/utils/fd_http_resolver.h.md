<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Resolves snapshot slot information for HTTP snapshot peers through HTTP requests.

# Purpose
This C header file defines the interface for an HTTP resolver used to obtain snapshot slot information from HTTP snapshot peers. The resolver is necessary because these peers do not publish `SnapshotHashes` messages through gossip, requiring manual resolution via HTTP requests. The file declares a private structure `fd_http_resolver_t` and provides function prototypes for creating, managing, and advancing the resolver. Key functions include [`fd_http_resolver_new`](<#fd_http_resolver_new>) for initializing a new resolver, [`fd_http_resolver_add`](<#fd_http_resolver_add>) for adding peers, and [`fd_http_resolver_advance`](<#fd_http_resolver_advance>) for updating the resolver state over time. The resolver uses a callback mechanism, defined by `fd_http_resolver_on_resolve_fn_t`, to handle resolved information.
# Imports and Dependencies

---
- `fd_sspeer_selector.h`


# Data Structures

---
### fd\_http\_resolver\_t
- **Type**: ``struct``
- **Description**: Defines a type alias `fd_http_resolver_t` for the incomplete type `struct fd_http_resolver_private`, which is used to resolve snapshot slot information for HTTP snapshot peers that do not publish `SnapshotHashes` messages through gossip.


# Function Declarations (Public API)

---
### fd\_http\_resolver\_align<!-- {{#callable_declaration:fd_http_resolver_align}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_http_resolver.h#L20>)

Returns the alignment requirement for an HTTP resolver.
- **Description**: Use this function to obtain the alignment requirement for an HTTP resolver. This is necessary when allocating memory for the resolver to ensure proper alignment. The function does not require any parameters and can be called at any time to retrieve the alignment value.
- **Inputs**: None
- **Output**: The function returns an `ulong` representing the alignment requirement in bytes.
- **See Also**: [`fd_http_resolver_align`](<fd_http_resolver.c.md#fd_http_resolver_align>)  (Implementation)


---
### fd\_http\_resolver\_footprint<!-- {{#callable_declaration:fd_http_resolver_footprint}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_http_resolver.h#L25>)

Calculates the memory footprint required for an HTTP resolver.
- **Description**: Use this function to determine the amount of memory needed to create an HTTP resolver for a specified number of peers. This is useful for allocating the correct amount of shared memory before initializing the resolver. The function requires the number of peers as input and returns the total memory size in bytes. Ensure that the number of peers is correctly specified to avoid memory allocation issues.
- **Inputs**:
    - `peers_cnt`: The number of HTTP snapshot peers for which the resolver will be used. Must be a non-negative integer. The function assumes this value is valid and does not perform error checking on it.
- **Output**: Returns the size in bytes of the memory footprint required for the HTTP resolver.
- **See Also**: [`fd_http_resolver_footprint`](<fd_http_resolver.c.md#fd_http_resolver_footprint>)  (Implementation)


---
### fd\_http\_resolver\_new<!-- {{#callable_declaration:fd_http_resolver_new}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_http_resolver.h#L28>)

Create a new HTTP resolver instance.
- **Description**: Use this function to create a new HTTP resolver instance that resolves snapshot slot information for HTTP snapshot peers. This function requires a shared memory region to store the resolver data. Ensure that the shared memory is properly aligned and that the number of peers is at least one. The function also requires a callback function to handle resolution events and an optional argument for the callback. If the shared memory is null, unaligned, or if the number of peers is less than one, the function returns null.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region where the resolver data will be stored. Must not be null and must be aligned according to `fd_http_resolver_align()`.
    - `peers_cnt`: The number of peers to manage. Must be at least 1.
    - `incremental_snapshot_fetch`: An integer flag indicating whether to use incremental snapshot fetching.
    - `on_resolve_cb`: A callback function of type `fd_http_resolver_on_resolve_fn_t` that is called when a resolution event occurs.
    - `cb_arg`: An optional argument passed to the callback function `on_resolve_cb`.
- **Output**: Returns a pointer to the newly created HTTP resolver instance, or null if an error occurs.
- **See Also**: [`fd_http_resolver_new`](<fd_http_resolver.c.md#fd_http_resolver_new>)  (Implementation)


---
### fd\_http\_resolver\_add<!-- {{#callable_declaration:fd_http_resolver_add}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_http_resolver.h#L37>)

Add a peer to the HTTP resolver.
- **Description**: Use this function to add a new peer to the HTTP resolver for snapshot slot information resolution. Ensure that each peer added is unique, as the function does not perform de-duplication. This function must be called with a valid resolver that has been properly initialized. If the peer pool is exhausted, the function will log an error.
- **Inputs**:
    - `resolver`: A pointer to an `fd_http_resolver_t` structure. This must be a valid and initialized resolver. The caller retains ownership.
    - `addr`: An `fd_ip4_port_t` value representing the address of the peer to add. The address must be unique among peers already added to the resolver.
- **Output**: None
- **See Also**: [`fd_http_resolver_add`](<fd_http_resolver.c.md#fd_http_resolver_add>)  (Implementation)


---
### fd\_http\_resolver\_join<!-- {{#callable_declaration:fd_http_resolver_join}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_http_resolver.h#L41>)

Converts a shared memory pointer to a resolver object.
- **Description**: Use this function to obtain a `fd_http_resolver_t` object from a shared memory pointer. The shared memory pointer must be correctly aligned and initialized with the correct magic number. This function is typically called after creating a resolver with `fd_http_resolver_new`. If the input pointer is null, misaligned, or does not have the correct magic number, the function returns null and logs a warning.
- **Inputs**:
    - `shresolver`: A pointer to shared memory that should represent a `fd_http_resolver_t` object. It must not be null, must be aligned according to `fd_http_resolver_align`, and must have the correct magic number `FD_HTTP_RESOLVER_MAGIC`. If these conditions are not met, the function returns null.
- **Output**: Returns a pointer to a `fd_http_resolver_t` object if successful, or null if the input is invalid.
- **See Also**: [`fd_http_resolver_join`](<fd_http_resolver.c.md#fd_http_resolver_join>)  (Implementation)


---
### fd\_http\_resolver\_advance<!-- {{#callable_declaration:fd_http_resolver_advance}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_http_resolver.h#L48>)

Advances the resolver to update peer states based on the current time.
- **Description**: Use this function to periodically update the state of peers in the resolver based on the current time. It processes peers in different states, such as unresolved, resolving, invalid, and valid, and updates their states and deadlines accordingly. This function also interacts with the selector to remove invalid peers. Call this function regularly to ensure that peer states are up-to-date and to manage peer connections effectively.
- **Inputs**:
    - `resolver`: A pointer to an `fd_http_resolver_t` object. Must not be null. Represents the resolver whose peer states are to be advanced.
    - `now`: A long integer representing the current time in nanoseconds. Used to compare against peer deadlines.
    - `selector`: A pointer to an `fd_sspeer_selector_t` object. Must not be null. Used to remove invalid peers from the selector.
- **Output**: None
- **See Also**: [`fd_http_resolver_advance`](<fd_http_resolver.c.md#fd_http_resolver_advance>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)