<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for parsing slot delta entries in the Firedancer codebase.

# Purpose
This C header file defines data structures and function prototypes for a slot delta parser used in transaction processing. It includes definitions for `fd_sstxncache_entry_t` and `fd_slot_entry_t` structures, which store transaction and slot information, respectively. The file sets up a pool and map for managing slot entries, using templates from included utility files. It defines function pointer types for processing groups and entries, and provides function prototypes for creating, joining, leaving, deleting, and initializing a slot delta parser. Additionally, it defines constants for error codes and results related to advancing the parser through a buffer of transaction data. The parser processes transaction data by consuming a buffer and updating the result structure with the number of bytes consumed and the relevant transaction or group information.
# Imports and Dependencies

---
- `../../../util/fd_util_base.h`
- `../../../util/tmpl/fd_pool.c`
- `../../../util/tmpl/fd_map_chain.c`


# Data Structures

---
### fd\_slot\_delta\_parser\_t
- **Type**: ``fd_slot_delta_parser_t``
- **Members**:
    - ``fd_slot_delta_parser_private``: A forward declaration for the private structure used internally by `fd_slot_delta_parser_t`.
- **Description**: `fd_slot_delta_parser_t` is a typedef for a structure that is used to parse slot delta data. The actual structure definition is not provided in the code, indicating that it is likely defined elsewhere or intended to be opaque to users of the API. This data structure is part of a system that processes slot delta information, which involves handling entries and groups of transactions identified by block hashes and transaction hashes. The parser provides functions for initialization, joining, leaving, and deleting parser instances, as well as consuming data buffers to produce parsing results.


---
### fd\_sstxncache\_entry
- **Type**: ``struct``
- **Members**:
    - `slot`: An unsigned long integer that identifies a specific slot.
    - `blockhash`: An array of 32 unsigned characters that stores the block hash.
    - `txnhash`: An array of 20 unsigned characters that stores the transaction hash.
    - `result`: An unsigned character that stores the result of the transaction.
- **Description**: Represents an entry in a transaction cache with fields for slot identification, block hash, transaction hash, and transaction result. This structure is used to store and manage transaction data efficiently within a cache system.


---
### fd\_sstxncache\_entry\_t
- **Type**: ``struct``
- **Members**:
    - `slot`: An unsigned long integer that represents the slot number.
    - `blockhash`: An array of 32 unsigned characters that stores the block hash.
    - `txnhash`: An array of 20 unsigned characters that stores the transaction hash.
    - `result`: An unsigned character that stores the result of the transaction.
- **Description**: Stores information about a transaction cache entry, including the slot number, block hash, transaction hash, and the result of the transaction.


---
### fd\_slot\_entry
- **Type**: ``struct``
- **Members**:
    - `slot`: Stores an unsigned long integer representing the slot identifier.
    - `pool`: Contains a nested `struct` with a `next` field for linking to the next pool entry.
    - `map`: Contains a nested `struct` with `next` and `prev` fields for linking to the next and previous map entries.
- **Description**: Defines a structure for managing slot entries with fields for slot identification and linked list management in both pool and map contexts.


---
### fd\_slot\_entry\_t
- **Type**: ``struct``
- **Members**:
    - `slot`: Stores the slot number as an unsigned long integer.
    - `pool`: Contains a nested structure with a `next` field for pool management.
    - `map`: Contains a nested structure with `next` and `prev` fields for map management.
- **Description**: Defines a structure used to represent an entry in a slot management system, with fields for slot identification and linked list management for both pool and map operations.


---
### fd\_slot\_delta\_parser\_advance\_result
- **Type**: ``struct``
- **Members**:
    - `bytes_consumed`: The number of bytes processed during the parsing operation.
    - `entry`: A pointer to a `fd_sstxncache_entry_t` structure, representing a single transaction cache entry.
    - `blockhash`: A pointer to a constant unsigned character array representing the block hash in a group of transactions.
    - `txnhash_offset`: The offset of the transaction hash within the block.
- **Description**: Represents the result of advancing the slot delta parser, indicating how many bytes were consumed and providing either a single transaction cache entry or details about a group of transactions, including a block hash and transaction hash offset.


---
### fd\_slot\_delta\_parser\_advance\_result\_t
- **Type**: ``struct``
- **Members**:
    - ``bytes_consumed``: Indicates the number of bytes processed during the parsing operation.
    - ``entry``: Points to a constant `fd_sstxncache_entry_t` structure when an entry is processed.
    - ``group.blockhash``: Points to a constant block hash when a group is processed.
    - ``group.txnhash_offset``: Indicates the transaction hash offset within the group when a group is processed.
- **Description**: Represents the result of advancing the slot delta parser, containing information about the number of bytes consumed and either an entry or a group of entries processed during the operation.


# Function Declarations (Public API)

---
### fd\_slot\_delta\_parser\_align<!-- {{#callable_declaration:fd_slot_delta_parser_align}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L57>)

Returns the alignment requirement for a slot delta parser.
- **Description**: Use this function to obtain the alignment requirement for a slot delta parser. This is necessary when allocating memory for a slot delta parser to ensure proper alignment. The function returns the maximum alignment requirement between the `fd_slot_delta_parser_t` structure and the slot set alignment. This function does not require any parameters and can be called at any time.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement in bytes.
- **See Also**: [`fd_slot_delta_parser_align`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_align>)  (Implementation)


---
### fd\_slot\_delta\_parser\_footprint<!-- {{#callable_declaration:fd_slot_delta_parser_footprint}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L62>)

Calculates the memory footprint required for a slot delta parser.
- **Description**: Use this function to determine the amount of memory needed to allocate for a slot delta parser. This is useful when setting up memory resources for the parser. The function does not require any parameters and can be called at any time to get the current memory footprint requirement.
- **Inputs**: None
- **Output**: Returns the size in bytes of the memory footprint required for a slot delta parser.
- **See Also**: [`fd_slot_delta_parser_footprint`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_footprint>)  (Implementation)


---
### fd\_slot\_delta\_parser\_new<!-- {{#callable_declaration:fd_slot_delta_parser_new}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L65>)

Creates a new slot delta parser instance.
- **Description**: Use this function to create a new instance of a slot delta parser. It requires a shared memory region that is properly aligned. The function initializes the parser and its associated resources. If the provided shared memory is null or not aligned correctly, the function returns null and logs a warning. Ensure that the shared memory is aligned according to the alignment requirements of the parser before calling this function.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region. Must not be null and must be aligned according to `fd_slot_delta_parser_align()`. The caller retains ownership of the memory.
- **Output**: Returns a pointer to the newly created slot delta parser instance, or null if the input is invalid.
- **See Also**: [`fd_slot_delta_parser_new`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_new>)  (Implementation)


---
### fd\_slot\_delta\_parser\_join<!-- {{#callable_declaration:fd_slot_delta_parser_join}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L68>)

Joins a shared memory region as a slot delta parser.
- **Description**: Use this function to join a shared memory region that represents a slot delta parser. This function is typically called after the shared memory has been initialized with `fd_slot_delta_parser_new`. It is important to ensure that the `shmem` parameter points to a valid shared memory region that has been properly set up for use as a slot delta parser. This function does not perform any validation on the `shmem` parameter, so passing an invalid pointer can lead to undefined behavior.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region. Must be a valid pointer to a memory region initialized for use as a slot delta parser. The function does not validate this pointer, so invalid input can cause undefined behavior.
- **Output**: Returns a pointer to `fd_slot_delta_parser_t`, which represents the joined slot delta parser.
- **See Also**: [`fd_slot_delta_parser_join`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_join>)  (Implementation)


---
### fd\_slot\_delta\_parser\_leave<!-- {{#callable_declaration:fd_slot_delta_parser_leave}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L71>)

Returns the parser to the caller.
- **Description**: Use this function to safely leave or detach from a parser instance. It is typically called when the parser is no longer needed, and the caller wants to release any resources or references associated with it. Ensure that the parser is in a valid state before calling this function to avoid undefined behavior.
- **Inputs**:
    - `parser`: A pointer to a `fd_slot_delta_parser_t` instance. Must not be null. The function returns this pointer back to the caller.
- **Output**: Returns the `parser` pointer back to the caller.
- **See Also**: [`fd_slot_delta_parser_leave`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_leave>)  (Implementation)


---
### fd\_slot\_delta\_parser\_delete<!-- {{#callable_declaration:fd_slot_delta_parser_delete}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L74>)

Deletes a slot delta parser from shared memory.
- **Description**: Use this function to remove a slot delta parser from shared memory when it is no longer needed. This function is typically called after the parser has been joined and used, and it is important to ensure that no other operations are performed on the parser after deletion. The function returns the same pointer that was passed to it, allowing for potential reuse or further management of the shared memory.
- **Inputs**:
    - `shmem`: A pointer to the shared memory region where the slot delta parser is stored. The pointer must not be null, and it should point to a valid slot delta parser that was previously created. The function does not perform any validation on the pointer.
- **Output**: Returns the same pointer to shared memory that was passed as input.
- **See Also**: [`fd_slot_delta_parser_delete`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_delete>)  (Implementation)


---
### fd\_slot\_delta\_parser\_init<!-- {{#callable_declaration:fd_slot_delta_parser_init}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L77>)

Initializes a slot delta parser structure.
- **Description**: Use this function to prepare a `fd_slot_delta_parser_t` structure for use. It sets the initial state and clears any existing data in the parser. Call this function before using the parser to ensure it is in a known state. This function does not allocate memory, so the caller must ensure that the `parser` parameter points to a valid memory location.
- **Inputs**:
    - `parser`: A pointer to a `fd_slot_delta_parser_t` structure. Must not be null. The caller must allocate and manage the memory for this structure. The function initializes the structure's fields to default values.
- **Output**: None
- **See Also**: [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)  (Implementation)


---
### fd\_slot\_delta\_parser\_consume<!-- {{#callable_declaration:fd_slot_delta_parser_consume}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_slot_delta_parser.h#L103>)

Consumes data from a buffer and updates the parser state.
- **Description**: Use this function to process data from a buffer and update the state of the parser. It must be called with a valid parser that has been initialized. The function processes the buffer data and updates the parser's internal state, potentially advancing to a new entry or group. It handles cases where the buffer contains more data than needed, returning an error in such cases. The function also updates the result structure with the number of bytes consumed and relevant entry or group information.
- **Inputs**:
    - `parser`: A pointer to an initialized `fd_slot_delta_parser_t` structure. Must not be null. The function updates the state of this parser.
    - `buf`: A pointer to the buffer containing data to be consumed. Must not be null. The function reads from this buffer.
    - `bufsz`: The size of the buffer in bytes. Must be greater than zero. The function processes up to this many bytes from the buffer.
    - `result`: A pointer to a `fd_slot_delta_parser_advance_result_t` structure. Must not be null. The function updates this structure with the number of bytes consumed and information about the current entry or group.
- **Output**: Returns an integer indicating the result of the operation. Possible return values include success, advancement to a new entry or group, or various error codes indicating specific issues.
- **See Also**: [`fd_slot_delta_parser_consume`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_consume>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)