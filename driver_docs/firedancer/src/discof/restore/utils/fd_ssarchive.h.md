<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for parsing snapshot filenames, finding the latest snapshot pair, and removing old snapshots.

# Purpose
This C header file defines functions for managing snapshot files in a filesystem. It includes utility headers and declares three main functions. The [`fd_ssarchive_parse_filename`](<#fd_ssarchive_parse_filename>) function parses snapshot filenames into components, identifying whether they are full or incremental snapshots and extracting relevant metadata such as slot numbers and hashes. The [`fd_ssarchive_latest_pair`](<#fd_ssarchive_latest_pair>) function identifies the latest snapshot pair (full and incremental) in a given directory, returning the highest incremental slot and corresponding file paths. The [`fd_ssarchive_remove_old_snapshots`](<#fd_ssarchive_remove_old_snapshots>) function removes older snapshots based on specified limits for the number of full and incremental snapshots to retain. These functions facilitate the organization and maintenance of snapshot files in a storage system.
# Imports and Dependencies

---
- `../../../util/fd_util_base.h`
- `../../../flamenco/types/fd_types_custom.h`


# Function Declarations (Public API)

---
### fd\_ssarchive\_parse\_filename<!-- {{#callable_declaration:fd_ssarchive_parse_filename}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssarchive.h#L7>)

Parse a snapshot filename into its components.
- **Description**: Use this function to extract components from a snapshot filename, which can be either a full or incremental snapshot. The function expects a specific filename format and returns a status code indicating success or failure. On success, it sets the full slot and, if applicable, the incremental slot and hash. The function returns -1 if the filename format is invalid or if any parsing step fails.
- **Inputs**:
    - `_name`: A pointer to a null-terminated string representing the snapshot filename. Must not be null and must follow the expected format for parsing to succeed.
    - `full_slot`: A pointer to an unsigned long where the function will store the parsed full slot number. Must not be null.
    - `incremental_slot`: A pointer to an unsigned long where the function will store the parsed incremental slot number if applicable, or ULONG_MAX if not. Must not be null.
    - `hash`: An array of unsigned characters with a size of at least `FD_HASH_FOOTPRINT` where the function will store the base58 decoded hash. Must not be null.
- **Output**: Returns 0 on success, with `full_slot`, `incremental_slot`, and `hash` set accordingly. Returns -1 on failure, with no guarantees on the state of the output parameters.
- **See Also**: [`fd_ssarchive_parse_filename`](<fd_ssarchive.c.md#fd_ssarchive_parse_filename>)  (Implementation)


---
### fd\_ssarchive\_latest\_pair<!-- {{#callable_declaration:fd_ssarchive_latest_pair}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssarchive.h#L35>)

Determine the latest full and incremental snapshot pair in a directory.
- **Description**: Use this function to find the latest snapshot pair in a specified directory. It identifies the highest incremental slot associated with a full snapshot. If `incremental_snapshot` is zero, only the latest full snapshot is considered. Ensure the directory exists and is accessible. The function returns -1 if it cannot find a valid snapshot or encounters an error, and 0 on success. It updates the provided slot and path variables with the latest snapshot information.
- **Inputs**:
    - `directory`: A string representing the path to the directory to search. Must not be null and should point to a valid directory.
    - `incremental_snapshot`: An integer flag indicating whether to consider incremental snapshots. If non-zero, the function searches for both full and incremental snapshots.
    - `full_slot`: A pointer to an unsigned long where the function stores the slot number of the latest full snapshot. Must not be null.
    - `incremental_slot`: A pointer to an unsigned long where the function stores the slot number of the latest incremental snapshot. Must not be null. Set to ULONG_MAX if no incremental snapshot is found or if `incremental_snapshot` is zero.
    - `full_path`: A character array with a size of at least PATH_MAX where the function stores the path to the latest full snapshot. Must not be null.
    - `incremental_path`: A character array with a size of at least PATH_MAX where the function stores the path to the latest incremental snapshot. Must not be null. Set to an empty string if no incremental snapshot is found or if `incremental_snapshot` is zero.
- **Output**: Returns 0 on success and -1 on failure. Updates `full_slot`, `incremental_slot`, `full_path`, and `incremental_path` with the latest snapshot information.
- **See Also**: [`fd_ssarchive_latest_pair`](<fd_ssarchive.c.md#fd_ssarchive_latest_pair>)  (Implementation)


---
### fd\_ssarchive\_remove\_old\_snapshots<!-- {{#callable_declaration:fd_ssarchive_remove_old_snapshots}} -->
[View Source →](<../../../../../../src/discof/restore/utils/fd_ssarchive.h#L47>)

Remove old snapshots from a directory based on specified limits.
- **Description**: Use this function to manage the number of snapshot files in a directory by removing older snapshots. It ensures that the number of full and incremental snapshots does not exceed the specified limits. This function must be called with a valid directory path. If the directory does not exist, the function returns without error. It is important to ensure that the directory is accessible and that the caller has the necessary permissions to delete files within it. The function does not return any value and performs its operation directly on the filesystem.
- **Inputs**:
    - `directory`: A string representing the path to the directory containing snapshot files. Must not be null. If the directory does not exist, the function returns without error.
    - `max_full_snapshots_to_keep`: An unsigned integer specifying the maximum number of full snapshots to retain. Must be a non-negative value.
    - `max_incremental_snapshots_to_keep`: An unsigned integer specifying the maximum number of incremental snapshots to retain. Must be a non-negative value.
- **Output**: None
- **See Also**: [`fd_ssarchive_remove_old_snapshots`](<fd_ssarchive.c.md#fd_ssarchive_remove_old_snapshots>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)