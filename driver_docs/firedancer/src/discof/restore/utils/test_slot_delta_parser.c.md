<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the `fd_slot_delta_parser` with various scenarios including errors and multiple entries.

# Purpose
The code is a C test suite for a slot delta parser, which is part of a larger system that processes transaction cache entries. It includes a series of test functions that validate the behavior of the `fd_slot_delta_parser` by simulating various input scenarios and error conditions. The test suite uses mock data to simulate transaction entries and their associated errors, such as transaction errors, instruction errors, and custom errors. The test functions, such as [`test_one_entry`](<#test_one_entry>), [`test_one_entry_with_txn_error`](<#test_one_entry_with_txn_error>), and [`test_multiple_entries`](<#test_multiple_entries>), verify that the parser correctly processes these inputs and handles errors as expected.

The code defines several callback functions, such as [`entry_cb_no_err`](<#entry_cb_no_err>) and [`entry_cb_with_txn_err`](<#entry_cb_with_txn_err>), which are used to check the correctness of the parsed entries against expected values. The [`mock_one_input`](<#mock_one_input>) and [`mock_slot_delta_input`](<#mock_slot_delta_input>) functions generate mock input data for the parser, while the [`insert_error`](<#insert_error>) function injects specific error types into the input data. The [`consume`](<#consume>) function processes the input data using the parser and invokes the appropriate callback function based on the parsing result. The [`main`](<#main>) function initializes the parser, runs the test cases, and manages memory allocation for the parser's workspace. This test suite ensures that the slot delta parser functions correctly under various conditions and error scenarios.
# Imports and Dependencies

---
- `fd_slot_delta_parser.h`
- `../../../util/fd_util.h`


# Functions

---
### entry\_cb\_no\_err<!-- {{#callable:entry_cb_no_err}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L8>)

Validates that the `entry` structure has specific expected values for its fields.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure that contains the fields to validate.
- **Logic and Control Flow**:
    - Checks if `entry->slot` is equal to `1000UL` using `FD_TEST` macro.
    - Validates that the first three elements of `entry->blockhash` are `1`, `2`, and `3` respectively.
    - Ensures that the first three elements of `entry->txnhash` are `4`, `5`, and `6` respectively.
    - Confirms that `entry->result` is equal to `0U`.
- **Output**: No output is returned; the function performs validation checks using assertions.


---
### entry\_cb\_with\_txn\_err<!-- {{#callable:entry_cb_with_txn_err}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L16>)

Validates that the `fd_sstxncache_entry_t` entry has specific expected values for its fields.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure that contains the entry data to validate.
- **Logic and Control Flow**:
    - Checks if `entry->slot` is equal to `1000UL` using `FD_TEST` macro.
    - Validates that the first three elements of `entry->blockhash` are `1`, `2`, and `3` respectively.
    - Ensures that the first three elements of `entry->txnhash` are `4`, `5`, and `6` respectively.
    - Confirms that `entry->result` is equal to `42U`.
- **Output**: No output is returned; the function uses assertions to validate the entry.


---
### entry\_cb\_with\_txn\_custom\_err<!-- {{#callable:entry_cb_with_txn_custom_err}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L24>)

Validates that the `fd_sstxncache_entry_t` structure has specific expected values for its fields.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure that contains the transaction cache entry to validate.
- **Logic and Control Flow**:
    - Check if `entry->slot` is equal to `1000UL` using `FD_TEST` macro.
    - Verify that the first three elements of `entry->blockhash` are `1`, `2`, and `3` respectively using `FD_TEST` macro.
    - Ensure that the first three elements of `entry->txnhash` are `4`, `5`, and `6` respectively using `FD_TEST` macro.
    - Confirm that `entry->result` is equal to `12U` using `FD_TEST` macro.
- **Output**: No output is returned; the function uses assertions to validate the input.


---
### entry\_cb\_with\_instr\_err<!-- {{#callable:entry_cb_with_instr_err}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L32>)

Validates that the `fd_sstxncache_entry_t` structure has specific expected values for its fields.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure that contains the fields to validate.
- **Logic and Control Flow**:
    - Checks if the `slot` field of `entry` is equal to `1000UL` using `FD_TEST` macro.
    - Validates that the first three elements of the `blockhash` array in `entry` are `1`, `2`, and `3` respectively.
    - Validates that the first three elements of the `txnhash` array in `entry` are `4`, `5`, and `6` respectively.
    - Checks if the `result` field of `entry` is equal to `15U`.
- **Output**: No output is returned; the function uses assertions to validate the input.


---
### entry\_cb\_with\_instr\_custom\_err<!-- {{#callable:entry_cb_with_instr_custom_err}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L40>)

Validates that the `fd_sstxncache_entry_t` structure has specific expected values for its fields.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure that contains the entry data to validate.
- **Logic and Control Flow**:
    - Checks if `entry->slot` is equal to `1000UL` using `FD_TEST` macro.
    - Validates that the first three elements of `entry->blockhash` are `1`, `2`, and `3` respectively.
    - Ensures that the first three elements of `entry->txnhash` are `4`, `5`, and `6` respectively.
    - Confirms that `entry->result` is equal to `16U`.
- **Output**: No output is returned; the function performs validation checks using assertions.


---
### entry\_cb\_with\_instr\_borsh\_io\_err<!-- {{#callable:entry_cb_with_instr_borsh_io_err}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L48>)

Validates that the `fd_sstxncache_entry_t` structure has specific values for its fields, indicating an instruction Borsh IO error.
- **Inputs**:
    - `entry`: A pointer to a `fd_sstxncache_entry_t` structure that contains the transaction cache entry data to validate.
- **Logic and Control Flow**:
    - Checks if `entry->slot` is equal to `1000UL` using `FD_TEST` macro.
    - Validates that the first three elements of `entry->blockhash` are `1`, `2`, and `3` respectively.
    - Ensures that the first three elements of `entry->txnhash` are `4`, `5`, and `6` respectively.
    - Confirms that `entry->result` is equal to `44U`.
- **Output**: No output is returned; the function uses assertions to validate the input data.


---
### entry\_cb\_multiple<!-- {{#callable:entry_cb_multiple}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L56>)

Validates the fields of a `fd_sstxncache_entry_t` structure based on a static call count.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure that contains the fields to validate.
- **Logic and Control Flow**:
    - Initialize a static variable `call_cnt` to track the number of times the function is called.
    - Check if `call_cnt` is less than 7; if true, verify that `entry->slot` is 1000, otherwise verify it is 1001.
    - Check if `call_cnt` is less than 6; if true, verify that all elements of `entry->blockhash` are 0.
    - If `call_cnt` equals 6, verify that the first element of `entry->blockhash` is 0 and the other two elements are equal to `call_cnt`.
    - If `call_cnt` is greater than 6, verify that the first element of `entry->blockhash` is 1 and the other two elements are 7.
    - Verify that all elements of `entry->txnhash` are equal to `call_cnt`.
    - Check if `call_cnt` is less than 5; if true, verify that `entry->result` is equal to `call_cnt`.
    - If `call_cnt` equals 5, verify that `entry->result` is 44.
    - If `call_cnt` equals 6, verify that `entry->result` is 0.
    - If `call_cnt` is between 7 and 11, verify that `entry->result` is `call_cnt - 7`.
    - If `call_cnt` is 12 or more, verify that `entry->result` is 44.
    - Increment `call_cnt` by 1.
    - If `call_cnt` reaches 13, reset it to 0.
- **Output**: No return value; the function performs validation checks and updates a static counter.


---
### entry\_cb\_multiple\_v2<!-- {{#callable:entry_cb_multiple_v2}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L78>)

Validates the fields of `fd_sstxncache_entry_t` based on a static call count and resets the count after 11 calls.
- **Inputs**:
    - `entry`: A pointer to a constant `fd_sstxncache_entry_t` structure containing the fields to validate.
- **Logic and Control Flow**:
    - Initialize a static counter `call_cnt` to 0.
    - If `call_cnt` is less than 6, check if `entry->slot` is 1000; otherwise, check if it is 1002.
    - If `call_cnt` is less than 5, verify that all elements of `entry->blockhash` are 0; if `call_cnt` is 5, verify that the second and third elements are equal to `call_cnt`; otherwise, verify that the first element is 2 and the second and third elements are 6.
    - Verify that all elements of `entry->txnhash` are equal to `call_cnt`.
    - If `call_cnt` is less than 5, check if `entry->result` is equal to `call_cnt`; if `call_cnt` is 5, check if `entry->result` is 0; otherwise, check if `entry->result` is `call_cnt - 6`.
    - Increment `call_cnt` by 1.
    - If `call_cnt` reaches 11, reset it to 0.
- **Output**: No return value; the function performs validation checks and updates a static counter.


---
### mock\_one\_input<!-- {{#callable:mock_one_input}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L98>)

Initializes a memory buffer with specific data values for testing purposes.
- **Inputs**:
    - ``input``: A pointer to a memory buffer where data will be written.
    - ``input_sz``: The size of the input buffer, which must be at least 93 bytes.
    - ``is_root``: An integer flag indicating if the input is a root (1 for true, 0 for false).
    - ``slot``: An unsigned long integer representing the slot number to be written into the buffer.
- **Logic and Control Flow**:
    - Checks if `input_sz` is at least 93 bytes using `FD_TEST` macro.
    - Initializes a pointer `p` to the start of the `input` buffer.
    - Writes the value 1 as an unsigned long integer to the buffer and advances the pointer by the size of an unsigned long.
    - Writes the `slot` value as an unsigned long integer to the buffer and advances the pointer.
    - Writes the `is_root` value as a single byte to the buffer and advances the pointer.
    - Writes the value 1 as an unsigned long integer to the buffer and advances the pointer.
    - Copies a predefined `blockhash` array of 32 bytes into the buffer and advances the pointer.
    - Writes the value 12345 as an unsigned long integer to the buffer and advances the pointer.
    - Writes the value 1 as an unsigned long integer to the buffer and advances the pointer.
    - Copies a predefined `key_slice` array of 20 bytes into the buffer and advances the pointer.
- **Output**: No return value; the function modifies the `input` buffer in place.


---
### insert\_error<!-- {{#callable:insert_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L148>)

Inserts an error code into a given input buffer based on the specified error type.
- **Inputs**:
    - ``input``: A pointer to the input buffer where the error code will be inserted.
    - ``input_sz``: The size of the input buffer.
    - ``error_type``: The type of error to insert, which determines the format and content of the error data.
    - ``error_code``: The specific error code to insert, used in conjunction with the error type.
- **Logic and Control Flow**:
    - Initialize a pointer `p` to the start of the `input` buffer.
    - Use a `switch` statement to handle different `error_type` cases.
    - For each `error_type`, check if `input_sz` is sufficient using `FD_TEST`.
    - Depending on the `error_type`, write specific error data into the buffer pointed by `p`.
    - Advance the pointer `p` by the size of the data written.
    - If `error_type` is unknown, log an error using `FD_LOG_ERR`.
- **Output**: Returns a pointer to the position in the buffer immediately after the inserted error data.


---
### mock\_one\_input\_with\_error<!-- {{#callable:mock_one_input_with_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L225>)

Prepares an input buffer by mocking data and inserting an error based on specified parameters.
- **Inputs**:
    - ``input``: A pointer to an unsigned character array where the function will write data.
    - ``input_sz``: The size of the input buffer, which must be at least 93 bytes.
    - ``is_root``: An integer flag indicating if the input is a root entry.
    - ``slot``: An unsigned long representing the slot number to be used in the input data.
    - ``error_type``: An unsigned integer specifying the type of error to insert.
    - ``error_code``: An unsigned integer specifying the error code to use with the error type.
- **Logic and Control Flow**:
    - Checks that `input_sz` is at least 93 bytes using `FD_TEST` macro.
    - Calls [`mock_one_input`](<#mock_one_input>) to populate the first 93 bytes of the `input` buffer with mock data.
    - Advances the pointer `p` by 93 bytes to point to the remaining space in the `input` buffer.
    - Calls [`insert_error`](<#insert_error>) to insert an error into the `input` buffer starting from the 94th byte, using the remaining buffer size and the specified `error_type` and `error_code`.
- **Output**: No return value; the function modifies the `input` buffer in place.
- **Functions Called**:
    - [`mock_one_input`](<#mock_one_input>)
    - [`insert_error`](<#insert_error>)


---
### mock\_slot\_delta\_input<!-- {{#callable:mock_slot_delta_input}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L240>)

Populates a buffer with slot delta data, including slots, statuses, cache statuses, and error information.
- **Inputs**:
    - ``input``: Pointer to the buffer where the slot delta data will be written.
    - ``input_sz``: Size of the input buffer.
    - ``num_slot_deltas``: Number of slot deltas to process.
    - ``slots``: Array of slot identifiers.
    - ``num_statuses``: Array indicating the number of statuses for each slot delta.
    - ``num_cache_statuses``: Array indicating the number of cache statuses for each status.
    - ``error_types``: Array of error types for each cache status.
    - ``error_codes``: Array of error codes corresponding to each error type.
- **Logic and Control Flow**:
    - Initialize a pointer `p` to the start of the `input` buffer and a counter `num_entries` to zero.
    - Write the number of slot deltas (`num_slot_deltas`) to the buffer and advance the pointer `p`.
    - Iterate over each slot delta, writing the slot identifier and setting `is_root` to 1, then advance the pointer `p`.
    - For each slot delta, write the number of statuses and iterate over each status.
    - For each status, generate a blockhash, write it to the buffer, and advance the pointer `p`.
    - Write a fixed transaction index (12345) to the buffer and advance the pointer `p`.
    - Write the number of cache statuses for the current status and iterate over each cache status.
    - For each cache status, generate a key slice, write it to the buffer, and advance the pointer `p`.
    - Call [`insert_error`](<#insert_error>) to insert error information into the buffer, then increment `num_entries`.
- **Output**: Returns a pointer to the position in the buffer immediately after the last written byte.
- **Functions Called**:
    - [`insert_error`](<#insert_error>)


---
### consume<!-- {{#callable:consume}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L290>)

Consumes input data using a parser and processes entries through a callback function, handling errors as specified.
- **Inputs**:
    - `parser`: A pointer to a `fd_slot_delta_parser_t` structure used to parse the input data.
    - `input`: A pointer to the input data to be consumed.
    - `input_sz`: The size of the input data in bytes.
    - `cb`: A callback function of type `entry_cb_t` to process each parsed entry.
    - `expect_err`: An integer flag indicating whether an error is expected during parsing.
    - `expected_err_code`: The expected error code if an error occurs during parsing.
- **Logic and Control Flow**:
    - Initialize a result array of type `fd_slot_delta_parser_advance_result_t` to store parsing results.
    - Set `bytes` to the size of the input data (`input_sz`).
    - Enter a loop that continues while there are bytes left to process (`bytes`).
    - Call [`fd_slot_delta_parser_consume`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_consume>) to parse the input data, updating the result array and returning a status code (`res`).
    - If `res` indicates an entry was successfully parsed (`FD_SLOT_DELTA_PARSER_ADVANCE_ENTRY`), call the callback function `cb` with the parsed entry.
    - If `res` indicates parsing is complete (`FD_SLOT_DELTA_PARSER_ADVANCE_DONE`), exit the loop.
    - If `res` is negative, indicating an error, verify that an error was expected (`expect_err`) and that the error code matches `expected_err_code`, then return.
    - Update the input pointer and decrement `bytes` by the number of bytes consumed as indicated by `result->bytes_consumed`.
- **Output**: No direct output; the function processes input data and invokes a callback function for each parsed entry.
- **Functions Called**:
    - [`fd_slot_delta_parser_consume`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_consume>)


---
### test\_one\_entry<!-- {{#callable:test_one_entry}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L317>)

Initializes a parser, creates a mock input with no error, and processes it using a callback to verify the entry.
- **Inputs**:
    - `parser`: A pointer to `fd_slot_delta_parser_t`, which is the parser to initialize and use for processing the input.
- **Logic and Control Flow**:
    - Declare an array `input` of 97 unsigned characters.
    - Call [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>) to initialize the parser.
    - Call [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate `input` with mock data, specifying no error (`MOCK_ERROR_TYPE_NONE`).
    - Call [`consume`](<#consume>) to process the `input` using the `parser`, with `entry_cb_no_err` as the callback function, and no expected error.
- **Output**: No return value; the function performs operations and validations internally.
- **Functions Called**:
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`consume`](<#consume>)


---
### test\_one\_entry\_not\_root<!-- {{#callable:test_one_entry_not_root}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L325>)

Tests the behavior of the parser when processing a non-root entry and expects a specific error code.
- **Inputs**:
    - ``parser``: A pointer to an `fd_slot_delta_parser_t` structure that the function will initialize and use for parsing.
- **Logic and Control Flow**:
    - Declare an array `input` of 97 unsigned characters.
    - Call [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate `input` with test data, specifying that the entry is not a root (is_root = 0).
    - Initialize the parser using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`consume`](<#consume>) with the parser, `input`, and other parameters, expecting an error with code `FD_SLOT_DELTA_PARSER_ADVANCE_ERROR_SLOT_IS_NOT_ROOT`.
- **Output**: No return value; the function performs tests and expects specific behavior from the parser.
- **Functions Called**:
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`consume`](<#consume>)


---
### test\_one\_entry\_with\_txn\_error<!-- {{#callable:test_one_entry_with_txn_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L333>)

Tests the parser's handling of a single entry with a transaction error.
- **Inputs**:
    - `parser`: A pointer to an `fd_slot_delta_parser_t` structure, which is the parser to be tested.
- **Logic and Control Flow**:
    - Declare an array `input` of 101 unsigned characters.
    - Initialize the parser using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate `input` with a single entry containing a transaction error of type `MOCK_ERROR_TYPE_TXN` and error code `42U`.
    - Invoke [`consume`](<#consume>) with the parser, `input`, its size, the callback `entry_cb_with_txn_err`, and error expectations set to zero.
- **Output**: No return value; the function performs tests and assertions internally.
- **Functions Called**:
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`consume`](<#consume>)


---
### test\_one\_entry\_with\_txn\_custom\_error<!-- {{#callable:test_one_entry_with_txn_custom_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L341>)

Tests the parser's handling of a single entry with a transaction custom error.
- **Inputs**:
    - `parser`: A pointer to an `fd_slot_delta_parser_t` structure, which is the parser to be tested.
- **Logic and Control Flow**:
    - Initializes the parser using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Creates an input buffer of 102 bytes.
    - Calls [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate the input buffer with a single entry that includes a transaction custom error with error code 12.
    - Calls [`consume`](<#consume>) to process the input buffer with the parser, using `entry_cb_with_txn_custom_err` as the callback function, and expects no errors.
- **Output**: No return value; the function performs tests and uses assertions to validate behavior.
- **Functions Called**:
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`consume`](<#consume>)


---
### test\_one\_entry\_with\_instr\_error<!-- {{#callable:test_one_entry_with_instr_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L350>)

Tests the parser's handling of a single entry with an instruction error.
- **Inputs**:
    - `parser`: A pointer to an `fd_slot_delta_parser_t` structure, which is the parser to test.
- **Logic and Control Flow**:
    - Declare an array `input` of 106 unsigned characters.
    - Initialize the parser using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate `input` with a single entry containing an instruction error of type `MOCK_ERROR_TYPE_INSTR` and error code `15U`.
    - Invoke [`consume`](<#consume>) with the parser, `input`, its size, the callback `entry_cb_with_instr_err`, and error expectations set to zero.
- **Output**: No return value; the function performs tests and assertions internally.
- **Functions Called**:
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`consume`](<#consume>)


---
### test\_one\_entry\_with\_instr\_custom\_error<!-- {{#callable:test_one_entry_with_instr_custom_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L359>)

Tests the parsing of a single entry with a custom instruction error using a slot delta parser.
- **Inputs**:
    - `parser`: A pointer to an `fd_slot_delta_parser_t` structure, which is the parser to be tested.
- **Logic and Control Flow**:
    - Declare an array `input` of 110 unsigned characters to hold the input data.
    - Initialize the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate `input` with a single entry containing a custom instruction error.
    - Invoke [`consume`](<#consume>) with the `parser`, `input`, its size, the callback `entry_cb_with_instr_custom_err`, and error expectations set to 0.
- **Output**: No return value; the function performs tests and assertions internally.
- **Functions Called**:
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`consume`](<#consume>)


---
### test\_one\_entry\_with\_instr\_borsh\_io\_error<!-- {{#callable:test_one_entry_with_instr_borsh_io_error}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L368>)

Tests the handling of a single entry with an instruction Borsh I/O error using a slot delta parser.
- **Inputs**:
    - `parser`: A pointer to a `fd_slot_delta_parser_t` structure, which is the parser to be tested.
- **Logic and Control Flow**:
    - Declare an array `input` of 122 unsigned characters to hold the input data.
    - Initialize the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`mock_one_input_with_error`](<#mock_one_input_with_error>) to populate `input` with a mock entry that includes an instruction Borsh I/O error.
    - Invoke [`consume`](<#consume>) with the `parser`, `input`, the size of `input`, the callback `entry_cb_with_instr_borsh_io_err`, and error expectations set to 0.
- **Output**: No return value; the function performs tests and assertions internally.
- **Functions Called**:
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`mock_one_input_with_error`](<#mock_one_input_with_error>)
    - [`consume`](<#consume>)


---
### test\_multiple\_entries<!-- {{#callable:test_multiple_entries}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L376>)

Tests the processing of multiple slot delta entries using a parser.
- **Inputs**:
    - `parser`: A pointer to an `fd_slot_delta_parser_t` structure that will be initialized and used to parse the input data.
- **Logic and Control Flow**:
    - Declare and initialize an array `input` of 627 bytes to hold the input data.
    - Define arrays `slots`, `num_statuses`, `num_cache_statuses`, `error_types`, and `error_codes` with predefined values to simulate different slot delta entries and error conditions.
    - Call [`mock_slot_delta_input`](<#mock_slot_delta_input>) to populate `input` with mock data based on the defined arrays, and store the returned pointer in `p`.
    - Verify that the difference between `p` and `input` is 627 bytes using `FD_TEST`.
    - Initialize the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`consume`](<#consume>) with the `parser`, `input`, and other parameters to process the input data and invoke the `entry_cb_multiple` callback for each entry.
- **Output**: No direct output; the function performs tests and assertions on the parser's behavior with multiple entries.
- **Functions Called**:
    - [`mock_slot_delta_input`](<#mock_slot_delta_input>)
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`consume`](<#consume>)


---
### test\_multiple\_entries\_v2<!-- {{#callable:test_multiple_entries_v2}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L391>)

Tests the parsing of multiple slot delta entries with specific configurations and error types.
- **Inputs**:
    - ``parser``: A pointer to an `fd_slot_delta_parser_t` structure, which is used to parse the slot delta entries.
- **Logic and Control Flow**:
    - Initializes an array `input` of 577 bytes to store the slot delta data.
    - Defines arrays `slots`, `num_statuses`, `num_cache_statuses`, `error_types`, and `error_codes` to specify the configuration of the slot deltas and associated errors.
    - Calls [`mock_slot_delta_input`](<#mock_slot_delta_input>) to populate `input` with slot delta data based on the specified configurations.
    - Asserts that the difference between the pointer `p` and the start of `input` is 577 bytes, ensuring the input is fully populated.
    - Initializes the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Calls [`consume`](<#consume>) to process the `input` data using the `entry_cb_multiple_v2` callback function, without expecting errors.
- **Output**: No direct output is returned, but the function performs assertions to validate the parsing process.
- **Functions Called**:
    - [`mock_slot_delta_input`](<#mock_slot_delta_input>)
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`consume`](<#consume>)


---
### test\_multiple\_slot\_deltas\_no\_entries<!-- {{#callable:test_multiple_slot_deltas_no_entries}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L406>)

Tests the behavior of the slot delta parser when there are multiple slot deltas but no entries.
- **Inputs**:
    - ``parser``: A pointer to an `fd_slot_delta_parser_t` structure that will be initialized and used for parsing.
- **Logic and Control Flow**:
    - Initialize an array `input` with a size of 203 bytes.
    - Define arrays `slots`, `num_statuses`, and `num_cache_statuses` to specify the slots and their statuses.
    - Call [`mock_slot_delta_input`](<#mock_slot_delta_input>) to populate `input` with mock data for 3 slot deltas, each having one status and no cache statuses.
    - Verify that the pointer `p` returned by [`mock_slot_delta_input`](<#mock_slot_delta_input>) is 203 bytes from the start of `input`.
    - Initialize the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`consume`](<#consume>) with the `parser`, `input`, and other parameters to process the input data, using `entry_cb_multiple_v2` as the callback function, expecting an error with code 0.
- **Output**: No direct output is returned, but the function performs tests and assertions to validate the parser's behavior.
- **Functions Called**:
    - [`mock_slot_delta_input`](<#mock_slot_delta_input>)
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`consume`](<#consume>)


---
### test\_duplicate\_slots<!-- {{#callable:test_duplicate_slots}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L419>)

Tests the handling of duplicate slots in a slot delta parser.
- **Inputs**:
    - ``parser``: A pointer to an `fd_slot_delta_parser_t` structure that will be initialized and used for parsing.
- **Logic and Control Flow**:
    - Initialize an array `input` of 577 unsigned characters.
    - Define arrays `slots`, `num_statuses`, `num_cache_statuses`, `error_types`, and `error_codes` with specific values to simulate duplicate slots and various error conditions.
    - Call [`mock_slot_delta_input`](<#mock_slot_delta_input>) to populate `input` with mock data based on the defined arrays.
    - Verify that the pointer `p` returned by [`mock_slot_delta_input`](<#mock_slot_delta_input>) is 577 bytes from the start of `input`.
    - Initialize the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`consume`](<#consume>) with the `parser`, `input`, and other parameters to process the input and check for the expected error `FD_SLOT_DELTA_PARSER_ADVANCE_ERROR_SLOT_HASH_MULTIPLE_ENTRIES`.
- **Output**: No return value; the function performs tests and assertions internally.
- **Functions Called**:
    - [`mock_slot_delta_input`](<#mock_slot_delta_input>)
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`consume`](<#consume>)


---
### test\_too\_many\_entries<!-- {{#callable:test_too_many_entries}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L434>)

Tests the behavior of the slot delta parser when processing an input with too many entries.
- **Inputs**:
    - ``parser``: A pointer to an `fd_slot_delta_parser_t` structure that will be initialized and used to parse the input data.
- **Logic and Control Flow**:
    - Initialize arrays `slots` and `num_statuses` with 301 elements each, where `slots` is filled with values starting from 1000 and `num_statuses` is filled with zeros.
    - Call [`mock_slot_delta_input`](<#mock_slot_delta_input>) to generate input data with 301 slot deltas, storing the result in `input`.
    - Verify that the generated input data size is 5125 bytes using `FD_TEST`.
    - Initialize the `parser` using [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>).
    - Call [`consume`](<#consume>) with the `parser`, `input`, and other parameters to process the input data, expecting an error due to too many entries.
- **Output**: No return value; the function performs tests and assertions to validate parser behavior.
- **Functions Called**:
    - [`mock_slot_delta_input`](<#mock_slot_delta_input>)
    - [`fd_slot_delta_parser_init`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_init>)
    - [`consume`](<#consume>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../../src/discof/restore/utils/test_slot_delta_parser.c#L451>)

Initializes the environment, sets up a workspace, creates a slot delta parser, runs a series of tests on the parser, and then cleans up resources.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Sets `page_cnt` to 1 and `_page_sz` to "gigantic".
    - Retrieves the NUMA index using `fd_shmem_numa_idx` with 0 as the argument.
    - Creates a new anonymous workspace using `fd_wksp_new_anonymous` with the page size, page count, CPU index, name "wksp", and 0 as arguments.
    - Checks if the workspace is valid using `FD_TEST`.
    - Allocates memory for the slot delta parser using `fd_wksp_alloc_laddr` with the workspace, alignment, footprint, and 1 as arguments.
    - Creates and joins a new slot delta parser using [`fd_slot_delta_parser_new`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_new>) and [`fd_slot_delta_parser_join`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_join>).
    - Checks if the slot delta parser is valid using `FD_TEST`.
    - Runs a series of test functions on the slot delta parser, each testing different scenarios and error conditions.
    - Frees the allocated memory for the slot delta parser using `fd_wksp_free_laddr`, [`fd_slot_delta_parser_delete`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_delete>), and [`fd_slot_delta_parser_leave`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_leave>).
    - Returns 0 to indicate successful execution.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_slot_delta_parser_align`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_align>)
    - [`fd_slot_delta_parser_footprint`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_footprint>)
    - [`fd_slot_delta_parser_join`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_join>)
    - [`fd_slot_delta_parser_new`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_new>)
    - [`test_one_entry`](<#test_one_entry>)
    - [`test_one_entry_not_root`](<#test_one_entry_not_root>)
    - [`test_one_entry_with_txn_error`](<#test_one_entry_with_txn_error>)
    - [`test_one_entry_with_txn_custom_error`](<#test_one_entry_with_txn_custom_error>)
    - [`test_one_entry_with_instr_error`](<#test_one_entry_with_instr_error>)
    - [`test_one_entry_with_instr_custom_error`](<#test_one_entry_with_instr_custom_error>)
    - [`test_one_entry_with_instr_borsh_io_error`](<#test_one_entry_with_instr_borsh_io_error>)
    - [`test_multiple_entries`](<#test_multiple_entries>)
    - [`test_multiple_entries_v2`](<#test_multiple_entries_v2>)
    - [`test_multiple_slot_deltas_no_entries`](<#test_multiple_slot_deltas_no_entries>)
    - [`test_duplicate_slots`](<#test_duplicate_slots>)
    - [`test_too_many_entries`](<#test_too_many_entries>)
    - [`fd_slot_delta_parser_delete`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_delete>)
    - [`fd_slot_delta_parser_leave`](<fd_slot_delta_parser.c.md#fd_slot_delta_parser_leave>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)