<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines seccomp policy rules for logging, snapshot management, and connection handling in Firedancer.

# Purpose
This configuration file defines rules and conditions for managing file descriptors and network connections within a software system. It specifies how logging is handled, including writing log messages to files or pipes and ensuring that warnings and above are written to `STDERR`. The file also outlines the conditions under which file descriptors can be used for network operations, such as connecting to peers, sending and receiving data, and configuring socket options. Additionally, it includes rules for managing snapshot files, such as renaming and unlinking temporary files, and specifies conditions for shutting down the system. The file ensures that certain operations are restricted to specific file descriptors, maintaining control over logging and network interactions.
# Content Summary
The provided content is a configuration file that defines rules and conditions for handling file descriptors in a software system, particularly focusing on logging and snapshot management. Here are the key functional details:

1. **Logging Configuration**: 
   - The system writes all log messages to a file and/or a pipe. Messages with a severity of 'WARNING' and above are directed to the STDERR pipe (file descriptor 2), while all messages are logged to a file.
   - The `write` operation is permitted for specific file descriptors, including STDERR, the log file, and descriptors for full and incremental snapshots.
   - The `fsync` operation ensures that log files are immediately synchronized to disk for messages of 'WARNING' level and above.

2. **Snapshot Management**:
   - The system establishes socket connections for downloading snapshots and resolving snapshot slots. The `socket` operation is configured for IPv4 (AF_INET) using non-blocking TCP streams.
   - The `connect` operation is restricted from being used on certain file descriptors, including STDERR, the log file, and snapshot-related descriptors.
   - The `close` operation is similarly restricted, ensuring that only appropriate sockets are closed.
   - The `ppoll` operation is used to monitor existing connections for snapshot downloads and resolutions.
   - The `sendto` and `recvfrom` operations manage sending and receiving HTTP requests for snapshot downloads, with restrictions on certain file descriptors.
   - The `setsockopt` operation configures socket options, specifically setting TCP_NODELAY for non-logging and non-snapshot file descriptors.

3. **File Management**:
   - The `renameat` operation renames snapshot files after they are read, ensuring the source and destination directories are the same.
   - The `unlinkat` operation removes temporary snapshot files from local directories.

4. **Shutdown Procedure**:
   - The `exit` operation is called during system shutdown, with a condition that the argument must be zero.

This configuration file is crucial for developers to understand how the system manages logging and snapshot operations, ensuring proper file descriptor usage and system behavior.

---
Made with ❤️ by [Driver](https://www.driver.ai/)