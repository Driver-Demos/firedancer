<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall handling with architecture-specific checks and actions.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. The file is automatically generated and should not be edited manually. It includes several system and Linux-specific headers to facilitate the creation of a seccomp filter using the Berkeley Packet Filter (BPF) syntax. The filter is designed to restrict the system calls that a process can make, enhancing security by allowing only a predefined set of system calls and arguments.

The [`populate_sock_filter_policy_fd_snapld_tile`](<#populate_sock_filter_policy_fd_snapld_tile>) function is the main component of this file. It initializes a BPF filter array with 87 instructions that define the seccomp policy. The policy checks the architecture of the running process and allows or denies specific system calls based on their numbers and arguments. The allowed system calls include `write`, `fsync`, `read`, `lseek`, `socket`, `connect`, `close`, `sendto`, `recvfrom`, `setsockopt`, and `exit`. Each system call is checked against specific conditions, such as file descriptors or socket options, to determine if it should be allowed or if the process should be terminated (`RET_KILL_PROCESS`). The function uses `fd_memcpy` to copy the filter instructions into the provided output buffer.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_snapld\_tile\_instr\_cnt
- **Type**: `unsigned int`
- **Description**: Defines the number of instructions in the socket filter policy for the `fd_snapld_tile` seccomp filter. This constant is used to ensure that the filter array has the correct number of elements.
- **Use**: Used to validate the size of the `struct sock_filter` array in the `populate_sock_filter_policy_fd_snapld_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_snapld\_tile<!-- {{#callable:populate_sock_filter_policy_fd_snapld_tile}} -->
[View Source →](<../../../../../../src/discof/restore/generated/fd_snapld_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call access based on file descriptors and architecture.
- **Inputs**:
    - `out_cnt`: The number of elements in the output `sock_filter` array, which must be at least 87.
    - `out`: A pointer to the `sock_filter` array where the filter policy will be stored.
    - `logfile_fd`: The file descriptor for the log file, used in syscall checks.
    - `in_full_fd`: The file descriptor for full input, used in syscall checks.
    - `in_incr_fd`: The file descriptor for incremental input, used in syscall checks.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 87 using `FD_TEST` macro.
    - Defines a `sock_filter` array with 87 elements to specify the seccomp filter policy.
    - Loads the architecture from `seccomp_data` and compares it with `ARCH_NR`; if not equal, jumps to `RET_KILL_PROCESS`.
    - Loads the syscall number and checks against allowed syscalls like `SYS_write`, `SYS_fsync`, `SYS_read`, etc., with specific conditions for each.
    - For each allowed syscall, checks the first argument against `logfile_fd`, `in_full_fd`, and `in_incr_fd` to determine if the syscall should be allowed or the process should be killed.
    - Copies the defined `sock_filter` array to the output `sock_filter` array using `fd_memcpy`.
- **Output**: The function does not return a value but populates the `out` array with the seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)