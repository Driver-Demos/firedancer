<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall restrictions based on architecture and specific conditions.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically by a script and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_snapct_tile`](<#populate_sock_filter_policy_fd_snapct_tile>), initializes a BPF filter array with 111 instructions. These instructions enforce a security policy by allowing or denying specific system calls based on predefined conditions.

The filter policy is designed to restrict the execution of certain system calls unless they meet specific criteria. It checks the architecture of the running process and compares it with the expected architecture, allowing the process to continue only if they match. The policy allows certain system calls like `write`, `fsync`, `socket`, `connect`, `close`, `ppoll`, `sendto`, `sendmmsg`, `recvfrom`, `setsockopt`, `renameat`, `unlinkat`, and `exit` based on specific conditions related to their arguments. If a system call does not meet the criteria, the policy will terminate the process using `SECCOMP_RET_KILL_PROCESS`. The file is intended to be included in other C source files to enforce this security policy at runtime.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_snapct\_tile\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: The `sock_filter_policy_fd_snapct_tile_instr_cnt` is a constant unsigned integer that represents the number of instructions in a socket filter policy. It is set to 111, indicating the total number of BPF (Berkeley Packet Filter) instructions used in the filter array.
- **Use**: Used to define the size of the `filter` array in the `populate_sock_filter_policy_fd_snapct_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_snapct\_tile<!-- {{#callable:populate_sock_filter_policy_fd_snapct_tile}} -->
[View Source →](<../../../../../../src/discof/restore/generated/fd_snapct_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined set of BPF instructions to enforce a seccomp policy.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 111.
    - `out`: A pointer to a `sock_filter` array where the BPF instructions will be copied.
    - `logfile_fd`: A file descriptor used in the BPF filter logic for specific syscall checks.
    - `dir_fd`: A file descriptor used in the BPF filter logic for specific syscall checks.
    - `out_full_fd`: A file descriptor used in the BPF filter logic for specific syscall checks.
    - `out_inc_fd`: A file descriptor used in the BPF filter logic for specific syscall checks.
    - `ping_fd`: A file descriptor used in the BPF filter logic for specific syscall checks.
- **Logic and Control Flow**:
    - Checks if `out_cnt` is at least 111 using `FD_TEST` macro.
    - Defines a `sock_filter` array `filter` with 111 BPF instructions.
    - The BPF instructions include checks for architecture compatibility and various syscall numbers.
    - For each syscall, the filter either allows the syscall, jumps to further checks, or kills the process based on conditions.
    - Copies the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: No return value; the function modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)