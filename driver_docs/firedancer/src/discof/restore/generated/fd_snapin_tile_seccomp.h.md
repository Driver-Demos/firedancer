<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall restrictions based on architecture and specific syscalls.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically and should not be edited manually. The file includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_snapin_tile`](<#populate_sock_filter_policy_fd_snapin_tile>), initializes a BPF filter array that enforces security policies by allowing or denying specific system calls based on predefined rules.

The filter policy is designed to restrict system calls to a limited set, specifically allowing `SYS_write`, `SYS_fsync`, and `SYS_exit` under certain conditions. The policy checks the architecture of the executing environment and compares it with the expected architecture, terminating the process if they do not match. It also checks syscall numbers and arguments to determine if they should be allowed or if the process should be terminated. The use of seccomp and BPF ensures that the application can enforce strict security measures by controlling which system calls are permitted during execution.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_snapin\_tile\_instr\_cnt
- **Type**: `unsigned int`
- **Description**: The variable `sock_filter_policy_fd_snapin_tile_instr_cnt` is a constant unsigned integer that holds the value 17.
- **Use**: Indicates the number of instructions in the `sock_filter` array used in the `populate_sock_filter_policy_fd_snapin_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_snapin\_tile<!-- {{#callable:populate_sock_filter_policy_fd_snapin_tile}} -->
[View Source →](<../../../../../../src/discof/restore/generated/fd_snapin_tile_seccomp.h#L26>)

Populates a socket filter policy with specific seccomp rules to control system call access.
- **Inputs**:
    - `out_cnt`: The number of elements in the output filter array, which must be at least 17.
    - `out`: A pointer to a `sock_filter` array where the function will store the filter rules.
    - `logfile_fd`: The file descriptor for the log file, used in syscall argument checks.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 17 using `FD_TEST` macro.
    - Define a `sock_filter` array with 17 elements to specify seccomp rules.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check if it matches `SYS_write`, `SYS_fsync`, or `SYS_exit`; jump to corresponding labels if matched.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; allow or kill process based on the check.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; allow or kill process based on the check.
    - For `SYS_exit`, load the first syscall argument and check if it is 0; allow or kill process based on the check.
    - If none of the syscalls match, jump to `RET_KILL_PROCESS`.
    - Copy the defined filter rules into the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it populates the `out` array with seccomp filter rules.



---
Made with ❤️ by [Driver](https://www.driver.ai/)