<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Signs and sends transactions to the current leader, supporting only single-signature transactions.

# Purpose
The code defines a C module for a sender tile that signs and sends transactions to a current leader in a distributed system. It is designed to handle transactions that require a single signature. The module includes a structure `fd_sender_tile_ctx_t` that maintains the context for the sender tile, including keys, addresses, and various memory and network configurations. The module interacts with several components, such as the keyguard for signing transactions, and uses network protocols like UDP for communication.

The module includes functions for initializing the sender tile, handling incoming and outgoing data fragments, and managing network communications. It uses a variety of external libraries and headers to perform its tasks, indicating that it is part of a larger system. The code is structured to be integrated into a larger application, as evidenced by its use of a `fd_topo_run_tile_t` structure to define the sender tile's operations, including initialization and execution functions. The module does not define public APIs but is intended to be used within a specific system architecture, as indicated by its reliance on specific data structures and functions from included headers.
# Imports and Dependencies

---
- `../../disco/topo/fd_topo.h`
- `generated/fd_sender_tile_seccomp.h`
- `../store/fd_store.h`
- `../../flamenco/repair/fd_repair.h`
- `../../flamenco/runtime/fd_blockstore.h`
- `../../flamenco/leaders/fd_leaders.h`
- `../../flamenco/fd_flamenco.h`
- `../../util/fd_util.h`
- `../../choreo/fd_choreo.h`
- `../../util/net/fd_eth.h`
- `../../util/net/fd_ip4.h`
- `../../util/net/fd_udp.h`
- `../../disco/shred/fd_stake_ci.h`
- `../../disco/topo/fd_pod_format.h`
- `../../disco/keyguard/fd_keyload.h`
- `../../disco/keyguard/fd_keyguard_client.h`
- `../../disco/keyguard/fd_keyguard.h`
- `../../flamenco/runtime/fd_runtime.h`
- `../../disco/fd_disco.h`
- `../../util/net/fd_net_headers.h`
- `unistd.h`
- `arpa/inet.h`
- `linux/unistd.h`
- `sys/random.h`
- `netdb.h`
- `netinet/in.h`
- `sys/socket.h`
- `../../disco/stem/fd_stem.c`


# Global Variables

---
### fd\_tile\_sender
- **Type**: ``fd_topo_run_tile_t``
- **Description**: Defines a tile configuration for a sender in a distributed system. It includes function pointers for initialization, security policy population, and execution.
- **Use**: Used to configure and manage the sender tile's behavior and resources in the system.


# Data Structures

---
### fd\_sender\_tile\_ctx
- **Type**: ``struct``
- **Members**:
    - `identity_key`: Stores the identity key as an array of `fd_pubkey_t`.
    - `vote_acct_addr`: Stores the vote account address as an array of `fd_pubkey_t`.
    - `stake_ci`: Pointer to `fd_stake_ci_t` for stake configuration information.
    - `poh_slot`: Pointer to an unsigned long representing the proof of history slot.
    - `new_dest_ptr`: Pointer to `fd_shred_dest_weighted_t` for new destination information.
    - `new_dest_cnt`: Stores the count of new destinations as an unsigned long.
    - `txn_buf`: Buffer for transaction data, aligned to `fd_txn_p_t`.
    - `tpu_serve_addr`: Stores the TPU server address as `fd_ip4_port_t`.
    - `packet_hdr`: Array of `fd_ip4_udp_hdrs_t` for packet headers.
    - `net_id`: Stores the network identifier as an unsigned short.
    - `stake_in_idx`: Index for stake input as an unsigned long.
    - `stake_in_mem`: Pointer to `fd_wksp_t` for stake input memory.
    - `stake_in_chunk0`: Initial chunk index for stake input as an unsigned long.
    - `stake_in_wmark`: Watermark for stake input as an unsigned long.
    - `contact_in_idx`: Index for contact input as an unsigned long.
    - `contact_in_mem`: Pointer to `fd_wksp_t` for contact input memory.
    - `contact_in_chunk0`: Initial chunk index for contact input as an unsigned long.
    - `contact_in_wmark`: Watermark for contact input as an unsigned long.
    - `replay_in_idx`: Index for replay input as an unsigned long.
    - `replay_in_mem`: Pointer to `fd_wksp_t` for replay input memory.
    - `replay_in_chunk0`: Initial chunk index for replay input as an unsigned long.
    - `replay_in_wmark`: Watermark for replay input as an unsigned long.
    - `poh_in_idx`: Index for proof of history input as an unsigned long.
    - `poh_in_mem`: Pointer to `fd_wksp_t` for proof of history input memory.
    - `poh_in_chunk0`: Initial chunk index for proof of history input as an unsigned long.
    - `poh_in_wmark`: Watermark for proof of history input as an unsigned long.
    - `gossip_out_idx`: Index for gossip output as an unsigned long.
    - `gossip_out_mcache`: Pointer to `fd_frag_meta_t` for gossip output metadata cache.
    - `gossip_out_sync`: Pointer to an unsigned long for gossip output synchronization.
    - `gossip_out_depth`: Depth of gossip output as an unsigned long.
    - `gossip_out_seq`: Sequence number for gossip output as an unsigned long.
    - `gossip_out_mem`: Pointer to `fd_wksp_t` for gossip output memory.
    - `gossip_out_chunk0`: Initial chunk index for gossip output as an unsigned long.
    - `gossip_out_wmark`: Watermark for gossip output as an unsigned long.
    - `gossip_out_chunk`: Current chunk index for gossip output as an unsigned long.
    - `dedup_out_idx`: Index for deduplication output as an unsigned long.
    - `dedup_out_mcache`: Pointer to `fd_frag_meta_t` for deduplication output metadata cache.
    - `dedup_out_sync`: Pointer to an unsigned long for deduplication output synchronization.
    - `dedup_out_depth`: Depth of deduplication output as an unsigned long.
    - `dedup_out_seq`: Sequence number for deduplication output as an unsigned long.
    - `dedup_out_mem`: Pointer to `fd_wksp_t` for deduplication output memory.
    - `dedup_out_chunk0`: Initial chunk index for deduplication output as an unsigned long.
    - `dedup_out_wmark`: Watermark for deduplication output as an unsigned long.
    - `dedup_out_chunk`: Current chunk index for deduplication output as an unsigned long.
    - `net_out_idx`: Index for network output as an unsigned long.
    - `net_out_mcache`: Pointer to `fd_frag_meta_t` for network output metadata cache.
    - `net_out_sync`: Pointer to an unsigned long for network output synchronization.
    - `net_out_depth`: Depth of network output as an unsigned long.
    - `net_out_seq`: Sequence number for network output as an unsigned long.
    - `net_out_mem`: Pointer to `fd_wksp_t` for network output memory.
    - `net_out_chunk0`: Initial chunk index for network output as an unsigned long.
    - `net_out_wmark`: Watermark for network output as an unsigned long.
    - `net_out_chunk`: Current chunk index for network output as an unsigned long.
    - `sign_in_idx`: Index for sign input as an unsigned long.
    - `sign_out_idx`: Index for sign output as an unsigned long.
    - `keyguard_client`: Array of `fd_keyguard_client_t` for keyguard client information.
- **Description**: Manages the context for a sender tile, which is responsible for signing and sending transactions to the current leader. It includes various fields for handling identity, vote account addresses, stake configuration, transaction buffers, network addresses, and input/output indices and memory for different communication channels. The structure supports operations related to proof of history, gossip, deduplication, and network communication, ensuring that transactions are processed and transmitted correctly within the system.


---
### fd\_sender\_tile\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``identity_key``: Stores the identity public key.
    - ``vote_acct_addr``: Stores the vote account address.
    - ``stake_ci``: Pointer to the stake consensus information.
    - ``poh_slot``: Pointer to the proof of history slot.
    - ``new_dest_ptr``: Pointer to new destination information.
    - ``new_dest_cnt``: Count of new destinations.
    - ``txn_buf``: Buffer for transaction data, aligned to `fd_txn_p_t`.
    - ``tpu_serve_addr``: Stores the TPU server address.
    - ``packet_hdr``: Stores the packet header information.
    - ``net_id``: Network identifier.
    - ``stake_in_idx``: Index for stake input.
    - ``stake_in_mem``: Pointer to stake input memory.
    - ``stake_in_chunk0``: Initial chunk for stake input.
    - ``stake_in_wmark``: Watermark for stake input.
    - ``contact_in_idx``: Index for contact input.
    - ``contact_in_mem``: Pointer to contact input memory.
    - ``contact_in_chunk0``: Initial chunk for contact input.
    - ``contact_in_wmark``: Watermark for contact input.
    - ``replay_in_idx``: Index for replay input.
    - ``replay_in_mem``: Pointer to replay input memory.
    - ``replay_in_chunk0``: Initial chunk for replay input.
    - ``replay_in_wmark``: Watermark for replay input.
    - ``poh_in_idx``: Index for proof of history input.
    - ``poh_in_mem``: Pointer to proof of history input memory.
    - ``poh_in_chunk0``: Initial chunk for proof of history input.
    - ``poh_in_wmark``: Watermark for proof of history input.
    - ``gossip_out_idx``: Index for gossip output.
    - ``gossip_out_mcache``: Pointer to gossip output metadata cache.
    - ``gossip_out_sync``: Pointer to gossip output synchronization.
    - ``gossip_out_depth``: Depth of gossip output.
    - ``gossip_out_seq``: Sequence number for gossip output.
    - ``gossip_out_mem``: Pointer to gossip output memory.
    - ``gossip_out_chunk0``: Initial chunk for gossip output.
    - ``gossip_out_wmark``: Watermark for gossip output.
    - ``gossip_out_chunk``: Current chunk for gossip output.
    - ``dedup_out_idx``: Index for deduplication output.
    - ``dedup_out_mcache``: Pointer to deduplication output metadata cache.
    - ``dedup_out_sync``: Pointer to deduplication output synchronization.
    - ``dedup_out_depth``: Depth of deduplication output.
    - ``dedup_out_seq``: Sequence number for deduplication output.
    - ``dedup_out_mem``: Pointer to deduplication output memory.
    - ``dedup_out_chunk0``: Initial chunk for deduplication output.
    - ``dedup_out_wmark``: Watermark for deduplication output.
    - ``dedup_out_chunk``: Current chunk for deduplication output.
    - ``net_out_idx``: Index for network output.
    - ``net_out_mcache``: Pointer to network output metadata cache.
    - ``net_out_sync``: Pointer to network output synchronization.
    - ``net_out_depth``: Depth of network output.
    - ``net_out_seq``: Sequence number for network output.
    - ``net_out_mem``: Pointer to network output memory.
    - ``net_out_chunk0``: Initial chunk for network output.
    - ``net_out_wmark``: Watermark for network output.
    - ``net_out_chunk``: Current chunk for network output.
    - ``sign_in_idx``: Index for signature input.
    - ``sign_out_idx``: Index for signature output.
    - ``keyguard_client``: Stores the keyguard client information.
- **Description**: Manages the context for a sender tile, which is responsible for signing and sending transactions to the current leader. It includes various fields for handling network communication, transaction processing, and interaction with the stake consensus information. The structure also manages input and output indices, memory pointers, and synchronization for different communication channels, such as gossip, deduplication, and network outputs.


# Functions

---
### scratch\_align<!-- {{#callable:scratch_align}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L115>)

Returns the alignment size for scratch memory, which is 128 bytes.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function is defined as `static inline`, indicating it is intended for use within the same translation unit and suggests inlining for performance.
    - The function returns a constant value of `128UL`, which represents the alignment size in bytes.
- **Output**: A constant unsigned long integer value of 128, representing the alignment size for scratch memory.


---
### loose\_footprint<!-- {{#callable:loose_footprint}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L120>)

Returns a constant value of 0UL regardless of input.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure, which is marked as unused in this function.
- **Logic and Control Flow**:
    - The function takes a single input parameter `tile`, which is a pointer to a `fd_topo_tile_t` structure.
    - The parameter `tile` is marked with `FD_PARAM_UNUSED`, indicating it is not used in the function body.
    - The function returns the constant value `0UL`.
- **Output**: A constant unsigned long value of 0UL.


---
### scratch\_footprint<!-- {{#callable:scratch_footprint}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L125>)

Calculates the memory footprint required for a scratch space layout based on various alignment and size requirements.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure, which is not used in the function.
- **Logic and Control Flow**:
    - Initialize `l` with `FD_LAYOUT_INIT`.
    - Append the layout of `fd_sender_tile_ctx_t` using its alignment and size to `l`.
    - Append the layout of `fd_stake_ci` using its alignment and footprint to `l`.
    - Append the layout of scratch shared memory using its alignment and footprint for `SCRATCH_MAX` to `l`.
    - Append the layout of scratch frame memory using its alignment and footprint for `SCRATCH_DEPTH` to `l`.
    - Finalize the layout with `scratch_align()` and return the result.
- **Output**: Returns an `ulong` representing the total memory footprint required for the scratch space layout.
- **Functions Called**:
    - [`scratch_align`](<#scratch_align>)


---
### send\_packet<!-- {{#callable:send_packet}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L135>)

Prepares and sends a network packet with specified payload and metadata to a destination IP and port.
- **Inputs**:
    - `ctx`: A pointer to `fd_sender_tile_ctx_t` structure containing context information for the sender tile.
    - `dst_ip_addr`: The destination IP address for the packet.
    - `dst_port`: The destination port for the packet.
    - `payload`: A pointer to the payload data to be sent in the packet.
    - `payload_sz`: The size of the payload data in bytes.
    - `tsorig`: The original timestamp for the packet.
- **Logic and Control Flow**:
    - Convert the network output chunk to a local address using `fd_chunk_to_laddr` and store it in `packet`.
    - Copy the packet header from the context to the packet's header.
    - Set the destination IP address and increment the network ID in the IP header.
    - Calculate and set the total length and checksum for the IP header.
    - Set the destination port and length in the UDP header.
    - Copy the payload data into the packet after the headers.
    - Calculate the publication timestamp and signature for the packet.
    - Publish the packet metadata using `fd_mcache_publish`.
    - Increment the sequence number and update the chunk for the next packet.
- **Output**: No return value; the function sends a packet over the network.


---
### get\_current\_leader\_tpu\_vote\_contact<!-- {{#callable:get_current_leader_tpu_vote_contact}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L168>)

Retrieves the current leader's TPU vote contact information for a given slot and updates the output destination pointer.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_sender_tile_ctx_t` structure containing context information, including the current slot and stake information.
    - ``out_dest``: A pointer to a pointer of type `fd_shred_dest_weighted_t`, which will be updated to point to the current leader's TPU vote contact information.
- **Logic and Control Flow**:
    - Query the current slot using `fd_fseq_query` with `ctx->poh_slot` and store the result in `poh_slot`.
    - If `poh_slot` is `ULONG_MAX`, return -1 indicating an error.
    - Retrieve the leader schedule for the current slot using `fd_stake_ci_get_lsched_for_slot` and store it in `lsched`.
    - If `lsched` is NULL, return -1 indicating an error.
    - Get the slot leader's public key using `fd_epoch_leaders_get` and store it in `slot_leader`.
    - If `slot_leader` is NULL, return -1 indicating an error.
    - Retrieve the shred destination for the current slot using `fd_stake_ci_get_sdest_for_slot` and store it in `sdest`.
    - Convert the slot leader's public key to an index using `fd_shred_dest_pubkey_to_idx` and store it in `sdest_idx`.
    - If `sdest_idx` is `FD_SHRED_DEST_NO_DEST`, return -1 indicating an error.
    - Update `*out_dest` to point to the destination corresponding to `sdest_idx` using `fd_shred_dest_idx_to_dest`.
    - Return 0 indicating success.
- **Output**: Returns 0 on success, or -1 if an error occurs during any of the retrieval steps.


---
### handle\_new\_cluster\_contact\_info<!-- {{#callable:handle_new_cluster_contact_info}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L191>)

Processes new cluster contact information and updates the context with destination details.
- **Inputs**:
    - `ctx`: A pointer to `fd_sender_tile_ctx_t` structure that holds the context for the sender tile.
    - `buf`: A constant pointer to an unsigned character array containing the buffer with new cluster contact information.
    - `buf_sz`: An unsigned long integer representing the size of the buffer.
- **Logic and Control Flow**:
    - Cast the `buf` to a constant pointer of type `ulong` using `fd_type_pun_const` and assign it to `header`.
    - Assign `buf_sz` to `dest_cnt`.
    - Check if `dest_cnt` is greater than or equal to `MAX_SHRED_DESTS`; if true, log an error and exit.
    - Cast `header` to a constant pointer of type `fd_shred_dest_wire_t` and assign it to `in_dests`.
    - Initialize `dests` by calling `fd_stake_ci_dest_add_init` with `ctx->stake_ci`.
    - Update `ctx->new_dest_ptr` with `dests` and `ctx->new_dest_cnt` with `dest_cnt`.
    - Iterate over each destination in `in_dests` and copy the public key, IP address, and UDP port to the corresponding fields in `dests`.
- **Output**: No return value; updates the `ctx` structure with new destination information.


---
### finalize\_new\_cluster\_contact\_info<!-- {{#callable:finalize_new_cluster_contact_info}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L215>)

Finalizes the addition of new cluster contact information by completing the destination addition process.
- **Inputs**:
    - `ctx`: A pointer to a `fd_sender_tile_ctx_t` structure that contains context information, including the stake cluster information and the count of new destinations.
- **Logic and Control Flow**:
    - Calls the function `fd_stake_ci_dest_add_fini` with `ctx->stake_ci` and `ctx->new_dest_cnt` as arguments to finalize the addition of new destinations.
- **Output**: No return value (void function).


---
### during\_frag<!-- {{#callable:during_frag}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L220>)

Processes incoming fragments based on their index and performs specific actions such as logging errors, initializing messages, handling contact information, or copying transaction data.
- **Inputs**:
    - `ctx`: A pointer to `fd_sender_tile_ctx_t` structure containing context information for the sender tile.
    - `in_idx`: An unsigned long representing the index of the incoming fragment.
    - `seq`: An unsigned long representing the sequence number of the fragment, marked as unused.
    - `sig`: An unsigned long representing the signature of the fragment, marked as unused.
    - `chunk`: An unsigned long representing the chunk identifier of the fragment.
    - `sz`: An unsigned long representing the size of the fragment.
    - `ctl`: An unsigned long representing control information, marked as unused.
- **Logic and Control Flow**:
    - Checks if `in_idx` matches `ctx->sign_in_idx` and logs a critical error if true.
    - Checks if `in_idx` matches `ctx->stake_in_idx` and verifies if `chunk` is within a valid range; logs an error if not, and initializes a stake message if valid.
    - Checks if `in_idx` matches `ctx->contact_in_idx` and verifies if `chunk` is within a valid range; logs an error if not, and handles new cluster contact information if valid.
    - Checks if `in_idx` matches `ctx->replay_in_idx` and verifies if `chunk` is within a valid range and `sz` matches the size of `fd_txn_p_t`; logs an error if not, and copies transaction data to `ctx->txn_buf` if valid.
- **Output**: No direct output; performs actions such as logging errors, initializing messages, or copying data based on conditions.
- **Functions Called**:
    - [`handle_new_cluster_contact_info`](<#handle_new_cluster_contact_info>)


---
### after\_frag<!-- {{#callable:after_frag}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L260>)

Handles post-fragment processing based on the input index, including finalizing contact information, finalizing stake messages, and processing replay transactions.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_sender_tile_ctx_t` structure, which contains context information for the sender tile.
    - ``in_idx``: An unsigned long integer representing the input index to determine the processing path.
    - ``seq``: An unsigned long integer representing the sequence number, which is unused in this function.
    - ``sig``: An unsigned long integer representing the signature, which is unused in this function.
    - ``sz``: An unsigned long integer representing the size, which is unused in this function.
    - ``tsorig``: An unsigned long integer representing the original timestamp, which is unused in this function.
    - ``tspub``: An unsigned long integer representing the publish timestamp, which is unused in this function.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is unused in this function.
- **Logic and Control Flow**:
    - If `in_idx` equals `ctx->contact_in_idx`, call [`finalize_new_cluster_contact_info`](<#finalize_new_cluster_contact_info>) to finalize contact information and return.
    - If `in_idx` equals `ctx->stake_in_idx`, call `fd_stake_ci_stake_msg_fini` to finalize stake messages and return.
    - If `in_idx` equals `ctx->replay_in_idx`, process the transaction by signing it, sending it to the leader, publishing it to gossip and deduplication caches, and updating sequence and chunk indices.
- **Output**: No return value; the function performs actions based on the input index.
- **Functions Called**:
    - [`finalize_new_cluster_contact_info`](<#finalize_new_cluster_contact_info>)
    - [`get_current_leader_tpu_vote_contact`](<#get_current_leader_tpu_vote_contact>)
    - [`send_packet`](<#send_packet>)


---
### privileged\_init<!-- {{#callable:privileged_init}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L323>)

Initializes a privileged sender tile context by allocating memory and loading an identity key.
- **Inputs**:
    - `topo`: A pointer to an `fd_topo_t` structure representing the topology configuration.
    - `tile`: A pointer to an `fd_topo_tile_t` structure representing the tile configuration.
- **Logic and Control Flow**:
    - Call `fd_topo_obj_laddr` to get the local address of the tile object in the topology.
    - Initialize scratch memory allocation with `FD_SCRATCH_ALLOC_INIT`.
    - Allocate memory for `fd_sender_tile_ctx_t` using `FD_SCRATCH_ALLOC_APPEND`.
    - Check if `identity_key_path` in `tile->sender` is an empty string; if so, log an error and exit.
    - Load the identity key from the specified path using `fd_keyload_load` and store it in `ctx->identity_key`.
- **Output**: No return value; the function initializes the sender tile context in place.


---
### unprivileged\_init<!-- {{#callable:unprivileged_init}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L337>)

Initializes the unprivileged context for a sender tile by setting up memory allocations, network configurations, and input/output links.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure representing the topology configuration.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure representing the tile configuration.
- **Logic and Control Flow**:
    - Allocate scratch memory using `fd_topo_obj_laddr` to get the local address of the tile object ID.
    - Check if the tile has any primary output links; log an error if not.
    - Initialize scratch memory allocation with `FD_SCRATCH_ALLOC_INIT`.
    - Allocate and initialize a `fd_sender_tile_ctx_t` context structure in the scratch memory.
    - Join the stake consensus interface using `fd_stake_ci_join` and allocate necessary memory for it.
    - Allocate scratch shared memory and fast memory using `FD_SCRATCH_ALLOC_APPEND`.
    - Attach the scratch space using `fd_scratch_attach`.
    - Initialize network ID and set up the TPU server address and UDP header using `fd_ip4_udp_hdr_init`.
    - Query the PoH slot object ID and join the PoH sequence using `fd_fseq_join`.
    - Set up input links for stake, contact, and replay tiles using `fd_topo_find_tile_in_link` and configure their memory and watermark settings.
    - Set up output links for gossip, dedup, and net using `fd_topo_find_tile_out_link` and configure their memory, sequence, and watermark settings.
    - Set up keyguard input and output links and join the keyguard client.
    - Finalize scratch memory allocation and check for overflow errors.
- **Output**: No direct output; the function initializes the context for further operations.
- **Functions Called**:
    - [`scratch_align`](<#scratch_align>)
    - [`scratch_footprint`](<#scratch_footprint>)


---
### populate\_allowed\_seccomp<!-- {{#callable:populate_allowed_seccomp}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L452>)

Populates a `sock_filter` array with a security policy for a sender tile and returns the instruction count.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure, which is not used in this function.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure, which is not used in this function.
    - ``out_cnt``: An unsigned long integer representing the number of elements in the `out` array.
    - ``out``: A pointer to an array of `sock_filter` structures where the security policy will be populated.
- **Logic and Control Flow**:
    - Ignore the `topo` and `tile` parameters as they are not used in the function.
    - Call `populate_sock_filter_policy_fd_sender_tile` with `out_cnt`, `out`, and the file descriptor from `fd_log_private_logfile_fd()`.
    - Return the value of `sock_filter_policy_fd_sender_tile_instr_cnt`.
- **Output**: Returns an unsigned long integer representing the number of instructions in the populated `sock_filter` policy.


---
### populate\_allowed\_fds<!-- {{#callable:populate_allowed_fds}} -->
[View Source →](<../../../../../src/discof/sender/fd_sender_tile.c#L464>)

Populates an array with file descriptors for standard error and a log file, if available.
- **Inputs**:
    - ``topo``: A pointer to a `fd_topo_t` structure, which is not used in this function.
    - ``tile``: A pointer to a `fd_topo_tile_t` structure, which is not used in this function.
    - ``out_fds_cnt``: The maximum number of file descriptors that can be stored in the `out_fds` array.
    - ``out_fds``: An array of integers where the function will store the allowed file descriptors.
- **Logic and Control Flow**:
    - Ignore the `topo` and `tile` parameters as they are not used.
    - Check if `out_fds_cnt` is less than 2; if so, log an error and terminate the program.
    - Initialize `out_cnt` to 0 to keep track of the number of file descriptors added.
    - Add the file descriptor for standard error (`2UL`) to the `out_fds` array and increment `out_cnt`.
    - Check if the log file descriptor is valid (not equal to `-1`); if valid, add it to the `out_fds` array and increment `out_cnt`.
- **Output**: Returns the number of file descriptors added to the `out_fds` array.



---
Made with ❤️ by [Driver](https://www.driver.ai/)