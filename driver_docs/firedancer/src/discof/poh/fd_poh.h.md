<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for the Firedancer Proof of History (PoH) implementation, detailing structures, constants, and functions for managing leader slots, hashing, and microblock processing.

# Purpose
The code is a C header file that defines the structure and functionality for a Proof of History (PoH) implementation, which is a component of the Solana blockchain protocol. The PoH mechanism is used to provide a verifiable sequence of events, ensuring that the order of transactions is maintained and that the network can agree on the passage of time without relying on a centralized clock. This is achieved by continuously computing hashes, even when a node is not the leader, to prove that time has passed and to prevent malicious leaders from skipping slots without doing the necessary work.

The file defines several key components, including the `fd_poh_t` structure, which holds the state and configuration for the PoH process, such as tick duration, hash count per tick, and slot information. It also includes function prototypes for initializing and managing the PoH state, such as [`fd_poh_new`](<#fd_poh_new>), [`fd_poh_reset`](<#fd_poh_reset>), and [`fd_poh_advance`](<#fd_poh_advance>). The header file specifies constants like `FD_POH_ALIGN` and `FD_POH_FOOTPRINT` for memory alignment and footprint requirements, and it includes macros and structures to manage microblocks and skipped ticks. The PoH implementation is critical for maintaining the integrity and synchronization of the Solana network by ensuring that all nodes can verify the sequence of events and detect any attempts to manipulate the order of transactions.
# Imports and Dependencies

---
- `../../disco/pack/fd_pack.h`
- `../../disco/stem/fd_stem.h`
- `../../util/fd_util_base.h`
- `../../ballet/sha256/fd_sha256.h`


# Data Structures

---
### fd\_poh\_leader\_slot\_ended
- **Type**: ``struct``
- **Members**:
    - `completed`: Indicates if the leader slot has completed processing.
    - `slot`: Represents the slot number that has ended.
    - `blockhash`: Stores the hash of the block associated with the ended slot.
- **Description**: The `fd_poh_leader_slot_ended` structure is used to represent the state of a leader slot that has finished processing in the Proof of History (PoH) system. It contains information about whether the slot has completed, the specific slot number, and the hash of the block associated with that slot. This structure is part of the mechanism to track and verify the completion of leader slots in a distributed network, ensuring the integrity and continuity of the blockchain.


---
### fd\_poh\_leader\_slot\_ended\_t
- **Type**: ``struct``
- **Members**:
    - ``completed``: Indicates if the leader slot has completed.
    - ``slot``: Represents the slot number that has ended.
    - ``blockhash``: Stores the hash of the block for the completed slot.
- **Description**: The `fd_poh_leader_slot_ended_t` structure is used to represent the state of a leader slot that has ended in the Proof of History (PoH) mechanism. It contains information about whether the slot has completed, the specific slot number, and the hash of the block associated with that slot. This structure is part of the PoH system, which is integral to the Solana blockchain's operation, ensuring that leader slots are processed and verified correctly.


---
### fd\_poh\_out\_private
- **Type**: ``struct``
- **Members**:
    - ``idx``: An unsigned long integer that likely serves as an index or identifier.
    - ``mem``: A pointer to a `fd_wksp_t` structure, which likely represents a memory workspace.
    - ``chunk0``: An unsigned long integer that may represent the initial chunk or segment of data.
    - ``wmark``: An unsigned long integer that could represent a watermark or threshold value.
    - ``chunk``: An unsigned long integer that may represent a current or active chunk of data.
- **Description**: The `fd_poh_out_private` structure is a data structure that contains fields for managing memory and data chunks, likely in the context of a Proof of History (PoH) implementation. It includes an index, a pointer to a memory workspace, and several unsigned long integers that may represent data chunks and a watermark. This structure is used internally to manage output data related to PoH operations.


---
### fd\_poh\_out\_t
- **Type**: ``struct``
- **Members**:
    - ``idx``: Stores the index of the current operation or state.
    - ``mem``: Points to a workspace memory region used by the structure.
    - ``chunk0``: Holds the initial chunk value for processing.
    - ``wmark``: Represents a watermark or threshold value.
    - ``chunk``: Stores the current chunk value being processed.
- **Description**: `fd_poh_out_t` is a structure that manages memory and processing state for operations related to Proof of History (PoH) in a distributed system. It includes fields for indexing, memory management, and chunk processing, which are essential for handling the PoH operations efficiently.


---
### fd\_poh\_private
- **Type**: ``struct``
- **Members**:
    - ``state``: Stores the current state of the PoH process.
    - ``tick_duration_ns``: Specifies the duration of a tick in nanoseconds.
    - ``hashcnt_per_tick``: Indicates the number of hash counts per tick.
    - ``ticks_per_slot``: Defines the number of ticks in a slot.
    - ``slot_duration_ns``: Precomputed duration of a slot in nanoseconds.
    - ``hashcnt_duration_ns``: Precomputed duration of a hash count in nanoseconds.
    - ``hashcnt_per_slot``: Precomputed number of hash counts per slot.
    - ``max_microblocks_per_slot``: Maximum number of microblocks that can be published in a slot.
    - ``completed_block_id``: Stores the block ID of the completed block.
    - ``reset_slot``: Slot number on which the PoH was reset.
    - ``reset_slot_start_ns``: Start time of the reset slot in nanoseconds.
    - ``slot``: Current slot number in the PoH process.
    - ``hashcnt``: Current hash count within the slot.
    - ``next_leader_slot``: Slot number for the next leader.
    - ``leader_slot_start_ns``: Start time of the leader slot in nanoseconds.
    - ``last_slot``: Slot number of the last published microblock.
    - ``last_hashcnt``: Hash count of the last published microblock.
    - ``slot_done``: Indicates if the slot done message has been received.
    - ``microblocks_lower_bound``: Tracks the lower bound of microblocks in the slot.
    - ``reset_hash``: Aligned array storing the reset hash.
    - ``hash``: Aligned array storing the current hash.
    - ``skipped_tick_hashes``: Stores hashes for skipped ticks.
    - ``sha256``: Pointer to a SHA-256 context.
    - ``shred_out``: Output structure for shreds.
    - ``replay_out``: Output structure for replays.
    - ``magic``: Magic number for validation.
- **Description**: The `fd_poh_private` structure is a complex data structure used in the Proof of History (PoH) process, which is part of the Solana blockchain protocol. It manages the state and configuration of the PoH, including timing and hash count parameters, and tracks the progress of slots and microblocks. The structure also handles the storage of hashes for skipped ticks and provides output structures for shreds and replays. It is aligned to a specific memory boundary and includes a magic number for validation purposes.


---
### fd\_poh\_t
- **Type**: ``struct``
- **Members**:
    - ``state``: Stores the current state of the PoH process.
    - ``tick_duration_ns``: Specifies the duration of a tick in nanoseconds.
    - ``hashcnt_per_tick``: Indicates the number of hash counts per tick.
    - ``ticks_per_slot``: Defines the number of ticks in a slot.
    - ``slot_duration_ns``: Precomputed duration of a slot in nanoseconds.
    - ``hashcnt_duration_ns``: Precomputed duration of a hash count in nanoseconds.
    - ``hashcnt_per_slot``: Precomputed number of hash counts per slot.
    - ``max_microblocks_per_slot``: Maximum number of microblocks that can be published in a slot.
    - ``completed_block_id``: Stores the block ID of the completed block.
    - ``reset_slot``: Slot on which the PoH was reset.
    - ``reset_slot_start_ns``: Start time of the reset slot in nanoseconds.
    - ``slot``: Current slot of the PoH process.
    - ``hashcnt``: Current hash count within the slot.
    - ``next_leader_slot``: Next slot where the node will be the leader.
    - ``leader_slot_start_ns``: Start time of the leader slot in nanoseconds.
    - ``last_slot``: Last slot for which a microblock was published.
    - ``last_hashcnt``: Hash count of the last published microblock.
    - ``slot_done``: Indicates if the slot done message has been received.
    - ``microblocks_lower_bound``: Tracks the lower bound of microblocks that might still be received in the slot.
    - ``reset_hash``: Hash value at the reset point.
    - ``hash``: Current hash value in the PoH process.
    - ``skipped_tick_hashes``: Stores hashes for ticks that were skipped.
    - ``sha256``: Pointer to the SHA-256 hashing context.
    - ``shred_out``: Output structure for shreds.
    - ``replay_out``: Output structure for replay.
    - ``magic``: Magic number for identifying the PoH structure.
- **Description**: `fd_poh_t` is a data structure that represents the state and configuration of the Proof of History (PoH) process in a distributed network. It includes fields for managing the timing and hashing operations required to maintain the PoH chain, such as tick durations, hash counts, and slot information. The structure also tracks the progress of microblocks and manages the transition between leader slots, ensuring that the network can verify the sequence of events and detect any skipped slots. Additionally, it contains fields for storing hash values and managing the output of shreds and replays.


# Function Declarations (Public API)

---
### fd\_poh\_align<!-- {{#callable_declaration:fd_poh_align}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L451>)

Returns the alignment requirement for a memory region to hold a `fd_poh_t`.
- **Description**: Use this function to obtain the alignment requirement for a memory region intended to store a `fd_poh_t` structure. This alignment is necessary to ensure proper memory access and performance. The function is constant and does not depend on any input parameters or state, making it safe to call at any time.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the alignment requirement, which is a power of 2.
- **See Also**: [`fd_poh_align`](<fd_poh.c.md#fd_poh_align>)  (Implementation)


---
### fd\_poh\_footprint<!-- {{#callable_declaration:fd_poh_footprint}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L456>)

Returns the memory footprint required for a `fd_poh_t` structure.
- **Description**: Use this function to determine the amount of memory needed to store a `fd_poh_t` structure. This is useful for allocating memory regions that will hold this structure. The function does not require any initialization or prior setup and can be called at any time.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the memory footprint in bytes.
- **See Also**: [`fd_poh_footprint`](<fd_poh.c.md#fd_poh_footprint>)  (Implementation)


---
### fd\_poh\_new<!-- {{#callable_declaration:fd_poh_new}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L459>)

Initializes a new Proof of History (PoH) instance in shared memory.
- **Description**: Use this function to initialize a new PoH instance in a provided shared memory region. This function sets up the initial state of the PoH instance, ensuring it is ready for use. It must be called with a valid, properly aligned memory region. If the provided memory is null or misaligned, the function will log a warning and return null. This function is typically called once to set up the PoH instance before any other operations are performed on it.
- **Inputs**:
    - `shmem`: A pointer to a shared memory region where the PoH instance will be initialized. The memory must be aligned according to `fd_poh_align()`. Must not be null. If null or misaligned, the function logs a warning and returns null.
- **Output**: Returns a pointer to the initialized PoH instance on success, or null if the input is invalid.
- **See Also**: [`fd_poh_new`](<fd_poh.c.md#fd_poh_new>)  (Implementation)


---
### fd\_poh\_join<!-- {{#callable_declaration:fd_poh_join}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L462>)

Joins a Proof of History (PoH) instance with specified output configurations.
- **Description**: Use this function to associate a PoH instance with specific output configurations for shreds and replays. This function requires a valid and properly aligned memory region that represents a PoH instance. It checks the integrity of the PoH instance using a magic number. If the memory region is null, misaligned, or has an incorrect magic number, the function returns null. This function must be called before using the PoH instance for any operations.
- **Inputs**:
    - `shpoh`: A pointer to a memory region representing a PoH instance. Must not be null and must be aligned according to `fd_poh_align()`. The memory region must contain a valid PoH instance with the correct magic number.
    - `shred_out`: A pointer to an `fd_poh_out_t` structure that specifies the output configuration for shreds. Must not be null. The function copies this configuration to the PoH instance.
    - `replay_out`: A pointer to an `fd_poh_out_t` structure that specifies the output configuration for replays. Must not be null. The function copies this configuration to the PoH instance.
- **Output**: Returns a pointer to the joined `fd_poh_t` instance if successful, or null if the input is invalid.
- **See Also**: [`fd_poh_join`](<fd_poh.c.md#fd_poh_join>)  (Implementation)


---
### fd\_poh\_have\_leader\_bank<!-- {{#callable_declaration:fd_poh_have_leader_bank}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L480>)

Checks if the current state is waiting for a slot or is a leader.
- **Description**: Use this function to determine if the current Proof of History (PoH) instance is in a state where it is either waiting for a slot to become available or is currently acting as the leader. This function is useful for decision-making processes that depend on the PoH state, such as initiating leader-specific actions or handling slot transitions. Ensure that the `poh` parameter is a valid pointer to a `fd_poh_t` structure before calling this function.
- **Inputs**:
    - `poh`: A pointer to a constant `fd_poh_t` structure. This parameter must not be null and should point to a valid PoH instance. If the pointer is invalid, the behavior is undefined.
- **Output**: Returns an integer value: 1 if the PoH state is either `STATE_WAITING_FOR_SLOT` or `STATE_LEADER`, otherwise 0.
- **See Also**: [`fd_poh_have_leader_bank`](<fd_poh.c.md#fd_poh_have_leader_bank>)  (Implementation)


---
### fd\_poh\_hashing\_to\_leader\_slot<!-- {{#callable_declaration:fd_poh_hashing_to_leader_slot}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L483>)

Checks if hashing is in progress for the leader slot.
- **Description**: Use this function to determine if the hashing process is currently active for the leader slot. This is useful in scenarios where you need to verify if the system is in a state of waiting for a slot or actively leading. The function should be called with a valid `fd_poh_t` object that has been properly initialized. It returns a boolean-like integer indicating the status of the hashing process.
- **Inputs**:
    - `poh`: A pointer to a constant `fd_poh_t` structure. This parameter must not be null and should point to a valid and initialized `fd_poh_t` object. The function checks the state and slot information within this structure to determine the hashing status.
- **Output**: Returns an integer value: 1 if hashing is in progress for the leader slot, 0 otherwise.
- **See Also**: [`fd_poh_hashing_to_leader_slot`](<fd_poh.c.md#fd_poh_hashing_to_leader_slot>)  (Implementation)


---
### fd\_poh\_done\_packing<!-- {{#callable_declaration:fd_poh_done_packing}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L494>)

Finalizes the packing process for a slot.
- **Description**: Use this function to indicate that the packing process for a slot is complete. It must be called when the `fd_poh_t` instance is in the leader state. This function ensures that the number of microblocks processed matches the expected count for the slot. It adjusts internal counters to reflect the completion of the slot's packing. Call this function after all microblocks for the slot have been processed to maintain consistency in the slot's state.
- **Inputs**:
    - `poh`: A pointer to an `fd_poh_t` structure representing the current state of the proof of history. Must not be null and must be in the leader state.
    - `microblocks_in_slot`: The number of microblocks that were packed into the slot. Must match the expected number of microblocks for the slot.
- **Output**: None
- **See Also**: [`fd_poh_done_packing`](<fd_poh.c.md#fd_poh_done_packing>)  (Implementation)


---
### fd\_poh\_advance<!-- {{#callable_declaration:fd_poh_advance}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L498>)

Advances the state of a Proof of History (PoH) instance.
- **Description**: Use this function to progress the state of a PoH instance, which is part of a distributed ledger system. It must be called regularly to ensure the PoH instance remains synchronized with the system's expected state. This function handles various states of the PoH, such as leader transitions and slot advancements. It also manages the publication of ticks and microblocks, ensuring that the PoH instance adheres to protocol rules. Callers must ensure that the PoH instance is properly initialized and not in an uninitialized or waiting state before calling this function. The function modifies the PoH state and may update the provided integer pointers to indicate polling and busy status.
- **Inputs**:
    - `poh`: A pointer to a `fd_poh_t` structure representing the PoH instance. Must not be null and must point to a valid, initialized PoH instance.
    - `stem`: A pointer to a `fd_stem_context_t` structure used for context during PoH operations. Must not be null.
    - `opt_poll_in`: A pointer to an integer that indicates whether polling is needed. The function may set this to 0 to indicate no polling is required. Must not be null.
    - `charge_busy`: A pointer to an integer that indicates whether the PoH instance is busy. The function sets this to 1 if the instance is busy. Must not be null.
- **Output**: None
- **See Also**: [`fd_poh_advance`](<fd_poh.c.md#fd_poh_advance>)  (Implementation)


---
### fd\_poh1\_mixin<!-- {{#callable_declaration:fd_poh1_mixin}} -->
[View Source →](<../../../../../src/discof/poh/fd_poh.h#L504>)

Mixes transactions into the Proof of History chain.
- **Description**: Use this function to incorporate a set of transactions into the Proof of History (PoH) chain when the node is the leader. It should be called with the current slot and a hash of the transactions. The function checks if the slot is valid and if the node is in the correct state to process transactions. It increments the microblock count and updates the PoH hash if there are successful transactions. This function must be called when the node is the leader and the slot is active.
- **Inputs**:
    - `poh`: A pointer to a `fd_poh_t` structure representing the current state of the PoH. Must not be null and should be properly initialized.
    - `stem`: A pointer to a `fd_stem_context_t` structure used for context during the operation. Must not be null.
    - `slot`: An unsigned long representing the current slot number. Must match the `next_leader_slot` and `slot` in `poh`.
    - `hash`: A pointer to a 32-byte array containing the hash of the transactions. Must not be null.
    - `txn_cnt`: An unsigned long representing the number of transactions in the `txns` array. Can be zero.
    - `txns`: A pointer to an array of `fd_txn_p_t` structures representing the transactions to be processed. Must not be null if `txn_cnt` is greater than zero.
- **Output**: None
- **See Also**: [`fd_poh1_mixin`](<fd_poh.c.md#fd_poh1_mixin>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)