<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a vote tracker with a deque and map for managing and querying vote signatures.

# Purpose
The code defines a vote tracking system using a combination of a deque and a map data structure. The primary purpose of this code is to manage and track vote signatures efficiently. The `fd_vote_tracker` structure serves as the main data structure, containing offsets to a deque and a map, which are used to store and manage vote signatures. The code includes functions to align memory, calculate the memory footprint, and create a new vote tracker instance. It also provides functions to insert new vote signatures and query existing ones.

The code uses templates from external files `fd_deque.c` and `fd_map_chain.c` to implement the deque and map functionalities. The deque is used to maintain the order of vote signatures, while the map provides quick access to check for the existence of a vote signature. The [`fd_vote_tracker_insert`](<#fd_vote_tracker_insert>) function manages the insertion of new vote signatures, ensuring that the deque does not exceed its maximum capacity by removing the oldest entry if necessary. The [`fd_vote_tracker_query_sig`](<#fd_vote_tracker_query_sig>) function checks if a given vote signature is present in the tracker. The code is designed to be part of a larger system, where it can be included and used to track votes in a memory-efficient manner.
# Imports and Dependencies

---
- `fd_vote_tracker.h`
- `../../util/tmpl/fd_deque.c`
- `../../util/tmpl/fd_map_chain.c`


# Data Structures

---
### fd\_vote\_tracker\_ele
- **Type**: ``struct``
- **Members**:
    - `vote_sig`: Holds the signature of a vote.
    - `next_`: Used internally for pool/map operations.
- **Description**: Defines an element in a vote tracking system, where `vote_sig` stores the signature of a vote and `next_` is used for internal management within a pool or map structure.


---
### fd\_vote\_tracker\_ele\_t
- **Type**: ``struct``
- **Members**:
    - `vote_sig`: Stores the signature of a vote.
    - `next_`: Used internally for pool or map operations.
- **Description**: `fd_vote_tracker_ele_t` is a structure that represents an element in a vote tracking system, containing a vote signature and an internal field for managing its position in a pool or map.


---
### fd\_vote\_tracker
- **Type**: ``struct``
- **Members**:
    - `magic`: A unique identifier for the `fd_vote_tracker` structure.
    - `deq_offset`: The offset to the deque memory within the `fd_vote_tracker` structure.
    - `map_offset`: The offset to the map memory within the `fd_vote_tracker` structure.
- **Description**: The `fd_vote_tracker` structure manages a voting system using a deque and a map to track votes. It contains offsets to the deque and map memory, allowing efficient access and manipulation of vote data. The `magic` field serves as an identifier to ensure the integrity of the structure.


---
### fd\_vote\_tracker\_t
- **Type**: ``struct``
- **Members**:
    - `magic`: A field used for internal validation or identification.
    - `deq_offset`: Stores the offset to the deque memory region.
    - `map_offset`: Stores the offset to the map memory region.
- **Description**: Manages a collection of vote signatures using a deque and a map for efficient insertion and query operations. The structure uses offsets to manage memory regions for the deque and map, allowing dynamic memory allocation and alignment. It supports operations to insert new vote signatures and query existing ones, ensuring that the collection does not exceed a predefined maximum size.


# Functions

---
### fd\_vote\_tracker\_deq\_get<!-- {{#callable:fd_vote_tracker_deq_get}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L32>)

Retrieves a pointer to the deque associated with a given vote tracker.
- **Inputs**:
    - `vote_tracker`: A pointer to an `fd_vote_tracker_t` structure, which contains the offsets for the deque and map.
- **Logic and Control Flow**:
    - Calculate the memory address of the deque by adding the `deq_offset` from the `vote_tracker` to the base address of `vote_tracker`.
    - Call `fd_vote_tracker_deq_join` with the calculated address to obtain a pointer to the deque.
- **Output**: A pointer to an `fd_vote_tracker_ele_t` structure, representing the deque associated with the given vote tracker.


---
### fd\_vote\_tracker\_map\_get<!-- {{#callable:fd_vote_tracker_map_get}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L37>)

Retrieves the map component from a `fd_vote_tracker_t` structure.
- **Inputs**:
    - `vote_tracker`: A pointer to a `fd_vote_tracker_t` structure from which to retrieve the map component.
- **Logic and Control Flow**:
    - Calculate the address of the map component by adding the `map_offset` to the base address of `vote_tracker`.
    - Call `fd_vote_tracker_map_join` with the calculated address to retrieve the map component.
- **Output**: A pointer to the `fd_vote_tracker_map_t` structure associated with the given `vote_tracker`.


---
### fd\_vote\_tracker\_align<!-- {{#callable:fd_vote_tracker_align}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L42>)

Calculates the maximum alignment requirement among the vote tracker map, deque, and the `fd_vote_tracker_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `fd_vote_tracker_map_align()` to get the alignment requirement for the vote tracker map.
    - Calls `fd_vote_tracker_deq_align()` to get the alignment requirement for the vote tracker deque.
    - Uses `alignof(fd_vote_tracker_t)` to get the alignment requirement for the `fd_vote_tracker_t` structure.
    - Applies `fd_ulong_max` to find the maximum alignment requirement among the three values.
- **Output**: Returns the maximum alignment requirement as an unsigned long integer.


---
### fd\_vote\_tracker\_footprint<!-- {{#callable:fd_vote_tracker_footprint}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L47>)

Calculates the memory footprint required for a vote tracker structure, including its deque and map components.
- **Inputs**: None
- **Logic and Control Flow**:
    - Initialize `map_chain_cnt` with the estimated map chain count using `fd_vote_tracker_map_chain_cnt_est` and `VOTE_TRACKER_MAX`.
    - Initialize `l` with `FD_LAYOUT_INIT`.
    - Append the alignment and size of `fd_vote_tracker_t` to `l` using `FD_LAYOUT_APPEND`.
    - Append the alignment and footprint of the deque to `l` using `FD_LAYOUT_APPEND`.
    - Append the alignment and footprint of the map to `l` using `FD_LAYOUT_APPEND`, with the map chain count as a parameter.
    - Finalize the layout `l` with `FD_LAYOUT_FINI` and return the result.
- **Output**: Returns an `ulong` representing the total memory footprint required for the vote tracker structure.
- **Functions Called**:
    - [`fd_vote_tracker_align`](<#fd_vote_tracker_align>)


---
### fd\_vote\_tracker\_new<!-- {{#callable:fd_vote_tracker_new}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L57>)

Initializes a new `fd_vote_tracker_t` structure in the provided memory space, ensuring proper alignment and allocation of internal components.
- **Inputs**:
    - `mem`: A pointer to the memory space where the `fd_vote_tracker_t` structure will be initialized.
    - `seed`: An unsigned long integer used to seed the map component of the vote tracker.
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if so, log a warning and return NULL.
    - Check if `mem` is properly aligned according to [`fd_vote_tracker_align`](<#fd_vote_tracker_align>); if not, log a warning and return NULL.
    - Estimate the number of map chains needed using `fd_vote_tracker_map_chain_cnt_est` with `VOTE_TRACKER_MAX`.
    - Initialize scratch allocation with `FD_SCRATCH_ALLOC_INIT`.
    - Allocate memory for `fd_vote_tracker_t`, dequeue, and map components using `FD_SCRATCH_ALLOC_APPEND`.
    - Verify the final layout with `FD_SCRATCH_ALLOC_FINI`; if incorrect, log a warning and return NULL.
    - Initialize the dequeue with `fd_vote_tracker_deq_new`; if it fails, log a warning and return NULL.
    - Initialize the map with `fd_vote_tracker_map_new` using the seed; if it fails, log a warning and return NULL.
    - Calculate and set the offsets for the dequeue and map within the `vote_tracker`.
- **Output**: A pointer to the newly initialized `fd_vote_tracker_t` structure, or NULL if initialization fails.
- **Functions Called**:
    - [`fd_vote_tracker_align`](<#fd_vote_tracker_align>)
    - [`fd_vote_tracker_footprint`](<#fd_vote_tracker_footprint>)


---
### fd\_vote\_tracker\_join<!-- {{#callable:fd_vote_tracker_join}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L98>)

Casts a memory pointer to a `fd_vote_tracker_t` pointer.
- **Inputs**:
    - `mem`: A pointer to memory that is expected to be a `fd_vote_tracker_t` object.
- **Logic and Control Flow**:
    - Casts the input `mem` to a `fd_vote_tracker_t` pointer.
    - Returns the casted pointer.
- **Output**: A pointer to `fd_vote_tracker_t` cast from the input `mem`.


---
### fd\_vote\_tracker\_insert<!-- {{#callable:fd_vote_tracker_insert}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L103>)

Inserts a vote signature into the vote tracker, managing the deque and map to ensure capacity constraints are respected.
- **Inputs**:
    - `vote_tracker`: A pointer to the `fd_vote_tracker_t` structure that manages the vote tracking system.
    - `vote_sig`: A constant pointer to the `fd_signature_t` structure representing the vote signature to insert.
- **Logic and Control Flow**:
    - Retrieve the deque and map associated with the `vote_tracker`.
    - Check if the deque is full; if so, remove the oldest element from the deque and map.
    - Push a new element to the tail of the deque and assign the `vote_sig` to it.
    - Insert the new element into the map.
- **Output**: No return value; the function modifies the state of the `vote_tracker` by adding a new vote signature.
- **Functions Called**:
    - [`fd_vote_tracker_deq_get`](<#fd_vote_tracker_deq_get>)
    - [`fd_vote_tracker_map_get`](<#fd_vote_tracker_map_get>)


---
### fd\_vote\_tracker\_query\_sig<!-- {{#callable:fd_vote_tracker_query_sig}} -->
[View Source →](<../../../../../src/discof/replay/fd_vote_tracker.c#L117>)

Checks if a given vote signature exists in the vote tracker.
- **Inputs**:
    - `vote_tracker`: A pointer to an `fd_vote_tracker_t` structure, which manages the vote tracking data.
    - `vote_sig`: A pointer to a constant `fd_signature_t` structure representing the vote signature to query.
- **Logic and Control Flow**:
    - Retrieve the deque associated with the `vote_tracker` using [`fd_vote_tracker_deq_get`](<#fd_vote_tracker_deq_get>) function.
    - Retrieve the map associated with the `vote_tracker` using [`fd_vote_tracker_map_get`](<#fd_vote_tracker_map_get>) function.
    - Call `fd_vote_tracker_map_ele_query` with the map, the vote signature, a NULL pointer, and the deque to check if the signature exists.
    - Return the result of the query, which is non-zero if the signature is found and zero otherwise.
- **Output**: An integer indicating whether the vote signature exists in the vote tracker (non-zero if it exists, zero if it does not).
- **Functions Called**:
    - [`fd_vote_tracker_deq_get`](<#fd_vote_tracker_deq_get>)
    - [`fd_vote_tracker_map_get`](<#fd_vote_tracker_map_get>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)