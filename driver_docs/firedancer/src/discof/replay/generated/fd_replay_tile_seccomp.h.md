<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall control based on architecture and specific syscalls.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific application. It is generated automatically and should not be edited manually. The file includes necessary headers for working with seccomp and BPF (Berkeley Packet Filter) and defines architecture-specific constants to ensure compatibility with the runtime environment. The primary function, [`populate_sock_filter_policy_fd_replay_tile`](<#populate_sock_filter_policy_fd_replay_tile>), initializes a BPF filter array that enforces security policies by allowing or denying specific system calls based on predefined conditions.

The filter policy checks the architecture of the executing environment and allows only certain system calls, such as `SYS_write` and `SYS_fsync`, under specific conditions. If the conditions are not met, the process is terminated using `SECCOMP_RET_KILL_PROCESS`. The function [`populate_sock_filter_policy_fd_replay_tile`](<#populate_sock_filter_policy_fd_replay_tile>) takes an output count, a pointer to a `sock_filter` structure, and a file descriptor for a log file as parameters. It uses these to populate the filter array, which is then used to enforce the security policy. This header file is intended to be included in other C source files where seccomp filtering is required.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_replay\_tile\_instr\_cnt
- **Type**: `unsigned int`
- **Description**: This variable is a constant unsigned integer that represents the number of instructions in a socket filter policy for replaying tile operations.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions in the `populate_sock_filter_policy_fd_replay_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_replay\_tile<!-- {{#callable:populate_sock_filter_policy_fd_replay_tile}} -->
[View Source →](<../../../../../../src/discof/replay/generated/fd_replay_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a seccomp filter policy to control system call permissions based on architecture and file descriptor checks.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, expected to be at least 14.
    - `out`: A pointer to an array of `sock_filter` structures where the filter policy will be stored.
    - `logfile_fd`: The file descriptor to be checked against syscall arguments for permission.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or `logfile_fd`; allow or kill the process based on the check.
    - For `SYS_fsync`, load the first syscall argument and check if it is `logfile_fd`; allow or kill the process based on the check.
    - Use `fd_memcpy` to copy the `filter` array to the `out` array.
- **Output**: The function does not return a value; it modifies the `out` array in place with the seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)