<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for syscall restrictions based on architecture and specific conditions.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a specific architecture. It includes necessary headers for seccomp and BPF (Berkeley Packet Filter) operations, and it sets up a filter to restrict system calls based on predefined rules. The file is generated automatically and should not be edited manually. It defines a constant `sock_filter_policy_fd_resolv_tile_instr_cnt` to specify the number of instructions in the filter.

The function [`populate_sock_filter_policy_fd_resolv_tile`](<#populate_sock_filter_policy_fd_resolv_tile>) initializes a BPF filter array with 14 instructions. The filter checks if the architecture of the executing environment matches the expected architecture. It allows specific system calls, such as `write` and `fsync`, only if certain conditions are met, such as matching syscall arguments. If the conditions are not met, the filter will terminate the process using `SECCOMP_RET_KILL_PROCESS`. The function uses `fd_memcpy` to copy the filter instructions to the output buffer. The code is designed to be used in environments where security and control over system calls are necessary.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_fd\_resolv\_tile\_instr\_cnt
- **Type**: `unsigned int`
- **Description**: The variable `sock_filter_policy_fd_resolv_tile_instr_cnt` is a constant unsigned integer that holds the value 14.
- **Use**: Indicates the number of instructions in the `sock_filter` array used in the `populate_sock_filter_policy_fd_resolv_tile` function.


# Functions

---
### populate\_sock\_filter\_policy\_fd\_resolv\_tile<!-- {{#callable:populate_sock_filter_policy_fd_resolv_tile}} -->
[View Source →](<../../../../../../src/discof/resolv/generated/fd_resolv_tile_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call permissions.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 14.
    - `out`: A pointer to a `sock_filter` array where the filter policy will be copied.
    - `logfile_fd`: The file descriptor to be allowed for certain system calls.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 14 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 14 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; if not equal, jump to `RET_KILL_PROCESS`.
    - Load the syscall number and check if it is `SYS_write` or `SYS_fsync`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_write`, check if the first argument is 2 or `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - For `SYS_fsync`, check if the first argument is `logfile_fd`; if not, jump to `RET_KILL_PROCESS`.
    - If none of the conditions are met, execute `RET_KILL_PROCESS`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value; it modifies the `out` array in place.



---
Made with ❤️ by [Driver](https://www.driver.ai/)