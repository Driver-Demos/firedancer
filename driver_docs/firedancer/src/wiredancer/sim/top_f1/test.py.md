<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A cocotb-based test for simulating and verifying PCIe transactions and ED25519 signature operations.

# Purpose
The code is a test suite for a hardware design verification environment using the Cocotb framework. It defines an asynchronous test function [`test`](<#test>) that interacts with a device under test (DUT) by simulating clock signals, toggling resets, and monitoring various components of the DUT. The test initializes several signals and queues to manage data flow and communication with the DUT. It uses the `wd_cocotil` module to perform operations such as toggling resets, monitoring signals, and generating random transactions.

The test suite simulates a series of transactions, including reading from a packet capture file and generating random data for signature verification using the Ed25519 algorithm. It introduces errors in the data to test the DUT's error handling capabilities. The test function manages the flow of transactions through the DUT by appending them to queues and writing them to the DUT's PCIe interface. The test continues to run until all transactions are processed, ensuring that the DUT's behavior is thoroughly verified under various conditions.
# Imports and Dependencies

---
- `os`
- `random`
- `cocotb`
- `cocotb.clock.Clock`
- `cocotb.triggers.Timer`
- `cocotb.triggers.RisingEdge`
- `cocotb.triggers.ReadOnly`
- `cocotb.binary.BinaryValue`
- `ref_ed25519`
- `wd_cocotil`
- `pcap`


# Functions

---
### test<!-- {{#callable:firedancer/src/wiredancer/sim/top_f1/test.test}} -->
[View Source →](<../../../../../../src/wiredancer/sim/top_f1/test.py#L14>)

Executes a test on a device under test (DUT) by initializing signals, starting clocks, monitoring various components, and processing transactions.
- **Decorators**: `@cocotb.test`
- **Inputs**:
    - `dut`: The device under test (DUT) which is an object representing the hardware module to be tested.
- **Logic and Control Flow**:
    - Initialize DUT signals `avmm_read`, `avmm_write`, `dma_f`, `pcie_v`, and `send_fails` to specific values.
    - Create empty lists and dictionaries for various queues and transaction data.
    - Start clocks on `dut.clk` and `dut.clk_f` with specified periods and initiate resets using `wd_cocotil.toggle_reset`.
    - Start monitoring various components of the DUT using `wd_cocotil` functions, passing the DUT, clock, and queues for input and output transactions.
    - Wait for 1024 clock cycles twice to allow for post-reset stabilization of components.
    - Initialize transaction ID `tid`, PCIe address variables `pcie_a` and `pcie_b`, and size variables `min_sz` and `max_sz`.
    - Open a pcap file using `pcap.kpcap` to read packet data.
    - Iterate 32 times to simulate transaction processing, including random delays and backpressure handling for PCIe FIFO.
    - Read packet data from the pcap file or generate random data for signature, public key, and message, introducing random errors based on a random error rate.
    - Increment the transaction ID `tid` and create a transaction using `wd_cocotil.random_tr`, appending it to various queues.
    - Write transaction blocks to the DUT using `wd_cocotil.f1_write_32x16` and update the PCIe address `pcie_a`.
    - Wait for a rising edge of the clock after each transaction.
    - Continue waiting for rising edges of the clock until the `q_o_res_dma` queue is empty.
- **Output**: No explicit return value; the function performs operations on the DUT and queues.



---
Made with ❤️ by [Driver](https://www.driver.ai/)