<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the functionality of the `fd_notar` module, including block and vote operations.

# Purpose
The code is a C source file that serves as a test suite for functionalities related to a notarization system. It includes a [`main`](<#main>) function, indicating that it is an executable program. The primary focus of the code is to test the operations of a notarization component, which is part of a larger system that likely involves data integrity or consensus mechanisms. The function [`test_notar_simple`](<#test_notar_simple>) is the main test function, which allocates memory for a notarization structure, inserts blocks and votes, and verifies the correct operation of these components.

The code uses several key components, such as `fd_notar_t`, `fd_notar_blk_t`, and `fd_notar_vtr_t`, which are likely part of a library for handling notarization processes. The test involves creating a notarization object, inserting blocks and votes, and validating the voting process. The [`main`](<#main>) function initializes the environment, sets up a workspace, and calls the test function. The code also includes memory management operations, such as allocation and deallocation, to ensure proper resource handling during the test. The use of `FD_TEST` indicates assertions to verify the success of operations, which is typical in test suites to ensure expected behavior.
# Imports and Dependencies

---
- `fd_notar.h`


# Functions

---
### test\_notar\_simple<!-- {{#callable:test_notar_simple}} -->
[View Source →](<../../../../../src/choreo/notar/test_notar.c#L3>)

Tests the functionality of the notarization process by allocating memory, creating and joining notar and tower structures, inserting blocks and votes, and then cleaning up resources.
- **Inputs**:
    - `wksp`: A pointer to a `fd_wksp_t` workspace structure used for memory allocation.
- **Logic and Control Flow**:
    - Allocate memory for the notar structure using `fd_wksp_alloc_laddr` with alignment and footprint based on `blk_max`.
    - Check if memory allocation is successful using `FD_TEST`.
    - Create and join a new notar structure with [`fd_notar_new`](<fd_notar.c.md#fd_notar_new>) and [`fd_notar_join`](<fd_notar.c.md#fd_notar_join>).
    - Insert a block into the notar's block list with `fd_notar_blk_insert` using a predefined slot value.
    - Initialize the block's parent slot and bank hash, and set the stake to zero.
    - Define an array of public keys and insert them into the notar's voter list using `fd_notar_vtr_insert`, setting the bit field for each voter.
    - Define an array of stakes corresponding to the public keys.
    - Allocate memory for the tower structure using `fd_wksp_alloc_laddr` with alignment and footprint for the tower.
    - Check if memory allocation is successful using `FD_TEST`.
    - Create and join a new tower structure with `fd_tower_new` and `fd_tower_join`.
    - Cast a vote in the tower using `fd_tower_vote` with the predefined slot value.
    - Cast a valid vote in the notar structure using [`fd_notar_vote`](<fd_notar.c.md#fd_notar_vote>) with the last public key, its corresponding stake, and the tower.
    - Free the allocated memory for the notar structure using `fd_wksp_free_laddr`, [`fd_notar_delete`](<fd_notar.c.md#fd_notar_delete>), and [`fd_notar_leave`](<fd_notar.c.md#fd_notar_leave>).
- **Output**: No return value; the function performs operations and cleans up resources without returning data.
- **Functions Called**:
    - [`fd_notar_align`](<fd_notar.h.md#fd_notar_align>)
    - [`fd_notar_footprint`](<fd_notar.h.md#fd_notar_footprint>)
    - [`fd_notar_join`](<fd_notar.c.md#fd_notar_join>)
    - [`fd_notar_new`](<fd_notar.c.md#fd_notar_new>)
    - [`fd_notar_vote`](<fd_notar.c.md#fd_notar_vote>)
    - [`fd_notar_delete`](<fd_notar.c.md#fd_notar_delete>)
    - [`fd_notar_leave`](<fd_notar.c.md#fd_notar_leave>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/choreo/notar/test_notar.c#L41>)

Initializes the environment, creates a workspace, and then halts the program.
- **Inputs**:
    - `argc`: The count of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Sets `page_cnt` to 1 and `_page_sz` to "gigantic" for workspace configuration.
    - Retrieves the NUMA index using `fd_shmem_numa_idx` with an argument of 0.
    - Creates a new anonymous workspace `wksp` using `fd_wksp_new_anonymous` with the specified page size, page count, CPU index, and name.
    - Checks if the workspace `wksp` is successfully created using `FD_TEST`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.



---
Made with ❤️ by [Driver](https://www.driver.ai/)