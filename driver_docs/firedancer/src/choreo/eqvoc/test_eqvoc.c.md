<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests equivocation proof verification and manipulation for data shreds in a distributed system.

# Purpose
The code is a test suite designed to verify the functionality of equivocation proof verification in a system that uses shreds, which are data structures for data integrity and redundancy in distributed systems. It includes functions such as `test_eqvoc_proof_verify`, `test_eqvoc_proof_from_chunks`, and `test_eqvoc_proof_to_chunks` to test various scenarios of equivocation verification and manipulation of proofs related to data shreds. The code defines a static constant `producer`, a public key used in the verification process, and several test cases that simulate different conditions of equivocation, such as identity verification failure and mismatched shred payloads. The `fd_eqvoc_t` structure is central to managing and testing the integrity of data shreds, and the `main` function initializes the environment, sets up memory allocations, and executes the test functions. The code uses utility functions and macros like `FD_TEST` for assertions and is intended for internal validation, not as an executable or library for external use.
# Imports and Dependencies

---
- `fd_eqvoc.h`
- `stdlib.h`


# Global Variables

---
### producer
- **Type**: ``fd_pubkey_t``
- **Description**: A static constant variable of type `fd_pubkey_t` that holds a public key. The public key is represented as an array of 32 unsigned characters.
- **Use**: Used to store a fixed public key value for cryptographic operations.


# Functions

---
### test\_eqvoc\_proof\_verify<!-- {{#callable:test_eqvoc_proof_verify}} -->
[View Source →](<../../../../../src/choreo/eqvoc/test_eqvoc.c#L6>)

Tests the verification of equivocation proofs for different scenarios using the [`fd_eqvoc_shreds_verify`](<fd_eqvoc.c.md#fd_eqvoc_shreds_verify>) function.
- **Inputs**:
    - ``eqvoc``: A pointer to an `fd_eqvoc_t` structure, which contains the necessary data for equivocation verification.
- **Logic and Control Flow**:
    - Defines several byte arrays representing different test cases for equivocation verification.
    - Casts these byte arrays to `fd_shred_t` pointers using `fd_type_pun`.
    - Calls [`fd_eqvoc_shreds_verify`](<fd_eqvoc.c.md#fd_eqvoc_shreds_verify>) with different pairs of `fd_shred_t` pointers and checks the return value against expected results using `FD_TEST`.
    - Tests include identity verification failure, same shred index with different payloads, same FEC with different signatures, and other scenarios.
- **Output**: No return value; the function performs tests and uses assertions to verify expected outcomes.
- **Functions Called**:
    - [`fd_eqvoc_shreds_verify`](<fd_eqvoc.c.md#fd_eqvoc_shreds_verify>)


---
### test\_eqvoc\_proof\_from\_chunks<!-- {{#callable:test_eqvoc_proof_from_chunks}} -->
[View Source →](<../../../../../src/choreo/eqvoc/test_eqvoc.c#L69>)

Tests the creation of an equality proof from chunks of two shreds.
- **Inputs**:
    - `eqvoc`: A pointer to an `fd_eqvoc_t` structure, which is used in the proof creation.
    - `alloc`: A pointer to an `fd_alloc_t` structure, used for memory allocation.
    - `shred1_sz`: The size of the first shred in bytes.
    - `shred2_sz`: The size of the second shred in bytes.
    - `chunk_len`: The length of each chunk in bytes.
- **Logic and Control Flow**:
    - Calculate the total size `sz` as the sum of `shred1_sz` and `shred2_sz`.
    - Determine the number of chunks `chunk_cnt` by dividing `sz` by `chunk_len`, adjusting for any remainder.
    - Initialize an array `chunks` of `fd_gossip_duplicate_shred_t` structures with `chunk_cnt` elements.
    - For each chunk, set the `wallclock`, `num_chunks`, `chunk_len`, and `chunk_index` fields.
    - Fill the chunks with data from `shred1_ascii` and `shred2_ascii`, using a variant if the index matches `FD_SHRED_VARIANT_OFF`.
    - Allocate memory for an `fd_eqvoc_proof_t` structure and initialize it with the first chunk's data and `eqvoc->bmtree_mem`.
    - Set the `proof->set` to zero and assign `producer` to `proof->producer`.
    - Call [`fd_eqvoc_proof_from_chunks`](<fd_eqvoc.c.md#fd_eqvoc_proof_from_chunks>) to create the proof from the chunks.
    - Verify that the chunks match the proof's shreds for `shred1` and `shred2`.
- **Output**: No return value; the function performs tests and assertions to verify the proof creation.
- **Functions Called**:
    - [`fd_eqvoc_proof_init`](<fd_eqvoc.c.md#fd_eqvoc_proof_init>)
    - [`fd_eqvoc_proof_from_chunks`](<fd_eqvoc.c.md#fd_eqvoc_proof_from_chunks>)


---
### test\_eqvoc\_proof\_to\_chunks<!-- {{#callable:test_eqvoc_proof_to_chunks}} -->
[View Source →](<../../../../../src/choreo/eqvoc/test_eqvoc.c#L152>)

Tests the conversion of two shreds into chunks and verifies the integrity of the resulting chunks.
- **Inputs**:
    - `eqvoc`: A pointer to an `fd_eqvoc_t` structure, which is not used in this function.
    - `alloc`: A pointer to an `fd_alloc_t` structure used for memory allocation.
    - `shred1_sz`: The size of the first shred in bytes.
    - `shred2_sz`: The size of the second shred in bytes.
- **Logic and Control Flow**:
    - Allocate memory for `shred1_bytes` and `shred2_bytes` using `fd_alloc_malloc` with sizes `shred1_sz` and `shred2_sz`, respectively.
    - Initialize `shred1_bytes` and `shred2_bytes` with repeating ASCII patterns `shred1_ascii` and `shred2_ascii`.
    - Cast `shred1_bytes` and `shred2_bytes` to `fd_shred_t` pointers and set their `variant` fields based on their sizes.
    - Calculate the total size `sz`, number of chunks `chunk_cnt`, and chunk length `chunk_len`. Adjust `chunk_cnt` if there is a remainder when dividing `sz` by `chunk_len`.
    - Create an array `duplicate_shreds` to hold the chunks.
    - Initialize an `fd_eqvoc_proof_t` structure `proof`, set its `producer`, and copy `shred1` and `shred2` into `proof.shreds`.
    - Call [`fd_eqvoc_proof_to_chunks`](<fd_eqvoc.c.md#fd_eqvoc_proof_to_chunks>) to convert `proof` into `duplicate_shreds`.
    - Verify that each chunk in `duplicate_shreds` matches the corresponding part of `shred1_bytes` and `shred2_bytes`.
- **Output**: No return value; the function performs tests and uses `FD_TEST` to assert conditions.
- **Functions Called**:
    - [`fd_eqvoc_proof_to_chunks`](<fd_eqvoc.c.md#fd_eqvoc_proof_to_chunks>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/choreo/eqvoc/test_eqvoc.c#L216>)

Initializes and tests an EQVOC proof verification system using a workspace and various configurations.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the system with command-line arguments.
    - Sets default values for `page_cnt`, `_page_sz`, and `numa_idx`.
    - Logs the creation of a workspace with specified parameters.
    - Creates a new anonymous workspace using `fd_wksp_new_anonymous`.
    - Initializes a public key and a schedule for `fd_epoch_leaders_t`.
    - Allocates memory for EQVOC using `fd_wksp_alloc_laddr` and initializes it with [`fd_eqvoc_new`](<fd_eqvoc.c.md#fd_eqvoc_new>) and [`fd_eqvoc_join`](<fd_eqvoc.c.md#fd_eqvoc_join>).
    - Sets properties of the `eqvoc` structure, including `me`, `fec_max`, `proof_max`, `shred_version`, and `leaders`.
    - Allocates memory for a generic allocator and initializes it with `fd_alloc_new` and `fd_alloc_join`.
    - Calls [`test_eqvoc_proof_verify`](<#test_eqvoc_proof_verify>) to test EQVOC proof verification.
    - Iterates over combinations of shred sizes and chunk lengths to test [`test_eqvoc_proof_from_chunks`](<#test_eqvoc_proof_from_chunks>).
    - Tests [`test_eqvoc_proof_to_chunks`](<#test_eqvoc_proof_to_chunks>) with various shred sizes.
    - Frees the allocated EQVOC memory using `fd_wksp_free_laddr`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_eqvoc_align`](<fd_eqvoc.h.md#fd_eqvoc_align>)
    - [`fd_eqvoc_footprint`](<fd_eqvoc.h.md#fd_eqvoc_footprint>)
    - [`fd_eqvoc_join`](<fd_eqvoc.c.md#fd_eqvoc_join>)
    - [`fd_eqvoc_new`](<fd_eqvoc.c.md#fd_eqvoc_new>)
    - [`test_eqvoc_proof_verify`](<#test_eqvoc_proof_verify>)
    - [`test_eqvoc_proof_from_chunks`](<#test_eqvoc_proof_from_chunks>)
    - [`test_eqvoc_proof_to_chunks`](<#test_eqvoc_proof_to_chunks>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)