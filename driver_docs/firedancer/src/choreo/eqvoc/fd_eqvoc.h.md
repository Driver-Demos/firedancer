<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

API for detecting and handling equivocation proofs in shreds, including construction, verification, and metadata indexing.

# Purpose
The code defines a C header file that provides an API for detecting and handling equivocation in a distributed system. Equivocation occurs when a shred producer generates multiple versions of a shred for the same slot and index. The API includes functions for constructing and verifying equivocation proofs, which consist of conflicting shreds that imply equivocation by the producer. The code is organized into several components, including structures and functions for managing FEC (Forward Error Correction) sets and proofs, as well as utilities for handling shreds and their metadata.

The header file defines several data structures, such as `fd_eqvoc_fec_t` and `fd_eqvoc_proof_t`, which are used to store metadata about FEC sets and equivocation proofs, respectively. It also includes functions for querying, inserting, and verifying these structures. The API supports operations like joining and leaving an equivocation detection context, initializing and deleting equivocation data, and verifying the integrity of shreds and FEC sets. The code is intended to be used as part of a larger system, with dependencies on other modules for handling shreds, signatures, and gossip messages. The file also includes macros and constants for managing memory alignment and footprint requirements, as well as for defining the maximum sizes of various data structures.
# Imports and Dependencies

---
- `../../ballet/shred/fd_shred.h`
- `../../flamenco/leaders/fd_leaders.h`
- `../../flamenco/gossip/fd_gossip_types.h`
- `../fd_choreo_base.h`
- `../../util/tmpl/fd_pool.c`
- `../../util/tmpl/fd_map_chain.c`
- `../../util/tmpl/fd_set.c`


# Global Variables

---
### fd\_slot\_fec\_null
- **Type**: ``fd_slot_fec_t``
- **Description**: Represents a constant instance of the `fd_slot_fec_t` structure with both `slot` and `fec_set_idx` fields initialized to zero. This structure is used to represent a null or invalid state for FEC (Forward Error Correction) set metadata.
- **Use**: Used as a default or null value for FEC set metadata operations.


# Data Structures

---
### fd\_slot\_fec
- **Type**: ``struct``
- **Members**:
    - ``slot``: Stores the slot number as an unsigned long integer.
    - ``fec_set_idx``: Stores the FEC set index as an unsigned integer.
- **Description**: Defines a structure to represent a combination of a slot and a FEC set index, which is used for indexing and managing metadata related to Forward Error Correction (FEC) sets in the context of equivocation detection.


---
### fd\_slot\_fec\_t
- **Type**: ``struct``
- **Members**:
    - ``slot``: An unsigned long integer representing the slot number.
    - ``fec_set_idx``: An unsigned integer representing the index of the FEC set.
- **Description**: Represents metadata for a Forward Error Correction (FEC) set, identified by a slot number and an FEC set index. This structure is used to track and manage FEC set information, which is crucial for detecting and handling equivocation in data shreds.


---
### fd\_eqvoc\_fec
- **Type**: ``struct``
- **Members**:
    - ``key``: A `fd_slot_fec_t` structure that serves as a unique identifier for the FEC set.
    - ``next``: An `ulong` that points to the next element in a linked list or chain.
    - ``code_cnt``: An `ulong` that counts the number of coding shreds in the FEC set.
    - ``data_cnt``: An `ulong` that counts the number of data shreds in the FEC set.
    - ``last_idx``: A `uint` that stores the index of the last data shred in the FEC set.
    - ``sig``: A `fd_ed25519_sig_t` that holds the signature for the FEC set.
- **Description**: The `fd_eqvoc_fec` structure is used to store metadata for a Forward Error Correction (FEC) set, which is part of a system for detecting equivocation in shreds. It includes fields for identifying the FEC set, tracking the number of coding and data shreds, and storing the signature associated with the set. The structure is designed to facilitate the detection of equivocation by comparing signatures and shred indices within and across FEC sets.


---
### fd\_eqvoc\_fec\_t
- **Type**: ``struct``
- **Members**:
    - ``key``: Stores the slot and FEC set index for the FEC entry.
    - ``next``: Holds the index of the next FEC entry in a linked list.
    - ``code_cnt``: Counts the number of coding shreds in the FEC set.
    - ``data_cnt``: Counts the number of data shreds in the FEC set.
    - ``last_idx``: Stores the index of the last data shred in the slot.
    - ``sig``: Holds the signature for the FEC set.
- **Description**: The `fd_eqvoc_fec_t` structure is used to manage metadata for FEC (Forward Error Correction) sets in the context of equivocation detection. It includes fields for identifying the FEC set (`key`), managing linked list connections (`next`), and tracking the number of coding and data shreds (`code_cnt` and `data_cnt`). The `last_idx` field indicates the last data shred index, and the `sig` field holds the signature for the FEC set, which is crucial for detecting equivocation by comparing signatures across shreds.


---
### fd\_eqvoc\_proof
- **Type**: ``struct``
- **Members**:
    - ``key``: Holds the public key associated with the slot.
    - ``prev``: Reserved for internal data structure use.
    - ``next``: Reserved for internal data structure use.
    - ``producer``: Stores the public key of the producer of the shreds.
    - ``bmtree_mem``: Pointer to memory used for reconstructing the Merkle root.
    - ``wallclock``: Represents the wall clock time in nanoseconds.
    - ``chunk_cnt``: Indicates the number of chunks.
    - ``chunk_sz``: Specifies the size of each chunk.
    - ``set``: Array that tracks which proof chunks have been received.
    - ``shreds``: Array that stores serialized DuplicateShred messages.
- **Description**: The `fd_eqvoc_proof` structure is used to represent a proof of equivocation in a distributed system. It contains information about the producer of shreds, the time of creation, and the size and count of chunks involved in the proof. The structure also includes a set to track received proof chunks and an array to store serialized shreds, which are used to demonstrate that a producer has equivocated by creating conflicting shreds.


---
### fd\_eqvoc\_proof\_t
- **Type**: ``struct``
- **Members**:
    - ``key``: Holds the slot and FEC set index for the proof.
    - ``prev``: Reserved for data structure use, likely for linking.
    - ``next``: Reserved for data structure use, likely for linking.
    - ``producer``: Public key of the producer of the shreds.
    - ``bmtree_mem``: Scratch space for reconstructing the Merkle root.
    - ``wallclock``: Stores the wallclock time in nanoseconds.
    - ``chunk_cnt``: Number of chunks in the proof.
    - ``chunk_sz``: Size of each chunk in the proof.
    - ``set``: Tracks which proof chunks have been received.
    - ``shreds``: Serialized format of two shreds, each prefixed with its size.
- **Description**: Represents a proof of equivocation, which is a situation where a shred producer creates conflicting shreds for the same slot and index. The structure contains metadata and serialized shreds necessary to verify such a proof. It includes fields for tracking the producer's public key, the number and size of chunks, and a set to track received proof chunks. The `shreds` field holds the serialized shreds, each prefixed with its size, to facilitate chunking and transmission.


---
### fd\_eqvoc
- **Type**: ``struct``
- **Members**:
    - ``me``: Stores the public key of the current entity.
    - ``fec_max``: Defines the maximum number of FEC (Forward Error Correction) sets.
    - ``proof_max``: Specifies the maximum number of equivocation proofs.
    - ``shred_version``: Indicates the expected version of shreds in equivocation-related messages.
    - ``fec_pool``: Points to a pool of FEC structures.
    - ``fec_map``: Points to a map of FEC structures for indexing.
    - ``proof_pool``: Points to a pool of equivocation proof structures.
    - ``proof_map``: Points to a map of equivocation proof structures for indexing.
    - ``sha512``: Points to a SHA-512 hash structure.
    - ``bmtree_mem``: Points to memory used for binary tree operations.
    - ``leaders``: Points to a constant structure of epoch leaders.
- **Description**: The `fd_eqvoc` structure is designed to manage and process equivocation proofs and FEC sets in a distributed system. It includes fields for storing public keys, maximum limits for FEC sets and proofs, and the expected shred version. The structure also contains pointers to pools and maps for managing FEC and proof data, as well as a SHA-512 hash structure and memory for binary tree operations. Additionally, it references a constant structure of epoch leaders, indicating its role in coordinating with other entities in the system.


---
### fd\_eqvoc\_t
- **Type**: ``struct``
- **Members**:
    - ``me``: Our public key.
    - ``fec_max``: Maximum number of FEC sets.
    - ``proof_max``: Maximum number of proofs.
    - ``shred_version``: Expected shred version in equivocation-related messages.
    - ``fec_pool``: Pointer to a pool of FEC entries.
    - ``fec_map``: Pointer to a map of FEC entries.
    - ``proof_pool``: Pointer to a pool of proof entries.
    - ``proof_map``: Pointer to a map of proof entries.
    - ``sha512``: Pointer to SHA-512 hash context.
    - ``bmtree_mem``: Pointer to memory for reconstructing the Merkle root.
    - ``leaders``: Pointer to epoch leaders data.
- **Description**: Manages the detection and handling of equivocation proofs in a distributed system. It maintains pools and maps for FEC (Forward Error Correction) and proof entries, and provides mechanisms to verify and manage shreds and proofs of equivocation. The structure includes both owned and borrowed resources, such as public keys, hash contexts, and memory for Merkle root reconstruction.


# Functions

---
### fd\_eqvoc\_align<!-- {{#callable:fd_eqvoc_align}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L199>)

Returns the alignment requirement for the `fd_eqvoc_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the `alignof` operator on `fd_eqvoc_t` to determine its alignment requirement.
    - Returns the result of the `alignof` operator.
- **Output**: The function returns an `ulong` representing the alignment requirement of the `fd_eqvoc_t` structure.


---
### fd\_eqvoc\_footprint<!-- {{#callable:fd_eqvoc_footprint}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L204>)

Calculates the memory footprint required for an `fd_eqvoc_t` structure with specified maximum FEC and proof counts.
- **Inputs**:
    - `fec_max`: The maximum number of FEC (Forward Error Correction) sets.
    - `proof_max`: The maximum number of equivocation proofs.
- **Logic and Control Flow**:
    - Initialize the layout with `FD_LAYOUT_INIT`.
    - Append the alignment and size of `fd_eqvoc_t`.
    - Append the alignment and footprint of the FEC pool using `fd_eqvoc_fec_pool_align()` and `fd_eqvoc_fec_pool_footprint(fec_max)`.
    - Append the alignment and footprint of the FEC map using `fd_eqvoc_fec_map_align()` and `fd_eqvoc_fec_map_footprint(fec_max)`.
    - Append the alignment and footprint of the proof pool using `fd_eqvoc_proof_pool_align()` and `fd_eqvoc_proof_pool_footprint(proof_max)`.
    - Append the alignment and footprint of the proof map using `fd_eqvoc_proof_map_align()` and `fd_eqvoc_proof_map_footprint(proof_max)`.
    - Append the alignment and footprint of the SHA-512 context using `fd_sha512_align()` and `fd_sha512_footprint()`.
    - Append the alignment and footprint of the binary Merkle tree commit using `fd_bmtree_commit_align()` and `fd_bmtree_commit_footprint(FD_SHRED_MERKLE_LAYER_CNT)`.
    - Finalize the layout with `FD_LAYOUT_FINI`.
- **Output**: Returns the total memory footprint in bytes as an unsigned long integer.
- **Functions Called**:
    - [`fd_eqvoc_align`](<#fd_eqvoc_align>)


---
### fd\_eqvoc\_fec\_query<!-- {{#callable:fd_eqvoc_fec_query}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L271>)

Queries the FEC set metadata for a given slot and FEC set index.
- **Inputs**:
    - `eqvoc`: A pointer to a constant `fd_eqvoc_t` structure, which contains the FEC map and pool.
    - `slot`: An unsigned long integer representing the slot number to query.
    - `fec_set_idx`: An unsigned integer representing the FEC set index to query.
- **Logic and Control Flow**:
    - Create a `fd_slot_fec_t` key using the provided `slot` and `fec_set_idx` values.
    - Call `fd_eqvoc_fec_map_ele_query_const` with the FEC map from `eqvoc`, the created key, and the FEC pool from `eqvoc`.
    - Return the result of the `fd_eqvoc_fec_map_ele_query_const` function call.
- **Output**: A constant pointer to an `fd_eqvoc_fec_t` structure containing the FEC set metadata, or `NULL` if not found.


---
### fd\_eqvoc\_proof\_query\_const<!-- {{#callable:fd_eqvoc_proof_query_const}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L320>)

Queries for a constant equivocation proof entry in the `fd_eqvoc_t` structure using a slot and a public key.
- **Inputs**:
    - ``eqvoc``: A pointer to a constant `fd_eqvoc_t` structure, which contains the equivocation proof map and pool.
    - ``slot``: An unsigned long integer representing the slot number for which the proof is queried.
    - ``from``: A pointer to a constant `fd_pubkey_t` structure representing the public key of the shred producer.
- **Logic and Control Flow**:
    - Creates a `fd_slot_pubkey_t` key using the provided `slot` and `from` public key.
    - Calls `fd_eqvoc_proof_map_ele_query_const` with the `proof_map` from `eqvoc`, the created key, `NULL`, and the `proof_pool` from `eqvoc`.
    - Returns the result of the `fd_eqvoc_proof_map_ele_query_const` function call.
- **Output**: A pointer to a constant `fd_eqvoc_proof_t` structure if the proof is found, otherwise `NULL`.


---
### fd\_eqvoc\_proof\_complete<!-- {{#callable:fd_eqvoc_proof_complete}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L355>)

Checks if all chunks of a proof have been received.
- **Inputs**:
    - `proof`: A pointer to a `fd_eqvoc_proof_t` structure representing the proof to check.
- **Logic and Control Flow**:
    - Iterates over each chunk index from 0 to `proof->chunk_cnt - 1`.
    - For each index, checks if the chunk is present in the proof's set using `fd_eqvoc_proof_set_test`.
    - If any chunk is missing, returns 0 immediately.
    - If all chunks are present, returns 1.
- **Output**: Returns 1 if all chunks are present, otherwise returns 0.


---
### fd\_eqvoc\_proof\_shred1<!-- {{#callable:fd_eqvoc_proof_shred1}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L418>)

Returns a pointer to the first shred in the `proof` structure.
- **Inputs**:
    - ``proof``: A pointer to an `fd_eqvoc_proof_t` structure containing shreds.
- **Logic and Control Flow**:
    - Calculates the address of the first shred by adding the size of an `ulong` to the base address of the `shreds` array in the `proof` structure.
    - Casts the calculated address to a pointer of type `fd_shred_t`.
    - Returns the casted pointer.
- **Output**: A pointer to the first shred (`fd_shred_t *`) in the `proof` structure.


---
### fd\_eqvoc\_proof\_shred1\_const<!-- {{#callable:fd_eqvoc_proof_shred1_const}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L426>)

Returns a constant pointer to the first shred in the `proof` structure.
- **Inputs**:
    - `proof`: A constant pointer to an `fd_eqvoc_proof_t` structure containing shreds.
- **Logic and Control Flow**:
    - Calculates the address of the first shred by adding the size of an `ulong` to the base address of the `shreds` array within the `proof` structure.
    - Casts the calculated address to a constant pointer of type `fd_shred_t`.
    - Returns the casted pointer.
- **Output**: A constant pointer to the first shred (`fd_shred_t const *`) in the `proof` structure.


---
### fd\_eqvoc\_proof\_shred2<!-- {{#callable:fd_eqvoc_proof_shred2}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L433>)

Returns a pointer to the second shred in the `proof` structure.
- **Inputs**:
    - `proof`: A pointer to an `fd_eqvoc_proof_t` structure containing serialized shreds.
- **Logic and Control Flow**:
    - Retrieve the size of the first shred by casting the first `ulong` in `proof->shreds` to `ulong`.
    - Calculate the offset for the second shred by adding the size of the first shred and two `ulong` sizes to the base address of `proof->shreds`.
    - Return a pointer to the second shred by casting the calculated address to `fd_shred_t *`.
- **Output**: A pointer to the second shred (`fd_shred_t *`) in the `proof` structure.


---
### fd\_eqvoc\_proof\_shred2\_const<!-- {{#callable:fd_eqvoc_proof_shred2_const}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L441>)

Returns a constant pointer to the second shred in a given equivocation proof.
- **Inputs**:
    - `proof`: A constant pointer to an `fd_eqvoc_proof_t` structure containing the shreds.
- **Logic and Control Flow**:
    - Retrieve the size of the first shred by casting the `shreds` array in `proof` to a constant pointer to `ulong` and dereferencing it.
    - Calculate the address of the second shred by adding the size of the first shred and twice the size of `ulong` to the base address of `shreds`.
    - Return a constant pointer to the calculated address, cast to `fd_shred_t const *`.
- **Output**: A constant pointer to the second shred (`fd_shred_t const *`) in the `proof`.


# Function Declarations (Public API)

---
### fd\_eqvoc\_new<!-- {{#callable_declaration:fd_eqvoc_new}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L230>)

Formats a memory region for equivocation detection and proof management.
- **Description**: Use this function to prepare a memory region for managing equivocation detection and proof operations. Ensure the memory region is non-null and properly aligned before calling. This function initializes various internal structures for handling FEC and proof data. It returns a pointer to the formatted memory region or NULL if the input memory is null or misaligned.
- **Inputs**:
    - `shmem`: Pointer to the memory region to format. Must not be null and must be aligned according to `fd_eqvoc_align()`.
    - `fec_max`: Maximum number of FEC entries to support. Must be a positive integer.
    - `proof_max`: Maximum number of proof entries to support. Must be a positive integer.
    - `seed`: Seed value for initializing internal data structures. Can be any unsigned long value.
- **Output**: Returns a pointer to the formatted memory region on success, or NULL if the input memory is null or misaligned.
- **See Also**: [`fd_eqvoc_new`](<fd_eqvoc.c.md#fd_eqvoc_new>)  (Implementation)


---
### fd\_eqvoc\_join<!-- {{#callable_declaration:fd_eqvoc_join}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L239>)

Joins the caller to an equivocation detection context.
- **Description**: Use this function to join a caller to an equivocation detection context, which is necessary for detecting and handling equivocation proofs. Ensure that the `sheqvoc` pointer is not null and is properly aligned according to the required alignment for equivocation contexts. This function returns a pointer to the local address space of the equivocation context on success. If the input is null or misaligned, the function logs a warning and returns null.
- **Inputs**:
    - `sheqvoc`: A pointer to the memory region backing the equivocation context. It must not be null and must be aligned according to the alignment requirements of the equivocation context. If the pointer is null or misaligned, the function logs a warning and returns null.
- **Output**: Returns a pointer to the equivocation context in the local address space on success, or null if the input is invalid.
- **See Also**: [`fd_eqvoc_join`](<fd_eqvoc.c.md#fd_eqvoc_join>)  (Implementation)


---
### fd\_eqvoc\_leave<!-- {{#callable_declaration:fd_eqvoc_leave}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L246>)

Leaves a current local join of an equivocation detection context.
- **Description**: Use this function to leave a current local join of an equivocation detection context. This function is typically called when the caller no longer needs to interact with the equivocation detection context. It returns a pointer to the underlying shared memory region if successful, allowing the caller to manage or release the memory as needed. If the input is null, the function logs a warning and returns null, indicating failure.
- **Inputs**:
    - `eqvoc`: A pointer to a constant `fd_eqvoc_t` structure representing the equivocation detection context. Must not be null. If null, the function logs a warning and returns null.
- **Output**: Returns a pointer to the underlying shared memory region on success, or null if the input is invalid.
- **See Also**: [`fd_eqvoc_leave`](<fd_eqvoc.c.md#fd_eqvoc_leave>)  (Implementation)


---
### fd\_eqvoc\_delete<!-- {{#callable_declaration:fd_eqvoc_delete}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L256>)

Unformats a memory region used as an eqvoc.
- **Description**: Use this function to unformat a memory region that was previously formatted for use as an eqvoc. This function should be called when the memory region is no longer needed for eqvoc operations and you want to reclaim or repurpose the memory. Ensure that no processes are joined to the eqvoc before calling this function, as it assumes exclusive access to the memory region. The function returns a pointer to the underlying shared memory region, transferring ownership back to the caller. If the input is invalid, such as a null or misaligned pointer, the function logs a warning and returns null.
- **Inputs**:
    - `sheqvoc`: A pointer to the memory region to unformat. It must be non-null and properly aligned according to `fd_eqvoc_align()`. If the pointer is null or misaligned, the function logs a warning and returns null.
- **Output**: Returns a pointer to the underlying shared memory region if successful, or null if the input is invalid.
- **See Also**: [`fd_eqvoc_delete`](<fd_eqvoc.c.md#fd_eqvoc_delete>)  (Implementation)


---
### fd\_eqvoc\_init<!-- {{#callable_declaration:fd_eqvoc_init}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L261>)

Initializes the equivocation detection structure with a specified shred version.
- **Description**: Use this function to set the expected shred version for an equivocation detection structure. This function must be called before using the structure for equivocation detection tasks. It does not perform any validation on the input parameters, so ensure that the `eqvoc` pointer is valid and points to a properly allocated structure.
- **Inputs**:
    - `eqvoc`: A pointer to an `fd_eqvoc_t` structure. Must not be null and should point to a valid, allocated structure.
    - `shred_version`: An unsigned long integer representing the shred version to set. There are no restrictions on the value, but it should match the expected version for the shreds being processed.
- **Output**: None
- **See Also**: [`fd_eqvoc_init`](<fd_eqvoc.c.md#fd_eqvoc_init>)  (Implementation)


---
### fd\_eqvoc\_fec\_insert<!-- {{#callable_declaration:fd_eqvoc_fec_insert}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L280>)

Inserts a new FEC entry into the equivocation detection system.
- **Description**: Use this function to add a new Forward Error Correction (FEC) entry to the equivocation detection system, indexed by a specific slot and FEC set index. This function is essential for managing FEC metadata, which helps in detecting shreds that may indicate equivocation. Ensure that the `eqvoc` structure is properly initialized and that there is available space in the FEC pool before calling this function. If the entry already exists or the pool is full, the function will log an error and terminate the process.
- **Inputs**:
    - `eqvoc`: A pointer to an `fd_eqvoc_t` structure representing the equivocation detection system. Must not be null and should be properly initialized.
    - `slot`: An unsigned long integer representing the slot number for the FEC entry. Must be a valid slot number.
    - `fec_set_idx`: An unsigned integer representing the FEC set index. Must be a valid index within the expected range.
- **Output**: Returns a pointer to the newly inserted `fd_eqvoc_fec_t` structure representing the FEC entry.
- **See Also**: [`fd_eqvoc_fec_insert`](<fd_eqvoc.c.md#fd_eqvoc_fec_insert>)  (Implementation)


---
### fd\_eqvoc\_fec\_search<!-- {{#callable_declaration:fd_eqvoc_fec_search}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L307>)

Searches for equivocation conflicts in FEC sets using a given shred.
- **Description**: Use this function to check if a given shred implies equivocation by searching for conflicts in the indexed FEC sets. It returns a pointer to a conflicting FEC entry if a conflict is found, or NULL if no conflict exists. This function is useful for detecting when a shred producer has produced multiple versions of a shred for the same slot and index, which is a sign of equivocation. Ensure that the `eqvoc` and `shred` parameters are valid and properly initialized before calling this function.
- **Inputs**:
    - `eqvoc`: A pointer to a constant `fd_eqvoc_t` structure representing the equivocation context. Must not be null.
    - `shred`: A pointer to a constant `fd_shred_t` structure representing the shred to check for equivocation. Must not be null.
- **Output**: Returns a pointer to a constant `fd_eqvoc_fec_t` structure if a conflict is found, or NULL if no conflict exists.
- **See Also**: [`fd_eqvoc_fec_search`](<fd_eqvoc.c.md#fd_eqvoc_fec_search>)  (Implementation)


---
### fd\_eqvoc\_proof\_insert<!-- {{#callable_declaration:fd_eqvoc_proof_insert}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L329>)

Inserts a proof entry into the equivocation detection system.
- **Description**: Use this function to add a new proof entry into the equivocation detection system, identified by a specific slot and the public key of the proof's generator. This function is typically used when a new proof of equivocation needs to be recorded. Ensure that the `eqvoc` structure is properly initialized and that the `from` parameter is a valid public key. The function will return a pointer to the newly inserted proof entry. If the key already exists in the map, the function will log an error if additional runtime checks are enabled.
- **Inputs**:
    - `eqvoc`: A pointer to an `fd_eqvoc_t` structure representing the equivocation detection system. Must not be null and should be properly initialized before calling this function.
    - `slot`: An unsigned long integer representing the slot number for the proof. Must be a valid slot number.
    - `from`: A pointer to a constant `fd_pubkey_t` structure representing the public key of the proof's generator. Must not be null and should point to a valid public key.
- **Output**: Returns a pointer to the newly inserted `fd_eqvoc_proof_t` structure representing the proof entry.
- **See Also**: [`fd_eqvoc_proof_insert`](<fd_eqvoc.c.md#fd_eqvoc_proof_insert>)  (Implementation)


---
### fd\_eqvoc\_proof\_init<!-- {{#callable_declaration:fd_eqvoc_proof_init}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L332>)

Initializes an equivocation proof structure.
- **Description**: Use this function to set up an `fd_eqvoc_proof_t` structure with initial values. This function prepares the proof structure for use by setting the producer's public key, wallclock time, chunk count, chunk size, and memory for the binary Merkle tree. It also clears the set and shreds arrays within the proof structure. Call this function before using the proof structure in any operations to ensure it is properly initialized.
- **Inputs**:
    - `proof`: A pointer to an `fd_eqvoc_proof_t` structure that will be initialized. Must not be null.
    - `producer`: A pointer to a constant `fd_pubkey_t` representing the producer's public key. Must not be null.
    - `wallclock`: A long integer representing the wallclock time in nanoseconds. No specific range is enforced.
    - `chunk_cnt`: An unsigned long integer specifying the number of chunks. No specific range is enforced.
    - `chunk_sz`: An unsigned long integer specifying the size of each chunk. No specific range is enforced.
    - `bmtree_mem`: A pointer to memory used for reconstructing the Merkle root. The caller retains ownership and must ensure it is valid.
- **Output**: None
- **See Also**: [`fd_eqvoc_proof_init`](<fd_eqvoc.c.md#fd_eqvoc_proof_init>)  (Implementation)


---
### fd\_eqvoc\_proof\_chunk\_insert<!-- {{#callable_declaration:fd_eqvoc_proof_chunk_insert}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L339>)

Inserts a proof chunk into the proof structure.
- **Description**: Use this function to add a chunk of proof data to an existing proof structure. This function is necessary for reconstructing proofs that are divided into chunks for transmission. It must be called with a valid proof structure and a chunk that contains the proof data. The function updates the proof structure with the new chunk if it is newer or compatible with the existing data. It ignores chunks that are older or incompatible. Ensure that the proof structure is properly initialized before calling this function.
- **Inputs**:
    - `proof`: A pointer to an `fd_eqvoc_proof_t` structure where the chunk will be inserted. Must not be null and should be properly initialized.
    - `chunk`: A pointer to a `fd_gossip_duplicate_shred_t` structure containing the proof chunk data. Must not be null and should contain valid data for insertion.
- **Output**: None
- **See Also**: [`fd_eqvoc_proof_chunk_insert`](<fd_eqvoc.c.md#fd_eqvoc_proof_chunk_insert>)  (Implementation)


---
### fd\_eqvoc\_proof\_remove<!-- {{#callable_declaration:fd_eqvoc_proof_remove}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L349>)

Removes a proof entry associated with a given key.
- **Description**: Use this function to remove a proof entry from the equivocation proof map in the `eqvoc` structure. This function is useful when a proof is no longer needed or has been invalidated. It must be called with a valid `eqvoc` structure and a `key` that identifies the proof to remove. If the key is not found in the map, the function logs a warning and takes no further action.
- **Inputs**:
    - `eqvoc`: A pointer to an `fd_eqvoc_t` structure. This must be a valid, non-null pointer to an initialized equivocation context.
    - `key`: A pointer to a `fd_slot_pubkey_t` structure that identifies the proof to remove. This must be a valid, non-null pointer. If the key is not found, the function logs a warning.
- **Output**: None
- **See Also**: [`fd_eqvoc_proof_remove`](<fd_eqvoc.c.md#fd_eqvoc_proof_remove>)  (Implementation)


---
### fd\_eqvoc\_proof\_verify<!-- {{#callable_declaration:fd_eqvoc_proof_verify}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L407>)

Verifies if two shreds in a proof indicate equivocation.
- **Description**: Use this function to check if the two shreds contained in a given proof demonstrate equivocation by the shred producer. It returns specific success or error codes based on the verification outcome. Ensure that the proof is complete and valid before calling this function. The function performs input validation on the shreds, such as checking for the expected shred version, slot consistency, and valid signatures. Call this function when you need to confirm the validity of equivocation claims in a distributed system.
- **Inputs**:
    - `proof`: A pointer to a constant `fd_eqvoc_proof_t` structure containing the shreds to verify. The proof must not be null and should be complete and valid. The caller retains ownership of the proof.
- **Output**: Returns an integer indicating the verification result: success codes for different types of equivocation or error codes for invalid inputs.
- **See Also**: [`fd_eqvoc_proof_verify`](<fd_eqvoc.c.md#fd_eqvoc_proof_verify>)  (Implementation)


---
### fd\_eqvoc\_shreds\_verify<!-- {{#callable_declaration:fd_eqvoc_shreds_verify}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L413>)

Verifies if two shreds indicate equivocation by a producer.
- **Description**: Use this function to check if two shreds, produced by the same entity, conflict in a way that suggests equivocation. This function requires both shreds to be from the same slot and have the same version. It also checks if the shreds are of a valid type and contain valid signatures from the producer. The function returns specific error codes if these conditions are not met, or success codes indicating the type of equivocation detected.
- **Inputs**:
    - `shred1`: A pointer to the first shred to verify. Must not be null and must have the same slot and version as `shred2`.
    - `shred2`: A pointer to the second shred to verify. Must not be null and must have the same slot and version as `shred1`.
    - `producer`: A pointer to the public key of the producer of the shreds. Must not be null and must match the signature in both shreds.
    - `bmtree_mem`: A pointer to memory used for reconstructing the Merkle root. Must not be null.
- **Output**: Returns an integer indicating the result of the verification: success codes for different types of equivocation or error codes for invalid inputs.
- **See Also**: [`fd_eqvoc_shreds_verify`](<fd_eqvoc.c.md#fd_eqvoc_shreds_verify>)  (Implementation)


---
### fd\_eqvoc\_proof\_from\_chunks<!-- {{#callable_declaration:fd_eqvoc_proof_from_chunks}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L476>)

Constructs an equivocation proof from given chunks.
- **Description**: Use this function to create an equivocation proof from an array of chunks, where each chunk is a part of a duplicate shred message. This function assumes that the `chunks` array is non-null and contains at least one valid element, with the first element providing necessary header information. The caller must ensure that the `chunk` field in each `fd_gossip_duplicate_shred_t` is a valid pointer and consistent with the metadata in the first element's header. The function performs sanity checks, such as verifying that the chunk length does not exceed `FD_EQVOC_PROOF_SZ`. It is important to call this function only when the chunks are correctly formatted and the metadata is accurate, as undefined behavior may occur otherwise.
- **Inputs**:
    - `chunks`: An array of `fd_gossip_duplicate_shred_t` structures representing the chunks of a duplicate shred message. Must not be null and must contain at least one valid element. The first element provides header information.
    - `proof_out`: A pointer to an `fd_eqvoc_proof_t` structure where the constructed proof will be stored. Must not be null. The caller retains ownership.
- **Output**: None
- **See Also**: [`fd_eqvoc_proof_from_chunks`](<fd_eqvoc.c.md#fd_eqvoc_proof_from_chunks>)  (Implementation)


---
### fd\_eqvoc\_proof\_to\_chunks<!-- {{#callable_declaration:fd_eqvoc_proof_to_chunks}} -->
[View Source →](<../../../../../src/choreo/eqvoc/fd_eqvoc.h#L499>)

Converts an equivocation proof into multiple chunks.
- **Description**: Use this function to divide an equivocation proof into smaller chunks suitable for transmission or storage. This function requires a valid `proof` and an array `chunks_out` with a size of at least `FD_EQVOC_PROOF_CHUNK_CNT`. Each element in `chunks_out` must have a buffer capable of holding `FD_EQVOC_PROOF_CHUNK_SZ` bytes. The function will populate each chunk with metadata and a portion of the proof's shreds. Ensure that `chunks_out` is properly allocated before calling this function.
- **Inputs**:
    - `proof`: A pointer to a `fd_eqvoc_proof_t` structure containing the equivocation proof to be chunked. Must not be null.
    - `chunks_out`: A pointer to an array of `fd_gossip_duplicate_shred_t` structures where the chunks will be stored. The array must have at least `FD_EQVOC_PROOF_CHUNK_CNT` elements, and each element must have a buffer for `FD_EQVOC_PROOF_CHUNK_SZ` bytes.
- **Output**: None
- **See Also**: [`fd_eqvoc_proof_to_chunks`](<fd_eqvoc.c.md#fd_eqvoc_proof_to_chunks>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)