<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for voter state decoding and validation in different versions using the Firedancer framework.

# Purpose
The code is a C source file that implements a test suite for a voting transaction system. It includes functions to verify the integrity and correctness of voting transaction data structures. The file imports several headers, such as `fd_voter.h`, `fd_ed25519.h`, and `fd_util.h`, which provide necessary utilities and cryptographic functions. The code defines two static arrays, `v1_14_11` and `current`, which represent serialized voting transaction data for different versions. These arrays are used in the test functions to validate the decoding and consistency of the voting state.

The main components of the code include the [`vote_txn_signer`](<#vote_txn_signer>) function, which signs a transaction using the Ed25519 signature scheme, and two test functions, [`test_voter_v1_14_11`](<#test_voter_v1_14_11>) and [`test_voter_current`](<#test_voter_current>). These test functions decode the serialized voting data, verify the decoded data against expected values, and ensure that the voting state is consistent. The [`main`](<#main>) function initializes the environment and executes the test functions. The code is structured to validate the voting transaction system's functionality by checking the integrity of the voting state and ensuring that the decoded data matches the expected structure and values.
# Imports and Dependencies

---
- `fd_voter.h`
- `../../ballet/ed25519/fd_ed25519.h`
- `../../util/fd_util.h`
- `stdlib.h`
- `sys/random.h`


# Global Variables

---
### v1\_14\_11
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size of 3731 elements. It contains a sequence of hexadecimal values.
- **Use**: Used to store binary data for processing in the `test_voter_v1_14_11` function.


---
### current
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size of 3762 bytes, initialized with a sequence of hexadecimal values. This array is used to store binary data that represents a specific state or configuration.
- **Use**: Used in the `test_voter_current` function to decode and verify the current voter state.


# Functions

---
### vote\_txn\_signer<!-- {{#callable:vote_txn_signer}} -->
[View Source →](<../../../../../src/choreo/voter/test_voter.c#L12>)

Signs a message buffer using an Ed25519 keypair and stores the signature.
- **Inputs**:
    - `keypair`: A pointer to the Ed25519 keypair used for signing, where the first 32 bytes are the private key and the next 32 bytes are the public key.
    - `signature`: An array of 64 unsigned characters where the function will store the generated signature.
    - `buffer`: A constant pointer to the message buffer that needs to be signed.
    - `len`: The length of the message buffer in bytes.
- **Logic and Control Flow**:
    - Casts the `keypair` to an unsigned character pointer to access the private and public keys.
    - Initializes a SHA-512 context `sha` for use in the signing process.
    - Calls `fd_ed25519_sign` to generate a signature for the message buffer using the provided keypair and stores it in the `signature` array.
- **Output**: The function does not return a value; it outputs the signature directly into the provided `signature` array.


---
### test\_voter\_v1\_14\_11<!-- {{#callable:test_voter_v1_14_11}} -->
[View Source →](<../../../../../src/choreo/voter/test_voter.c#L24>)

Validates the integrity and consistency of a voter state against a versioned vote state for version `v1_14_11`.
- **Inputs**: None
- **Logic and Control Flow**:
    - Casts `v1_14_11` to a `fd_voter_state_t` pointer using `fd_type_pun` and assigns it to `state`.
    - Initializes a `fd_bincode_decode_ctx_t` structure `ctx` with `data` pointing to `v1_14_11` and `dataend` pointing to the end of `v1_14_11`.
    - Calls `fd_vote_state_versioned_decode_footprint` to determine the size of memory needed for decoding and stores it in `total_sz`.
    - Asserts that the decoding footprint was successful using `FD_TEST`.
    - Allocates memory of size `total_sz` and asserts the allocation was successful.
    - Decodes the versioned vote state into `versioned` using `fd_vote_state_versioned_decode`.
    - Asserts that the `kind` of `state` matches the `discriminant` of `versioned`.
    - Asserts that the vote count in `state` is greater than 0.
    - Asserts that the vote count in `state` matches the count of votes in `versioned->inner.v1_14_11.votes`.
    - Asserts that the vote slot in `state` matches the slot of the last vote in `versioned->inner.v1_14_11.votes`.
    - Asserts that the root slot in `state` matches `versioned->inner.v1_14_11.root_slot`.
- **Output**: No output is returned; the function uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_voter_state_cnt`](<fd_voter.h.md#fd_voter_state_cnt>)
    - [`fd_voter_state_vote`](<fd_voter.h.md#fd_voter_state_vote>)
    - [`fd_voter_root_slot`](<fd_voter.h.md#fd_voter_root_slot>)


---
### test\_voter\_current<!-- {{#callable:test_voter_current}} -->
[View Source →](<../../../../../src/choreo/voter/test_voter.c#L49>)

Validates the current voter state against a decoded versioned vote state.
- **Inputs**: None
- **Logic and Control Flow**:
    - Casts `current` to a `fd_voter_state_t` pointer using `fd_type_pun`.
    - Initializes a `fd_bincode_decode_ctx_t` context with `current` data.
    - Calls `fd_vote_state_versioned_decode_footprint` to get the total size of the decoded data and checks for success.
    - Allocates memory for the decoded data using `malloc` and checks for successful allocation.
    - Decodes the versioned vote state into the allocated memory using `fd_vote_state_versioned_decode`.
    - Performs a series of tests using `FD_TEST` to validate that the `state` matches the decoded `versioned` state, including checks on `kind`, vote count, vote slot, and root slot.
- **Output**: No output is returned; the function performs validation checks and assertions.
- **Functions Called**:
    - [`fd_voter_state_cnt`](<fd_voter.h.md#fd_voter_state_cnt>)
    - [`fd_voter_state_vote`](<fd_voter.h.md#fd_voter_state_vote>)
    - [`fd_voter_root_slot`](<fd_voter.h.md#fd_voter_root_slot>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/choreo/voter/test_voter.c#L73>)

Initializes the environment and runs tests for two different voter versions.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Executes [`test_voter_v1_14_11`](<#test_voter_v1_14_11>) to test the voter version 1.14.11.
    - Executes [`test_voter_current`](<#test_voter_current>) to test the current voter version.
- **Output**: No return value, as it is the entry point of the program.
- **Functions Called**:
    - [`test_voter_v1_14_11`](<#test_voter_v1_14_11>)
    - [`test_voter_current`](<#test_voter_current>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)