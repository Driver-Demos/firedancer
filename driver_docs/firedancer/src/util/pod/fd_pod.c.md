<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Macros and functions for manipulating POD (Plain Old Data) structures, including path splitting, iteration, querying, allocation, and removal.

# Purpose
The code provides functionality for managing a data structure known as a "pod," which is a collection of key-value pairs. The code includes macros and functions to manipulate these pods, such as splitting paths, iterating over key-value pairs, querying, listing, counting, resizing, compacting, and removing elements. The macros `FD_POD_PATH_SPLIT`, [`FD_POD_FOR_ALL_BEGIN`](<#fd_pod_for_all_begin>), and `FD_POD_FOR_ALL_END` are used to facilitate path manipulation and iteration over the pod's contents. The functions [`fd_pod_list`](<#fd_pod_list>), [`fd_pod_cnt_subpod`](<#fd_pod_cnt_subpod>), and [`fd_pod_cnt_recursive`](<#fd_pod_cnt_recursive>) provide ways to list and count elements within a pod, including nested subpods.

The code also includes functions for querying ([`fd_pod_query`](<#fd_pod_query>)), resizing ([`fd_pod_resize`](<#fd_pod_resize>)), and compacting ([`fd_pod_compact`](<#fd_pod_compact>)) the pod. The `fd_pod_alloc` function allocates space for a new key-value pair, while `fd_pod_remove` deletes a specified key-value pair. The code defines error handling through [`fd_pod_strerror`](<#fd_pod_strerror>), which translates error codes into human-readable strings. Additionally, the code provides conversion functions between string representations and internal value types ([`fd_cstr_to_pod_val_type`](<#fd_cstr_to_pod_val_type>) and [`fd_pod_val_type_to_cstr`](<#fd_pod_val_type_to_cstr>)). The code is intended to be part of a larger system where pods are used to store and manage hierarchical data efficiently.
# Imports and Dependencies

---
- `fd_pod.h`


# Global Variables

---
### fd\_pod\_alloc
- **Type**: `ulong`
- **Description**: Allocates a value in a pod data structure at a specified path with a given type and size.
- **Use**: Used to allocate space for a value in a pod, returning the offset of the allocated value within the pod.


---
### fd\_pod\_remove
- **Type**: `int`
- **Description**: Removes a key-value pair from a pod data structure based on a specified path. If the path is invalid or the key is not found, it returns an error code.
- **Use**: Used to delete a key-value pair from a pod by specifying the path to the key.


# Data Structures

---
### fd\_pod\_subpod\_path\_t
- **Type**: ``struct``
- **Members**:
    - ``pod``: Points to the subpod value of a subpod key-value pair.
    - ``parent``: Points to the subpod that contains the current subpod, or is `NULL` if the subpod is in the root pod.
- **Description**: Manages a path to a subpod within a nested structure of subpods, allowing operations to be performed on the deepest nested subpod. The `pod` member points to the subpod's value, while the `parent` member points to the containing subpod, facilitating navigation and manipulation of nested subpod structures.


---
### fd\_pod\_subpod\_path
- **Type**: ``struct``
- **Members**:
    - `pod`: Points to the subpod value of a subpod key-value pair.
    - `parent`: Points to the subpod that contains the current subpod, or is `NULL` if the subpod is in the root pod.
- **Description**: Represents a path to a subpod within a nested structure of pods, where each subpod can contain other subpods, forming a hierarchy. The `pod` member points to the current subpod's value, while the `parent` member points to the parent subpod, allowing traversal up the hierarchy. This structure is used to manage and navigate nested subpod relationships.


# Functions

---
### fd\_pod\_list<!-- {{#callable:fd_pod_list}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L66>)

Iterates over all key-value pairs in a pod and populates an array of `fd_pod_info_t` structures with information about each pair.
- **Inputs**:
    - `pod`: A pointer to the pod data structure to iterate over.
    - `info`: A pointer to an array of `fd_pod_info_t` structures where the function will store information about each key-value pair.
- **Logic and Control Flow**:
    - Check if `pod` is NULL; if so, return NULL.
    - Initialize an index `idx` to 0.
    - Use the `FD_POD_FOR_ALL_BEGIN` macro to iterate over each key-value pair in the pod.
    - For each key-value pair, populate the `info` array at the current index with the key size, key, value type, value size, and value.
    - Set the `parent` field of the `info` structure to NULL.
    - Increment the index `idx` after processing each key-value pair.
    - End the iteration with the `FD_POD_FOR_ALL_END` macro.
    - Return the `info` pointer.
- **Output**: A pointer to the `info` array populated with details of each key-value pair in the pod.


---
### FD\_POD\_FOR\_ALL\_BEGIN<!-- {{#callable:FD_POD_FOR_ALL_BEGIN}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L684>)

Iterates over all key-value pairs in a pod and performs operations based on the path provided.
- **Inputs**:
    - `pod`: A pointer to the pod data structure to iterate over.
    - `pair`: A pointer to the first byte of the current key-value pair.
    - `next`: A pointer to the byte after the last byte of the current key-value pair.
    - `ksz`: The SVW encoded width of the key size field.
    - `key_sz`: The length of the key string plus one.
    - `key`: A pointer to the first byte of the key string.
    - `val_type`: The type of the value associated with the key.
    - `vsz`: The SVW encoded width of the value size field.
    - `val_sz`: The number of bytes in the encoded value.
    - `val`: A pointer to the first byte of the encoded value.
- **Logic and Control Flow**:
    - Initialize variables for pod header and iteration control.
    - Iterate over the pod data structure using a while loop until the cursor reaches the stop position.
    - For each key-value pair, decode the key size, key, value type, and value size.
    - Check if the current key matches the path prefix and handle accordingly.
    - If the path is a single key, delete the key-value pair and update the pod header.
    - If the path has a suffix, check if the value type is a subpod and recurse into it.
    - Return success or error codes based on the operations performed.
- **Output**: Returns `FD_POD_SUCCESS` if the operation is successful, or an error code if it fails.


---
### fd\_pod\_cnt\_subpod<!-- {{#callable:fd_pod_cnt_subpod}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L91>)

Counts the number of subpod entries in a given pod.
- **Inputs**:
    - `pod`: A pointer to the pod data structure to be examined.
- **Logic and Control Flow**:
    - Checks if the input `pod` is NULL and returns 0 if true.
    - Initializes a counter `cnt` to 0.
    - Iterates over all key-value pairs in the pod using the `FD_POD_FOR_ALL_BEGIN` and `FD_POD_FOR_ALL_END` macros.
    - Increments the counter `cnt` for each key-value pair where `val_type` is `FD_POD_VAL_TYPE_SUBPOD`.
    - Returns the counter `cnt` which represents the number of subpod entries.
- **Output**: Returns the number of subpod entries as an unsigned long integer.


---
### fd\_pod\_cnt\_recursive<!-- {{#callable:fd_pod_cnt_recursive}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L107>)

Counts the total number of key-value pairs in a pod, including those in nested subpods.
- **Inputs**:
    - `pod`: A pointer to the pod data structure to be processed.
- **Logic and Control Flow**:
    - Check if `pod` is NULL; if so, return 0.
    - Initialize a counter `cnt` to 0.
    - Iterate over all key-value pairs in the pod using the `FD_POD_FOR_ALL_BEGIN` and `FD_POD_FOR_ALL_END` macros.
    - For each key-value pair, increment the counter `cnt`.
    - If the value type is `FD_POD_VAL_TYPE_SUBPOD`, recursively call [`fd_pod_cnt_recursive`](<#fd_pod_cnt_recursive>) on the subpod and add the result to `cnt`.
    - Return the total count `cnt`.
- **Output**: Returns the total count of key-value pairs as an unsigned long integer.
- **Functions Called**:
    - [`fd_pod_cnt_recursive`](<#fd_pod_cnt_recursive>)


---
### fd\_pod\_list\_recursive\_node<!-- {{#callable:fd_pod_list_recursive_node}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L124>)

Recursively processes a pod structure to populate an array of `fd_pod_info_t` structures with key-value pair information, including handling nested subpods.
- **Inputs**:
    - `parent`: A pointer to the parent `fd_pod_info_t` structure, used to set the parent field of the current node.
    - `pod`: A pointer to the pod data structure to be processed.
    - `info`: A pointer to an array of `fd_pod_info_t` structures where the function will store the key-value pair information.
- **Logic and Control Flow**:
    - Initialize local variables for iteration over the pod structure.
    - Use the `FD_POD_FOR_ALL_BEGIN` macro to iterate over each key-value pair in the pod.
    - For each key-value pair, populate the `info` structure with the key size, key, value type, value size, value, and parent information.
    - Increment the `info` pointer to move to the next structure in the array.
    - If the value type is `FD_POD_VAL_TYPE_SUBPOD`, recursively call `fd_pod_list_recursive_node` to process the subpod, passing the current `info` pointer and the subpod as arguments.
    - Continue the iteration until all key-value pairs are processed.
    - Return the updated `info` pointer.
- **Output**: Returns a pointer to the next available `fd_pod_info_t` structure in the array after processing the pod.


---
### fd\_pod\_list\_recursive<!-- {{#callable:fd_pod_list_recursive}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L149>)

Recursively lists all key-value pairs in a pod structure and stores the information in an array of `fd_pod_info_t` structures.
- **Inputs**:
    - ``pod``: A pointer to the pod structure to be processed.
    - ``info``: A pointer to an array of `fd_pod_info_t` structures where the function will store the information about each key-value pair.
- **Logic and Control Flow**:
    - Check if `pod` is NULL; if so, return `info` immediately.
    - Call [`fd_pod_list_recursive_node`](<#fd_pod_list_recursive_node>) with `NULL` as the parent, `pod` as the pod to process, and `info` as the storage for the key-value pair information.
    - Return `info` after processing.
- **Output**: Returns a pointer to the `fd_pod_info_t` array containing the information about the key-value pairs in the pod.
- **Functions Called**:
    - [`fd_pod_list_recursive_node`](<#fd_pod_list_recursive_node>)


---
### fd\_pod\_query<!-- {{#callable:fd_pod_query}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L157>)

Queries a pod for a key-value pair based on a given path and optionally returns information about the found pair.
- **Inputs**:
    - `pod`: A pointer to the pod data structure to query.
    - `path`: A string representing the path to the desired key-value pair in the pod.
    - `opt_info`: An optional pointer to an `fd_pod_info_t` structure to store information about the found key-value pair.
- **Logic and Control Flow**:
    - Checks if `pod` or `path` is NULL and returns `FD_POD_ERR_INVAL` if true.
    - Splits the `path` into a prefix and suffix using `FD_POD_PATH_SPLIT`.
    - Iterates over all key-value pairs in the `pod` using `FD_POD_FOR_ALL_BEGIN` and `FD_POD_FOR_ALL_END`.
    - Compares each key with the prefix; if a match is found, checks if the path has a suffix.
    - If no suffix, populates `opt_info` with the key-value pair details and returns `FD_POD_SUCCESS`.
    - If a suffix exists, checks if the value type is `FD_POD_VAL_TYPE_SUBPOD`; if not, returns `FD_POD_ERR_TYPE`.
    - Recursively calls [`fd_pod_query`](<#fd_pod_query>) on the subpod if the value type is correct.
    - Returns `FD_POD_ERR_RESOLVE` if no matching key is found.
- **Output**: Returns an integer status code: `FD_POD_SUCCESS` if the key is found, `FD_POD_ERR_INVAL` for invalid inputs, `FD_POD_ERR_TYPE` for type mismatches, or `FD_POD_ERR_RESOLVE` if the key is not found.
- **Functions Called**:
    - [`fd_pod_query`](<#fd_pod_query>)


---
### fd\_pod\_strerror<!-- {{#callable:fd_pod_strerror}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L198>)

Maps error codes to their corresponding error message strings.
- **Inputs**:
    - `err`: An integer representing the error code to be translated into a string message.
- **Logic and Control Flow**:
    - Use a switch statement to check the value of `err`.
    - If `err` matches `FD_POD_SUCCESS`, return "success".
    - If `err` matches `FD_POD_ERR_INVAL`, return "bad input args".
    - If `err` matches `FD_POD_ERR_TYPE`, return "path contained an unexpected type key".
    - If `err` matches `FD_POD_ERR_RESOLVE`, return "path did not resolve to a key".
    - If `err` matches `FD_POD_ERR_FULL`, return "pod too full".
    - If `err` does not match any known error codes, return "unknown".
- **Output**: A constant character pointer to the error message string corresponding to the provided error code.


---
### fd\_pod\_resize<!-- {{#callable:fd_pod_resize}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L211>)

Adjusts the size of a pod to a new maximum size, ensuring the pod's data remains valid and within the new size constraints.
- **Inputs**:
    - `pod`: A pointer to the pod data structure to resize.
    - `new_max`: The new maximum size for the pod.
- **Logic and Control Flow**:
    - Check if `pod` is NULL; if so, return 0.
    - Decode the current size (`csz`), used size (`used`), and count (`cnt`) from the pod header.
    - If `used` is greater than `new_max`, return 0.
    - Calculate the body size (`bdy_sz`) as `used - csz*3UL`.
    - Iteratively calculate the new header size (`new_csz`) and new used size (`new_used`) until `new_used` is less than or equal to `new_max`.
    - Move the pod body to accommodate the new header size using `memmove`.
    - Encode the new maximum size, used size, and count back into the pod header.
    - Return the new maximum size.
- **Output**: The new maximum size of the pod after resizing.


---
### fd\_pod\_compact<!-- {{#callable:fd_pod_compact}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L239>)

Compacts a pod by reducing the size of its key-value pairs and optionally its header and padding.
- **Inputs**:
    - `pod`: A pointer to the pod to compact.
    - `full`: An integer flag indicating whether to fully compact the pod, including its header and padding.
- **Logic and Control Flow**:
    - Check if `pod` is NULL and return 0 if true.
    - Decode the size of the pod header using `fd_ulong_svw_dec_sz` and `fd_ulong_svw_dec_fixed`.
    - Iterate over all key-value pairs in the pod using `FD_POD_FOR_ALL_BEGIN` and `FD_POD_FOR_ALL_END`.
    - For each key-value pair, calculate the new sizes for the key and value, and compact them.
    - If the value type is `FD_POD_VAL_TYPE_SUBPOD`, recursively compact the subpod.
    - Move the compacted key-value pair to the new position in the pod.
    - Calculate the new size of the pod body after compaction.
    - If `full` is true, calculate the new compacted size of the pod header and padding.
    - Move the compacted body to its new position in the pod.
    - Encode the new header values using `fd_ulong_svw_enc_fixed`.
- **Output**: Returns the new maximum size of the compacted pod.
- **Functions Called**:
    - [`fd_pod_compact`](<#fd_pod_compact>)
    - [`fd_pod_max`](<fd_pod.h.md#fd_pod_max>)


---
### fd\_cstr\_to\_pod\_val\_type<!-- {{#callable:fd_cstr_to_pod_val_type}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L325>)

Converts a C string to a corresponding POD value type integer.
- **Inputs**:
    - `cstr`: A constant character pointer representing the C string to convert.
- **Logic and Control Flow**:
    - Check if `cstr` is NULL; if so, return `FD_POD_ERR_INVAL`.
    - Compare `cstr` with predefined strings like "subpod", "buf", etc., using `fd_cstr_casecmp`; return the corresponding POD value type if a match is found.
    - Check if `cstr` starts with "user" (case-insensitive); if so, convert the following characters to an integer using `fd_cstr_to_int` and return it if it is between 0 and 255.
    - Return `FD_POD_ERR_INVAL` if no match is found.
- **Output**: Returns an integer representing the POD value type or an error code if the input is invalid.


---
### fd\_pod\_val\_type\_to\_cstr<!-- {{#callable:fd_pod_val_type_to_cstr}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L352>)

Converts a given integer value type to its corresponding string representation and stores it in a provided character array.
- **Inputs**:
    - `val_type`: An integer representing the value type to convert to a string.
    - `cstr`: A pointer to a character array where the resulting string representation will be stored.
- **Logic and Control Flow**:
    - Check if `cstr` is NULL; if so, return NULL.
    - Use a switch statement to match `val_type` with predefined constants and copy the corresponding string to `cstr` using `strcpy`.
    - If `val_type` does not match any predefined constants, check if it is within the range 0 to 255.
    - If `val_type` is within the range, use `fd_cstr_printf` to format it as 'user<i>' and store it in `cstr`.
    - Return the `cstr` pointer.
- **Output**: A pointer to the `cstr` containing the string representation of the value type, or NULL if `cstr` is NULL or `val_type` is out of range.


---
### fd\_pod\_subpod\_grow<!-- {{#callable:fd_pod_subpod_grow}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L393>)

Increases the space for key-value pairs in a subpod, potentially affecting parent subpods.
- **Inputs**:
    - ``node``: A pointer to a `fd_pod_subpod_path_t` structure representing the current subpod path node.
    - ``needed``: The amount of additional space required for key-value pairs in the subpod.
- **Logic and Control Flow**:
    - Check if `needed` is zero; if so, return `FD_POD_SUCCESS` as no growth is needed.
    - Retrieve the parent of the current node; if there is no parent, return `FD_POD_ERR_FULL` as the root pod cannot grow.
    - Calculate the current size and capacity of the pod and determine the new required size.
    - If the new size fits within the current pod's value size, repack the pod and return `FD_POD_SUCCESS`.
    - If the new size requires a larger value size, adjust the encoding and repack the pod without affecting the parent, then return `FD_POD_SUCCESS`.
    - If the parent pod needs to grow, recursively call `fd_pod_subpod_grow` on the parent with the additional space needed.
    - Repack the parent pod and adjust the current pod's position and size accordingly.
    - Return `FD_POD_SUCCESS` after successful growth and repacking.
- **Output**: Returns `FD_POD_SUCCESS` on successful growth or an error code such as `FD_POD_ERR_FULL` if the operation fails.


---
### fd\_pod\_private\_alloc\_node<!-- {{#callable:fd_pod_private_alloc_node}} -->
[View Source →](<../../../../../src/util/pod/fd_pod.c#L520>)

Allocates a new node in a pod data structure, handling nested subpods and ensuring sufficient space.
- **Inputs**:
    - `parent`: A pointer to the parent subpod path structure, which helps track the hierarchy of subpods.
    - `pod`: A pointer to the current pod where the allocation is to be made.
    - `path`: A string representing the path to the key where the new node should be allocated.
    - `new_val_type`: An integer representing the type of the new value to be allocated.
    - `new_val_sz`: An unsigned long representing the size of the new value to be allocated.
- **Logic and Control Flow**:
    - Initialize a `fd_pod_subpod_path_t` structure to track the current pod and its parent.
    - Split the `path` into a prefix and suffix using `FD_POD_PATH_SPLIT`.
    - Iterate over all key-value pairs in the pod using `FD_POD_FOR_ALL_BEGIN` and `FD_POD_FOR_ALL_END`.
    - If a key matching the prefix is found and there is no suffix, return `NULL` as the key already exists.
    - If a key matching the prefix is found and there is a suffix, recurse into the subpod if the value type is `FD_POD_VAL_TYPE_SUBPOD`.
    - If no matching key is found, calculate the available space in the pod.
    - If the path has a suffix, calculate the space needed for a new subpod and expand the pod if necessary.
    - Insert the new subpod and update the pod header, then recurse into the new subpod.
    - If the path is a single key, calculate the space needed for the new value and expand the pod if necessary.
    - Allocate the new value, update the pod header, and return a pointer to the new value.
- **Output**: A pointer to the newly allocated value in the pod, or `NULL` if the allocation fails.
- **Functions Called**:
    - [`fd_pod_footprint`](<fd_pod.h.md#fd_pod_footprint>)
    - [`fd_pod_subpod_grow`](<#fd_pod_subpod_grow>)
    - [`fd_pod_join`](<fd_pod.h.md#fd_pod_join>)
    - [`fd_pod_new`](<fd_pod.h.md#fd_pod_new>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)