<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for NUMA and page size aware manipulation of interprocess shared memory topologies.

# Purpose
The code is a C header file that defines an API for managing shared memory regions with awareness of Non-Uniform Memory Access (NUMA) and page sizes. It provides a set of functions and macros to facilitate the creation, manipulation, and querying of shared memory regions in a multi-threaded environment. The API is designed to work with a command and control script for host configuration, and it requires the system to be booted to use its functionalities.

Key components include definitions for maximum limits such as `FD_SHMEM_JOIN_MAX`, `FD_SHMEM_NUMA_MAX`, and `FD_SHMEM_CPU_MAX`, which set constraints on the number of shared memory regions, NUMA nodes, and logical CPUs, respectively. The file also defines several structures, such as `fd_shmem_join_info_t` and `fd_shmem_info_t`, which store details about shared memory joins and regions. Functions like [`fd_shmem_join`](<#fd_shmem_join>), [`fd_shmem_leave`](<#fd_shmem_leave>), and [`fd_shmem_create_multi`](<#fd_shmem_create_multi>) provide mechanisms to join, leave, and create shared memory regions. The API also includes functions for querying and validating NUMA configurations, as well as parsing and converting page size information. The header file is intended to be included in other C source files to provide shared memory management capabilities.
# Imports and Dependencies

---
- `../log/fd_log.h`


# Data Structures

---
### fd\_shmem\_private\_key
- **Type**: ``struct``
- **Members**:
    - ``cstr``: An array of characters with a maximum size defined by `FD_SHMEM_NAME_MAX`.
- **Description**: Defines a structure that contains a character array `cstr` used to store a string with a maximum length specified by `FD_SHMEM_NAME_MAX`. This structure is intended for internal use, particularly for interoperability with templates and mappings in shared memory operations.


---
### fd\_shmem\_private\_key\_t
- **Type**: ``struct``
- **Members**:
    - ``cstr``: An array of characters with a size defined by `FD_SHMEM_NAME_MAX`.
- **Description**: Defines a structure with a single member `cstr`, which is an array of characters. This structure is used internally for interoperability with `tmpl/fd_map` and is intended to store a string representation of a shared memory region name.


---
### fd\_shmem\_join\_info
- **Type**: ``struct``
- **Members**:
    - ``ref_cnt``: Indicates the number of joins, with -1L showing a join/leave is in progress.
    - ``join``: Stores the local join handle, which is NULL during a join function call.
    - ``shmem``: Holds the location in the thread group's local address space, aligned to `page_sz`.
    - ``page_sz``: Specifies the page size used for the region, which is a non-zero integer power-of-two.
    - ``page_cnt``: Indicates the number of pages in the region, ensuring no overflow with `page_sz`.
    - ``mode``: Defines the access mode, either `FD_SHMEM_JOIN_MODE_READ_ONLY` or `FD_SHMEM_JOIN_MODE_READ_WRITE`.
    - ``hash``: Stores a hash value computed from the region name.
    - ``name``: Contains a null-terminated string with the region name at join time.
    - ``key``: Provides a private key for interoperability with `tmpl/fd_map.h`.
- **Description**: The `fd_shmem_join_info` structure provides detailed information about a shared memory join operation, including reference count, local join handle, memory location, page size, page count, access mode, and a hash of the region name. It also includes a union for storing either the region name or a private key for interoperability purposes. This structure is used to manage and track the state of shared memory regions within a thread group.


---
### fd\_shmem\_join\_info\_t
- **Type**: ``struct``
- **Members**:
    - ``ref_cnt``: Number of joins, with -1 indicating a join/leave is in progress.
    - ``join``: Local join handle, which is NULL during a call to the join function.
    - ``shmem``: Location in the thread group's local address space, non-NULL and page size aligned.
    - ``page_sz``: Page size used for the region, a supported non-zero integer power-of-two.
    - ``page_cnt``: Number of pages in the region, non-zero and page_sz*page_cnt will not overflow.
    - ``mode``: Access mode, either FD_SHMEM_JOIN_MODE_READ_ONLY or FD_SHMEM_JOIN_MODE_READ_WRITE.
    - ``hash``: Hash value computed as (uint)fd_hash(0UL, name, FD_SHMEM_NAME_MAX).
    - ``name``: C-string with the region name at join time, guaranteed to be '\0' terminated.
    - ``key``: For easy interoperability with tmpl/fd_map.h.
- **Description**: Provides low-level details about a join in a shared memory region, including reference count, local join handle, memory location, page size, page count, access mode, hash, and region name or key for interoperability.


---
### fd\_shmem\_info
- **Type**: ``struct``
- **Members**:
    - ``page_sz``: Specifies the page size of the shared memory region, which is a non-zero integer power of two.
    - ``page_cnt``: Indicates the number of pages in the shared memory region, which is a positive value.
- **Description**: Provides low-level details about a shared memory region, including its page size and the number of pages it contains. The structure ensures that the page size is a supported value and that the total size of the region does not overflow.


---
### fd\_shmem\_info\_t
- **Type**: ``struct``
- **Members**:
    - `page_sz`: Page size of the region, which is a supported page size (e.g., non-zero, integer power of two).
    - `page_cnt`: Number of pages in the region, which is positive, and `page_sz*page_cnt` will not overflow.
- **Description**: Provides low-level details of a shared memory region, including the page size and the number of pages in the region, ensuring that the page size is a valid power of two and the total size does not exceed system limits.


# Functions

---
### fd\_shmem\_create<!-- {{#callable:fd_shmem_create}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L367>)

Creates a shared memory region with a single subregion using specified parameters.
- **Inputs**:
    - ``name``: A constant character pointer to the name of the shared memory region.
    - ``page_sz``: An unsigned long representing the page size for the shared memory region.
    - ``page_cnt``: An unsigned long representing the number of pages in the shared memory region.
    - ``cpu_idx``: An unsigned long representing the CPU index near which the memory should be allocated.
    - ``mode``: An unsigned long representing the access mode for the shared memory region.
- **Logic and Control Flow**:
    - Calls [`fd_shmem_create_multi`](<fd_shmem_admin.c.md#fd_shmem_create_multi>) with `name`, `page_sz`, `1UL` for a single subregion, `&page_cnt`, `&cpu_idx`, and `mode` as arguments.
    - Returns the result of the [`fd_shmem_create_multi`](<fd_shmem_admin.c.md#fd_shmem_create_multi>) function call.
- **Output**: Returns an integer indicating success (0) or a failure code from [`fd_shmem_create_multi`](<fd_shmem_admin.c.md#fd_shmem_create_multi>).
- **Functions Called**:
    - [`fd_shmem_create_multi`](<fd_shmem_admin.c.md#fd_shmem_create_multi>)


---
### fd\_shmem\_acquire<!-- {{#callable:fd_shmem_acquire}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L441>)

Acquires a shared memory region with a specified page size, page count, and CPU index.
- **Inputs**:
    - `page_sz`: The size of each page in the shared memory region, specified as an unsigned long integer.
    - `page_cnt`: The number of pages to allocate in the shared memory region, specified as an unsigned long integer.
    - `cpu_idx`: The index of the CPU near which the memory should be allocated, specified as an unsigned long integer.
- **Logic and Control Flow**:
    - Calls the [`fd_shmem_acquire_multi`](<fd_shmem_admin.c.md#fd_shmem_acquire_multi>) function with `page_sz`, a subregion count of 1, and pointers to `page_cnt` and `cpu_idx`.
- **Output**: Returns a pointer to the location in the local address space of the mapped pages on success, or NULL on failure.
- **Functions Called**:
    - [`fd_shmem_acquire_multi`](<fd_shmem_admin.c.md#fd_shmem_acquire_multi>)


---
### fd\_shmem\_is\_page\_sz<!-- {{#callable:fd_shmem_is_page_sz}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L474>)

Checks if a given page size is one of the predefined shared memory page sizes.
- **Inputs**:
    - `page_sz`: An unsigned long integer representing the page size to check.
- **Logic and Control Flow**:
    - Compares `page_sz` with `FD_SHMEM_NORMAL_PAGE_SZ`, `FD_SHMEM_HUGE_PAGE_SZ`, and `FD_SHMEM_GIGANTIC_PAGE_SZ`.
    - Uses bitwise OR to combine the results of the comparisons.
- **Output**: Returns an integer where a non-zero value indicates that `page_sz` matches one of the predefined page sizes, and zero indicates it does not.


---
### fd\_shmem\_iter\_done<!-- {{#callable:fd_shmem_iter_done}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L531>)

Checks if the shared memory iterator has reached the end.
- **Inputs**:
    - `iter`: A pointer to a `fd_shmem_join_info_t` structure representing the current position in the shared memory iteration.
- **Logic and Control Flow**:
    - Check if the `iter` pointer is `NULL`.
    - Return `1` if `iter` is `NULL`, indicating the end of the iteration.
    - Return `0` if `iter` is not `NULL`, indicating that there are more elements to iterate over.
- **Output**: Returns `1` if the iterator is `NULL`, otherwise returns `0`.


# Function Declarations (Public API)

---
### fd\_shmem\_join<!-- {{#callable_declaration:fd_shmem_join}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L108>)

Joins a thread group to a shared memory region.
- **Description**: Use this function to map a named shared memory region into the local address space of a thread group. It supports read-only and read-write modes, and can handle multiple joins to the same region within a thread group. A user-defined function can be provided to perform additional setup on the mapped memory. Ensure that the shared memory region exists and that the name is valid before calling. This function must be paired with a leave operation to properly unmap the region.
- **Inputs**:
    - `name`: A pointer to a null-terminated string representing the name of the shared memory region. The name must be valid and non-null.
    - `mode`: An integer specifying the access mode for the memory region. Must be either `FD_SHMEM_JOIN_MODE_READ_ONLY` or `FD_SHMEM_JOIN_MODE_READ_WRITE`. Invalid modes will cause the function to return NULL.
    - `join_func`: A function pointer to a user-defined function that performs additional setup on the mapped memory. Can be NULL if no special handling is needed.
    - `context`: A pointer to user-defined data that is passed to the `join_func`. Can be NULL if not used.
    - `opt_info`: A pointer to a `fd_shmem_join_info_t` structure where additional details about the join will be stored if the pointer is non-null. Ignored if the function fails.
- **Output**: Returns a pointer to the local join handle on success, or NULL on failure.
- **See Also**: [`fd_shmem_join`](<fd_shmem_user.c.md#fd_shmem_join>)  (Implementation)


---
### fd\_shmem\_leave<!-- {{#callable_declaration:fd_shmem_leave}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L177>)

Leaves a shared memory region.
- **Description**: Use this function to leave a shared memory region that was previously joined. It decreases the reference count of the join and unmaps the memory if the reference count reaches zero. If a `leave_func` is provided, it is called before unmapping. Ensure that the `join` parameter is valid and currently joined. The function logs warnings if the `join` is null, not a current join, or if a circular dependency is detected. It returns an error code if it fails to unmap the memory.
- **Inputs**:
    - `join`: Pointer to the join handle of the shared memory region. Must not be null and must be a current join.
    - `leave_func`: Optional function to perform additional operations before leaving. Can be null if no special handling is needed.
    - `context`: Pointer to user-defined context passed to `leave_func`. Can be null if `leave_func` does not require context.
- **Output**: Returns 0 on success and 1 on failure, indicating whether the memory was successfully unmapped.
- **See Also**: [`fd_shmem_leave`](<fd_shmem_user.c.md#fd_shmem_leave>)  (Implementation)


---
### fd\_shmem\_join\_query\_by\_name<!-- {{#callable_declaration:fd_shmem_join_query_by_name}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L210>)

Queries if a shared memory region is joined by name.
- **Description**: Use this function to check if a shared memory region with a specific name is currently joined by the caller's thread group. It returns success if the region is joined, and optionally provides additional details about the join. Ensure that the shared memory system is initialized before calling this function. The function does not log errors, making it suitable for use in scenarios where query failures are expected during normal operation.
- **Inputs**:
    - `name`: A pointer to a null-terminated string representing the name of the shared memory region. The name must be valid and non-null. If the name is invalid, the function returns EINVAL.
    - `opt_info`: An optional pointer to a `fd_shmem_join_info_t` structure. If non-null and the query is successful, this structure will be populated with details about the join. If the query fails, this parameter is ignored.
- **Output**: Returns 0 on success, indicating the region is joined. Returns EINVAL if the name is invalid, or ENOENT if the region is not joined.
- **See Also**: [`fd_shmem_join_query_by_name`](<fd_shmem_user.c.md#fd_shmem_join_query_by_name>)  (Implementation)


---
### fd\_shmem\_join\_query\_by\_join<!-- {{#callable_declaration:fd_shmem_join_query_by_join}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L214>)

Queries join information for a given join handle.
- **Description**: Use this function to check if a join handle is currently valid and obtain details about it. This function must be called after the shared memory system is initialized and when there is at least one active join. It is useful for verifying the status of a join handle and retrieving associated metadata. If the join handle is invalid or no joins exist, the function returns an error code.
- **Inputs**:
    - `join`: A pointer to the join handle to query. Must not be null. If null, the function returns EINVAL.
    - `opt_info`: An optional pointer to a `fd_shmem_join_info_t` structure where join details will be stored. If non-null and the query is successful, this structure is populated with join information. If null, no join details are returned.
- **Output**: Returns 0 on success, with join details optionally written to `opt_info`. Returns EINVAL if `join` is null, or ENOENT if no join is found or no joins exist.
- **See Also**: [`fd_shmem_join_query_by_join`](<fd_shmem_user.c.md#fd_shmem_join_query_by_join>)  (Implementation)


---
### fd\_shmem\_join\_query\_by\_addr<!-- {{#callable_declaration:fd_shmem_join_query_by_addr}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L218>)

Queries if a memory address range overlaps with a shared memory region.
- **Description**: Use this function to check if a specified memory address range overlaps with any currently joined shared memory region. This function is useful for determining if a particular memory range is part of a shared memory region that has been joined by the calling thread group. It must be called with a valid address and size. If the size is zero, the function returns an error indicating no overlap. If the address range wraps around the address space, it returns an error indicating an invalid range. If the range overlaps with multiple regions, the function returns details about one of them, but it is undefined which one.
- **Inputs**:
    - `addr`: Pointer to the start of the memory address range to query. Must be a valid memory address.
    - `sz`: Size of the memory range to query. Must be greater than zero. If zero, the function returns ENOENT.
    - `opt_info`: Optional pointer to a `fd_shmem_join_info_t` structure. If non-NULL and the query is successful, it will be populated with details about the overlapping shared memory region. Caller retains ownership.
- **Output**: Returns 0 on success, indicating an overlap was found. Returns ENOENT if no overlap is found or if the size is zero. Returns EINVAL if the address range is invalid due to wrapping.
- **See Also**: [`fd_shmem_join_query_by_addr`](<fd_shmem_user.c.md#fd_shmem_join_query_by_addr>)  (Implementation)


---
### fd\_shmem\_join\_anonymous<!-- {{#callable_declaration:fd_shmem_join_anonymous}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L260>)

Joins an anonymous shared memory region.
- **Description**: Use this function to treat a specified memory region as a shared memory join with a given name and mode. This is useful for integrating memory regions obtained through non-standard means into the shared memory system. Ensure that the memory region is not already joined, and that the parameters meet the required conditions before calling this function. The function will log details and return an error code if any preconditions are not met.
- **Inputs**:
    - `name`: A string representing the name of the shared memory region. It must be a valid name and not already in use. The name must not be NULL.
    - `mode`: An integer specifying the access mode for the memory region. It must be either `FD_SHMEM_JOIN_MODE_READ_ONLY` or `FD_SHMEM_JOIN_MODE_READ_WRITE`.
    - `join`: A pointer to a local join handle. It must not be NULL and must not already be in use.
    - `mem`: A pointer to the memory region to be joined. It must not be NULL, must be aligned to `page_sz`, and must not already be mapped.
    - `page_sz`: An unsigned long representing the page size of the memory region. It must be a supported page size.
    - `page_cnt`: An unsigned long representing the number of pages in the memory region. It must be greater than zero and the total size (`page_sz * page_cnt`) must not overflow.
- **Output**: Returns 0 on success. On failure, returns a non-zero error code and logs details about the failure.
- **See Also**: [`fd_shmem_join_anonymous`](<fd_shmem_user.c.md#fd_shmem_join_anonymous>)  (Implementation)


---
### fd\_shmem\_leave\_anonymous<!-- {{#callable_declaration:fd_shmem_leave_anonymous}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L268>)

Leaves an anonymous shared memory join.
- **Description**: Use this function to leave an anonymous shared memory join that was previously established. It is important to ensure that the join has a reference count of 1 before calling this function, as it will fail otherwise. This function can provide details about the join if the optional `opt_info` parameter is provided. It returns an error code if the operation fails, logging details about the failure. This function should only be used for the final leave of an anonymous join.
- **Inputs**:
    - `join`: A pointer to the join handle that represents the anonymous shared memory join. Must not be null and must correspond to a valid anonymous join with a reference count of 1.
    - `opt_info`: An optional pointer to a `fd_shmem_join_info_t` structure. If provided and the operation is successful, it will be populated with details about the join. If null, no additional information is returned.
- **Output**: Returns 0 on success. On failure, returns a non-zero error code indicating the reason for failure, such as EINVAL if the join is invalid.
- **See Also**: [`fd_shmem_leave_anonymous`](<fd_shmem_user.c.md#fd_shmem_leave_anonymous>)  (Implementation)


---
### fd\_shmem\_numa\_cnt<!-- {{#callable_declaration:fd_shmem_numa_cnt}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L282>)

Returns the number of NUMA nodes configured in the system.
- **Description**: Use this function to get the count of NUMA nodes available in the system. This count is determined at the time of thread group boot and will be in the range from 1 to `FD_SHMEM_NUMA_MAX`. It is important to ensure that the system is properly booted and configured before calling this function to get accurate results.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the number of NUMA nodes configured in the system.
- **See Also**: [`fd_shmem_numa_cnt`](<fd_shmem_admin.c.md#fd_shmem_numa_cnt>)  (Implementation)


---
### fd\_shmem\_cpu\_cnt<!-- {{#callable_declaration:fd_shmem_cpu_cnt}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L283>)

Returns the number of logical CPUs configured in the system.
- **Description**: Use this function to get the total number of logical CPUs available in the system. This value is determined at the time the thread group is booted and will be in the range [1, FD_SHMEM_CPU_MAX]. It is useful for applications that need to be aware of the CPU topology for performance tuning or resource allocation.
- **Inputs**: None
- **Output**: The function returns an unsigned long integer representing the number of logical CPUs configured in the system.
- **See Also**: [`fd_shmem_cpu_cnt`](<fd_shmem_admin.c.md#fd_shmem_cpu_cnt>)  (Implementation)


---
### fd\_shmem\_numa\_idx<!-- {{#callable_declaration:fd_shmem_numa_idx}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L290>)

Returns the closest NUMA node index for a given CPU index.
- **Description**: Use this function to find the NUMA node that is closest to a specified logical CPU index. This is useful in systems where memory access patterns are optimized based on NUMA topology. The function should be called with a valid CPU index that is within the range of configured logical CPUs. If the provided CPU index is out of range, the function returns `ULONG_MAX` to indicate an error.
- **Inputs**:
    - `cpu_idx`: The logical CPU index for which the closest NUMA node is requested. It must be within the range [0, fd_shmem_cpu_cnt()). If the index is out of this range, the function returns `ULONG_MAX`.
- **Output**: Returns the index of the closest NUMA node if the CPU index is valid, or `ULONG_MAX` if the CPU index is out of range.
- **See Also**: [`fd_shmem_numa_idx`](<fd_shmem_admin.c.md#fd_shmem_numa_idx>)  (Implementation)


---
### fd\_shmem\_cpu\_idx<!-- {{#callable_declaration:fd_shmem_cpu_idx}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L297>)

Returns the smallest CPU index close to a given NUMA node index.
- **Description**: Use this function to find the smallest logical CPU index that is close to a specified NUMA node index. This is useful in systems where NUMA node and CPU proximity is important for performance optimization. The function must be called with a valid NUMA node index that is within the range of available NUMA nodes in the system. If the provided NUMA node index is out of range, the function returns `ULONG_MAX` to indicate an error.
- **Inputs**:
    - `numa_idx`: The index of the NUMA node for which the closest CPU index is desired. It must be within the range [0, fd_shmem_numa_cnt()). If the index is out of this range, the function returns `ULONG_MAX`.
- **Output**: Returns the smallest CPU index close to the specified NUMA node index, or `ULONG_MAX` if the NUMA node index is invalid.
- **See Also**: [`fd_shmem_cpu_idx`](<fd_shmem_admin.c.md#fd_shmem_cpu_idx>)  (Implementation)


---
### fd\_shmem\_numa\_validate<!-- {{#callable_declaration:fd_shmem_numa_validate}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L306>)

Validates that memory pages are on a NUMA node near a specified CPU index.
- **Description**: Use this function to check if all pages in a specified memory region are located on a NUMA node close to a given CPU index. This is useful for ensuring memory locality in NUMA architectures. The function requires that the memory pointer is non-null, the page size is valid, the memory is aligned to the page size, and the page count is within a valid range. It logs warnings and returns an error code if any of these conditions are not met or if the pages are not on the expected NUMA node.
- **Inputs**:
    - `mem`: Pointer to the start of the memory region to validate. Must not be null and must be aligned to the specified page size.
    - `page_sz`: Size of each page in the memory region. Must be a valid page size as defined by the system.
    - `page_cnt`: Number of pages in the memory region. Must be greater than zero and the total size (page_sz * page_cnt) must not exceed system limits.
    - `cpu_idx`: Index of the CPU to check for NUMA locality. Must be less than the total number of CPUs in the system.
- **Output**: Returns 0 if all pages are on the expected NUMA node, otherwise returns a non-zero error code indicating the type of failure.
- **See Also**: [`fd_shmem_numa_validate`](<fd_shmem_admin.c.md#fd_shmem_numa_validate>)  (Implementation)


---
### fd\_shmem\_create\_multi<!-- {{#callable_declaration:fd_shmem_create_multi}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L341>)

Creates a shared memory region with multiple subregions.
- **Description**: Use this function to create a shared memory region with a specified name, page size, and multiple subregions. Each subregion is defined by its page count and associated CPU index. The function requires a valid name and page size, and the total size of all subregions must not exceed system limits. The mode parameter specifies the permissions for the region. This function returns an error code on failure, which can occur due to invalid parameters or system resource limitations.
- **Inputs**:
    - `name`: A pointer to a constant character string representing the name of the shared memory region. The name must be valid and unique within the specified page size namespace.
    - `page_sz`: An unsigned long representing the page size for the shared memory region. Must be one of the predefined page sizes (e.g., FD_SHMEM_NORMAL_PAGE_SZ, FD_SHMEM_HUGE_PAGE_SZ, FD_SHMEM_GIGANTIC_PAGE_SZ).
    - `sub_cnt`: An unsigned long indicating the number of subregions to create. Must be positive.
    - `_sub_page_cnt`: A pointer to an array of unsigned longs, each representing the page count for a subregion. The array must have 'sub_cnt' elements, and the total size must not exceed ULONG_MAX.
    - `_sub_cpu_idx`: A pointer to an array of unsigned longs, each representing the CPU index for a subregion. The array must have 'sub_cnt' elements, and each index must be within the range [0, fd_shmem_cpu_cnt()).
    - `mode`: An unsigned long specifying the permissions for the shared memory region, similar to POSIX file permissions (e.g., 0660 for user read/write, group read/write, world none).
- **Output**: Returns 0 on success or a strerror-compatible error code on failure.
- **See Also**: [`fd_shmem_create_multi`](<fd_shmem_admin.c.md#fd_shmem_create_multi>)  (Implementation)


---
### fd\_shmem\_update\_multi<!-- {{#callable_declaration:fd_shmem_update_multi}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L359>)

Updates a shared memory region with new parameters.
- **Description**: Use this function to modify an existing shared memory region created by `fd_shmem_create_multi` with new configuration parameters. This operation is preferable to deleting and recreating the shared memory region as it avoids the need to zero the underlying memory. Ensure that the shared memory region specified by `name` exists and was initially created using `fd_shmem_create_multi`. The function does not zero the memory, so previous data may still be accessible.
- **Inputs**:
    - `name`: A pointer to a constant character string representing the name of the shared memory region. The name must be valid and correspond to an existing region.
    - `page_sz`: An unsigned long specifying the page size for the shared memory region. Must be a valid page size, such as `FD_SHMEM_NORMAL_PAGE_SZ`, `FD_SHMEM_HUGE_PAGE_SZ`, or `FD_SHMEM_GIGANTIC_PAGE_SZ`.
    - `sub_cnt`: An unsigned long indicating the number of subregions. Must be a positive value.
    - `_sub_page_cnt`: A pointer to an array of unsigned long values, each representing the number of pages in a subregion. The array must have `sub_cnt` elements, and the total number of pages multiplied by `page_sz` must not exceed `ULONG_MAX`.
    - `_sub_cpu_idx`: A pointer to an array of unsigned long values, each representing the CPU index near which a subregion should be located. The array must have `sub_cnt` elements, and each index should be within the range [0, `fd_shmem_cpu_cnt()`).
    - `mode`: An unsigned long specifying the permissions for the shared memory region, such as 0660 for user read/write, group read/write, and no world access.
- **Output**: Returns an integer, 0 on success or a strerror-compatible error code on failure.
- **See Also**: [`fd_shmem_update_multi`](<fd_shmem_admin.c.md#fd_shmem_update_multi>)  (Implementation)


---
### fd\_shmem\_unlink<!-- {{#callable_declaration:fd_shmem_unlink}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L389>)

Removes a shared memory region by name and page size.
- **Description**: Use this function to remove a shared memory region identified by its name and page size from the thread group's shared memory domain. This operation makes the region unavailable for future mappings. Ensure that the name and page size are valid before calling this function. If the function fails, it returns an error code and logs details about the failure.
- **Inputs**:
    - `name`: A pointer to a constant character string representing the name of the shared memory region. The name must be valid, non-null, and conform to expected naming conventions.
    - `page_sz`: An unsigned long representing the page size of the shared memory region. It must be a valid page size, such as FD_SHMEM_NORMAL_PAGE_SZ, FD_SHMEM_HUGE_PAGE_SZ, or FD_SHMEM_GIGANTIC_PAGE_SZ.
- **Output**: Returns 0 on success. On failure, returns a non-zero error code indicating the type of error encountered.
- **See Also**: [`fd_shmem_unlink`](<fd_shmem_admin.c.md#fd_shmem_unlink>)  (Implementation)


---
### fd\_shmem\_acquire\_multi<!-- {{#callable_declaration:fd_shmem_acquire_multi}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L435>)

Acquires shared memory pages for a thread group.
- **Description**: Use this function to allocate a memory region consisting of multiple subregions for the private use of a thread group. Each subregion is specified by the number of pages and the CPU index it should be near. The function returns a pointer to the allocated memory on success or NULL on failure. Ensure that the page size is valid and that the total number of pages does not exceed system limits. This function should be called only after the system is properly initialized for shared memory operations.
- **Inputs**:
    - `page_sz`: Specifies the size of each page in the memory region. Must be one of FD_SHMEM_{NORMAL,HUGE,GIGANTIC}_PAGE_SZ. Invalid sizes result in a NULL return.
    - `sub_cnt`: Indicates the number of subregions to allocate. Must be positive. A zero value results in a NULL return.
    - `_sub_page_cnt`: Points to an array specifying the number of pages for each subregion. Must not be NULL, and each entry must be positive. A NULL pointer or zero entries result in a NULL return.
    - `_sub_cpu_idx`: Points to an array specifying the CPU index for each subregion. Must not be NULL, and each entry must be within the range [0, fd_shmem_cpu_cnt()). A NULL pointer or out-of-range entries result in a NULL return.
- **Output**: Returns a pointer to the allocated memory region on success, or NULL on failure.
- **See Also**: [`fd_shmem_acquire_multi`](<fd_shmem_admin.c.md#fd_shmem_acquire_multi>)  (Implementation)


---
### fd\_shmem\_release<!-- {{#callable_declaration:fd_shmem_release}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L455>)

Releases a specified number of memory pages.
- **Description**: Use this function to release a specified number of memory pages that were previously acquired. Ensure that the memory pointer is not null, the page size is valid, the memory is aligned to the page size, and the page count is within a valid range. This function logs warnings if any of these conditions are not met and returns an error code. It attempts to unmap the memory and logs any errors encountered during this process.
- **Inputs**:
    - `mem`: Pointer to the memory region to release. Must not be null and must be aligned to the specified page size. If null or misaligned, the function logs a warning and returns -1.
    - `page_sz`: Size of each memory page. Must be a valid page size as defined by the system. If invalid, the function logs a warning and returns -1.
    - `page_cnt`: Number of pages to release. Must be at least 1 and such that the total size (page_sz * page_cnt) does not exceed the maximum allowable size. If out of range, the function logs a warning and returns -1.
- **Output**: Returns 0 on success. Returns -1 if any input validation fails or if the memory unmapping operation encounters an error.
- **See Also**: [`fd_shmem_release`](<fd_shmem_admin.c.md#fd_shmem_release>)  (Implementation)


---
### fd\_shmem\_name\_len<!-- {{#callable_declaration:fd_shmem_name_len}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L469>)

Calculates the length of a valid shared memory region name.
- **Description**: Use this function to determine the length of a valid shared memory region name. The function checks if the input string is a valid name according to specific criteria: it must not be null, must start with an alphanumeric character, and can include alphanumeric characters, underscores, hyphens, and periods. The name must be between 1 and `FD_SHMEM_NAME_MAX` characters long. If the name is invalid, the function returns 0.
- **Inputs**:
    - `name`: A pointer to a constant character string representing the shared memory region name. The string must not be null and must adhere to specific character and length constraints. If the string is null or invalid, the function returns 0.
- **Output**: Returns the length of the valid name as an unsigned long integer, or 0 if the name is invalid.
- **See Also**: [`fd_shmem_name_len`](<fd_shmem_admin.c.md#fd_shmem_name_len>)  (Implementation)


---
### fd\_cstr\_to\_shmem\_lg\_page\_sz<!-- {{#callable_declaration:fd_cstr_to_shmem_lg_page_sz}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L486>)

Converts a string to a shared memory log2 page size.
- **Description**: Use this function to convert a string representation of a page size to its corresponding log2 page size constant. It supports case-insensitive string inputs such as "normal", "huge", and "gigantic". If the input string does not match any known page size, the function attempts to convert it to an integer and checks if it corresponds to a valid log2 page size. If the conversion fails or the input is null, the function returns a constant indicating an unknown page size.
- **Inputs**:
    - `cstr`: A pointer to a constant character string representing the page size. Valid inputs include "normal", "huge", "gigantic", or a string that can be converted to an integer matching a known log2 page size. The pointer must not be null; otherwise, the function returns a constant for unknown page size.
- **Output**: Returns an integer representing the log2 page size constant. If the input is invalid or unrecognized, returns a constant for unknown page size.
- **See Also**: [`fd_cstr_to_shmem_lg_page_sz`](<fd_shmem_admin.c.md#fd_cstr_to_shmem_lg_page_sz>)  (Implementation)


---
### fd\_shmem\_lg\_page\_sz\_to\_cstr<!-- {{#callable_declaration:fd_shmem_lg_page_sz_to_cstr}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L497>)

Converts a log2 page size to a corresponding string representation.
- **Description**: Use this function to obtain a string representation of a shared memory log2 page size. It is useful for logging or displaying human-readable page size information. The function returns a constant string that describes the page size, such as "normal", "huge", or "gigantic". If the input does not match any known log2 page size, the function returns "unknown". The returned string is guaranteed to be non-NULL and has an infinite lifetime.
- **Inputs**:
    - `lg_page_sz`: An integer representing the log2 page size. Valid values are `FD_SHMEM_NORMAL_LG_PAGE_SZ`, `FD_SHMEM_HUGE_LG_PAGE_SZ`, and `FD_SHMEM_GIGANTIC_LG_PAGE_SZ`. If the value does not match any of these, the function returns "unknown".
- **Output**: A pointer to a constant string representing the page size. The string will be "normal", "huge", "gigantic", or "unknown".
- **See Also**: [`fd_shmem_lg_page_sz_to_cstr`](<fd_shmem_admin.c.md#fd_shmem_lg_page_sz_to_cstr>)  (Implementation)


---
### fd\_cstr\_to\_shmem\_page\_sz<!-- {{#callable_declaration:fd_cstr_to_shmem_page_sz}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L507>)

Converts a string to a shared memory page size.
- **Description**: Use this function to convert a string representation of a shared memory page size to its corresponding numeric value. It supports case-insensitive string inputs such as "normal", "huge", and "gigantic", as well as numeric strings that match predefined page sizes. If the input string is null or does not match any known page size, the function returns a value indicating an unknown page size. This function is useful for interpreting configuration strings into usable page size constants.
- **Inputs**:
    - `cstr`: A pointer to a null-terminated string representing the page size. Valid inputs include "normal", "huge", "gigantic", or a numeric string matching a predefined page size. The pointer must not be null, and the string should be case-insensitive. If the input is null or invalid, the function returns a value indicating an unknown page size.
- **Output**: Returns the corresponding page size as an unsigned long integer. If the input is invalid or null, it returns FD_SHMEM_UNKNOWN_PAGE_SZ.
- **See Also**: [`fd_cstr_to_shmem_page_sz`](<fd_shmem_admin.c.md#fd_cstr_to_shmem_page_sz>)  (Implementation)


---
### fd\_shmem\_page\_sz\_to\_cstr<!-- {{#callable_declaration:fd_shmem_page_sz_to_cstr}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L518>)

Converts a shared memory page size to a string representation.
- **Description**: Use this function to obtain a string representation of a shared memory page size. It returns a constant string that describes the page size, such as "normal", "huge", or "gigantic". If the input page size does not match any known sizes, the function returns "unknown". This function is useful for logging or displaying human-readable information about memory configurations.
- **Inputs**:
    - `page_sz`: Specifies the page size to convert. Must be one of the predefined constants: `FD_SHMEM_NORMAL_PAGE_SZ`, `FD_SHMEM_HUGE_PAGE_SZ`, or `FD_SHMEM_GIGANTIC_PAGE_SZ`. If the value does not match any of these, the function returns "unknown".
- **Output**: Returns a constant string representing the page size, or "unknown" if the page size is not recognized.
- **See Also**: [`fd_shmem_page_sz_to_cstr`](<fd_shmem_admin.c.md#fd_shmem_page_sz_to_cstr>)  (Implementation)


---
### fd\_shmem\_iter\_begin<!-- {{#callable_declaration:fd_shmem_iter_begin}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L524>)

Returns a pointer to the first valid shared memory join information.
- **Description**: Use this function to obtain a pointer to the first valid shared memory join information in the current process. This is useful for iterating over shared memory joins. The function returns a pointer to the first valid join information or NULL if no valid joins are present. Ensure that the shared memory system is initialized before calling this function.
- **Inputs**: None
- **Output**: A pointer to the first valid `fd_shmem_join_info_t` structure, or NULL if no valid joins are present.
- **See Also**: [`fd_shmem_iter_begin`](<fd_shmem_user.c.md#fd_shmem_iter_begin>)  (Implementation)


---
### fd\_shmem\_iter\_next<!-- {{#callable_declaration:fd_shmem_iter_next}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem.h#L529>)

Returns the next shared memory join information.
- **Description**: Use this function to iterate over shared memory join information structures. It returns a pointer to the next `fd_shmem_join_info_t` structure in the sequence. If there are no more join information structures available, it returns `NULL`. This function is typically used in conjunction with `fd_shmem_iter_begin` to traverse all join information in a process. Ensure that the `iter` parameter is a valid pointer obtained from a previous call to `fd_shmem_iter_begin` or `fd_shmem_iter_next`.
- **Inputs**:
    - `iter`: A pointer to the current `fd_shmem_join_info_t` structure. Must be a valid pointer obtained from `fd_shmem_iter_begin` or `fd_shmem_iter_next`. If `iter` is `NULL`, the behavior is undefined.
- **Output**: Returns a pointer to the next `fd_shmem_join_info_t` structure, or `NULL` if there are no more structures.
- **See Also**: [`fd_shmem_iter_next`](<fd_shmem_user.c.md#fd_shmem_iter_next>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)