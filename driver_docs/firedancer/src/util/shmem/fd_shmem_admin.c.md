<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Shared memory management functions, including page size conversion, NUMA topology handling, and region creation/destruction.

# Purpose
The code provides a set of APIs for managing shared memory regions, particularly in a NUMA (Non-Uniform Memory Access) environment. It includes functions for converting between string representations and size constants for shared memory pages, creating and destroying shared memory regions, and managing NUMA topology. The code is designed to handle different page sizes, such as normal, huge, and gigantic, and provides mechanisms to ensure that memory allocations are aligned and correctly mapped to the desired NUMA nodes.

The code is structured to support both hosted and unhosted environments, with conditional compilation directives to include or exclude certain features based on the environment. It includes functions for booting and halting the shared memory system, which involve initializing and cleaning up resources such as mutexes and NUMA topology information. The code also provides error handling and logging to assist with debugging and ensuring that operations are performed correctly. The APIs defined in this code are intended to be used by other parts of a system that require efficient and controlled access to shared memory resources.
# Imports and Dependencies

---
- `fd_shmem_private.h`
- `ctype.h`
- `errno.h`
- `unistd.h`
- `fcntl.h`
- `linux/mempolicy.h`
- `sys/mman.h`
- `sys/stat.h`
- `linux/mman.h`


# Global Variables

---
### fd\_shmem\_private\_lock
- **Type**: ``pthread_mutex_t``
- **Description**: A mutex lock used to synchronize access to shared memory resources in a multi-threaded environment. It is defined as an array of one `pthread_mutex_t` element.
- **Use**: Used to ensure thread-safe operations on shared memory by locking and unlocking around critical sections.


---
### fd\_shmem\_private\_base
- **Type**: ``char` array`
- **Description**: Stores the base path for shared memory operations in a character array. It is initialized to an empty string at the start of a thread group and set during the boot process.
- **Use**: Used to define the shared memory domain path for the thread group.


---
### fd\_shmem\_private\_base\_len
- **Type**: ``ulong``
- **Description**: Represents the length of the shared memory private base path. It is initialized to 0UL at boot.
- **Use**: Used to store the length of the shared memory base path for internal operations.


---
### fd\_shmem\_private\_numa\_cnt
- **Type**: ``ulong``
- **Description**: Stores the count of NUMA nodes available to the thread group. It is initialized to zero at the start of the thread group and set during the boot process.
- **Use**: Tracks the number of NUMA nodes for memory allocation and management purposes.


---
### fd\_shmem\_private\_cpu\_cnt
- **Type**: ``ulong``
- **Description**: Stores the count of CPUs available in the system for shared memory operations. It is initialized at boot time and used to manage CPU-related operations in the shared memory context.
- **Use**: Used to determine the number of CPUs available for shared memory operations.


---
### fd\_shmem\_private\_numa\_idx
- **Type**: ``ushort[]``
- **Description**: An array of unsigned short integers that maps CPU indices to their corresponding NUMA node indices. The size of the array is defined by the constant `FD_SHMEM_CPU_MAX`. This array is initialized at boot and is used to store the NUMA node index for each CPU.
- **Use**: Used to retrieve the NUMA node index for a given CPU index in shared memory operations.


---
### fd\_shmem\_private\_cpu\_idx
- **Type**: ``ushort[]``
- **Description**: An array of unsigned short integers with a size defined by `FD_SHMEM_NUMA_MAX`. It is initialized at boot and used to map NUMA indices to CPU indices.
- **Use**: Maps NUMA indices to corresponding CPU indices for shared memory operations.


# Functions

---
### fd\_cstr\_to\_shmem\_lg\_page\_sz<!-- {{#callable:fd_cstr_to_shmem_lg_page_sz}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L9>)

Converts a string representation of a shared memory page size to its corresponding integer constant.
- **Inputs**:
    - `cstr`: A constant character pointer representing the string input that specifies the page size, such as "normal", "huge", or "gigantic".
- **Logic and Control Flow**:
    - Check if `cstr` is NULL; if so, return `FD_SHMEM_UNKNOWN_LG_PAGE_SZ`.
    - Compare `cstr` with "normal", "huge", and "gigantic" using `fd_cstr_casecmp`; return the corresponding page size constant if a match is found.
    - Convert `cstr` to an integer using `fd_cstr_to_int` and check if it matches any of the known page size constants; return the matching constant if found.
    - Return `FD_SHMEM_UNKNOWN_LG_PAGE_SZ` if no matches are found.
- **Output**: An integer representing the large page size constant corresponding to the input string, or `FD_SHMEM_UNKNOWN_LG_PAGE_SZ` if the input is invalid or unrecognized.


---
### fd\_shmem\_lg\_page\_sz\_to\_cstr<!-- {{#callable:fd_shmem_lg_page_sz_to_cstr}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L25>)

Converts a large page size identifier to its corresponding string representation.
- **Inputs**:
    - `lg_page_sz`: An integer representing the large page size identifier.
- **Logic and Control Flow**:
    - Use a switch statement to check the value of `lg_page_sz`.
    - If `lg_page_sz` matches `FD_SHMEM_NORMAL_LG_PAGE_SZ`, return "normal".
    - If `lg_page_sz` matches `FD_SHMEM_HUGE_LG_PAGE_SZ`, return "huge".
    - If `lg_page_sz` matches `FD_SHMEM_GIGANTIC_LG_PAGE_SZ`, return "gigantic".
    - If `lg_page_sz` does not match any known identifiers, return "unknown".
- **Output**: A constant character pointer to the string representation of the large page size.


---
### fd\_cstr\_to\_shmem\_page\_sz<!-- {{#callable:fd_cstr_to_shmem_page_sz}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L36>)

Converts a string representation of a shared memory page size to its corresponding numeric value.
- **Inputs**:
    - `cstr`: A constant character pointer representing the string input that specifies the shared memory page size.
- **Logic and Control Flow**:
    - Check if `cstr` is NULL; if so, return `FD_SHMEM_UNKNOWN_PAGE_SZ`.
    - Compare `cstr` with the string "normal" using `fd_cstr_casecmp`; if they match, return `FD_SHMEM_NORMAL_PAGE_SZ`.
    - Compare `cstr` with the string "huge" using `fd_cstr_casecmp`; if they match, return `FD_SHMEM_HUGE_PAGE_SZ`.
    - Compare `cstr` with the string "gigantic" using `fd_cstr_casecmp`; if they match, return `FD_SHMEM_GIGANTIC_PAGE_SZ`.
    - Convert `cstr` to an unsigned long using `fd_cstr_to_ulong` and store it in `u`.
    - Check if `u` equals `FD_SHMEM_NORMAL_PAGE_SZ`; if so, return `FD_SHMEM_NORMAL_PAGE_SZ`.
    - Check if `u` equals `FD_SHMEM_HUGE_PAGE_SZ`; if so, return `FD_SHMEM_HUGE_PAGE_SZ`.
    - Check if `u` equals `FD_SHMEM_GIGANTIC_PAGE_SZ`; if so, return `FD_SHMEM_GIGANTIC_PAGE_SZ`.
    - If none of the above conditions are met, return `FD_SHMEM_UNKNOWN_PAGE_SZ`.
- **Output**: Returns an unsigned long representing the numeric value of the shared memory page size, or `FD_SHMEM_UNKNOWN_PAGE_SZ` if the input is invalid or unrecognized.


---
### fd\_shmem\_page\_sz\_to\_cstr<!-- {{#callable:fd_shmem_page_sz_to_cstr}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L52>)

Converts a shared memory page size to its corresponding string representation.
- **Inputs**:
    - `page_sz`: An unsigned long integer representing the page size to convert.
- **Logic and Control Flow**:
    - Checks the value of `page_sz` using a switch statement.
    - If `page_sz` matches `FD_SHMEM_NORMAL_PAGE_SZ`, returns "normal".
    - If `page_sz` matches `FD_SHMEM_HUGE_PAGE_SZ`, returns "huge".
    - If `page_sz` matches `FD_SHMEM_GIGANTIC_PAGE_SZ`, returns "gigantic".
    - If `page_sz` does not match any known sizes, returns "unknown".
- **Output**: A constant character pointer to a string representing the page size, or "unknown" if the size is not recognized.


---
### fd\_shmem\_numa\_cnt<!-- {{#callable:fd_shmem_numa_cnt}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L88>)

Returns the number of NUMA nodes available.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the static variable `fd_shmem_private_numa_cnt`.
    - Returns the value of `fd_shmem_private_numa_cnt`.
- **Output**: The function returns an `ulong` representing the number of NUMA nodes.


---
### fd\_shmem\_cpu\_cnt<!-- {{#callable:fd_shmem_cpu_cnt}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L89>)

Returns the number of CPUs available for shared memory operations.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the static variable `fd_shmem_private_cpu_cnt` which holds the number of CPUs.
    - Returns the value of `fd_shmem_private_cpu_cnt`.
- **Output**: The function returns an `ulong` representing the number of CPUs.


---
### fd\_shmem\_numa\_idx<!-- {{#callable:fd_shmem_numa_idx}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L91>)

Determines the NUMA node index for a given CPU index.
- **Inputs**:
    - `cpu_idx`: The index of the CPU for which the NUMA node index is needed.
- **Logic and Control Flow**:
    - Checks if `cpu_idx` is greater than or equal to `fd_shmem_private_cpu_cnt`.
    - If true, returns `ULONG_MAX` to indicate an invalid CPU index.
    - If false, returns the NUMA node index from `fd_shmem_private_numa_idx` array corresponding to `cpu_idx`.
- **Output**: Returns the NUMA node index as an unsigned long integer, or `ULONG_MAX` if the CPU index is invalid.


---
### fd\_shmem\_cpu\_idx<!-- {{#callable:fd_shmem_cpu_idx}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L97>)

Maps a NUMA index to a CPU index if valid, otherwise returns `ULONG_MAX`.
- **Inputs**:
    - `numa_idx`: The NUMA index to map to a CPU index.
- **Logic and Control Flow**:
    - Checks if `numa_idx` is greater than or equal to `fd_shmem_private_numa_cnt` using `FD_UNLIKELY` macro.
    - If the condition is true, returns `ULONG_MAX`.
    - If the condition is false, returns the CPU index corresponding to `numa_idx` from the `fd_shmem_private_cpu_idx` array.
- **Output**: Returns the CPU index corresponding to the given NUMA index, or `ULONG_MAX` if the NUMA index is invalid.


---
### fd\_shmem\_numa\_validate<!-- {{#callable:fd_shmem_numa_validate}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L103>)

Validates shared memory allocation and alignment for NUMA compliance.
- **Inputs**:
    - `mem`: Pointer to the memory region to validate.
    - `page_sz`: Size of each memory page in bytes.
    - `page_cnt`: Number of pages in the memory region.
    - `cpu_idx`: Index of the CPU to check NUMA compliance against.
- **Logic and Control Flow**:
    - Check if `mem` is NULL and return `EINVAL` if true.
    - Validate `page_sz` using [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>) and return `EINVAL` if invalid.
    - Check if `mem` is aligned to `page_sz` using `fd_ulong_is_aligned` and return `EINVAL` if not aligned.
    - Validate `page_cnt` to ensure it is within valid range and return `EINVAL` if not.
    - Check if `cpu_idx` is less than the total CPU count using [`fd_shmem_cpu_cnt`](<#fd_shmem_cpu_cnt>) and return `EINVAL` if not.
    - Determine the NUMA index for `cpu_idx` using [`fd_shmem_numa_idx`](<#fd_shmem_numa_idx>).
    - Iterate over each page in the memory region, batching up to 512 pages at a time.
    - Use `fd_numa_move_pages` to query the NUMA node of each page in the batch.
    - Check the status of each page in the batch; if any page has a negative status, log an error and return the error code.
    - Verify that each page is allocated to the correct NUMA node; if not, log an error and return `EFAULT`.
    - Continue until all pages are validated.
- **Output**: Returns 0 if validation is successful, or an error code if validation fails.
- **Functions Called**:
    - [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>)
    - [`fd_shmem_cpu_cnt`](<#fd_shmem_cpu_cnt>)
    - [`fd_shmem_numa_idx`](<#fd_shmem_numa_idx>)


---
### fd\_shmem\_create\_multi\_flags<!-- {{#callable:fd_shmem_create_multi_flags}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L168>)

Creates a shared memory region with multiple subregions, each bound to specific NUMA nodes, and handles memory allocation and validation.
- **Inputs**:
    - `name`: The name of the shared memory region to create.
    - `page_sz`: The size of each memory page in the region.
    - `sub_cnt`: The number of subregions to create within the shared memory region.
    - `_sub_page_cnt`: An array specifying the number of pages for each subregion.
    - `_sub_cpu_idx`: An array specifying the CPU index for each subregion, used to determine NUMA node binding.
    - `mode`: The file mode for the shared memory region.
    - `open_flags`: Flags used when opening the shared memory region file.
- **Logic and Control Flow**:
    - Check if the input arguments are valid, including the name, page size, subregion count, and arrays for subregion page counts and CPU indices.
    - Calculate the total number of pages required for all subregions and validate against system limits.
    - Lock the shared memory to ensure thread safety during creation.
    - Save the current NUMA node memory policy of the thread.
    - Open a file to represent the shared memory region and set its size using `ftruncate`.
    - Map the file into the process's address space using `mmap`.
    - For each subregion, set the memory policy to bind memory to the appropriate NUMA node and lock the memory to ensure it is backed by physical pages.
    - Validate the NUMA binding of each subregion to ensure pages are allocated on the correct NUMA node.
    - If any errors occur during the process, clean up by unmapping memory, closing the file, and restoring the original memory policy.
    - Unlock the shared memory and return the error code, if any.
- **Output**: Returns 0 on success or an error code on failure.
- **Functions Called**:
    - [`fd_shmem_name_len`](<#fd_shmem_name_len>)
    - [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>)
    - [`fd_shmem_cpu_cnt`](<#fd_shmem_cpu_cnt>)
    - [`fd_shmem_private_path`](<fd_shmem_private.h.md#fd_shmem_private_path>)
    - [`fd_shmem_numa_idx`](<#fd_shmem_numa_idx>)
    - [`fd_shmem_numa_validate`](<#fd_shmem_numa_validate>)


---
### fd\_shmem\_create\_multi<!-- {{#callable:fd_shmem_create_multi}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L390>)

Creates a shared memory region with multiple subregions, each potentially bound to different CPUs, using specified flags.
- **Inputs**:
    - `name`: A constant character pointer representing the name of the shared memory region.
    - `page_sz`: An unsigned long representing the size of each page in the shared memory region.
    - `sub_cnt`: An unsigned long representing the number of subregions to create within the shared memory region.
    - `_sub_page_cnt`: A constant pointer to an array of unsigned longs, each representing the number of pages in a subregion.
    - `_sub_cpu_idx`: A constant pointer to an array of unsigned longs, each representing the CPU index to which a subregion is bound.
    - `mode`: An unsigned long representing the mode (permissions) for the shared memory region.
- **Logic and Control Flow**:
    - Calls [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>) with the provided arguments and additional flags `O_RDWR | O_CREAT | O_EXCL`.
- **Output**: Returns an integer status code from the [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>) function, indicating success or failure.
- **Functions Called**:
    - [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>)


---
### fd\_shmem\_update\_multi<!-- {{#callable:fd_shmem_update_multi}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L400>)

Updates a shared memory region with specified parameters by calling [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>) with read-write access.
- **Inputs**:
    - `name`: A constant character pointer representing the name of the shared memory region.
    - `page_sz`: An unsigned long representing the size of each page in the shared memory region.
    - `sub_cnt`: An unsigned long representing the number of subregions in the shared memory region.
    - `_sub_page_cnt`: A constant pointer to an array of unsigned longs, each representing the number of pages in a subregion.
    - `_sub_cpu_idx`: A constant pointer to an array of unsigned longs, each representing the CPU index for a subregion.
    - `mode`: An unsigned long representing the mode for the shared memory region.
- **Logic and Control Flow**:
    - Calls [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>) with the provided parameters and the `O_RDWR` flag.
    - Returns the result of the [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>) function call.
- **Output**: Returns an integer status code from the [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>) function, indicating success or failure.
- **Functions Called**:
    - [`fd_shmem_create_multi_flags`](<#fd_shmem_create_multi_flags>)


---
### fd\_shmem\_unlink<!-- {{#callable:fd_shmem_unlink}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L410>)

Unlinks a shared memory object specified by name and page size.
- **Inputs**:
    - `name`: A constant character pointer representing the name of the shared memory object to unlink.
    - `page_sz`: An unsigned long integer representing the page size of the shared memory object.
- **Logic and Control Flow**:
    - Checks if the `name` is valid using [`fd_shmem_name_len`](<#fd_shmem_name_len>); logs a warning and returns `EINVAL` if invalid.
    - Checks if `page_sz` is a valid page size using [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>); logs a warning and returns `EINVAL` if invalid.
    - Generates the path for the shared memory object using [`fd_shmem_private_path`](<fd_shmem_private.h.md#fd_shmem_private_path>).
    - Attempts to unlink the shared memory object using `unlink`; logs a warning and returns the error number if it fails.
    - Returns 0 on successful unlinking.
- **Output**: Returns 0 on success, or an error code if the operation fails.
- **Functions Called**:
    - [`fd_shmem_name_len`](<#fd_shmem_name_len>)
    - [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>)
    - [`fd_shmem_private_path`](<fd_shmem_private.h.md#fd_shmem_private_path>)


---
### fd\_shmem\_info<!-- {{#callable:fd_shmem_info}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L431>)

Retrieves shared memory information for a given name and page size, optionally storing the result in a provided structure.
- **Inputs**:
    - `name`: A constant character pointer representing the name of the shared memory segment.
    - `page_sz`: An unsigned long integer representing the page size to check for the shared memory segment.
    - `opt_info`: A pointer to an `fd_shmem_info_t` structure where the function can store the page size and page count if the shared memory segment is found.
- **Logic and Control Flow**:
    - Check if the `name` is valid using [`fd_shmem_name_len`](<#fd_shmem_name_len>); if not, log a warning and return `EINVAL`.
    - If `page_sz` is zero, attempt to retrieve information for the shared memory segment using predefined page sizes (`FD_SHMEM_GIGANTIC_PAGE_SZ`, `FD_SHMEM_HUGE_PAGE_SZ`, `FD_SHMEM_NORMAL_PAGE_SZ`) and return 0 if successful; otherwise, return `ENOENT`.
    - Verify if `page_sz` is a valid page size using [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>); if not, log a warning and return `EINVAL`.
    - Construct the path for the shared memory segment using [`fd_shmem_private_path`](<fd_shmem_private.h.md#fd_shmem_private_path>) and attempt to open it with `open`; if it fails, return the error number.
    - Use `fstat` to get the file status; if it fails, log a warning, close the file, and return the error number.
    - Check if the size of the shared memory segment is aligned with `page_sz` using `fd_ulong_is_aligned`; if not, log a warning, close the file, and return `EFAULT`.
    - Calculate the page count by dividing the size by `page_sz`.
    - Close the file and log a warning if closing fails.
    - If `opt_info` is not null, store `page_sz` and `page_cnt` in the `opt_info` structure.
    - Return 0 to indicate success.
- **Output**: Returns 0 on success, `EINVAL` for invalid input, `ENOENT` if the segment does not exist, or other error codes based on system call failures.
- **Functions Called**:
    - [`fd_shmem_name_len`](<#fd_shmem_name_len>)
    - [`fd_shmem_info`](<fd_shmem.h.md#fd_shmem_info>)
    - [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>)
    - [`fd_shmem_private_path`](<fd_shmem_private.h.md#fd_shmem_private_path>)


---
### fd\_shmem\_acquire\_multi<!-- {{#callable:fd_shmem_acquire_multi}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L486>)

Allocates and configures shared memory regions across multiple NUMA nodes based on specified page size and CPU indices.
- **Inputs**:
    - `page_sz`: The size of the memory pages to allocate.
    - `sub_cnt`: The number of subregions to allocate.
    - `_sub_page_cnt`: An array specifying the number of pages for each subregion.
    - `_sub_cpu_idx`: An array specifying the CPU index for each subregion.
- **Logic and Control Flow**:
    - Check if the provided `page_sz` is valid using [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>) and return NULL if invalid.
    - Verify that `sub_cnt` is non-zero and that `_sub_page_cnt` and `_sub_cpu_idx` are not NULL, returning NULL if any check fails.
    - Calculate the total number of pages (`page_cnt`) by iterating over each subregion, skipping empty subregions, and checking for overflow.
    - Ensure each subregion's CPU index is within the valid range of available CPUs, returning NULL if any index is invalid.
    - Verify that the total `page_cnt` is within a valid range, returning NULL if not.
    - Set memory mapping flags based on the `page_sz`, including huge page flags if applicable.
    - Lock shared memory operations with `FD_SHMEM_LOCK`.
    - Retrieve the current NUMA memory policy and node mask.
    - Attempt to map the memory using `mmap` and check for alignment, returning NULL if mapping fails or is misaligned.
    - Iterate over each subregion to set NUMA policies, lock memory, and bind memory to the specified NUMA node, logging warnings if any operation fails.
    - Restore the original NUMA memory policy and unlock shared memory operations.
    - Return the allocated memory pointer if successful, or NULL if any error occurred.
- **Output**: Returns a pointer to the allocated shared memory if successful, or NULL if an error occurs.
- **Functions Called**:
    - [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>)
    - [`fd_shmem_cpu_cnt`](<#fd_shmem_cpu_cnt>)
    - [`fd_shmem_numa_idx`](<#fd_shmem_numa_idx>)
    - [`fd_shmem_numa_validate`](<#fd_shmem_numa_validate>)


---
### fd\_shmem\_release<!-- {{#callable:fd_shmem_release}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L626>)

Releases a shared memory region by unmapping it from the process's address space.
- **Inputs**:
    - `mem`: Pointer to the memory region to release.
    - `page_sz`: Size of each memory page in bytes.
    - `page_cnt`: Number of pages in the memory region.
- **Logic and Control Flow**:
    - Check if `mem` is NULL; if so, log a warning and return -1.
    - Verify if `page_sz` is a valid page size using [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>); if not, log a warning and return -1.
    - Check if `mem` is aligned to `page_sz` using `fd_ulong_is_aligned`; if not, log a warning and return -1.
    - Ensure `page_cnt` is within a valid range; if not, log a warning and return -1.
    - Calculate the total size `sz` as `page_sz * page_cnt`.
    - Attempt to unmap the memory region using `munmap`; if it fails, log a warning with the error details.
    - Return the result of the `munmap` operation.
- **Output**: Returns 0 on success or -1 on failure, with warnings logged for any errors encountered.
- **Functions Called**:
    - [`fd_shmem_is_page_sz`](<fd_shmem.h.md#fd_shmem_is_page_sz>)


---
### fd\_shmem\_name\_len<!-- {{#callable:fd_shmem_name_len}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L661>)

Calculates the length of a valid shared memory name, ensuring it meets specific character and length criteria.
- **Inputs**:
    - `name`: A pointer to a constant character string representing the shared memory name to validate and measure.
- **Logic and Control Flow**:
    - Check if `name` is NULL; if so, return 0.
    - Initialize `len` to 0.
    - Iterate over the characters in `name` while `len` is less than `FD_SHMEM_NAME_MAX`.
    - For each character, check if it is NULL; if so, break the loop.
    - Check if the character is alphanumeric or, if not the first character, one of '_', '-', or '.'; if not, return 0.
    - Increment `len` for each valid character.
    - After the loop, check if `len` is 0 (empty string) or greater than or equal to `FD_SHMEM_NAME_MAX`; if so, return 0.
    - Return `len` as the length of the valid name.
- **Output**: The length of the valid shared memory name as an unsigned long integer, or 0 if the name is invalid.


---
### fd\_shmem\_private\_boot<!-- {{#callable:fd_shmem_private_boot}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L766>)

Initializes shared memory settings by stripping command line arguments related to shared memory paths.
- **Inputs**:
    - `pargc`: A pointer to an integer representing the number of command line arguments.
    - `pargv`: A pointer to an array of strings representing the command line arguments.
- **Logic and Control Flow**:
    - Logs the message 'fd_shmem: booting' to indicate the start of the boot process.
    - Calls `fd_env_strip_cmdline_cstr` to strip the command line of the `--shmem-path` argument, using 'FD_SHMEM_PATH' as the environment variable and '/mnt/.fd' as the default path.
    - Logs the message 'fd_shmem: --shmem-path (ignored)' to indicate that the `--shmem-path` argument is ignored.
    - Logs the message 'fd_shmem: boot success' to indicate the successful completion of the boot process.
- **Output**: No output is returned from this function.


---
### fd\_shmem\_private\_halt<!-- {{#callable:fd_shmem_private_halt}} -->
[View Source →](<../../../../../src/util/shmem/fd_shmem_admin.c#L780>)

Logs the start and successful completion of the shared memory halt process.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the message 'fd_shmem: halting' to indicate the start of the halt process.
    - Logs the message 'fd_shmem: halt success' to indicate the successful completion of the halt process.
- **Output**: No output is returned from this function.



---
Made with ❤️ by [Driver](https://www.driver.ai/)