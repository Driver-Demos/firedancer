<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a TAR file format handler for reading and writing Solana snapshots using ustar and old-GNU versions.

# Purpose
The code defines a C header file for handling TAR archives, specifically implementing the ustar and old-GNU versions of the TAR file format. It is not a general-purpose TAR implementation but is intended for loading and writing Solana snapshots. The file provides structures and functions for both reading and writing TAR archives. The `fd_tar_meta_t` structure represents the TAR header, which includes fields such as file name, mode, user ID, group ID, size, modification time, checksum, and type flag. The code defines constants for TAR block size and known file types, such as regular files, hard links, symbolic links, and directories.

The code includes a streaming reader and writer for TAR archives. The reader, represented by `fd_tar_reader_t`, uses a callback API to process TAR streams, issuing callbacks for file headers and content. The writer, represented by `fd_tar_writer_t`, allows writing files into a TAR archive, supporting operations like writing file headers, file data, and finalizing files. The writer also provides functions to reserve space for future data writing. The code defines several functions for managing these operations, such as [`fd_tar_reader_new`](<#fd_tar_reader_new>), [`fd_tar_reader_delete`](<#fd_tar_reader_delete>), [`fd_tar_read`](<#fd_tar_read>), [`fd_tar_writer_new`](<#fd_tar_writer_new>), [`fd_tar_writer_delete`](<#fd_tar_writer_delete>), and others for handling file data and metadata.
# Imports and Dependencies

---
- `../bits/fd_bits.h`


# Global Variables

---
### fd\_tar\_reader\_t
- **Type**: `struct fd_tar_reader`
- **Description**: Represents a streaming TAR reader that uses a callback API to deliver data. It manages the reading of TAR file headers and content, ensuring that data is processed in order and without gaps.
- **Use**: Used to read and process TAR streams by issuing callbacks for file headers and content.


# Data Structures

---
### fd\_tar\_meta
- **Type**: ``struct``
- **Members**:
    - ``name``: An array of 100 characters to store the file name.
    - ``mode``: An array of 8 characters to store the file mode.
    - ``uid``: An array of 8 characters to store the user ID.
    - ``gid``: An array of 8 characters to store the group ID.
    - ``size``: An array of 12 characters to store the file size.
    - ``mtime``: An array of 12 characters to store the modification time.
    - ``chksum``: An array of 8 characters to store the checksum.
    - ``typeflag``: A character to store the type of file.
    - ``linkname``: An array of 100 characters to store the name of the linked file.
    - ``magic``: An array of 6 characters to store the magic value indicating the TAR format.
    - ``version``: An array of 2 characters to store the version of the TAR format.
    - ``uname``: An array of 32 characters to store the user name.
    - ``gname``: An array of 32 characters to store the group name.
    - ``devmajor``: An array of 8 characters to store the major device number.
    - ``devminor``: An array of 8 characters to store the minor device number.
    - ``prefix``: An array of 155 characters to store the prefix for file names longer than 100 characters.
    - ``padding``: An array of 12 characters used for padding to align the structure to 512 bytes.
- **Description**: A packed structure representing the header of a TAR file in the ustar or old-GNU format. It contains fields for file metadata such as name, mode, user and group IDs, size, modification time, checksum, type flag, link name, magic value, version, user and group names, device numbers, and a prefix for long file names. The structure is aligned to 512 bytes, which is the block size used in TAR archives.


---
### fd\_tar\_meta\_t
- **Type**: ``struct fd_tar_meta``
- **Members**:
    - ``name``: A character array of size 100 to store the file name.
    - ``mode``: A character array of size 8 to store the file mode.
    - ``uid``: A character array of size 8 to store the user ID.
    - ``gid``: A character array of size 8 to store the group ID.
    - ``size``: A character array of size 12 to store the file size.
    - ``mtime``: A character array of size 12 to store the modification time.
    - ``chksum``: A character array of size 8 to store the checksum.
    - ``typeflag``: A character to store the type of file.
    - ``linkname``: A character array of size 100 to store the name of the linked file.
    - ``magic``: A character array of size 6 to store the magic value indicating the TAR format.
    - ``version``: A character array of size 2 to store the version of the TAR format.
    - ``uname``: A character array of size 32 to store the user name.
    - ``gname``: A character array of size 32 to store the group name.
    - ``devmajor``: A character array of size 8 to store the major device number.
    - ``devminor``: A character array of size 8 to store the minor device number.
    - ``prefix``: A character array of size 155 to store the prefix for file names longer than 100 characters.
    - ``padding``: A character array of size 12 for padding to align the structure to 512 bytes.
- **Description**: Represents the header of a TAR file in the ustar/OLDGNU format, containing metadata about a file such as its name, size, type, and ownership information. The structure is packed to ensure it fits within a 512-byte block, which is the standard size for TAR headers.


---
### fd\_tar\_read\_vtable
- **Type**: ``struct``
- **Members**:
    - `file`: A function pointer to `fd_tar_file_fn_t`, which is called when a new file is encountered in the TAR stream.
    - `read`: A function pointer to `fd_tar_read_fn_t`, which is called when a new chunk of data is read from the TAR stream.
- **Description**: Defines a virtual function table for the `fd_tar_reader_t` consumer object, containing function pointers for handling file and data read events in a TAR stream.


---
### fd\_tar\_read\_vtable\_t
- **Type**: ``struct``
- **Members**:
    - `file`: Pointer to a function that is called when a new file is encountered.
    - `read`: Pointer to a function that is called when a new chunk of data is read.
- **Description**: Defines a virtual function table for the `fd_tar_reader_t` consumer object, containing function pointers for handling file and data read events in a TAR stream.


---
### fd\_tar\_reader
- **Type**: ``struct``
- **Members**:
    - ``buf``: A buffer to store the file header, which might be split across multiple `fd_tar_read` calls.
    - ``header``: A `fd_tar_meta_t` structure representing the file header.
    - ``pos``: Tracks the number of bytes consumed from the TAR stream.
    - ``buf_ctr``: A write cursor indicating the current position in the file header buffer.
    - ``file_sz``: Indicates the number of file bytes left to read.
    - ``cb_vt``: A virtual function table for callback functions used by the TAR reader.
    - ``cb_arg``: A pointer to the callback context value.
- **Description**: A `fd_tar_reader` is a streaming TAR reader that uses a callback API to deliver data. It processes chunks of a TAR stream, issuing callbacks when file headers or content are read. The structure includes a buffer for the file header, position tracking for bytes consumed, a write cursor for the header buffer, and a file size counter. It also contains a virtual function table for callback functions and a pointer to the callback context.


---
### fd\_tar\_writer
- **Type**: ``struct fd_tar_writer``
- **Members**:
    - ``fd``: The file descriptor for the tar archive.
    - ``header_pos``: The position in the file for the current file's header, or `ULONG_MAX` if no file is being streamed.
    - ``data_sz``: The size of the current file's data, or `ULONG_MAX` if no file is being streamed.
    - ``wb_pos``: The position to write back to with a call to `fd_tar_writer_fill_space`, or `ULONG_MAX` if not applicable.
- **Description**: Manages the state and operations for writing files to a tar archive, including tracking the file descriptor, header position, data size, and write-back position. It facilitates the streaming of files into a tar archive, allowing for the creation of new files, writing of file data, and finalization of file entries. The structure supports reserving space for future data writing and is designed to be used with a valid file descriptor for the duration of a single tar archive session.


---
### fd\_tar\_writer\_t
- **Type**: ``struct``
- **Members**:
    - ``fd``: The file descriptor for the tar archive.
    - ``header_pos``: The position in the file for the current file's header, or `ULONG_MAX` if no file is being streamed.
    - ``data_sz``: The size of the current file's data, or `ULONG_MAX` if no file is being streamed.
    - ``wb_pos``: The position to write back to with a call to `fd_tar_writer_fill_space`, or `ULONG_MAX` if not applicable.
- **Description**: `fd_tar_writer_t` is a data structure used for writing TAR archives. It manages the file descriptor, tracks the position of the current file's header and data, and supports writing back to specific positions in the TAR stream. The structure is designed to handle streaming of files into a TAR archive, allowing for variable file sizes and ensuring proper alignment and metadata updates.


# Functions

---
### fd\_tar\_meta\_is\_reg<!-- {{#callable:fd_tar_meta_is_reg}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L62>)

Determines if a TAR file type is 'regular' by checking the `typeflag` field of the `fd_tar_meta_t` structure.
- **Inputs**:
    - `meta`: A pointer to a constant `fd_tar_meta_t` structure representing the TAR file header metadata.
- **Logic and Control Flow**:
    - Check if `meta->typeflag` is equal to `FD_TAR_TYPE_NULL` or `FD_TAR_TYPE_REGULAR`.
    - Return 1 if either condition is true, otherwise return 0.
- **Output**: Returns an integer: 1 if the file type is 'regular', 0 otherwise.


---
### fd\_tar\_meta\_set\_size<!-- {{#callable:fd_tar_meta_set_size}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L90>)

Sets the size field in a TAR header using the OLDGNU size extension.
- **Inputs**:
    - `meta`: A pointer to an `fd_tar_meta_t` structure where the size field will be set.
    - `sz`: An unsigned long integer representing the size to set in the TAR header.
- **Logic and Control Flow**:
    - Set the first byte of the `size` field in `meta` to `0x80` to indicate the use of the OLDGNU size extension.
    - Store the byte-swapped version of `sz` starting at the fifth byte of the `size` field in `meta`.
    - Return 1 to indicate success.
- **Output**: Returns 1 to indicate that the size was set successfully.


---
### fd\_tar\_meta\_set\_mtime<!-- {{#callable:fd_tar_meta_set_mtime}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L101>)

Sets the modification time field in a TAR header structure to a specified value.
- **Inputs**:
    - ``meta``: A pointer to an `fd_tar_meta_t` structure where the modification time will be set.
    - ``mtime``: An unsigned long integer representing the modification time to set in the TAR header.
- **Logic and Control Flow**:
    - Calls the [`fd_tar_set_octal`](<fd_tar_reader.c.md#fd_tar_set_octal>) function to convert the `mtime` value to an octal string and store it in the `mtime` field of the `meta` structure.
    - Returns the result of the [`fd_tar_set_octal`](<fd_tar_reader.c.md#fd_tar_set_octal>) function call, which indicates success or failure.
- **Output**: Returns an integer indicating success (1) or failure (0) of setting the modification time.
- **Functions Called**:
    - [`fd_tar_set_octal`](<fd_tar_reader.c.md#fd_tar_set_octal>)


---
### fd\_tar\_reader\_align<!-- {{#callable:fd_tar_reader_align}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L177>)

Returns the alignment requirement for the `fd_tar_reader_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `alignof` operator on `fd_tar_reader_t` to determine its alignment requirement.
    - Returns the result of the `alignof` operator.
- **Output**: An `ulong` value representing the alignment requirement of the `fd_tar_reader_t` structure.


---
### fd\_tar\_reader\_footprint<!-- {{#callable:fd_tar_reader_footprint}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L187>)

Returns the size of the `fd_tar_reader_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the size of the `fd_tar_reader_t` structure using the `sizeof` operator.
- **Output**: The function returns an `ulong` representing the size of the `fd_tar_reader_t` structure.


---
### fd\_tar\_writer\_align<!-- {{#callable:fd_tar_writer_align}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L273>)

Returns the alignment requirement of the `fd_tar_writer_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls the `alignof` operator on `fd_tar_writer_t` to determine its alignment requirement.
    - Returns the result of the `alignof` operation.
- **Output**: The alignment requirement of the `fd_tar_writer_t` structure as an `ulong`.


---
### fd\_tar\_writer\_footprint<!-- {{#callable:fd_tar_writer_footprint}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L278>)

Calculates the memory footprint of a `fd_tar_writer_t` structure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the size of the `fd_tar_writer_t` structure using the `sizeof` operator.
- **Output**: The function returns an `ulong` representing the size of the `fd_tar_writer_t` structure.


# Function Declarations (Public API)

---
### fd\_tar\_meta\_get\_size<!-- {{#callable_declaration:fd_tar_meta_get_size}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L76>)

Parses the size field of a TAR header.
- **Description**: Use this function to obtain the size of a file from its TAR header metadata. It interprets the size field in the TAR header, which can be encoded in either octal or binary format. This function is useful when working with TAR archives that follow the ustar or OLDGNU formats. It returns the file size as an unsigned long integer. If the size cannot be parsed, it returns `ULONG_MAX`. Ensure that the `meta` parameter is a valid pointer to a `fd_tar_meta_t` structure before calling this function.
- **Inputs**:
    - `meta`: A pointer to a `fd_tar_meta_t` structure containing the TAR header metadata. Must not be null. The function expects this structure to be properly initialized and valid.
- **Output**: Returns the file size as an unsigned long integer. If parsing fails, returns `ULONG_MAX`.
- **See Also**: [`fd_tar_meta_get_size`](<fd_tar_reader.c.md#fd_tar_meta_get_size>)  (Implementation)


---
### fd\_tar\_set\_octal<!-- {{#callable_declaration:fd_tar_set_octal}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L81>)

Writes a 12-byte octal representation of a value into a buffer.
- **Description**: Use this function to convert an unsigned long integer into a 12-byte octal string representation, which is stored in the provided buffer. This function is typically used when setting fields in a TAR header that require octal encoding. The buffer must have a minimum size of 12 bytes, and the function ensures that the string is null-terminated. The function returns 1 if the conversion is successful and the value fits within the octal representation, otherwise it returns 0.
- **Inputs**:
    - `buf`: A character array with a minimum size of 12 bytes where the octal string will be stored. The caller must ensure that this buffer is valid and has sufficient space.
    - `val`: An unsigned long integer to convert into an octal string. The function handles values that fit within the octal representation of 11 digits.
- **Output**: Returns 1 if the value was successfully converted and fits within the octal representation; otherwise, returns 0.
- **See Also**: [`fd_tar_set_octal`](<fd_tar_reader.c.md#fd_tar_set_octal>)  (Implementation)


---
### fd\_tar\_reader\_new<!-- {{#callable_declaration:fd_tar_reader_new}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L202>)

Creates a new TAR reader with specified memory and callbacks.
- **Description**: Use this function to initialize a TAR reader that processes TAR streams using a callback mechanism. The function requires a memory region that meets specific alignment and size requirements, and a set of callback functions for handling file and data events. It returns a handle to the reader object on success, or NULL if the memory is invalid or the callbacks are not properly defined. Ensure that the memory is aligned according to `fd_tar_reader_align` and that the callback table is not null and contains valid function pointers.
- **Inputs**:
    - `mem`: A pointer to a memory region that will hold the `fd_tar_reader_t` object. The memory must be aligned according to `fd_tar_reader_align` and must not be null. If the memory is not aligned or is null, the function returns NULL.
    - `cb_vt`: A pointer to a `fd_tar_read_vtable_t` structure containing the callback functions for file and data processing. This pointer is borrowed only during the function call and must not be null. The structure must have valid function pointers for file and read operations.
    - `cb_arg`: A pointer to a user-defined context that will be passed to the callback functions. This can be null if no context is needed.
- **Output**: Returns a pointer to the initialized `fd_tar_reader_t` object on success, or NULL if there is an error with the memory or callbacks.
- **See Also**: [`fd_tar_reader_new`](<fd_tar_reader.c.md#fd_tar_reader_new>)  (Implementation)


---
### fd\_tar\_reader\_delete<!-- {{#callable_declaration:fd_tar_reader_delete}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L210>)

Destroys a TAR reader and returns the memory region to the caller.
- **Description**: Use this function to clean up and release resources associated with a TAR reader when it is no longer needed. This function must be called to properly dispose of a TAR reader and return the allocated memory back to the caller. It is important to ensure that the `reader` is not null before calling this function to avoid undefined behavior.
- **Inputs**:
    - `reader`: A pointer to an `fd_tar_reader_t` object. Must not be null. If null, the function returns immediately with a null pointer.
- **Output**: Returns the pointer to the memory region that was backing the `fd_tar_reader_t` object, or null if the input `reader` was null.
- **See Also**: [`fd_tar_reader_delete`](<fd_tar_reader.c.md#fd_tar_reader_delete>)  (Implementation)


---
### fd\_tar\_read<!-- {{#callable_declaration:fd_tar_read}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L225>)

Processes a chunk of the TAR stream and issues callbacks.
- **Description**: Use this function to process a segment of a TAR stream with a streaming TAR reader. It reads file headers and content, issuing callbacks as defined in the reader's virtual function table. Ensure the reader is properly initialized before calling this function. The function handles data in order and without gaps, and it can track specific errors if `track_err` is set. If `track_err` is encountered, it will be returned after processing the entire data buffer, provided no other errors occur. If an error occurs, the function returns a positive error code, and the reader should be deleted without further calls to this function.
- **Inputs**:
    - `reader`: A pointer to an `fd_tar_reader_t` object. Must be initialized and not null. The caller retains ownership.
    - `data`: A pointer to the first byte of the data chunk to process. Must not be null.
    - `data_sz`: The size of the data chunk in bytes. Can be zero, which results in a no-op.
    - `track_err`: An integer error code to track. If set to 0, this functionality is disabled. If encountered, it will be returned after processing the data buffer.
- **Output**: Returns 0 on success, -1 on end-of-file, or a positive error code on failure. If `track_err` is encountered, it is returned after processing the data buffer.
- **See Also**: [`fd_tar_read`](<fd_tar_reader.c.md#fd_tar_read>)  (Implementation)


---
### fd\_tar\_writer\_new<!-- {{#callable_declaration:fd_tar_writer_new}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L293>)

Creates a new TAR writer.
- **Description**: Use this function to initialize a TAR writer for creating a TAR archive. It requires a memory region to store the writer's state and a valid file descriptor for the output TAR file. The function returns a handle to the writer object on success. Ensure the memory region is properly aligned and the file descriptor is open and valid. If the memory is null, unaligned, or the file descriptor is invalid, the function returns null and logs a warning.
- **Inputs**:
    - `mem`: A pointer to a memory region that will hold the `fd_tar_writer_t` structure. The memory must be aligned according to `fd_tar_writer_align()`. Must not be null.
    - `fd`: An integer representing a valid file descriptor for the TAR file. Must be greater than zero. The file will be truncated to zero length if it already exists.
- **Output**: Returns a pointer to an `fd_tar_writer_t` on success, or null on failure.
- **See Also**: [`fd_tar_writer_new`](<fd_tar_writer.c.md#fd_tar_writer_new>)  (Implementation)


---
### fd\_tar\_writer\_delete<!-- {{#callable_declaration:fd_tar_writer_delete}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L301>)

Destroys a TAR writer and finalizes the archive.
- **Description**: Use this function to properly close a TAR writer after all files have been added to the archive. It writes the necessary EOF blocks to finalize the TAR archive and closes the associated file descriptor. This function must be called to ensure the TAR archive is correctly terminated. It returns the memory region used by the writer back to the caller. Ensure that the `writer` is a valid pointer to an initialized `fd_tar_writer_t` object.
- **Inputs**:
    - `writer`: A pointer to an `fd_tar_writer_t` object. Must not be null. The function assumes the writer is properly initialized and in use. If the pointer is invalid, the behavior is undefined.
- **Output**: Returns the underlying memory region back to the caller. If an error occurs during the finalization, it returns NULL.
- **See Also**: [`fd_tar_writer_delete`](<fd_tar_writer.c.md#fd_tar_writer_delete>)  (Implementation)


---
### fd\_tar\_writer\_new\_file<!-- {{#callable_declaration:fd_tar_writer_new_file}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L309>)

Writes a new file header to the TAR archive.
- **Description**: Use this function to start writing a new file to a TAR archive. It writes a file header with some fields left blank for later updates. Call this function after `fd_tar_writer_new` or `fd_tar_writer_fini_file`. Ensure the writer is properly initialized and aligned before calling. This function prepares the writer to accept file data, which can be written using `fd_tar_writer_write_file_data`. It is important to follow the correct sequence of operations to maintain a valid TAR archive.
- **Inputs**:
    - `writer`: A pointer to an `fd_tar_writer_t` structure. Must be initialized and not null. The caller retains ownership.
    - `file_name`: A constant character pointer to the name of the file to be added to the TAR archive. Must not be null and should be a valid string.
- **Output**: Returns 0 on success. Returns -1 on failure, such as if the current file position is invalid or unaligned.
- **See Also**: [`fd_tar_writer_new_file`](<fd_tar_writer.c.md#fd_tar_writer_new_file>)  (Implementation)


---
### fd\_tar\_writer\_write\_file\_data<!-- {{#callable_declaration:fd_tar_writer_write_file_data}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L320>)

Writes file data to a TAR archive.
- **Description**: Use this function to write a specified amount of file data to an open TAR archive. It must be called after initializing a new file with `fd_tar_writer_new_file` and before finalizing the file with `fd_tar_writer_fini_file`. Ensure that the `writer` is properly initialized and that a corresponding TAR header exists before calling this function. If the function fails, it returns an error code and logs a warning.
- **Inputs**:
    - `writer`: A pointer to an `fd_tar_writer_t` structure representing the TAR writer. It must be initialized and must not be null. The function expects that a TAR header has been set for the current file.
    - `data`: A pointer to the data buffer containing the file data to write. It must not be null.
    - `data_sz`: The size in bytes of the data to write. It must be a non-zero value.
- **Output**: Returns 0 on success. Returns -1 on failure, such as when there is no corresponding TAR header or if writing the data fails.
- **See Also**: [`fd_tar_writer_write_file_data`](<fd_tar_writer.c.md#fd_tar_writer_write_file_data>)  (Implementation)


---
### fd\_tar\_writer\_fini\_file<!-- {{#callable_declaration:fd_tar_writer_fini_file}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L329>)

Finalizes the current file in the TAR archive.
- **Description**: Use this function to complete the writing of the current file in a TAR archive. It ensures that the file data is properly aligned to the TAR block size by adding necessary padding. It then updates the TAR header with the file size and checksum. This function must be called after writing all data for a file using `fd_tar_writer_write_file_data`. It is important to ensure that the `writer` is properly initialized and that a file is currently being written. If any error occurs during the process, the function returns -1, indicating failure.
- **Inputs**:
    - `writer`: A pointer to an `fd_tar_writer_t` structure representing the TAR writer. Must not be null and must point to a valid, initialized writer object. The function will return -1 if the writer is not properly set up or if any I/O operation fails.
- **Output**: Returns 0 on success, indicating the file was finalized correctly. Returns -1 on failure, indicating an error occurred during the finalization process.
- **See Also**: [`fd_tar_writer_fini_file`](<fd_tar_writer.c.md#fd_tar_writer_fini_file>)  (Implementation)


---
### fd\_tar\_writer\_make\_space<!-- {{#callable_declaration:fd_tar_writer_make_space}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L346>)

Reserves space in a TAR archive for future data writing.
- **Description**: Use this function to extend the size of a TAR archive by reserving space for future data writing. It must be called when there is no outstanding write-back position, indicated by `wb_pos` being equal to `ULONG_MAX`. This function is useful when you need to allocate space in the archive for data that will be written later. Ensure that the `fd_tar_writer_t` object is properly initialized and that the file descriptor is valid and open. The function will return an error if it cannot extend the file size or if there is an outstanding write-back position.
- **Inputs**:
    - `writer`: A pointer to an `fd_tar_writer_t` object. It must not be null and must be properly initialized. The function expects that there is no outstanding write-back position (i.e., `wb_pos` should be `ULONG_MAX`).
    - `data_sz`: The size in bytes of the space to reserve in the TAR archive. It must be a positive value.
- **Output**: Returns 0 on success. Returns -1 if there is an outstanding write-back position or if the function fails to extend the file size.
- **See Also**: [`fd_tar_writer_make_space`](<fd_tar_writer.c.md#fd_tar_writer_make_space>)  (Implementation)


---
### fd\_tar\_writer\_fill\_space<!-- {{#callable_declaration:fd_tar_writer_fill_space}} -->
[View Source →](<../../../../../src/util/archive/fd_tar.h#L349>)

Writes data to a reserved space in a TAR archive.
- **Description**: Use this function to write data to a previously reserved space in a TAR archive. It must be called after `fd_tar_writer_make_space` and before any other space reservation. Ensure that the `writer` has a valid write-back position set by `fd_tar_writer_make_space`. The function will fail if the write-back position is invalid or if the data cannot be written completely. After a successful call, the write-back position is reset, and the file position is restored to the end of the file.
- **Inputs**:
    - `writer`: A pointer to an `fd_tar_writer_t` structure. Must not be null and must have a valid write-back position set by `fd_tar_writer_make_space`. The caller retains ownership.
    - `data`: A pointer to the data to write. Must not be null. The caller retains ownership.
    - `data_sz`: The size of the data to write in bytes. Must be greater than zero and should match the size reserved by `fd_tar_writer_make_space`.
- **Output**: Returns 0 on success. Returns -1 on failure, such as when the write-back position is invalid or the data cannot be written completely.
- **See Also**: [`fd_tar_writer_fill_space`](<fd_tar_writer.c.md#fd_tar_writer_fill_space>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)