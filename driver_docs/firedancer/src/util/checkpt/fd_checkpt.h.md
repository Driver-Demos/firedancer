<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for fast parallel compressed checkpoint and restore, supporting RAW and LZ4 frame styles.

# Purpose
The code is a C header file that defines APIs for fast parallel compressed checkpoint and restore operations. It provides a framework for creating and managing checkpoints, which are collections of data frames that can be stored and later restored. Each frame can contain multiple data buffers, and the frames can be encoded in different styles, such as raw or LZ4 compressed. The header file defines constants, data structures, and function prototypes necessary for initializing, managing, and finalizing checkpoints and restores. It supports both streaming I/O and memory-mapped I/O modes, allowing for flexible data handling.

The file defines several key components, including `fd_checkpt_t` and `fd_restore_t`, which are semi-opaque handles for managing checkpoints and restores, respectively. It also specifies return codes for API functions, frame styles, and buffer size requirements. The APIs allow for parallel operations, enabling frames to be generated and restored concurrently. The header file includes detailed documentation for each function, explaining the parameters, return values, and potential error conditions. This facilitates the integration of checkpoint and restore functionality into other software systems, providing a mechanism for efficient data backup and recovery.
# Imports and Dependencies

---
- `../log/fd_log.h`


# Data Structures

---
### fd\_checkpt\_t
- **Type**: ``struct``
- **Members**:
    - ``fd``: File descriptor for the checkpoint, used in streaming mode.
    - ``frame_style``: Specifies the style of the frame, indicating if it is in a frame or not.
    - ``lz4``: Handle for the underlying compressor.
    - ``gbuf_cursor``: Cursor for small buffer gather optimizations.
    - ``off``: Offset of the next byte to write in memory-mapped I/O mode.
    - ``wbuf``: Used in streaming mode for write buffering.
    - ``mmio``: Used in memory-mapped I/O mode for checkpoint memory region.
    - ``gbuf``: Buffer for gather optimization.
- **Description**: A `fd_checkpt_t` is a semi-opaque handle for managing an in-progress checkpoint operation, supporting both streaming and memory-mapped I/O modes. It includes a file descriptor for streaming, a frame style indicator, a compressor handle, and buffers for data management and optimization. The structure allows for efficient parallel processing of checkpoint frames, with specific fields dedicated to handling different modes of operation and optimizing data storage and retrieval.


---
### fd\_restore\_t
- **Type**: ``struct``
- **Members**:
    - ``fd``: File descriptor for the restore, with a value of -1 in mmio mode.
    - ``frame_style``: Specifies the frame style, with positive values indicating a frame, 0 for valid but not in a frame, and -1 for failed.
    - ``lz4``: Handle of the underlying decompressor used.
    - ``sbuf_cursor``: Cursor for small buffer scatter optimizations, ranging from 0 to `FD_RESTORE_PRIVATE_SBUF_SZ`.
    - ``sz``: Size of the checkpoint in mmio mode or file size in streaming mode, with ULONG_MAX for non-seekable files.
    - ``off``: Offset of the next byte to read, relative to the first byte of the mmio region or file.
    - ``rbuf``: Used in streaming mode, it is a buffer of compressed bytes read from the file descriptor.
    - ``mmio``: Used in mmio mode, it is a pointer to the checkpoint memory region.
    - ``sbuf``: Scatter optimization buffer with a size defined by `FD_RESTORE_PRIVATE_SBUF_SZ`.
- **Description**: A `fd_restore_t` is a semi-opaque handle for an in-progress restore operation, which can operate in either streaming or memory-mapped I/O (mmio) mode. It manages the state and resources needed to restore data from a checkpoint, including file descriptors, buffer management, and decompression handles. The structure supports parallel restoration of frames, ensuring bit-level identical results regardless of the mode or distribution of restoration tasks across threads.


---
### fd\_checkpt\_private\_wbuf
- **Type**: ``struct``
- **Members**:
    - ``mem``: Buffer of compressed bytes not yet written to file descriptor, indexed by bytes.
    - ``sz``: Size of the buffer in bytes, must be greater than or equal to `FD_CHECKPT_WBUF_MIN`.
    - ``used``: Number of bytes in the buffer that are not yet written to the file descriptor.
- **Description**: Manages a buffer of compressed bytes that are pending to be written to a file descriptor, with fields to track the buffer's size and the number of bytes used.


---
### fd\_checkpt\_private\_wbuf\_t
- **Type**: ``struct``
- **Members**:
    - ``mem``: Buffer of compressed bytes not yet written to file descriptor, indexed by bytes [0, `wbuf_sz`).
    - ``sz``: Size of the buffer in bytes, must be greater than or equal to `FD_CHECKPT_WBUF_MIN`.
    - ``used``: Number of bytes in the buffer that are not yet written to the file descriptor, indexed by bytes [0, `wbuf_used`).
- **Description**: Manages a write buffer for streaming mode in a checkpointing system, storing compressed data that is not yet written to a file descriptor. The buffer size is defined by `sz`, and `used` tracks the number of bytes that are pending write operations.


---
### fd\_checkpt\_private\_mmio
- **Type**: ``struct``
- **Members**:
    - ``mem``: Pointer to the checkpoint memory region, indexed from 0 to `sz`.
    - ``sz``: Size of the checkpoint memory region in bytes.
- **Description**: Defines a memory-mapped I/O structure for managing a checkpoint memory region, including a pointer to the memory and its size.


---
### fd\_checkpt\_private\_mmio\_t
- **Type**: ``struct``
- **Members**:
    - ``mem``: Checkpoint memory region, indexed [0,sz).
    - ``sz``: Checkpoint memory region size in bytes.
- **Description**: Defines a memory-mapped input/output (MMIO) structure for handling checkpoint data, where `mem` points to the memory region used for the checkpoint and `sz` specifies the size of this memory region in bytes.


---
### fd\_checkpt\_private
- **Type**: ``struct``
- **Members**:
    - ``fd``: File descriptor for the checkpoint, with values indicating streaming mode (>=0) or memory-mapped I/O mode (-1).
    - ``frame_style``: Indicates the frame style using `FD_CHECKPT_FRAME_STYLE_*` constants, with values for valid (0) or failed (-1) states.
    - ``lz4``: Pointer to the handle of the underlying compressor.
    - ``gbuf_cursor``: Cursor for small buffer gather optimizations, ranging from 0 to `FD_CHECKPT_PRIVATE_GBUF_SZ`.
    - ``off``: Offset of the next byte to write, relative to the checkpoint's first byte, used in memory-mapped I/O mode.
    - ``wbuf``: Used in streaming mode for buffering compressed bytes not yet written to the file descriptor.
    - ``mmio``: Used in memory-mapped I/O mode for managing the checkpoint memory region.
    - ``gbuf``: Buffer for gather optimization, sized by `FD_CHECKPT_PRIVATE_GBUF_SZ`.
- **Description**: The `fd_checkpt_private` structure manages the state and configuration for a checkpoint operation, supporting both streaming and memory-mapped I/O modes. It includes fields for file descriptors, frame styles, compression handles, and buffer management, allowing for efficient data handling and optimization during checkpointing processes. The structure uses a union to differentiate between streaming and memory-mapped modes, with specific fields for each mode's requirements.


---
### fd\_restore\_private\_rbuf
- **Type**: ``struct``
- **Members**:
    - ``mem``: Buffer of compressed bytes read from a file descriptor, indexed by bytes.
    - ``sz``: Size of the buffer in bytes, must be at least `FD_RESTORE_RBUF_MIN`.
    - ``lo``: Number of bytes in the buffer that have been read and restored.
    - ``ready``: Number of compressed bytes that have not been processed, with constraints on its value relative to `lo` and `sz`.
- **Description**: Manages a buffer for reading compressed data from a file descriptor, tracking the size of the buffer, the number of bytes read and restored, and the number of bytes ready for processing.


---
### fd\_restore\_private\_rbuf\_t
- **Type**: ``struct``
- **Members**:
    - ``mem``: Buffer of compressed bytes read from a file descriptor, indexed by bytes.
    - ``sz``: Size of the buffer in bytes, must be at least `FD_RESTORE_RBUF_MIN`.
    - ``lo``: Number of bytes in the buffer that have been read and restored.
    - ``ready``: Number of compressed bytes that have not been processed, ensuring `0 <= rbuf_lo <= (rbuf_lo + rbuf_ready) <= rbuf_sz`.
- **Description**: Defines a structure for managing a buffer of compressed bytes during a restore operation, similar to a buffered input stream. It includes fields for the buffer memory, its size, the number of bytes read, and the number of bytes ready for processing, ensuring efficient data restoration from a file descriptor.


---
### fd\_restore\_private\_mmio
- **Type**: ``struct``
- **Members**:
    - ``mem``: Pointer to a constant unsigned character array representing a checkpoint memory region.
- **Description**: Defines a structure for managing a memory-mapped input/output (MMIO) region used in the restoration process of checkpoints. The `mem` member points to a memory region that is indexed from 0 to a specified size, facilitating the retrieval of checkpoint data during the restoration process.


---
### fd\_restore\_private\_mmio\_t
- **Type**: ``struct``
- **Members**:
    - ``mem``: Pointer to the checkpoint memory region, indexed [0,sz).
    - ``sz``: Size of the checkpoint memory region in bytes.
- **Description**: Defines a memory-mapped input/output (MMIO) structure for handling checkpoint data, where `mem` points to the memory region used for the checkpoint and `sz` specifies the size of this region in bytes.


---
### fd\_restore\_private
- **Type**: ``struct``
- **Members**:
    - ``fd``: File descriptor for the restore, with values (>=0) for stream mode and -1 for mmio mode.
    - ``frame_style``: Indicates the frame style, with positive values for valid frames, 0 for not in frame, and -1 for failed frames.
    - ``lz4``: Pointer to the handle of the underlying decompressor used.
    - ``sbuf_cursor``: Cursor for small buffer scatter optimizations, ranging from 0 to `FD_RESTORE_PRIVATE_SBUF_SZ`.
    - ``sz``: Size of the file if seekable, otherwise `ULONG_MAX` for stream mode, and mmio region size for mmio mode.
    - ``off``: Offset of the next byte to read, relative to the first byte of the file or mmio region.
    - ``rbuf``: Used in streaming mode for buffered input.
    - ``mmio``: Used in mmio mode for memory-mapped input.
    - ``sbuf``: Buffer for scatter optimization, with size `FD_RESTORE_PRIVATE_SBUF_SZ`.
- **Description**: Manages the state and resources needed for restoring data from a checkpoint, supporting both streaming and memory-mapped I/O modes. It includes file descriptors, frame style indicators, decompression handles, and buffers for optimizing data restoration. The structure uses a union to handle different modes of operation, either through buffered input in streaming mode or memory-mapped input in mmio mode.


# Functions

---
### fd\_checkpt\_is\_mmio<!-- {{#callable:fd_checkpt_is_mmio}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L275>)

Determines if a checkpoint is in memory-mapped I/O mode by checking if the file descriptor is negative.
- **Inputs**:
    - `checkpt`: A pointer to a constant `fd_checkpt_t` structure representing the checkpoint to check.
- **Logic and Control Flow**:
    - Access the `fd` field of the `checkpt` structure.
    - Return 1 if `fd` is less than 0, indicating memory-mapped I/O mode.
    - Return 0 if `fd` is 0 or greater, indicating streaming mode.
- **Output**: Returns an integer: 1 if the checkpoint is in memory-mapped I/O mode, 0 if it is in streaming mode.


---
### fd\_checkpt\_fd<!-- {{#callable:fd_checkpt_fd}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L280>)

Returns the file descriptor associated with a given checkpoint in streaming mode.
- **Inputs**:
    - `checkpt`: A pointer to a constant `fd_checkpt_t` structure representing the checkpoint.
- **Logic and Control Flow**:
    - Accesses the `fd` member of the `fd_checkpt_t` structure pointed to by `checkpt`.
    - Returns the value of `checkpt->fd`.
- **Output**: An integer representing the file descriptor of the checkpoint.


---
### fd\_checkpt\_wbuf<!-- {{#callable:fd_checkpt_wbuf}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L281>)

Returns the memory buffer used for write operations in a streaming checkpoint.
- **Inputs**:
    - `checkpt`: A pointer to a `fd_checkpt_t` structure, which represents an in-progress checkpoint in streaming mode.
- **Logic and Control Flow**:
    - Accesses the `wbuf` member of the `checkpt` structure, which is a union member used in streaming mode.
    - Returns the `mem` field of the `wbuf`, which points to the memory buffer for write operations.
- **Output**: A pointer to the memory buffer used for write operations in the checkpoint.


---
### fd\_checkpt\_wbuf\_sz<!-- {{#callable:fd_checkpt_wbuf_sz}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L282>)

Returns the size of the write buffer in a checkpoint structure.
- **Inputs**:
    - `checkpt`: A pointer to a constant `fd_checkpt_t` structure, which represents an in-progress checkpoint.
- **Logic and Control Flow**:
    - Accesses the `wbuf` member of the `checkpt` structure.
    - Returns the `sz` field of the `wbuf`, which indicates the size of the write buffer.
- **Output**: The size of the write buffer as an unsigned long integer.


---
### fd\_checkpt\_mmio<!-- {{#callable:fd_checkpt_mmio}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L287>)

Accesses the memory region used for a checkpoint in memory-mapped I/O mode.
- **Inputs**:
    - `checkpt`: A pointer to a `fd_checkpt_t` structure, which represents an in-progress checkpoint.
- **Logic and Control Flow**:
    - Accesses the `mmio` member of the `checkpt` structure, which is a union containing memory-mapped I/O specific data.
    - Returns the `mem` field of the `mmio` structure, which points to the memory region used for the checkpoint.
- **Output**: A pointer to the memory region used for the checkpoint in memory-mapped I/O mode.


---
### fd\_checkpt\_mmio\_sz<!-- {{#callable:fd_checkpt_mmio_sz}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L288>)

Retrieves the size of the memory-mapped I/O region for a given checkpoint.
- **Inputs**:
    - `checkpt`: A pointer to a `fd_checkpt_t` structure representing the checkpoint.
- **Logic and Control Flow**:
    - Accesses the `mmio` member of the `fd_checkpt_t` structure pointed to by `checkpt`.
    - Returns the `sz` field of the `mmio` member, which represents the size of the memory-mapped I/O region.
- **Output**: The size of the memory-mapped I/O region as an `ulong`.


---
### fd\_checkpt\_can\_open<!-- {{#callable:fd_checkpt_can_open}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L295>)

Determines if a new frame can be opened in a checkpoint by checking if the `frame_style` is zero.
- **Inputs**:
    - `checkpt`: A pointer to a constant `fd_checkpt_t` structure representing the checkpoint to check.
- **Logic and Control Flow**:
    - Check the `frame_style` member of the `checkpt` structure.
    - Return 1 if `frame_style` is zero, indicating a new frame can be opened.
    - Return 0 if `frame_style` is non-zero, indicating a frame is already open or the checkpoint has failed.
- **Output**: Returns an integer: 1 if a new frame can be opened, 0 otherwise.


---
### fd\_checkpt\_in\_frame<!-- {{#callable:fd_checkpt_in_frame}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L296>)

Checks if a checkpoint is currently within a frame by evaluating the `frame_style` attribute of the `fd_checkpt_t` structure.
- **Inputs**:
    - `checkpt`: A pointer to a constant `fd_checkpt_t` structure representing the checkpoint to check.
- **Logic and Control Flow**:
    - Access the `frame_style` attribute of the `checkpt` structure.
    - Return the result of the comparison `checkpt->frame_style > 0`.
- **Output**: Returns an integer value: 1 if the checkpoint is in a frame (`frame_style` is greater than 0), or 0 if it is not.


---
### fd\_checkpt\_open<!-- {{#callable:fd_checkpt_open}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L338>)

Opens a new frame in a checkpoint with a specified frame style.
- **Inputs**:
    - `checkpt`: A pointer to a `fd_checkpt_t` structure representing the checkpoint.
    - `frame_style`: An integer specifying the style of the frame to open, using `FD_CHECKPT_FRAME_STYLE_*` constants.
- **Logic and Control Flow**:
    - Declare a variable `off` of type `ulong`.
    - Call the function [`fd_checkpt_open_advanced`](<fd_checkpt.c.md#fd_checkpt_open_advanced>) with `checkpt`, `frame_style`, and the address of `off` as arguments.
    - Return the result of [`fd_checkpt_open_advanced`](<fd_checkpt.c.md#fd_checkpt_open_advanced>).
- **Output**: Returns an integer indicating success (`FD_CHECKPT_SUCCESS`) or an error code (`FD_CHECKPT_ERR_*`).
- **Functions Called**:
    - [`fd_checkpt_open_advanced`](<fd_checkpt.c.md#fd_checkpt_open_advanced>)


---
### fd\_checkpt\_close<!-- {{#callable:fd_checkpt_close}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L373>)

Closes the current frame in a checkpoint and returns the offset of the last byte of the closed frame.
- **Inputs**:
    - `checkpt`: A pointer to a `fd_checkpt_t` structure representing the checkpoint to close.
- **Logic and Control Flow**:
    - Declare a variable `off` of type `ulong`.
    - Call the function [`fd_checkpt_close_advanced`](<fd_checkpt.c.md#fd_checkpt_close_advanced>) with `checkpt` and the address of `off` as arguments.
    - Return the result of [`fd_checkpt_close_advanced`](<fd_checkpt.c.md#fd_checkpt_close_advanced>).
- **Output**: Returns an integer indicating success (`FD_CHECKPT_SUCCESS`) or an error code (`FD_CHECKPT_ERR_*`).
- **Functions Called**:
    - [`fd_checkpt_close_advanced`](<fd_checkpt.c.md#fd_checkpt_close_advanced>)


---
### fd\_restore\_is\_mmio<!-- {{#callable:fd_restore_is_mmio}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L480>)

Determines if a given `fd_restore_t` object is in memory-mapped I/O mode by checking if its file descriptor is negative.
- **Inputs**:
    - `restore`: A pointer to a constant `fd_restore_t` object, representing the restore operation to check.
- **Logic and Control Flow**:
    - Check if the `fd` field of the `restore` object is less than 0.
    - Return 1 if the `fd` is less than 0, indicating memory-mapped I/O mode.
    - Return 0 otherwise, indicating streaming I/O mode.
- **Output**: Returns an integer: 1 if the restore operation is in memory-mapped I/O mode, 0 if it is in streaming I/O mode.


---
### fd\_restore\_fd<!-- {{#callable:fd_restore_fd}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L485>)

Returns the file descriptor from a given `fd_restore_t` structure.
- **Inputs**:
    - `restore`: A pointer to a constant `fd_restore_t` structure from which the file descriptor is to be retrieved.
- **Logic and Control Flow**:
    - Accesses the `fd` member of the `fd_restore_t` structure pointed to by `restore`.
    - Returns the value of the `fd` member.
- **Output**: The function returns an integer representing the file descriptor stored in the `fd_restore_t` structure.


---
### fd\_restore\_rbuf<!-- {{#callable:fd_restore_rbuf}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L486>)

Accesses the memory buffer used for reading in a restore operation.
- **Inputs**:
    - `restore`: A pointer to a `fd_restore_t` structure representing the restore operation.
- **Logic and Control Flow**:
    - Accesses the `rbuf` member of the `restore` structure.
    - Returns the `mem` field of the `rbuf`, which points to the memory buffer used for reading.
- **Output**: A pointer to the memory buffer (`void *`) used for reading in the restore operation.


---
### fd\_restore\_rbuf\_sz<!-- {{#callable:fd_restore_rbuf_sz}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L487>)

Retrieves the size of the read buffer from a `fd_restore_t` structure.
- **Inputs**:
    - `restore`: A pointer to a `fd_restore_t` structure from which the read buffer size is retrieved.
- **Logic and Control Flow**:
    - Accesses the `rbuf` member of the `fd_restore_t` structure pointed to by `restore`.
    - Returns the `sz` field of the `rbuf` member, which represents the size of the read buffer.
- **Output**: Returns an `ulong` representing the size of the read buffer in the `fd_restore_t` structure.


---
### fd\_restore\_mmio<!-- {{#callable:fd_restore_mmio}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L492>)

Retrieves the memory-mapped I/O memory region from a `fd_restore_t` structure.
- **Inputs**:
    - `restore`: A pointer to a `fd_restore_t` structure, which contains information about the memory-mapped I/O region.
- **Logic and Control Flow**:
    - Accesses the `mmio` member of the `restore` structure.
    - Returns the `mem` field of the `mmio` member, which points to the memory-mapped I/O region.
- **Output**: A pointer to the memory-mapped I/O memory region within the `fd_restore_t` structure.


---
### fd\_restore\_mmio\_sz<!-- {{#callable:fd_restore_mmio_sz}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L493>)

Returns the size of the memory-mapped I/O region for a given restore operation.
- **Inputs**:
    - `restore`: A pointer to a constant `fd_restore_t` structure representing the restore operation.
- **Logic and Control Flow**:
    - Accesses the `sz` field of the `restore` structure to obtain the size of the memory-mapped I/O region.
- **Output**: The function returns an `ulong` representing the size of the memory-mapped I/O region.


---
### fd\_restore\_can\_open<!-- {{#callable:fd_restore_can_open}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L500>)

Determines if a new frame can be opened in the restore process by checking the frame style.
- **Inputs**:
    - `restore`: A pointer to a constant `fd_restore_t` structure representing the current restore state.
- **Logic and Control Flow**:
    - Check the `frame_style` member of the `restore` structure.
    - Return 1 if `frame_style` is 0, indicating a new frame can be opened.
    - Return 0 otherwise, indicating a new frame cannot be opened.
- **Output**: Returns an integer: 1 if a new frame can be opened, 0 otherwise.


---
### fd\_restore\_in\_frame<!-- {{#callable:fd_restore_in_frame}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L501>)

Checks if the `fd_restore_t` object is currently in a frame.
- **Inputs**:
    - `restore`: A pointer to a constant `fd_restore_t` object, representing the restore operation to check.
- **Logic and Control Flow**:
    - Accesses the `frame_style` member of the `restore` object.
    - Returns a boolean value indicating if `frame_style` is greater than 0.
- **Output**: Returns 1 if the `restore` object is in a frame, otherwise returns 0.


---
### fd\_restore\_sz<!-- {{#callable:fd_restore_sz}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L508>)

Returns the size of the checkpoint or memory-mapped I/O region for a given `fd_restore_t` object.
- **Inputs**:
    - `restore`: A pointer to a constant `fd_restore_t` object, which represents an in-progress restore operation.
- **Logic and Control Flow**:
    - Accesses the `sz` member of the `fd_restore_t` structure pointed to by `restore`.
    - Returns the value of `restore->sz`, which represents the size of the checkpoint or memory-mapped I/O region.
- **Output**: The function returns an `ulong` representing the size of the checkpoint or memory-mapped I/O region.


---
### fd\_restore\_open<!-- {{#callable:fd_restore_open}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L552>)

Calls [`fd_restore_open_advanced`](<fd_restore.c.md#fd_restore_open_advanced>) to open a new frame for restoration with a specified frame style.
- **Inputs**:
    - ``restore``: A pointer to an `fd_restore_t` structure representing the restore context.
    - ``frame_style``: An integer specifying the style of the frame to read, using `FD_CHECKPT_FRAME_STYLE_*` constants.
- **Logic and Control Flow**:
    - Declare a variable `off` of type `ulong` to store the offset.
    - Call [`fd_restore_open_advanced`](<fd_restore.c.md#fd_restore_open_advanced>) with `restore`, `frame_style`, and the address of `off` to open a new frame.
    - Return the result of [`fd_restore_open_advanced`](<fd_restore.c.md#fd_restore_open_advanced>).
- **Output**: Returns an integer indicating success (`FD_CHECKPT_SUCCESS`) or an error code (`FD_CHECKPT_ERR_*`).
- **Functions Called**:
    - [`fd_restore_open_advanced`](<fd_restore.c.md#fd_restore_open_advanced>)


---
### fd\_restore\_close<!-- {{#callable:fd_restore_close}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L590>)

Calls [`fd_restore_close_advanced`](<fd_restore.c.md#fd_restore_close_advanced>) to close the current frame in a restore operation.
- **Inputs**:
    - `restore`: A pointer to a `fd_restore_t` structure representing the restore operation.
- **Logic and Control Flow**:
    - Declare a variable `off` of type `ulong`.
    - Call [`fd_restore_close_advanced`](<fd_restore.c.md#fd_restore_close_advanced>) with `restore` and the address of `off`.
    - Return the result of [`fd_restore_close_advanced`](<fd_restore.c.md#fd_restore_close_advanced>).
- **Output**: Returns an integer indicating success (`FD_CHECKPT_SUCCESS`) or failure (a negative `FD_CHECKPT_ERR` code).
- **Functions Called**:
    - [`fd_restore_close_advanced`](<fd_restore.c.md#fd_restore_close_advanced>)


# Function Declarations (Public API)

---
### fd\_checkpt\_init\_mmio<!-- {{#callable_declaration:fd_checkpt_init_mmio}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L250>)

Initializes a memory-mapped checkpoint.
- **Description**: Use this function to initialize a memory region for a checkpoint in memory-mapped I/O mode. Ensure that the `mem` parameter is non-null and properly aligned according to `FD_CHECKPT_ALIGN`. The `mmio` parameter can be null only if `mmio_sz` is zero. This function returns a pointer to a `fd_checkpt_t` structure on success, or null if any input validation fails, logging a warning in such cases.
- **Inputs**:
    - `mem`: A pointer to a memory region to be formatted as a checkpoint. Must not be null and must be aligned to `FD_CHECKPT_ALIGN`.
    - `mmio`: A pointer to the memory-mapped I/O region where checkpoint frames will be stored. Can be null if `mmio_sz` is zero.
    - `mmio_sz`: The size of the memory-mapped I/O region in bytes. If non-zero, `mmio` must not be null.
- **Output**: Returns a pointer to a `fd_checkpt_t` structure on success, or null if input validation fails.
- **See Also**: [`fd_checkpt_init_mmio`](<fd_checkpt.c.md#fd_checkpt_init_mmio>)  (Implementation)


---
### fd\_checkpt\_fini<!-- {{#callable_declaration:fd_checkpt_fini}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L269>)

Finalize a checkpoint operation.
- **Description**: Use this function to complete a checkpoint operation. It must be called when the checkpoint is valid and not currently in a frame. If the checkpoint is in a frame or the pointer is null, the function will log a warning and return null. On successful completion, it returns the memory pointer associated with the checkpoint, and the caller regains ownership of the resources. If the function fails, the checkpoint is considered invalid, and the caller should discard it and any associated resources.
- **Inputs**:
    - `checkpt`: A pointer to a valid `fd_checkpt_t` structure. It must not be null and should not be in a frame. If null or in a frame, the function logs a warning and returns null.
- **Output**: Returns a pointer to the memory associated with the checkpoint on success, or null on failure.
- **See Also**: [`fd_checkpt_fini`](<fd_checkpt.c.md#fd_checkpt_fini>)  (Implementation)


---
### fd\_checkpt\_open\_advanced<!-- {{#callable_declaration:fd_checkpt_open_advanced}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L333>)

Opens a new frame in a checkpoint with a specified style.
- **Description**: Use this function to open a new frame in a checkpoint, allowing for parallel restoration of frames. Ensure the checkpoint is valid and not currently in a frame or failed before calling. The function sets the frame style and provides the offset of the frame from the start of the checkpoint. It is important to note that the offset is relative to the checkpoint, not the file. The function does not retain interest in the offset pointer.
- **Inputs**:
    - `checkpt`: A pointer to a valid `fd_checkpt_t` structure. Must not be null and must be openable (not in a frame or failed).
    - `frame_style`: An integer specifying the frame style, using `FD_CHECKPT_FRAME_STYLE_*` constants. A value of 0 defaults to `FD_CHECKPT_FRAME_STYLE_DEFAULT`. Unsupported styles will result in an error.
    - `_off`: A pointer to an `ulong` where the function will store the offset of the frame from the start of the checkpoint. Must not be null.
- **Output**: Returns `FD_CHECKPT_SUCCESS` (0) on success, with `_off` containing the frame offset. On failure, returns a negative `FD_CHECKPT_ERR_*` code and leaves `_off` unchanged.
- **See Also**: [`fd_checkpt_open_advanced`](<fd_checkpt.c.md#fd_checkpt_open_advanced>)  (Implementation)


---
### fd\_checkpt\_close\_advanced<!-- {{#callable_declaration:fd_checkpt_close_advanced}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L369>)

Closes the current frame in a checkpoint.
- **Description**: Use this function to close a frame in a checkpoint when it is valid and currently in a frame. It finalizes the frame, ensuring all data is written and updates the offset to reflect the end of the frame. This function must be called after opening a frame and before finalizing the checkpoint. It returns an error if the checkpoint is invalid, not in a frame, or if an I/O error occurs. After a failure, the checkpoint should be considered failed and discarded.
- **Inputs**:
    - `checkpt`: A pointer to a valid `fd_checkpt_t` structure that is currently in a frame. Must not be null.
    - `_off`: A pointer to an `ulong` where the function will store the offset of one past the last byte of the closed frame. Must not be null.
- **Output**: Returns `FD_CHECKPT_SUCCESS` on success. On failure, returns a negative error code (`FD_CHECKPT_ERR_INVAL` or `FD_CHECKPT_ERR_IO`) and logs details. On success, updates `*_off` with the new offset.
- **See Also**: [`fd_checkpt_close_advanced`](<fd_checkpt.c.md#fd_checkpt_close_advanced>)  (Implementation)


---
### fd\_checkpt\_meta<!-- {{#callable_declaration:fd_checkpt_meta}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L396>)

Checkpoints a metadata buffer into a frame.
- **Description**: Use this function to checkpoint a metadata buffer into an existing frame. The function requires that the checkpoint is valid and currently in a frame. The size of the buffer must not exceed `FD_CHECKPT_META_MAX`. If the buffer size is zero, the buffer pointer can be null. This function does not retain any interest in the buffer after execution. If the function fails, it logs the error and returns a negative error code, indicating that the checkpoint should be considered failed and discarded.
- **Inputs**:
    - `checkpt`: A pointer to a valid `fd_checkpt_t` structure. It must be in a frame. If null or not in a frame, the function will fail.
    - `buf`: A pointer to the memory region to checkpoint. If `sz` is zero, this can be null. Otherwise, it must not be null.
    - `sz`: The size of the buffer in bytes. Must be at most `FD_CHECKPT_META_MAX`. If greater, the function will fail.
- **Output**: Returns `FD_CHECKPT_SUCCESS` (0) on success. On failure, returns a negative error code and logs the error.
- **See Also**: [`fd_checkpt_meta`](<fd_checkpt.c.md#fd_checkpt_meta>)  (Implementation)


---
### fd\_checkpt\_data<!-- {{#callable_declaration:fd_checkpt_data}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L422>)

Checkpoints a data buffer into a frame.
- **Description**: Use this function to add a data buffer to an ongoing frame in a checkpoint. The checkpoint must be valid and currently in a frame. The function can handle any size of data buffer, including zero bytes. If the buffer size is zero, the buffer pointer can be null. After calling this function, the checkpoint retains an interest in the buffer until the frame is closed, meaning the buffer must remain unchanged and valid until then. This function returns a success or error code, and in case of failure, the checkpoint should be considered failed and discarded.
- **Inputs**:
    - `checkpt`: A pointer to a valid `fd_checkpt_t` that is currently in a frame. Must not be null.
    - `buf`: A pointer to the data buffer to checkpoint. Can be null if `sz` is zero. The buffer must remain unchanged until the frame is closed.
    - `sz`: The size of the data buffer in bytes. Can be zero, in which case `buf` can be null.
- **Output**: Returns `FD_CHECKPT_SUCCESS` (0) on success or a negative `FD_CHECKPT_ERR_*` code on failure. On failure, the checkpoint should be considered failed.
- **See Also**: [`fd_checkpt_data`](<fd_checkpt.c.md#fd_checkpt_data>)  (Implementation)


---
### fd\_restore\_init\_stream<!-- {{#callable_declaration:fd_restore_init_stream}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L445>)

Initializes a restore operation in streaming mode.
- **Description**: Use this function to set up a restore operation from a file descriptor in streaming mode. The function requires a memory region for the restore state, a file descriptor positioned at the start of the checkpoint, and a buffer for read operations. Ensure that the memory region is properly aligned and that the buffer size meets the minimum requirement. If any input is invalid, the function returns NULL and logs a warning.
- **Inputs**:
    - `mem`: A pointer to a memory region for the restore state. Must not be null and must be aligned to `FD_RESTORE_ALIGN`.
    - `fd`: An open file descriptor positioned at the start of the checkpoint. Must be a non-negative integer.
    - `rbuf`: A pointer to a memory region used for read buffering. Must not be null.
    - `rbuf_sz`: The size of the read buffer. Must be at least `FD_RESTORE_RBUF_MIN`.
- **Output**: Returns a pointer to a `fd_restore_t` structure on success, or NULL on failure.
- **See Also**: [`fd_restore_init_stream`](<fd_restore.c.md#fd_restore_init_stream>)  (Implementation)


---
### fd\_restore\_init\_mmio<!-- {{#callable_declaration:fd_restore_init_mmio}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L456>)

Initializes a memory-mapped I/O restore operation.
- **Description**: Use this function to initialize a restore operation from a memory-mapped I/O region. It prepares the memory region for restoring data from a checkpoint. Ensure that the memory region is properly aligned and that the size of the memory-mapped I/O region does not exceed the maximum allowable size. This function must be called before any restore operations are performed. If the initialization fails, it logs a warning and returns NULL.
- **Inputs**:
    - `mem`: A pointer to a memory region where the restore operation will be initialized. Must not be null and must be aligned according to `FD_RESTORE_ALIGN`. The caller retains ownership.
    - `mmio`: A pointer to the memory-mapped I/O region from which data will be restored. Can be null if `mmio_sz` is zero. The caller retains ownership.
    - `mmio_sz`: The size of the memory-mapped I/O region in bytes. Must not exceed `LONG_MAX`. If `mmio` is null, `mmio_sz` must be zero.
- **Output**: Returns a pointer to an initialized `fd_restore_t` structure on success, or NULL on failure.
- **See Also**: [`fd_restore_init_mmio`](<fd_restore.c.md#fd_restore_init_mmio>)  (Implementation)


---
### fd\_restore\_fini<!-- {{#callable_declaration:fd_restore_fini}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L474>)

Finalizes a restore operation from a checkpoint.
- **Description**: Use this function to complete a restore operation from a checkpoint. It must be called when the restore process is valid and not currently in a frame. This function returns ownership of resources used during the restore process back to the caller. If the restore is invalid or still in a frame, the function will log a warning and return NULL, indicating failure. In such cases, the restore should be considered failed, and any associated resources should be released.
- **Inputs**:
    - `restore`: A pointer to a valid `fd_restore_t` object. It must not be null and should not be in a frame. If invalid or in a frame, the function logs a warning and returns NULL.
- **Output**: Returns a pointer to the memory region used for the restore on success, or NULL on failure.
- **See Also**: [`fd_restore_fini`](<fd_restore.c.md#fd_restore_fini>)  (Implementation)


---
### fd\_restore\_open\_advanced<!-- {{#callable_declaration:fd_restore_open_advanced}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L547>)

Opens a new frame for restoring data from a checkpoint.
- **Description**: Use this function to open a new frame in a checkpoint for restoration. It must be called when the `restore` object is valid and not currently in a frame or failed state. The `frame_style` parameter specifies the style of the frame to read, and it should match the style used when the frame was written. The function will return the offset of the frame from the beginning of the checkpoint in the `_off` parameter. If the function fails, it logs the error and returns a negative error code, leaving `_off` unchanged. The `restore` object should be considered failed if the function returns an error.
- **Inputs**:
    - `restore`: A pointer to a `fd_restore_t` object. It must be valid and not currently in a frame or failed state. The caller retains ownership.
    - `frame_style`: An integer specifying the frame style to read. It should be a valid `FD_CHECKPT_FRAME_STYLE_*` value or 0 to use the default style. The style must match the one used when the frame was written.
    - `_off`: A pointer to an `ulong` where the function will store the offset of the frame from the beginning of the checkpoint. Must not be null. The caller retains ownership.
- **Output**: Returns `FD_CHECKPT_SUCCESS` (0) on success, with `_off` containing the frame offset. On failure, returns a negative error code and leaves `_off` unchanged.
- **See Also**: [`fd_restore_open_advanced`](<fd_restore.c.md#fd_restore_open_advanced>)  (Implementation)


---
### fd\_restore\_close\_advanced<!-- {{#callable_declaration:fd_restore_close_advanced}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L586>)

Closes the current frame in a restore operation.
- **Description**: Use this function to close a frame during a restore operation. It must be called when the restore is valid and currently in a frame. Upon successful execution, it provides the offset of the byte immediately following the closed frame, which helps in determining the byte range used by the frame. If the function fails, it logs the error and returns a negative error code. In such cases, the restore operation should be considered failed, and the user should finalize the restore and close any associated file descriptors.
- **Inputs**:
    - `restore`: A pointer to a valid `fd_restore_t` structure. It must not be null and should be in a frame. If invalid, the function logs an error and returns an error code.
    - `_off`: A pointer to an `ulong` where the function will store the offset of the byte following the closed frame. It must not be null. If invalid, the function logs an error and returns an error code.
- **Output**: Returns `FD_CHECKPT_SUCCESS` (0) on success, or a negative error code on failure. On success, `_off` contains the offset of the byte following the closed frame.
- **See Also**: [`fd_restore_close_advanced`](<fd_restore.c.md#fd_restore_close_advanced>)  (Implementation)


---
### fd\_restore\_seek<!-- {{#callable_declaration:fd_restore_seek}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L616>)

Sets the restore position to a specified offset.
- **Description**: Use this function to set the position of a restore operation to a specific offset within the data. This function is applicable when the restore is valid, openable, and the data source is seekable. It is important to ensure that the offset is within the valid range of the data size. If the restore is in streaming mode, seeking may cause the read-ahead buffer to flush, so minimize seeking operations. On success, the restore is ready to open a frame at the specified offset. On failure, the function logs details and returns an error code, and the restore should be considered failed.
- **Inputs**:
    - `restore`: A pointer to a valid `fd_restore_t` structure. Must not be null and must be openable and seekable. If invalid, the function logs a warning and returns an error.
    - `off`: An unsigned long integer representing the offset to set. Must be within the range [0, sz], where sz is the size of the data. If the offset is out of range, the function logs a warning and returns an error.
- **Output**: Returns an integer status code: `FD_CHECKPT_SUCCESS` (0) on success, or a negative error code on failure. The restore position is updated on success.
- **See Also**: [`fd_restore_seek`](<fd_restore.c.md#fd_restore_seek>)  (Implementation)


---
### fd\_restore\_meta<!-- {{#callable_declaration:fd_restore_meta}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L642>)

Restores metadata from a checkpoint frame.
- **Description**: Use this function to restore a specified number of bytes of metadata from a checkpoint frame into a provided buffer. The function must be called when the restore operation is valid and within an open frame. The size of the data to restore must not exceed `FD_RESTORE_META_MAX`. If the size is zero, the buffer can be null. The function will return an error if the restore operation is not valid, not in a frame, or if the buffer is null with a non-zero size. It will also return an error if the size exceeds the maximum allowed or if an I/O or decompression error occurs.
- **Inputs**:
    - `restore`: A pointer to a valid `fd_restore_t` object. It must not be null and must be in a frame.
    - `buf`: A pointer to the memory region where the restored data will be placed. It can be null if `sz` is zero. The caller retains ownership.
    - `sz`: The number of bytes to restore. It must be less than or equal to `FD_RESTORE_META_MAX`. Zero is allowed.
- **Output**: Returns `FD_CHECKPT_SUCCESS` on success. On failure, returns a negative error code and logs details.
- **See Also**: [`fd_restore_meta`](<fd_restore.c.md#fd_restore_meta>)  (Implementation)


---
### fd\_restore\_data<!-- {{#callable_declaration:fd_restore_data}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L676>)

Restores data from a checkpoint frame to a specified buffer.
- **Description**: Use this function to restore a specified number of bytes from a checkpoint frame into a provided buffer. Ensure that the `restore` object is valid and currently in a frame before calling this function. The function requires that the buffer remains valid and unchanged until the frame is closed, as the restored data may not be immediately available. This function is part of a sequence that must match the checkpoint creation sequence exactly, including opening and closing frames.
- **Inputs**:
    - `restore`: A pointer to a valid `fd_restore_t` object that is currently in a frame. Must not be null.
    - `buf`: A pointer to the memory region where the restored data will be written. Must not be null if `sz` is non-zero.
    - `sz`: The number of bytes to restore. There is no practical limit on this value, and it can be zero, in which case `buf` can be null.
- **Output**: Returns `FD_CHECKPT_SUCCESS` (0) on success. On failure, returns a negative `FD_CHECKPT_ERR` code and logs details. The function retains an interest in `buf` until the frame is closed.
- **See Also**: [`fd_restore_data`](<fd_restore.c.md#fd_restore_data>)  (Implementation)


---
### fd\_checkpt\_frame\_style\_is\_supported<!-- {{#callable_declaration:fd_checkpt_frame_style_is_supported}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L686>)

Checks if a frame style is supported.
- **Description**: Use this function to determine if a specific frame style is supported on the current target. This is useful when working with different frame styles in checkpoint operations, as not all styles may be available depending on the target configuration. The function returns a non-zero value if the frame style is supported and zero if it is not. Ensure that the frame style provided is a valid `FD_CHECKPT_FRAME_STYLE_*` constant.
- **Inputs**:
    - `frame_style`: Specifies the frame style to check. Must be a valid `FD_CHECKPT_FRAME_STYLE_*` constant. Invalid values will result in a return value of zero, indicating the style is not supported.
- **Output**: Returns a non-zero value if the frame style is supported, otherwise returns zero.
- **See Also**: [`fd_checkpt_frame_style_is_supported`](<fd_checkpt.c.md#fd_checkpt_frame_style_is_supported>)  (Implementation)


---
### fd\_checkpt\_strerror<!-- {{#callable_declaration:fd_checkpt_strerror}} -->
[View Source →](<../../../../../src/util/checkpt/fd_checkpt.h#L693>)

Converts an error code to a human-readable string.
- **Description**: Use this function to obtain a descriptive string for a given error code returned by various checkpoint APIs. This is useful for logging or displaying error messages to users. The function accepts an error code and returns a constant string that describes the error. It handles known error codes and returns "unknown" for any unrecognized codes. The returned string is always valid and does not require memory management by the caller.
- **Inputs**:
    - `err`: An integer representing the error code. Valid values include `FD_CHECKPT_SUCCESS`, `FD_CHECKPT_ERR_INVAL`, `FD_CHECKPT_ERR_UNSUP`, `FD_CHECKPT_ERR_IO`, and `FD_CHECKPT_ERR_COMP`. Any other value will result in the return of "unknown".
- **Output**: A constant character pointer to a string describing the error. The string is always non-null and has an infinite lifetime.
- **See Also**: [`fd_checkpt_strerror`](<fd_checkpt.c.md#fd_checkpt_strerror>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)