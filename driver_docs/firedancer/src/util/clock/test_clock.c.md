<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the `fd_clock` module, including calibration, error handling, and performance statistics.

# Purpose
The code is a C program designed to test and validate the functionality of a clock synchronization system. It includes various components for initializing, calibrating, and measuring the performance of clock synchronization between two different clock sources. The program uses static assertions to verify the alignment and footprint of shared memory structures related to the clock. It also defines functions to simulate erroneous clock readings and uses these to test error handling in the clock synchronization process.

The main function initializes the environment and parses command-line arguments to configure the clock synchronization parameters. It performs initial calibration and tests the creation and joining of clock instances. The program then enters a loop to perform measurements and collect statistics on synchronization errors and the computational cost of clock operations. It logs these statistics periodically and recalibrates the clock as needed. The program concludes by cleaning up resources and logging the results of the tests. This code is intended to be executed as a standalone program and does not define public APIs or external interfaces for use by other modules.
# Imports and Dependencies

---
- `../fd_util.h`
- `math.h`
- `fd_clock.h`


# Global Variables

---
### shmem
- **Type**: ``fd_clock_shmem_t[1]``
- **Description**: An array of one `fd_clock_shmem_t` structure, which is a static global variable. This structure is used to manage shared memory for clock operations.
- **Use**: Used to store shared memory data for clock operations, particularly in the `fd_clock_new` and `fd_clock_delete` functions.


---
### lmem
- **Type**: ``fd_clock_t` array`
- **Description**: The `lmem` variable is a static array of type `fd_clock_t` with a single element. It is used to store clock-related data in the program.
- **Use**: Used to join and manage clock data in the program.


# Functions

---
### bad\_clock\_x<!-- {{#callable:bad_clock_x}} -->
[View Source →](<../../../../../src/util/clock/test_clock.c#L18>)

Returns the negated result of the `_fd_tickcount` function applied to the input pointer.
- **Inputs**:
    - `_`: A pointer to a constant void type, which is passed to the `_fd_tickcount` function.
- **Logic and Control Flow**:
    - Calls the `_fd_tickcount` function with the input pointer `_`.
    - Negates the result of the `_fd_tickcount` function call.
    - Returns the negated result.
- **Output**: A long integer representing the negated tick count obtained from the `_fd_tickcount` function.


---
### bad\_clock\_y<!-- {{#callable:bad_clock_y}} -->
[View Source →](<../../../../../src/util/clock/test_clock.c#L19>)

Returns the negated result of the `fd_log_wallclock_host` function.
- **Inputs**:
    - `_`: A pointer to a constant void type, which is passed to the `fd_log_wallclock_host` function.
- **Logic and Control Flow**:
    - Calls the `fd_log_wallclock_host` function with the input argument `_`.
    - Negates the result of the `fd_log_wallclock_host` function call.
    - Returns the negated result.
- **Output**: A long integer representing the negated result of the `fd_log_wallclock_host` function.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/clock/test_clock.c#L21>)

Initializes and tests clock synchronization and calibration using various parameters and logs performance statistics.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Initializes a random number generator `rng`.
    - Parses command-line arguments to set calibration and timing parameters such as `recal_avg`, `recal_jit`, `recal_hist`, `recal_frac`, `tau_meas`, `tau_stat`, and `tau_run`.
    - Logs the initial test parameters.
    - Tests the [`fd_clock_joint_read`](<fd_clock.c.md#fd_clock_joint_read>) function with invalid and valid clock functions to ensure error handling and proper initialization.
    - Performs initial calibration by reading joint clock values and logs the results.
    - Creates and joins a shared memory clock using [`fd_clock_new`](<fd_clock.c.md#fd_clock_new>) and [`fd_clock_join`](<fd_clock.c.md#fd_clock_join>), and verifies the clock's parameters.
    - Runs a loop to measure and log clock synchronization errors and performance statistics, adjusting for overhead and recalibrating as needed.
    - Logs statistics periodically based on the elapsed time and recalibrates the clock when necessary.
    - Tests advanced API functions like [`fd_clock_epoch_init`](<fd_clock.h.md#fd_clock_epoch_init>) and [`fd_clock_epoch_y`](<fd_clock.h.md#fd_clock_epoch_y>), and logs their performance.
    - Cleans up resources by leaving and deleting the clock and random number generator, then halts the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_clock_joint_read`](<fd_clock.c.md#fd_clock_joint_read>)
    - [`fd_clock_align`](<fd_clock.c.md#fd_clock_align>)
    - [`fd_clock_footprint`](<fd_clock.c.md#fd_clock_footprint>)
    - [`fd_clock_new`](<fd_clock.c.md#fd_clock_new>)
    - [`fd_clock_join`](<fd_clock.c.md#fd_clock_join>)
    - [`fd_clock_recal_avg`](<fd_clock.h.md#fd_clock_recal_avg>)
    - [`fd_clock_recal_jit`](<fd_clock.h.md#fd_clock_recal_jit>)
    - [`fd_clock_recal_hist`](<fd_clock.h.md#fd_clock_recal_hist>)
    - [`fd_clock_recal_frac`](<fd_clock.h.md#fd_clock_recal_frac>)
    - [`fd_clock_init_x0`](<fd_clock.h.md#fd_clock_init_x0>)
    - [`fd_clock_init_y0`](<fd_clock.h.md#fd_clock_init_y0>)
    - [`fd_clock_init_w`](<fd_clock.h.md#fd_clock_init_w>)
    - [`fd_clock_shclock_const`](<fd_clock.h.md#fd_clock_shclock_const>)
    - [`fd_clock_clock_x`](<fd_clock.h.md#fd_clock_clock_x>)
    - [`fd_clock_args_x`](<fd_clock.h.md#fd_clock_args_x>)
    - [`fd_clock_shclock`](<fd_clock.h.md#fd_clock_shclock>)
    - [`fd_clock_leave`](<fd_clock.c.md#fd_clock_leave>)
    - [`fd_clock_delete`](<fd_clock.c.md#fd_clock_delete>)
    - [`fd_clock_strerror`](<fd_clock.c.md#fd_clock_strerror>)
    - [`fd_clock_now`](<fd_clock.c.md#fd_clock_now>)
    - [`fd_clock_recal_next`](<fd_clock.h.md#fd_clock_recal_next>)
    - [`fd_clock_err_cnt`](<fd_clock.h.md#fd_clock_err_cnt>)
    - [`fd_clock_reset_err_cnt`](<fd_clock.h.md#fd_clock_reset_err_cnt>)
    - [`fd_clock_recal`](<fd_clock.c.md#fd_clock_recal>)
    - [`fd_clock_epoch_init`](<fd_clock.h.md#fd_clock_epoch_init>)
    - [`fd_clock_seq`](<fd_clock.h.md#fd_clock_seq>)
    - [`fd_clock_epoch_x0`](<fd_clock.h.md#fd_clock_epoch_x0>)
    - [`fd_clock_epoch_y0`](<fd_clock.h.md#fd_clock_epoch_y0>)
    - [`fd_clock_epoch_w`](<fd_clock.h.md#fd_clock_epoch_w>)
    - [`fd_clock_epoch_y0_eff`](<fd_clock.h.md#fd_clock_epoch_y0_eff>)
    - [`fd_clock_epoch_m`](<fd_clock.h.md#fd_clock_epoch_m>)
    - [`fd_clock_epoch_y`](<fd_clock.h.md#fd_clock_epoch_y>)
    - [`fd_clock_epoch_refresh`](<fd_clock.h.md#fd_clock_epoch_refresh>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)