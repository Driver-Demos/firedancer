<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests the functionality and safety of the scratch memory allocator in various scenarios.

# Purpose
The code is a C program that tests the functionality of a memory management system, specifically focusing on scratch memory allocation. It includes a [`main`](<#main>) function that initializes a random number generator and sets up memory regions for testing. The program uses conditional compilation to handle different memory allocation strategies, either using stack allocation with `alloca` or static memory allocation. It verifies memory alignment and footprint calculations for both scratch memory and frame memory, ensuring that the memory management system adheres to expected alignment and size constraints.

The program performs a series of tests to validate the behavior of the scratch memory system, including pushing and popping memory frames, allocating and deallocating memory with various alignments and sizes, and checking the safety of memory operations. It uses assertions (`FD_TEST`) to ensure that the memory operations are performed correctly and that the memory regions are properly aligned and managed. The code also includes tests for memory poisoning and access safety using AddressSanitizer (ASAN) when enabled. The program concludes by cleaning up resources and logging a success message if all tests pass.
# Imports and Dependencies

---
- `../fd_util.h`


# Global Variables

---
### uchar
- **Type**: ``uchar``
- **Description**: `uchar` is a typedef for an unsigned character type, typically used to represent small integer values or characters in a range from 0 to 255.
- **Use**: Used to define the type of elements in the `smem` array for memory allocation and alignment purposes.


---
### ulong
- **Type**: ``ulong``
- **Description**: `ulong` is a static global array of unsigned long integers with a size defined by the `DEPTH` macro, which is set to 16. This array is aligned according to the `FD_SCRATCH_FMEM_ALIGN` attribute.
- **Use**: Used to store a fixed number of unsigned long integers for memory management operations in the program.


---
### \_fmem
- **Type**: ``void *``
- **Description**: A pointer to a memory location, used to store the address of the `fmem` array.
- **Use**: Used to store the address of the `fmem` array when detaching scratch memory.


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/scratch/test_scratch.c#L11>)

Initializes and tests a scratch memory allocator with various alignment and size configurations, ensuring correct memory management and alignment.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Initializes a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Allocates memory for scratch memory (`smem`) and frame memory (`fmem`) using `fd_alloca` and `fd_alloca_check` if `FD_HAS_ALLOCA` is defined.
    - Performs alignment and footprint checks on scratch memory and frame memory using `FD_TEST`.
    - Attaches the scratch memory and frame memory using `fd_scratch_attach`.
    - Pushes and pops frames to test frame usage and free space using `fd_scratch_push` and `fd_scratch_pop`.
    - Allocates memory with various alignments and sizes using `fd_scratch_alloc`, `fd_scratch_prepare`, `fd_scratch_publish`, and `fd_scratch_trim`.
    - Performs memory access tests to ensure memory is correctly allocated and aligned, using `FD_TEST` and `fd_asan_test` if `FD_HAS_DEEPASAN` is defined.
    - Resets the scratch memory using `fd_scratch_reset` and tests frame usage within nested scopes using `FD_SCRATCH_SCOPE_BEGIN` and `FD_SCRATCH_SCOPE_END`.
    - Detaches the scratch memory using `fd_scratch_detach` and verifies the detachment.
    - Deletes the random number generator using `fd_rng_delete` and `fd_rng_leave`.
    - Logs a success message and halts the program using `FD_LOG_NOTICE` and `fd_halt`.
- **Output**: Returns 0 to indicate successful execution.



---
Made with ❤️ by [Driver](https://www.driver.ai/)