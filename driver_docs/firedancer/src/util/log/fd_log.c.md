<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implementation of a logging system with support for application and thread identification, wallclock management, and signal handling, including features for log deduplication, colorization, and backtrace integration.

# Purpose
The code is a C source file that implements a logging system for applications. It provides functionality to manage and record log messages with various levels of severity, such as debug, info, warning, and error. The logging system is designed to work in both single-threaded and multi-threaded environments, with support for deduplication of log messages to avoid repetitive entries. It also includes mechanisms to handle signals and generate backtraces for debugging purposes.

The file defines several components, including functions to set and retrieve application, thread, host, and user identifiers, which are used to tag log messages with contextual information. It also includes functions to manage the logging output, such as setting the log file path, controlling the log levels for different outputs (log file, stderr), and enabling or disabling colorized output. The code handles the initialization and cleanup of the logging system, ensuring that resources are properly managed and that log messages are flushed to the appropriate outputs. Additionally, it provides utilities for formatting timestamps and handling system signals to capture and log unexpected events.
# Imports and Dependencies

---
- `fd_log.h`
- `fd_backtrace.h`
- `stdio.h`
- `stdlib.h`
- `stdarg.h`
- `ctype.h`
- `errno.h`
- `fcntl.h`
- `unistd.h`
- `signal.h`
- `sched.h`
- `time.h`
- `syscall.h`
- `sys/mman.h`
- `execinfo.h`
- `sys/stat.h`
- `../tile/fd_tile_private.h`
- `../../app/fdctl/version.h`
- `sys/resource.h`


# Global Variables

---
### fd\_log\_build\_info
- **Type**: ``char const``
- **Description**: A constant character array that stores build information for the logging system. It is aligned to 1 byte and initialized with a null character.
- **Use**: Used to store and provide build information for logging purposes.


# Functions

---
### fd\_log\_private\_app\_id\_set<!-- {{#callable:fd_log_private_app_id_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L93>)

Sets the private application ID for logging.
- **Inputs**:
    - `app_id`: The application ID to set, of type `ulong`.
- **Logic and Control Flow**:
    - Assigns the value of `app_id` to the static variable `fd_log_private_app_id`.
- **Output**: This function does not return a value.


---
### fd\_log\_app\_id<!-- {{#callable:fd_log_app_id}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L95>)

Returns the application logical ID.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of the static variable `fd_log_private_app_id`.
- **Output**: Returns the value of `fd_log_private_app_id`, which is of type `ulong`.


---
### fd\_log\_private\_app\_set<!-- {{#callable:fd_log_private_app_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L101>)

Sets the application name for logging.
- **Inputs**:
    - `app`: A pointer to a constant character string representing the application name.
- **Logic and Control Flow**:
    - Checks if the input `app` is NULL; if so, assigns it a default value of '[app]'.
    - Compares the input `app` with the current application name stored in `fd_log_private_app`.
    - If the input `app` is different from the current application name, it initializes a new string and appends the new application name to it.
- **Output**: The function does not return a value; it modifies the internal state of the logging system to reflect the new application name.


---
### fd\_log\_app<!-- {{#callable:fd_log_app}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L108>)

Returns a constant pointer to the application log name.
- **Inputs**:
    - `void`: This function does not take any input arguments.
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_app`.
- **Output**: Returns a pointer to a constant string representing the application log name.


---
### fd\_log\_private\_thread\_id\_next<!-- {{#callable:fd_log_private_thread_id_next}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L115>)

Fetches and increments the thread ID counter atomically.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `FD_ATOMIC_FETCH_AND_ADD` with the address of `fd_log_private_thread_id_ctr` and increments it by 1.
- **Output**: Returns the new value of the thread ID counter after incrementing.


---
### fd\_log\_private\_thread\_id\_set<!-- {{#callable:fd_log_private_thread_id_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L124>)

Sets the private thread ID and marks it as initialized.
- **Inputs**:
    - `thread_id`: The thread ID to set, of type `ulong`.
- **Logic and Control Flow**:
    - Assigns the value of `thread_id` to the static variable `fd_log_private_thread_id`.
    - Sets the static variable `fd_log_private_thread_id_init` to 1 to indicate initialization.
- **Output**: No return value; the function modifies internal state.


---
### fd\_log\_thread\_id<!-- {{#callable:fd_log_thread_id}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L130>)

Retrieves the thread ID for logging purposes.
- **Inputs**:
    - `void`: No input arguments.
- **Logic and Control Flow**:
    - Checks if threading is enabled using `FD_HAS_THREADS`.
    - If threading is enabled and the thread ID has not been initialized, it calls [`fd_log_private_thread_id_set`](<#fd_log_private_thread_id_set>) with a new thread ID from `fd_log_private_thread_id_next()`.
    - If threading is not enabled, it calls `FD_COMPILER_MFENCE()` to ensure memory consistency.
    - Returns the current thread ID stored in `fd_log_private_thread_id`.
- **Output**: Returns the current thread ID as an unsigned long.
- **Functions Called**:
    - [`fd_log_private_thread_id_set`](<#fd_log_private_thread_id_set>)
    - [`fd_log_private_thread_id_next`](<#fd_log_private_thread_id_next>)


---
### fd\_log\_private\_thread\_default<!-- {{#callable:fd_log_private_thread_default}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L145>)

Initializes the `name` variable with the current thread ID.
- **Inputs**:
    - `name`: A pointer to a character array where the thread ID will be stored as a string.
- **Logic and Control Flow**:
    - Calls `fd_log_thread_id()` to retrieve the current thread ID.
    - Uses `sprintf` to format the thread ID as a string and store it in the `name` array.
- **Output**: No return value; the function modifies the `name` array in place.
- **Functions Called**:
    - [`fd_log_thread_id`](<#fd_log_thread_id>)


---
### fd\_log\_thread\_set<!-- {{#callable:fd_log_thread_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L153>)

Sets the current thread name for logging.
- **Inputs**:
    - `thread`: A pointer to a string representing the thread name.
- **Logic and Control Flow**:
    - Checks if the `thread` pointer is NULL or points to an empty string.
    - If true, calls [`fd_log_private_thread_default`](<#fd_log_private_thread_default>) to set a default thread name.
    - Sets `fd_log_private_thread_init` to 1 to indicate that the thread name has been initialized.
    - If `thread` is not NULL and not empty, checks if it is different from the current thread name.
    - If different, appends the new thread name to `fd_log_private_thread` and initializes it.
- **Output**: No return value; modifies the internal state to set the thread name.
- **Functions Called**:
    - [`fd_log_private_thread_default`](<#fd_log_private_thread_default>)


---
### fd\_log\_thread<!-- {{#callable:fd_log_thread}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L164>)

Returns the current thread's log name.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if `fd_log_private_thread_init` is false.
    - If false, calls [`fd_log_thread_set`](<#fd_log_thread_set>) with NULL.
    - Returns the value of `fd_log_private_thread`.
- **Output**: A pointer to a constant string representing the current thread's log name.
- **Functions Called**:
    - [`fd_log_thread_set`](<#fd_log_thread_set>)


---
### fd\_log\_private\_host\_id\_set<!-- {{#callable:fd_log_private_host_id_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L176>)

Sets the private host ID for logging.
- **Inputs**:
    - `host_id`: The host ID to be set, of type `ulong`.
- **Logic and Control Flow**:
    - Assigns the value of `host_id` to the static variable `fd_log_private_host_id`.
- **Output**: This function does not return a value.


---
### fd\_log\_host\_id<!-- {{#callable:fd_log_host_id}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L178>)

Returns the current host ID.
- **Inputs**: None
- **Logic and Control Flow**: None
- **Output**: Returns the value of `fd_log_private_host_id`.


---
### fd\_log\_host<!-- {{#callable:fd_log_host}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L184>)

Returns the private host string.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_host`.
- **Output**: A constant string representing the host name.


---
### fd\_log\_private\_host\_set<!-- {{#callable:fd_log_private_host_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L186>)

Sets the private host identifier for logging.
- **Inputs**:
    - `host`: A constant character pointer representing the host name.
- **Logic and Control Flow**:
    - Checks if the input `host` is NULL or an empty string.
    - If `host` is NULL or empty, it assigns `host` to the default value '[host]'.
    - Compares the new `host` with the current private host.
    - If they are different, it finalizes the current host string and appends the new host safely.
- **Output**: No return value; updates the internal state with the new host name.


---
### fd\_log\_private\_cpu\_id\_default<!-- {{#callable:fd_log_private_cpu_id_default}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L197>)

Returns the first CPU ID scheduled to run or `ULONG_MAX` on failure.
- **Inputs**:
    - `void`: No input arguments.
- **Logic and Control Flow**:
    - Declares a CPU set using `FD_CPUSET_DECL`.
    - Calls `fd_cpuset_getaffinity` to get the CPU affinity for the current process.
    - If `fd_cpuset_getaffinity` fails, returns `ULONG_MAX`.
    - Retrieves the first CPU index from the CPU set using `fd_cpuset_first`.
    - Checks if the index is less than `FD_TILE_MAX`, if true, returns the index; otherwise, returns `ULONG_MAX`.
- **Output**: Returns the first CPU ID or `ULONG_MAX` if an error occurs.


---
### fd\_log\_private\_cpu\_id\_set<!-- {{#callable:fd_log_private_cpu_id_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L209>)

Sets the private CPU ID and marks it as initialized.
- **Inputs**:
    - `cpu_id`: The CPU ID to be set, represented as an unsigned long integer.
- **Logic and Control Flow**:
    - Assigns the value of `cpu_id` to the global variable `fd_log_private_cpu_id`.
    - Sets the initialization flag `fd_log_private_cpu_id_init` to 1.
- **Output**: No return value; the function modifies global state.


---
### fd\_log\_cpu\_id<!-- {{#callable:fd_log_cpu_id}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L215>)

Returns the CPU ID for logging purposes.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if `fd_log_private_cpu_id_init` is not initialized.
    - If not initialized, calls [`fd_log_private_cpu_id_set`](<#fd_log_private_cpu_id_set>) with the result of `fd_log_private_cpu_id_default()`.
    - Returns the value of `fd_log_private_cpu_id`.
- **Output**: Returns the current CPU ID as an unsigned long integer.
- **Functions Called**:
    - [`fd_log_private_cpu_id_set`](<#fd_log_private_cpu_id_set>)
    - [`fd_log_private_cpu_id_default`](<#fd_log_private_cpu_id_default>)


---
### fd\_log\_private\_cpu\_default<!-- {{#callable:fd_log_private_cpu_default}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L226>)

Initializes a CPU name based on the current CPU affinity.
- **Inputs**:
    - `name`: A pointer to a character array where the CPU name will be stored.
- **Logic and Control Flow**:
    - Declares a CPU set using `FD_CPUSET_DECL`.
    - Calls `fd_cpuset_getaffinity` to retrieve the CPU affinity for the current process.
    - If an error occurs, formats the error code into the `name` string and returns.
    - Counts the number of CPUs in the set using `fd_cpuset_cnt`.
    - If the count is not in the valid range, formats an error code into the `name` string and returns.
    - Retrieves the index of the first CPU in the set using `fd_cpuset_first`.
    - Formats the CPU index into the `name` string, using a different format if there is more than one CPU.
- **Output**: The function does not return a value but modifies the `name` string to reflect the CPU information.


---
### fd\_log\_cpu\_set<!-- {{#callable:fd_log_cpu_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L243>)

Sets the CPU identifier for logging.
- **Inputs**:
    - `cpu`: A string representing the CPU identifier.
- **Logic and Control Flow**:
    - Checks if the input `cpu` is NULL or an empty string.
    - If `cpu` is NULL or empty, calls [`fd_log_private_cpu_default`](<#fd_log_private_cpu_default>) to set a default CPU identifier.
    - Sets `fd_log_private_cpu_init` to 1 to indicate that the CPU identifier has been initialized.
    - If `cpu` is not equal to the current CPU identifier, appends the new `cpu` identifier to `fd_log_private_cpu`.
- **Output**: No return value; modifies the internal state to reflect the new CPU identifier.
- **Functions Called**:
    - [`fd_log_private_cpu_default`](<#fd_log_private_cpu_default>)


---
### fd\_log\_cpu<!-- {{#callable:fd_log_cpu}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L254>)

Returns the current CPU log identifier.
- **Inputs**:
    - `void`: This function does not take any input arguments.
- **Logic and Control Flow**:
    - Checks if `fd_log_private_cpu_init` is not initialized.
    - If not initialized, calls [`fd_log_cpu_set`](<#fd_log_cpu_set>) with NULL to set a default CPU identifier.
    - Returns the value of `fd_log_private_cpu`.
- **Output**: Returns a constant string representing the current CPU log identifier.
- **Functions Called**:
    - [`fd_log_cpu_set`](<#fd_log_cpu_set>)


---
### fd\_log\_private\_group\_id\_set<!-- {{#callable:fd_log_private_group_id_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L266>)

Sets the private group ID for logging.
- **Inputs**:
    - `group_id`: The group ID to set, of type `ulong`.
- **Logic and Control Flow**:
    - Assigns the value of `group_id` to the static variable `fd_log_private_group_id`.
- **Output**: This function does not return a value.


---
### fd\_log\_group\_id<!-- {{#callable:fd_log_group_id}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L268>)

Returns the current log group ID.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_group_id`.
- **Output**: Returns a `ulong` representing the log group ID.


---
### fd\_log\_group<!-- {{#callable:fd_log_group}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L274>)

Returns the current logging group identifier.
- **Inputs**: None
- **Logic and Control Flow**: None
- **Output**: Returns a pointer to a constant string representing the logging group.


---
### fd\_log\_private\_group\_set<!-- {{#callable:fd_log_private_group_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L276>)

Sets the private logging group name.
- **Inputs**:
    - `group`: A constant character pointer representing the group name to set.
- **Logic and Control Flow**:
    - Checks if the input `group` is NULL or an empty string.
    - If `group` is NULL or empty, it assigns `group` to the default value '[group]'.
    - Compares the new `group` with the current private group name.
    - If they are different, it finalizes the current group string and appends the new group safely.
- **Output**: The function does not return a value. It modifies the internal state to set the logging group name.


---
### fd\_log\_private\_tid\_default<!-- {{#callable:fd_log_private_tid_default}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L285>)

Returns the thread ID or `ULONG_MAX` on failure.
- **Inputs**: None
- **Logic and Control Flow**:
    - Check if the platform is Linux using `#if defined(__linux__)`.
    - If true, retrieve the thread ID using `syscall(SYS_gettid)`.
    - If false, retrieve the process ID using `getpid()`.
    - Return the thread ID if it is greater than 0, otherwise return `ULONG_MAX`.
- **Output**: Returns the thread ID as an `ulong` or `ULONG_MAX` if the retrieval fails.


---
### fd\_log\_private\_tid\_set<!-- {{#callable:fd_log_private_tid_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L298>)

Sets the private thread ID and marks it as initialized.
- **Inputs**:
    - `tid`: The thread ID to set, of type `ulong`.
- **Logic and Control Flow**:
    - Assigns the value of `tid` to the static variable `fd_log_private_tid`.
    - Sets the static variable `fd_log_private_tid_init` to 1 to indicate initialization.
- **Output**: This function does not return a value.


---
### fd\_log\_tid<!-- {{#callable:fd_log_tid}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L304>)

Returns the thread ID, initializing it if necessary.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if `fd_log_private_tid_init` is false, indicating that the thread ID has not been initialized.
    - If not initialized, calls [`fd_log_private_tid_set`](<#fd_log_private_tid_set>) with the result of `fd_log_private_tid_default()` to set the thread ID.
    - Returns the value of `fd_log_private_tid`.
- **Output**: Returns the current thread ID as an unsigned long.
- **Functions Called**:
    - [`fd_log_private_tid_set`](<#fd_log_private_tid_set>)
    - [`fd_log_private_tid_default`](<#fd_log_private_tid_default>)


---
### fd\_log\_private\_user\_id\_default<!-- {{#callable:fd_log_private_user_id_default}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L312>)

Returns the user ID of the calling process.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `getuid()` to retrieve the user ID of the calling process.
    - Casts the result of `getuid()` to `ulong`.
- **Output**: Returns the user ID as an unsigned long integer.


---
### fd\_log\_private\_user\_id\_set<!-- {{#callable:fd_log_private_user_id_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L320>)

Sets the private user ID for logging.
- **Inputs**:
    - `user_id`: The user ID to set, of type `ulong`.
- **Logic and Control Flow**:
    - Assigns the value of `user_id` to the global variable `fd_log_private_user_id`.
    - Sets the initialization flag `fd_log_private_user_id_init` to 1.
- **Output**: No return value; the function modifies global state.


---
### fd\_log\_user\_id<!-- {{#callable:fd_log_user_id}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L326>)

Initializes and returns the user ID.
- **Inputs**:
    - `void`: No input arguments.
- **Logic and Control Flow**:
    - Checks if `fd_log_private_user_id_init` is not set.
    - If not set, calls `fd_log_private_user_id_default()` to initialize `fd_log_private_user_id`.
    - Sets `fd_log_private_user_id_init` to 1.
    - Returns the value of `fd_log_private_user_id`.
- **Output**: Returns the user ID as an unsigned long.
- **Functions Called**:
    - [`fd_log_private_user_id_default`](<#fd_log_private_user_id_default>)


---
### fd\_log\_user<!-- {{#callable:fd_log_user}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L339>)

Returns the current user string.
- **Inputs**:
    - `void`: No input arguments.
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_user`.
- **Output**: Returns a pointer to a constant string representing the user.


---
### fd\_log\_private\_user\_set<!-- {{#callable:fd_log_private_user_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L341>)

Sets the private user identifier for logging.
- **Inputs**:
    - `user`: A constant character pointer representing the user identifier.
- **Logic and Control Flow**:
    - Checks if the `user` pointer is NULL or points to an empty string, and if so, assigns it a default value of '[user]'.
    - Compares the new `user` value with the current private user identifier.
    - If the new `user` is different, it finalizes the current user string and appends the new user safely.
- **Output**: The function does not return a value; it modifies the internal state to set the user identifier for logging.


---
### fd\_log\_group\_id\_query<!-- {{#callable:fd_log_group_id_query}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L348>)

Queries the status of a process group identified by its group ID.
- **Inputs**:
    - `group_id`: The group ID of the process to query.
- **Logic and Control Flow**:
    - Checks if the `group_id` is equal to the current log group ID, returning `FD_LOG_GROUP_ID_QUERY_LIVE` if true.
    - Casts `group_id` to `pid_t` and checks for invalid values, returning `FD_LOG_GROUP_ID_QUERY_INVAL` if invalid.
    - Uses the `kill` function to check if the process with `group_id` is alive, returning `FD_LOG_GROUP_ID_QUERY_LIVE` if it is.
    - Checks the `errno` value to determine if the process does not exist (`ESRCH`) or if permission is denied (`EPERM`), returning the appropriate status.
    - Returns `FD_LOG_GROUP_ID_QUERY_FAIL` for any other errors.
- **Output**: Returns an integer indicating the status of the process group: live, dead, permission denied, invalid, or failure.
- **Functions Called**:
    - [`fd_log_group_id`](<#fd_log_group_id>)


---
### fd\_log\_wallclock\_host<!-- {{#callable:fd_log_wallclock_host}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L361>)

Returns the current wall clock time in nanoseconds.
- **Inputs**:
    - `_`: A pointer to any data, unused in this function.
- **Logic and Control Flow**:
    - The function ignores the input parameter `_`.
    - It creates a `struct timespec` to hold the time.
    - It calls `clock_gettime` with `CLOCK_REALTIME` to get the current time.
    - It calculates the total time in nanoseconds by combining seconds and nanoseconds from `ts`.
- **Output**: Returns the current wall clock time as a `long` value in nanoseconds.


---
### fd\_log\_wallclock<!-- {{#callable:fd_log_wallclock}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L372>)

Returns the current wall clock time using a private clock function.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `fd_log_private_clock_func` with `fd_log_private_clock_args`.
    - Returns the result of the clock function call.
- **Output**: Returns a `long` representing the current wall clock time in nanoseconds.


---
### fd\_log\_wallclock\_set<!-- {{#callable:fd_log_wallclock_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L377>)

Sets the wall clock function and its arguments.
- **Inputs**:
    - `clock`: A function pointer of type `fd_clock_func_t` that defines the clock function to be used.
    - `args`: A pointer to constant data that can be passed to the clock function.
- **Logic and Control Flow**:
    - Assigns the `clock` parameter to the global variable `fd_log_private_clock_func`.
    - Assigns the `args` parameter to the global variable `fd_log_private_clock_args`.
- **Output**: This function does not return a value.


---
### fd\_log\_wallclock\_cstr<!-- {{#callable:fd_log_wallclock_cstr}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L384>)

Formats the current wall clock time into a string representation.
- **Inputs**:
    - `now`: A long integer representing the current time in nanoseconds since the epoch.
    - `buf`: A pointer to a character buffer where the formatted time string will be stored.
- **Logic and Control Flow**:
    - Checks if the input time `now` is close to a reference timestamp.
    - If close, reuses previously calculated date and time values.
    - If not close, calculates the date and time from `now` using `localtime_r`.
    - Handles the case where `localtime_r` fails by formatting the time as a raw UNIX timestamp.
    - Updates reference values for future calls.
    - Formats the date and time into the provided buffer.
- **Output**: Returns a pointer to the buffer containing the formatted time string.


---
### fd\_log\_sleep<!-- {{#callable:fd_log_sleep}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L478>)

Sleeps for a specified duration in nanoseconds.
- **Inputs**:
    - `dt`: The duration to sleep in nanoseconds.
- **Logic and Control Flow**:
    - Check if `dt` is less than 1; if so, yield the processor and return 0.
    - Limit `dt` to a maximum value of `((long)1e9)<<31)-1L`.
    - Calculate seconds and nanoseconds from `ns_dt`.
    - Use `clock_nanosleep` on Linux or `nanosleep` on other systems to sleep.
    - If interrupted by a signal, adjust `dt` with remaining time.
- **Output**: Returns the remaining duration in nanoseconds after sleeping.


---
### fd\_log\_wait\_until<!-- {{#callable:fd_log_wait_until}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L504>)

Waits until the specified time is reached, managing different wait strategies based on the remaining time.
- **Inputs**:
    - `then`: A `long` value representing the target time to wait until, in nanoseconds.
- **Logic and Control Flow**:
    - Enters an infinite loop to repeatedly check the current time against the target time.
    - Calculates the remaining time by subtracting the current time from the target time.
    - If the remaining time is less than or equal to zero, exits the loop.
    - If the remaining time is greater than one second, calls [`fd_log_sleep`](<#fd_log_sleep>) to sleep for a duration slightly less than the remaining time.
    - If the remaining time is greater than 0.1 seconds, yields the processor to allow other threads to run.
    - If the remaining time is greater than one microsecond, performs a spin pause to avoid busy waiting.
    - If the remaining time is less than or equal to one microsecond, continues spinning until the target time is reached.
- **Output**: Returns the current time in nanoseconds when the wait is complete.
- **Functions Called**:
    - [`fd_log_wallclock`](<#fd_log_wallclock>)
    - [`fd_log_sleep`](<#fd_log_sleep>)


---
### fd\_log\_flush<!-- {{#callable:fd_log_flush}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L534>)

Flushes the log file to ensure all buffered data is written.
- **Inputs**: None
- **Logic and Control Flow**:
    - Retrieve the value of `fd_log_private_fileno` using `FD_VOLATILE_CONST`.
    - Check if `log_fileno` is not equal to -1 using `FD_LIKELY`.
    - If the condition is true, call `fsync` with `log_fileno` to flush the log file.
- **Output**: No return value; the function performs a side effect by flushing the log file.


---
### fd\_log\_colorize<!-- {{#callable:fd_log_colorize}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L548>)

Returns the current colorization setting for logging.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function retrieves the value of `fd_log_private_colorize`.
    - It uses `FD_VOLATILE_CONST` to ensure the value is read correctly in a multi-threaded context.
- **Output**: Returns an integer representing the colorization setting.


---
### fd\_log\_level\_logfile<!-- {{#callable:fd_log_level_logfile}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L549>)

Returns the current logging level for the log file.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly accesses the variable `fd_log_private_level_logfile`.
    - It uses `FD_VOLATILE_CONST` to ensure the value is read from memory.
- **Output**: Returns an integer representing the logging level for the log file.


---
### fd\_log\_level\_stderr<!-- {{#callable:fd_log_level_stderr}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L550>)

Returns the current logging level for standard error.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_level_stderr`.
    - The value is wrapped with `FD_VOLATILE_CONST` to ensure it is read as a volatile constant.
- **Output**: The function outputs an integer representing the logging level for standard error.


---
### fd\_log\_level\_flush<!-- {{#callable:fd_log_level_flush}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L551>)

Returns the volatile constant value of the flush log level.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_level_flush` using `FD_VOLATILE_CONST`.
- **Output**: The output is an integer representing the current flush log level.


---
### fd\_log\_level\_core<!-- {{#callable:fd_log_level_core}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L552>)

Returns the current logging level for core logging.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function directly returns the value of `fd_log_private_level_core`.
    - The value is accessed using `FD_VOLATILE_CONST` to ensure it is read correctly in a multi-threaded context.
- **Output**: The output is an integer representing the logging level for core logging.


---
### fd\_log\_colorize\_set<!-- {{#callable:fd_log_colorize_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L554>)

Sets the colorization mode for logging.
- **Inputs**:
    - `mode`: An integer representing the desired colorization mode.
- **Logic and Control Flow**:
    - Assigns the input `mode` to the volatile variable `fd_log_private_colorize`.
- **Output**: No return value; the function modifies the logging colorization setting.


---
### fd\_log\_level\_logfile\_set<!-- {{#callable:fd_log_level_logfile_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L555>)

Sets the logging level for the log file.
- **Inputs**:
    - `level`: An integer representing the desired logging level.
- **Logic and Control Flow**:
    - The function uses `FD_VOLATILE` to ensure that the value of `fd_log_private_level_logfile` is updated atomically.
    - The input `level` is assigned to `fd_log_private_level_logfile`.
- **Output**: The function does not return a value.


---
### fd\_log\_level\_stderr\_set<!-- {{#callable:fd_log_level_stderr_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L556>)

Sets the logging level for standard error output.
- **Inputs**:
    - `level`: An integer representing the logging level to set for standard error.
- **Logic and Control Flow**:
    - The function uses `FD_VOLATILE` to ensure that the assignment to `fd_log_private_level_stderr` is not optimized away by the compiler.
    - The value of `level` is assigned to `fd_log_private_level_stderr`.
- **Output**: No return value; the function modifies the logging level for standard error.


---
### fd\_log\_level\_flush\_set<!-- {{#callable:fd_log_level_flush_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L557>)

Sets the flush log level.
- **Inputs**:
    - `level`: An integer representing the log flush level to set.
- **Logic and Control Flow**:
    - Assigns the value of `level` to `fd_log_private_level_flush` using `FD_VOLATILE` to ensure visibility across threads.
- **Output**: No return value.


---
### fd\_log\_level\_core\_set<!-- {{#callable:fd_log_level_core_set}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L558>)

Sets the core logging level.
- **Inputs**:
    - `level`: An integer representing the desired logging level.
- **Logic and Control Flow**:
    - Assigns the input `level` to the volatile variable `fd_log_private_level_core`.
- **Output**: No return value; the function modifies the logging level directly.


---
### fd\_log\_private\_logfile\_fd<!-- {{#callable:fd_log_private_logfile_fd}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L560>)

Returns the file descriptor for the private log file.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the volatile constant `fd_log_private_fileno` to retrieve the current file descriptor.
- **Output**: Returns an integer representing the file descriptor for the private log file.


---
### fd\_log\_enable\_signal\_handler<!-- {{#callable:fd_log_enable_signal_handler}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L562>)

Enables the signal handler for logging.
- **Inputs**:
    - `void`: This function does not take any input arguments.
- **Logic and Control Flow**:
    - Sets the global variable `fd_log_private_signal_handler` to 1.
- **Output**: This function does not return a value.


---
### fd\_log\_enable\_unclean\_exit<!-- {{#callable:fd_log_enable_unclean_exit}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L563>)

Enables logging for unclean exit scenarios.
- **Inputs**: None
- **Logic and Control Flow**:
    - Sets the global variable `fd_log_private_unclean_exit` to 1.
- **Output**: No return value; the function modifies a global state.


---
### fd\_log\_private\_fprintf\_0<!-- {{#callable:fd_log_private_fprintf_0}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L576>)

Writes formatted log messages to a specified file descriptor.
- **Inputs**:
    - `fd`: An integer representing the file descriptor to which the log message will be written.
    - `fmt`: A format string that specifies how subsequent arguments are converted for output.
- **Logic and Control Flow**:
    - Initializes a variable argument list using `va_start`.
    - Formats the log message into a buffer using `vsnprintf`.
    - Checks the length of the formatted message and adjusts it if necessary.
    - Acquires a shared lock to ensure thread-safe writing to the log.
    - Writes the formatted message to the specified file descriptor using `fd_io_write`.
    - Releases the shared lock after writing.
- **Output**: The function does not return a value. It writes the formatted log message to the specified file descriptor.


---
### fd\_log\_private\_fprintf\_nolock\_0<!-- {{#callable:fd_log_private_fprintf_nolock_0}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L629>)

Writes formatted output to a file descriptor without acquiring a lock.
- **Inputs**:
    - `fd`: An integer representing the file descriptor to which the output will be written.
    - `fmt`: A format string that specifies how subsequent arguments are converted for output.
    - `ap`: A variable-length argument list that contains the values to format according to the format string.
- **Logic and Control Flow**:
    - Initializes a character array `msg` to hold the formatted message.
    - Uses `va_start` to initialize the variable argument list.
    - Calls `vsnprintf` to format the message into `msg` based on the provided format string and arguments.
    - Checks the length of the formatted message and ensures it does not exceed the buffer size.
    - Ends the variable argument list with `va_end`.
    - Calls `fd_io_write` to write the formatted message to the specified file descriptor.
- **Output**: The function does not return a value. It writes the formatted message directly to the specified file descriptor.


---
### fd\_log\_private\_0<!-- {{#callable:fd_log_private_0}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L667>)

Formats a log message using a variable argument list and stores it in a buffer.
- **Inputs**:
    - `fmt`: A format string that specifies how to format the log message.
    - `...`: A variable number of arguments that are used to format the log message.
- **Logic and Control Flow**:
    - Initializes a variable argument list using `va_start`.
    - Calls `vsnprintf` to format the log message into the buffer `fd_log_private_log_msg`.
    - Checks if the length of the formatted message is negative and sets it to zero if true.
    - Checks if the length exceeds the buffer size and adjusts it accordingly.
    - Null-terminates the formatted string in the buffer.
    - Ends the variable argument list using `va_end`.
- **Output**: Returns a pointer to the formatted log message stored in `fd_log_private_log_msg`.


---
### fd\_log\_private\_hexdump\_msg<!-- {{#callable:fd_log_private_hexdump_msg}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L679>)

Generates a hexdump of a memory region with an optional description.
- **Inputs**:
    - `descr`: A string description of the memory region.
    - `mem`: A pointer to the memory region to be dumped.
    - `sz`: The size in bytes of the memory region.
- **Logic and Control Flow**:
    - Defines constants for formatting the hexdump output.
    - Checks if `descr` is NULL or exceeds the maximum length, and formats the header accordingly.
    - Handles the case where `sz` is zero by returning early.
    - Checks if `mem` is NULL and logs a message indicating unreadable memory.
    - Iterates over the memory region, formatting each byte as hexadecimal and building an ASCII representation.
    - Handles the case where the number of bytes printed is less than `sz`, logging the omitted bytes.
- **Output**: Returns a pointer to the log buffer containing the hexdump.


---
### fd\_log\_private\_1<!-- {{#callable:fd_log_private_1}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L763>)

Logs a message with a specified severity level, timestamp, and context information.
- **Inputs**:
    - `level`: An integer representing the severity level of the log message.
    - `now`: A long integer representing the current timestamp in nanoseconds.
    - `file`: A string representing the name of the source file where the log is generated.
    - `line`: An integer representing the line number in the source file.
    - `func`: A string representing the name of the function where the log is generated.
    - `msg`: A string containing the log message to be recorded.
- **Logic and Control Flow**:
    - Checks if the log level is below the configured threshold for logging to a file.
    - Initializes thread and CPU information for logging.
    - Determines if logging should occur to a file or standard error based on the log level.
    - If deduplication is enabled, checks if the current message is a duplicate of the previous message.
    - Logs a message if it is not a duplicate or if the deduplication threshold is exceeded.
    - Formats the log message with the current timestamp, severity level, and context information.
    - Writes the log message to the appropriate output (log file or standard error).
    - Flushes the log if the log level requires it.
- **Output**: No return value; the function writes log messages to the specified output.
- **Functions Called**:
    - [`fd_log_level_logfile`](<#fd_log_level_logfile>)
    - [`fd_log_thread`](<#fd_log_thread>)
    - [`fd_log_cpu`](<#fd_log_cpu>)
    - [`fd_log_tid`](<#fd_log_tid>)
    - [`fd_log_level_stderr`](<#fd_log_level_stderr>)
    - [`fd_log_wallclock_cstr`](<#fd_log_wallclock_cstr>)
    - [`fd_log_private_fprintf_0`](<#fd_log_private_fprintf_0>)
    - [`fd_log_group_id`](<#fd_log_group_id>)
    - [`fd_log_user`](<#fd_log_user>)
    - [`fd_log_host`](<#fd_log_host>)
    - [`fd_log_app`](<#fd_log_app>)
    - [`fd_log_group`](<#fd_log_group>)
    - [`fd_log_level_flush`](<#fd_log_level_flush>)
    - [`fd_log_flush`](<#fd_log_flush>)


---
### fd\_log\_private\_2<!-- {{#callable:fd_log_private_2}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L915>)

Logs a message and handles program termination based on the log level.
- **Inputs**:
    - `level`: An integer representing the log level of the message.
    - `now`: A long integer representing the current time.
    - `file`: A string representing the source file name.
    - `line`: An integer representing the line number in the source file.
    - `func`: A string representing the function name.
    - `msg`: A string containing the log message.
- **Logic and Control Flow**:
    - Calls [`fd_log_private_1`](<#fd_log_private_1>) to log the message.
    - Checks if the log level is less than the core log level.
    - If on Linux and `fd_log_private_unclean_exit` is set, calls `syscall` to exit the group.
    - Exits the program with status 1 if the log level is less than the core level.
    - Calls `abort` to terminate the program if the log level is not less than the core level.
- **Output**: The function does not return a value; it either exits the program or aborts it.
- **Functions Called**:
    - [`fd_log_private_1`](<#fd_log_private_1>)
    - [`fd_log_level_core`](<#fd_log_level_core>)


---
### fd\_log\_private\_raw\_2<!-- {{#callable:fd_log_private_raw_2}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L936>)

Logs a message to standard error and terminates the program.
- **Inputs**:
    - `file`: The name of the source file where the log is generated.
    - `line`: The line number in the source file where the log is generated.
    - `func`: The name of the function where the log is generated.
    - `msg`: The message to log.
- **Logic and Control Flow**:
    - Calls [`fd_log_private_fprintf_nolock_0`](<#fd_log_private_fprintf_nolock_0>) to format and print the log message to standard error.
    - If the platform is Linux, it invokes `syscall` with `SYS_exit_group` to terminate the process.
    - On other platforms, it calls `exit(1)` to terminate the process.
    - Finally, it calls `abort()` to ensure the program terminates.
- **Output**: No return value; the function terminates the program after logging.
- **Functions Called**:
    - [`fd_log_private_fprintf_nolock_0`](<#fd_log_private_fprintf_nolock_0>)


---
### fd\_log\_private\_cleanup<!-- {{#callable:fd_log_private_cleanup}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L952>)

Cleans up logging resources before program termination.
- **Inputs**: None
- **Logic and Control Flow**:
    - Uses `FD_ONCE_BEGIN` and `FD_ONCE_END` to ensure cleanup runs only once.
    - Checks the value of `fd_log_private_fileno` to determine if logging is active.
    - If logging is inactive, prints 'No log' to `STDERR_FILENO`.
    - If logging to stdout, prints 'Log to stdout' to `STDERR_FILENO`.
    - If logging is active, checks for concurrent log users and manages cleanup accordingly.
    - Uses `usleep` to allow concurrent log operations to complete before closing the log file.
    - Calls `fsync` and `sync` to flush log data to disk.
    - Prints the log path to `STDERR_FILENO`.
- **Output**: No return value; performs cleanup actions and prints status messages.
- **Functions Called**:
    - [`fd_log_private_fprintf_0`](<#fd_log_private_fprintf_0>)


---
### fd\_log\_private\_sig\_abort<!-- {{#callable:fd_log_private_sig_abort}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1008>)

Handles the logging of abort signals.
- **Inputs**:
    - `sig`: An integer representing the signal number.
    - `info`: A pointer to a `siginfo_t` structure containing information about the signal.
    - `context`: A pointer to a context structure containing information about the state of the process.
- **Logic and Control Flow**:
    - The function ignores the input parameters `sig`, `info`, and `context`.
    - A dummy lock variable is created to prevent re-entrancy issues when logging.
    - A logging macro is defined to log the received signal using `fd_log_private_1`.
    - If backtrace support is enabled, a backtrace is captured and logged.
    - The function returns without performing any further actions.
- **Output**: No return value; logs the received signal and backtrace if applicable.
- **Functions Called**:
    - [`fd_backtrace_log`](<fd_backtrace.c.md#fd_backtrace_log>)


---
### fd\_log\_private\_sig\_trap<!-- {{#callable:fd_log_private_sig_trap}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1040>)

Sets a signal handler for a specified signal.
- **Inputs**:
    - `sig`: An integer representing the signal number to be handled.
- **Logic and Control Flow**:
    - Creates a `sigaction` structure to define the new signal handler.
    - Sets the signal handler to `fd_log_private_sig_abort`.
    - Initializes the signal mask to empty using `sigemptyset`.
    - Sets the flags for the signal action to `SA_SIGINFO` and `SA_RESETHAND`.
    - Calls `sigaction` to apply the new signal handler and checks for errors.
- **Output**: The function does not return a value but configures the signal handling for the specified signal.


---
### fd\_log\_private\_open\_path<!-- {{#callable:fd_log_private_open_path}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1051>)

Opens a log file at a specified path or uses a default path if none is provided.
- **Inputs**:
    - `cmdline`: An integer indicating if the function is called from the command line.
    - `log_path`: A string representing the path where the log file should be created.
- **Logic and Control Flow**:
    - Calculates the size of the log path string.
    - If the log path is empty, generates a default log path using the current wall clock time.
    - If the log path is specified but empty, disables logging.
    - If the log path exceeds the maximum allowed size, logs an error and exits.
    - Attempts to open the log file with write and append permissions.
    - If opening the log file fails, logs an error and exits.
    - Returns the file descriptor of the opened log file.
- **Output**: Returns the file descriptor of the opened log file, or -1 if logging is disabled.
- **Functions Called**:
    - [`fd_log_wallclock_cstr`](<#fd_log_wallclock_cstr>)
    - [`fd_log_wallclock`](<#fd_log_wallclock>)
    - [`fd_log_group_id`](<#fd_log_group_id>)
    - [`fd_log_user`](<#fd_log_user>)
    - [`fd_log_host`](<#fd_log_host>)
    - [`fd_log_private_fprintf_0`](<#fd_log_private_fprintf_0>)


---
### fd\_log\_private\_boot<!-- {{#callable:fd_log_private_boot}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1090>)

Initializes logging parameters and configurations.
- **Inputs**:
    - `pargc`: Pointer to an integer representing the argument count.
    - `pargv`: Pointer to an array of strings representing the command line arguments.
- **Logic and Control Flow**:
    - Sets up a shared lock for logging.
    - Initializes application logical IDs from command line arguments.
    - Sets thread and host IDs, ignoring user-specified values in favor of actual OS-assigned values.
    - Configures logging options such as deduplication, colorization, and log levels.
    - Hooks up signal handlers for various signals.
    - Opens the log file and sets up cleanup on exit.
    - Logs the boot success message and configuration details.
- **Output**: No return value; the function configures the logging system.
- **Functions Called**:
    - [`fd_log_private_app_id_set`](<#fd_log_private_app_id_set>)
    - [`fd_log_private_app_set`](<#fd_log_private_app_set>)
    - [`fd_log_private_thread_id_next`](<#fd_log_private_thread_id_next>)
    - [`fd_log_private_thread_id_set`](<#fd_log_private_thread_id_set>)
    - [`fd_log_thread_set`](<#fd_log_thread_set>)
    - [`fd_log_private_host_id_set`](<#fd_log_private_host_id_set>)
    - [`fd_log_private_host_set`](<#fd_log_private_host_set>)
    - [`fd_log_private_cpu_id_set`](<#fd_log_private_cpu_id_set>)
    - [`fd_log_private_cpu_id_default`](<#fd_log_private_cpu_id_default>)
    - [`fd_log_cpu_set`](<#fd_log_cpu_set>)
    - [`fd_log_private_group_id_set`](<#fd_log_private_group_id_set>)
    - [`fd_log_private_group_set`](<#fd_log_private_group_set>)
    - [`fd_log_private_tid_set`](<#fd_log_private_tid_set>)
    - [`fd_log_private_tid_default`](<#fd_log_private_tid_default>)
    - [`fd_log_private_user_id_set`](<#fd_log_private_user_id_set>)
    - [`fd_log_private_user_id_default`](<#fd_log_private_user_id_default>)
    - [`fd_log_private_user_set`](<#fd_log_private_user_set>)
    - [`fd_log_colorize_set`](<#fd_log_colorize_set>)
    - [`fd_log_level_logfile_set`](<#fd_log_level_logfile_set>)
    - [`fd_log_level_stderr_set`](<#fd_log_level_stderr_set>)
    - [`fd_log_level_flush_set`](<#fd_log_level_flush_set>)
    - [`fd_log_level_core_set`](<#fd_log_level_core_set>)
    - [`fd_log_private_sig_trap`](<#fd_log_private_sig_trap>)
    - [`fd_log_private_open_path`](<#fd_log_private_open_path>)
    - [`fd_log_private_fprintf_0`](<#fd_log_private_fprintf_0>)
    - [`fd_log_colorize`](<#fd_log_colorize>)
    - [`fd_log_level_logfile`](<#fd_log_level_logfile>)
    - [`fd_log_level_stderr`](<#fd_log_level_stderr>)
    - [`fd_log_level_flush`](<#fd_log_level_flush>)
    - [`fd_log_level_core`](<#fd_log_level_core>)
    - [`fd_log_app_id`](<#fd_log_app_id>)
    - [`fd_log_app`](<#fd_log_app>)
    - [`fd_log_thread_id`](<#fd_log_thread_id>)
    - [`fd_log_thread`](<#fd_log_thread>)
    - [`fd_log_host_id`](<#fd_log_host_id>)
    - [`fd_log_host`](<#fd_log_host>)
    - [`fd_log_cpu_id`](<#fd_log_cpu_id>)
    - [`fd_log_cpu`](<#fd_log_cpu>)
    - [`fd_log_group_id`](<#fd_log_group_id>)
    - [`fd_log_group`](<#fd_log_group>)
    - [`fd_log_tid`](<#fd_log_tid>)
    - [`fd_log_user_id`](<#fd_log_user_id>)
    - [`fd_log_user`](<#fd_log_user>)


---
### fd\_log\_private\_boot\_custom<!-- {{#callable:fd_log_private_boot_custom}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1265>)

Initializes logging parameters for the application.
- **Inputs**:
    - `lock`: Pointer to an integer used for shared locking.
    - `app_id`: Application identifier.
    - `app`: Name of the application.
    - `thread_id`: Identifier for the thread.
    - `thread`: Name of the thread.
    - `host_id`: Identifier for the host.
    - `host`: Name of the host.
    - `cpu_id`: Identifier for the CPU.
    - `cpu`: Name of the CPU.
    - `group_id`: Identifier for the group.
    - `group`: Name of the group.
    - `tid`: Thread identifier.
    - `user_id`: Identifier for the user.
    - `user`: Name of the user.
    - `dedup`: Flag to enable or disable log deduplication.
    - `colorize`: Flag to enable or disable colorized logging.
    - `level_logfile`: Log level for the log file.
    - `level_stderr`: Log level for standard error.
    - `level_flush`: Log level for flushing logs.
    - `level_core`: Log level for core dumps.
    - `log_fd`: File descriptor for the log.
    - `log_path`: Path for the log file.
- **Logic and Control Flow**:
    - Sets the shared lock to the provided `lock`.
    - Initializes application, thread, host, CPU, group, and user identifiers using respective setter functions.
    - Sets logging parameters such as deduplication, colorization, and log levels.
    - Checks if a valid log file descriptor is provided; if so, it uses it directly, otherwise opens a log file at the specified path.
    - If signal handling is enabled, sets up signal traps for various signals to handle logging on signal receipt.
    - Logs the boot information and configuration settings.
- **Output**: No return value; the function configures logging settings and initializes logging.
- **Functions Called**:
    - [`fd_log_private_app_id_set`](<#fd_log_private_app_id_set>)
    - [`fd_log_private_app_set`](<#fd_log_private_app_set>)
    - [`fd_log_private_thread_id_set`](<#fd_log_private_thread_id_set>)
    - [`fd_log_thread_set`](<#fd_log_thread_set>)
    - [`fd_log_private_host_id_set`](<#fd_log_private_host_id_set>)
    - [`fd_log_private_host_set`](<#fd_log_private_host_set>)
    - [`fd_log_private_cpu_id_set`](<#fd_log_private_cpu_id_set>)
    - [`fd_log_cpu_set`](<#fd_log_cpu_set>)
    - [`fd_log_private_group_id_set`](<#fd_log_private_group_id_set>)
    - [`fd_log_private_group_set`](<#fd_log_private_group_set>)
    - [`fd_log_private_tid_set`](<#fd_log_private_tid_set>)
    - [`fd_log_private_user_id_set`](<#fd_log_private_user_id_set>)
    - [`fd_log_private_user_set`](<#fd_log_private_user_set>)
    - [`fd_log_colorize_set`](<#fd_log_colorize_set>)
    - [`fd_log_level_logfile_set`](<#fd_log_level_logfile_set>)
    - [`fd_log_level_stderr_set`](<#fd_log_level_stderr_set>)
    - [`fd_log_level_flush_set`](<#fd_log_level_flush_set>)
    - [`fd_log_level_core_set`](<#fd_log_level_core_set>)
    - [`fd_log_private_open_path`](<#fd_log_private_open_path>)
    - [`fd_log_private_sig_trap`](<#fd_log_private_sig_trap>)
    - [`fd_log_colorize`](<#fd_log_colorize>)
    - [`fd_log_level_logfile`](<#fd_log_level_logfile>)
    - [`fd_log_level_stderr`](<#fd_log_level_stderr>)
    - [`fd_log_level_flush`](<#fd_log_level_flush>)
    - [`fd_log_level_core`](<#fd_log_level_core>)
    - [`fd_log_app_id`](<#fd_log_app_id>)
    - [`fd_log_app`](<#fd_log_app>)
    - [`fd_log_thread_id`](<#fd_log_thread_id>)
    - [`fd_log_thread`](<#fd_log_thread>)
    - [`fd_log_host_id`](<#fd_log_host_id>)
    - [`fd_log_host`](<#fd_log_host>)
    - [`fd_log_cpu_id`](<#fd_log_cpu_id>)
    - [`fd_log_cpu`](<#fd_log_cpu>)
    - [`fd_log_group_id`](<#fd_log_group_id>)
    - [`fd_log_group`](<#fd_log_group>)
    - [`fd_log_tid`](<#fd_log_tid>)
    - [`fd_log_user_id`](<#fd_log_user_id>)
    - [`fd_log_user`](<#fd_log_user>)


---
### fd\_log\_private\_halt<!-- {{#callable:fd_log_private_halt}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1377>)

Halts the logging system and cleans up resources.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the message 'fd_log: halting'.
    - Calls `fd_log_private_cleanup()` to perform cleanup operations.
    - Sets various private logging variables to their default values.
    - Checks if `fd_log_private_shared_lock` is not equal to `fd_log_private_shared_lock_local`.
    - If true, attempts to unmap `fd_log_private_shared_lock` and logs an error if it fails.
- **Output**: No return value; the function performs cleanup and halts the logging system.
- **Functions Called**:
    - [`fd_log_private_cleanup`](<#fd_log_private_cleanup>)
    - [`fd_log_private_fprintf_0`](<#fd_log_private_fprintf_0>)


---
### fd\_log\_private\_main\_stack\_sz<!-- {{#callable:fd_log_private_main_stack_sz}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1441>)

Returns the current stack size limit for the main thread.
- **Inputs**:
    - `void`: This function does not take any input arguments.
- **Logic and Control Flow**:
    - Calls `getrlimit` to retrieve the current stack size limit.
    - Checks for errors from `getrlimit` and logs a warning if it fails.
    - Validates the retrieved stack size against expected conditions.
    - Logs a warning if the stack size is unexpected.
    - Returns the current stack size limit if all checks pass.
- **Output**: Returns the current stack size limit as an unsigned long integer, or 0 if an error occurs.


---
### fd\_log\_private\_stack\_discover<!-- {{#callable:fd_log_private_stack_discover}} -->
[View Source →](<../../../../../src/util/log/fd_log.c#L1508>)

Discovers the memory region of the caller's stack.
- **Inputs**:
    - `stack_sz`: The expected size of the stack.
    - `_stack0`: Pointer to store the start address of the stack.
    - `_stack1`: Pointer to store the end address of the stack.
- **Logic and Control Flow**:
    - Check if `stack_sz` is zero; if so, set both `_stack0` and `_stack1` to zero and return.
    - Create a local variable to determine the address of the caller's stack.
    - Open the file `/proc/self/maps` to read the memory map of the process.
    - Read the memory map line by line to find the memory region that contains the stack address.
    - If the memory region matches the expected stack size, set `stack0` and `stack1` accordingly.
    - If the memory region size is less than expected and the current thread is the main thread, adjust `stack0` and `stack1` based on the main thread's behavior.
    - Log a warning if the stack size cannot be determined.
- **Output**: Sets the values pointed to by `_stack0` and `_stack1` to the discovered stack addresses.
- **Functions Called**:
    - [`fd_log_group_id`](<#fd_log_group_id>)
    - [`fd_log_tid`](<#fd_log_tid>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)