<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines a seccomp filter policy for sandboxing with architecture-specific checks and syscall rules.

# Purpose
The code is a C header file that defines a seccomp (secure computing mode) filter policy for a sandbox environment. It is generated by a script and should not be edited manually. The file includes necessary headers for working with seccomp and BPF (Berkeley Packet Filter) and defines architecture-specific constants to ensure compatibility with different CPU architectures such as `i386`, `x86_64`, and `aarch64`. If the target architecture is unsupported, the code will produce a compilation error.

The main functionality is provided by the [`populate_sock_filter_policy_test_sandbox`](<#populate_sock_filter_policy_test_sandbox>) function, which initializes a BPF filter array with 15 instructions. These instructions enforce a security policy by checking the architecture and syscall numbers. The filter allows specific syscalls like `SYS_write`, `SYS_fsync`, and `SYS_exit_group`, while any other syscalls result in the process being killed. The function uses `fd_memcpy` to copy the filter instructions to the output buffer, ensuring that the sandbox environment adheres to the defined security constraints.
# Imports and Dependencies

---
- `../../../../src/util/fd_util_base.h`
- `linux/audit.h`
- `linux/capability.h`
- `linux/filter.h`
- `linux/seccomp.h`
- `linux/bpf.h`
- `sys/syscall.h`
- `signal.h`
- `stddef.h`


# Global Variables

---
### sock\_filter\_policy\_test\_sandbox\_instr\_cnt
- **Type**: ``unsigned int``
- **Description**: Defines the number of instructions in the `sock_filter_policy_test_sandbox` filter array.
- **Use**: Used to verify that the output count is sufficient to hold the filter instructions.


# Functions

---
### populate\_sock\_filter\_policy\_test\_sandbox<!-- {{#callable:populate_sock_filter_policy_test_sandbox}} -->
[View Source →](<../../../../../../src/util/sandbox/generated/test_sandbox_seccomp.h#L26>)

Populates a `sock_filter` array with a predefined seccomp filter policy to control system call permissions.
- **Inputs**:
    - `out_cnt`: The number of elements in the `out` array, which must be at least 15.
    - `out`: A pointer to a `sock_filter` array where the function will copy the filter policy.
- **Logic and Control Flow**:
    - Check if `out_cnt` is at least 15 using `FD_TEST` macro.
    - Define a `sock_filter` array `filter` with 15 elements to specify the seccomp filter policy.
    - Load the architecture from `seccomp_data` and compare it with `ARCH_NR`; jump to `RET_KILL_PROCESS` if they do not match.
    - Load the syscall number and check if it matches `SYS_write`, `SYS_fsync`, or `SYS_exit_group`; jump to corresponding labels if matched.
    - For `SYS_write`, load the first syscall argument and check if it is 2 or 3, allowing the syscall if matched, otherwise jump to `RET_KILL_PROCESS`.
    - For `SYS_fsync`, load the first syscall argument and check if it is 3, allowing the syscall if matched, otherwise jump to `RET_KILL_PROCESS`.
    - If none of the conditions are met, jump to `RET_KILL_PROCESS`.
    - Copy the `filter` array to the `out` array using `fd_memcpy`.
- **Output**: The function does not return a value but populates the `out` array with the seccomp filter policy.



---
Made with ❤️ by [Driver](https://www.driver.ai/)