<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Manages CPU configuration, stack allocation, and thread management for tile-based parallel processing.

# Purpose
The code is a C++ source file that provides functionality for managing and executing tasks on a multi-threaded system, specifically using a concept of "tiles" which are essentially threads or thread groups. The file includes several components that handle CPU configuration, stack management, and task execution for these tiles. It defines structures and functions to configure CPU priorities, create and manage stacks with memory optimizations, and execute tasks on specific CPUs or in a floating manner. The code also includes mechanisms to handle thread affinity and priority settings, ensuring that tasks are executed with optimal performance.

The file defines a public API for booting and halting the tile system, parsing CPU configurations, and managing task execution. It includes functions like [`fd_tile_private_boot`](<#fd_tile_private_boot>) and [`fd_tile_private_halt`](<#fd_tile_private_halt>) to initialize and shut down the tile system, respectively. The code also provides functions to create and delete execution contexts ([`fd_tile_exec_new`](<#fd_tile_exec_new>) and [`fd_tile_exec_delete`](<#fd_tile_exec_delete>)), allowing tasks to be dispatched to specific tiles. The file is intended to be part of a larger system where it can be included and used to manage multi-threaded task execution efficiently, with a focus on CPU and memory optimization.
# Imports and Dependencies

---
- `ctype.h`
- `errno.h`
- `pthread.h`
- `unistd.h`
- `sched.h`
- `syscall.h`
- `sys/resource.h`
- `sys/mman.h`
- `sys/prctl.h`
- `../sanitize/fd_sanitize.h`
- `fd_tile_private.h`


# Global Variables

---
### fd\_tile\_private\_id0
- **Type**: `ulong`
- **Description**: Zeroed at application start and initialized by the boot manager, this variable is used to store an identifier related to the tile system.
- **Use**: Used to store a unique identifier for a tile, which is accessed by the `fd_tile_id0` function.


---
### fd\_tile\_private\_id1
- **Type**: `ulong`
- **Description**: A static global variable of type `ulong`.
- **Use**: Stores the second identifier for a tile, initialized by the boot manager.


---
### fd\_tile\_private\_cnt
- **Type**: `ulong`
- **Description**: A static global variable of type `ulong`.
- **Use**: Tracks the count of tiles initialized by the boot manager.


---
### fd\_tile\_private\_id
- **Type**: ``FD_TL ulong``
- **Description**: A thread-local unsigned long integer that is zeroed at the start of the application or thread and initialized by the boot or tile manager.
- **Use**: Stores a unique identifier for a tile in a multi-threaded environment.


---
### fd\_tile\_private\_idx
- **Type**: ``FD_TL ulong``
- **Description**: A thread-local unsigned long integer variable.
- **Use**: Stores the index of the current tile in a thread-local context.


---
### fd\_tile\_private\_stack0
- **Type**: `ulong`
- **Description**: A global variable that stores the starting address of a stack for a tile in a multi-threaded environment.
- **Use**: Used to store the base address of a stack allocated for a tile, which is essential for stack management and diagnostics.


---
### fd\_tile\_private\_stack1
- **Type**: `ulong`
- **Description**: `fd_tile_private_stack1` is a global variable of type `ulong` that is used to store the upper boundary address of a stack for a tile in a multi-threaded environment.
- **Use**: Used to track the upper boundary of a stack allocated for a tile, ensuring proper memory management and stack diagnostics.


---
### fd\_tile\_private\_cpu\_id
- **Type**: ``ushort[]``
- **Description**: An array of unsigned short integers with a size defined by `FD_TILE_MAX`. This array is zeroed at application start and initialized by the boot process.
- **Use**: Stores CPU identifiers for each tile, allowing the system to map tiles to specific CPUs.


---
### fd\_tile\_private
- **Type**: ``struct``
- **Description**: The `fd_tile_private` array is a static structure aligned to 128 bytes to minimize false sharing in parallel dispatch. It contains three fields: `lock`, `tile`, and `pthread`. The `lock` field is a pointer to `fd_tile_private_t` and is non-NULL if the tile index is available for dispatch, otherwise it equals the `tile`. The `tile` field is also a pointer to `fd_tile_private_t`, and `pthread` is a `pthread_t` type representing the thread associated with the tile.
- **Use**: Used to manage and dispatch tasks to tiles in a parallel processing environment, ensuring each tile is on its own cache line pair.


---
### fd\_tile\_private\_cpu\_config\_save
- **Type**: ``fd_tile_private_cpu_config_t` array`
- **Description**: An array of `fd_tile_private_cpu_config_t` structures, with a single element, used to store CPU configuration settings.
- **Use**: Used to save the CPU configuration settings for later restoration.


# Data Structures

---
### fd\_tile\_private\_cpu\_config<!-- {{#data_structure:fd_tile_private_cpu_config}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L20>)

- **Type**: ``struct``
- **Members**:
    - ``prio``: Stores the priority level of the CPU configuration.
- **Description**: Represents a configuration for a CPU tile, specifically storing the priority level of the CPU scheduler. This structure is used to manage and save the priority settings of a CPU tile, allowing for adjustments to the scheduler priority based on the tile's operational context.


---
### fd\_tile\_private\_cpu\_config\_t<!-- {{#data_structure:fd_tile_private_cpu_config_t}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L24>)

- **Type**: ``struct``
- **Members**:
    - ``prio``: Stores the priority level of the CPU configuration.
- **Description**: Represents a CPU configuration with a single integer field `prio` to store the priority level. This structure is used to manage and configure the CPU's scheduling priority, particularly in the context of optimizing CPU usage for specific tasks or threads.


---
### fd\_tile\_private<!-- {{#data_structure:fd_tile_private}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L222>)

- **Type**: ``struct``
- **Members**:
    - ``id``: A unique identifier for the tile.
    - ``idx``: The index of the tile.
    - ``state``: The current state of the tile, indicated by `FD_TILE_PRIVATE_STATE_*` constants.
    - ``argc``: The number of arguments for the task.
    - ``argv``: An array of argument strings for the task.
    - ``task``: A function pointer to the task assigned to the tile.
    - ``fail``: A pointer to a string indicating failure reason, if any.
    - ``ret``: The return value of the task.
- **Description**: Represents a private data structure for managing tile-specific information, including identifiers, state, task details, and execution results. It is aligned to 128 bytes to prevent false sharing in cache lines.


---
### fd\_tile\_private\_t<!-- {{#data_structure:fd_tile_private_t}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L233>)

- **Type**: `struct`
- **Members**:
    - ``id``: Stores the unique identifier for the tile.
    - ``idx``: Stores the index of the tile.
    - ``state``: Indicates the current state of the tile, using predefined constants.
    - ``argc``: Holds the count of arguments passed to the tile.
    - ``argv``: Points to the array of argument strings passed to the tile.
    - ``task``: Holds the task function to be executed by the tile.
    - ``fail``: Points to a string describing the failure reason, if any.
    - ``ret``: Stores the return value of the executed task.
- **Description**: Represents a private data structure for managing tile execution, including its state, task, and arguments.


---
### fd\_tile\_private\_manager\_args<!-- {{#data_structure:fd_tile_private_manager_args}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L235>)

- **Type**: ``struct``
- **Members**:
    - ``id``: A unique identifier for the tile manager.
    - ``idx``: The index of the tile manager.
    - ``cpu_idx``: The CPU index where the tile manager runs.
    - ``stack``: A pointer to the stack, NULL if created by pthread, non-NULL if user-created.
    - ``stack_sz``: The size of the stack.
    - ``tile``: A pointer to the `fd_tile_private_t` structure associated with the tile.
- **Description**: Defines the arguments required to manage a tile in a multi-threaded environment, including identifiers, CPU index, stack information, and a pointer to the tile's private data structure.


---
### fd\_tile\_private\_manager\_args\_t<!-- {{#data_structure:fd_tile_private_manager_args_t}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L244>)

- **Type**: ``struct``
- **Members**:
    - ``id``: Stores the unique identifier for the tile.
    - ``idx``: Stores the index of the tile.
    - ``cpu_idx``: Stores the CPU index where the tile is running.
    - ``stack``: Pointer to the stack memory, NULL if created by pthread, non-NULL if user-created.
    - ``stack_sz``: Stores the size of the stack.
    - ``tile``: Pointer to the `fd_tile_private_t` structure representing the tile.
- **Description**: Defines the arguments required to manage a tile in a multi-threaded environment, including identifiers, CPU index, stack information, and a pointer to the tile's private data structure.


# Functions

---
### fd\_tile\_private\_cpu\_config<!-- {{#callable:fd_tile_private_cpu_config}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L28>)

Configures the CPU scheduler priority for a tile based on the given CPU index.
- **Inputs**:
    - ``save``: A pointer to a `fd_tile_private_cpu_config_t` structure where the function will store the configured priority.
    - ``cpu_idx``: An unsigned long integer representing the CPU index for which the configuration is to be applied.
- **Logic and Control Flow**:
    - Check if `cpu_idx` is equal to 65535UL, indicating a floating tile, and set `save->prio` to `INT_MIN` without changing the scheduler priority.
    - If `cpu_idx` is not 65535UL, attempt to get the current scheduler priority using `getpriority` for the current process.
    - If `getpriority` fails, log a warning and set `save->prio` to `INT_MIN`.
    - If the current priority is not -19, attempt to set the scheduler priority to -19 using `setpriority`.
    - If `setpriority` fails, log a warning and set `save->prio` to `INT_MIN`.
    - If successful, store the current priority in `save->prio`.
- **Output**: The function does not return a value but modifies the `save` structure to store the configured priority.


---
### fd\_tile\_private\_cpu\_restore<!-- {{#callable:fd_tile_private_cpu_restore}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L75>)

Restores the CPU priority to a previously saved state.
- **Inputs**:
    - ``save``: A pointer to a `fd_tile_private_cpu_config_t` structure containing the saved CPU priority.
- **Logic and Control Flow**:
    - Retrieve the saved priority from the `save` structure.
    - Check if the saved priority is not `INT_MIN` and not equal to -19.
    - Attempt to set the process priority to the saved priority using `setpriority`.
    - If `setpriority` fails, log a warning message with the error details.
- **Output**: No return value; the function performs an action to restore CPU priority.


---
### fd\_tile\_private\_stack\_new<!-- {{#callable:fd_tile_private_stack_new}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L82>)

Allocates and initializes a stack for a tile, optimized for NUMA and TLB if requested, with guard regions for memory protection.
- **Inputs**:
    - `optimize`: An integer flag indicating whether to optimize the stack for NUMA and TLB.
    - `cpu_idx`: The index of the CPU on which the tile will run, used for optimization if requested.
- **Logic and Control Flow**:
    - Initialize `stack` to `NULL`.
    - If `optimize` is true, attempt to acquire a NUMA and TLB optimized stack using `fd_shmem_acquire` with huge pages.
    - If the optimized stack is acquired, release the first and last huge pages to create guard regions and adjust the stack pointer.
    - If the optimized stack acquisition fails, log a warning and fall back to a normal page-backed stack.
    - If `stack` is still `NULL`, allocate a non-optimized stack using `mmap` with normal pages and create guard regions by unmapping the first and last pages.
    - If `mmap` fails, log a warning and return `NULL`.
    - Create guard regions by mapping the first and last pages of the stack with `PROT_NONE` to prevent access.
    - Return the pointer to the allocated stack.
- **Output**: A pointer to the allocated stack, or `NULL` if stack allocation fails.


---
### fd\_tile\_private\_stack\_delete<!-- {{#callable:fd_tile_private_stack_delete}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L166>)

Releases memory resources associated with a stack by unmapping the stack and its guard regions.
- **Inputs**:
    - `_stack`: A pointer to the stack memory to be deleted.
- **Logic and Control Flow**:
    - Check if `_stack` is null; if so, return immediately.
    - Cast `_stack` to `uchar *` and assign it to `stack`.
    - Calculate `guard_lo` as `stack - FD_SHMEM_NORMAL_PAGE_SZ` and `guard_hi` as `stack + FD_TILE_PRIVATE_STACK_SZ`.
    - Attempt to unmap the memory region at `guard_hi` with size `FD_SHMEM_NORMAL_PAGE_SZ`; log a warning if it fails.
    - Attempt to unmap the memory region at `guard_lo` with size `FD_SHMEM_NORMAL_PAGE_SZ`; log a warning if it fails.
    - Attempt to unmap the memory region at `stack` with size `FD_TILE_PRIVATE_STACK_SZ`; log a warning if it fails.
- **Output**: None (void function).


---
### fd\_tile\_id0<!-- {{#callable:fd_tile_id0}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L193>)

Returns the value of the `fd_tile_private_id0` variable.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the global variable `fd_tile_private_id0`.
    - Returns the value of `fd_tile_private_id0`.
- **Output**: The function returns an `ulong` representing the value of `fd_tile_private_id0`.


---
### fd\_tile\_id1<!-- {{#callable:fd_tile_id1}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L194>)

Returns the value of the private variable `fd_tile_private_id1`.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the private variable `fd_tile_private_id1`.
    - Returns the value of `fd_tile_private_id1`.
- **Output**: The function returns an `ulong` representing the value of `fd_tile_private_id1`.


---
### fd\_tile\_cnt<!-- {{#callable:fd_tile_cnt}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L195>)

Returns the value of the `fd_tile_private_cnt` variable.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the global variable `fd_tile_private_cnt`.
    - Returns the value of `fd_tile_private_cnt`.
- **Output**: The function returns an `ulong` representing the count of tiles.


---
### fd\_tile\_id<!-- {{#callable:fd_tile_id}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L202>)

Returns the value of the `fd_tile_private_id` variable.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the global variable `fd_tile_private_id`.
    - Returns the value of `fd_tile_private_id`.
- **Output**: The function returns an unsigned long integer (`ulong`) representing the current tile ID.


---
### fd\_tile\_idx<!-- {{#callable:fd_tile_idx}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L203>)

Returns the value of the `fd_tile_private_idx` variable.
- **Inputs**: None
- **Logic and Control Flow**:
    - Accesses the global variable `fd_tile_private_idx`.
    - Returns the value of `fd_tile_private_idx`.
- **Output**: The function returns an unsigned long integer (`ulong`) representing the current tile index.


---
### fd\_tile\_cpu\_id<!-- {{#callable:fd_tile_cpu_id}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L207>)

Retrieves the CPU ID associated with a given tile index, or returns a special value if the index is invalid.
- **Inputs**:
    - `tile_idx`: The index of the tile for which to retrieve the CPU ID.
- **Logic and Control Flow**:
    - Checks if `tile_idx` is greater than or equal to `fd_tile_private_cnt`; if true, returns `ULONG_MAX`.
    - Retrieves the CPU ID from the `fd_tile_private_cpu_id` array using `tile_idx`.
    - Uses `fd_ulong_if` to return the CPU ID if it is less than 65535, otherwise returns `ULONG_MAX-1`.
- **Output**: The CPU ID associated with the given tile index, or `ULONG_MAX` if the index is invalid, or `ULONG_MAX-1` if the CPU ID is 65535.


---
### fd\_tile\_private\_manager<!-- {{#callable:fd_tile_private_manager}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L246>)

Manages a tile's lifecycle, including setting CPU affinity, configuring stack, and executing tasks in a loop until halted.
- **Inputs**:
    - `_args`: A pointer to `fd_tile_private_manager_args_t` structure containing tile configuration and state information.
- **Logic and Control Flow**:
    - Cast `_args` to `fd_tile_private_manager_args_t` pointer `args`.
    - If not using GLIBC and `args->cpu_idx` is valid, set CPU affinity for the thread to `args->cpu_idx`.
    - Initialize local variables `id`, `idx`, `stack`, and `stack_sz` from `args`.
    - Set the thread name to `tile:<idx>` using `prctl` and check for errors.
    - Verify thread identifiers match expected values, log error if not.
    - Initialize a `fd_tile_private_t` structure `tile` with initial state `FD_TILE_PRIVATE_STATE_BOOT`.
    - Set global variables `fd_tile_private_id` and `fd_tile_private_idx` to `id` and `idx`.
    - If `stack` is provided, set stack boundaries and use `madvise` to prevent `fork()` from affecting the stack.
    - If `stack` is not provided, discover stack boundaries using `fd_log_private_stack_discover`.
    - Configure CPU settings using [`fd_tile_private_cpu_config`](<#fd_tile_private_cpu_config>).
    - Log successful boot of the tile and set `tile->state` to `FD_TILE_PRIVATE_STATE_IDLE`.
    - Enter an infinite loop to manage tile state transitions and task execution.
    - If `tile->state` is `FD_TILE_PRIVATE_STATE_EXEC`, execute the task and handle exceptions, then set state to `FD_TILE_PRIVATE_STATE_IDLE`.
    - If `tile->state` is not `FD_TILE_PRIVATE_STATE_EXEC` or `FD_TILE_PRIVATE_STATE_IDLE`, break the loop.
    - Log halting of the tile, set `tile->state` to `FD_TILE_PRIVATE_STATE_BOOT`, and return `stack`.
- **Output**: Returns the stack pointer used by the tile.
- **Functions Called**:
    - [`fd_cpuset_setaffinity`](<fd_tile.c.md#fd_cpuset_setaffinity>)
    - [`fd_tile_private_cpu_config`](<#fd_tile_private_cpu_config>)


---
### fd\_tile\_private\_trylock<!-- {{#callable:fd_tile_private_trylock}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L371>)

Attempts to acquire a lock on a tile by performing an atomic compare-and-swap operation.
- **Inputs**:
    - `tile_idx`: The index of the tile to attempt to lock.
- **Logic and Control Flow**:
    - Declare a volatile pointer `vtile` to the lock of the tile at the given `tile_idx`.
    - Retrieve the current value of the tile lock into `tile`.
    - Check if `tile` is non-null and if an atomic compare-and-swap operation on `vtile` with `tile` and `NULL` is successful.
    - If both conditions are true, return `tile`.
    - If any condition fails, return `NULL`.
- **Output**: A pointer to `fd_tile_private_t` if the lock is successfully acquired, otherwise `NULL`.


---
### fd\_tile\_private\_lock<!-- {{#callable:fd_tile_private_lock}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L379>)

Locks a tile by atomically setting its lock to NULL and returns the tile if successful.
- **Inputs**:
    - `tile_idx`: The index of the tile to lock.
- **Logic and Control Flow**:
    - Declare a volatile pointer `vtile` to the lock of the tile at `tile_idx`.
    - Enter an infinite loop to attempt locking the tile.
    - Assign the current value of `vtile` to `tile`.
    - Check if `tile` is not NULL and if an atomic compare-and-swap operation on `vtile` with `tile` and NULL is successful.
    - If both conditions are true, break the loop, indicating the tile is locked.
    - If not, pause the spin loop using `FD_SPIN_PAUSE()`.
- **Output**: Returns a pointer to the locked `fd_tile_private_t` structure.


---
### fd\_tile\_private\_unlock<!-- {{#callable:fd_tile_private_unlock}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L391>)

Sets the lock of a specified tile index to a given tile pointer.
- **Inputs**:
    - `tile_idx`: The index of the tile whose lock is to be set.
    - `tile`: A pointer to the `fd_tile_private_t` structure to set as the lock for the specified tile index.
- **Logic and Control Flow**:
    - Accesses the `lock` field of the `fd_tile_private` array at the specified `tile_idx`.
    - Sets the `lock` field to the provided `tile` pointer.
- **Output**: None (void function).


---
### fd\_tile\_exec\_new<!-- {{#callable:fd_tile_exec_new}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L397>)

Initializes a new tile execution context for a specified tile index, task, and arguments.
- **Inputs**:
    - ``idx``: The index of the tile to execute the task on; must not be the current tile index or zero.
    - ``task``: The task function to execute on the specified tile.
    - ``argc``: The number of arguments to pass to the task function.
    - ``argv``: The array of argument strings to pass to the task function.
- **Logic and Control Flow**:
    - Checks if `idx` is the current tile index or zero; if so, returns `NULL` to prevent dispatching to self or tile 0.
    - Attempts to lock the specified tile using [`fd_tile_private_trylock`](<#fd_tile_private_trylock>); if unsuccessful, returns `NULL`.
    - Sets the tile's `argc`, `argv`, and `task` fields to the provided values using volatile memory operations.
    - Performs a memory fence to ensure memory operations are completed before changing the tile state.
    - Sets the tile's state to `FD_TILE_PRIVATE_STATE_EXEC` to indicate it is ready to execute the task.
    - Returns a pointer to the tile cast as `fd_tile_exec_t *`.
- **Output**: A pointer to the `fd_tile_exec_t` structure representing the tile execution context, or `NULL` if the operation fails.
- **Functions Called**:
    - [`fd_tile_private_trylock`](<#fd_tile_private_trylock>)


---
### fd\_tile\_exec\_delete<!-- {{#callable:fd_tile_exec_delete}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L416>)

Waits for a tile to become idle, retrieves the task result if requested, and releases the lock on the tile.
- **Inputs**:
    - ``exec``: A pointer to `fd_tile_exec_t`, representing the tile execution context to delete.
    - ``opt_ret``: An optional pointer to an integer where the function will store the return code of the executed task if no failure occurred.
- **Logic and Control Flow**:
    - Cast `exec` to a `fd_tile_private_t` pointer and retrieve the tile index.
    - Enter an infinite loop to check the tile's state until it becomes `FD_TILE_PRIVATE_STATE_IDLE`.
    - If the tile's state is idle, exit the loop.
    - Retrieve the failure message from the tile's `fail` field.
    - If there is no failure and `opt_ret` is not null, store the tile's return code in `opt_ret`.
    - Unlock the tile using [`fd_tile_private_unlock`](<#fd_tile_private_unlock>).
- **Output**: Returns a `char const *` pointing to a failure message if the task failed, or `NULL` if the task succeeded.
- **Functions Called**:
    - [`fd_tile_private_unlock`](<#fd_tile_private_unlock>)


---
### fd\_tile\_exec<!-- {{#callable:fd_tile_exec}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L435>)

Returns a pointer to the `fd_tile_exec_t` structure for the specified tile index.
- **Inputs**:
    - `tile_idx`: The index of the tile for which to retrieve the `fd_tile_exec_t` structure.
- **Logic and Control Flow**:
    - Accesses the `fd_tile_private` array using the provided `tile_idx`.
    - Retrieves the `tile` member from the `fd_tile_private` structure at the specified index.
    - Casts the `tile` member to a `fd_tile_exec_t` pointer.
- **Output**: A pointer to the `fd_tile_exec_t` structure associated with the specified tile index.


---
### fd\_tile\_exec\_id<!-- {{#callable:fd_tile_exec_id}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L437>)

Retrieves the `id` field from a `fd_tile_exec_t` object.
- **Inputs**:
    - ``exec``: A pointer to a `fd_tile_exec_t` object, which is expected to be castable to a `fd_tile_private_t` object.
- **Logic and Control Flow**:
    - Cast the `exec` pointer to a `fd_tile_private_t` pointer.
    - Access the `id` field of the `fd_tile_private_t` structure.
    - Return the value of the `id` field.
- **Output**: The function returns an `ulong` representing the `id` of the tile execution context.


---
### fd\_tile\_exec\_idx<!-- {{#callable:fd_tile_exec_idx}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L438>)

Retrieves the index of a tile execution from a given `fd_tile_exec_t` pointer.
- **Inputs**:
    - ``exec``: A pointer to a `fd_tile_exec_t` structure representing a tile execution.
- **Logic and Control Flow**:
    - Casts the `exec` pointer to a `fd_tile_private_t` pointer.
    - Accesses the `idx` member of the `fd_tile_private_t` structure.
    - Returns the value of the `idx` member.
- **Output**: The index of the tile execution as an `ulong`.


---
### fd\_tile\_exec\_task<!-- {{#callable:fd_tile_exec_task}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L439>)

Retrieves the task associated with a given tile execution context.
- **Inputs**:
    - ``exec``: A pointer to a `fd_tile_exec_t` structure representing the tile execution context.
- **Logic and Control Flow**:
    - Casts the `exec` pointer to a `fd_tile_private_t` pointer.
    - Accesses the `task` member of the `fd_tile_private_t` structure.
- **Output**: Returns the `fd_tile_task_t` task associated with the given tile execution context.


---
### fd\_tile\_exec\_argc<!-- {{#callable:fd_tile_exec_argc}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L440>)

Retrieves the argument count (`argc`) from a `fd_tile_exec_t` object.
- **Inputs**:
    - ``exec``: A pointer to a `fd_tile_exec_t` object from which to retrieve the argument count.
- **Logic and Control Flow**:
    - Casts the `exec` pointer to a `fd_tile_private_t` pointer.
    - Accesses the `argc` member of the `fd_tile_private_t` structure.
    - Returns the value of `argc`.
- **Output**: The function returns an integer representing the number of arguments (`argc`) associated with the `fd_tile_exec_t` object.


---
### fd\_tile\_exec\_argv<!-- {{#callable:fd_tile_exec_argv}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L441>)

Returns the `argv` member of the `fd_tile_private_t` structure cast from the input `exec` pointer.
- **Inputs**:
    - ``exec``: A pointer to a `fd_tile_exec_t` structure, which is cast to a `fd_tile_private_t` structure to access its `argv` member.
- **Logic and Control Flow**:
    - Cast the input `exec` pointer to a `fd_tile_private_t` pointer.
    - Access and return the `argv` member of the `fd_tile_private_t` structure.
- **Output**: A pointer to a character array (`char **`), representing the argument vector (`argv`) of the tile execution context.


---
### fd\_tile\_exec\_done<!-- {{#callable:fd_tile_exec_done}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L443>)

Checks if the tile execution state is idle.
- **Inputs**:
    - ``exec``: A pointer to a `fd_tile_exec_t` object representing the tile execution context.
- **Logic and Control Flow**:
    - Cast the `exec` pointer to a `fd_tile_private_t` pointer named `tile`.
    - Retrieve the `state` of the `tile` using `FD_VOLATILE_CONST`.
    - Compare the `state` to `FD_TILE_PRIVATE_STATE_IDLE`.
    - Return `1` if the `state` is `FD_TILE_PRIVATE_STATE_IDLE`, otherwise return `0`.
- **Output**: Returns an integer `1` if the tile is idle, otherwise `0`.


---
### fd\_tile\_private\_cpus\_parse<!-- {{#callable:fd_tile_private_cpus_parse}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L455>)

Parses a string representing CPU tile assignments and populates an array with the corresponding CPU indices for each tile.
- **Inputs**:
    - ``cstr``: A constant character pointer to a string that specifies the CPU tile assignments.
    - ``tile_to_cpu``: A pointer to an array of unsigned short integers where the function will store the CPU indices for each tile.
- **Logic and Control Flow**:
    - Check if `cstr` is null; if so, return 0.
    - Initialize a counter `cnt` to 0 and declare a CPU set `assigned_set`.
    - Iterate over the string `cstr`, skipping whitespace characters.
    - If the character 'f' is encountered, parse the number of floating tiles and assign them a CPU index of 65535, incrementing `cnt` for each.
    - If a digit is encountered, parse the CPU range and stride, and assign the corresponding CPU indices to `tile_to_cpu`, incrementing `cnt` for each.
    - Check for errors such as malformed input, invalid ranges, or repeated CPUs, and log errors if any are found.
    - Continue parsing until the end of the string is reached or an error is encountered.
    - Return the count of CPU indices assigned.
- **Output**: Returns the number of CPU indices assigned, as an unsigned long integer.


---
### fd\_tile\_private\_map\_boot<!-- {{#callable:fd_tile_private_map_boot}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L539>)

Initializes and boots a group of threads (tiles) on specified CPUs, setting up their attributes and stacks, and logging the process.
- **Inputs**:
    - ``tile_to_cpu``: A pointer to an array of `ushort` values that map each tile to a specific CPU.
    - ``tile_cnt``: The number of tiles to boot, represented as an `ulong`.
- **Logic and Control Flow**:
    - Initialize `fd_tile_private_id0`, `fd_tile_private_id1`, and `fd_tile_private_cnt` with the current thread ID and `tile_cnt`.
    - Log the start of the boot process for the thread group.
    - Iterate over tiles from index 1 to `tile_cnt - 1` to set up each tile.
    - For each tile, determine the CPU index and whether it is fixed or floating.
    - Log the booting process for each tile, indicating whether it is fixed or floating.
    - Initialize thread attributes using `pthread_attr_init` and handle errors.
    - If the tile is fixed and the system is GNU, set the thread affinity using `pthread_attr_setaffinity_np` and handle potential errors.
    - Create an optimized or default stack for the tile using [`fd_tile_private_stack_new`](<#fd_tile_private_stack_new>) and set it in the thread attributes.
    - Handle errors in stack creation and setting, logging warnings if necessary.
    - Initialize `fd_tile_private_manager_args_t` with tile-specific data and create the thread using `pthread_create`, handling errors appropriately.
    - Wait for the tile to be ready to execute by polling `args->tile`.
    - Set the tile's lock and tile pointers in `fd_tile_private`.
    - Destroy the thread attributes using `pthread_attr_destroy` and log any errors.
    - Boot tile 0 separately, setting its CPU affinity and logging the process.
    - If tile 0 is fixed, check and set its CPU affinity, logging any warnings.
    - Set up tile 0's thread and stack, logging the success of the boot process.
    - Copy the CPU mapping to `fd_tile_private_cpu_id` and log the overall boot success.
- **Output**: No return value; the function performs initialization and logging as side effects.
- **Functions Called**:
    - [`fd_tile_private_stack_new`](<#fd_tile_private_stack_new>)
    - [`fd_tile_private_stack_delete`](<#fd_tile_private_stack_delete>)
    - [`fd_cpuset_getaffinity`](<fd_tile.c.md#fd_cpuset_getaffinity>)
    - [`fd_cpuset_setaffinity`](<fd_tile.c.md#fd_cpuset_setaffinity>)
    - [`fd_tile_private_cpu_config`](<#fd_tile_private_cpu_config>)


---
### fd\_tile\_private\_boot\_str<!-- {{#callable:fd_tile_private_boot_str}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L743>)

Initializes the tile-to-CPU mapping and boots the tile system based on the provided CPU configuration string.
- **Inputs**:
    - ``cpus``: A string specifying the CPU configuration for the tiles.
- **Logic and Control Flow**:
    - Declare an array `tile_to_cpu` to store the mapping of tiles to CPUs.
    - Call [`fd_tile_private_cpus_parse`](<#fd_tile_private_cpus_parse>) with `cpus` and `tile_to_cpu` to parse the CPU configuration and get the count of tiles (`tile_cnt`).
    - Check if `tile_cnt` is zero, indicating no CPUs were specified; if so, log a message and set `tile_to_cpu[0]` to 65535 and `tile_cnt` to 1.
    - Call [`fd_tile_private_map_boot`](<#fd_tile_private_map_boot>) with `tile_to_cpu` and `tile_cnt` to boot the tile system with the parsed configuration.
- **Output**: No return value; the function performs initialization and logging.
- **Functions Called**:
    - [`fd_tile_private_cpus_parse`](<#fd_tile_private_cpus_parse>)
    - [`fd_tile_private_map_boot`](<#fd_tile_private_map_boot>)


---
### fd\_tile\_private\_boot<!-- {{#callable:fd_tile_private_boot}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L757>)

Extracts the tile configuration from the command line arguments and initializes the tile system with the specified CPU configuration.
- **Inputs**:
    - ``pargc``: A pointer to an integer representing the number of command line arguments.
    - ``pargv``: A pointer to an array of strings representing the command line arguments.
- **Logic and Control Flow**:
    - Call `fd_env_strip_cmdline_cstr` to extract the `--tile-cpus` configuration from the command line arguments or environment variables.
    - Check if `cpus` is `NULL`; if so, log that `--tile-cpus` was not specified.
    - If `cpus` is not `NULL`, log the extracted `--tile-cpus` value.
    - Call [`fd_tile_private_boot_str`](<#fd_tile_private_boot_str>) with the extracted `cpus` string to initialize the tile system.
- **Output**: No return value (void function).
- **Functions Called**:
    - [`fd_tile_private_boot_str`](<#fd_tile_private_boot_str>)


---
### fd\_tile\_private\_halt<!-- {{#callable:fd_tile_private_halt}} -->
[View Source →](<../../../../../src/util/tile/fd_tile_threads.cxx#L770>)

Halts all tiles in a thread group, ensuring all tasks are completed and resources are cleaned up.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the halt process.
    - Resets the `fd_tile_private_cpu_id` array to zero.
    - Stores the current tile count in `tile_cnt`.
    - Locks all tiles except tile 0 to prevent further dispatches.
    - Waits for all tasks on the tiles to complete by checking if their state is `FD_TILE_PRIVATE_STATE_IDLE`.
    - Sets the state of all tiles to `FD_TILE_PRIVATE_STATE_HALT` to signal them to halt.
    - Waits for all tiles to halt by joining their threads and cleaning up their stacks.
    - Restores the CPU configuration to its previous state.
    - Logs the successful halt of tile 0.
    - Cleans up by unlocking all tiles and resetting various private variables to zero.
    - Logs the successful completion of the halt process.
- **Output**: No output is returned.
- **Functions Called**:
    - [`fd_tile_private_lock`](<#fd_tile_private_lock>)
    - [`fd_tile_private_stack_delete`](<#fd_tile_private_stack_delete>)
    - [`fd_tile_private_cpu_restore`](<#fd_tile_private_cpu_restore>)
    - [`fd_tile_private_unlock`](<#fd_tile_private_unlock>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)