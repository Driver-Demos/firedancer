<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for `fd_cpuset_t` compatibility with `cpu_set_t` API, including operations like insert, remove, and set.

# Purpose
The code is a test suite for validating the functionality of `fd_cpuset_t`, a custom data structure intended to replace the standard `cpu_set_t` API. The tests ensure that `fd_cpuset_t` behaves correctly when used in place of `cpu_set_t` in various operations. The code includes functions to convert between `fd_cpuset_t` and `cpu_set_t`, and it tests operations such as zeroing, inserting, removing, and setting CPU indices within these sets. The tests compare the behavior of `fd_cpuset_t` operations with their `cpu_set_t` counterparts to verify compatibility and correctness.

The main function initializes the test environment, including setting up a random number generator, and then executes a series of tests: [`test_cpu_zero`](<#test_cpu_zero>), [`test_cpu_insert`](<#test_cpu_insert>), [`test_cpu_remove`](<#test_cpu_remove>), and [`test_cpu_set`](<#test_cpu_set>). Each test function performs specific operations on `fd_cpuset_t` and `cpu_set_t` instances, checking that the results are consistent between the two types. The code uses assertions to validate the expected outcomes, and it logs a notice if all tests pass successfully. The test suite is designed to ensure that `fd_cpuset_t` can be used interchangeably with `cpu_set_t` in applications that require CPU set manipulations.
# Imports and Dependencies

---
- `../fd_util.h`
- `fd_tile_private.h`
- `sched.h`


# Functions

---
### fd\_cpuset\_from\_libc<!-- {{#callable:fd_cpuset_from_libc}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L12>)

Converts a `cpu_set_t` to a `fd_cpuset_t` by copying its contents.
- **Inputs**:
    - ``out``: A pointer to a `fd_cpuset_t` where the function will store the converted CPU set.
    - ``pun``: A constant pointer to a `cpu_set_t` that contains the CPU set to convert.
- **Logic and Control Flow**:
    - Calls `fd_cpuset_null` to initialize the `out` `fd_cpuset_t` to a null state.
    - Uses `fd_memcpy` to copy the contents of `pun` into `out`, using the size of `cpu_set_t`.
    - Returns the pointer `out`.
- **Output**: A pointer to the `fd_cpuset_t` that now contains the converted CPU set.


---
### fd\_cpuset\_to\_libc<!-- {{#callable:fd_cpuset_to_libc}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L20>)

Converts a `fd_cpuset_t` to a `cpu_set_t` by zeroing the output and copying the input data.
- **Inputs**:
    - `out`: A pointer to a `cpu_set_t` structure where the converted data will be stored.
    - `pun`: A constant pointer to a `fd_cpuset_t` structure that contains the data to be converted.
- **Logic and Control Flow**:
    - Call `CPU_ZERO` to initialize the `out` `cpu_set_t` structure to zero.
    - Use `fd_memcpy` to copy the contents of `pun` into `out`.
    - Return the pointer `out`.
- **Output**: Returns a pointer to the `cpu_set_t` structure that contains the converted data.


---
### test\_cpu\_zero<!-- {{#callable:test_cpu_zero}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L28>)

Tests the zero initialization and zeroing of CPU sets using both `fd_cpuset_t` and `cpu_set_t` types.
- **Inputs**: None
- **Logic and Control Flow**:
    - Declare a `fd_cpuset_t` variable `foo` using `FD_CPUSET_DECL` macro.
    - Convert `foo` to a `cpu_set_t` type `pun` using [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>) and verify that `CPU_COUNT(pun)` is zero.
    - Declare a `cpu_set_t` variable `foo` and zero it using `CPU_ZERO`.
    - Convert `foo` to a `fd_cpuset_t` type `pun` using [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>) and verify that `fd_cpuset_cnt(pun)` is zero.
- **Output**: No output is returned; the function performs internal tests and assertions.
- **Functions Called**:
    - [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>)
    - [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>)


---
### test\_cpu\_insert<!-- {{#callable:test_cpu_insert}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L52>)

Tests the insertion of random CPU indices into `fd_cpuset_t` and `cpu_set_t` structures and verifies their equivalence.
- **Inputs**:
    - `rng`: A pointer to a `fd_rng_t` structure used to generate random numbers.
- **Logic and Control Flow**:
    - Calculate `load_cnt` as a random number between 8 and `CPU_SETSIZE/3`, ensuring it is less than `CPU_SETSIZE/2`.
    - Declare a `fd_cpuset_t` named `foo` and insert `load_cnt` random CPU indices into it using `fd_cpuset_insert`.
    - Convert `foo` to a `cpu_set_t` named `pun` using [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>).
    - Verify that each index in `foo` matches the corresponding index in `pun` using `fd_cpuset_test` and `CPU_ISSET`.
    - Check that the count of set indices in `foo` matches the count in `pun` using `fd_cpuset_cnt` and `CPU_COUNT`.
    - Declare a `cpu_set_t` named `foo`, initialize it to zero, and insert `load_cnt` random CPU indices using `CPU_SET`.
    - Convert `foo` to a `fd_cpuset_t` named `pun` using [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>).
    - Verify that each index in `pun` matches the corresponding index in `foo` using `fd_cpuset_test` and `CPU_ISSET`.
    - Check that the count of set indices in `pun` matches the count in `foo` using `fd_cpuset_cnt` and `CPU_COUNT`.
- **Output**: No output is returned; the function performs internal tests and assertions.
- **Functions Called**:
    - [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>)
    - [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>)


---
### test\_cpu\_remove<!-- {{#callable:test_cpu_remove}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L91>)

Tests the removal of random CPU indices from a CPU set using both `fd_cpuset_remove` and `CPU_CLR` functions, and verifies the results.
- **Inputs**:
    - `rng`: A pointer to a `fd_rng_t` structure used to generate random numbers.
- **Logic and Control Flow**:
    - Calculate `load_cnt` as a random number between 8 and `CPU_SETSIZE/3`, ensuring it is greater than 0 and less than `CPU_SETSIZE/2`.
    - Initialize a CPU set `foo` with all bits set to 1 using `fd_memset`.
    - Iterate `load_cnt` times, each time removing a random index from `foo` using `fd_cpuset_remove`.
    - Convert `foo` to a `cpu_set_t` type `pun` using [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>).
    - Verify that each bit in `foo` matches the corresponding bit in `pun` using `fd_cpuset_test` and `CPU_ISSET`.
    - Check that the count of set bits in `foo` matches the count in `pun` using `fd_cpuset_cnt` and `CPU_COUNT`.
    - Initialize a `cpu_set_t` `foo` with all bits set using `CPU_SET`.
    - Iterate `load_cnt` times, each time clearing a random index in `foo` using `CPU_CLR`.
    - Convert `foo` to an `fd_cpuset_t` type `pun` using [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>).
    - Verify that each bit in `pun` matches the corresponding bit in `foo` using `fd_cpuset_test` and `CPU_ISSET`.
    - Check that the count of set bits in `pun` matches the count in `foo` using `fd_cpuset_cnt` and `CPU_COUNT`.
- **Output**: No output is returned, but the function performs internal tests to verify the correctness of CPU set operations.
- **Functions Called**:
    - [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>)
    - [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>)


---
### test\_cpu\_set<!-- {{#callable:test_cpu_set}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L133>)

Tests the functionality of `fd_cpuset_t` operations by comparing them with equivalent `cpu_set_t` operations.
- **Inputs**:
    - `rng`: A pointer to a random number generator of type `fd_rng_t` used to generate random indices for CPU set operations.
- **Logic and Control Flow**:
    - Initialize `load_cnt` with a random value between 8 and `CPU_SETSIZE/3`, ensuring it is greater than 0 and less than `CPU_SETSIZE/2`.
    - Declare two CPU sets `foo0` and `foo1` and populate them with random indices using `fd_cpuset_insert`.
    - Perform intersection, union, and XOR operations on `foo0` and `foo1`, storing results in `foo_and`, `foo_or`, and `foo_xor`.
    - Convert `foo0` and `foo1` to `cpu_set_t` format as `bar0` and `bar1` using [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>).
    - Perform equivalent intersection, union, and XOR operations on `bar0` and `bar1`, storing results in `bar_and`, `bar_or`, and `bar_xor`.
    - Verify that each bit in `foo_and`, `foo_or`, and `foo_xor` matches the corresponding bit in `bar_and`, `bar_or`, and `bar_xor` using `FD_TEST`.
    - Convert `bar_and`, `bar_or`, and `bar_xor` back to `fd_cpuset_t` format and verify equality with `foo_and`, `foo_or`, and `foo_xor`.
    - Test equality of `bar0` with itself and `foo0` with itself using `FD_TEST`.
    - Modify `bar0` and `foo0` by clearing and removing index 0, and modify `bar1` and `foo1` by setting and inserting index 0.
    - Verify that `bar0` and `bar1` are not equal and `foo0` and `foo1` are not equal after modifications.
- **Output**: No output is returned as the function is void; it performs tests and assertions internally.
- **Functions Called**:
    - [`fd_cpuset_to_libc`](<#fd_cpuset_to_libc>)
    - [`fd_cpuset_from_libc`](<#fd_cpuset_from_libc>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tile/test_cpuset.c#L184>)

Initializes the environment, tests CPU set operations, logs the result, and cleans up resources.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Creates a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Asserts that the footprint of `fd_cpuset` is at least the size of `cpu_set_t`.
    - Calls [`test_cpu_zero`](<#test_cpu_zero>), [`test_cpu_insert`](<#test_cpu_insert>), [`test_cpu_remove`](<#test_cpu_remove>), and [`test_cpu_set`](<#test_cpu_set>) to perform various tests on CPU set operations.
    - Logs a notice message indicating the tests passed using `FD_LOG_NOTICE`.
    - Deletes the random number generator using `fd_rng_delete` and `fd_rng_leave`.
    - Calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`test_cpu_zero`](<#test_cpu_zero>)
    - [`test_cpu_insert`](<#test_cpu_insert>)
    - [`test_cpu_remove`](<#test_cpu_remove>)
    - [`test_cpu_set`](<#test_cpu_set>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)