<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the random number generator functions in the Firedancer codebase, including alignment, footprint, and statistical properties.

# Purpose
The code is a C program designed to test the functionality of a random number generator (RNG) library. It includes various tests to verify the alignment and footprint of the RNG data structure, the creation and joining of RNG instances, and the correctness of sequence and index operations. The program also tests the conversion of random numbers to different data types and floating-point domains, ensuring that the generated values fall within expected ranges. Additionally, it includes tests for the secure generation of random numbers and the statistical properties of the RNG, such as popcount statistics.

The program is structured as an executable with a [`main`](<#main>) function that orchestrates the testing process. It uses several static functions to log reference values and test specific aspects of the RNG, such as [`log_ref`](<#log_ref>) and [`test_rng_secure`](<#test_rng_secure>). The code includes assertions to validate the expected behavior of the RNG functions, and it logs the results of each test. The program is intended to be run on systems like Linux, FreeBSD, or macOS, as indicated by the conditional compilation of the [`test_rng_secure`](<#test_rng_secure>) function. The overall purpose is to ensure the reliability and correctness of the RNG library by performing comprehensive tests on its various components and functionalities.
# Imports and Dependencies

---
- `../fd_util.h`
- `math.h`


# Functions

---
### log\_ref<!-- {{#callable:log_ref}} -->
[View Source →](<../../../../../src/util/rng/test_rng.c#L9>)

Logs a formatted representation of a 10-element array of unsigned long integers.
- **Inputs**:
    - ``ref``: A pointer to an array of 10 unsigned long integers to log.
    - ``seq``: An unsigned integer representing a sequence number for logging.
    - ``idx``: An unsigned long integer representing an index for logging.
- **Logic and Control Flow**:
    - Logs the start of an array declaration with the sequence and index values.
    - Iterates over the 10 elements of the `ref` array.
    - Logs each element in hexadecimal format, appending a comma except for the last element.
    - Logs the closing brace of the array declaration.
- **Output**: No return value; the function outputs log messages.


---
### test\_rng\_secure<!-- {{#callable:test_rng_secure}} -->
[View Source →](<../../../../../src/util/rng/test_rng.c#L18>)

Tests the `fd_rng_secure` function by analyzing the bit population statistics of a buffer filled with random data.
- **Inputs**: None
- **Logic and Control Flow**:
    - Logs the start of the test for `fd_rng_secure`.
    - Initializes variables `sum_pop`, `sum_pop2`, `min_pop`, and `max_pop` to accumulate statistics.
    - Defines a buffer `buf` of 4096 bytes.
    - Calls `fd_rng_secure` to fill `buf` with random data and checks the result with `FD_TEST`.
    - Iterates over `buf` in 8-byte chunks, calculates the population count of each chunk, and updates `sum_pop`, `sum_pop2`, `min_pop`, and `max_pop`.
    - Calculates the average and root mean square (RMS) of the population counts.
    - Logs the calculated statistics of the population counts.
    - Contains a placeholder comment for adding an assertion to test entropy.
- **Output**: No output is returned; the function logs the results of the test.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/rng/test_rng.c#L43>)

Initializes and tests a random number generator (RNG) for various properties and functionalities.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Logs a notice about testing alignment and footprint of the RNG.
    - Tests if the alignment and footprint of the RNG match expected values using `FD_TEST`.
    - Logs a notice about testing the creation of a new RNG instance.
    - Creates a new RNG instance with `fd_rng_new` and verifies its success.
    - Logs a notice about testing the joining of the RNG instance.
    - Joins the RNG instance with `fd_rng_join` and verifies its success.
    - Logs a notice about testing sequence and index functions of the RNG.
    - Tests the initial sequence and index values of the RNG.
    - Generates a sequence of random numbers and compares them to expected values, logging errors if mismatches occur.
    - Tests the sequence and index after generating numbers and sets a new sequence value.
    - Generates another sequence of random numbers and compares them to expected values, logging errors if mismatches occur.
    - Tests the sequence and index after generating more numbers and resets them to initial values.
    - Verifies the generation of random numbers matches expected values after resetting sequence and index.
    - Logs a notice about testing generator domains and tests various RNG functions for expected output ranges.
    - Tests the domain of generated numbers by checking if they fall within expected ranges and logs errors if not.
    - Logs a notice about testing seed expansion and performs a large number of iterations to test RNG seed expansion properties.
    - Calculates and logs statistics about the population count of expanded seeds.
    - Logs a notice about testing the leave function and verifies the RNG can be left correctly.
    - Logs a notice about testing the delete function and verifies the RNG can be deleted correctly.
    - If on a supported platform, calls [`test_rng_secure`](<#test_rng_secure>) to test secure RNG functionality.
    - Logs a final notice indicating all tests passed and calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`log_ref`](<#log_ref>)
    - [`test_rng_secure`](<#test_rng_secure>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)