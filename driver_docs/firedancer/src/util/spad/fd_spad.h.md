<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

APIs for high-performance persistent inter-process shared scratch pad memories with frame-based allocation.

# Purpose
The code defines a C header file that provides an API for managing high-performance, persistent, inter-process shared scratch pad memories, referred to as `spad`. A `spad` functions similarly to a thread's stack, allowing for fast O(1) allocation and deallocation of memory in frames. These frames are nested, and all allocations within a frame are automatically freed when the frame is popped. Unlike a thread's stack, a `spad` allows for trimming the most recent allocation, undoing recent allocations, and sharing allocations across multiple threads and processes if backed by shared memory. The API supports real-time streaming, custom allocation alignments, and a wide range of allocation sizes and alignments. It also allows for compile-time changes to include debugging and sanitization instrumentation.

The file defines several macros and functions for managing `spad` memory, including alignment and footprint calculations, constructors for creating and deleting `spad` instances, and operations for pushing and popping frames, allocating and trimming memory, and preparing and publishing allocations. The `fd_spad_t` structure is an opaque handle to a `spad`, and the API provides functions to join and leave a `spad`, as well as to verify its integrity. The code also includes debugging and sanitizer variants of the functions for additional checking and memory poisoning control. The header file is designed to be included in other C source files to provide the described functionality.
# Imports and Dependencies

---
- `../bits/fd_bits.h`


# Data Structures

---
### fd\_spad\_t
- **Type**: ``struct``
- **Members**:
    - ``magic``: Stores a magic number to verify the integrity of the scratch pad.
    - ``off``: An array of offsets indicating where allocations start for each frame.
    - ``frame_free``: Tracks the number of free frames available.
    - ``mem_max``: Specifies the maximum byte size of the scratch pad memory region.
    - ``mem_used``: Indicates the number of bytes currently used in the scratch pad memory.
    - ``mem_wmark``: Tracks the watermark of memory usage, if usage tracking is enabled.
- **Description**: `fd_spad_t` is a data structure that represents a high-performance, persistent, inter-process shared scratch pad memory. It supports fast O(1) operations for memory allocation and deallocation, organized into nested frames. The structure allows for flexible memory management, including trimming and undoing recent allocations, and can be shared across multiple threads and processes if backed by shared memory. It is designed for performance-critical contexts, with alignment and footprint considerations for efficient memory access and integration with real-time streaming and custom allocation requirements.


---
### fd\_spad\_private
- **Type**: ``struct``
- **Members**:
    - ``magic``: Stores a magic number to validate the structure.
    - ``off``: Array of byte offsets for frame allocations in the scratch pad memory.
    - ``frame_free``: Indicates the number of free frames available.
    - ``mem_max``: Specifies the maximum byte size of the scratch pad memory region.
    - ``mem_used``: Tracks the number of bytes currently used in the scratch pad memory.
    - ``mem_wmark``: (Conditional) Tracks the watermark of memory usage if usage tracking is enabled.
- **Description**: Defines a private structure for managing a high-performance, persistent, inter-process shared scratch pad memory. It includes metadata for memory management, such as offsets for frame allocations, the number of free frames, and memory usage statistics. The structure is aligned to `FD_SPAD_ALIGN` and uses a magic number for validation. It supports operations like fast allocation, frame management, and memory usage tracking, with optional instrumentation for debugging.


# Functions

---
### fd\_spad\_private\_mem<!-- {{#callable:fd_spad_private_mem}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L135>)

Returns a pointer to the first byte of the scratch pad's memory region in the caller's local address space.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure, representing the scratch pad memory.
- **Logic and Control Flow**:
    - Casts the `spad` pointer to a `uchar` pointer and increments it by one to point to the first byte of the memory region.
- **Output**: A `uchar` pointer to the first byte of the scratch pad's memory region.


---
### fd\_spad\_mem\_max\_max<!-- {{#callable:fd_spad_mem_max_max}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L175>)

Calculates the maximum possible memory size for a scratch pad that fits within a given footprint, returning zero if the size exceeds a 63-bit limit.
- **Inputs**:
    - `footprint`: The total number of bytes available for the scratch pad memory.
- **Logic and Control Flow**:
    - Aligns the `footprint` down to the nearest multiple of `FD_SPAD_ALIGN` using `fd_ulong_align_dn`.
    - Calculates `mem_max` as the maximum of the aligned `footprint` and the size of `fd_spad_t`, then subtracts the size of `fd_spad_t`.
    - Checks if `mem_max` is less than or equal to `1UL<<63`.
    - Returns `mem_max` if the condition is true, otherwise returns 0.
- **Output**: The largest possible `mem_max` value that fits within the given `footprint`, or 0 if the calculated `mem_max` exceeds a 63-bit limit.


---
### fd\_spad\_align<!-- {{#callable:fd_spad_align}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L187>)

Returns the constant alignment value `FD_SPAD_ALIGN` for a scratch pad memory.
- **Inputs**: None
- **Logic and Control Flow**:
    - Returns the value of the macro `FD_SPAD_ALIGN`.
- **Output**: The function returns an `ulong` representing the alignment value, which is `128`.


---
### fd\_spad\_footprint<!-- {{#callable:fd_spad_footprint}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L192>)

Calculates the memory footprint required for a scratch pad memory allocation based on a given maximum memory size.
- **Inputs**:
    - `mem_max`: The maximum memory size in bytes that the scratch pad can support, which must be less than or equal to 2^63.
- **Logic and Control Flow**:
    - Checks if `mem_max` is less than or equal to 2^63.
    - If true, calculates the footprint using the `FD_SPAD_FOOTPRINT` macro with `mem_max` as the parameter.
    - If false, returns 0.
- **Output**: Returns the calculated memory footprint in bytes if `mem_max` is valid, otherwise returns 0.


---
### fd\_spad\_new<!-- {{#callable:fd_spad_new}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L204>)

Formats a memory region into a scratch pad (spad) with specified alignment and memory size constraints.
- **Inputs**:
    - `shmem`: A pointer to the start of the memory region to format as a spad.
    - `mem_max`: The maximum number of bytes the spad can use for allocations.
- **Logic and Control Flow**:
    - Cast `shmem` to a `fd_spad_t` pointer named `spad`.
    - Check if `spad` is NULL; if true, return NULL.
    - Check if `spad` is aligned to `FD_SPAD_ALIGN`; if not, return NULL.
    - Check if `fd_spad_footprint(mem_max)` is non-zero; if not, return NULL.
    - Set `spad->mem_max` to `mem_max`.
    - Call `fd_spad_reset(spad)` to initialize the spad's state.
    - If `FD_SPAD_TRACK_USAGE` is defined, set `spad->mem_wmark` to 0.
    - Use `FD_COMPILER_MFENCE()` to ensure memory ordering before and after setting `spad->magic` to `FD_SPAD_MAGIC`.
    - Return the `spad` pointer.
- **Output**: Returns a pointer to the initialized spad on success, or NULL on failure.
- **Functions Called**:
    - [`fd_spad_footprint`](<#fd_spad_footprint>)
    - [`fd_spad_reset`](<#fd_spad_reset>)


---
### fd\_spad\_join<!-- {{#callable:fd_spad_join}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L236>)

Validates and returns a pointer to a shared scratch pad memory if it is correctly aligned and initialized.
- **Inputs**:
    - `shspad`: A pointer to the shared memory region that contains the scratch pad.
- **Logic and Control Flow**:
    - Cast `shspad` to a `fd_spad_t` pointer named `spad`.
    - Check if `spad` is NULL; if true, return NULL.
    - Check if `spad` is aligned to `FD_SPAD_ALIGN`; if not, return NULL.
    - Check if `spad->magic` equals `FD_SPAD_MAGIC`; if not, return NULL.
    - Return the `spad` pointer.
- **Output**: Returns a pointer to the `fd_spad_t` structure if all checks pass, otherwise returns NULL.


---
### fd\_spad\_leave<!-- {{#callable:fd_spad_leave}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L254>)

Returns a pointer to the `fd_spad_t` structure, effectively leaving the current spad join.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the current spad join.
- **Logic and Control Flow**:
    - Casts the `spad` pointer to a `void *` type.
    - Returns the casted pointer.
- **Output**: A `void *` pointer to the `fd_spad_t` structure, representing the first byte of the region containing the spad.


---
### fd\_spad\_frame\_max<!-- {{#callable:fd_spad_frame_max}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L275>)

Returns the maximum number of frames available in a scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - The function takes a single argument `spad`, which is a pointer to a constant `fd_spad_t` structure.
    - The function does not use the `spad` argument in its logic, as indicated by the `(void)spad;` statement.
    - The function returns the constant `FD_SPAD_FRAME_MAX`, which represents the maximum number of frames in the scratch pad memory.
- **Output**: The function returns an unsigned long integer representing the maximum number of frames (`FD_SPAD_FRAME_MAX`) in the scratch pad memory.


---
### fd\_spad\_frame\_used<!-- {{#callable:fd_spad_frame_used}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L276>)

Calculates the number of frames currently in use in a scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Subtracts the `frame_free` value from `FD_SPAD_FRAME_MAX` to determine the number of frames in use.
- **Output**: Returns an unsigned long integer representing the number of frames currently in use.


---
### fd\_spad\_frame\_free<!-- {{#callable:fd_spad_frame_free}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L277>)

Returns the number of free frames in a scratch pad memory structure.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `frame_free` member of the `fd_spad_t` structure pointed to by `spad`.
    - Returns the value of `frame_free`, which indicates the number of free frames.
- **Output**: The function returns an `ulong` representing the number of free frames in the scratch pad memory.


---
### fd\_spad\_mem\_max<!-- {{#callable:fd_spad_mem_max}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L283>)

Returns the maximum memory size of a scratch pad memory (`spad`).
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `mem_max` field of the `spad` structure.
    - Returns the value of `mem_max`, which indicates the maximum memory size of the scratch pad.
- **Output**: The function returns an `ulong` representing the maximum memory size of the scratch pad.


---
### fd\_spad\_mem\_used<!-- {{#callable:fd_spad_mem_used}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L284>)

Returns the number of bytes currently used in the scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `mem_used` field of the `fd_spad_t` structure pointed to by `spad`.
    - Returns the value of `mem_used`, which indicates the number of bytes currently used in the scratch pad memory.
- **Output**: The function returns an `ulong` representing the number of bytes currently used in the scratch pad memory.


---
### fd\_spad\_mem\_free<!-- {{#callable:fd_spad_mem_free}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L285>)

Calculates the amount of free memory available in a scratch pad memory structure.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `mem_max` field of the `spad` structure to get the total memory size.
    - Accesses the `mem_used` field of the `spad` structure to get the amount of memory currently used.
    - Subtracts `mem_used` from `mem_max` to determine the free memory available.
- **Output**: Returns an `ulong` representing the number of free bytes in the scratch pad memory.


---
### fd\_spad\_mem\_wmark<!-- {{#callable:fd_spad_mem_wmark}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L288>)

Returns the memory watermark of a scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `mem_wmark` field of the `fd_spad_t` structure pointed to by `spad`.
    - Returns the value of `mem_wmark`.
- **Output**: The function returns an `ulong` representing the memory watermark of the scratch pad memory.


---
### fd\_spad\_in\_frame<!-- {{#callable:fd_spad_in_frame}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L294>)

Checks if the scratch pad memory is currently within a frame.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `frame_free` member of the `spad` structure.
    - Compares `frame_free` with `FD_SPAD_FRAME_MAX`.
    - Returns 1 if `frame_free` is less than `FD_SPAD_FRAME_MAX`, indicating the spad is in a frame.
    - Returns 0 otherwise, indicating the spad is not in a frame.
- **Output**: Returns an integer: 1 if the spad is in a frame, 0 otherwise.


---
### fd\_spad\_private\_frame\_end<!-- {{#callable:fd_spad_private_frame_end}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L357>)

Ends the current frame in a scratch pad memory by popping it.
- **Inputs**:
    - `_spad`: A pointer to a pointer of type `fd_spad_t`, representing the scratch pad memory to operate on.
- **Logic and Control Flow**:
    - Calls the function [`fd_spad_pop`](<#fd_spad_pop>) with the dereferenced `_spad` pointer to pop the current frame from the scratch pad memory.
- **Output**: No return value; the function operates directly on the provided scratch pad memory.
- **Functions Called**:
    - [`fd_spad_pop`](<#fd_spad_pop>)


---
### fd\_spad\_reset\_impl<!-- {{#callable:fd_spad_reset_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L520>)

Resets the scratch pad memory by setting the number of free frames to the maximum and the used memory to zero.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory to reset.
- **Logic and Control Flow**:
    - Set `spad->frame_free` to `FD_SPAD_FRAME_MAX`, indicating all frames are free.
    - Set `spad->mem_used` to 0, indicating no memory is currently used.
- **Output**: No return value; the function modifies the `spad` structure in place.


---
### fd\_spad\_delete\_impl<!-- {{#callable:fd_spad_delete_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L526>)

Validates and deletes a shared scratch pad memory (`spad`) if it is correctly aligned and has a valid magic number.
- **Inputs**:
    - ``shspad``: A pointer to the shared scratch pad memory to be deleted.
- **Logic and Control Flow**:
    - Cast `shspad` to a `fd_spad_t` pointer named `spad`.
    - Check if `spad` is NULL; if true, return NULL.
    - Check if `spad` is aligned to `FD_SPAD_ALIGN`; if not, return NULL.
    - Check if `spad->magic` equals `FD_SPAD_MAGIC`; if not, return NULL.
    - Use `FD_COMPILER_MFENCE()` to ensure memory operations are completed.
    - Set `spad->magic` to 0 using `FD_VOLATILE` to mark it as deleted.
    - Use `FD_COMPILER_MFENCE()` again to ensure memory operations are completed.
    - Return the `spad` pointer.
- **Output**: Returns the pointer to the `spad` if successful, or NULL if any validation fails.


---
### fd\_spad\_alloc\_max\_impl<!-- {{#callable:fd_spad_alloc_max_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L541>)

Calculates the maximum number of bytes that can be allocated with a specified alignment from a shared scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the shared scratch pad memory.
    - `align`: An unsigned long integer specifying the desired alignment for the allocation, which must be a power of 2 or 0 to use the default alignment.
- **Logic and Control Flow**:
    - Check if `align` is greater than 0; if not, set `align` to `FD_SPAD_ALLOC_ALIGN_DEFAULT`.
    - Calculate `off` as the smallest multiple of `align` that is greater than or equal to `spad->mem_used`.
    - Return the difference between the maximum of `spad->mem_max` and `off`, and `off`.
- **Output**: Returns an unsigned long integer representing the maximum number of bytes that can be allocated with the specified alignment.


---
### fd\_spad\_frame\_lo\_impl<!-- {{#callable:fd_spad_frame_lo_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L549>)

Calculates the starting memory address of the current frame in a scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Calls [`fd_spad_private_mem`](<#fd_spad_private_mem>) to get the base address of the scratch pad memory.
    - Adds the offset of the current free frame (`spad->off[spad->frame_free]`) to the base address to calculate the starting address of the current frame.
- **Output**: Returns a pointer to the starting address of the current frame in the scratch pad memory.
- **Functions Called**:
    - [`fd_spad_private_mem`](<#fd_spad_private_mem>)


---
### fd\_spad\_frame\_hi\_impl<!-- {{#callable:fd_spad_frame_hi_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L554>)

Returns a pointer to the end of the used memory in a scratch pad memory structure.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Calls [`fd_spad_private_mem`](<#fd_spad_private_mem>) with `spad` to get the base address of the scratch pad memory.
    - Adds `spad->mem_used` to the base address to calculate the end of the used memory.
- **Output**: A pointer to the end of the used memory in the scratch pad memory.
- **Functions Called**:
    - [`fd_spad_private_mem`](<#fd_spad_private_mem>)


---
### fd\_spad\_push\_impl<!-- {{#callable:fd_spad_push_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L559>)

Decrements the `frame_free` index and sets the corresponding offset in the `off` array to the current `mem_used` value.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Decrement the `frame_free` index of the `spad` structure.
    - Set the `off` array at the new `frame_free` index to the current `mem_used` value of the `spad`.
- **Output**: No return value; the function modifies the `spad` structure in place.


---
### fd\_spad\_pop\_impl<!-- {{#callable:fd_spad_pop_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L564>)

Updates the `mem_used` field of a `fd_spad_t` structure to the offset of the next free frame and increments the `frame_free` index.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Accesses the `off` array of the `spad` structure using the current `frame_free` index to get the offset of the next free frame.
    - Updates the `mem_used` field of the `spad` structure with this offset value.
    - Increments the `frame_free` index to point to the next available frame.
- **Output**: No return value; the function modifies the `spad` structure in place.


---
### fd\_spad\_alloc\_impl<!-- {{#callable:fd_spad_alloc_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L569>)

Allocates memory from a scratch pad with specified alignment and size, updating the memory usage and watermark if tracking is enabled.
- **Inputs**:
    - ``spad``: A pointer to the `fd_spad_t` structure representing the scratch pad memory from which to allocate.
    - ``align``: The desired alignment for the allocation, which must be a power of 2 or 0 to use the default alignment.
    - ``sz``: The size in bytes of the memory to allocate.
- **Logic and Control Flow**:
    - Set `align` to `FD_SPAD_ALLOC_ALIGN_DEFAULT` if `align` is 0 or less.
    - Calculate the offset `off` by aligning `spad->mem_used` to the specified `align`.
    - Calculate the buffer pointer `buf` by adding `off` to the base address of the scratch pad memory.
    - Update `spad->mem_used` to reflect the new memory usage after allocation.
    - If `FD_SPAD_TRACK_USAGE` is enabled, update `spad->mem_wmark` if the new `mem_used` exceeds the current watermark.
- **Output**: Returns a pointer to the allocated memory region within the scratch pad.
- **Functions Called**:
    - [`fd_spad_private_mem`](<#fd_spad_private_mem>)


---
### fd\_spad\_trim\_impl<!-- {{#callable:fd_spad_trim_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L586>)

Adjusts the `mem_used` field of a `fd_spad_t` structure to reflect the current memory usage up to a specified high memory address.
- **Inputs**:
    - ``spad``: A pointer to a `fd_spad_t` structure representing the scratch pad memory.
    - ``hi``: A pointer to the high memory address up to which the memory usage is to be trimmed.
- **Logic and Control Flow**:
    - Calculate the difference between the address `hi` and the start of the scratch pad memory obtained from `fd_spad_private_mem(spad)`.
    - Assign this difference to the `mem_used` field of the `spad` structure.
- **Output**: No return value; the function modifies the `mem_used` field of the `spad` structure in place.
- **Functions Called**:
    - [`fd_spad_private_mem`](<#fd_spad_private_mem>)


---
### fd\_spad\_prepare\_impl<!-- {{#callable:fd_spad_prepare_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L592>)

Prepares a memory buffer in a scratch pad with a specified alignment.
- **Inputs**:
    - ``spad``: A pointer to the `fd_spad_t` structure representing the scratch pad.
    - ``align``: The desired alignment for the memory buffer, which must be a power of 2 or 0 to use the default alignment.
    - ``max``: The maximum size of the memory buffer to prepare, though this parameter is not used in the function.
- **Logic and Control Flow**:
    - Ignore the `max` parameter as it is not used in the function.
    - Set `align` to `FD_SPAD_ALLOC_ALIGN_DEFAULT` if it is 0 or less.
    - Calculate the offset `off` by aligning `spad->mem_used` to the specified `align`.
    - Get a pointer `buf` to the memory buffer by adding the offset `off` to the base address of the scratch pad's memory.
    - Update `spad->mem_used` to the new offset `off`.
    - Return the pointer `buf` to the prepared memory buffer.
- **Output**: Returns a pointer to the prepared memory buffer with the specified alignment.
- **Functions Called**:
    - [`fd_spad_private_mem`](<#fd_spad_private_mem>)


---
### fd\_spad\_cancel\_impl<!-- {{#callable:fd_spad_cancel_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L604>)

Does nothing with the provided `fd_spad_t` pointer.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure, representing a shared scratch pad memory.
- **Logic and Control Flow**:
    - The function takes a single argument, `spad`, which is a pointer to an `fd_spad_t` structure.
    - The function explicitly casts `spad` to void to indicate that it does not use this parameter.
- **Output**: No output or return value; the function performs no operations.


---
### fd\_spad\_publish\_impl<!-- {{#callable:fd_spad_publish_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L609>)

Updates the `mem_used` field of a `fd_spad_t` structure by adding a specified size.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory.
    - `sz`: An unsigned long integer representing the size to add to the `mem_used` field.
- **Logic and Control Flow**:
    - Access the `mem_used` field of the `fd_spad_t` structure pointed to by `spad`.
    - Add the value of `sz` to the `mem_used` field.
- **Output**: No return value; the function modifies the `mem_used` field of the `fd_spad_t` structure in place.


---
### fd\_spad\_reset<!-- {{#callable:fd_spad_reset}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L624>)

Resets the state of a shared scratch pad memory by popping all frames in use.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory to reset.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_reset)` macro with the `spad` argument.
    - The `SELECT_IMPL` macro determines the appropriate implementation of `fd_spad_reset` to use based on compile-time conditions.
    - The selected implementation function is then executed, which resets the state of the `spad` by popping all frames.
- **Output**: No return value; the function operates directly on the `spad` structure to reset its state.


---
### fd\_spad\_delete<!-- {{#callable:fd_spad_delete}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L629>)

Unformats a memory region used as a scratch pad and returns the pointer to the region on success.
- **Inputs**:
    - ``shspad``: A pointer to the first byte of the memory region containing the scratch pad.
- **Logic and Control Flow**:
    - Calls `SELECT_IMPL(fd_spad_delete)` with `shspad` as the argument.
    - `SELECT_IMPL` chooses the appropriate implementation of `fd_spad_delete` based on compile-time conditions.
    - The chosen implementation checks if `shspad` is non-NULL, properly aligned, and contains a valid scratch pad.
    - If all checks pass, it sets the `magic` field of the scratch pad to 0, effectively unformatting it.
    - Returns the pointer `shspad` if successful, otherwise returns `NULL`.
- **Output**: Returns the pointer `shspad` on success, or `NULL` on failure.


---
### fd\_spad\_alloc\_max<!-- {{#callable:fd_spad_alloc_max}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L634>)

Returns the maximum number of bytes that can be allocated with a specified alignment from a shared scratch pad memory.
- **Inputs**:
    - ``spad``: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory.
    - ``align``: An unsigned long integer specifying the alignment for the allocation, which must be a power of 2 within the range [1, `FD_SPAD_ALIGN`] or 0 to use `FD_SPAD_ALLOC_ALIGN_DEFAULT`.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_alloc_max)` macro to choose the appropriate implementation of the function based on compile-time conditions.
    - Passes the `spad` and `align` arguments to the selected implementation function.
    - Returns the result from the implementation function, which is the maximum number of bytes that can be allocated with the specified alignment.
- **Output**: An unsigned long integer representing the maximum number of bytes that can be allocated with the specified alignment from the shared scratch pad memory.


---
### fd\_spad\_frame\_lo<!-- {{#callable:fd_spad_frame_lo}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L640>)

Returns the starting address of the current frame in the scratch pad memory.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL` macro with `fd_spad_frame_lo` to choose the appropriate implementation based on compile-time conditions.
    - Returns the result of the selected implementation function, which is the starting address of the current frame in the scratch pad memory.
- **Output**: A pointer to the starting address of the current frame in the scratch pad memory.


---
### fd\_spad\_frame\_hi<!-- {{#callable:fd_spad_frame_hi}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L645>)

Returns the high memory address of the current frame in a shared scratch pad memory.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared scratch pad memory.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL` macro with `fd_spad_frame_hi` to choose the appropriate implementation based on compile-time conditions.
    - Passes the `spad` argument to the selected implementation function.
    - Returns the result from the implementation function, which is the high memory address of the current frame.
- **Output**: A pointer to the high memory address of the current frame in the shared scratch pad memory.


---
### fd\_spad\_push<!-- {{#callable:fd_spad_push}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L650>)

Creates a new frame in the scratch pad memory and makes it the current frame.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL` macro with `fd_spad_push` to select the appropriate implementation based on compile-time conditions.
    - The selected implementation function is then called with the `spad` argument.
- **Output**: No return value; the function modifies the state of the `spad` to reflect the new frame.


---
### fd\_spad\_pop<!-- {{#callable:fd_spad_pop}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L655>)

Destroys the current frame in a scratch pad memory, freeing all allocations within it, and makes the previous frame current if it exists.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the scratch pad memory.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_pop)` macro with `spad` as an argument.
    - The `SELECT_IMPL` macro determines the appropriate implementation of `fd_spad_pop` to use based on compile-time conditions.
    - The selected implementation function is then executed, which updates the `mem_used` field of `spad` to the offset of the previous frame and increments the `frame_free` counter.
- **Output**: No return value; the function operates directly on the `spad` structure to modify its state.


---
### fd\_spad\_alloc<!-- {{#callable:fd_spad_alloc}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L660>)

Allocates a memory block from a shared scratch pad with specified alignment and size.
- **Inputs**:
    - ``spad``: A pointer to the `fd_spad_t` structure representing the shared scratch pad memory.
    - ``align``: The desired alignment for the memory allocation, which must be a power of 2 within the range [1, FD_SPAD_ALIGN] or 0 to use the default alignment.
    - ``sz``: The size in bytes of the memory block to allocate.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_alloc)` macro to choose the appropriate implementation of the allocation function based on compile-time conditions.
    - Passes the `spad`, `align`, and `sz` parameters to the selected implementation function.
    - Returns the result of the selected implementation function, which is a pointer to the allocated memory block.
- **Output**: A pointer to the allocated memory block within the shared scratch pad, aligned as specified.


---
### fd\_spad\_trim<!-- {{#callable:fd_spad_trim}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L667>)

Adjusts the end of the current frame in a scratch pad memory to a specified address.
- **Inputs**:
    - ``spad``: A pointer to the `fd_spad_t` structure representing the scratch pad memory.
    - ``hi``: A pointer to the new end address within the current frame of the scratch pad memory.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_trim)` macro to choose the appropriate implementation of the `fd_spad_trim` function based on compile-time conditions.
    - Passes the `spad` and `hi` arguments to the selected implementation function.
- **Output**: No return value; the function modifies the `spad` structure to update the end of the current frame.


---
### fd\_spad\_prepare<!-- {{#callable:fd_spad_prepare}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L673>)

Prepares a scratch pad allocation with specified alignment and maximum size.
- **Inputs**:
    - ``spad``: A pointer to a `fd_spad_t` structure representing the scratch pad memory.
    - ``align``: The desired alignment for the allocation, which must be an integer power of 2 in the range [1, `FD_SPAD_ALIGN`] or 0 to use `FD_SPAD_ALLOC_ALIGN_DEFAULT`.
    - ``max``: The maximum number of bytes to allocate, which must be within the allowable allocation size.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_prepare)` macro to choose the appropriate implementation of `fd_spad_prepare` based on compile-time conditions.
    - Passes the `spad`, `align`, and `max` parameters to the selected implementation function.
    - Returns the result of the selected implementation function, which is a pointer to the start of the prepared allocation.
- **Output**: A pointer to the initial byte of the prepared allocation, aligned as specified.


---
### fd\_spad\_cancel<!-- {{#callable:fd_spad_cancel}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L680>)

Cancels the most recent prepare operation on a scratch pad memory, ensuring the scratch pad is in a frame and not in a prepare state.
- **Inputs**:
    - ``spad``: A pointer to a `fd_spad_t` structure representing the scratch pad memory to operate on.
- **Logic and Control Flow**:
    - Calls the `SELECT_IMPL(fd_spad_cancel)` macro with `spad` as an argument, which selects the appropriate implementation of the `fd_spad_cancel` function based on compile-time conditions.
- **Output**: No return value; the function modifies the state of the `spad` to cancel the prepare operation.


---
### fd\_spad\_publish<!-- {{#callable:fd_spad_publish}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L685>)

Completes the allocation process started by `fd_spad_prepare` by finalizing the size of the allocation.
- **Inputs**:
    - ``spad``: A pointer to the `fd_spad_t` structure representing the scratch pad memory.
    - ``sz``: The size in bytes to finalize the allocation, which must be within the range specified during the prepare phase.
- **Logic and Control Flow**:
    - Calls the implementation-specific version of `fd_spad_publish` using the `SELECT_IMPL` macro.
    - Increments the `mem_used` field of the `spad` structure by `sz`, finalizing the allocation.
- **Output**: No return value; the function modifies the `spad` structure to reflect the finalized allocation size.


# Function Declarations (Public API)

---
### fd\_spad\_reset<!-- {{#callable_declaration:fd_spad_reset}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L147>)

Resets the scratch pad memory to its initial state.
- **Description**: Use this function to clear all frames in the scratch pad memory, effectively resetting it to its initial state. This operation is fast and has a time complexity of O(1). It must be called when the scratch pad is a current local join. After execution, the scratch pad will not be in any frame.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and must be a current local join. Invalid input will result in undefined behavior.
- **Output**: None
- **See Also**: [`fd_spad_reset`](<#fd_spad_reset>)  (Implementation)


---
### fd\_spad\_delete<!-- {{#callable_declaration:fd_spad_delete}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L266>)

Unformats a memory region used as a spad.
- **Description**: Use this function to unformat a memory region that was previously formatted as a spad. It is important to ensure that no threads are joined to the spad when calling this function. The function will return the original pointer to the memory region on success, or NULL if the operation fails. Reasons for failure include a NULL pointer, misalignment, or if the memory region does not contain a valid spad.
- **Inputs**:
    - `shspad`: A pointer to the first byte of the memory region containing the spad. Must not be NULL, must be aligned to `FD_SPAD_ALIGN`, and must contain a valid spad. Caller retains ownership.
- **Output**: Returns the original pointer `shspad` on success, or NULL on failure.
- **See Also**: [`fd_spad_delete`](<#fd_spad_delete>)  (Implementation)


---
### fd\_spad\_alloc\_max<!-- {{#callable_declaration:fd_spad_alloc_max}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L304>)

Returns the maximum number of bytes that can be allocated with a specified alignment.
- **Description**: Use this function to determine the maximum number of bytes that can be allocated from a scratch pad memory with a specific alignment. This function should be called when the scratch pad is a current local join and is within a frame. The alignment must be an integer power of 2 within the specified range or zero to use the default alignment. This function does not modify the state of the scratch pad.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and must be a current local join.
    - `align`: An unsigned long specifying the alignment for the allocation. It must be an integer power of 2 within the range [1, FD_SPAD_ALIGN] or 0 to use FD_SPAD_ALLOC_ALIGN_DEFAULT.
- **Output**: Returns the maximum number of bytes that can be allocated with the specified alignment. The return value is an unsigned long.
- **See Also**: [`fd_spad_alloc_max`](<#fd_spad_alloc_max>)  (Implementation)


---
### fd\_spad\_frame\_lo<!-- {{#callable_declaration:fd_spad_frame_lo}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L314>)

Returns the starting address of the current frame in the scratch pad memory.
- **Description**: Use this function to obtain a pointer to the beginning of the current frame in a scratch pad memory. This is useful when you need to access or manipulate data within the current frame. Ensure that the scratch pad is a current local join and is in a frame before calling this function. The function does not modify the state of the scratch pad or the frame.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. Must not be null and must be a current local join in a frame.
- **Output**: A pointer to the first byte of the current frame in the scratch pad memory.
- **See Also**: [`fd_spad_frame_lo`](<#fd_spad_frame_lo>)  (Implementation)


---
### fd\_spad\_frame\_hi<!-- {{#callable_declaration:fd_spad_frame_hi}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L317>)

Returns the end address of the current frame in the scratch pad memory.
- **Description**: Use this function to get the address immediately after the last allocated byte in the current frame of a scratch pad memory. This function assumes that the scratch pad is a current local join and is in a frame. It is useful for determining the boundary of the current frame's allocations. Ensure that the scratch pad is properly initialized and joined before calling this function.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and must be a current local join in a frame. Invalid input will result in undefined behavior.
- **Output**: A pointer to the end of the current frame in the scratch pad memory.
- **See Also**: [`fd_spad_frame_hi`](<#fd_spad_frame_hi>)  (Implementation)


---
### fd\_spad\_push<!-- {{#callable_declaration:fd_spad_push}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L327>)

Creates a new frame in the scratch pad memory.
- **Description**: Use this function to create a new frame in the scratch pad memory, which allows for fast allocation and deallocation of memory within that frame. This function must be called when the scratch pad is a current local join and has at least one frame available. After calling, the scratch pad will be in a frame and not in a prepare state. This operation is fast and has a time complexity of O(1).
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and must be a current local join with at least one frame free.
- **Output**: None
- **See Also**: [`fd_spad_push`](<#fd_spad_push>)  (Implementation)


---
### fd\_spad\_pop<!-- {{#callable_declaration:fd_spad_pop}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L337>)

Destroys the current frame in a scratch pad memory.
- **Description**: Use this function to remove the current frame from a scratch pad memory, which will free all allocations made within that frame. This function assumes that the scratch pad is currently joined locally and is in a frame. After execution, the scratch pad will not be in a prepare state, and if there was a previous frame, it will become the current frame. This operation is fast and has a time complexity of O(1).
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. The pointer must not be null, and the scratch pad must be a current local join and in a frame. The caller retains ownership of the memory.
- **Output**: None
- **See Also**: [`fd_spad_pop`](<#fd_spad_pop>)  (Implementation)


---
### fd\_spad\_alloc<!-- {{#callable_declaration:fd_spad_alloc}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L384>)

Allocates memory from a shared scratch pad with specified alignment.
- **Description**: Use this function to allocate a block of memory from a shared scratch pad memory (`spad`) with a specified alignment (`align`) and size (`sz`). This function is suitable for high-performance applications where memory allocation speed is critical. Ensure that the `spad` is a current local join and is in a frame before calling this function. The alignment must be a power of 2 within the range [1, FD_SPAD_ALIGN] or 0, which defaults to FD_SPAD_ALLOC_ALIGN_DEFAULT. The size must be within the allowable allocation size for the current frame. The function implicitly cancels any in-progress prepare operation. The allocated memory is valid until the next frame pop or spad deletion.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. Must be a current local join and in a frame. The caller retains ownership.
    - `align`: Specifies the alignment of the allocated memory. Must be a power of 2 within [1, FD_SPAD_ALIGN] or 0 to use FD_SPAD_ALLOC_ALIGN_DEFAULT. Invalid values are adjusted to the default alignment.
    - `sz`: The size of the memory block to allocate, in bytes. Must be within the maximum allowable size for the current frame. Invalid sizes result in undefined behavior.
- **Output**: Returns a pointer to the allocated memory block with the specified alignment. The pointer is valid until the next frame pop or spad deletion.
- **See Also**: [`fd_spad_alloc`](<#fd_spad_alloc>)  (Implementation)


---
### fd\_spad\_trim<!-- {{#callable_declaration:fd_spad_trim}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L408>)

Trims the current frame's high boundary to a specified address.
- **Description**: Use this function to adjust the high boundary of the current frame in a scratch pad memory to a specific address. This is useful for reducing the size of the most recent allocation or undoing a sequence of allocations. Ensure that the scratch pad is a current local join and in a frame before calling this function. The specified address must be within the current frame's boundaries.
- **Inputs**:
    - ``spad``: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must be a current local join and in a frame.
    - ``hi``: A pointer to the new high boundary within the current frame. It must be within the range of the current frame's low and high boundaries.
- **Output**: None
- **See Also**: [`fd_spad_trim`](<#fd_spad_trim>)  (Implementation)


---
### fd\_spad\_prepare<!-- {{#callable_declaration:fd_spad_prepare}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L440>)

Prepares a memory allocation in a shared scratch pad.
- **Description**: Use this function to start preparing a memory allocation within a shared scratch pad memory. This function is useful when the final size of the allocation is not known upfront, such as in real-time streaming scenarios. It must be called when the scratch pad is in a frame and the caller is joined to the scratch pad. The function implicitly cancels any in-progress prepare operation. The returned memory region is aligned as specified and can be up to the specified maximum size. The allocation remains valid until the next prepare, cancel, alloc, trim, push, pop, leave, or delete operation.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad. Must be a current local join and in a frame. The caller retains ownership.
    - `align`: Specifies the alignment for the allocation. Must be an integer power of 2 within the range [1, FD_SPAD_ALIGN] or 0 to use FD_SPAD_ALLOC_ALIGN_DEFAULT.
    - `max`: The maximum number of bytes to allocate. Must be within the range [0, alloc_max].
- **Output**: Returns a pointer to the start of the prepared memory allocation, aligned as specified. The pointer is non-NULL and valid until the next prepare, cancel, alloc, trim, push, pop, leave, or delete operation.
- **See Also**: [`fd_spad_prepare`](<#fd_spad_prepare>)  (Implementation)


---
### fd\_spad\_cancel<!-- {{#callable_declaration:fd_spad_cancel}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L462>)

Cancels the most recent prepare operation on a shared scratch pad.
- **Description**: Use this function to cancel a prepare operation that is currently in progress on a shared scratch pad memory. This function assumes that the scratch pad is a current local join and is in a prepare state. After calling this function, the scratch pad will be in a frame and not in a prepare state. This operation is fast and has a time complexity of O(1).
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad. The pointer must not be null, and the scratch pad must be a current local join in a prepare state. Invalid input will result in undefined behavior.
- **Output**: None
- **See Also**: [`fd_spad_cancel`](<#fd_spad_cancel>)  (Implementation)


---
### fd\_spad\_publish<!-- {{#callable_declaration:fd_spad_publish}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L470>)

Completes a prepared allocation in a shared scratch pad.
- **Description**: Use this function to finalize an allocation that was previously prepared in a shared scratch pad memory. It must be called after a successful call to `fd_spad_prepare` and before any other allocation or frame operation. This function ensures that the prepared allocation is committed with the specified size. The scratch pad must be in a prepared state, and the size must not exceed the maximum specified during preparation. After this call, the scratch pad will no longer be in a prepared state.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad. Must not be null and must be a current local join in a prepared state.
    - `sz`: The size in bytes to finalize the allocation. Must be within the range [0, prepare's max].
- **Output**: None
- **See Also**: [`fd_spad_publish`](<#fd_spad_publish>)  (Implementation)


---
### fd\_spad\_verify<!-- {{#callable_declaration:fd_spad_verify}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L481>)

Verifies the integrity of a shared scratch pad memory.
- **Description**: Use this function to check if a shared scratch pad memory (`spad`) is valid and not corrupt. It verifies that the `spad` is a current local join and that its metadata is consistent. This includes checking the magic number, frame limits, and memory usage. If the `spad` is invalid, the function logs a warning and returns a negative error code. This function requires logging services to be available.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. Must not be null and must point to a valid, current local join. The function checks the integrity of this structure.
- **Output**: Returns 0 if the `spad` is valid. Returns a negative integer error code if the `spad` is corrupt, with details logged.
- **See Also**: [`fd_spad_verify`](<fd_spad.c.md#fd_spad_verify>)  (Implementation)


---
### fd\_spad\_reset\_debug<!-- {{#callable_declaration:fd_spad_reset_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L489>)

Resets the debug state of a shared scratch pad memory.
- **Description**: Use this function to reset the state of a shared scratch pad memory (`spad`) when debugging. This function assumes that `spad` is a valid and currently joined local instance. It is useful for clearing all frames and allocations in the scratch pad, effectively resetting it to an initial state. This operation is fast and operates in constant time (O(1)).
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. It must not be null and must be a valid, currently joined local instance. The function will not perform any operation if `spad` is invalid.
- **Output**: None
- **See Also**: [`fd_spad_reset_debug`](<fd_spad.c.md#fd_spad_reset_debug>)  (Implementation)


---
### fd\_spad\_delete\_debug<!-- {{#callable_declaration:fd_spad_delete_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L490>)

Deletes a shared scratch pad memory region with debugging checks.
- **Description**: Use this function to delete a shared scratch pad memory region while performing additional debugging checks. It is important to ensure that no threads are currently joined to the scratch pad when calling this function. The function will return the pointer to the shared memory region on success or NULL if the operation fails. Reasons for failure include a NULL pointer, misalignment, or if the memory region does not contain a valid scratch pad.
- **Inputs**:
    - `shspad`: A pointer to the first byte of the shared memory region containing the scratch pad. The pointer must not be NULL, must be aligned according to `FD_SPAD_ALIGN`, and must point to a valid scratch pad. The caller retains ownership of the memory.
- **Output**: Returns the pointer to the shared memory region on success, or NULL on failure.
- **See Also**: [`fd_spad_delete_debug`](<fd_spad.c.md#fd_spad_delete_debug>)  (Implementation)


---
### fd\_spad\_alloc\_max\_debug<!-- {{#callable_declaration:fd_spad_alloc_max_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L491>)

Returns the maximum allocatable bytes with specified alignment in a frame.
- **Description**: Use this function to determine the maximum number of bytes that can be allocated with a specific alignment in the current frame of a scratch pad memory. This function should be called when the scratch pad is in a frame and the caller is joined to it. The alignment must be a power of two within the range [1, FD_SPAD_ALIGN] or zero, which defaults to FD_SPAD_ALLOC_ALIGN_DEFAULT. If the scratch pad is not in a frame or the alignment is invalid, the function will log a critical error.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the scratch pad memory. The scratch pad must be in a frame and the caller must be joined to it.
    - `align`: An unsigned long specifying the desired alignment for the allocation. Must be a power of two within [1, FD_SPAD_ALIGN] or zero to use the default alignment. Invalid alignments will cause a critical error log.
- **Output**: Returns the maximum number of bytes that can be allocated with the specified alignment in the current frame.
- **See Also**: [`fd_spad_alloc_max_debug`](<fd_spad.c.md#fd_spad_alloc_max_debug>)  (Implementation)


---
### fd\_spad\_frame\_lo\_debug<!-- {{#callable_declaration:fd_spad_frame_lo_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L492>)

Returns the starting address of the current frame in debug mode.
- **Description**: Use this function to obtain the starting address of the current frame in a shared scratch pad memory when debugging. It is important to ensure that the scratch pad is currently in a frame before calling this function, as it will log a critical error if not. This function is useful for debugging purposes to verify the frame's starting address.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. It must not be null and must be in a frame. If the scratch pad is not in a frame, the function logs a critical error.
- **Output**: Returns a pointer to the starting address of the current frame in the scratch pad memory.
- **See Also**: [`fd_spad_frame_lo_debug`](<fd_spad.c.md#fd_spad_frame_lo_debug>)  (Implementation)


---
### fd\_spad\_frame\_hi\_debug<!-- {{#callable_declaration:fd_spad_frame_hi_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L493>)

Returns the high memory address of the current frame for debugging.
- **Description**: Use this function to obtain the high memory address of the current frame in a shared scratch pad memory for debugging purposes. It is important to ensure that the scratch pad is currently in a frame before calling this function, as it will log a critical error if not. This function is useful for debugging scenarios where you need to verify the memory boundaries of the current frame.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. The pointer must not be null, and the scratch pad must be in a frame when this function is called.
- **Output**: A pointer to the high memory address of the current frame in the caller's address space.
- **See Also**: [`fd_spad_frame_hi_debug`](<fd_spad.c.md#fd_spad_frame_hi_debug>)  (Implementation)


---
### fd\_spad\_push\_debug<!-- {{#callable_declaration:fd_spad_push_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L494>)

Pushes a new frame onto the scratch pad memory.
- **Description**: Use this function to create a new frame in the scratch pad memory, which is necessary for organizing memory allocations. Ensure that there is at least one frame available before calling this function. If there are no frames available, the function will log a critical error and terminate the program. This function is intended for use in debugging scenarios where additional checks are required.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. Must not be null and must be a valid, joined scratch pad with at least one free frame.
- **Output**: None
- **See Also**: [`fd_spad_push_debug`](<fd_spad.c.md#fd_spad_push_debug>)  (Implementation)


---
### fd\_spad\_pop\_debug<!-- {{#callable_declaration:fd_spad_pop_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L495>)

Pops the current frame from the scratch pad memory.
- **Description**: Use this function to remove the current frame from the scratch pad memory, which will free all allocations made within that frame. This function should be called when the scratch pad is in a frame, and it assumes that the scratch pad is a current local join. If the scratch pad is not in a frame, the function will log a critical error. After execution, the scratch pad will not be in a prepare state, and if there was a previous frame, it will become the current frame.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. Must not be null and must be a current local join. The function will log a critical error if the scratch pad is not in a frame.
- **Output**: None
- **See Also**: [`fd_spad_pop_debug`](<fd_spad.c.md#fd_spad_pop_debug>)  (Implementation)


---
### fd\_spad\_alloc\_check<!-- {{#callable_declaration:fd_spad_alloc_check}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L496>)

Allocates memory from a shared scratch pad with specified alignment and size.
- **Description**: Use this function to allocate a block of memory from a shared scratch pad (`spad`) with a specified alignment and size. The function must be called when the `spad` is in a frame, and the alignment must be a power of two or zero (indicating the default alignment). The requested size must not exceed the maximum allocatable size for the given alignment. If any of these conditions are not met, the function will log a critical error and terminate the program. This function is suitable for high-performance applications where fast memory allocation is required.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad. Must not be null and must be in a frame.
    - `align`: The desired alignment for the allocation. Must be a power of two or zero (to use the default alignment). If not, a critical error is logged.
    - `sz`: The size of the memory block to allocate. Must not exceed the maximum allocatable size for the given alignment. If it does, a critical error is logged.
- **Output**: Returns a pointer to the allocated memory block with the specified alignment. The pointer is non-null if the allocation is successful.
- **See Also**: [`fd_spad_alloc_check`](<fd_spad.c.md#fd_spad_alloc_check>)  (Implementation)


---
### fd\_spad\_trim\_debug<!-- {{#callable_declaration:fd_spad_trim_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L498>)

Trims the current frame's high boundary in a shared scratch pad memory.
- **Description**: Use this function to adjust the high boundary of the current frame in a shared scratch pad memory to a specified address. This function is useful for reducing the size of the most recent allocation within the current frame. It must be called when the scratch pad is in a frame, and the specified address must be within the current frame's boundaries. If the specified address is outside the valid range, the function will log a critical error and terminate the program.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. It must be a valid, joined, and current local instance.
    - `hi`: A pointer to the new high boundary within the current frame. It must be within the range of the current frame's low and high boundaries.
- **Output**: None
- **See Also**: [`fd_spad_trim_debug`](<fd_spad.c.md#fd_spad_trim_debug>)  (Implementation)


---
### fd\_spad\_prepare\_debug<!-- {{#callable_declaration:fd_spad_prepare_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L499>)

Prepares a debug allocation in a shared scratch pad memory.
- **Description**: Use this function to start a debug allocation in a shared scratch pad memory (`spad`). It must be called when the `spad` is in a frame. The function checks if the `spad` is in a frame, if the alignment is a power of two, and if the maximum allocation size is valid. If any of these conditions are not met, the function will log a critical error. This function is useful for debugging purposes when you need to prepare an allocation with specific alignment and size constraints.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. Must not be null and must be in a frame.
    - `align`: The desired alignment for the allocation. Must be a power of two or zero (indicating default alignment). If not a power of two, a critical error is logged.
    - `max`: The maximum size of the allocation in bytes. Must be less than or equal to the maximum allocatable size for the given alignment. If not, a critical error is logged.
- **Output**: Returns a pointer to the prepared allocation in the caller's address space, aligned as specified.
- **See Also**: [`fd_spad_prepare_debug`](<fd_spad.c.md#fd_spad_prepare_debug>)  (Implementation)


---
### fd\_spad\_cancel\_debug<!-- {{#callable_declaration:fd_spad_cancel_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L500>)

Cancels the most recent prepare operation on a scratch pad.
- **Description**: Use this function to cancel the most recent prepare operation on a scratch pad memory. This function must be called when the scratch pad is in a prepare state, which occurs after a call to `fd_spad_prepare`. After calling this function, the scratch pad will be in a frame state and not in a prepare state. This function is useful for reverting a prepare operation if the allocation is no longer needed. Ensure that the scratch pad is a current local join before calling this function.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad. Must not be null and must be a current local join. The function will log a critical error if the scratch pad is not in a frame.
- **Output**: None
- **See Also**: [`fd_spad_cancel_debug`](<fd_spad.c.md#fd_spad_cancel_debug>)  (Implementation)


---
### fd\_spad\_publish\_debug<!-- {{#callable_declaration:fd_spad_publish_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L501>)

Publishes a prepared allocation in a shared scratch pad.
- **Description**: Use this function to finalize an allocation that was previously prepared in a shared scratch pad memory. It must be called when the scratch pad is in a prepared state, and the size of the allocation to publish must not exceed the maximum size specified during preparation. This function ensures that the scratch pad transitions from a prepared state back to a normal frame state, making the allocation available for use.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad. It must be a valid, non-null pointer, and the scratch pad must be in a prepared state.
    - `sz`: The size in bytes of the allocation to publish. It must be within the range [0, prepare's max] as specified during the preparation phase.
- **Output**: None
- **See Also**: [`fd_spad_publish_debug`](<fd_spad.c.md#fd_spad_publish_debug>)  (Implementation)


---
### fd\_spad\_reset\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_reset_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L506>)

Resets and sanitizes a shared scratch pad memory.
- **Description**: Use this function to reset a shared scratch pad memory (`spad`) and sanitize its memory region. This function is useful when you need to clear all frames and allocations in the scratch pad and ensure that the memory is poisoned for debugging purposes. It must be called when `spad` is a current local join. This function is particularly relevant in environments where AddressSanitizer (ASAN) or MemorySanitizer (MSAN) is used, as it poisons the memory to help detect memory errors.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the shared scratch pad memory. Must not be null and must be a current local join. The function does not handle invalid or null pointers.
- **Output**: None
- **See Also**: [`fd_spad_reset_sanitizer_impl`](<fd_spad.c.md#fd_spad_reset_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_delete\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_delete_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L507>)

Deletes a shared scratch pad memory region with sanitization.
- **Description**: Use this function to delete a shared scratch pad memory region while ensuring that the memory is properly sanitized. This function should be called when the shared scratch pad is no longer needed and there are no active joins to it. It returns a pointer to the deleted memory region if successful, or NULL if the deletion fails. The function also unpoisons the memory region to prevent memory access errors in sanitized builds.
- **Inputs**:
    - `shspad`: A pointer to the shared scratch pad memory region to delete. Must not be NULL, must be properly aligned, and must contain a valid scratch pad. The caller retains ownership of the memory.
- **Output**: Returns a pointer to the deleted shared scratch pad memory region on success, or NULL on failure.
- **See Also**: [`fd_spad_delete_sanitizer_impl`](<fd_spad.c.md#fd_spad_delete_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_alloc\_max\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_alloc_max_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L508>)

Returns the maximum allocatable bytes with specified alignment.
- **Description**: Use this function to determine the maximum number of bytes that can be allocated from a shared scratch pad memory with a specified alignment. This function is useful when you need to allocate memory with specific alignment requirements, especially when using AddressSanitizer (ASAN) or MemorySanitizer (MSAN). Ensure that the scratch pad is a current local join and is in a frame before calling this function.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. Must not be null and must be a current local join.
    - `align`: An unsigned long specifying the desired alignment for the allocation. Must be an integer power of 2 within the range [1, FD_SPAD_ALIGN] or 0 to use FD_SPAD_ALLOC_ALIGN_DEFAULT. If ASAN or MSAN is enabled, the alignment will be adjusted to meet their requirements.
- **Output**: Returns the maximum number of bytes that can be allocated with the specified alignment. The return value is an unsigned long.
- **See Also**: [`fd_spad_alloc_max_sanitizer_impl`](<fd_spad.c.md#fd_spad_alloc_max_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_frame\_lo\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_frame_lo_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L509>)

Returns the starting address of the current frame in a scratch pad memory.
- **Description**: Use this function to obtain the starting address of the current frame in a scratch pad memory. This function assumes that the scratch pad (`spad`) is a current local join and is in a frame. It is useful for operations that require knowledge of the memory range allocated to the current frame. Ensure that the `spad` is properly initialized and joined before calling this function.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and must point to a valid, joined scratch pad.
- **Output**: Returns a pointer to the first byte of the current frame's memory region in the caller's local address space.
- **See Also**: [`fd_spad_frame_lo_sanitizer_impl`](<fd_spad.c.md#fd_spad_frame_lo_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_frame\_hi\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_frame_hi_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L510>)

Returns the high memory address of the current frame in a scratch pad.
- **Description**: Use this function to get the high memory address of the current frame in a scratch pad memory. This function is useful when you need to know the boundary of the current frame for operations like trimming or preparing new allocations. Ensure that the scratch pad is a current local join and is in a frame before calling this function. The function is designed for high-performance contexts and assumes that the caller has already managed the necessary preconditions.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad. Must not be null and must be a current local join in a frame. The caller retains ownership of the memory.
- **Output**: Returns a pointer to the high memory address of the current frame in the scratch pad. The pointer is in the caller's local address space.
- **See Also**: [`fd_spad_frame_hi_sanitizer_impl`](<fd_spad.c.md#fd_spad_frame_hi_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_push\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_push_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L511>)

Pushes a new frame onto the scratch pad and poisons unused memory.
- **Description**: Use this function to create a new frame in the scratch pad memory and poison any remaining free memory to prevent unintended use. This function is useful in environments where memory sanitization is required to detect memory errors. Ensure that the scratch pad is a current local join and has at least one frame available before calling this function.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad. Must not be null and must be a current local join with at least one frame available.
- **Output**: None
- **See Also**: [`fd_spad_push_sanitizer_impl`](<fd_spad.c.md#fd_spad_push_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_pop\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_pop_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L512>)

Pops the current frame and sanitizes unused memory in a scratch pad.
- **Description**: Use this function to pop the current frame from a scratch pad memory and sanitize the unused memory region. This function is useful in environments where memory sanitization is required to detect memory access errors. It must be called when the scratch pad is in a valid state and joined locally. The function ensures that the memory from the used portion to the maximum allocated memory is poisoned, which helps in identifying invalid memory accesses.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and must point to a valid, joined scratch pad. The caller retains ownership of the memory.
- **Output**: None
- **See Also**: [`fd_spad_pop_sanitizer_impl`](<fd_spad.c.md#fd_spad_pop_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_alloc\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_alloc_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L513>)

Allocates memory from a scratch pad with optional sanitization.
- **Description**: Use this function to allocate a specified size of memory from a scratch pad with a given alignment. It is designed for use in environments where AddressSanitizer (ASAN) or MemorySanitizer (MSAN) is enabled, ensuring that memory is properly poisoned and unpoisoned for sanitization purposes. This function should be called when the scratch pad is in a valid state and joined locally. It automatically adjusts the alignment to meet the minimum requirements of ASAN or MSAN if they are enabled. The function returns a pointer to the allocated memory, which is guaranteed to be aligned as specified. Ensure that the scratch pad has enough free memory to accommodate the requested size and alignment.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad. Must not be null and should be a valid, joined scratch pad.
    - `align`: The desired alignment for the allocation in bytes. Must be a power of 2. If 0, the default alignment `FD_SPAD_ALLOC_ALIGN_DEFAULT` is used. The function adjusts this to meet ASAN or MSAN requirements if necessary.
    - `sz`: The size of the memory to allocate in bytes. Must be within the available memory of the scratch pad.
- **Output**: Returns a pointer to the allocated memory region, aligned as specified. The memory is unpoisoned for use if ASAN or MSAN is enabled.
- **See Also**: [`fd_spad_alloc_sanitizer_impl`](<fd_spad.c.md#fd_spad_alloc_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_trim\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_trim_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L514>)

Sanitizes memory regions after trimming a scratch pad.
- **Description**: Use this function to sanitize memory regions in a scratch pad after trimming operations. It ensures that memory from the specified high address to the maximum memory limit is poisoned, while valid allocations remain unpoisoned. This function is useful in environments where memory sanitization is required, such as when using AddressSanitizer (ASAN) or MemorySanitizer (MSAN). It must be called when the scratch pad is in a valid state and after a trimming operation has been performed.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad. Must not be null and should be a valid, joined scratch pad.
    - `hi`: A pointer to the high address in the scratch pad's memory region. Must be within the range of the current frame's memory.
- **Output**: None
- **See Also**: [`fd_spad_trim_sanitizer_impl`](<fd_spad.c.md#fd_spad_trim_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_prepare\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_prepare_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L515>)

Prepares a memory allocation with sanitization support.
- **Description**: Use this function to prepare a memory allocation in a shared scratch pad memory with optional sanitization support. It adjusts the alignment based on the sanitization mode (ASAN or MSAN) and prepares the memory for allocation. This function is useful when you need to ensure memory is unpoisoned and ready for use in environments where memory sanitization is enabled. Ensure that the scratch pad (`spad`) is a current local join and in a frame before calling this function.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. Must not be null and should be a current local join.
    - `align`: Specifies the desired alignment for the allocation. If greater than 0, it must be a power of 2 and will be adjusted to meet minimum alignment requirements for sanitization. If 0, the default alignment is used.
    - `max`: The maximum number of bytes to prepare for allocation. Must be within the available memory limits of the scratch pad.
- **Output**: Returns a pointer to the prepared memory region, which is unpoisoned and aligned as specified.
- **See Also**: [`fd_spad_prepare_sanitizer_impl`](<fd_spad.c.md#fd_spad_prepare_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_cancel\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_cancel_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L516>)

Cancels any in-progress memory preparations in a scratch pad.
- **Description**: Use this function to cancel any ongoing memory preparations in a scratch pad memory. This function is useful when you need to abort a memory preparation process and ensure that the memory region from `mem_used` to `mem_max` is marked as poisoned, preventing any unintended access. It must be called when the scratch pad is in a preparation state, and it will leave the scratch pad in a frame state without any ongoing preparations.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. It must not be null and should be a valid, joined scratch pad. The function assumes the scratch pad is in a preparation state.
- **Output**: None
- **See Also**: [`fd_spad_cancel_sanitizer_impl`](<fd_spad.c.md#fd_spad_cancel_sanitizer_impl>)  (Implementation)


---
### fd\_spad\_publish\_sanitizer\_impl<!-- {{#callable_declaration:fd_spad_publish_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.h#L517>)

Finalizes a prepared allocation in a scratch pad memory.
- **Description**: Use this function to complete an allocation that was previously prepared in a scratch pad memory. It ensures that the memory region is correctly marked for sanitization tools, such as ASAN and MSAN, by poisoning and unpoisoning the appropriate memory regions. This function must be called after a successful preparation and before any further allocations or operations on the scratch pad. It is important to ensure that the size of the allocation does not exceed the maximum size specified during preparation.
- **Inputs**:
    - `spad`: A pointer to a `fd_spad_t` structure representing the scratch pad memory. Must not be null and must be a valid, joined scratch pad.
    - `sz`: The size in bytes of the allocation to finalize. Must be within the range specified during the preparation phase.
- **Output**: None
- **See Also**: [`fd_spad_publish_sanitizer_impl`](<fd_spad.c.md#fd_spad_publish_sanitizer_impl>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)