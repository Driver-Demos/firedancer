<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions for verifying, debugging, and managing memory allocation in a shared memory space.

# Purpose
The code is a C source file that provides functionality for managing a memory allocation system, specifically a stack-based allocator (`spad`). It includes functions for verifying, resetting, deleting, allocating, and managing memory frames within a `fd_spad_t` structure. The file defines both standard and debug versions of these functions, with the debug versions incorporating additional checks and logging to ensure the integrity of memory operations. The debug functions use macros to select between standard and sanitizer implementations based on compile-time flags (`FD_HAS_DEEPASAN` and `FD_HAS_MSAN`), which are used for memory error detection.

The file includes functions such as [`fd_spad_verify`](<#fd_spad_verify>), which checks the validity of a `spad` structure, and [`fd_spad_alloc_check`](<#fd_spad_alloc_check>), which ensures that memory allocations are within bounds and properly aligned. The sanitizer implementations add further memory safety checks using AddressSanitizer (ASAN) and MemorySanitizer (MSAN) to detect memory errors like buffer overflows and use of uninitialized memory. The code is intended to be part of a larger system where memory management is critical, and it provides both basic and enhanced debugging capabilities to ensure robust memory handling.
# Imports and Dependencies

---
- `fd_spad.h`
- `../log/fd_log.h`


# Functions

---
### fd\_spad\_verify<!-- {{#callable:fd_spad_verify}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L4>)

Verifies the integrity and consistency of a `fd_spad_t` structure.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure to verify.
- **Logic and Control Flow**:
    - Check if `spad` is not NULL and its `magic` field equals `FD_SPAD_MAGIC`.
    - Extract `frame_free` and `mem_used` from `spad` and verify they are within their respective limits.
    - If `frame_free` equals `FD_SPAD_FRAME_MAX`, ensure `mem_used` is zero.
    - Otherwise, verify `mem_used` is greater than or equal to the offset at `frame_free` and ensure offsets are in non-increasing order.
    - Ensure the last offset in `spad->off` is zero.
- **Output**: Returns 0 if the verification is successful, otherwise returns -1 if any test fails.


---
### fd\_spad\_reset\_debug<!-- {{#callable:fd_spad_reset_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L42>)

Resets the shared memory region for debugging purposes using a selected implementation based on sanitizer settings.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory region to reset.
- **Logic and Control Flow**:
    - Calls the `SELECT_DEBUG_IMPL` macro with `fd_spad_reset` as an argument to choose the appropriate implementation function based on the presence of sanitizers.
    - Executes the selected implementation function with `spad` as the argument.
- **Output**: No return value.


---
### fd\_spad\_delete\_debug<!-- {{#callable:fd_spad_delete_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L47>)

Deletes a shared memory space and returns a pointer to the deleted space using a debug implementation.
- **Inputs**:
    - `shspad`: A pointer to the shared memory space to delete.
- **Logic and Control Flow**:
    - Uses the `SELECT_DEBUG_IMPL` macro to choose between a sanitizer implementation or a regular implementation of `fd_spad_delete`.
    - Calls the selected implementation with `shspad` as the argument.
- **Output**: Returns a pointer to the deleted shared memory space.


---
### fd\_spad\_alloc\_max\_debug<!-- {{#callable:fd_spad_alloc_max_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L52>)

Determines the maximum allocatable memory size in a shared memory frame with alignment constraints, while performing debug checks.
- **Inputs**:
    - `spad`: A pointer to a constant `fd_spad_t` structure representing the shared memory frame.
    - `align`: An unsigned long integer specifying the alignment requirement for the memory allocation.
- **Logic and Control Flow**:
    - Checks if the shared memory frame is currently in use by calling `fd_spad_frame_used(spad)`. If not, logs a critical error 'not in a frame'.
    - Validates the alignment by checking if it is a power of two using `fd_ulong_is_pow2(align)`. If not, logs a critical error 'bad align'.
    - Calls the appropriate implementation of `fd_spad_alloc_max` based on the debug configuration using the `SELECT_DEBUG_IMPL` macro, passing `spad` and `align` as arguments.
- **Output**: Returns an unsigned long integer representing the maximum size of memory that can be allocated in the shared memory frame with the specified alignment.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)


---
### fd\_spad\_frame\_lo\_debug<!-- {{#callable:fd_spad_frame_lo_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L60>)

Returns the lower bound of the current frame in a shared memory allocator, with a critical log if not in a frame.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory allocator.
- **Logic and Control Flow**:
    - Check if the `spad` is currently in a frame using `fd_spad_frame_used(spad)`; if not, log a critical error with `FD_LOG_CRIT` and the message 'not in a frame'.
    - Return the result of `SELECT_DEBUG_IMPL(fd_spad_frame_lo)(spad)`, which calls the appropriate implementation of `fd_spad_frame_lo` based on the presence of sanitizers.
- **Output**: A pointer to the lower bound of the current frame in the shared memory allocator.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)


---
### fd\_spad\_frame\_hi\_debug<!-- {{#callable:fd_spad_frame_hi_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L66>)

Returns the high address of the current frame in a shared memory allocator after verifying that a frame is in use.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory allocator.
- **Logic and Control Flow**:
    - Checks if a frame is currently in use by calling `fd_spad_frame_used(spad)`; if not, logs a critical error with the message 'not in a frame'.
    - Calls the appropriate implementation of `fd_spad_frame_hi` based on the presence of sanitizers (`FD_HAS_DEEPASAN` or `FD_HAS_MSAN`) using the `SELECT_DEBUG_IMPL` macro.
    - Returns the result of the `fd_spad_frame_hi` implementation.
- **Output**: A pointer to the high address of the current frame in the shared memory allocator.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)


---
### fd\_spad\_push\_debug<!-- {{#callable:fd_spad_push_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L72>)

Pushes a new frame onto the stack of frames in the `fd_spad_t` structure, logging a critical error if there are too many frames.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure, which represents a stack of frames.
- **Logic and Control Flow**:
    - Check if there is a free frame available in the `spad` structure using `fd_spad_frame_free(spad)`.
    - If no free frame is available, log a critical error with the message 'too many frames' using `FD_LOG_CRIT`.
    - Select the appropriate implementation of `fd_spad_push` based on the presence of sanitizers (`FD_HAS_DEEPASAN` or `FD_HAS_MSAN`) and call it with `spad` as the argument.
- **Output**: No output is returned as the function is of type `void`.
- **Functions Called**:
    - [`fd_spad_frame_free`](<fd_spad.h.md#fd_spad_frame_free>)


---
### fd\_spad\_pop\_debug<!-- {{#callable:fd_spad_pop_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L78>)

Ensures a frame is in use before calling the appropriate implementation of `fd_spad_pop`.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory allocator state.
- **Logic and Control Flow**:
    - Checks if a frame is currently in use by calling [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>) with `spad` as the argument.
    - If no frame is in use, logs a critical error message 'not in a frame' using `FD_LOG_CRIT`.
    - Calls the selected implementation of `fd_spad_pop` using the `SELECT_DEBUG_IMPL` macro with `spad` as the argument.
- **Output**: No return value; the function operates on the `spad` structure.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)


---
### fd\_spad\_alloc\_check<!-- {{#callable:fd_spad_alloc_check}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L84>)

Allocates memory in a shared memory space after verifying frame usage, alignment, and available memory.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the shared memory space.
    - ``align``: An unsigned long specifying the alignment requirement for the memory allocation.
    - ``sz``: An unsigned long specifying the size of the memory to allocate.
- **Logic and Control Flow**:
    - Check if the shared memory space is currently in use by calling `fd_spad_frame_used(spad)`; if not, log a critical error and terminate.
    - Verify that `align` is a power of two using `fd_ulong_is_pow2(align)`; if not, log a critical error and terminate.
    - Calculate the maximum allocatable memory with the given alignment using `fd_spad_alloc_max(spad, align)`.
    - Check if the requested size `sz` exceeds the maximum allocatable memory; if so, log a critical error and terminate.
    - Call the appropriate implementation of `fd_spad_alloc` based on the debug settings to allocate the memory.
- **Output**: Returns a pointer to the allocated memory block if successful, or logs a critical error and terminates if any checks fail.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)
    - [`fd_spad_alloc_max`](<fd_spad.h.md#fd_spad_alloc_max>)


---
### fd\_spad\_trim\_debug<!-- {{#callable:fd_spad_trim_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L95>)

Validates the `hi` pointer against the current frame boundaries of the `spad` and calls the appropriate debug implementation of `fd_spad_trim`.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory area.
    - `hi`: A pointer to the high boundary to validate against the current frame.
- **Logic and Control Flow**:
    - Check if the `spad` is currently in use with [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>); if not, log a critical error and exit.
    - Verify that `hi` is not below the current frame's low boundary using [`fd_spad_frame_lo`](<fd_spad.h.md#fd_spad_frame_lo>); if it is, log a critical error and exit.
    - Verify that `hi` is not above the current frame's high boundary using [`fd_spad_frame_hi`](<fd_spad.h.md#fd_spad_frame_hi>); if it is, log a critical error and exit.
    - Call the selected debug implementation of `fd_spad_trim` with `spad` and `hi` as arguments.
- **Output**: No return value; the function performs validation and calls another function.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)
    - [`fd_spad_frame_lo`](<fd_spad.h.md#fd_spad_frame_lo>)
    - [`fd_spad_frame_hi`](<fd_spad.h.md#fd_spad_frame_hi>)


---
### fd\_spad\_prepare\_debug<!-- {{#callable:fd_spad_prepare_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L104>)

Prepares a debug memory allocation in a shared memory space with specified alignment and maximum size constraints.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory space.
    - `align`: An unsigned long specifying the alignment requirement for the memory allocation.
    - `max`: An unsigned long specifying the maximum size of the memory allocation.
- **Logic and Control Flow**:
    - Checks if the shared memory space is currently in use with `fd_spad_frame_used(spad)`; logs a critical error if not.
    - Validates that `align` is a power of two; logs a critical error if it is not.
    - Ensures that the maximum allocatable size with the given alignment is not less than `max`; logs a critical error if it is.
    - Calls the appropriate implementation of `fd_spad_prepare` based on the debug configuration, passing `spad`, `align`, and `max` as arguments.
- **Output**: Returns a pointer to the prepared memory allocation in the shared memory space.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)
    - [`fd_spad_alloc_max`](<fd_spad.h.md#fd_spad_alloc_max>)


---
### fd\_spad\_cancel\_debug<!-- {{#callable:fd_spad_cancel_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L114>)

Cancels the current frame in a shared memory allocation context if it is in use.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the shared memory allocation context.
- **Logic and Control Flow**:
    - Checks if the current frame in the `spad` is in use by calling `fd_spad_frame_used(spad)`.
    - If the frame is not in use, logs a critical error message 'not in a frame' using `FD_LOG_CRIT`.
    - Calls the appropriate implementation of `fd_spad_cancel` based on the debug configuration using `SELECT_DEBUG_IMPL(fd_spad_cancel)(spad)`.
- **Output**: No return value; the function operates on the `spad` structure to cancel the current frame.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)


---
### fd\_spad\_publish\_debug<!-- {{#callable:fd_spad_publish_debug}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L122>)

Validates the state of a shared memory allocation descriptor and publishes a memory allocation if conditions are met.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the shared memory allocation descriptor.
    - ``sz``: The size of the memory allocation to publish.
- **Logic and Control Flow**:
    - Checks if the `spad` is currently in a frame using [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>); logs a critical error if not.
    - Checks if the maximum allocatable memory in `spad` is less than `sz` using [`fd_spad_alloc_max`](<fd_spad.h.md#fd_spad_alloc_max>); logs a critical error if true.
    - Calls the appropriate implementation of `fd_spad_publish` based on the debug configuration.
- **Output**: No return value; the function logs critical errors if preconditions are not met.
- **Functions Called**:
    - [`fd_spad_frame_used`](<fd_spad.h.md#fd_spad_frame_used>)
    - [`fd_spad_alloc_max`](<fd_spad.h.md#fd_spad_alloc_max>)


---
### fd\_spad\_reset\_sanitizer\_impl<!-- {{#callable:fd_spad_reset_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L136>)

Resets the shared memory region and poisons it for AddressSanitizer (ASAN) and MemorySanitizer (MSAN) checks.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory region to reset and sanitize.
- **Logic and Control Flow**:
    - Calls [`fd_spad_reset_impl`](<fd_spad.h.md#fd_spad_reset_impl>) to reset the shared memory region pointed to by `spad`.
    - Aligns the private memory of `spad` to `FD_ASAN_ALIGN` and poisons it using `fd_asan_poison` for ASAN checks.
    - Aligns the private memory of `spad` to `FD_MSAN_ALIGN` and poisons it using `fd_msan_poison` for MSAN checks.
- **Output**: No return value (void function).
- **Functions Called**:
    - [`fd_spad_reset_impl`](<fd_spad.h.md#fd_spad_reset_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_delete\_sanitizer\_impl<!-- {{#callable:fd_spad_delete_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L145>)

Deletes a shared memory region and unpoisons it using AddressSanitizer (ASAN) and MemorySanitizer (MSAN) tools.
- **Inputs**:
    - `shspad`: A pointer to the shared memory region to delete and unpoison.
- **Logic and Control Flow**:
    - Call [`fd_spad_delete_impl`](<fd_spad.h.md#fd_spad_delete_impl>) with `shspad` to delete the shared memory region and store the result in `deleted_shspad`.
    - Check if `deleted_shspad` is not NULL, indicating successful deletion.
    - Cast `shspad` to `fd_spad_t *` and store it in `spad`.
    - Unpoison the memory region using `fd_asan_unpoison` and `fd_msan_unpoison` functions, aligning the start address using `fd_ulong_align_up` and using `spad->mem_max` as the size.
- **Output**: Returns a pointer to the deleted shared memory region, or NULL if the deletion was unsuccessful.
- **Functions Called**:
    - [`fd_spad_delete_impl`](<fd_spad.h.md#fd_spad_delete_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_alloc\_max\_sanitizer\_impl<!-- {{#callable:fd_spad_alloc_max_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L160>)

Adjusts the alignment for memory allocation based on sanitizer settings and returns the maximum allocatable memory size.
- **Inputs**:
    - ``spad``: A pointer to a constant `fd_spad_t` structure, representing the shared memory allocator.
    - ``align``: An unsigned long integer specifying the desired memory alignment.
- **Logic and Control Flow**:
    - Check if `FD_HAS_DEEPASAN` is defined; if so, set `align` to the maximum of `align` and `FD_ASAN_ALIGN`, or `FD_SPAD_ALLOC_ALIGN_DEFAULT` if `align` is zero.
    - If `FD_HAS_DEEPASAN` is not defined but `FD_HAS_MSAN` is, set `align` to the maximum of `align` and `FD_MSAN_ALIGN`, or `FD_SPAD_ALLOC_ALIGN_DEFAULT` if `align` is zero.
    - Call [`fd_spad_alloc_max_impl`](<fd_spad.h.md#fd_spad_alloc_max_impl>) with `spad` and the adjusted `align` value and return its result.
- **Output**: Returns an unsigned long integer representing the maximum size of memory that can be allocated with the specified alignment.
- **Functions Called**:
    - [`fd_spad_alloc_max_impl`](<fd_spad.h.md#fd_spad_alloc_max_impl>)


---
### fd\_spad\_frame\_lo\_sanitizer\_impl<!-- {{#callable:fd_spad_frame_lo_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L173>)

Returns the result of calling [`fd_spad_frame_lo_impl`](<fd_spad.h.md#fd_spad_frame_lo_impl>) with the given `spad` argument.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure, which represents a shared memory allocation descriptor.
- **Logic and Control Flow**:
    - Calls the function [`fd_spad_frame_lo_impl`](<fd_spad.h.md#fd_spad_frame_lo_impl>) with the `spad` argument.
    - Returns the result of the [`fd_spad_frame_lo_impl`](<fd_spad.h.md#fd_spad_frame_lo_impl>) function call.
- **Output**: A pointer returned by the [`fd_spad_frame_lo_impl`](<fd_spad.h.md#fd_spad_frame_lo_impl>) function, which is typically a memory address within the shared memory allocation.
- **Functions Called**:
    - [`fd_spad_frame_lo_impl`](<fd_spad.h.md#fd_spad_frame_lo_impl>)


---
### fd\_spad\_frame\_hi\_sanitizer\_impl<!-- {{#callable:fd_spad_frame_hi_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L178>)

Returns the result of [`fd_spad_frame_hi_impl`](<fd_spad.h.md#fd_spad_frame_hi_impl>) for the given `spad`.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure, representing the shared memory region to operate on.
- **Logic and Control Flow**:
    - Calls the function [`fd_spad_frame_hi_impl`](<fd_spad.h.md#fd_spad_frame_hi_impl>) with the `spad` argument.
    - Returns the result of the [`fd_spad_frame_hi_impl`](<fd_spad.h.md#fd_spad_frame_hi_impl>) function.
- **Output**: A pointer to the high frame boundary within the shared memory region, as returned by [`fd_spad_frame_hi_impl`](<fd_spad.h.md#fd_spad_frame_hi_impl>).
- **Functions Called**:
    - [`fd_spad_frame_hi_impl`](<fd_spad.h.md#fd_spad_frame_hi_impl>)


---
### fd\_spad\_push\_sanitizer\_impl<!-- {{#callable:fd_spad_push_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L183>)

Executes a push operation on a shared memory allocator and poisons the remaining free memory to prevent any in-progress preparations.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory allocator.
- **Logic and Control Flow**:
    - Calls [`fd_spad_push_impl`](<fd_spad.h.md#fd_spad_push_impl>) with `spad` to perform the push operation.
    - Calculates the address to start poisoning by aligning the sum of the private memory base and `mem_used` to `FD_ASAN_ALIGN`.
    - Poisons the memory from the calculated address to the end of the available memory (`mem_max - mem_used`) using `fd_asan_poison`.
- **Output**: No return value.
- **Functions Called**:
    - [`fd_spad_push_impl`](<fd_spad.h.md#fd_spad_push_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_pop\_sanitizer\_impl<!-- {{#callable:fd_spad_pop_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L191>)

Executes a pop operation on a shared memory region and poisons the unused memory area for debugging purposes.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory region.
- **Logic and Control Flow**:
    - Calls [`fd_spad_pop_impl`](<fd_spad.h.md#fd_spad_pop_impl>) with `spad` to perform the pop operation on the shared memory region.
    - Calculates the starting address for poisoning by aligning the address of the memory region from `mem_used` to `mem_max` using `fd_ulong_align_up`.
    - Poisons the memory region from the calculated starting address to `mem_max` using `fd_asan_poison` and `fd_msan_poison` to help detect memory errors.
- **Output**: No return value.
- **Functions Called**:
    - [`fd_spad_pop_impl`](<fd_spad.h.md#fd_spad_pop_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_alloc\_sanitizer\_impl<!-- {{#callable:fd_spad_alloc_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L200>)

Allocates memory with specified alignment and size, applying sanitizer-specific memory poisoning and unpoisoning.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the memory space allocator.
    - ``align``: The desired alignment for the memory allocation.
    - ``sz``: The size of the memory to allocate.
- **Logic and Control Flow**:
    - Check if `FD_HAS_DEEPASAN` or `FD_HAS_MSAN` is defined to determine the sanitizer in use.
    - Adjust the `align` value to ensure it meets the minimum alignment requirements for the active sanitizer.
    - Call [`fd_spad_alloc_impl`](<fd_spad.h.md#fd_spad_alloc_impl>) to allocate memory with the specified alignment and size.
    - Calculate the remaining memory from the allocated buffer to the maximum memory limit.
    - Poison the memory from the allocated buffer to the maximum memory limit using `fd_asan_poison`.
    - Unpoison the allocated memory region using `fd_asan_unpoison` and `fd_msan_unpoison`.
- **Output**: Returns a pointer to the allocated memory buffer.
- **Functions Called**:
    - [`fd_spad_alloc_impl`](<fd_spad.h.md#fd_spad_alloc_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_trim\_sanitizer\_impl<!-- {{#callable:fd_spad_trim_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L225>)

Sanitizes memory regions in a shared memory allocator by poisoning and unpoisoning memory based on the current allocation state.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the shared memory allocator.
    - ``hi``: A pointer indicating the high watermark of memory usage in the allocator.
- **Logic and Control Flow**:
    - Calls [`fd_spad_trim_impl`](<fd_spad.h.md#fd_spad_trim_impl>) to adjust the high watermark of memory usage.
    - If `FD_HAS_DEEPASAN` is defined, aligns `hi` down to the nearest `FD_ASAN_ALIGN` boundary and checks if it falls within a valid allocation.
    - Poisons memory from the aligned `hi` to `mem_max` using `fd_asan_poison`.
    - If `hi` was within a valid allocation, unpoisons the memory region from the aligned `hi` to the original `hi` using `fd_asan_unpoison`.
    - Poisons memory from the next 4-byte aligned address after `hi` to `mem_max` using `fd_msan_poison`.
- **Output**: No return value; the function modifies memory regions in place.
- **Functions Called**:
    - [`fd_spad_trim_impl`](<fd_spad.h.md#fd_spad_trim_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_prepare\_sanitizer\_impl<!-- {{#callable:fd_spad_prepare_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L254>)

Prepares a memory buffer with specified alignment and size, ensuring memory is unpoisoned for use with AddressSanitizer (ASAN) or MemorySanitizer (MSAN).
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the shared memory area to prepare.
    - ``align``: The desired alignment for the memory buffer, which will be adjusted to meet minimum alignment requirements for ASAN or MSAN.
    - ``max``: The maximum size of the memory buffer to prepare.
- **Logic and Control Flow**:
    - Check if ASAN or MSAN is enabled and adjust `align` to meet the minimum alignment requirements (`FD_ASAN_ALIGN` or `FD_MSAN_ALIGN`).
    - Call [`fd_spad_prepare_impl`](<fd_spad.h.md#fd_spad_prepare_impl>) with the adjusted `align` and `max` to prepare the memory buffer.
    - Unpoison the memory starting at the returned buffer address using `fd_asan_unpoison`, covering the range from the buffer to the end of the available memory (`spad->mem_max - spad->mem_used`).
- **Output**: Returns a pointer to the prepared memory buffer, which is guaranteed to be 8-byte aligned and unpoisoned for use.
- **Functions Called**:
    - [`fd_spad_prepare_impl`](<fd_spad.h.md#fd_spad_prepare_impl>)


---
### fd\_spad\_cancel\_sanitizer\_impl<!-- {{#callable:fd_spad_cancel_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L272>)

Cancels any in-progress memory preparations and poisons the memory region from `mem_used` to `mem_max` in the `spad` structure.
- **Inputs**:
    - `spad`: A pointer to an `fd_spad_t` structure representing the shared memory area to be sanitized.
- **Logic and Control Flow**:
    - Calls [`fd_spad_cancel_impl`](<fd_spad.h.md#fd_spad_cancel_impl>) with `spad` to perform the cancellation of any in-progress operations.
    - Calculates the memory region to poison by adding `spad->mem_used` to the base address of the private memory obtained from `fd_spad_private_mem(spad)`.
    - Calls `fd_asan_poison` to poison the memory region from `mem_used` to `mem_max` to prevent any further operations on this memory.
- **Output**: No return value; the function operates directly on the memory pointed to by `spad`.
- **Functions Called**:
    - [`fd_spad_cancel_impl`](<fd_spad.h.md#fd_spad_cancel_impl>)
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)


---
### fd\_spad\_publish\_sanitizer\_impl<!-- {{#callable:fd_spad_publish_sanitizer_impl}} -->
[View Source →](<../../../../../src/util/spad/fd_spad.c#L280>)

Manages memory sanitization by poisoning and unpoisoning memory regions during the publish operation.
- **Inputs**:
    - ``spad``: A pointer to an `fd_spad_t` structure representing the shared memory area.
    - ``sz``: The size of the memory region to unpoison.
- **Logic and Control Flow**:
    - Save the current memory usage offset from `spad->mem_used` to `off` and calculate the buffer start address `buf`.
    - Call [`fd_spad_publish_impl`](<fd_spad.h.md#fd_spad_publish_impl>) to perform the publish operation with the given size `sz`.
    - Poison the memory from `buf` to `spad->mem_max` to cancel any in-progress prepare operations.
    - Unpoison the allocated memory region starting at `buf` for the size `sz`, ensuring it is 8-byte aligned.
- **Output**: No return value; the function operates on the memory region pointed to by `spad`.
- **Functions Called**:
    - [`fd_spad_private_mem`](<fd_spad.h.md#fd_spad_private_mem>)
    - [`fd_spad_publish_impl`](<fd_spad.h.md#fd_spad_publish_impl>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)