<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements statistical functions and sorting algorithms for various data types, including robust fitting.

# Purpose
The code provides statistical and sorting functionalities for various data types in C. It defines a macro `FD_STAT_IMPL` to generate functions for filtering and calculating the median of arrays of different types, such as `schar`, `short`, `int`, `long`, `uchar`, `ushort`, `uint`, `ulong`, `float`, and optionally `int128`, `uint128`, and `double` if supported. The filtering function, `fd_stat_filter_##T`, removes elements from an array that exceed a specified threshold, while the median function, `fd_stat_median_##T`, calculates the median of an array. The code also includes functions for robust statistical fitting, such as [`fd_stat_robust_norm_fit_float`](<#fd_stat_robust_norm_fit_float>) and [`fd_stat_robust_exp_fit_float`](<#fd_stat_robust_exp_fit_float>), which estimate parameters like mean and standard deviation or exponential decay parameters from data, using robust statistical methods.

Additionally, the code includes sorting functionality for ascending and descending order for the same set of data types. It uses a template-based approach to include sorting implementations from an external file, `fd_sort.c`, by defining macros such as `SORT_NAME`, `SORT_KEY_T`, and `SORT_IMPL_STYLE`. The sorting functions are generated for both ascending (`fd_sort_up_##T`) and descending (`fd_sort_dn_##T`) orders. This modular approach allows the code to handle a wide range of data types and operations, making it suitable for statistical analysis and data processing tasks.
# Imports and Dependencies

---
- `fd_stat.h`
- `../tmpl/fd_sort.c`


# Global Variables

---
### j
- **Type**: ``ulong``
- **Description**: `j` is a variable of type `ulong` that is initialized to 0. It is used to count the number of elements in the array `x` that meet a certain condition.
- **Use**: `j` increments when an element in `x` has an absolute value less than or equal to `thresh`, and it is returned as the result of the function.


# Functions

---
### fd\_stat\_robust\_norm\_fit\_float<!-- {{#callable:fd_stat_robust_norm_fit_float}} -->
[View Source →](<../../../../../src/util/math/fd_stat.c#L49>)

Estimates the robust mean and standard deviation of a dataset after filtering out extreme values.
- **Inputs**:
    - `opt_mu`: Pointer to store the estimated mean; can be NULL if not needed.
    - `opt_sigma`: Pointer to store the estimated standard deviation; can be NULL if not needed.
    - `x`: Pointer to the input array of float data.
    - `cnt`: Number of elements in the input array.
    - `scratch`: Pointer to a scratch space used for intermediate calculations.
- **Logic and Control Flow**:
    - Cast the `scratch` pointer to a float pointer `y`.
    - Filter the input data `x` using `fd_stat_filter_float` with a threshold of `FLT_MAX/5.f` to remove extreme values, updating `cnt`.
    - Check if either `opt_mu` or `opt_sigma` is not NULL.
    - Calculate the median of the filtered data `y` using `fd_stat_median_float`.
    - If `opt_mu` is not NULL, store the median in `*opt_mu`.
    - If `opt_sigma` is not NULL, compute the absolute deviations from the median, calculate the median of these deviations, and store the scaled result in `*opt_sigma`.
    - Return the count of filtered data points `cnt`.
- **Output**: Returns the number of data points remaining after filtering.


---
### fd\_stat\_robust\_exp\_fit\_float<!-- {{#callable:fd_stat_robust_exp_fit_float}} -->
[View Source →](<../../../../../src/util/math/fd_stat.c#L87>)

Estimates the parameters of a robust exponential distribution fit for a given set of float data points.
- **Inputs**:
    - `opt_x0`: Pointer to store the estimated x0 parameter of the distribution, or NULL if not needed.
    - `opt_tau`: Pointer to store the estimated tau parameter of the distribution, or NULL if not needed.
    - `x`: Pointer to the array of float data points to fit.
    - `cnt`: Number of elements in the array `x`.
    - `scratch`: Pointer to a scratch space used for intermediate calculations.
- **Logic and Control Flow**:
    - Cast `scratch` to a float pointer `y`.
    - Filter the input data `x` using `fd_stat_filter_float` with a threshold of `FLT_MAX/5.f`, storing the result in `y` and updating `cnt`.
    - Check if either `opt_x0` or `opt_tau` is not NULL.
    - Compute the median of the filtered data `y` using `fd_stat_median_float`.
    - Calculate the absolute deviation of each element in `y` from the median and store it back in `y`.
    - Compute the median absolute deviation (MAD) of the updated `y`.
    - If `opt_x0` is not NULL, calculate and store the estimated x0 parameter using the formula `med - mad*1.44042009041256f`.
    - If `opt_tau` is not NULL, calculate and store the estimated tau parameter using the formula `mad*2.07808692123503f`.
- **Output**: Returns the number of data points after filtering.


---
### fd\_stat\_robust\_norm\_fit\_double<!-- {{#callable:fd_stat_robust_norm_fit_double}} -->
[View Source →](<../../../../../src/util/math/fd_stat.c#L121>)

Estimates the robust mean and standard deviation of a dataset using median and median absolute deviation.
- **Inputs**:
    - `opt_mu`: Pointer to store the estimated mean; can be NULL if not needed.
    - `opt_sigma`: Pointer to store the estimated standard deviation; can be NULL if not needed.
    - `x`: Pointer to the input array of double values.
    - `cnt`: Number of elements in the input array.
    - `scratch`: Pointer to a scratch space used for intermediate calculations.
- **Logic and Control Flow**:
    - Cast `scratch` to a `double` pointer and store it in `y`.
    - Filter the input array `x` into `y` using `fd_stat_filter_double`, reducing `cnt` based on a threshold of `DBL_MAX/5`.
    - Check if either `opt_mu` or `opt_sigma` is not NULL.
    - Calculate the median of `y` using `fd_stat_median_double` and store it in `mu`.
    - If `opt_mu` is not NULL, store `mu` in `*opt_mu`.
    - If `opt_sigma` is not NULL, compute the absolute deviation of each element in `y` from `mu`, then calculate the median of these deviations, multiply by 1.48260221850560, and store the result in `*opt_sigma`.
- **Output**: Returns the number of elements remaining after filtering.


---
### fd\_stat\_robust\_exp\_fit\_double<!-- {{#callable:fd_stat_robust_exp_fit_double}} -->
[View Source →](<../../../../../src/util/math/fd_stat.c#L141>)

Estimates the parameters of a robust exponential distribution fit for a given dataset.
- **Inputs**:
    - `opt_x0`: Pointer to store the estimated x0 parameter; can be NULL if not needed.
    - `opt_tau`: Pointer to store the estimated tau parameter; can be NULL if not needed.
    - `x`: Pointer to the input data array of doubles.
    - `cnt`: Number of elements in the input data array.
    - `scratch`: Pointer to a scratch space used for intermediate calculations.
- **Logic and Control Flow**:
    - Cast the `scratch` pointer to a `double` pointer `y`.
    - Filter the input data `x` into `y` using `fd_stat_filter_double`, with a threshold of `DBL_MAX/5.0`, updating `cnt` to the number of valid elements.
    - Check if either `opt_x0` or `opt_tau` is not NULL.
    - Calculate the median of the filtered data `y` using `fd_stat_median_double`.
    - For each element in `y`, replace it with its absolute deviation from the median.
    - Calculate the median absolute deviation (MAD) of `y`.
    - If `opt_x0` is not NULL, compute `*opt_x0` as `med - mad*1.44042009041256`.
    - If `opt_tau` is not NULL, compute `*opt_tau` as `mad*2.07808692123503`.
    - Return the updated `cnt`.
- **Output**: Returns the number of elements in the filtered dataset.



---
Made with ❤️ by [Driver](https://www.driver.ai/)