<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for statistical operations, including averaging, filtering, median calculation, robust fitting, and sorting.

# Purpose
The code in this file provides a collection of statistical and sorting functions for various data types in C. It includes functions to compute the average of two numbers (`fd_stat_avg2_T`) for different integer and floating-point types, ensuring no intermediate overflow occurs. The file also defines functions for filtering and computing the median of arrays (`fd_stat_filter_T` and `fd_stat_median_T`), with special handling for floating-point numbers to exclude NaN values. Additionally, it includes robust statistical estimators for normal and exponential distributions ([`fd_stat_robust_norm_fit_float`](<#fd_stat_robust_norm_fit_float>) and [`fd_stat_robust_exp_fit_float`](<#fd_stat_robust_exp_fit_float>)), which are designed to handle data with potential outliers.

The file also declares and includes implementations for sorting functions for various primitive types, both in ascending and descending order. These sorting functions are implemented using a template-based approach, as indicated by the inclusion of `fd_sort.c` with different macro definitions for each data type. The file is structured as a C header file, intended to be included in other C source files, and it defines a public API for statistical operations and sorting, with conditional compilation for extended data types like `int128` and `double` based on the availability of these types in the environment.
# Imports and Dependencies

---
- `../bits/fd_bits.h`
- `../tmpl/fd_sort.c`


# Functions

---
### fd\_stat\_avg2\_schar<!-- {{#callable:fd_stat_avg2_schar}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L6>)

Computes the average of two `schar` values without risk of intermediate overflow.
- **Inputs**:
    - `x`: The first `schar` value to average.
    - `y`: The second `schar` value to average.
- **Logic and Control Flow**:
    - Casts both `x` and `y` to `long` to prevent overflow during addition.
    - Adds the two `long` values together.
    - Shifts the result right by 1 to divide by 2, effectively computing the average.
    - Casts the result back to `schar` before returning.
- **Output**: Returns the average of the two input `schar` values as a `schar`, rounded toward negative infinity.


---
### fd\_stat\_avg2\_short<!-- {{#callable:fd_stat_avg2_short}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L16>)

Computes the average of two `short` integers without risk of intermediate overflow.
- **Inputs**:
    - `x`: A `short` integer representing the first number.
    - `y`: A `short` integer representing the second number.
- **Logic and Control Flow**:
    - Casts both `x` and `y` to `long` to prevent overflow during addition.
    - Adds the two `long` integers.
    - Shifts the result right by one bit to divide by two, effectively computing the average.
    - Casts the result back to `short`.
- **Output**: Returns the average of `x` and `y` as a `short` integer.


---
### fd\_stat\_avg2\_int<!-- {{#callable:fd_stat_avg2_int}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L17>)

Computes the average of two integers without risk of intermediate overflow by using bitwise operations.
- **Inputs**:
    - `x`: An integer value to be averaged.
    - `y`: Another integer value to be averaged.
- **Logic and Control Flow**:
    - Casts both `x` and `y` to `long` to prevent overflow during addition.
    - Adds the two `long` values together.
    - Shifts the result right by one bit to divide by two, effectively computing the average.
- **Output**: Returns the average of the two input integers as an `int`, rounded towards negative infinity.


---
### fd\_stat\_avg2\_uchar<!-- {{#callable:fd_stat_avg2_uchar}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L18>)

Calculates the average of two `uchar` values without risk of intermediate overflow.
- **Inputs**:
    - `x`: The first `uchar` value to average.
    - `y`: The second `uchar` value to average.
- **Logic and Control Flow**:
    - Casts both `x` and `y` to `ulong` to prevent overflow during addition.
    - Adds the two `ulong` values.
    - Shifts the result right by one bit to divide by two, effectively calculating the average.
    - Casts the result back to `uchar`.
- **Output**: Returns the average of the two input `uchar` values as a `uchar`.


---
### fd\_stat\_avg2\_ushort<!-- {{#callable:fd_stat_avg2_ushort}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L19>)

Calculates the average of two `ushort` values without risk of intermediate overflow.
- **Inputs**:
    - `x`: The first `ushort` value to average.
    - `y`: The second `ushort` value to average.
- **Logic and Control Flow**:
    - Casts both `x` and `y` to `ulong` to prevent overflow during addition.
    - Adds the two `ulong` values together.
    - Shifts the result right by 1 bit to divide by 2, effectively calculating the average.
    - Casts the result back to `ushort` before returning.
- **Output**: Returns the average of the two input `ushort` values as a `ushort`.


---
### fd\_stat\_avg2\_uint<!-- {{#callable:fd_stat_avg2_uint}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L20>)

Calculates the average of two unsigned integers without risk of intermediate overflow.
- **Inputs**:
    - `x`: An unsigned integer value.
    - `y`: Another unsigned integer value.
- **Logic and Control Flow**:
    - Casts both `x` and `y` to `ulong` to prevent overflow during addition.
    - Adds the two `ulong` values together.
    - Shifts the result right by one bit to divide by two, effectively calculating the average.
- **Output**: Returns the average of the two input unsigned integers as a `uint`.


---
### fd\_stat\_avg2\_long<!-- {{#callable:fd_stat_avg2_long}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L21>)

Computes the average of two `long` integers without risk of intermediate overflow, rounding towards negative infinity.
- **Inputs**:
    - `x`: A `long` integer, the first number to average.
    - `y`: A `long` integer, the second number to average.
- **Logic and Control Flow**:
    - Right shifts `x` by 1 to divide it by 2, effectively halving the value.
    - Right shifts `y` by 1 to divide it by 2, effectively halving the value.
    - Adds the halved values of `x` and `y`.
    - Checks if both `x` and `y` are odd by using bitwise AND with `1L`, and adds 1 if true to account for rounding towards negative infinity.
- **Output**: Returns the average of `x` and `y` as a `long` integer.


---
### fd\_stat\_avg2\_ulong<!-- {{#callable:fd_stat_avg2_ulong}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L22>)

Calculates the average of two unsigned long integers without risk of intermediate overflow.
- **Inputs**:
    - `x`: An unsigned long integer.
    - `y`: An unsigned long integer.
- **Logic and Control Flow**:
    - Right shifts `x` by 1 to divide it by 2.
    - Right shifts `y` by 1 to divide it by 2.
    - Adds the results of the right shifts.
    - Checks if both `x` and `y` are odd by using bitwise AND with `1UL`, and adds 1 if true.
- **Output**: Returns the average of `x` and `y` as an unsigned long integer, rounded towards negative infinity.


---
### fd\_stat\_avg2\_int128<!-- {{#callable:fd_stat_avg2_int128}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L24>)

Calculates the average of two `int128` numbers without risk of intermediate overflow, rounding towards negative infinity.
- **Inputs**:
    - `x`: The first `int128` integer to average.
    - `y`: The second `int128` integer to average.
- **Logic and Control Flow**:
    - Right shifts `x` and `y` by 1 to divide them by 2, effectively halving each value.
    - Adds the halved values of `x` and `y`.
    - Checks the least significant bit of both `x` and `y` using bitwise AND with 1 to determine if both are odd.
    - If both `x` and `y` are odd, adds 1 to the result to account for rounding towards negative infinity.
- **Output**: Returns the average of `x` and `y` as an `int128` integer.


---
### fd\_stat\_avg2\_uint128<!-- {{#callable:fd_stat_avg2_uint128}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L25>)

Calculates the average of two `uint128` numbers without risk of intermediate overflow.
- **Inputs**:
    - `x`: The first `uint128` number to average.
    - `y`: The second `uint128` number to average.
- **Logic and Control Flow**:
    - Right shifts `x` and `y` by 1 to divide them by 2, effectively halving each number.
    - Adds the halved values of `x` and `y`.
    - Adds 1 to the result if both `x` and `y` are odd, ensuring correct rounding.
- **Output**: Returns the average of `x` and `y` as a `uint128` value.


---
### fd\_stat\_avg2\_float<!-- {{#callable:fd_stat_avg2_float}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L27>)

Calculates the average of two floating-point numbers.
- **Inputs**:
    - `x`: The first floating-point number.
    - `y`: The second floating-point number.
- **Logic and Control Flow**:
    - Multiplies `x` by 0.5f to get half of `x`.
    - Multiplies `y` by 0.5f to get half of `y`.
    - Adds the two results to compute the average of `x` and `y`.
- **Output**: Returns the average of the two input floating-point numbers as a `float`.


---
### fd\_stat\_avg2\_double<!-- {{#callable:fd_stat_avg2_double}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L29>)

Calculates the average of two double precision floating-point numbers.
- **Inputs**:
    - `x`: A double precision floating-point number.
    - `y`: A double precision floating-point number.
- **Logic and Control Flow**:
    - Multiplies `x` by 0.5 to get half of `x`.
    - Multiplies `y` by 0.5 to get half of `y`.
    - Adds the two results to compute the average of `x` and `y`.
- **Output**: Returns the average of the two input double precision floating-point numbers as a double.


# Function Declarations (Public API)

---
### fd\_stat\_robust\_norm\_fit\_float<!-- {{#callable_declaration:fd_stat_robust_norm_fit_float}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L103>)

Estimates the mean and RMS of a dataset with robust filtering.
- **Description**: Use this function to estimate the mean and root mean square (RMS) of a dataset, assuming most data points are independent and identically distributed (IID) from a normal distribution, with some potentially corrupted data. The function filters out extreme values and NaNs, using only samples with magnitudes less than FLT_MAX/5. It returns the number of valid data points used in the estimation. If `opt_mu` is provided, it stores the mean estimate, and if `opt_sigma` is provided, it stores the RMS estimate. Both estimates are guaranteed to be finite. If no valid samples exist, both estimates default to zero. The `scratch` parameter is used for temporary storage and will be modified.
- **Inputs**:
    - `opt_mu`: Pointer to store the mean estimate. Can be null if the mean is not needed. Caller retains ownership.
    - `opt_sigma`: Pointer to store the RMS estimate. Can be null if the RMS is not needed. Caller retains ownership.
    - `x`: Pointer to the array of float samples to analyze. Must not be null. Caller retains ownership.
    - `cnt`: Number of samples in the array `x`. Must be non-negative.
    - `scratch`: Pointer to a float-aligned memory region with space for up to `cnt` floats. Used for temporary storage and will be modified. Can be the same as `x` if in-place operation is acceptable.
- **Output**: Returns the number of valid data points used in the estimation.
- **See Also**: [`fd_stat_robust_norm_fit_float`](<fd_stat.c.md#fd_stat_robust_norm_fit_float>)  (Implementation)


---
### fd\_stat\_robust\_exp\_fit\_float<!-- {{#callable_declaration:fd_stat_robust_exp_fit_float}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L116>)

Estimates parameters of a shifted exponential distribution from sample data.
- **Description**: Use this function to estimate the minimum and decay length of a shifted exponential distribution from a set of sample data. It is designed to handle data with potential outliers by filtering out extreme values. The function requires a scratch space for temporary data storage, which can be the same as the input data if in-place operation is acceptable. It returns the number of valid samples used in the estimation. If no valid samples are found, the estimated parameters default to zero.
- **Inputs**:
    - `opt_x0`: Pointer to store the estimated minimum of the distribution. Can be null if the estimate is not needed. If provided, the function writes the result to this location.
    - `opt_tau`: Pointer to store the estimated decay length of the distribution. Can be null if the estimate is not needed. If provided, the function writes the result to this location.
    - `x`: Pointer to an array of floats representing the sample data. The array must contain at least 'cnt' elements. The function does not modify this data.
    - `cnt`: Number of elements in the sample data array. Must be non-zero for meaningful estimation.
    - `scratch`: Pointer to a float-aligned memory region with space for up to 'cnt' floats. This space is used for temporary data storage and will be overwritten. Can be the same as 'x' if in-place operation is acceptable.
- **Output**: Returns the number of valid samples used in the estimation, which is a subset of the input data after filtering.
- **See Also**: [`fd_stat_robust_exp_fit_float`](<fd_stat.c.md#fd_stat_robust_exp_fit_float>)  (Implementation)


---
### fd\_stat\_robust\_norm\_fit\_double<!-- {{#callable_declaration:fd_stat_robust_norm_fit_double}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L127>)

Estimates the mean and standard deviation of a dataset with robustness to outliers.
- **Description**: Use this function to estimate the mean and standard deviation of a dataset, assuming most data points are independent and identically distributed (IID) from a normal distribution, with some potentially corrupted outliers. The function filters out extreme values and computes robust estimates, making it suitable for datasets with outliers. It returns the number of data points used in the estimation. Ensure that the `scratch` buffer has enough space for `cnt` doubles and that it is aligned correctly. The function can handle cases where no valid samples are present by setting the estimates to zero.
- **Inputs**:
    - `opt_mu`: A pointer to a double where the function will store the estimated mean. Can be null if the mean is not needed. Caller retains ownership.
    - `opt_sigma`: A pointer to a double where the function will store the estimated standard deviation. Can be null if the standard deviation is not needed. Caller retains ownership.
    - `x`: A pointer to an array of doubles representing the dataset. The array must contain at least `cnt` elements. Caller retains ownership.
    - `cnt`: The number of elements in the dataset `x`. Must be non-negative.
    - `scratch`: A pointer to a memory region with space for `cnt` doubles. This buffer will be used for intermediate calculations and will be modified. Caller retains ownership.
- **Output**: Returns the number of data points used in the estimation, which is a subset of the input data after filtering.
- **See Also**: [`fd_stat_robust_norm_fit_double`](<fd_stat.c.md#fd_stat_robust_norm_fit_double>)  (Implementation)


---
### fd\_stat\_robust\_exp\_fit\_double<!-- {{#callable_declaration:fd_stat_robust_exp_fit_double}} -->
[View Source →](<../../../../../src/util/math/fd_stat.h#L134>)

Estimates parameters of a shifted exponential distribution from double precision data.
- **Description**: Use this function to estimate the minimum and decay length of a shifted exponential distribution from a dataset of double precision values. It is designed to handle datasets where most values are independent and identically distributed (IID) samples from the distribution, with some potentially corrupted values. The function filters out values with a magnitude greater than `DBL_MAX/5` and computes estimates based on the median and median absolute deviation of the filtered data. It returns the number of valid samples used in the estimation. Ensure that `scratch` has enough space for `cnt` doubles and that it is aligned appropriately. The function can operate in-place if `x` is passed as `scratch`.
- **Inputs**:
    - `opt_x0`: A pointer to store the estimated minimum of the distribution. Can be null if the estimate is not needed. If not null, the function writes the estimate to the location pointed by this parameter.
    - `opt_tau`: A pointer to store the estimated decay length of the distribution. Can be null if the estimate is not needed. If not null, the function writes the estimate to the location pointed by this parameter.
    - `x`: A pointer to an array of double precision values representing the dataset. The array must contain at least `cnt` elements. The function does not modify this array.
    - `cnt`: The number of elements in the array `x`. Must be a non-negative value.
    - `scratch`: A pointer to a memory region with space for at least `cnt` doubles. This region is used for temporary storage and will be modified by the function. It must be aligned for double precision data.
- **Output**: Returns the number of valid samples used in the estimation, which is the count of elements in `x` with magnitude less than `DBL_MAX/5`.
- **See Also**: [`fd_stat_robust_exp_fit_double`](<fd_stat.c.md#fd_stat_robust_exp_fit_double>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)