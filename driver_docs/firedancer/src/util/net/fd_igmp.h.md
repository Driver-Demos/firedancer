<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for handling IGMP messages in an IPv4 network.

# Purpose
The code is a C header file that defines structures and functions for handling Internet Group Management Protocol (IGMP) messages within an IPv4 network. It provides definitions for different IGMP message types, such as `FD_IGMP_TYPE_QUERY`, `FD_IGMP_TYPE_V1_REPORT`, `FD_IGMP_TYPE_V2_REPORT`, and `FD_IGMP_TYPE_V2_LEAVE`, which correspond to various IGMP operations like querying multicast group membership and reporting membership status to routers. The file includes a union `fd_igmp` that represents an IGMP message, containing fields for the message type, response time, checksum, and multicast group address.

The file also defines a structure [`fd_ip4_igmp`](<#fd_ip4_igmp>) that combines an IPv4 header with an IGMP message, facilitating the construction and parsing of IGMP packets. The function [`fd_igmp_check`](<#fd_igmp_check>) is provided to compute and validate the checksum of an IGMP message, ensuring data integrity. Another function, [`fd_ip4_igmp`](<#fd_ip4_igmp>), is used to populate a memory region with a well-formed IPv4/IGMP message, specifying source and destination addresses, IGMP type, response time, and group address. This header file is intended to be included in other C source files that require IGMP message handling capabilities.
# Imports and Dependencies

---
- `fd_ip4.h`


# Data Structures

---
### fd\_igmp
- **Type**: ``union``
- **Members**:
    - ``type``: Specifies the IGMP type.
    - ``resp``: Indicates the response time or is ignored based on IGMP version.
    - ``check``: Holds the IGMP checksum in invariant order.
    - ``group``: Represents the IGMP group as an IP4 multicast address.
    - ``u``: An array used for checksum calculations.
- **Description**: The `fd_igmp` union is a data structure that represents an Internet Group Management Protocol (IGMP) message. It contains a nested structure with fields for the IGMP type, response time, checksum, and group address, as well as an array for checksum calculations. This union allows for efficient manipulation and validation of IGMP messages, which are used in network communication to manage multicast group memberships.


---
### fd\_igmp\_t
- **Type**: ``union``
- **Members**:
    - ``type``: Specifies the IGMP type.
    - ``resp``: Indicates the response time or is ignored based on IGMP version.
    - ``check``: Holds the IGMP checksum.
    - ``group``: Represents the IGMP group as an IP4 multicast address.
    - ``u``: An array used for checksum calculations.
- **Description**: A `union` that represents an IGMP message, containing fields for the message type, response time, checksum, and multicast group address, with an additional array for checksum calculations.


---
### fd\_ip4\_igmp
- **Type**: ``struct``
- **Members**:
    - ``ip4``: An array of one `fd_ip4_hdr_t` structure representing the IPv4 header.
    - ``opt``: An array of four `uchar` values representing options.
    - ``igmp``: An array of one `fd_igmp_t` structure representing the IGMP message.
- **Description**: Combines an IPv4 header, options, and an IGMP message into a single structure for network communication.


---
### fd\_ip4\_igmp\_t
- **Type**: ``struct``
- **Members**:
    - ``ip4``: An array of one `fd_ip4_hdr_t` structure representing the IPv4 header.
    - ``opt``: An array of four `uchar` values representing options.
    - ``igmp``: An array of one `fd_igmp_t` union representing the IGMP message.
- **Description**: Combines an IPv4 header, options, and an IGMP message into a single structure for handling IGMP messages over IPv4 networks.


# Functions

---
### fd\_igmp\_check<!-- {{#callable:fd_igmp_check}} -->
[View Source →](<../../../../../src/util/net/fd_igmp.h#L47>)

Computes and validates the IGMP checksum for a given IGMP message.
- **Inputs**:
    - `igmp`: A pointer to a `fd_igmp_t` structure representing the IGMP message to check.
- **Logic and Control Flow**:
    - Retrieve the first two 32-bit words of the IGMP message using the `u` array from the `fd_igmp_t` structure.
    - Sum the two 32-bit words as unsigned long integers.
    - Adjust the sum by adding the higher 32 bits, the higher 16 bits, and the lower 16 bits of the sum.
    - Add the higher 16 bits of the adjusted sum to itself.
    - Return the bitwise negation of the final sum as a 16-bit unsigned short.
- **Output**: Returns a 16-bit unsigned short representing the computed checksum if the input checksum is zero, or zero if the input checksum is valid, or a non-zero value if the input checksum is invalid.


---
### fd\_ip4\_igmp<!-- {{#callable:fd_ip4_igmp}} -->
[View Source →](<../../../../../src/util/net/fd_igmp.h#L75>)

Populates a memory region with a well-formed IP4/IGMP message using specified parameters.
- **Inputs**:
    - `_msg`: Pointer to the memory region to populate with the IP4/IGMP message.
    - `ip4_saddr`: Source IP address, assumed to be a valid unicast address on the subnet.
    - `ip4_daddr`: Destination IP address, assumed to be a valid multicast address.
    - `igmp_type`: Type of IGMP message, such as QUERY, V1_REPORT, V2_REPORT, or V2_LEAVE.
    - `igmp_resp`: Response time for IGMP, used in V2 messages.
    - `igmp_group`: IGMP group address, usually the same as `ip4_daddr`.
- **Logic and Control Flow**:
    - Cast `_msg` to `fd_ip4_igmp_t *` and store in `msg`.
    - Set IP header fields in `msg->ip4` including version, header length, type of service, total length, ID, fragment offset, TTL, protocol, and checksum.
    - Copy `ip4_saddr` and `ip4_daddr` into `msg->ip4->saddr_c` and `msg->ip4->daddr_c` respectively.
    - Set IP options in `msg->opt` to indicate router alert.
    - Set IGMP fields in `msg->igmp` including type, response time, checksum, and group address.
    - Compute and set the IP header checksum using [`fd_ip4_hdr_check`](<fd_ip4.h.md#fd_ip4_hdr_check>).
    - Compute and set the IGMP checksum using [`fd_igmp_check`](<#fd_igmp_check>).
    - Return the pointer `msg`.
- **Output**: Returns a pointer to the populated `fd_ip4_igmp_t` structure.
- **Functions Called**:
    - [`fd_ip4_hdr_check`](<fd_ip4.h.md#fd_ip4_hdr_check>)
    - [`fd_igmp_check`](<#fd_igmp_check>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)