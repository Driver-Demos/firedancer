<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file defining structures, macros, and functions for handling IPv4 headers and addresses.

# Purpose
The code is a C header file that defines structures, macros, and functions for handling IPv4 headers. It provides a set of utilities to manipulate and interpret the fields of an IPv4 packet header. The file includes definitions for various constants related to IPv4, such as type of service, fragment offset masks, and protocol identifiers. It also defines a union `fd_ip4_hdr` that represents the structure of an IPv4 header, including fields like version, header length, type of service, total length, identification, fragment offset, time to live, protocol, checksum, source address, and destination address.

The header file provides several macros for extracting and setting specific fields within the IPv4 header, such as `FD_IP4_GET_VERSION`, `FD_IP4_SET_VERSION`, `FD_IP4_GET_IHL`, and `FD_IP4_SET_IHL`. It also includes functions for checking if an IP address is multicast or broadcast, validating and computing header checksums, and converting string representations of IP addresses to their numeric form. Additionally, the file defines functions to check if an IP address is public and to reverse the endianness of the fields in an IPv4 header. The file is intended to be included in other C source files that require manipulation of IPv4 headers.
# Imports and Dependencies

---
- `../bits/fd_bits.h`


# Data Structures

---
### fd\_ip4\_hdr
- **Type**: ``union``
- **Members**:
    - ``verihl``: Contains the IP version and header length.
    - ``tos``: Specifies the type of service.
    - ``net_tot_len``: Indicates the total length of the fragment in bytes, including the IP header.
    - ``net_id``: Identifies the fragment uniquely from the sender.
    - ``net_frag_off``: Contains the fragment offset and status.
    - ``ttl``: Specifies the time to live for the fragment.
    - ``protocol``: Indicates the type of payload.
    - ``check``: Stores the header checksum.
    - ``saddr_c``: Holds the sender's address in a 4-byte array.
    - ``saddr``: Holds the sender's address as a 32-bit integer.
    - ``daddr_c``: Holds the destination address in a 4-byte array.
    - ``daddr``: Holds the destination address as a 32-bit integer.
- **Description**: Defines an IPv4 header structure using a union, which includes fields for version, header length, type of service, total length, identification, fragment offset, time to live, protocol, checksum, and source and destination addresses. The structure supports both byte array and integer representations for addresses, and it allows for up to 40 bytes of options.


---
### fd\_ip4\_hdr\_t
- **Type**: ``union``
- **Members**:
    - ``verihl``: Contains the IP version and header length.
    - ``tos``: Specifies the type of service.
    - ``net_tot_len``: Indicates the total length of the packet in bytes, including the IP header.
    - ``net_id``: Identifies the fragment uniquely from the sender.
    - ``net_frag_off``: Contains the fragment offset and status bits.
    - ``ttl``: Specifies the time to live for the packet.
    - ``protocol``: Indicates the type of payload.
    - ``check``: Holds the header checksum.
    - ``saddr_c``: Stores the sender's address as a 4-byte array.
    - ``saddr``: Stores the sender's address as a 32-bit integer.
    - ``daddr_c``: Stores the destination address as a 4-byte array.
    - ``daddr``: Stores the destination address as a 32-bit integer.
- **Description**: The `fd_ip4_hdr_t` is a union that represents an IPv4 header, encapsulating various fields necessary for packet routing and delivery. It includes fields for version, header length, type of service, total length, identification, fragment offset, time to live, protocol, checksum, and both sender and destination addresses. The structure supports both byte array and integer representations for addresses, facilitating different API interactions.


# Functions

---
### fd\_ip4\_addr\_is\_mcast<!-- {{#callable:fd_ip4_addr_is_mcast}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L105>)

Checks if an IPv4 address is a multicast address.
- **Inputs**:
    - `addr`: An unsigned integer representing the IPv4 address to check.
- **Logic and Control Flow**:
    - Casts the input `addr` to an `uchar` and right shifts it by 4 bits.
    - Compares the result to `0xe` (which represents the multicast address range 224.0.0.0 to 239.255.255.255).
    - Returns 1 if the comparison is true, indicating a multicast address, otherwise returns 0.
- **Output**: Returns 1 if the address is a multicast address, otherwise returns 0.


---
### fd\_ip4\_addr\_is\_bcast<!-- {{#callable:fd_ip4_addr_is_bcast}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L115>)

Checks if the given IPv4 address is the global broadcast address (255.255.255.255).
- **Inputs**:
    - `addr`: An unsigned integer representing an IPv4 address.
- **Logic and Control Flow**:
    - Compares the input `addr` with the bitwise negation of 0 (`~0U`), which represents the global broadcast address 255.255.255.255.
- **Output**: Returns 1 if `addr` is the global broadcast address, otherwise returns 0.


---
### fd\_ip4\_hdr\_net\_frag\_off\_is\_unfragmented<!-- {{#callable:fd_ip4_hdr_net_frag_off_is_unfragmented}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L117>)

Determines if an IPv4 packet is unfragmented based on the `net_frag_off` field.
- **Inputs**:
    - `net_frag_off`: A `ushort` representing the fragment offset field of an IPv4 header in network byte order.
- **Logic and Control Flow**:
    - Casts `net_frag_off` to a `uint` and performs a bitwise AND operation with the constant `0xff3fU`.
    - Returns the negation of the result, indicating the packet is unfragmented if the result is zero.
- **Output**: Returns an `int` that is 1 if the packet is unfragmented, and 0 if it is fragmented.


---
### fd\_ip4\_hdr\_check<!-- {{#callable:fd_ip4_hdr_check}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L131>)

Calculates the checksum for an IPv4 header and validates it if a checksum is already present.
- **Inputs**:
    - ``vp_hdr``: A pointer to the start of a memory region containing an IPv4 header and any options that might follow it.
- **Logic and Control Flow**:
    - Cast the input pointer `vp_hdr` to a `uchar` pointer `cp`.
    - Extract the header length in 32-bit words from the first byte of the header and store it in `n`.
    - If `n` is less than 5, the function assumes an unreachable state, as a valid IPv4 header must be at least 5 words long.
    - Initialize a checksum accumulator `c` to zero.
    - Iterate over each 32-bit word in the header, up to `n` words, and add each word to the checksum accumulator `c`.
    - Fold the checksum by adding the upper 32 bits to the lower 32 bits, then the upper 16 bits to the lower 16 bits, and finally the carry from the upper 16 bits to the lower 16 bits.
    - Return the bitwise negation of the folded checksum as a 16-bit unsigned integer.
- **Output**: A 16-bit unsigned integer representing the computed checksum for the IPv4 header. If the header already has a checksum, the function returns 0 if the checksum is valid, or a non-zero value if it is not.


---
### fd\_ip4\_hdr\_check\_fast<!-- {{#callable:fd_ip4_hdr_check_fast}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L162>)

Calculates the checksum of an IPv4 header assuming no options are present.
- **Inputs**:
    - `vp_hdr`: A pointer to the IPv4 header to check.
- **Logic and Control Flow**:
    - Cast `vp_hdr` to a `uchar` pointer `cp`.
    - Extract the Internet Header Length (IHL) from the first byte of the header and store it in `n`.
    - If `n` is not equal to 5, call [`fd_ip4_hdr_check`](<#fd_ip4_hdr_check>) with `vp_hdr` and return its result.
    - Initialize a variable `c` to zero to accumulate the checksum.
    - Iterate over the header words, copying each 4-byte word into `u` and adding it to `c`.
    - Perform a series of bit shifts and additions to reduce `c` to a 16-bit checksum.
    - Return the bitwise negation of `c` as a `ushort`.
- **Output**: Returns the computed checksum as a `ushort`.
- **Functions Called**:
    - [`fd_ip4_hdr_check`](<#fd_ip4_hdr_check>)


---
### fd\_ip4\_addr\_is\_public<!-- {{#callable:fd_ip4_addr_is_public}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L203>)

Determines if an IPv4 address is public by checking if it falls outside private and loopback address ranges.
- **Inputs**:
    - ``addr``: The IPv4 address in network byte order to check for public status.
- **Logic and Control Flow**:
    - Convert the input address from network byte order to host byte order using `fd_uint_bswap`.
    - Check if the converted address falls within any of the defined private or loopback address ranges by comparing it against the start and end of each range.
    - Return 0 if the address is within any of these ranges, indicating it is not public.
    - Return 1 if the address is outside all these ranges, indicating it is public.
- **Output**: Returns 1 if the address is public, and 0 if it is private or a loopback address.


---
### fd\_ip4\_hdr\_bswap<!-- {{#callable:fd_ip4_hdr_bswap}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L215>)

Reverses the endianness of specific fields in an IPv4 header.
- **Inputs**:
    - ``hdr``: A pointer to an `fd_ip4_hdr_t` structure representing the IPv4 header to modify.
- **Logic and Control Flow**:
    - Call `fd_ushort_bswap` on `hdr->net_tot_len` and assign the result back to `hdr->net_tot_len`.
    - Call `fd_ushort_bswap` on `hdr->net_id` and assign the result back to `hdr->net_id`.
    - Call `fd_ushort_bswap` on `hdr->net_frag_off` and assign the result back to `hdr->net_frag_off`.
    - Call `fd_ushort_bswap` on `hdr->check` and assign the result back to `hdr->check`.
- **Output**: No return value; the function modifies the IPv4 header in place.


# Function Declarations (Public API)

---
### fd\_cstr\_to\_ip4\_addr<!-- {{#callable_declaration:fd_cstr_to_ip4_addr}} -->
[View Source →](<../../../../../src/util/net/fd_ip4.h#L196>)

Parses an IPv4 address from a string.
- **Description**: Use this function to convert a string representation of an IPv4 address into a 32-bit unsigned integer in network byte order. The string must be in the format 'x.y.z.w', where x, y, z, and w are integers between 0 and 255. The function writes the parsed address to the provided output parameter and returns 1 on success. If the string does not represent a valid IPv4 address, the function returns 0 and does not modify the output parameter. Ensure the output parameter is not null before calling this function.
- **Inputs**:
    - `s`: A pointer to a null-terminated string representing an IPv4 address in the format 'x.y.z.w'. Each segment must be an integer between 0 and 255. The string must not be null.
    - `out`: A pointer to a uint where the function will store the parsed IPv4 address in network byte order. Must not be null. The function does not modify this if the input string is invalid.
- **Output**: Returns 1 if the string is a valid IPv4 address and stores the result in the output parameter. Returns 0 if the string is invalid.
- **See Also**: [`fd_cstr_to_ip4_addr`](<fd_ip4.c.md#fd_cstr_to_ip4_addr>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)