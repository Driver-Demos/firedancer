<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

AVX-based vector double API for operations on 256-bit wide vectors of double precision floating point values.

# Purpose
The code defines a set of macros and inline functions for handling vector operations on double-precision floating-point numbers using AVX (Advanced Vector Extensions) instructions. It is intended to be included indirectly through a header file `fd_avx.h`, as indicated by the initial preprocessor directive. The primary data type used is `wd_t`, which represents a vector of four double-precision floating-point numbers. The code provides a comprehensive API for constructing vectors, performing arithmetic and logical operations, memory operations, and conversions between different data types.

The code includes macros for constructing vectors (`wd`, `wd_bcast`), predefined constants (`wd_zero`, `wd_one`), and various arithmetic operations such as addition, subtraction, multiplication, and division. It also provides logical operations, conditional operations, and conversion functions to convert vectors to other data types like integers and floats. The code emphasizes the use of macros over static inline functions to optimize performance and reduce the risk of compiler-related issues. Additionally, it includes functions for reduction operations like summing all elements in a vector and finding the minimum or maximum value. The code is designed to handle non-exotic floating-point values, and the behavior is undefined for operations that would result in exotic values according to the IEEE 754 standard.
# Functions

---
### wd\_bcast\_pair<!-- {{#callable:wd_bcast_pair}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L42>)

Creates a vector of four double-precision floating-point values with a pattern [d0, d1, d0, d1].
- **Inputs**:
    - `d0`: The first double-precision floating-point value to be used in the vector.
    - `d1`: The second double-precision floating-point value to be used in the vector.
- **Logic and Control Flow**:
    - Uses the `_mm256_setr_pd` intrinsic to create a vector with the specified pattern.
    - The vector is constructed with the values [d0, d1, d0, d1].
- **Output**: Returns a `wd_t` vector containing the values [d0, d1, d0, d1].


---
### wd\_bcast\_wide<!-- {{#callable:wd_bcast_wide}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L47>)

Creates a vector of four double-precision floating-point values with the first two elements set to `d0` and the last two elements set to `d1`.
- **Inputs**:
    - `d0`: The first double-precision floating-point value to be broadcasted to the first two elements of the vector.
    - `d1`: The second double-precision floating-point value to be broadcasted to the last two elements of the vector.
- **Logic and Control Flow**:
    - Calls the `_mm256_setr_pd` intrinsic function with `d0`, `d0`, `d1`, and `d1` as arguments.
    - Returns the resulting vector of four double-precision floating-point values.
- **Output**: A vector of type `wd_t` containing four double-precision floating-point values arranged as `[d0, d0, d1, d1]`.


---
### wd\_extract<!-- {{#callable:wd_extract}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L97>)

Extracts a double from a specified lane of a vector double.
- **Inputs**:
    - ``a``: A vector double (`wd_t`) containing four double precision floating point values.
    - ``imm``: An integer index (0 to 3) specifying which lane of the vector to extract the double from.
- **Logic and Control Flow**:
    - Store the vector double `a` into an array `d` of four doubles using `_mm256_store_pd`.
    - Return the double at the index `imm` from the array `d`.
- **Output**: A double precision floating point value extracted from the specified lane of the vector double.


---
### wd\_insert<!-- {{#callable:wd_insert}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L116>)

Replaces a specified 64-bit lane in a vector of doubles with a given double value.
- **Inputs**:
    - ``a``: A vector of doubles (`wd_t`) where a 64-bit lane will be replaced.
    - ``imm``: An integer specifying the 64-bit lane index (0 to 3) to replace in the vector.
    - ``v``: A double value to insert into the specified lane of the vector.
- **Logic and Control Flow**:
    - Declare a union `t` to hold the double value `v` and its integer representation `i`.
    - Assign the double value `v` to `t.v`, which also sets `t.i` to the integer representation of `v`.
    - Convert the vector `a` from a double vector to an integer vector using `_mm256_castpd_si256`.
    - Insert the integer representation `t.i` into the specified lane `imm` of the integer vector using `_mm256_insert_epi64`.
    - Convert the modified integer vector back to a double vector using `_mm256_castsi256_pd`.
    - Return the resulting vector.
- **Output**: A vector of doubles (`wd_t`) with the specified lane replaced by the given double value.


---
### wd\_extract\_variable<!-- {{#callable:wd_extract_variable}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L125>)

Extracts a double value from a specified index of a vector double `wd_t`.
- **Inputs**:
    - ``a``: A vector double of type `wd_t` from which to extract a value.
    - ``n``: An integer index (0 to 3) specifying which double value to extract from the vector.
- **Logic and Control Flow**:
    - Declare an array `d` of four doubles with the attribute `W_ATTR`.
    - Store the vector double `a` into the array `d` using `_mm256_store_pd`.
    - Return the double value at index `n` from the array `d`.
- **Output**: Returns the double value at the specified index `n` from the vector double `a`.


---
### wd\_insert\_variable<!-- {{#callable:wd_insert_variable}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L132>)

Replaces the double value at a specified index in a vector of doubles with a new value and returns the updated vector.
- **Inputs**:
    - ``a``: A vector of doubles (`wd_t`) from which a double value will be replaced.
    - ``n``: An integer index (0 to 3) indicating the position in the vector where the replacement will occur.
    - ``v``: A double value that will replace the existing value at index `n` in the vector.
- **Logic and Control Flow**:
    - Store the contents of vector `a` into a local array `d` of four doubles.
    - Replace the value at index `n` in array `d` with the new value `v`.
    - Load the updated array `d` back into a vector and return it.
- **Output**: Returns a vector of doubles (`wd_t`) with the value at index `n` replaced by `v`.


---
### wd\_to\_wl<!-- {{#callable:wd_to_wl}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L292>)

Converts a vector of four double-precision floating-point values to a vector of four long integers.
- **Inputs**:
    - ``d``: A vector of four double-precision floating-point values (`wd_t`).
- **Logic and Control Flow**:
    - Stores the double-precision values from `d` into a temporary union `t` with an array of four doubles.
    - Casts each double value in `t` to a long integer and stores them in the corresponding positions of the union `u`.
    - Loads the long integer values from `u` into a `__m256i` vector and returns it.
- **Output**: A `__m256i` vector containing the long integer representations of the input double-precision values.


---
### wd\_to\_wv<!-- {{#callable:wd_to_wv}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L303>)

Converts a vector of double-precision floating-point values to a vector of unsigned long integers.
- **Inputs**:
    - ``wd_t d``: A vector of four double-precision floating-point values.
- **Logic and Control Flow**:
    - Store the double-precision values from `d` into a temporary union `t` that can hold either four doubles or one `__m256d` vector.
    - Convert each double in `t` to an unsigned long and store it in the corresponding position in the union `u`.
    - Load the unsigned long values from `u` into a `__m256i` vector and return it.
- **Output**: A `__m256i` vector containing the unsigned long integer representations of the input double values.


---
### wd\_to\_wu\_fast<!-- {{#callable:wd_to_wu_fast}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L316>)

Converts a vector of double-precision floating-point values to unsigned integers, using AVX instructions, and inserts the result into a specified position in a vector of unsigned integers.
- **Inputs**:
    - `d`: A vector of double-precision floating-point values (`wd_t`) to convert.
    - `u`: A vector of unsigned integers (`wu_t`) where the result will be inserted.
    - `imm_hi`: An integer flag indicating the position (0 or 1) in the vector `u` where the result will be inserted.
- **Logic and Control Flow**:
    - If AVX-512F and AVX-512VL are defined, use `_mm256_cvtpd_epu32` to convert `d` to unsigned integers directly.
    - If not, emulate the conversion by subtracting 2^31 from `d`, converting to signed integers, and adjusting the result using two's complement arithmetic.
    - Check if each element in `d` is less than 2^31 to determine the conversion method for each element.
    - Use `_mm256_cvtpd_epi32` to convert the adjusted values to signed integers.
    - Adjust the converted values back to unsigned integers using two's complement arithmetic.
    - Blend the adjusted and non-adjusted results based on the comparison with 2^31.
    - Insert the final converted vector into the specified position in `u` based on `imm_hi`.
- **Output**: A vector of unsigned integers (`wu_t`) with the converted values inserted at the specified position.


---
### wd\_sum\_all<!-- {{#callable:wd_sum_all}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L360>)

Computes the sum of all elements in a vector of doubles and broadcasts the result across all lanes of the vector.
- **Inputs**:
    - `x`: A vector of type `wd_t` containing four double-precision floating-point values.
- **Logic and Control Flow**:
    - Adds the elements of the vector `x` with its permuted version to combine the first and second halves of the vector.
    - Performs a horizontal addition on the resulting vector to sum the adjacent pairs of elements.
    - Returns a vector where all lanes contain the sum of the original vector's elements.
- **Output**: A vector of type `wd_t` where each lane contains the sum of all elements in the input vector `x`.


---
### wd\_min\_all<!-- {{#callable:wd_min_all}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L366>)

Finds the minimum value in a vector of doubles and broadcasts it across all elements of the vector.
- **Inputs**:
    - `a`: A vector of type `wd_t` containing four double-precision floating-point values.
- **Logic and Control Flow**:
    - Use `_mm256_min_pd` to find the minimum between `a` and its permuted version using `_mm256_permute2f128_pd` with control parameter `1`, effectively comparing the first two and last two elements of `a`.
    - Use `_mm256_min_pd` again to find the minimum between the result and its permuted version using `_mm256_permute_pd` with control parameter `5`, effectively comparing the first and second elements of the result.
- **Output**: A vector of type `wd_t` where all elements are the minimum value found in the input vector `a`.


---
### wd\_max\_all<!-- {{#callable:wd_max_all}} -->
[View Source →](<../../../../../src/util/simd/fd_avx_wd.h#L372>)

Computes the maximum value across all elements in a vector of doubles and broadcasts it to all elements of the vector.
- **Inputs**:
    - `a`: A vector of type `wd_t` containing four double-precision floating-point values.
- **Logic and Control Flow**:
    - Use `_mm256_max_pd` to compute the element-wise maximum between `a` and its permuted version using `_mm256_permute2f128_pd` with control parameter `1`, effectively comparing the first two and last two elements of `a`.
    - Use `_mm256_max_pd` again to compute the element-wise maximum between the result and its permuted version using `_mm256_permute_pd` with control parameter `5`, effectively comparing the first and second elements with the third and fourth elements.
    - Return the resulting vector where all elements are the maximum value found in the original vector `a`.
- **Output**: A vector of type `wd_t` where all elements are the maximum value from the input vector `a`.



---
Made with ❤️ by [Driver](https://www.driver.ai/)