<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for workspace creation, attachment, allocation, and deletion functions in the Firedancer codebase.

# Purpose
This code is a C test suite designed to validate the functionality of a workspace management library. It includes tests for creating, attaching, and deleting both named and anonymous workspaces using functions such as `fd_wksp_new_named`, `fd_wksp_new_anon`, `fd_wksp_attach`, `fd_wksp_delete_named`, and `fd_wksp_delete_anon`. The code also tests memory allocation and deallocation within these workspaces using functions like `fd_wksp_alloc_laddr`, `fd_wksp_free_laddr`, and `fd_wksp_cstr_alloc`. Additionally, it verifies the correct operation of workspace-related utilities such as `fd_wksp_tag`, `fd_wksp_containing`, and `fd_wksp_map`.

The test suite is structured to run two iterations: one for named workspaces and another for anonymous workspaces. It uses command-line arguments to configure test parameters such as workspace name, page size, page count, and CPU affinity. The code includes assertions to ensure that the functions return expected results, indicating either success or specific error conditions. The test suite logs the progress and results of the tests, and it concludes by calling `fd_halt()` to clean up and exit.
# Imports and Dependencies

---
- `../fd_util.h`


# Functions

---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/wksp/test_wksp_helper.c#L5>)

Initializes the environment, processes command-line arguments, and performs a series of tests on workspace creation, attachment, allocation, and deletion.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Extracts command-line options using `fd_env_strip_cmdline_cstr`, `fd_env_strip_cmdline_ulong`, and `fd_env_strip_cmdline_uint` for various parameters like `--name`, `--page-sz`, `--page-cnt`, `--near-cpu`, `--mode`, `--seed`, and `--part-max`.
    - Converts `_page_sz` and `_mode` to `page_sz` and `mode` using `fd_cstr_to_shmem_page_sz` and `fd_cstr_to_ulong_octal`.
    - Initializes `zero` and `big` for boundary testing.
    - Iterates twice to perform tests for named and anonymous workspaces.
    - In the first iteration, logs the test parameters and tests `fd_wksp_new_named` with various invalid inputs, then creates a named workspace and tests `fd_wksp_attach`.
    - In the second iteration, logs the test parameters and tests `fd_wksp_new_anon` with various invalid inputs, then creates an anonymous workspace and tests `fd_wksp_attach`.
    - Tests `fd_wksp_alloc_laddr` for memory allocation and verifies the tag with `fd_wksp_tag`.
    - Tests `fd_wksp_containing` to check if a local address belongs to a workspace.
    - Tests `fd_wksp_cstr_alloc`, `fd_wksp_cstr_tag`, and `fd_wksp_cstr_memset` for string allocation and manipulation.
    - Tests `fd_wksp_map` to map a string to a local address and verifies the tag.
    - Tests `fd_wksp_cstr` and `fd_wksp_cstr_laddr` for string conversion and comparison.
    - Tests `fd_wksp_unmap` and `fd_wksp_free` for unmapping and freeing resources.
    - In the first iteration, tests `fd_wksp_delete_named` and `fd_wksp_detach` for named workspace deletion.
    - In the second iteration, tests `fd_wksp_delete_anon` for anonymous workspace deletion.
    - Logs a success message and calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.



---
Made with ❤️ by [Driver](https://www.driver.ai/)