<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A command-line utility for managing and querying workspace states, including allocation, deletion, and metadata integrity checks.

# Purpose
The code is a C program that provides a command-line interface for managing and interacting with a workspace system. It includes functionality for creating, deleting, and querying workspaces, as well as managing memory allocations within these workspaces. The program defines a [`main`](<#main>) function that processes command-line arguments to execute various commands such as `new`, `delete`, `alloc`, `info`, `free`, `check`, `verify`, `rebuild`, `reset`, `usage`, `query`, `checkpt`, `checkpt-query`, and `restore`. Each command corresponds to a specific operation on the workspace, such as creating a new workspace, allocating memory, or querying workspace information.

The program uses several helper functions and macros, such as `FD_LOG_ERR`, `FD_LOG_NOTICE`, and `TRAP`, to handle errors and log messages. It also includes a static function [`fprintf_wksp`](<#fprintf_wksp>) that prints detailed information about a workspace's state to a file, including metadata integrity checks. The code is structured to handle errors robustly, with checks for invalid inputs and conditions that could lead to incorrect operations. The program is designed to be executed in a hosted environment, as indicated by the `#if FD_HAS_HOSTED` preprocessor directive, and it includes a fallback [`main`](<#main>) function for unsupported platforms.
# Imports and Dependencies

---
- `../fd_util.h`
- `fd_wksp_private.h`
- `stdio.h`
- `errno.h`
- `unistd.h`
- `fcntl.h`
- `sys/stat.h`


# Functions

---
### fprintf\_wksp<!-- {{#callable:fprintf_wksp}} -->
[View Source →](<../../../../../src/util/wksp/fd_wksp_ctl.c#L20>)

Prints detailed information about a workspace to a file, including metadata integrity checks.
- **Inputs**:
    - `file`: A pointer to a `FILE` object where the workspace information will be printed.
    - `wksp`: A pointer to an `fd_wksp_t` structure representing the workspace to be printed.
- **Logic and Control Flow**:
    - Check if `file` is NULL; if so, log a warning and return -1.
    - Check if `wksp` is NULL; if so, log a warning and return -1.
    - Initialize a return value `ret` to 0 and define a macro `TRAP` to handle errors during printing.
    - Retrieve and store workspace parameters such as `part_max`, `gaddr_lo`, and `gaddr_hi`.
    - Print basic workspace information including name, magic number, seed, part_max, data_max, and address range.
    - Attempt to lock the workspace; if locking fails, increment error count and print a lock error message.
    - Initialize counters for used and free partitions and sizes, and a cycle tag for iteration.
    - Iterate over workspace partitions, checking for errors such as index out of bounds, cycle errors, and metadata inconsistencies.
    - For each partition, update counters for used and free sizes and counts, and print partition details.
    - After iteration, check for errors in the tail index and address range completion.
    - Print summary of used and free space, including the number of blocks and the largest block size.
    - Unlock the workspace after processing.
    - Print the total number of errors detected during processing.
- **Output**: Returns the total number of characters printed, or a negative value if an error occurs during printing.
- **Functions Called**:
    - [`fd_wksp_private_pinfo`](<fd_wksp_private.h.md#fd_wksp_private_pinfo>)
    - [`fd_wksp_private_lock`](<fd_wksp_admin.c.md#fd_wksp_private_lock>)
    - [`fd_wksp_private_pinfo_idx`](<fd_wksp_private.h.md#fd_wksp_private_pinfo_idx>)
    - [`fd_wksp_private_pinfo_idx_is_null`](<fd_wksp_private.h.md#fd_wksp_private_pinfo_idx_is_null>)
    - [`fd_wksp_private_unlock`](<fd_wksp_private.h.md#fd_wksp_private_unlock>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/wksp/fd_wksp_ctl.c#L487>)

Initializes the environment, checks the number of command-line arguments, logs a notice, and halts the program.
- **Inputs**:
    - `argc`: The number of command-line arguments passed to the program.
    - `argv`: An array of strings representing the command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with `argc` and `argv`.
    - Checks if `argc` is less than 1 and logs an error if true.
    - Checks if `argc` is greater than 1 and logs an error if true, indicating that `fd_wksp_ctl` is not supported on this platform.
    - Logs a notice indicating that 0 commands were processed.
    - Calls `fd_halt` to halt the program.
- **Output**: Returns 0, indicating successful execution.



---
Made with ❤️ by [Driver](https://www.driver.ai/)