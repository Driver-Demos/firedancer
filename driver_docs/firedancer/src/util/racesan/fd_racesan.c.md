<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements a race condition sanitizer with hook management and context handling functions.

# Purpose
The code defines a module for managing and executing hooks in a race condition sanitizer context. It includes functions to create and delete a `fd_racesan_t` structure, which represents the race condition sanitizer context. The [`fd_racesan_new`](<#fd_racesan_new>) function initializes this context, setting up a hook map and associating a context pointer. The [`fd_racesan_delete`](<#fd_racesan_delete>) function is a placeholder for cleanup operations, currently returning the context without performing any actions.

The module provides functionality to inject hooks into the sanitizer context using the [`fd_racesan_inject`](<#fd_racesan_inject>) function, which maps a hook function to a hashed name. The [`fd_racesan_inject_default`](<#fd_racesan_inject_default>) function allows setting a default hook function that is called if no specific hook is found. The [`fd_racesan_enter`](<#fd_racesan_enter>) and [`fd_racesan_exit`](<#fd_racesan_exit>) functions manage the activation and deactivation of the sanitizer context. The [`fd_racesan_hook_private`](<#fd_racesan_hook_private>) function executes the appropriate hook based on a name hash, calling either a specific hook or the default hook if available. The module uses a map data structure to manage hooks, leveraging a template-based map implementation included from an external file.
# Imports and Dependencies

---
- `fd_racesan.h`
- `fd_racesan_target.h`
- `../../util/log/fd_log.h`
- `../../util/tmpl/fd_map.c`


# Functions

---
### fd\_racesan\_new<!-- {{#callable:fd_racesan_new}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L15>)

Initializes a `fd_racesan_t` structure with a given context and sets up its hook map.
- **Inputs**:
    - `racesan`: A pointer to a `fd_racesan_t` structure to initialize.
    - `ctx`: A pointer to a context that will be associated with the `racesan` structure.
- **Logic and Control Flow**:
    - Check if `racesan` is NULL using `FD_UNLIKELY`; if true, log a warning and return NULL.
    - Assign the `ctx` to `racesan->hook_ctx`.
    - Set `racesan->default_hook` to NULL.
    - Initialize the hook map for `racesan` by calling `hook_map_new` with `racesan->hook_map`.
    - Return the initialized `racesan` pointer.
- **Output**: Returns the initialized `fd_racesan_t` pointer, or NULL if the input `racesan` is NULL.


---
### fd\_racesan\_delete<!-- {{#callable:fd_racesan_delete}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L28>)

Returns the input `fd_racesan_t` pointer without modification.
- **Inputs**:
    - `racesan`: A pointer to an `fd_racesan_t` structure, which is intended to be deleted or cleaned up.
- **Logic and Control Flow**:
    - Casts the `racesan` pointer to `void` to suppress unused variable warnings.
    - Returns the `racesan` pointer as is.
- **Output**: The same `fd_racesan_t` pointer that was passed as input.


---
### fd\_racesan\_inject<!-- {{#callable:fd_racesan_inject}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L34>)

Inserts a hook function into the race sanitizer's hook map using a hash of the provided name.
- **Inputs**:
    - `racesan`: A pointer to an `fd_racesan_t` structure, which contains the hook map where the function will be inserted.
    - `name`: A constant character pointer representing the name of the hook to be inserted.
    - `fn`: A pointer to a function of type `fd_racesan_hook_fn_t`, which is the hook function to be inserted.
- **Logic and Control Flow**:
    - Calculate the length of the `name` string using `strlen`.
    - Compute a hash of the `name` using [`fd_racesan_strhash`](<fd_racesan_base.h.md#fd_racesan_strhash>) with the calculated length.
    - Attempt to insert the hook into the `racesan->hook_map` using `hook_map_insert` with the computed hash.
    - If the insertion fails (i.e., the entry already exists), log an error message and terminate the program using `FD_LOG_ERR`.
    - If the insertion is successful, assign the provided function `fn` to the `hook` field of the map entry.
- **Output**: None. The function modifies the `racesan` structure by inserting the hook function into its hook map.
- **Functions Called**:
    - [`fd_racesan_strhash`](<fd_racesan_base.h.md#fd_racesan_strhash>)


---
### fd\_racesan\_inject\_default<!-- {{#callable:fd_racesan_inject_default}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L45>)

Assigns a default callback function to a `fd_racesan_t` structure.
- **Inputs**:
    - `racesan`: A pointer to a `fd_racesan_t` structure where the default callback will be set.
    - `callback`: A pointer to a `fd_racesan_hook_fn_t` function that will be set as the default callback.
- **Logic and Control Flow**:
    - Assign the `callback` function to the `default_hook` member of the `racesan` structure.
- **Output**: No output is returned.


---
### fd\_racesan\_enter<!-- {{#callable:fd_racesan_enter}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L51>)

Activates a `fd_racesan_t` context if no other context is currently active.
- **Inputs**:
    - `racesan`: A pointer to a `fd_racesan_t` structure that represents the context to activate.
- **Logic and Control Flow**:
    - Checks if `fd_racesan_g` is already set, indicating an active context.
    - Logs a critical error message if a context is already active.
    - Sets `fd_racesan_g` to the provided `racesan` pointer, activating the new context.
- **Output**: No return value.


---
### fd\_racesan\_exit<!-- {{#callable:fd_racesan_exit}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L59>)

Resets the global `fd_racesan_g` pointer to `NULL` to deactivate the current racesan context.
- **Inputs**: None
- **Logic and Control Flow**:
    - Set the global variable `fd_racesan_g` to `NULL`.
- **Output**: No output is returned.


---
### fd\_racesan\_hook\_private<!-- {{#callable:fd_racesan_hook_private}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan.c#L64>)

Executes a specific hook function based on a hash value or a default hook if no specific hook is found.
- **Inputs**:
    - `name_hash`: A hash value representing the name of the hook to execute.
    - `file`: A string representing the file name, which is not used in the function.
    - `line`: An integer representing the line number, which is not used in the function.
- **Logic and Control Flow**:
    - Retrieve the global `fd_racesan_t` instance `racesan` from `fd_racesan_g`.
    - If `racesan` is NULL, exit the function immediately.
    - Query the `hook_map` in `racesan` using `name_hash` to find a specific hook entry.
    - If a specific hook entry is found, execute the hook function with `racesan->hook_ctx` and `name_hash`.
    - If no specific hook is found, check if a `default_hook` is set in `racesan`.
    - If a `default_hook` is set, execute it with `racesan->hook_ctx` and `name_hash`.
    - Ignore the `file` and `line` parameters as they are not used in the function.
- **Output**: No output is returned from this function.



---
Made with ❤️ by [Driver](https://www.driver.ai/)