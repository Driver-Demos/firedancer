<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Implements functions for managing and executing asynchronous operations in a race condition sanitizer.

# Purpose
The code defines a set of functions for managing and executing asynchronous operations within a structure called `fd_racesan_weave_t`. This module provides functionality to create, delete, add, and execute asynchronous tasks in a controlled manner. The primary operations include initializing a new weave structure, adding asynchronous tasks to it, and executing these tasks in a random order up to a specified maximum number of steps. The execution function uses a random number generator to determine the order of task execution, ensuring variability in task processing.

The code includes error handling to manage conditions such as exceeding the maximum number of asynchronous tasks (`FD_RACESAN_WEAVE_MAX`) and reaching the maximum number of execution steps (`step_max`). The functions [`fd_racesan_weave_new`](<#fd_racesan_weave_new>) and [`fd_racesan_weave_delete`](<#fd_racesan_weave_delete>) are placeholders that currently return `NULL`, indicating that they may require further implementation. The module relies on external utilities and definitions, as indicated by the inclusion of headers `fd_racesan_weave.h` and `fd_util.h`. This code is likely part of a larger system where asynchronous task management and execution are required, and it provides a specific interface for these operations.
# Imports and Dependencies

---
- `fd_racesan_weave.h`
- `../../util/fd_util.h`


# Functions

---
### fd\_racesan\_weave\_new<!-- {{#callable:fd_racesan_weave_new}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan_weave.c#L4>)

Returns a null pointer after ignoring the input parameter.
- **Inputs**:
    - `weave`: A pointer to an `fd_racesan_weave_t` structure, which is ignored in the function.
- **Logic and Control Flow**:
    - The function takes a single input parameter `weave` of type `fd_racesan_weave_t *`.
    - The input parameter `weave` is explicitly ignored using `(void)weave;`.
    - The function returns `NULL`.
- **Output**: A null pointer is returned.


---
### fd\_racesan\_weave\_delete<!-- {{#callable:fd_racesan_weave_delete}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan_weave.c#L10>)

Returns a null pointer after receiving a `fd_racesan_weave_t` pointer.
- **Inputs**:
    - `weave`: A pointer to a `fd_racesan_weave_t` structure, which is not used in the function.
- **Logic and Control Flow**:
    - The function takes a `fd_racesan_weave_t` pointer as an argument.
    - The function explicitly ignores the `weave` argument using `(void)weave;`.
    - The function returns `NULL`.
- **Output**: A null pointer (`NULL`).


---
### fd\_racesan\_weave\_add<!-- {{#callable:fd_racesan_weave_add}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan_weave.c#L16>)

Adds an asynchronous task to the weave structure if the maximum count is not exceeded.
- **Inputs**:
    - `weave`: A pointer to an `fd_racesan_weave_t` structure that holds asynchronous tasks.
    - `async`: A pointer to an `fd_racesan_async_t` structure representing the asynchronous task to add.
- **Logic and Control Flow**:
    - Check if the current count of asynchronous tasks in `weave` is greater than or equal to `FD_RACESAN_WEAVE_MAX` using `FD_UNLIKELY` macro.
    - If the maximum count is exceeded, log an error message and terminate the program using `FD_LOG_ERR`.
    - If the maximum count is not exceeded, add the `async` task to the `weave->async` array at the current `async_cnt` index.
    - Increment the `async_cnt` to reflect the addition of the new task.
- **Output**: No return value; the function modifies the `weave` structure in place.


---
### fd\_racesan\_weave\_exec\_rand<!-- {{#callable:fd_racesan_weave_exec_rand}} -->
[View Source →](<../../../../../src/util/racesan/fd_racesan_weave.c#L25>)

Executes a series of asynchronous operations in a random order up to a specified maximum number of steps.
- **Inputs**:
    - `weave`: A pointer to an `fd_racesan_weave_t` structure that contains asynchronous operations to execute.
    - `seed`: An unsigned long integer used to initialize the random number generator.
    - `step_max`: An unsigned long integer specifying the maximum number of steps to execute.
- **Logic and Control Flow**:
    - Initialize `async_cnt` with the number of asynchronous operations in `weave`.
    - Copy each asynchronous operation from `weave->async` to `weave->rem` and reset them using [`fd_racesan_async_reset`](<fd_racesan_async.c.md#fd_racesan_async_reset>).
    - Set `weave->rem_cnt` to `async_cnt`.
    - Initialize a random number generator using the upper 32 bits of `seed` and a hash of `seed`.
    - Iterate up to `step_max` times or until `weave->rem_cnt` is zero.
    - In each iteration, select a random index from `weave->rem` using `fd_rng_uint_roll`.
    - Execute the asynchronous operation at the selected index using [`fd_racesan_async_step`](<fd_racesan_async.c.md#fd_racesan_async_step>).
    - If the operation is complete, remove it from `weave->rem` by replacing it with the last operation in the list and decrement `weave->rem_cnt`.
    - Delete the random number generator after the loop.
- **Output**: No return value; the function modifies the `weave` structure in place.
- **Functions Called**:
    - [`fd_racesan_async_reset`](<fd_racesan_async.c.md#fd_racesan_async_reset>)
    - [`fd_racesan_async_step`](<fd_racesan_async.c.md#fd_racesan_async_step>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)