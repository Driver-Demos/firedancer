<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines macros and functions for compiler checks, build target capabilities, memory operations, atomic operations, and other utilities for a base development environment.

# Purpose
The code is a C header file that sets up a base development environment for the Firedancer project. It includes compiler checks to ensure compatibility with C++17 or later and C17 or later standards. The file defines a series of macros and typedefs to facilitate portable and optimized code across different build targets, such as on-chain virtual machines, commodity hosts, and custom hardware. It provides macros for checking the presence of various capabilities like atomic operations, threading, and specific hardware features (e.g., x86, ARM, SIMD extensions). These macros allow developers to write code that can adapt to the capabilities of the target environment.

Additionally, the file includes utility functions and macros for memory operations, type punning, and compiler optimizations. It defines custom implementations for `memcpy`, `memset`, and memory comparison functions that can leverage architecture-specific optimizations. The file also provides mechanisms for atomic operations, thread-local storage, and synchronization constructs like once-only execution blocks and turnstiles. These constructs help manage concurrency and ensure that certain code blocks are executed only once or by one thread at a time. The header is designed to be included in other C or C++ source files, providing a foundation for building portable and efficient applications within the Firedancer project.
# Imports and Dependencies

---
- `stdalign.h`
- `string.h`
- `limits.h`
- `float.h`


# Functions

---
### fd\_type\_pun<!-- {{#callable:fd_type_pun}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L571>)

Returns the input pointer `p` after executing an inline assembly statement to prevent compiler optimizations related to strict aliasing.
- **Inputs**:
    - `p`: A void pointer to any data type, which is the input to the function.
- **Logic and Control Flow**:
    - Executes an inline assembly statement with a comment for debugging or annotation purposes, which includes the source location.
    - Uses the `+r` constraint to indicate that `p` is both an input and output operand, ensuring the compiler treats it as modified.
    - Specifies a memory clobber to inform the compiler that the assembly code may access memory, preventing certain optimizations.
    - Returns the pointer `p` unchanged.
- **Output**: The same void pointer `p` that was passed as input.


---
### fd\_type\_pun\_const<!-- {{#callable:fd_type_pun_const}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L577>)

Returns the input pointer `p` after an inline assembly operation that prevents certain compiler optimizations.
- **Inputs**:
    - `p`: A constant pointer to any type, which is the input to the function.
- **Logic and Control Flow**:
    - Uses inline assembly to perform an operation on the pointer `p` that prevents the compiler from making certain optimizations related to memory.
    - The inline assembly includes a comment with the source location for debugging purposes.
    - Returns the pointer `p` without modification.
- **Output**: A constant pointer of the same type as the input, which is the same as the input pointer `p`.


---
### fd\_memcpy<!-- {{#callable:fd_memcpy}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1145>)

Copies a block of memory from a source to a destination, with special handling for zero-size operations under certain conditions.
- **Inputs**:
    - `d`: A pointer to the destination memory block where data will be copied to.
    - `s`: A pointer to the source memory block from which data will be copied.
    - `sz`: The number of bytes to copy from the source to the destination.
- **Logic and Control Flow**:
    - Checks if the `CBMC` or `FD_HAS_ASAN` macros are defined, which indicates special handling for zero-size operations.
    - If `sz` is zero and the condition is met, returns the destination pointer `d` immediately without performing any copy operation.
    - Otherwise, calls the standard `memcpy` function to perform the memory copy from `s` to `d` for `sz` bytes.
- **Output**: Returns a pointer to the destination memory block `d`.


---
### fd\_memset<!-- {{#callable:fd_memset}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1179>)

Sets a block of memory to a specified value using the `memset` function.
- **Inputs**:
    - ``d``: A pointer to the starting address of the memory block to fill.
    - ``c``: The value to set in each byte of the memory block.
    - ``sz``: The number of bytes to set in the memory block.
- **Logic and Control Flow**:
    - Checks if the `CBMC` macro is defined and if `sz` is zero, returns `d` immediately.
    - Calls the `memset` function to set the memory block starting at `d` with the value `c` for `sz` bytes.
- **Output**: Returns a pointer to the memory block `d`.


---
### fd\_memeq<!-- {{#callable:fd_memeq}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1225>)

Compares two memory blocks for equality and returns 1 if they are equal or if the size is zero, otherwise returns 0.
- **Inputs**:
    - `s1`: A pointer to the first memory block to compare.
    - `s2`: A pointer to the second memory block to compare.
    - `sz`: The number of bytes to compare between the two memory blocks.
- **Logic and Control Flow**:
    - Calls `memcmp` to compare the memory blocks `s1` and `s2` for `sz` bytes.
    - Returns 1 if `memcmp` indicates the blocks are equal (i.e., returns 0), otherwise returns 0.
- **Output**: An integer value, 1 if the memory blocks are equal or if `sz` is zero, otherwise 0.


---
### fd\_tickcount<!-- {{#callable:fd_tickcount}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1308>)

Retrieves the current value of the ARMv8 virtual counter timer register `cntvct_el0` as a `long` integer.
- **Inputs**: None
- **Logic and Control Flow**:
    - Declare a variable `value` of type `ulong`.
    - Execute an inline assembly block to read the `cntvct_el0` register into `value`.
    - Use the `isb` instruction to ensure instruction synchronization before reading the register.
    - Return the value cast to `long`.
- **Output**: Returns the current tick count as a `long` integer.


# Function Declarations (Public API)

---
### fd\_hash\_memcpy<!-- {{#callable_declaration:fd_hash_memcpy}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1247>)

Copies memory from source to destination and computes a hash.
- **Description**: Use this function to copy a block of memory from a source to a destination while simultaneously computing a hash of the data. This is useful when you need both operations done efficiently in one step. The function requires valid pointers for both source and destination, and the size of the data to be copied and hashed. It handles cases where the size is less than 32 bytes by using a different hashing approach. Ensure that the destination buffer is large enough to hold the copied data.
- **Inputs**:
    - `seed`: An initial hash value to start the hash computation. It can be any unsigned long value.
    - `dst`: A pointer to the destination buffer where the data will be copied. Must not be null and must have enough space to hold 'sz' bytes.
    - `src`: A pointer to the source buffer from which data will be copied. Must not be null and must point to at least 'sz' bytes of valid data.
    - `sz`: The number of bytes to copy and hash. Can be zero, in which case no data is copied, and the function returns a hash based on the seed.
- **Output**: Returns an unsigned long hash value computed from the copied data and the seed.
- **See Also**: [`fd_hash_memcpy`](<fd_hash.c.md#fd_hash_memcpy>)  (Implementation)


---
### \_fd\_tickcount<!-- {{#callable_declaration:_fd_tickcount}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1324>)

Returns the current tick count.
- **Description**: Use this function to obtain the current tick count, which is a measure of time that increases monotonically. This function is useful for performance measurement and timing operations. It does not require any initialization and can be called at any time. The function does not take any parameters and ignores any input provided.
- **Inputs**:
    - `_`: This parameter is ignored and has no effect on the function's behavior. It can be any value or null.
- **Output**: Returns a long integer representing the current tick count.
- **See Also**: [`_fd_tickcount`](<fd_util.c.md#_fd_tickcount>)  (Implementation)


---
### fd\_yield<!-- {{#callable_declaration:fd_yield}} -->
[View Source →](<../../../../src/util/fd_util_base.h#L1330>)

Yields the calling thread to the operating system scheduler.
- **Description**: Use this function to voluntarily yield the processor from the calling thread, allowing other threads to run. This is useful in multi-threaded applications where a thread is waiting for a resource or condition and can afford to pause its execution temporarily. It must be called in a hosted environment where the operating system supports thread scheduling.
- **Inputs**: None
- **Output**: None
- **See Also**: [`fd_yield`](<fd_util.c.md#fd_yield>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)