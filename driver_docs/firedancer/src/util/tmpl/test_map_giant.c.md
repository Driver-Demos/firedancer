<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the `fd_map_giant` implementation, including insertion, deletion, and iteration of map elements.

# Purpose
The code is a C program that tests the functionality of a map data structure, specifically designed to handle key-value pairs. It includes a [`main`](<#main>) function, which is the entry point of the program, and several utility functions and macros to facilitate the testing process. The program uses a custom data structure `pair_t` to represent key-value pairs, where each pair consists of a key (`mykey`), a next pointer (`mynext`), a value (`val`), and a tag (`tag`). The code includes sorting and mapping functionalities by incorporating external files `fd_sort.c` and `fd_map_giant.c`, which provide implementations for sorting and map operations, respectively.

The program initializes a random number generator and sets up test parameters such as maximum number of pairs, seed for randomness, and the number of iterations for testing. It performs various operations on the map, including insertion, deletion, and verification of key-value pairs, while ensuring the integrity and correctness of the map's behavior. The code also includes tests for edge cases, such as handling of null pointers and misaligned memory, and uses logging to report the progress and results of the tests. The program is designed to run in a hosted environment, as indicated by the conditional compilation directives, and it uses a memory buffer `mem` for map operations, ensuring proper alignment.
# Imports and Dependencies

---
- `../fd_util.h`
- `sys/types.h`
- `sys/wait.h`
- `unistd.h`
- `fd_sort.c`
- `fd_map_giant.c`


# Global Variables

---
### mem
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size of 32,768 bytes, aligned to a 128-byte boundary. The `__attribute__((aligned(128)))` ensures that the starting address of the array is a multiple of 128, which can be important for performance optimizations on certain hardware architectures.
- **Use**: Used as a memory buffer for operations that require specific alignment and size constraints, such as the `map_new` function in the code.


# Data Structures

---
### pair
- **Type**: ``struct``
- **Members**:
    - ``mykey``: A `ulong` that stores the key for the pair.
    - ``mynext``: A `ulong` that stores the next element's key in a linked list or similar structure.
    - ``val``: A `uint` that stores the value associated with the key.
    - ``tag``: A `uint` used for tagging or marking purposes.
- **Description**: Defines a data structure that represents a key-value pair with additional fields for linking and tagging, useful in map or sorting operations.


---
### pair\_t
- **Type**: ``struct``
- **Members**:
    - ``mykey``: A `ulong` that stores the key of the pair.
    - ``mynext``: A `ulong` that stores the next element's key in a linked structure.
    - ``val``: A `uint` that stores the value associated with the key.
    - ``tag``: A `uint` used for tagging or marking purposes.
- **Description**: Defines a structure `pair_t` that represents a key-value pair with additional fields for linking and tagging, used in sorting and mapping operations.


# Functions

---
### shuffle\_pair<!-- {{#callable:shuffle_pair}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_giant.c#L28>)

Randomizes the order of elements in an array of `pair_t` structures using the Fisher-Yates shuffle algorithm.
- **Inputs**:
    - ``rng``: A pointer to a random number generator of type `fd_rng_t` used to generate random indices.
    - ``pair``: A pointer to an array of `pair_t` structures that will be shuffled.
    - ``cnt``: The number of elements in the `pair` array to shuffle.
- **Logic and Control Flow**:
    - Iterates over the `pair` array starting from the second element (index 1) to the last element (index `cnt-1`).
    - For each element at index `i`, generates a random index `j` such that `0 <= j <= i` using the `fd_rng_ulong_roll` function.
    - Swaps the elements at indices `i` and `j` in the `pair` array.
- **Output**: The function does not return a value; it modifies the `pair` array in place.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_giant.c#L40>)

Initializes and tests a map data structure with randomized operations and logging.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Extracts `--max`, `--seed`, and `--iter-max` values from the command-line arguments with default values of 512, 1234, and 1000, respectively.
    - Logs the testing parameters using `FD_LOG_NOTICE`.
    - Initializes a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Creates two arrays `ref` and `tst` of `pair_t` structures, each with a maximum size of 512.
    - Populates `ref` and `tst` with unique keys and random values, then sorts `ref` using `sort_pair_inplace`.
    - Checks the alignment and footprint of the map using `map_align` and `map_footprint`.
    - Creates a shared map `shmap` using `map_new` and verifies its properties with `FD_TEST`.
    - Performs a series of randomized operations on the map, including insertion, lookup, and deletion, while verifying map integrity with `FD_TEST`.
    - Logs progress at every 100 iterations using `FD_LOG_NOTICE`.
    - Tests map operations under various conditions, including full and empty states, using `FD_TEST`.
    - Handles special cases and potential errors with logging and conditional compilation directives.
    - Cleans up resources by deleting the random number generator and halting the program with `fd_halt`.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`shuffle_pair`](<#shuffle_pair>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)