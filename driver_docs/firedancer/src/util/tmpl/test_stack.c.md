<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests stack operations including push, pop, and zero-copy methods with a buffer and scratch space.

# Purpose
The code is an executable C program that tests the functionality of a stack data structure. It includes a simple buffer implementation with push and pop operations, defined by [`buf_push`](<#buf_push>) and [`buf_pop`](<#buf_pop>), which are used to validate the stack operations. The stack is implemented using macros and functions from an included file `fd_stack.c`, which is parameterized by defining `STACK_NAME` and `STACK_T` before inclusion. The program uses a scratch memory area for stack operations, ensuring alignment and footprint constraints are met.

The [`main`](<#main>) function initializes the environment and a random number generator, then performs a series of tests on the stack. It checks the construction, accessors, and various operations of the stack, including push, pop, zero-copy push, and zero-copy pop. The program uses assertions (`FD_TEST`) to verify that the stack behaves as expected, comparing the stack's state with the buffer's state. It also handles command-line arguments to set the maximum stack size and logs warnings if constraints are not met. The program concludes by cleaning up resources and logging the test results.
# Imports and Dependencies

---
- `../fd_util.h`
- `fd_stack.c`


# Global Variables

---
### buf
- **Type**: ``int[]``
- **Description**: An array of integers with a maximum size defined by `BUF_MAX`. It is used to store integer values in a stack-like manner.
- **Use**: Stores integer values for stack operations using `buf_push` and `buf_pop` functions.


---
### buf\_cnt
- **Type**: ``ulong``
- **Description**: `buf_cnt` is a static global variable of type `ulong` that tracks the number of elements currently stored in the `buf` array. It is initialized to zero and is used to manage the index for adding and removing elements from the buffer.
- **Use**: Tracks the current count of elements in the `buf` array and is incremented or decremented during push and pop operations.


---
### scratch
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size defined by `SCRATCH_FOOTPRINT`, which is 1024 bytes. The array is aligned in memory according to `SCRATCH_ALIGN`, which is 128 bytes.
- **Use**: Used as a memory region for stack operations in the program.


# Functions

---
### buf\_push<!-- {{#callable:buf_push}} -->
[View Source →](<../../../../../src/util/tmpl/test_stack.c#L6>)

Adds an integer to the buffer if it is not full.
- **Inputs**:
    - `i`: The integer to add to the buffer.
- **Logic and Control Flow**:
    - Check if the buffer count `buf_cnt` is less than the maximum buffer size `BUF_MAX` using `FD_TEST`.
    - If the buffer is not full, add the integer `i` to the buffer at the current buffer count index `buf[buf_cnt]`.
    - Increment the buffer count `buf_cnt` by 1.
- **Output**: No output is returned.


---
### buf\_pop<!-- {{#callable:buf_pop}} -->
[View Source →](<../../../../../src/util/tmpl/test_stack.c#L7>)

Removes and returns the last element from the buffer if it is not empty.
- **Inputs**: None
- **Logic and Control Flow**:
    - Checks if `buf_cnt` is greater than zero using `FD_TEST` macro to ensure the buffer is not empty.
    - Decrements `buf_cnt` by one to point to the last element in the buffer.
    - Returns the element at the new `buf_cnt` index from the `buf` array.
- **Output**: Returns the integer value of the last element in the buffer.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tmpl/test_stack.c#L15>)

Initializes the environment, tests stack operations, and logs results.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Initializes a random number generator `rng`.
    - Parses the `--max` command-line argument to determine the maximum buffer size, defaulting to `BUF_MAX`.
    - Checks if `max` exceeds `BUF_MAX` or if stack alignment and footprint exceed predefined limits, logging warnings and exiting if so.
    - Logs the maximum buffer size.
    - Tests stack construction by checking alignment and footprint, creating and joining a new stack.
    - Logs and tests stack accessors to ensure the stack is initialized correctly.
    - Performs 100 million iterations of random stack operations: push, pop, zero-copy push, and zero-copy pop, with random resets.
    - Logs and tests stack operations to ensure they behave as expected, including checking stack count, maximum, availability, fullness, and emptiness.
    - Leaves and deletes the stack, ensuring resources are cleaned up.
    - Deletes the random number generator and halts the program, logging a pass message.
- **Output**: Returns 0 after completing all operations and tests.
- **Functions Called**:
    - [`buf_push`](<#buf_push>)
    - [`buf_pop`](<#buf_pop>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)