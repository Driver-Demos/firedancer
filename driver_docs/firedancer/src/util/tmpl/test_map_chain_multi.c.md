<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for multi-key map chaining functionality using a custom pair structure and random data.

# Purpose
The code is a C program that tests the functionality of a data structure system involving sorting, pooling, and mapping of `pair_t` structures. The `pair_t` structure is defined with four fields: `mykey`, `mynext`, `val`, and `tag`. The program includes and utilizes three external modules: `fd_sort.c`, `fd_pool.c`, and `fd_map_chain.c`, which provide sorting, pooling, and mapping functionalities, respectively. The program defines macros to configure these modules for use with the `pair_t` structure, specifying how elements are compared, stored, and accessed.

The [`main`](<#main>) function initializes the environment and sets up parameters for testing, such as pool size, chain count, random seed, and iteration count. It then creates a pool and a map, populates them with random `pair_t` elements, and performs various operations to test the integrity and functionality of the data structures. These operations include shuffling, inserting, querying, and deleting elements, as well as verifying the correctness of the map and pool states. The program uses logging to report progress and results, and it performs cleanup operations before exiting.
# Imports and Dependencies

---
- `../fd_util.h`
- `fd_sort.c`
- `fd_pool.c`
- `fd_map_chain.c`


# Global Variables

---
### scratch
- **Type**: ``uchar[]``
- **Description**: The `scratch` variable is an array of unsigned characters with a size defined by the macro `SCRATCH_SZ`, which is set to 32768. It serves as a memory buffer for temporary allocations during the execution of the program.
- **Use**: Used to allocate temporary memory for operations that require aligned memory blocks within the program.


# Data Structures

---
### pair
- **Type**: ``struct``
- **Members**:
    - `mykey`: Stores the key of the pair as an unsigned integer.
    - `mynext`: Stores the index of the next element in a linked list as an unsigned integer.
    - `val`: Stores the value associated with the key as an unsigned integer.
    - `tag`: Stores a tag for the pair as an unsigned integer, used for iteration or marking.
- **Description**: Defines a `struct` named `pair` that represents a key-value pair with additional fields for linked list management and tagging. The `mykey` field is used as the key for sorting and mapping operations, while `mynext` is used to link pairs in a list. The `val` field holds the value associated with the key, and `tag` is used for marking or iteration purposes. This structure is used in conjunction with sorting, pooling, and mapping utilities to manage collections of pairs.


---
### pair\_t
- **Type**: ``struct``
- **Members**:
    - `mykey`: Stores the key of the pair as an unsigned integer.
    - `mynext`: Stores the index of the next element in a linked list as an unsigned integer.
    - `val`: Stores the value associated with the key as an unsigned integer.
    - `tag`: Stores a tag value as an unsigned integer, used for marking or identification purposes.
- **Description**: Defines a `struct` named `pair` that represents a key-value pair with additional fields for linked list management and tagging. The `mykey` field is used as the key for sorting and mapping operations, while `mynext` is used to link elements in a list. The `val` field holds the value associated with the key, and `tag` is used for marking or tracking purposes during operations.


# Functions

---
### shuffle\_pair<!-- {{#callable:shuffle_pair}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_chain_multi.c#L33>)

Randomizes the order of elements in an array of `pair_t` structures using the Fisher-Yates shuffle algorithm.
- **Inputs**:
    - `rng`: A pointer to a random number generator of type `fd_rng_t` used to generate random indices.
    - `pair`: A pointer to an array of `pair_t` structures that will be shuffled.
    - `cnt`: The number of elements in the `pair` array to shuffle.
- **Logic and Control Flow**:
    - Iterates over the array from the second element to the last (index 1 to `cnt-1`).
    - For each element at index `i`, generates a random index `j` such that 0 <= j <= i using `fd_rng_ulong_roll`.
    - Swaps the elements at indices `i` and `j`.
- **Output**: The function does not return a value; it modifies the input array `pair` in place.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_chain_multi.c#L46>)

Initializes and tests a map and pool data structure using command-line parameters for configuration.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Extracts `pool_max`, `chain_cnt`, `seed`, and `iter_max` from command-line arguments with default values if not provided.
    - Logs the configuration parameters for testing.
    - Initializes a random number generator `rng`.
    - Checks if `pool_max` exceeds 512 and logs a warning if true, then returns 0.
    - Initializes `ref` and `tst` arrays with random values and sorts `ref`.
    - Allocates memory for a pool using the `ALLOC` macro and joins it.
    - Performs various tests on map properties and configurations using `FD_TEST`.
    - Iterates over a loop for `iter_max` iterations, performing insertion, verification, and deletion of elements in the map.
    - Logs progress every 100 iterations.
    - Verifies map properties and performs cleanup operations at the end.
    - Logs a success message and halts the program.
- **Output**: Returns 0 after completing the tests and cleanup operations.
- **Functions Called**:
    - [`shuffle_pair`](<#shuffle_pair>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)