<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for map data structure operations, including insertion, deletion, and key-value integrity checks.

# Purpose
The code is a C program that tests the functionality of a map data structure, which is a type of associative array or dictionary. The program includes a custom sorting function and a map implementation, both of which are included from external files `fd_sort.c` and `fd_map.c`. The map is designed to store and manage `pair_t` structures, which consist of a key (`mykey`), an optional hash (`myhash`), and a value (`val`). The map uses a fixed number of slots, defined by the `LG_SLOT_CNT` macro, and can optionally use memoization for hash values, controlled by the `MEMOIZE` macro.

The main function initializes a random number generator and creates two arrays of `pair_t` structures, `ref` and `tst`, which are used to test the map's insertion, query, and deletion operations. The program performs multiple iterations of inserting and removing elements from the map, ensuring that the map behaves correctly by checking that inserted elements can be retrieved and that removed elements are no longer present. The code also includes tests for the map's alignment and footprint, as well as tests for handling invalid keys. Additionally, the program contains a section for testing error handling in a hosted environment, using process forking to verify that certain operations trigger critical log messages.
# Imports and Dependencies

---
- `../fd_util.h`
- `sys/types.h`
- `sys/wait.h`
- `unistd.h`
- `fd_sort.c`
- `fd_map.c`


# Global Variables

---
### \_map
- **Type**: ``pair_t` array`
- **Description**: An array of `pair_t` structures, where each element contains a key (`mykey`) and a value (`val`). The size of the array is determined by the expression `1UL<<LG_SLOT_CNT`, which is a power of two based on the `LG_SLOT_CNT` macro.
- **Use**: Used to store key-value pairs for a map data structure, allowing for efficient insertion, deletion, and lookup operations.


# Data Structures

---
### pair
- **Type**: ``struct``
- **Members**:
    - `mykey`: A unique key of type `ulong` for identifying the pair.
    - `myhash`: A hash value of type `uint` for the key, used if `MEMOIZE` is enabled.
    - `val`: A value of type `uint` associated with the key.
- **Description**: Defines a `struct pair` that holds a key-value pair, where `mykey` is a unique identifier, `val` is the associated value, and `myhash` is an optional hash of the key used for memoization when `MEMOIZE` is enabled.


---
### pair\_t
- **Type**: ``struct``
- **Members**:
    - `mykey`: A unique key of type `ulong` for identifying the pair.
    - `myhash`: A hash value of type `uint` for the key, used if `MEMOIZE` is enabled.
    - `val`: A value of type `uint` associated with the key.
- **Description**: Defines a data structure that represents a key-value pair, where `mykey` is the unique identifier, `val` is the associated value, and `myhash` is an optional hash of the key used for optimization when `MEMOIZE` is enabled.


# Functions

---
### shuffle\_pair<!-- {{#callable:shuffle_pair}} -->
[View Source →](<../../../../../src/util/tmpl/test_map.c#L38>)

Randomizes the order of elements in an array of `pair_t` structures using the Fisher-Yates shuffle algorithm.
- **Inputs**:
    - `rng`: A pointer to a random number generator of type `fd_rng_t` used to generate random indices.
    - `pair`: A pointer to an array of `pair_t` structures that will be shuffled.
    - `cnt`: The number of elements in the `pair` array to shuffle.
- **Logic and Control Flow**:
    - Iterates over the array from the second element to the last (index 1 to `cnt-1`).
    - For each element at index `i`, generates a random index `j` such that `0 <= j <= i` using `fd_rng_ulong_roll`.
    - Swaps the elements at indices `i` and `j` in the `pair` array.
- **Output**: The function does not return a value; it modifies the input array `pair` in place.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tmpl/test_map.c#L48>)

Initializes a random number generator, creates and tests a map data structure with randomized insertion and deletion operations, and performs validation checks.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Initializes a random number generator `rng` using `fd_rng_new` and `fd_rng_join`.
    - Defines two arrays `ref` and `tst` of type `pair_t` with a maximum size determined by `LG_SLOT_CNT`.
    - Populates `ref` and `tst` arrays with unique keys and random values, and sorts `ref` using `sort_pair_inplace`.
    - Creates a new map using `map_new` and joins it with `map_join`.
    - Performs various validation checks on map properties and key operations using `FD_TEST`.
    - Iterates 100 times, shuffling `tst` and performing randomized insertion and deletion operations on the map.
    - During each iteration, validates map operations such as insertion, query, and removal using `FD_TEST`.
    - Tests error handling and logging for invalid map operations if `FD_HAS_HOSTED` and `FD_TMPL_USE_HANDHOLDING` are defined.
    - Deletes the random number generator using `fd_rng_delete` and calls `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`shuffle_pair`](<#shuffle_pair>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)