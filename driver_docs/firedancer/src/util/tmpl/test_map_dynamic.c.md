<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for dynamic map operations, including insertion, deletion, and validation of key-value pairs.

# Purpose
The code is a C program that tests the functionality of a dynamic map data structure. It includes sorting and mapping operations on a collection of `pair_t` structures, which consist of a key and a value, and optionally a hash for memoization. The program uses a random number generator to create and shuffle test data, ensuring that the map can handle insertion, querying, and deletion of entries correctly. The map is tested to its algorithmic limits, verifying that it maintains integrity and correctness under various operations.

The program includes conditional compilation for hosted environments, allowing for additional testing features such as process forking and signal handling. It uses external modules `fd_sort.c` and `fd_map_dynamic.c` to provide sorting and mapping functionalities, respectively. The main function initializes the environment, sets up the random number generator, and performs multiple iterations of map operations, including insertion, querying, and deletion, while checking for expected outcomes. The program also includes tests for error handling and boundary conditions, ensuring robustness in different scenarios.
# Imports and Dependencies

---
- `../fd_util.h`
- `sys/types.h`
- `sys/wait.h`
- `unistd.h`
- `fd_sort.c`
- `fd_map_dynamic.c`


# Global Variables

---
### mem
- **Type**: ``uchar[]``
- **Description**: An array of unsigned characters with a size of 16384 bytes, aligned to an 8-byte boundary.
- **Use**: Used as a memory buffer for operations involving the `map` data structure.


# Data Structures

---
### pair
- **Type**: ``struct``
- **Members**:
    - `mykey`: A unique key of type `ulong` for the pair.
    - `myhash`: A hash value of type `uint` for the key, used if `MEMOIZE` is enabled.
    - `val`: A value of type `uint` associated with the key.
- **Description**: Defines a `struct` named `pair` that holds a key-value pair, where `mykey` is a unique identifier, `val` is the associated value, and `myhash` is an optional hash of the key used for memoization if the `MEMOIZE` macro is set.


---
### pair\_t
- **Type**: ``struct``
- **Members**:
    - `mykey`: A unique key of type `ulong` for identifying the pair.
    - `myhash`: A hash value of type `uint` for the key, used if `MEMOIZE` is enabled.
    - `val`: A value of type `uint` associated with the key.
- **Description**: Defines a `struct` named `pair` that represents a key-value pair, where `mykey` is a unique identifier, `val` is the associated value, and `myhash` is an optional hash of the key used for memoization when `MEMOIZE` is enabled.


# Functions

---
### shuffle\_pair<!-- {{#callable:shuffle_pair}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_dynamic.c#L35>)

Randomizes the order of elements in an array of `pair_t` structures using the Fisher-Yates shuffle algorithm.
- **Inputs**:
    - `rng`: A pointer to an `fd_rng_t` structure used for generating random numbers.
    - `pair`: A pointer to an array of `pair_t` structures that will be shuffled.
    - `cnt`: The number of elements in the `pair` array to shuffle.
- **Logic and Control Flow**:
    - Iterates over the array from the second element to the last (index 1 to `cnt-1`).
    - For each element at index `i`, generates a random index `j` such that 0 <= j <= i using `fd_rng_ulong_roll`.
    - Swaps the elements at indices `i` and `j`.
- **Output**: The function does not return a value; it modifies the input array `pair` in place.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_dynamic.c#L47>)

Tests the functionality of a map data structure by inserting, querying, and deleting key-value pairs in a randomized order.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Initialize the random number generator and create arrays `ref` and `tst` to hold key-value pairs.
    - Generate unique keys and random values for each pair, storing them in `ref` and `tst`.
    - Sort the `ref` array in place based on keys.
    - Check alignment and footprint constraints for the map, logging a warning and exiting if constraints are not met.
    - Create and join a new map, verifying its initial state with assertions.
    - Iterate 100 times, shuffling `tst` and inserting its elements into the map, verifying each insertion and ensuring no duplicate keys are inserted.
    - After each insertion phase, shuffle `tst` again and delete its elements from the map, verifying each deletion and ensuring no remaining keys are deleted.
    - Test the map's behavior under invalid conditions using `FD_EXPECT_LOG_CRIT` to ensure critical errors are logged.
    - Delete the random number generator and log the test as passed before halting the program.
- **Output**: Returns 0 after successfully testing the map operations.
- **Functions Called**:
    - [`shuffle_pair`](<#shuffle_pair>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)