<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Generates high-performance, zero-copy heap implementations for non-sequential memory storage.

# Purpose
The code defines a template for creating high-performance, zero-copy heap data structures in C. It is designed for use in scenarios where heap elements are not stored sequentially in memory, unlike traditional heap implementations. The code provides a flexible API that allows for the creation of heaps that can be tightly integrated with other data structures such as pools and maps. The heaps can be persisted beyond the lifetime of the creating process, used concurrently, relocated in memory, serialized/deserialized, and moved between hosts. The API supports index compression for cache and memory bandwidth efficiency.

The code is structured to allow the generation of heap implementations by defining specific macros such as `HEAP_NAME`, `HEAP_T`, and `HEAP_LT`. These macros specify the heap's name, the type of elements it will store, and the comparison function for ordering elements, respectively. The code includes functions for creating, joining, leaving, and deleting heaps, as well as for inserting and removing elements. It also provides utility functions for checking heap integrity and accessing heap properties. The implementation is designed to be header-only or to generate separate headers and implementations for use in libraries, depending on the `HEAP_IMPL_STYLE` macro.
# Imports and Dependencies

---
- `../log/fd_log.h`


# Global Variables

---
### HEAP\_
- **Type**: `HEAP_(t)`
- **Description**: Represents a data structure for managing a heap where elements are not stored sequentially in memory. It includes fields for the maximum number of elements (`ele_max`), the current number of elements (`ele_cnt`), and the index of the root element (`root`).
- **Use**: Used to manage and perform operations on a heap, such as insertion and removal of elements, while maintaining the heap property.


# Functions

---
### HEAP\_<!-- {{#callable:HEAP_}} -->
[View Source →](<../../../../../src/util/tmpl/fd_heap.c#L607>)

Validates the integrity of a heap data structure by checking its properties and structure.
- **Inputs**:
    - `heap`: A pointer to a `HEAP_(t)` structure representing the heap to verify.
    - `pool`: A pointer to an array of `HEAP_T` elements representing the storage pool for the heap elements.
- **Logic and Control Flow**:
    - Define a macro `HEAP_TEST` to log a warning and return -1 if a condition is not met.
    - Check if `heap` is not NULL using `HEAP_TEST`.
    - Retrieve `ele_max` and `ele_cnt` from the `heap` structure.
    - Validate `ele_max` is less than or equal to `HEAP_IDX_NULL` and `ele_cnt` is less than or equal to `ele_max` using `HEAP_TEST`.
    - If `ele_max` is non-zero, validate `pool` is not NULL using `HEAP_TEST`.
    - Initialize a stack array of size 512 to keep track of nodes to visit and set `stack_cnt` to 0.
    - Set `visit_cnt` to 0 to count visited nodes.
    - Get the root index `i` from the heap and check if it is not `HEAP_IDX_NULL`.
    - If `i` is valid, ensure it is within bounds and push it onto the stack.
    - While there are nodes to visit (`stack_cnt` is non-zero), pop the stack to get the next node index `i`.
    - Ensure `visit_cnt` is less than `ele_cnt` to avoid cycles.
    - For each node, check its right child `r` and left child `l` for heap property satisfaction, inbounds, and stack overflow, then push them onto the stack if valid.
    - Increment `visit_cnt` after visiting a node.
    - After visiting all nodes, ensure `visit_cnt` equals `ele_cnt` using `HEAP_TEST`.
- **Output**: Returns 0 if the heap is valid, or -1 if any validation fails.
- **Functions Called**:
    - [`HEAP_`](<#heap_>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)