<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for map chain functionality, including insertion, deletion, iteration, and verification of map elements.

# Purpose
The code is a C program that tests the functionality of a data structure system involving pools, maps, and sorting operations. It includes the definition of a `pair_t` structure, which is used as the element type for various operations. The program uses several macros to configure and include external C files (`fd_sort.c`, `fd_pool.c`, and `fd_map_chain.c`) that provide sorting, pool management, and map management functionalities, respectively. The `pair_t` structure contains fields for keys, next and previous indices, values, and tags, which are used in the operations of the data structures.

The [`main`](<#main>) function initializes the environment and sets up parameters for testing, such as pool size, chain count, seed, and iteration count. It then performs a series of tests to verify the correct behavior of the pool and map operations, including insertion, deletion, and iteration over elements. The program also tests the handling of edge cases, such as memory alignment and map capacity limits. Additionally, it includes tests for fast removal operations and verifies the integrity of the data structures after various operations. The program uses logging to report the progress and results of the tests, and it concludes by cleaning up resources and halting execution.
# Imports and Dependencies

---
- `../fd_util.h`
- `sys/types.h`
- `sys/wait.h`
- `unistd.h`
- `fd_sort.c`
- `fd_pool.c`
- `fd_map_chain.c`


# Global Variables

---
### scratch
- **Type**: `uchar array`
- **Description**: `scratch` is a global array of unsigned characters with a size defined by the macro `SCRATCH_SZ`, which is set to 32768. This array is used as a memory buffer for dynamic memory allocation during the execution of the program.
- **Use**: Used to allocate memory dynamically within the program using the `ALLOC` macro.


# Data Structures

---
### pair
- **Type**: ``struct``
- **Members**:
    - ``key``: An unsigned integer used as a key in the union.
    - ``mykey``: An unsigned integer used as an alternative key in the union.
    - ``mynext``: An unsigned integer representing the next element in a sequence.
    - ``myprev``: An unsigned integer representing the previous element in a sequence.
    - ``val``: An unsigned integer representing a value associated with the pair.
    - ``tag``: An unsigned integer used as a tag for additional information.
- **Description**: The `pair` structure is a compound data type that contains a union of two unsigned integers, `key` and `mykey`, which serve as keys for the structure. It also includes `mynext` and `myprev` for linking elements in a sequence, `val` for storing a value, and `tag` for tagging purposes. This structure is used in various operations such as sorting, mapping, and pooling within the provided code.


---
### pair\_t
- **Type**: ``struct``
- **Members**:
    - ``key``: An unsigned integer used as a key in the union.
    - ``mykey``: An unsigned integer used as an alternative key in the union.
    - ``mynext``: An unsigned integer representing the next element in a linked structure.
    - ``myprev``: An unsigned integer representing the previous element in a linked structure.
    - ``val``: An unsigned integer representing the value associated with the pair.
    - ``tag``: An unsigned integer used for tagging or marking purposes.
- **Description**: Defines a `struct` named `pair` that contains a union with two unsigned integer keys (`key` and `mykey`), and additional fields for managing linked structures (`mynext`, `myprev`), a value (`val`), and a tag (`tag`).


# Functions

---
### shuffle\_pair<!-- {{#callable:shuffle_pair}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_chain.c#L52>)

Randomizes the order of elements in an array of `pair_t` structures using the Fisher-Yates shuffle algorithm.
- **Inputs**:
    - ``rng``: A pointer to a random number generator of type `fd_rng_t` used to generate random indices.
    - ``pair``: A pointer to an array of `pair_t` structures that will be shuffled.
    - ``cnt``: The number of elements in the `pair` array to shuffle.
- **Logic and Control Flow**:
    - Iterates over the array starting from the second element (index 1) to the last element (index `cnt-1`).
    - For each element at index `i`, generates a random index `j` such that `0 <= j <= i` using the `fd_rng_ulong_roll` function.
    - Swaps the elements at indices `i` and `j` in the `pair` array.
- **Output**: No return value; the function modifies the `pair` array in place.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/tmpl/test_map_chain.c#L65>)

Initializes and tests a map data structure with various configurations and operations, including insertion, deletion, and verification of elements.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line arguments.
- **Logic and Control Flow**:
    - Calls `fd_boot` to initialize the environment with command-line arguments.
    - Extracts command-line options for `--pool-max`, `--chain-cnt`, `--seed`, and `--iter-max` with default values if not provided.
    - Logs the testing configuration using the extracted options.
    - Initializes a random number generator `rng`.
    - Checks if `pool_max` exceeds 512 and logs a warning if true, then exits.
    - Initializes `ref` and `tst` arrays with unique keys and random values, then sorts `ref`.
    - Allocates memory for a pool using the `ALLOC` macro and joins it.
    - Performs various tests on map configurations, including alignment and footprint checks.
    - Creates and joins a map with the specified chain count and seed, then verifies its properties.
    - Iterates over a loop for `iter_max` iterations, performing insertion and deletion operations on the map.
    - Tests handholding and fast removal cases if hosted environment is available.
    - Logs the completion of tests and halts the program.
- **Output**: Returns 0 upon successful completion of all tests.
- **Functions Called**:
    - [`shuffle_pair`](<#shuffle_pair>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)