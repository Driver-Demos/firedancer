<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Tests for the `fd_histf` histogram functionality, including alignment, sampling, and performance.

# Purpose
The code is a test suite for a floating-point histogram module, which is part of a larger software system. It includes tests for various functionalities of the histogram, such as alignment, footprint, sampling, bucket counting, and percentile calculations. The code uses assertions to verify that the histogram behaves as expected when performing operations like sampling and calculating percentiles. It also tests the performance of the histogram sampling function by measuring the time taken to process a large number of samples.

The code begins by including necessary headers and defining static assertions to ensure that the alignment and footprint of the histogram structure match expected values. The [`main`](<#main>) function initializes the test environment, creates a histogram, and performs a series of tests to validate the histogram's behavior. It uses helper functions like [`assert_range`](<#assert_range>) to check the range of values in histogram buckets. The code also includes performance testing to measure the average time per sample, excluding random number generation overhead. Finally, it tests the cleanup functions to ensure that resources are properly released.
# Imports and Dependencies

---
- `../fd_util.h`
- `fd_histf.h`
- `../rng/fd_rng.h`
- `math.h`
- `stdlib.h`


# Functions

---
### assert\_range<!-- {{#callable:assert_range}} -->
[View Source →](<../../../../../src/util/hist/test_histf.c#L10>)

Validates that a histogram's bucket boundaries and sample counts are correct within a specified range.
- **Inputs**:
    - ``hist``: A pointer to the histogram structure `fd_histf_t` to be tested.
    - ``idx``: The index of the histogram bucket to validate.
    - ``left_edge``: The left boundary of the range to test, exclusive.
    - ``right_edge``: The right boundary of the range to test, exclusive.
- **Logic and Control Flow**:
    - Check if the left boundary of the histogram bucket at `idx` equals `left_edge` using `FD_TEST`.
    - Check if the right boundary of the histogram bucket at `idx` equals `right_edge` using `FD_TEST`.
    - Store the current count of samples in the bucket at `idx` in `expected`.
    - Store the current sum of all samples in the histogram in `initial_sum`.
    - Sample the histogram at `left_edge-1UL` and verify the count at `idx` remains `expected`.
    - Iterate from `left_edge` to `right_edge`, sampling the histogram at each point and incrementing `expected`, verifying the count at `idx` matches `expected`.
    - Sample the histogram at `right_edge` and verify the count at `idx` remains `expected`.
    - Verify the total sum of samples in the histogram equals `initial_sum` plus the calculated sum of the range.
- **Output**: No return value; the function uses assertions to validate conditions.
- **Functions Called**:
    - [`fd_histf_left`](<fd_histf.h.md#fd_histf_left>)
    - [`fd_histf_right`](<fd_histf.h.md#fd_histf_right>)
    - [`fd_histf_cnt`](<fd_histf.h.md#fd_histf_cnt>)
    - [`fd_histf_sum`](<fd_histf.h.md#fd_histf_sum>)
    - [`fd_histf_sample`](<fd_histf.h.md#fd_histf_sample>)


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../../src/util/hist/test_histf.c#L33>)

Executes a series of tests on a histogram data structure, including alignment, footprint, sampling, range assertions, bucket count, percentile calculations, and performance measurements.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Initializes the environment with `fd_boot` and logs the start of testing.
    - Tests alignment and footprint of the histogram with [`fd_histf_align`](<fd_histf.h.md#fd_histf_align>) and [`fd_histf_footprint`](<fd_histf.h.md#fd_histf_footprint>).
    - Allocates memory for a histogram and initializes it with [`fd_histf_new`](<fd_histf.h.md#fd_histf_new>).
    - Joins the histogram with [`fd_histf_join`](<fd_histf.h.md#fd_histf_join>) and verifies its integrity.
    - Samples the histogram with [`fd_histf_sample`](<fd_histf.h.md#fd_histf_sample>) and checks counts with [`fd_histf_cnt`](<fd_histf.h.md#fd_histf_cnt>).
    - Performs range assertions using [`assert_range`](<#assert_range>) to verify bucket boundaries.
    - Tests the bucket count with [`fd_histf_bucket_cnt`](<fd_histf.h.md#fd_histf_bucket_cnt>).
    - Calculates percentiles with [`fd_histf_percentile`](<fd_histf.h.md#fd_histf_percentile>) and verifies results.
    - Measures performance by timing histogram sampling operations and logs the average time per sample.
    - Leaves and deletes the histogram with [`fd_histf_leave`](<fd_histf.h.md#fd_histf_leave>) and [`fd_histf_delete`](<fd_histf.h.md#fd_histf_delete>), then frees allocated memory.
    - Logs the completion of tests and halts the program with `fd_halt`.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_histf_align`](<fd_histf.h.md#fd_histf_align>)
    - [`fd_histf_footprint`](<fd_histf.h.md#fd_histf_footprint>)
    - [`fd_histf_new`](<fd_histf.h.md#fd_histf_new>)
    - [`fd_histf_join`](<fd_histf.h.md#fd_histf_join>)
    - [`fd_histf_cnt`](<fd_histf.h.md#fd_histf_cnt>)
    - [`fd_histf_sample`](<fd_histf.h.md#fd_histf_sample>)
    - [`fd_histf_sum`](<fd_histf.h.md#fd_histf_sum>)
    - [`fd_histf_delete`](<fd_histf.h.md#fd_histf_delete>)
    - [`fd_histf_leave`](<fd_histf.h.md#fd_histf_leave>)
    - [`assert_range`](<#assert_range>)
    - [`fd_histf_bucket_cnt`](<fd_histf.h.md#fd_histf_bucket_cnt>)
    - [`fd_histf_percentile`](<fd_histf.h.md#fd_histf_percentile>)
    - [`fd_histf_subtract`](<fd_histf.h.md#fd_histf_subtract>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)