<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for integrating AddressSanitizer (ASan) functionality to manage memory poisoning and access checks.

# Purpose
The code is a C header file that provides an interface for integrating AddressSanitizer (ASan) functionality into a program. ASan is a tool that detects memory errors such as out-of-bounds accesses and use-after-free bugs. This header file defines macros and inline functions to manage memory poisoning and unpoisoning, which are essential for marking memory regions as addressable or unaddressable. The file checks if ASan is available in the compilation environment using the `FD_HAS_ASAN` macro and provides conditional definitions based on its presence.

The primary functions defined in this file include [`fd_asan_poison`](<#fd_asan_poison>), [`fd_asan_unpoison`](<#fd_asan_unpoison>), [`fd_asan_test`](<#fd_asan_test>), and [`fd_asan_query`](<#fd_asan_query>). These functions allow the user to mark memory regions as poisoned or unpoisoned, test if a specific address is poisoned, and query if any part of a memory region is poisoned. If ASan is not available, these functions default to no-op implementations. The file also includes provisions for deeper ASan integration with `FD_HAS_DEEPASAN` and `FD_HAS_DEEPASAN_WATCH` macros, which add additional checks and functionality for memory region monitoring.
# Imports and Dependencies

---
- `../fd_util_base.h`


# Functions

---
### fd\_asan\_poison<!-- {{#callable:fd_asan_poison}} -->
[View Source →](<../../../../../src/util/sanitize/fd_asan.h#L110>)

Marks a memory region as unaddressable and returns the address.
- **Inputs**:
    - `addr`: A pointer to the start of the memory region to poison.
    - `sz`: The size of the memory region to poison, in bytes.
- **Logic and Control Flow**:
    - If `FD_HAS_ASAN` is set, calls `__asan_poison_memory_region` to mark the memory region `[addr, addr+sz)` as unaddressable.
    - If `FD_HAS_DEEPASAN_WATCH` is defined, calls `fd_asan_check_watch` with parameters `1`, `addr`, and `sz` to monitor the poisoned region.
    - Returns the `addr` pointer.
- **Output**: Returns the input address `addr`.


---
### fd\_asan\_unpoison<!-- {{#callable:fd_asan_unpoison}} -->
[View Source →](<../../../../../src/util/sanitize/fd_asan.h#L111>)

Marks a memory region as addressable and returns the address.
- **Inputs**:
    - `addr`: A pointer to the start of the memory region to unpoison.
    - `sz`: The size of the memory region to unpoison, in bytes.
- **Logic and Control Flow**:
    - If `FD_HAS_ASAN` is set, calls `__asan_unpoison_memory_region` to mark the memory region `[addr, addr+sz)` as addressable.
    - If `FD_HAS_DEEPASAN_WATCH` is defined, calls `fd_asan_check_watch` to update the watch status for the memory region.
    - Returns the `addr` pointer.
- **Output**: Returns the `addr` pointer, indicating the start of the unpoisoned memory region.


---
### fd\_asan\_test<!-- {{#callable:fd_asan_test}} -->
[View Source →](<../../../../../src/util/sanitize/fd_asan.h#L112>)

Checks if an address is poisoned by ASan and returns 0 if ASan is not enabled.
- **Inputs**:
    - `addr`: A pointer to the memory address to test for poisoning.
- **Logic and Control Flow**:
    - If `FD_HAS_ASAN` is set, call `__asan_address_is_poisoned` with `addr` and return its result.
    - If `FD_HAS_ASAN` is not set, cast `addr` to void to suppress unused variable warnings and return 0.
- **Output**: Returns 1 if the address is poisoned, otherwise returns 0. If ASan is not enabled, always returns 0.


---
### fd\_asan\_query<!-- {{#callable:fd_asan_query}} -->
[View Source →](<../../../../../src/util/sanitize/fd_asan.h#L113>)

Returns NULL, indicating no memory region is poisoned, when AddressSanitizer is not enabled.
- **Inputs**:
    - `addr`: A pointer to the start of the memory region to check.
    - `sz`: The size of the memory region to check.
- **Logic and Control Flow**:
    - The function takes two parameters: `addr` and `sz`, which represent the start and size of a memory region, respectively.
    - Both parameters are cast to void to indicate they are unused in this implementation.
    - The function returns NULL, indicating that no part of the memory region is poisoned.
- **Output**: Returns NULL, indicating that no byte in the specified memory region is poisoned.


# Function Declarations (Public API)

---
### fd\_asan\_check\_watch<!-- {{#callable_declaration:fd_asan_check_watch}} -->
[View Source →](<../../../../../src/util/sanitize/fd_asan.h#L95>)

Checks and logs the status of memory addresses under ASan watch.
- **Description**: Use this function to verify and log the status of memory addresses that are being monitored by AddressSanitizer (ASan). It is useful for debugging purposes when you need to know if specific memory regions are marked as poisoned or not. This function should be called when you want to check the status of a memory region that might have been affected by ASan's memory poisoning. It logs the status to standard error and provides a backtrace for further analysis. Ensure that the ASan watch feature is enabled before using this function.
- **Inputs**:
    - `poison`: An integer indicating the desired status of the memory region. Use a non-zero value to indicate that the region should be poisoned, and zero to indicate it should not be poisoned.
    - `addr`: A pointer to the start of the memory region to check. Must not be null and should point to a valid memory region.
    - `sz`: The size of the memory region in bytes. Must be a positive value.
- **Output**: None
- **See Also**: [`fd_asan_check_watch`](<fd_asan.c.md#fd_asan_check_watch>)  (Implementation)


---
### fd\_asan\_watch<!-- {{#callable_declaration:fd_asan_watch}} -->
[View Source →](<../../../../../src/util/sanitize/fd_asan.h#L96>)

Monitors a memory address for AddressSanitizer status.
- **Description**: Use this function to track a specific memory address with AddressSanitizer (ASan) to determine if it is poisoned or not. This is useful for debugging memory issues in programs that use custom memory allocators or shared memory segments. The function logs the address and its ASan status to standard error. It is important to note that there is a limit of 64 addresses that can be watched simultaneously. Exceeding this limit will result in a critical log message. Ensure that ASan is enabled in your build environment to utilize this function effectively.
- **Inputs**:
    - `addr`: A pointer to the memory address to monitor. Must not be null. The address should be part of a memory region managed by your program. Invalid or null addresses will not be handled by this function.
- **Output**: None
- **See Also**: [`fd_asan_watch`](<fd_asan.c.md#fd_asan_watch>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)