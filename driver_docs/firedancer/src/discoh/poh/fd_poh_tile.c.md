<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

An implementation of the Proof of History (PoH) tile for the Firedancer codebase, handling leader scheduling, slot management, and transaction processing in a Solana-like blockchain environment.

# Purpose
The code is a C implementation of a Proof of History (PoH) module, which is a component of the Solana blockchain protocol. The PoH module is responsible for maintaining a verifiable sequence of hashes that represent the passage of time and the order of transactions. This module is crucial for ensuring the integrity and consistency of the blockchain, as it allows nodes to agree on the order of transactions without relying on a central authority.

The code defines a complex system of structures and functions to manage the PoH process. It includes mechanisms for handling leader transitions, slot management, and transaction processing. The module interacts with other components of the Solana network, such as the transaction execution engine and the leader schedule, to coordinate the production and verification of blocks. The code also includes provisions for handling various edge cases and ensuring that the PoH process remains robust in the face of network delays or malicious actors. The module is designed to be integrated into a larger system, with interfaces for external components to interact with the PoH process.
# Imports and Dependencies

---
- `../../disco/tiles.h`
- `../../disco/fd_txn_m.h`
- `../../disco/bundle/fd_bundle_crank.h`
- `../../disco/pack/fd_pack.h`
- `../../disco/pack/fd_pack_cost.h`
- `../../ballet/sha256/fd_sha256.h`
- `../../disco/metrics/fd_metrics.h`
- `../../util/pod/fd_pod.h`
- `../../disco/shred/fd_shredder.h`
- `../../disco/keyguard/fd_keyload.h`
- `../../disco/keyguard/fd_keyswitch.h`
- `../../disco/metrics/generated/fd_metrics_poh.h`
- `../../disco/plugin/fd_plugin.h`
- `../../flamenco/leaders/fd_multi_epoch_leaders.h`
- `string.h`
- `../../disco/stem/fd_stem.c`


# Global Variables

---
### fd\_poh\_global\_ctx
- **Type**: ``fd_poh_ctx_t *``
- **Description**: Represents a pointer to a `fd_poh_ctx_t` structure, which is used to manage the state and operations of the Proof of History (PoH) tile in the system. This structure contains various fields related to the configuration, state, and operation of the PoH, including timing, hashing, and leader management.
- **Use**: Used to access and manipulate the global context of the PoH tile, allowing for operations such as slot management, hash computation, and leader transitions.


---
### fd\_poh\_waiting\_lock
- **Type**: `volatile ulong`
- **Description**: A volatile unsigned long integer variable that is aligned to a 128-byte boundary.
- **Use**: Used as a flag to signal when a lock is requested by setting it to 1.


---
### fd\_poh\_returned\_lock
- **Type**: `volatile ulong`
- **Description**: A global variable that is used to signal when the PoH tile has granted access to a waiting process.
- **Use**: Used to indicate to a waiting process that it can proceed with accessing the PoH tile.


---
### 
- **Type**: ``struct poh_link``
- **Description**: Represents a data structure used to manage links in the Proof of History (PoH) tile. It contains metadata and pointers for managing memory caches and data chunks.
- **Use**: Used to manage and coordinate data flow between different components in the PoH tile.


---
### gossip\_dedup
- **Type**: ``poh_link_t``
- **Description**: `gossip_dedup` is a static instance of the `poh_link_t` structure, which is used to manage a link in the Proof of History (PoH) system. This structure contains metadata and pointers necessary for managing data flow and synchronization between different components in the system.
- **Use**: Used to manage and publish data related to gossip deduplication in the PoH system.


---
### stake\_out
- **Type**: ``poh_link_t``
- **Description**: `stake_out` is a static variable of type `poh_link_t`, which is a structure used to manage a link in the Proof of History (PoH) system. It contains metadata and pointers necessary for managing data flow between different components in the system.
- **Use**: Used to publish leader schedule data to the network.


---
### crds\_shred
- **Type**: ``poh_link_t``
- **Description**: `crds_shred` is a static variable of type `poh_link_t`, which is a structure used to manage a link in the Proof of History (PoH) system. It contains metadata and pointers necessary for managing data flow between different components in the system.
- **Use**: Used to publish cluster information to the CRDS shred tile.


---
### replay\_resolv
- **Type**: ``poh_link_t``
- **Description**: `replay_resolv` is a static variable of type `poh_link_t`, which is a structure used to manage data flow between different components in a system. It contains fields for managing memory, sequence numbers, and other metadata necessary for data transmission.
- **Use**: Used to publish data related to replay resolution in the system.


---
### executed\_txn
- **Type**: ``poh_link_t``
- **Description**: The `poh_link_t` structure represents a link used for publishing executed transactions in the Proof of History (PoH) system. It contains metadata and pointers necessary for managing the data cache and sequence of transactions.
- **Use**: Used to publish executed transactions to the PoH system.


---
### replay\_plugin
- **Type**: ``poh_link_t``
- **Description**: `poh_link_t` is a structure that represents a link in the Proof of History (PoH) system. It contains metadata and pointers necessary for managing data flow between different components in the system.
- **Use**: Used to manage data flow and synchronization between components in the PoH system.


---
### gossip\_plugin
- **Type**: ``poh_link_t``
- **Description**: Represents a data structure used to manage a communication link in the system. It contains fields for managing memory, sequence numbers, and other metadata related to the link's operation.
- **Use**: Used to facilitate communication between different components or plugins in the system by managing data flow and synchronization.


---
### start\_progress\_plugin
- **Type**: `poh_link_t`
- **Description**: `start_progress_plugin` is a static variable of type `poh_link_t`. It represents a link structure used for managing data flow in a plugin system.
- **Use**: Used to manage and publish data related to the start progress of a plugin in the system.


---
### vote\_listener\_plugin
- **Type**: ``poh_link_t``
- **Description**: Represents a data structure used to manage a communication link for the vote listener plugin in the system. It contains fields for managing memory, sequence numbers, and other metadata related to the link's operation.
- **Use**: Used to handle the communication and data flow for the vote listener plugin within the system.


---
### validator\_info\_plugin
- **Type**: `poh_link_t`
- **Description**: `validator_info_plugin` is a static instance of the `poh_link_t` structure, which is used to manage a communication link in the system. This structure contains metadata and pointers necessary for managing data flow between different components in the system.
- **Use**: Used to facilitate communication and data transfer for validator information within the plugin system.


---
### fd\_shred\_version
- **Type**: ``volatile ulong *``
- **Description**: A pointer to a volatile unsigned long integer that represents the shred version in the system. This variable is used to communicate the shred version from the PoH tile to the shred tile, which do not share the same address space.
- **Use**: Used to set and communicate the shred version to the shred tile.


---
### fd\_tile\_poh
- **Type**: ``fd_topo_run_tile_t``
- **Description**: Represents a configuration structure for a Proof of History (PoH) tile in a distributed system. It contains function pointers and parameters necessary for initializing and running the PoH tile.
- **Use**: Used to define and configure the behavior of a PoH tile, including its initialization and execution routines.


# Data Structures

---
### fd\_poh\_in\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``mem``: Pointer to a `fd_wksp_t` workspace.
    - ``chunk0``: Unsigned long integer representing the initial chunk index.
    - ``wmark``: Unsigned long integer representing the watermark or limit for chunks.
- **Description**: The `fd_poh_in_ctx_t` structure is used to manage input context for Proof of History (PoH) operations. It contains a pointer to a workspace (`mem`), an initial chunk index (`chunk0`), and a watermark (`wmark`) to manage and track the processing of data chunks within the workspace.


---
### fd\_poh\_out\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``idx``: An unsigned long integer representing an index.
    - ``mem``: A pointer to a `fd_wksp_t` structure, representing a memory workspace.
    - ``chunk0``: An unsigned long integer representing the initial chunk.
    - ``wmark``: An unsigned long integer representing a watermark.
    - ``chunk``: An unsigned long integer representing a chunk.
- **Description**: The `fd_poh_out_ctx_t` structure is used to manage output context in a Proof of History (PoH) system. It contains an index, a pointer to a memory workspace, and several unsigned long integers to track chunks and watermarks, which are essential for managing data flow and memory allocation in the PoH process.


---
### fd\_poh\_ctx\_t
- **Type**: ``struct``
- **Members**:
    - ``stem``: Pointer to `fd_stem_context_t`, representing the stem context.
    - ``tick_duration_ns``: Duration of a tick in nanoseconds.
    - ``hashcnt_per_tick``: Number of hash counts per tick.
    - ``ticks_per_slot``: Number of ticks per slot.
    - ``slot_duration_ns``: Duration of a slot in nanoseconds, precomputed from configuration.
    - ``hashcnt_duration_ns``: Duration of a hash count in nanoseconds, precomputed from configuration.
    - ``hashcnt_per_slot``: Number of hash counts per slot, precomputed from configuration.
    - ``max_microblocks_per_slot``: Maximum number of microblocks that can be published in each slot.
    - ``limits``: Struct containing consensus-critical slot cost limits.
    - ``slot``: Current slot number in the proof of history.
    - ``hashcnt``: Current hash count within the slot.
    - ``cus_used``: Cumulative units used in the current slot.
    - ``last_slot``: Slot number of the last published microblock.
    - ``last_hashcnt``: Hash count of the last published microblock.
    - ``highwater_leader_slot``: Tracks the maximum slot for which a tick or microblock has been published.
    - ``lagged_consecutive_leader_start``: Indicates if the expected slot end time is not reset between consecutive leader slots.
    - ``expect_sequential_leader_slot``: Expected slot number for sequential leader slots.
    - ``expect_pack_idx``: Expected index of the pack.
    - ``slot_done``: Indicates if the slot done message has been received from the pack.
    - ``pack_leader_bank``: Reference to the bank object held on behalf of the pack tile.
    - ``microblocks_lower_bound``: Tracks the lower bound of microblocks in the slot.
    - ``reset_hash``: Hash value at the reset point, aligned to 32 bytes.
    - ``hash``: Current hash value, aligned to 32 bytes.
    - ``skipped_tick_hashes``: Array storing hashes for skipped ticks.
    - ``reset_slot_start_ns``: Timestamp in nanoseconds when the reset slot was received.
    - ``leader_bank_start_ns``: Timestamp in nanoseconds when the bank for the current leader slot was received.
    - ``reset_slot``: Hash count corresponding to the start of the current reset slot.
    - ``next_leader_slot``: Hash count at which the next leader slot begins.
    - ``skip_frag``: Indicates if an in-progress fragment should be skipped.
    - ``max_active_descendant``: Maximum active descendant slot number.
    - ``current_leader_bank``: Reference to the current leader bank if the node is the leader.
    - ``sha256``: Pointer to `fd_sha256_t`, representing the SHA-256 context.
    - ``mleaders``: Pointer to `fd_multi_epoch_leaders_t`, representing multi-epoch leaders.
    - ``shred_seq``: Last sequence number of an outgoing fragment to the shred tile.
    - ``halted_switching_key``: Indicates if the switching key is halted.
    - ``keyswitch``: Pointer to `fd_keyswitch_t`, representing the keyswitch context.
    - ``identity_key``: Public key of the identity.
    - ``bundle``: Struct containing information for bundle crank generation.
    - ``signal_leader_change``: Pointer to a signal for leader change notification.
    - ``_txns``: Array storing transactions temporarily during fragment processing.
    - ``_microblock_trailer``: Array storing microblock trailer temporarily during fragment processing.
    - ``in_kind``: Array indicating the kind of input for each input context.
    - ``in``: Array of input contexts for processing.
    - ``shred_out``: Output context for shreds.
    - ``pack_out``: Output context for packs.
    - ``plugin_out``: Output context for plugins.
    - ``begin_leader_delay``: Histogram for measuring delay in beginning leader slot.
    - ``first_microblock_delay``: Histogram for measuring delay in first microblock processing.
    - ``slot_done_delay``: Histogram for measuring delay in slot completion.
    - ``bundle_init_delay``: Histogram for measuring delay in bundle initialization.
    - ``features_activation_avail``: Indicates if features activation is available.
    - ``features_activation``: Array storing features activation slots.
    - ``parent_slot``: Slot number of the parent block.
    - ``parent_block_id``: ID of the parent block.
    - ``mleaders_mem``: Memory for multi-epoch leaders, aligned to `FD_MULTI_EPOCH_LEADERS_ALIGN`.
- **Description**: `fd_poh_ctx_t` is a complex data structure used in the context of Proof of History (PoH) in a blockchain system. It manages the state and configuration for PoH, including timing, hashing, and slot management. The structure contains fields for static configuration, derived timing values, current slot and hash count, and various limits and states related to microblocks and leader slots. It also includes references to cryptographic contexts, leader schedules, and input/output contexts for processing transactions and microblocks. The structure is critical for maintaining the integrity and order of transactions in the blockchain, ensuring that slots are processed correctly and efficiently.


---
### poh\_link
- **Type**: ``struct``
- **Members**:
    - ``mcache``: Pointer to `fd_frag_meta_t`, used for metadata caching.
    - ``depth``: Unsigned long integer representing the depth of the link.
    - ``tx_seq``: Unsigned long integer representing the transaction sequence number.
    - ``mem``: Pointer to memory used by the link.
    - ``dcache``: Pointer to data cache used by the link.
    - ``chunk0``: Unsigned long integer representing the initial chunk of data.
    - ``wmark``: Unsigned long integer representing the watermark for data chunks.
    - ``chunk``: Unsigned long integer representing the current data chunk.
    - ``cr_avail``: Unsigned long integer representing the available credit for the link.
    - ``rx_cnt``: Unsigned long integer representing the count of received sequences.
    - ``rx_fseqs``: Array of pointers to unsigned long integers, representing received sequence numbers.
- **Description**: The `poh_link` structure is used to manage and track the state of a link in a Proof of History (PoH) system. It includes pointers to metadata and data caches, as well as various unsigned long integers to track the depth, transaction sequence, and available credits. The structure also manages data chunks and received sequence numbers, facilitating the coordination and processing of data within the PoH system.


---
### poh\_link\_t
- **Type**: ``struct``
- **Members**:
    - ``mcache``: Pointer to a fragment metadata cache.
    - ``depth``: Depth of the cache.
    - ``tx_seq``: Transaction sequence number.
    - ``mem``: Pointer to memory space.
    - ``dcache``: Pointer to data cache.
    - ``chunk0``: Initial chunk index.
    - ``wmark``: Watermark for the data cache.
    - ``chunk``: Current chunk index.
    - ``cr_avail``: Available credit for publishing.
    - ``rx_cnt``: Count of receive sequences.
    - ``rx_fseqs``: Array of pointers to receive sequences.
- **Description**: `poh_link_t` is a structure that manages the state and operations related to a link in a Proof of History (PoH) system. It includes pointers to memory and data caches, transaction sequence numbers, and mechanisms for managing data chunks and credits for publishing. The structure is used to facilitate communication and data transfer between different components in the PoH system.


# Functions

---
### poh\_link\_wait\_credit<!-- {{#callable:poh_link_wait_credit}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L639>)

Waits for credit availability on a `poh_link_t` link before proceeding.
- **Inputs**:
    - `link`: A pointer to a `poh_link_t` structure representing the link to check for credit availability.
- **Logic and Control Flow**:
    - Check if `link->cr_avail` is non-zero using `FD_LIKELY`; if true, return immediately.
    - Enter an infinite loop to wait for credit availability.
    - Initialize `cr_query` to `ULONG_MAX`.
    - Iterate over each receiver sequence in `link->rx_fseqs` up to `link->rx_cnt`.
    - For each receiver sequence, calculate `rx_cr_query` as the minimum of the link's depth minus the maximum of the sequence difference and zero, and zero.
    - Update `cr_query` to the minimum of `rx_cr_query` and `cr_query`.
    - If `cr_query` is greater than zero, set `link->cr_avail` to `cr_query` and break the loop.
    - If `cr_query` is not greater than zero, call `FD_SPIN_PAUSE()` to yield the processor.
- **Output**: No return value; the function modifies the `link` structure in place.


---
### poh\_link\_publish<!-- {{#callable:poh_link_publish}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L659>)

Publishes data to a specified link if the link is enabled and has available credit.
- **Inputs**:
    - ``link``: A pointer to a `poh_link_t` structure representing the link to which data will be published.
    - ``sig``: An unsigned long integer representing the signature or identifier for the data being published.
    - ``data``: A pointer to a constant unsigned char array containing the data to be published.
    - ``data_sz``: An unsigned long integer representing the size of the data to be published.
- **Logic and Control Flow**:
    - Waits in a loop until the `mcache` of the `link` is not volatile, using `FD_SPIN_PAUSE` for efficient waiting.
    - Checks if the `mem` field of the `link` is NULL; if so, the function returns immediately as the link is not enabled.
    - Calls [`poh_link_wait_credit`](<#poh_link_wait_credit>) to ensure there is available credit for publishing.
    - Calculates the destination address using `fd_chunk_to_laddr` and copies the data to this address using `fd_memcpy`.
    - Calculates the publication timestamp using `fd_frag_meta_ts_comp` and `fd_tickcount`.
    - Publishes the data to the `mcache` using `fd_mcache_publish`, including metadata such as depth, sequence, signature, chunk, data size, and timestamp.
    - Updates the `chunk` field of the `link` using `fd_dcache_compact_next` to point to the next available chunk.
    - Decrements the `cr_avail` field of the `link` to reflect the used credit.
    - Increments the `tx_seq` field of the `link` to update the transaction sequence number.
- **Output**: No output is returned; the function performs its operations directly on the `link` and its associated data structures.
- **Functions Called**:
    - [`poh_link_wait_credit`](<#poh_link_wait_credit>)


---
### poh\_link\_init<!-- {{#callable:poh_link_init}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L677>)

Initializes a `poh_link_t` structure with memory and configuration details from a topology and tile.
- **Inputs**:
    - `link`: A pointer to a `poh_link_t` structure that will be initialized.
    - `topo`: A pointer to a `fd_topo_t` structure representing the topology containing links and workspaces.
    - `tile`: A pointer to a `fd_topo_tile_t` structure representing the tile with output link information.
    - `out_idx`: An unsigned long integer representing the index of the output link in the tile's output link array.
- **Logic and Control Flow**:
    - Retrieve the `fd_topo_link_t` structure from the topology using the tile's output link ID at `out_idx`.
    - Retrieve the workspace from the topology using the `dcache_obj_id` from the `topo_link`.
    - Initialize the `link` structure's `mem`, `depth`, `tx_seq`, `dcache`, `chunk0`, `wmark`, `chunk`, `cr_avail`, and `rx_cnt` fields using the retrieved workspace and `topo_link` details.
    - Iterate over all tiles in the topology to find and store reliable input link sequence numbers in `link->rx_fseqs`.
    - Use `FD_COMPILER_MFENCE()` to ensure memory ordering before and after setting `link->mcache`.
    - Verify that `link->mcache` is not NULL using `FD_TEST()`.
- **Output**: The function does not return a value; it initializes the `poh_link_t` structure pointed to by `link`.


---
### fd\_ext\_poh\_write\_unlock<!-- {{#callable:fd_ext_poh_write_unlock}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L742>)

Releases the lock on the PoH tile by setting the `fd_poh_returned_lock` to zero.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `FD_COMPILER_MFENCE()` to ensure memory operations are completed before proceeding.
    - Sets `fd_poh_returned_lock` to zero, indicating the lock is released.
- **Output**: No output is returned.
- **Functions Called**:
    - [`fd_ext_poh_publish_executed_txn::FD_VOLATILE`](<#fd_ext_poh_publish_executed_txnfd_volatile>)


---
### fd\_ext\_poh\_initialize<!-- {{#callable:fd_ext_poh_initialize}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L776>)

Initializes the Proof of History (PoH) context with configuration parameters and a starting state for hashing.
- **Inputs**:
    - ``tick_duration_ns``: The duration of a tick in nanoseconds, typically 6.4 microseconds for mainnet-beta.
    - ``hashcnt_per_tick``: The number of hashes per tick, typically 62,500 for mainnet-beta.
    - ``ticks_per_slot``: The number of ticks per slot, usually 64.
    - ``tick_height``: The starting tick height for hashing.
    - ``last_entry_hash``: A pointer to a 32-byte memory region containing the hash at the tick height.
    - ``signal_leader_change``: A pointer to an object used to signal a leader change.
- **Logic and Control Flow**:
    - Waits for the global PoH context to be initialized before proceeding.
    - Acquires a write lock on the PoH context using `fd_ext_poh_write_lock`.
    - Calculates the initial slot based on `tick_height` and `ticks_per_slot`.
    - Initializes various fields in the PoH context, such as `slot`, `hashcnt`, `cus_used`, `last_slot`, `last_hashcnt`, `reset_slot`, and `reset_slot_start_ns`.
    - Copies the `last_entry_hash` into `reset_hash` and `hash`.
    - Sets the `signal_leader_change` pointer in the context.
    - Configures static clock parameters: `tick_duration_ns`, `hashcnt_per_tick`, and `ticks_per_slot`.
    - Calculates derived clock information: `slot_duration_ns`, `hashcnt_duration_ns`, and `hashcnt_per_slot`.
    - Determines `max_microblocks_per_slot` based on `hashcnt_per_tick`.
    - Releases the write lock using [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>).
- **Output**: No return value; the function initializes the PoH context in place.
- **Functions Called**:
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### fd\_ext\_poh\_acquire\_leader\_bank<!-- {{#callable:fd_ext_poh_acquire_leader_bank}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L837>)

Acquires the current leader bank if it is active, incrementing its reference count before releasing the lock.
- **Inputs**:
    - `void`: No input arguments.
- **Logic and Control Flow**:
    - Acquire a write lock on the PoH context using `fd_ext_poh_write_lock`.
    - Initialize `bank` to `NULL`.
    - Check if `ctx->current_leader_bank` is non-null using `FD_LIKELY`.
    - If true, increment the reference count of `ctx->current_leader_bank` using `fd_ext_bank_acquire`.
    - Assign `ctx->current_leader_bank` to `bank`.
    - Release the write lock using [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>).
    - Return the `bank` pointer.
- **Output**: Returns a pointer to the current leader bank if it is active, otherwise returns `NULL`.
- **Functions Called**:
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### fd\_ext\_poh\_reset\_slot<!-- {{#callable:fd_ext_poh_reset_slot}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L854>)

Retrieves the slot height one above the last good (unskipped) slot being built upon.
- **Inputs**: None
- **Logic and Control Flow**:
    - Calls `fd_ext_poh_write_lock` to acquire a lock on the PoH context.
    - Retrieves the `reset_slot` value from the PoH context.
    - Calls [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>) to release the lock on the PoH context.
    - Returns the `reset_slot` value.
- **Output**: Returns an `ulong` representing the slot height one above the last good (unskipped) slot.
- **Functions Called**:
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### fd\_ext\_poh\_update\_active\_descendant<!-- {{#callable:fd_ext_poh_update_active_descendant}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L862>)

Updates the `max_active_descendant` field in the `fd_poh_ctx_t` context structure with a new value.
- **Inputs**:
    - `max_active_descendant`: The new value to set for the `max_active_descendant` field in the context.
- **Logic and Control Flow**:
    - Acquire a write lock on the `fd_poh_ctx_t` context using `fd_ext_poh_write_lock()`.
    - Set the `max_active_descendant` field of the context to the provided `max_active_descendant` value.
    - Release the write lock using `fd_ext_poh_write_unlock()`.
- **Output**: No output is returned from this function.
- **Functions Called**:
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### fd\_ext\_poh\_reached\_leader\_slot<!-- {{#callable:fd_ext_poh_reached_leader_slot}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L882>)

Determines if the current slot has reached the leader slot and returns the leader and reset slot information.
- **Inputs**:
    - ``out_leader_slot``: Pointer to store the slot height of the leader slot reached.
    - ``out_reset_slot``: Pointer to store the slot height of the last good (unskipped) slot being built on top of.
- **Logic and Control Flow**:
    - Acquire a write lock on the PoH context using `fd_ext_poh_write_lock`.
    - Set `*out_leader_slot` to `ctx->next_leader_slot` and `*out_reset_slot` to `ctx->reset_slot`.
    - Check if `ctx->next_leader_slot` is `ULONG_MAX` or if `ctx->slot` is less than `ctx->next_leader_slot`; if true, release the lock and return 0.
    - Check if `ctx->halted_switching_key` is true; if so, release the lock and return 0.
    - Check if `ctx->reset_slot` equals `ctx->next_leader_slot`; if true, release the lock and return 1.
    - Calculate `now_ns` as the current wall clock time and `expected_start_time_ns` as the expected start time for the next leader slot.
    - Check if `now_ns` is less than `expected_start_time_ns` plus three times the slot duration; if true, check if `ctx->max_active_descendant` is within the range of `ctx->reset_slot` and `ctx->next_leader_slot`.
    - If the above condition is true, release the lock and return 0.
    - Release the lock and return 1.
- **Output**: Returns 1 if the leader slot is reached and ready to start, otherwise returns 0.
- **Functions Called**:
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### publish\_plugin\_slot\_start<!-- {{#callable:publish_plugin_slot_start}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L946>)

Publishes a start message for a plugin slot if the plugin output memory is available.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_poh_ctx_t` structure, which contains context information for the Proof of History (PoH) process.
    - ``slot``: An unsigned long integer representing the current slot number to be published.
    - ``parent_slot``: An unsigned long integer representing the parent slot number of the current slot.
- **Logic and Control Flow**:
    - Check if the `plugin_out->mem` in the context is not available; if not, return immediately.
    - Convert the current chunk in `plugin_out->mem` to a local address and cast it to a `fd_plugin_msg_slot_start_t` pointer.
    - Assign the `slot` and `parent_slot` values to the `slot_start` structure.
    - Call `fd_stem_publish` to publish the slot start message with the appropriate parameters.
    - Update the `plugin_out->chunk` to the next compact chunk using `fd_dcache_compact_next`.
- **Output**: No output is returned; the function performs an action by publishing a message.


---
### publish\_plugin\_slot\_end<!-- {{#callable:publish_plugin_slot_end}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L958>)

Publishes a message indicating the end of a plugin slot with the specified slot number and consumed units.
- **Inputs**:
    - `ctx`: A pointer to the `fd_poh_ctx_t` structure, which contains context information for the Proof of History (PoH) process.
    - `slot`: An unsigned long integer representing the slot number that has ended.
    - `cus_used`: An unsigned long integer representing the number of consumed units used in the slot.
- **Logic and Control Flow**:
    - Check if the `plugin_out->mem` in the context is NULL; if it is, return immediately without doing anything.
    - Convert the current chunk in `plugin_out->mem` to a local address and cast it to a `fd_plugin_msg_slot_end_t` pointer.
    - Assign the `slot` and `cus_used` values to the `slot_end` structure.
    - Call `fd_stem_publish` to publish the `slot_end` message with the appropriate parameters.
    - Update the `plugin_out->chunk` to the next compacted chunk using `fd_dcache_compact_next`.
- **Output**: No return value; the function performs an action by publishing a message.


---
### publish\_became\_leader<!-- {{#callable:publish_became_leader}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L978>)

Handles the transition to a leader role in a distributed system by updating timing, configuration, and publishing relevant data.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_poh_ctx_t` context structure, which holds the state and configuration for the Proof of History (PoH) tile.
    - ``slot``: An unsigned long integer representing the current slot number for which the node is becoming the leader.
    - ``epoch``: An unsigned long integer representing the current epoch number.
- **Logic and Control Flow**:
    - Calculate the time delay since the last reset using `fd_tempo_tick_per_ns` and `fd_log_wallclock`, and record it in `ctx->begin_leader_delay`.
    - If `ctx->lagged_consecutive_leader_start` is true, adjust `ctx->reset_slot_start_ns` to exclude time spent waiting for a bank to freeze or replay stage to start.
    - Initialize `config` and `tip_receiver_owner` arrays to zero.
    - If `ctx->bundle.enabled` is true, calculate the bundle initialization time, retrieve tip payment and receiver addresses, and load account data from the bank.
    - Calculate `slot_start_ns` based on `ctx->reset_slot_start_ns`, `slot`, and `ctx->slot_duration_ns`.
    - Prepare a `fd_became_leader_t` structure with slot timing, bank information, and configuration details.
    - Check if the total skipped ticks exceed `MAX_SKIPPED_TICKS` and log an error if so.
    - Generate a signature using `fd_disco_poh_sig` and publish the leader data using `fd_stem_publish`.
    - Update `ctx->pack_out->chunk` using `fd_dcache_compact_next`.
    - If `ctx->current_leader_bank` is not null, set `ctx->pack_leader_bank` to `ctx->current_leader_bank` and increment its reference count using `fd_ext_bank_acquire`.
- **Output**: No return value; the function operates by side effects on the `ctx` structure and publishes data.


---
### fd\_ext\_poh\_begin\_leader<!-- {{#callable:fd_ext_poh_begin_leader}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1068>)

Initializes the leader slot for a Proof of History (PoH) tile, setting up the context and constraints for the leader's operations.
- **Inputs**:
    - ``bank``: Pointer to the bank object associated with the current leader slot.
    - ``slot``: The slot number that the leader is beginning.
    - ``epoch``: The epoch number associated with the current slot.
    - ``hashcnt_per_tick``: The number of hashes per tick for the current slot.
    - ``cus_block_limit``: The maximum compute units allowed for the block in the current slot.
    - ``cus_vote_cost_limit``: The maximum compute units allowed for vote transactions in the current slot.
    - ``cus_account_cost_limit``: The maximum compute units allowed for account write transactions in the current slot.
- **Logic and Control Flow**:
    - Acquire a write lock on the PoH context using `fd_ext_poh_write_lock`.
    - Verify that there is no current leader bank set in the context.
    - Check if the provided `slot` matches the current and next leader slots in the context; log errors if mismatched.
    - If `hashcnt_per_tick` has changed, log a warning and recompute clock-related parameters, including `hashcnt_duration_ns`, `hashcnt_per_slot`, and `max_microblocks_per_slot`.
    - Reset the slot and hash count if `hashcnt_per_tick` has changed, ensuring the context is synchronized with the reset slot.
    - Set the current leader bank, slot completion status, and microblock lower bound in the context.
    - Update the compute unit limits in the context and clamp them to predefined upper bounds if necessary, logging warnings if limits are exceeded.
    - Update the highwater mark for the leader slot to prevent republishing in the same slot.
    - Call [`publish_became_leader`](<#publish_became_leader>) to notify that the leader slot has started and log the event.
    - Release the write lock on the PoH context using [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>).
- **Output**: No return value; the function operates by modifying the PoH context and logging events.
- **Functions Called**:
    - [`publish_became_leader`](<#publish_became_leader>)
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### next\_leader\_slot<!-- {{#callable:next_leader_slot}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1163>)

Determines the next slot in which the current node will become the leader, ensuring it does not repeat leadership for a slot it has already published.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_poh_ctx_t` structure that contains the context for the Proof of History (PoH) operations, including the current slot, highwater leader slot, and identity key.
- **Logic and Control Flow**:
    - Calculate `min_leader_slot` as the maximum of the current slot (`ctx->slot`) and the `highwater_leader_slot` (or 0 if `highwater_leader_slot` is `ULONG_MAX`).
    - Call `fd_multi_epoch_leaders_get_next_slot` with `ctx->mleaders`, `min_leader_slot`, and `ctx->identity_key` to get the next leader slot.
- **Output**: Returns an `ulong` representing the next slot in which the node will be the leader, or `ULONG_MAX` if no such slot exists in the current or next epoch.


---
### maybe\_change\_identity<!-- {{#callable:FD_FN_SENSITIVE::maybe_change_identity}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1175>)

Handles identity key switching for a Proof of History (PoH) context, ensuring it does not occur during a leader slot.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_poh_ctx_t` structure representing the PoH context.
    - ``definitely_not_leader``: An integer flag indicating whether the current context is definitely not a leader (non-zero if true).
- **Logic and Control Flow**:
    - Checks if the `halted_switching_key` is set and the keyswitch state is `FD_KEYSWITCH_STATE_UNHALT_PENDING`; if true, it resets the `halted_switching_key`, sets the keyswitch state to `FD_KEYSWITCH_STATE_COMPLETED`, and returns 1.
    - Determines if the context is currently a leader by checking `definitely_not_leader`, `next_leader_slot`, and `slot`; if it is a leader, returns 0.
    - Checks if the keyswitch state is `FD_KEYSWITCH_STATE_SWITCH_PENDING`; if true, attempts to set a new identity using `fd_ext_admin_rpc_set_identity`.
    - If setting the identity fails, sets the keyswitch state to `FD_KEYSWITCH_STATE_FAILED` and returns 0.
    - If successful, copies the new identity key, resets the PoH state to the reset slot, and sets the keyswitch state to `FD_KEYSWITCH_STATE_COMPLETED`.
- **Output**: Returns 1 if the identity change was completed successfully, otherwise returns 0.


---
### no\_longer\_leader<!-- {{#callable:no_longer_leader}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1223>)

Handles the transition of a node from being a leader to a non-leader in a distributed system.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_poh_ctx_t` structure representing the context of the current node, including its state and configuration.
- **Logic and Control Flow**:
    - Checks if `ctx->current_leader_bank` is not NULL, and if so, releases it using `fd_ext_bank_release`.
    - Updates `ctx->highwater_leader_slot` to ensure the node does not become a leader again in the current slot.
    - Sets `ctx->current_leader_bank` to NULL to indicate the node is no longer a leader.
    - Calls [`maybe_change_identity`](<#fd_fn_sensitivemaybe_change_identity>) to check if the node's identity should change, passing 1 to indicate it is definitely not a leader.
    - Updates `ctx->next_leader_slot` by calling [`next_leader_slot`](<#next_leader_slot>) to determine the next slot where the node will be a leader.
    - Logs a message if the identity has changed, indicating the new [`next_leader_slot`](<#next_leader_slot>).
    - Performs a memory fence with `FD_COMPILER_MFENCE` to ensure memory operations are completed.
    - Signals a leader change using `fd_ext_poh_signal_leader_change`.
    - Logs the new [`next_leader_slot`](<#next_leader_slot>) for informational purposes.
- **Output**: No return value; the function modifies the state of the `ctx` structure and logs information.
- **Functions Called**:
    - [`FD_FN_SENSITIVE::maybe_change_identity`](<#fd_fn_sensitivemaybe_change_identity>)
    - [`next_leader_slot`](<#next_leader_slot>)


---
### fd\_ext\_poh\_reset<!-- {{#callable:fd_ext_poh_reset}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1246>)

Resets the Proof of History (PoH) context to a new slot after a block is completed, updating various parameters and state variables.
- **Inputs**:
    - `completed_bank_slot`: The slot number of the bank that successfully produced a block.
    - `reset_blockhash`: A pointer to the hash of the last tick in the produced block.
    - `hashcnt_per_tick`: The number of hashes per tick for the completed bank.
    - `parent_block_id`: A pointer to the block ID of the parent block.
    - `features_activation`: A pointer to the activation slot of shred-tile features.
- **Logic and Control Flow**:
    - Acquire a write lock on the PoH context using `fd_ext_poh_write_lock`.
    - Store the current slot and determine if the current slot is a leader slot.
    - If the current slot is a leader slot and there is a current leader bank, update the highwater leader slot to prevent republishing in the same slot.
    - Set the leader bank start time to the current wall clock time.
    - If the next expected sequential leader slot is the next slot, update the reset slot start time based on the slot duration; otherwise, set it to the current time.
    - Copy the `reset_blockhash` to the context's `reset_hash` and `hash` fields.
    - If `parent_block_id` is not NULL, update the parent slot and copy the `parent_block_id` to the context.
    - Update the slot, hash count, last slot, last hash count, and reset slot in the context.
    - If `hashcnt_per_tick` has changed, log a warning and recompute derived clock information, including `hashcnt_duration_ns`, `hashcnt_per_slot`, and `max_microblocks_per_slot`.
    - Set the `microblocks_lower_bound` to `max_microblocks_per_slot`.
    - If the current slot was a leader slot, call [`no_longer_leader`](<#no_longer_leader>) to handle the transition out of leadership.
    - Determine the next leader slot using [`next_leader_slot`](<#next_leader_slot>).
    - Log the reset operation with the current and next leader slots.
    - If the current slot is greater than or equal to the next leader slot, handle the transition into a new leader slot or end the current leader slot as needed.
    - Copy the `features_activation` data to the context and set `features_activation_avail` to 1.
    - Release the write lock on the PoH context using [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>).
- **Output**: No return value; the function updates the PoH context state in place.
- **Functions Called**:
    - [`no_longer_leader`](<#no_longer_leader>)
    - [`next_leader_slot`](<#next_leader_slot>)
    - [`publish_plugin_slot_end`](<#publish_plugin_slot_end>)
    - [`publish_plugin_slot_start`](<#publish_plugin_slot_start>)
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### fd\_ext\_poh\_get\_leader\_after\_n\_slots<!-- {{#callable:fd_ext_poh_get_leader_after_n_slots}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1362>)

Retrieves the leader's public key for a slot that is a specified number of slots ahead of the current slot.
- **Inputs**:
    - ``n``: The number of slots ahead of the current slot for which to retrieve the leader's public key.
    - ``out_pubkey``: A pointer to a 32-byte array where the leader's public key will be stored if found.
- **Logic and Control Flow**:
    - Acquire a write lock on the PoH context using `fd_ext_poh_write_lock()`.
    - Calculate the target slot by adding `n` to the current slot in the PoH context.
    - Retrieve the leader's public key for the calculated slot using `fd_multi_epoch_leaders_get_leader_for_slot()`.
    - If a leader is found, copy the leader's public key to `out_pubkey` and set `copied` to 1.
    - Release the write lock using `fd_ext_poh_write_unlock()`.
    - Return the value of `copied`, indicating whether the leader's public key was successfully copied.
- **Output**: Returns 1 if the leader's public key was successfully copied to `out_pubkey`, otherwise returns 0.
- **Functions Called**:
    - [`fd_ext_poh_write_unlock`](<#fd_ext_poh_write_unlock>)


---
### scratch\_align<!-- {{#callable:scratch_align}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1378>)

Returns the constant value `128UL`.
- **Inputs**: None
- **Logic and Control Flow**:
    - The function is defined as `static inline`, indicating it is intended for use within the same translation unit and suggests it is a small, frequently used function.
    - The function returns a constant value, `128UL`, which is an unsigned long integer.
- **Output**: The output is a constant unsigned long integer value `128UL`.


---
### scratch\_footprint<!-- {{#callable:scratch_footprint}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1383>)

Calculates the memory footprint required for a `fd_poh_ctx_t` structure and a SHA-256 context, considering alignment constraints.
- **Inputs**:
    - `tile`: A pointer to a `fd_topo_tile_t` structure, which is not used in the function.
- **Logic and Control Flow**:
    - Initialize a variable `l` with `FD_LAYOUT_INIT` to start the layout calculation.
    - Append the size and alignment of `fd_poh_ctx_t` to `l` using `FD_LAYOUT_APPEND`.
    - Append the size and alignment of the SHA-256 context to `l` using `FD_LAYOUT_APPEND`.
    - Finalize the layout calculation with `FD_LAYOUT_FINI`, using `scratch_align()` to determine the final alignment.
- **Output**: Returns an `ulong` representing the total memory footprint required, including alignment.
- **Functions Called**:
    - [`scratch_align`](<#scratch_align>)


---
### publish\_tick<!-- {{#callable:publish_tick}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1392>)

Publishes a tick to the shred tile, updating metadata and handling skipped slots.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_poh_ctx_t` structure, which contains the context for the Proof of History (PoH) process.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is used for publishing data to the shred tile.
    - ``hash``: An array of 32 unsigned characters representing the hash to be published with the tick.
    - ``is_skipped``: An integer flag indicating whether the tick is for a skipped slot (non-zero) or not (zero).
- **Logic and Control Flow**:
    - Calculate `hashcnt` as the next tick boundary based on the last hash count and ticks per slot.
    - Convert the chunk index to a local address using `fd_chunk_to_laddr` and store it in `dst`.
    - Check if the last slot is greater than or equal to the reset slot using `FD_TEST`.
    - If `is_skipped` is true, set `meta->reference_tick` to 0 and `meta->block_complete` to 0.
    - Otherwise, calculate `meta->reference_tick` and `meta->block_complete` based on `hashcnt`.
    - Determine the `slot` and calculate `meta->parent_offset`.
    - Check if the parent block ID is valid and copy it if valid.
    - Calculate `hash_delta` as the difference between `hashcnt` and `last_hashcnt`.
    - Update `dst` to point to the next location and set `tick->hashcnt_delta`, `tick->hash`, and `tick->txn_cnt`.
    - Calculate `tspub` as the current timestamp and `sz` as the size of the metadata and header.
    - Publish the tick using `fd_stem_publish` and update `ctx->shred_seq` and `ctx->shred_out->chunk`.
    - Update `ctx->last_slot` and `ctx->last_hashcnt` based on whether the slot is complete.
- **Output**: No return value; the function updates the context and publishes a tick to the shred tile.


---
### publish\_features\_activation<!-- {{#callable:publish_features_activation}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1449>)

Copies feature activation data from the context to the output buffer and publishes it with a signature.
- **Inputs**:
    - `ctx`: A pointer to `fd_poh_ctx_t`, which contains the context for the Proof of History (PoH) process, including feature activation data and other state information.
    - `stem`: A pointer to `fd_stem_context_t`, which is used for publishing data to the network.
- **Logic and Control Flow**:
    - Convert the memory address of `ctx->shred_out->mem` and `ctx->shred_out->chunk` to a local address and cast it to `uchar *` to get the destination buffer `dst`.
    - Cast `dst` to `fd_shred_features_activation_t *` to get `act_data`.
    - Copy the feature activation data from `ctx->features_activation` to `act_data` using `fd_memcpy`.
    - Calculate the publication timestamp `tspub` using `fd_frag_meta_ts_comp` and `fd_tickcount`.
    - Determine the size `sz` of the feature activation data using `sizeof(fd_shred_features_activation_t)`.
    - Generate a signature `sig` using `fd_disco_poh_sig` with the current slot, packet type `POH_PKT_TYPE_FEAT_ACT_SLOT`, and a zero value.
    - Publish the feature activation data using `fd_stem_publish` with the calculated parameters.
    - Update `ctx->shred_seq` with the sequence number from `stem->seqs` at the index `ctx->shred_out->idx`.
    - Update `ctx->shred_out->chunk` to the next compact chunk using `fd_dcache_compact_next`.
- **Output**: No return value; the function performs operations to publish feature activation data.


---
### after\_credit<!-- {{#callable:after_credit}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1464>)

Manages the state and operations of a Proof of History (PoH) tile, including handling leader transitions, publishing ticks and microblocks, and coordinating with other components in a distributed system.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_poh_ctx_t` structure, which holds the context and state information for the PoH tile.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is used for publishing messages to other components.
    - ``opt_poll_in``: A pointer to an integer that indicates whether polling for incoming data should continue (1) or stop (0).
    - ``charge_busy``: A pointer to an integer that indicates whether the function has performed work and should be considered busy (1) or not (0).
- **Logic and Control Flow**:
    - Set the `stem` field of `ctx` to the provided `stem` pointer.
    - Perform a memory fence operation to ensure memory ordering.
    - Check if the `fd_poh_waiting_lock` is set; if so, set `fd_poh_returned_lock` to 1 and wait for it to be cleared before proceeding.
    - If `ctx->features_activation_avail` is set, publish the features activation to the shred tile and reset the flag.
    - Determine if the current slot is a leader slot and if the leader bank is available; if not, return without doing any hashing.
    - If there are skipped ticks pending, register and publish them one at a time, and set `opt_poll_in` to 0 and `charge_busy` to 1.
    - Calculate the maximum remaining microblocks and ticks or microblocks based on the current state and constraints.
    - Determine the `restricted_hashcnt` and `min_hashcnt` based on the current hash count and constraints.
    - Calculate the `target_hashcnt` based on the current time and slot duration, clamping it to the allowed range.
    - If `ctx->hashcnt` equals `target_hashcnt`, return without publishing a tick.
    - Set `charge_busy` to 1 if work is performed.
    - If `ctx->hashcnt` is less than `target_hashcnt`, update the hash and hash count to `target_hashcnt`.
    - If the hash count reaches the end of the slot, increment the slot and reset the hash count.
    - If a tick is completed while not being a leader, save the current hash for future use.
    - If a tick is completed while being a leader, register the tick with the leader bank and publish it.
    - Handle transitions into and out of leader slots, publishing appropriate messages and updating the state.
- **Output**: No direct output; modifies the state of `ctx` and potentially publishes messages to other components.
- **Functions Called**:
    - [`fd_ext_poh_publish_executed_txn::FD_VOLATILE`](<#fd_ext_poh_publish_executed_txnfd_volatile>)
    - [`publish_features_activation`](<#publish_features_activation>)
    - [`publish_tick`](<#publish_tick>)
    - [`publish_plugin_slot_start`](<#publish_plugin_slot_start>)
    - [`publish_plugin_slot_end`](<#publish_plugin_slot_end>)
    - [`no_longer_leader`](<#no_longer_leader>)
    - [`next_leader_slot`](<#next_leader_slot>)


---
### during\_housekeeping<!-- {{#callable:during_housekeeping}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1780>)

Checks if the identity of the current leader has changed and updates the next leader slot if necessary.
- **Inputs**:
    - ``ctx``: A pointer to a `fd_poh_ctx_t` structure that holds the context for the Proof of History (PoH) process.
- **Logic and Control Flow**:
    - Calls [`maybe_change_identity`](<#fd_fn_sensitivemaybe_change_identity>) with `ctx` and `0` to check if the identity has changed.
    - If the identity has changed, updates `ctx->next_leader_slot` with the result of `next_leader_slot(ctx)`.
    - Logs the change of identity with the new [`next_leader_slot`](<#next_leader_slot>).
    - Signals a leader change by calling `fd_ext_poh_signal_leader_change` with `ctx->signal_leader_change`.
- **Output**: No return value; modifies the `ctx` structure and may log information or signal a leader change.
- **Functions Called**:
    - [`FD_FN_SENSITIVE::maybe_change_identity`](<#fd_fn_sensitivemaybe_change_identity>)
    - [`next_leader_slot`](<#next_leader_slot>)


---
### metrics\_write<!-- {{#callable:metrics_write}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1793>)

Copies delay metrics from the `fd_poh_ctx_t` context to the corresponding metric histograms.
- **Inputs**:
    - `ctx`: A pointer to a `fd_poh_ctx_t` structure containing delay metrics to be copied.
- **Logic and Control Flow**:
    - Copy the `begin_leader_delay` from `ctx` to the `BEGIN_LEADER_DELAY_SECONDS` histogram using `FD_MHIST_COPY` macro.
    - Copy the `first_microblock_delay` from `ctx` to the `FIRST_MICROBLOCK_DELAY_SECONDS` histogram using `FD_MHIST_COPY` macro.
    - Copy the `slot_done_delay` from `ctx` to the `SLOT_DONE_DELAY_SECONDS` histogram using `FD_MHIST_COPY` macro.
    - Copy the `bundle_init_delay` from `ctx` to the `BUNDLE_INITIALIZE_DELAY_SECONDS` histogram using `FD_MHIST_COPY` macro.
- **Output**: No return value; the function operates by side effect, updating metric histograms.


---
### before\_frag<!-- {{#callable:before_frag}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1801>)

Processes incoming fragments to determine if they should be discarded, processed, or if an error occurred based on the fragment's signature and context.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_poh_ctx_t` structure, which holds the context for the Proof of History (PoH) process.
    - ``in_idx``: An unsigned long integer representing the index of the incoming fragment.
    - ``seq``: An unsigned long integer representing the sequence number of the fragment (unused in this function).
    - ``sig``: An unsigned long integer representing the signature of the fragment.
- **Logic and Control Flow**:
    - Ignore the `seq` parameter as it is not used in the function.
    - Check if the fragment type at `in_idx` in `ctx->in_kind` is neither `IN_KIND_BANK` nor `IN_KIND_PACK`; if so, return 0 to indicate no action is needed.
    - If `sig` equals `ULONG_MAX`, indicating that banks are drained, release the current bank held by `ctx->pack_leader_bank` if it exists, set `ctx->pack_leader_bank` to NULL, and return 1 to indicate the fragment should be discarded.
    - Calculate `pack_idx` using the `fd_disco_bank_sig_pack_idx` function with `sig` as input.
    - Verify that `pack_idx` is not less than `ctx->expect_pack_idx`; if it is, return -1 to indicate an error.
    - If `pack_idx` equals `ctx->expect_pack_idx`, increment `ctx->expect_pack_idx` and return 0 to indicate successful processing.
- **Output**: Returns an integer: 0 for no action needed, 1 to discard the fragment, or -1 if an error occurred.


---
### during\_frag<!-- {{#callable:during_frag}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1825>)

Processes incoming fragments based on their type and updates the context accordingly, handling errors and specific conditions for different fragment types.
- **Inputs**:
    - ``ctx``: Pointer to the `fd_poh_ctx_t` context structure, which holds the state and configuration for the Proof of History (PoH) process.
    - ``in_idx``: Index of the input source in the context's input array, indicating which input source the fragment is from.
    - ``seq``: Sequence number of the fragment, although it is marked as unused with `FD_PARAM_UNUSED`.
    - ``sig``: Signature or identifier of the fragment, used to determine the slot and type of the fragment.
    - ``chunk``: Chunk index within the data cache where the fragment's data is stored.
    - ``sz``: Size of the fragment data.
    - ``ctl``: Control parameter, marked as unused with `FD_PARAM_UNUSED`.
- **Logic and Control Flow**:
    - Initialize `ctx->skip_frag` to 0, indicating that the fragment should not be skipped by default.
    - Check if the fragment is of type `IN_KIND_STAKE`; if so, validate the chunk range and initialize the stake message in the multi-epoch leaders context.
    - For other fragment types, determine the slot using the signature and check if the fragment is for a prior leader slot by comparing with `ctx->highwater_leader_slot`.
    - If the fragment is of type `IN_KIND_PACK`, set `ctx->skip_frag` to 1 and update the microblocks lower bound if the fragment is not for a prior leader slot.
    - For other types, validate the chunk range and size, copy the transaction data and trailer from the source to the context, and set `ctx->skip_frag` based on whether the fragment is for a prior leader slot.
- **Output**: No return value; the function modifies the `ctx` structure to reflect the processing of the fragment.


---
### publish\_microblock<!-- {{#callable:publish_microblock}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1900>)

Publishes a microblock by preparing metadata, copying transaction data, and sending it to the shred tile.
- **Inputs**:
    - ``ctx``: A pointer to the `fd_poh_ctx_t` context structure, which contains the current state and configuration for the Proof of History (PoH) process.
    - ``stem``: A pointer to the `fd_stem_context_t` structure, which is used for publishing data to the shred tile.
    - ``slot``: An unsigned long integer representing the current slot number for which the microblock is being published.
    - ``hashcnt_delta``: An unsigned long integer representing the change in hash count since the last microblock or tick was published.
    - ``txn_cnt``: An unsigned long integer representing the number of transactions to include in the microblock.
- **Logic and Control Flow**:
    - Convert the memory chunk to a local address using `fd_chunk_to_laddr` and assign it to `dst`.
    - Verify that `slot` is greater than or equal to `ctx->reset_slot`.
    - Set the `parent_offset`, `reference_tick`, and `block_complete` fields in the `fd_entry_batch_meta_t` structure.
    - Determine if the `parent_block_id` is valid and copy it if valid.
    - Advance `dst` to point to the `fd_entry_batch_header_t` structure and set `hashcnt_delta` and `hash`.
    - Iterate over transactions, copying successful ones to `dst` and updating `payload_sz` and `included_txn_cnt`.
    - Set the `txn_cnt` in the header to `included_txn_cnt`.
    - Calculate the total size `sz` of the microblock data to be published.
    - Publish the microblock using `fd_stem_publish` and update `ctx->shred_seq` and `ctx->shred_out->chunk`.
- **Output**: The function does not return a value; it performs operations to publish a microblock.


---
### after\_frag<!-- {{#callable:after_frag}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L1950>)

Processes a fragment after it has been received, updating the leader schedule and handling microblock transactions.
- **Inputs**:
    - ``ctx``: Pointer to the `fd_poh_ctx_t` context structure, which holds the state and configuration for the Proof of History (PoH) process.
    - ``in_idx``: Index of the input source for the fragment, used to identify the type of input.
    - ``seq``: Sequence number of the fragment, used for ordering and validation.
    - ``sig``: Signature of the fragment, used to verify its authenticity and determine its target slot.
    - ``sz``: Size of the fragment, used to determine the number of transactions it contains.
    - ``tsorig``: Original timestamp of the fragment, indicating when it was created.
    - ``tspub``: Publication timestamp of the fragment, indicating when it was published.
    - ``stem``: Pointer to the `fd_stem_context_t` structure, which is used for publishing microblocks and ticks.
- **Logic and Control Flow**:
    - Check if `ctx->skip_frag` is set; if true, return immediately without processing.
    - If the input kind is `IN_KIND_STAKE`, finalize the stake message and update the leader schedule.
    - Calculate the next leader slot and determine if a state transition is needed based on the current and next leader status.
    - If the input kind is not `IN_KIND_STAKE`, check if `ctx->microblocks_lower_bound` is zero and sample the delay for the first microblock.
    - Determine the target slot from the signature and verify it matches the current or next leader slot; log an error if not.
    - Increment `ctx->microblocks_lower_bound` and process each transaction in the fragment, counting executed transactions and consumed compute units.
    - If no transactions were executed, return without publishing.
    - Hash the current state and update `ctx->hash` with the new hash value.
    - Increment `ctx->hashcnt` and update `ctx->last_slot` and `ctx->last_hashcnt`.
    - If `ctx->hashcnt` reaches a tick boundary, register the tick with the leader bank and check for state transitions.
    - Publish the microblock using the [`publish_microblock`](<#publish_microblock>) function.
- **Output**: No direct output; the function updates the state of the `ctx` and may publish microblocks or log errors.
- **Functions Called**:
    - [`next_leader_slot`](<#next_leader_slot>)
    - [`publish_plugin_slot_start`](<#publish_plugin_slot_start>)
    - [`publish_plugin_slot_end`](<#publish_plugin_slot_end>)
    - [`no_longer_leader`](<#no_longer_leader>)
    - [`publish_microblock`](<#publish_microblock>)


---
### privileged\_init<!-- {{#callable:privileged_init}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2085>)

Initializes the Proof of History (PoH) context for a tile using the provided topology and tile configuration.
- **Inputs**:
    - ``topo``: A pointer to an `fd_topo_t` structure representing the topology of the system.
    - ``tile``: A pointer to an `fd_topo_tile_t` structure representing the specific tile configuration.
- **Logic and Control Flow**:
    - Allocate scratch memory for the PoH context using `FD_SCRATCH_ALLOC_INIT` and `FD_SCRATCH_ALLOC_APPEND`.
    - Check if the `identity_key_path` in `tile->poh` is set; if not, log an error and exit.
    - Load the identity key from the specified path using `fd_keyload_load` and copy it to the PoH context.
    - Check if the `vote_account_path` in `tile->poh.bundle` is set; if not, disable the bundle feature.
    - If the bundle feature is enabled, decode the vote account path using `fd_base58_decode_32`; if decoding fails, load the vote key using `fd_keyload_load` and copy it to the PoH context.
- **Output**: No return value; the function initializes the PoH context in the provided tile.


---
### fd\_ext\_shred\_set\_shred\_version<!-- {{#callable:fd_ext_shred_set_shred_version}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2117>)

Sets the shred version in a shared memory location after ensuring the memory is initialized.
- **Inputs**:
    - `shred_version`: The shred version to set, represented as an unsigned long integer.
- **Logic and Control Flow**:
    - Waits in a loop until the pointer `fd_shred_version` is initialized (non-zero).
    - Once initialized, assigns the value of `shred_version` to the location pointed by `fd_shred_version`.
- **Output**: No return value; the function operates by side effect, setting a shared memory value.


---
### fd\_ext\_poh\_publish\_gossip\_vote<!-- {{#callable:fd_ext_poh_publish_gossip_vote}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2123>)

Publishes a gossip vote transaction to the gossip deduplication link.
- **Inputs**:
    - ``data``: A pointer to the data buffer containing the gossip vote transaction.
    - ``data_len``: The length of the data buffer.
    - ``source_ipv4``: The source IPv4 address of the transaction.
    - ``pubkey``: A pointer to the public key, which is not used in this function.
- **Logic and Control Flow**:
    - Initialize a transaction header in the `txn_with_header` buffer with zero values.
    - Set the `payload_sz` field of the transaction header to `data_len`.
    - Set the `source_ipv4` field of the transaction header to `source_ipv4`.
    - Set the `source_tpu` field of the transaction header to `FD_TXN_M_TPU_SOURCE_GOSSIP`.
    - Copy the `data` into the `txn_with_header` buffer after the transaction header.
    - Call [`poh_link_publish`](<#poh_link_publish>) to publish the transaction to the `gossip_dedup` link.
- **Output**: No return value; the function performs an action by publishing the transaction.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_poh\_publish\_leader\_schedule<!-- {{#callable:fd_ext_poh_publish_leader_schedule}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2139>)

Publishes the leader schedule data to the `stake_out` link.
- **Inputs**:
    - ``data``: Pointer to the data to be published.
    - ``data_len``: Length of the data to be published.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function.
    - Passes the `stake_out` link, a signature value of `2UL`, the `data`, and `data_len` to [`poh_link_publish`](<#poh_link_publish>).
- **Output**: No return value; the function performs an action.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_poh\_publish\_cluster\_info<!-- {{#callable:fd_ext_poh_publish_cluster_info}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2145>)

Publishes cluster information data to the `crds_shred` link using the [`poh_link_publish`](<#poh_link_publish>) function.
- **Inputs**:
    - ``data``: A pointer to the data buffer containing the cluster information to publish.
    - ``data_len``: The length of the data buffer in bytes.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function with the `crds_shred` link, a signature value of `2UL`, the `data` pointer, and `data_len`.
- **Output**: No return value; the function performs an action by publishing data.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_poh\_publish\_executed\_txn<!-- {{#callable:fd_ext_poh_publish_executed_txn}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2151>)

Publishes executed transactions to a link in a thread-safe manner.
- **Inputs**:
    - ``data``: A pointer to a constant unsigned character array containing the transaction data to be published.
- **Logic and Control Flow**:
    - Initialize a static integer `lock` to 0 for synchronization purposes.
    - Enter an infinite loop to acquire a lock using `FD_ATOMIC_CAS` to ensure exclusive access to the critical section.
    - If the lock is successfully acquired (i.e., `FD_ATOMIC_CAS` returns 0), break out of the loop.
    - Call `FD_SPIN_PAUSE` to yield the processor if the lock is not acquired, allowing other threads to proceed.
    - Use `FD_COMPILER_MFENCE` to ensure memory operations are completed before proceeding.
    - Call [`poh_link_publish`](<#poh_link_publish>) to publish the transaction data to the `executed_txn` link with a signature of 0 and a data size of 64 bytes.
    - Use `FD_COMPILER_MFENCE` again to ensure memory operations are completed before releasing the lock.
    - Set `lock` to 0 using `FD_VOLATILE` to release the lock, allowing other threads to acquire it.
- **Output**: No return value; the function operates with side effects by publishing data to a link.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### FD\_VOLATILE<!-- {{#callable:fd_ext_poh_publish_executed_txn::FD_VOLATILE}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2166>)

Sets the value of `lock` to 0 using a volatile operation.
- **Inputs**:
    - `lock`: A variable that is set to 0.
- **Logic and Control Flow**:
    - Sets the value of `lock` to 0 using a volatile operation.
- **Output**: No output is returned.


---
### fd\_ext\_plugin\_publish\_replay\_stage<!-- {{#callable:fd_ext_plugin_publish_replay_stage}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2169>)

Publishes data to the `replay_plugin` link with a given signature and data length.
- **Inputs**:
    - ``sig``: The signature associated with the data to be published.
    - ``data``: A pointer to the data to be published.
    - ``data_len``: The length of the data to be published.
- **Logic and Control Flow**:
    - Calls [`poh_link_publish`](<#poh_link_publish>) with the `replay_plugin` link, passing the signature, data, and data length.
- **Output**: No return value; the function performs an action.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_plugin\_publish\_genesis\_hash<!-- {{#callable:fd_ext_plugin_publish_genesis_hash}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2176>)

Publishes the genesis hash data to the replay plugin.
- **Inputs**:
    - `sig`: An unsigned long integer representing the signature or identifier for the data being published.
    - `data`: A pointer to an unsigned character array containing the data to be published.
    - `data_len`: An unsigned long integer representing the length of the data to be published.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function with the `replay_plugin` link, passing `sig`, `data`, and `data_len` as arguments.
- **Output**: No return value; the function performs an action by publishing data.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_plugin\_publish\_start\_progress<!-- {{#callable:fd_ext_plugin_publish_start_progress}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2183>)

Publishes a start progress message to the `start_progress_plugin` link with the given signature, data, and data length.
- **Inputs**:
    - ``sig``: The signature associated with the message to be published.
    - ``data``: A pointer to the data buffer containing the message to be published.
    - ``data_len``: The length of the data buffer in bytes.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function with the `start_progress_plugin` link, passing the `sig`, `data`, and `data_len` as arguments.
- **Output**: No return value; the function performs an action by publishing data.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_plugin\_publish\_vote\_listener<!-- {{#callable:fd_ext_plugin_publish_vote_listener}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2190>)

Publishes a vote listener event using the [`poh_link_publish`](<#poh_link_publish>) function.
- **Inputs**:
    - `sig`: An unsigned long integer representing the signature of the event.
    - `data`: A pointer to an unsigned character array containing the data to be published.
    - `data_len`: An unsigned long integer representing the length of the data to be published.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function with the `vote_listener_plugin`, `sig`, `data`, and `data_len` as arguments.
- **Output**: No return value (void function).
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_plugin\_publish\_validator\_info<!-- {{#callable:fd_ext_plugin_publish_validator_info}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2197>)

Publishes validator information using the [`poh_link_publish`](<#poh_link_publish>) function.
- **Inputs**:
    - `sig`: A `ulong` representing the signature or identifier for the data being published.
    - `data`: A pointer to an `uchar` array containing the data to be published.
    - `data_len`: A `ulong` representing the length of the data to be published.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function with the `validator_info_plugin` link, passing `sig`, `data`, and `data_len` as arguments.
- **Output**: No return value; the function performs an action by publishing data.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_plugin\_publish\_periodic<!-- {{#callable:fd_ext_plugin_publish_periodic}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2204>)

Publishes data to the `gossip_plugin` link using the [`poh_link_publish`](<#poh_link_publish>) function.
- **Inputs**:
    - ``sig``: An unsigned long integer representing the signature or identifier for the data being published.
    - ``data``: A pointer to an unsigned char array containing the data to be published.
    - ``data_len``: An unsigned long integer representing the length of the data to be published.
- **Logic and Control Flow**:
    - Calls the [`poh_link_publish`](<#poh_link_publish>) function with the `gossip_plugin` link, `sig`, `data`, and `data_len` as arguments.
- **Output**: No return value; the function performs an action by publishing data.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_resolv\_publish\_root\_bank<!-- {{#callable:fd_ext_resolv_publish_root_bank}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2211>)

Publishes data to the `replay_resolv` link with a signature of 0.
- **Inputs**:
    - ``data``: Pointer to the data to be published.
    - ``data_len``: Length of the data to be published.
- **Logic and Control Flow**:
    - Calls [`poh_link_publish`](<#poh_link_publish>) with `replay_resolv` as the link, `0UL` as the signature, and the provided `data` and `data_len` as the data and size respectively.
- **Output**: No return value.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### fd\_ext\_resolv\_publish\_completed\_blockhash<!-- {{#callable:fd_ext_resolv_publish_completed_blockhash}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2217>)

Publishes a completed blockhash to the `replay_resolv` link with a specific signature.
- **Inputs**:
    - ``data``: Pointer to the data to be published.
    - ``data_len``: Length of the data to be published.
- **Logic and Control Flow**:
    - Calls [`poh_link_publish`](<#poh_link_publish>) with the `replay_resolv` link, a signature of `1UL`, and the provided `data` and `data_len`.
- **Output**: No return value; the function performs an action by publishing data.
- **Functions Called**:
    - [`poh_link_publish`](<#poh_link_publish>)


---
### out1<!-- {{#callable:out1}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2223>)

Finds and returns the context of a specific output link from a tile in a topology based on the link's name.
- **Inputs**:
    - `topo`: A pointer to a `fd_topo_t` structure representing the topology.
    - `tile`: A pointer to a `fd_topo_tile_t` structure representing the tile within the topology.
    - `name`: A constant character pointer representing the name of the output link to find.
- **Logic and Control Flow**:
    - Initialize `idx` to `ULONG_MAX` to track the index of the desired output link.
    - Iterate over the output links of the tile using a loop from 0 to `tile->out_cnt`.
    - For each link, retrieve the link from `topo->links` using the index from `tile->out_link_id`.
    - Compare the link's name with the input `name` using `strcmp`.
    - If a match is found and `idx` is still `ULONG_MAX`, set `idx` to the current index; otherwise, log an error if multiple matches are found.
    - After the loop, if `idx` is still `ULONG_MAX`, log an error indicating no match was found.
    - Retrieve the memory workspace, chunk0, and watermark for the link at `idx` and return them in a `fd_poh_out_ctx_t` structure.
- **Output**: Returns a `fd_poh_out_ctx_t` structure containing the index, memory workspace, initial chunk, watermark, and current chunk for the specified output link.


---
### unprivileged\_init<!-- {{#callable:unprivileged_init}} -->
[View Source →](<../../../../../src/discoh/poh/fd_poh_tile.c#L2246>)

Initializes the unprivileged components of the Proof of History (PoH) context for a given topology and tile.
- **Inputs**:
    - ``topo``: A pointer to the `fd_topo_t` structure representing the topology configuration.
    - ``tile``: A pointer to the `fd_topo_tile_t` structure representing the tile configuration.
- **Logic and Control Flow**:
    - Allocate scratch memory for the PoH context and SHA256 footprint using `FD_SCRATCH_ALLOC_APPEND`.
    - Initialize the PoH context's `mleaders` and `sha256` fields with non-null checks using the `NONNULL` macro.
    - Set initial values for various fields in the PoH context, such as `current_leader_bank`, `pack_leader_bank`, `shred_seq`, `slot`, `hashcnt`, and others.
    - Check if the bundle is enabled in the tile configuration and initialize the bundle generator if enabled.
    - Query the `poh_shred` object ID from the topology properties and join the `fd_shred_version`.
    - Initialize various `poh_link_t` structures for different output links using [`poh_link_init`](<#poh_link_init>).
    - If plugins are enabled, initialize additional plugin links; otherwise, mark them as available without setting memory.
    - Log a message indicating that PoH is waiting to be initialized by the Agave client and set the global PoH context.
    - Wait for the `fd_poh_waiting_lock` to be set by the Agave client, then clear it and set the `fd_poh_returned_lock`.
    - Join histogram functions for leader delay, microblock delay, slot done delay, and bundle initialization delay.
    - Initialize input links and set their memory, chunk, and watermark values based on the topology configuration.
    - Set the output links for `shred_out`, `pack_out`, and `plugin_out` based on the topology configuration.
    - Initialize the `features_activation` slots to `FD_SHRED_FEATURES_ACTIVATION_SLOT_DISABLED`.
    - Finalize the scratch allocation and check for overflow errors.
- **Output**: None (void function).
- **Functions Called**:
    - [`poh_link_init`](<#poh_link_init>)
    - [`out1`](<#out1>)
    - [`fd_ext_poh_publish_executed_txn::FD_VOLATILE`](<#fd_ext_poh_publish_executed_txnfd_volatile>)
    - [`scratch_footprint`](<#scratch_footprint>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)