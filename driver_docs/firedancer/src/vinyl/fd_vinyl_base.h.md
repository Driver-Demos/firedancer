<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Header file for a persistent interprocess shared key-value store with non-volatile storage and various optimizations.

# Purpose
The code defines a C header file for a module named `vinyl`, which implements a persistent interprocess shared key-value store. This store is backed by non-volatile storage, distinguishing it from other key-value stores like `groove` and `funk_rec`. The module supports massive batch requests processed asynchronously with zero-copy cut-through from the I/O layer to multiple clients. It includes runtime plugin I/O backends for various non-volatile storage styles, such as direct I/O to raw block devices and memory-mapped I/O. The module also features in-memory LRU data caching, acquire/release semantics for pointer lifetime control, lock-free metadata queries, and application-specific metadata always available in memory. It provides persistence guarantees, non-blocking speculative reads, and fast overwriting of existing values. The module includes extensive consistency checking, background data integrity checking, and data compression, along with live runtime statistics.

The header file defines several APIs and data structures. It includes error code definitions that mirror those in `fd_map`, and provides a function [`fd_vinyl_strerror`](<#fd_vinyl_strerror>) to convert error codes into human-readable strings. The `fd_vinyl_key_t` API specifies the key type for key-value pairs, with functions for initializing keys and checking key equality. The `fd_vinyl_info_t` structure is used to store decoded value sizes and application-specific information, ensuring efficient data handling between clients, caches, and I/O layers. The file also defines constants for key alignment, footprint, and maximum value size. The header file is intended to be included in other C files to provide the necessary definitions and prototypes for working with the `vinyl` key-value store.
# Imports and Dependencies

---
- `../tango/fd_tango.h`
- `../util/tmpl/fd_map.h`


# Data Structures

---
### fd\_vinyl\_key
- **Type**: ``union``
- **Members**:
    - ``c``: An array of characters with a size defined by `FD_VINYL_KEY_FOOTPRINT`.
    - ``uc``: An array of unsigned characters with a size defined by `FD_VINYL_KEY_FOOTPRINT`.
    - ``ul``: An array of unsigned long integers with a size of `FD_VINYL_KEY_FOOTPRINT` divided by the size of an unsigned long.
- **Description**: Defines a union named `fd_vinyl_key` that provides multiple views of a key used in a vinyl key-value store, allowing it to be accessed as an array of characters, unsigned characters, or unsigned long integers, with a specific alignment and footprint size.


---
### fd\_vinyl\_key\_t
- **Type**: `union`
- **Members**:
    - ``c``: An array of `char` with a size defined by `FD_VINYL_KEY_FOOTPRINT`.
    - ``uc``: An array of `uchar` with a size defined by `FD_VINYL_KEY_FOOTPRINT`.
    - ``ul``: An array of `ulong` with a size of `FD_VINYL_KEY_FOOTPRINT` divided by the size of `ulong`.
- **Description**: Defines a union for representing keys in a vinyl key-value store, allowing for different data types (`char`, `uchar`, `ulong`) to be used interchangeably within a fixed footprint size, facilitating efficient storage and retrieval operations.


---
### fd\_vinyl\_info
- **Type**: ``union``
- **Members**:
    - ``_val_sz``: Stores the decoded value size as a `uint`.
    - ``uc``: An array of `uchar` with size `FD_VINYL_INFO_SZ`.
    - ``ui``: An array of `uint` with size `FD_VINYL_INFO_SZ / sizeof(uint)`.
    - ``ul``: An array of `ulong` with size `FD_VINYL_INFO_SZ / sizeof(ulong)`.
- **Description**: The `fd_vinyl_info` union provides a flexible structure to store a decoded value size and application-specific information, such as creation time, modification time, balance, and expiration. It is used in various components like the bstream, vinyl meta cache, and vinyl value data cache to minimize data marshalling and memory operations. The union must be 8-byte aligned, have a size of `FD_VINYL_INFO_SZ`, and the first 4 bytes must represent the decoded value size as a `uint` within the range [0, `FD_VINYL_VAL_MAX`].


---
### fd\_vinyl\_info\_t
- **Type**: ``union``
- **Members**:
    - ``_val_sz``: Stores the decoded pair value size as a `uint`.
    - ``uc``: An array of `uchar` with a size of `FD_VINYL_INFO_SZ`.
    - ``ui``: An array of `uint` with a size of `FD_VINYL_INFO_SZ / sizeof(uint)`.
    - ``ul``: An array of `ulong` with a size of `FD_VINYL_INFO_SZ / sizeof(ulong)`.
- **Description**: Provides the pair decoded value size and any application-specific information, such as creation time, modification time, balance, or expiration. It is used in the bstream, vinyl meta cache, and vinyl value data cache to minimize data marshalling, memory copies, and random access between clients, tiles, caches, and I/O layers, while also allowing for additional integrity checks. The structure must be 8-byte aligned, `FD_VINYL_INFO_SZ` in size, and the first 4 bytes must represent the decoded pair value size as a `uint` within the range [0, `FD_VINYL_VAL_MAX`].


# Functions

---
### fd\_vinyl\_key\_init\_ulong<!-- {{#callable:fd_vinyl_key_init_ulong}} -->
[View Source →](<../../../../src/vinyl/fd_vinyl_base.h#L191>)

Initializes a `fd_vinyl_key_t` structure with five unsigned long values.
- **Inputs**:
    - `mem`: A pointer to a memory region where the `fd_vinyl_key_t` structure will be initialized.
    - `k0`: The first unsigned long value to store in the key.
    - `k1`: The second unsigned long value to store in the key.
    - `k2`: The third unsigned long value to store in the key.
    - `k3`: The fourth unsigned long value to store in the key.
    - `k4`: The fifth unsigned long value to store in the key.
- **Logic and Control Flow**:
    - Cast the `mem` pointer to a `fd_vinyl_key_t` pointer and assign it to `k`.
    - Assign the value of `k0` to the first element of the `ul` array in `k`.
    - Assign the value of `k1` to the second element of the `ul` array in `k`.
    - Assign the value of `k2` to the third element of the `ul` array in `k`.
    - Assign the value of `k3` to the fourth element of the `ul` array in `k`.
    - Assign the value of `k4` to the fifth element of the `ul` array in `k`.
    - Return the pointer `k`.
- **Output**: Returns a pointer to the initialized `fd_vinyl_key_t` structure.


---
### fd\_vinyl\_key\_eq<!-- {{#callable:fd_vinyl_key_eq}} -->
[View Source →](<../../../../src/vinyl/fd_vinyl_base.h#L208>)

Checks if two `fd_vinyl_key_t` keys are equal by comparing their `ulong` arrays.
- **Inputs**:
    - `ka`: A pointer to the first `fd_vinyl_key_t` key to compare.
    - `kb`: A pointer to the second `fd_vinyl_key_t` key to compare.
- **Logic and Control Flow**:
    - Extracts the `ulong` arrays from both `ka` and `kb` keys.
    - Performs bitwise XOR on corresponding elements of the two arrays.
    - Combines the results using bitwise OR to check if any differences exist.
    - Returns 1 if all elements are equal (resulting in zero), otherwise returns 0.
- **Output**: Returns 1 if the keys are equal, otherwise returns 0.


---
### fd\_vinyl\_key\_memo<!-- {{#callable:fd_vinyl_key_memo}} -->
[View Source →](<../../../../src/vinyl/fd_vinyl_base.h#L223>)

Computes a hash value for a given key and seed using a series of XOR operations and hash functions.
- **Inputs**:
    - `seed`: A 64-bit unsigned integer used as the initial seed for the hash computation.
    - `k`: A pointer to a `fd_vinyl_key_t` structure representing the key to be hashed.
- **Logic and Control Flow**:
    - Extracts the array of unsigned long integers from the key `k`.
    - Computes the hash of each element in the array after applying a unique XOR operation with the seed and predefined constants.
    - Combines the results of these hash computations using XOR to produce the final hash value.
- **Output**: Returns a 64-bit unsigned integer representing the computed hash value.


# Function Declarations (Public API)

---
### fd\_vinyl\_strerror<!-- {{#callable_declaration:fd_vinyl_strerror}} -->
[View Source →](<../../../../src/vinyl/fd_vinyl_base.h#L131>)

Converts an error code to a human-readable string.
- **Description**: Use this function to obtain a human-readable description of an error code related to the Vinyl key-value store. This is useful for logging or displaying error messages to users. The function returns a constant string that describes the error corresponding to the provided error code. The returned string is always non-null and has an infinite lifetime, meaning it does not need to be freed or managed by the caller.
- **Inputs**:
    - `err`: An integer representing an error code. Valid values are predefined constants such as `FD_VINYL_SUCCESS`, `FD_VINYL_ERR_INVAL`, `FD_VINYL_ERR_AGAIN`, `FD_VINYL_ERR_CORRUPT`, `FD_VINYL_ERR_EMPTY`, `FD_VINYL_ERR_FULL`, and `FD_VINYL_ERR_KEY`. If the error code is not recognized, the function returns "unknown".
- **Output**: A constant character pointer to a string describing the error. The string is always non-null and has an infinite lifetime.
- **See Also**: [`fd_vinyl_strerror`](<fd_vinyl_base.c.md#fd_vinyl_strerror>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)