<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

A benchmarking tool for evaluating the performance of the `fd_funk` data structure.

# Purpose
The code is an executable C program designed to benchmark and analyze the performance of a data structure referred to as `fd_funk`. It includes functions to initialize and manage a workspace, generate random data, and perform operations on records within the `fd_funk` structure. The program uses command-line arguments to configure various parameters such as workspace size, number of accounts, and random number generator seeds. The [`main`](<#main>) function orchestrates the setup, execution, and cleanup of the benchmark, including memory allocation and deallocation for the `fd_funk` structure.

The program contains two main functions: [`run_benchmark`](<#run_benchmark>) and [`stat_chains`](<#stat_chains>). The [`run_benchmark`](<#run_benchmark>) function inserts a specified number of records into the `fd_funk` structure, using random keys generated by a random number generator. It prepares, truncates, and publishes records within a loop. The [`stat_chains`](<#stat_chains>) function calculates and logs statistics about the lengths of chains in the record map, such as minimum, maximum, mean, variance, and standard deviation. The program logs various performance metrics and memory usage details, providing insights into the efficiency and behavior of the `fd_funk` data structure under the given conditions.
# Imports and Dependencies

---
- `fd_funk.h`
- `fd_funk_base.h`
- `math.h`


# Functions

---
### run\_benchmark<!-- {{#callable:run_benchmark}} -->
[View Source →](<../../../../src/funk/bench_funk_index.c#L7>)

Executes a benchmark by repeatedly preparing, truncating, and publishing records in a funk data structure.
- **Inputs**:
    - `funk`: A pointer to an `fd_funk_t` structure, representing the funk data structure to operate on.
    - `rng`: A pointer to an `fd_rng_t` structure, used to generate random numbers.
    - `acc_cnt`: An unsigned long integer representing the number of accounts to process in the benchmark.
- **Logic and Control Flow**:
    - Initialize `funk_wksp` by calling [`fd_funk_wksp`](<fd_funk.h.md#fd_funk_wksp>) with `funk` as the argument.
    - Set `acc_rem` to `acc_cnt` to track the remaining accounts to process.
    - Enter a loop that continues until `acc_rem` is zero.
    - In each iteration, generate a random key using `fd_rng_ulong` and store it in `key.ul[0]`.
    - Prepare a record by calling [`fd_funk_rec_prepare`](<fd_funk_rec.c.md#fd_funk_rec_prepare>) with the generated key and store the result in `rec`.
    - Check if `rec` is valid using `FD_TEST`.
    - Truncate the record's value by calling [`fd_funk_val_truncate`](<fd_funk_val.c.md#fd_funk_val_truncate>) with specific parameters including `funk_wksp`.
    - Publish the prepared record by calling [`fd_funk_rec_publish`](<fd_funk_rec.c.md#fd_funk_rec_publish>).
    - Decrement `acc_rem` to process the next account.
- **Output**: No return value; the function operates on the provided `fd_funk_t` structure and modifies it in place.
- **Functions Called**:
    - [`fd_funk_wksp`](<fd_funk.h.md#fd_funk_wksp>)
    - [`fd_funk_rec_prepare`](<fd_funk_rec.c.md#fd_funk_rec_prepare>)
    - [`fd_funk_val_truncate`](<fd_funk_val.c.md#fd_funk_val_truncate>)
    - [`fd_funk_alloc`](<fd_funk.h.md#fd_funk_alloc>)
    - [`fd_funk_rec_publish`](<fd_funk_rec.c.md#fd_funk_rec_publish>)


---
### stat\_chains<!-- {{#callable:stat_chains}} -->
[View Source →](<../../../../src/funk/bench_funk_index.c#L29>)

Calculates and logs statistical data about the lengths of chains in a record map.
- **Inputs**:
    - ``funk``: A pointer to an `fd_funk_t` structure, which represents the context for the record map operations.
- **Logic and Control Flow**:
    - Retrieve the record map associated with the `funk` pointer using `fd_funk_rec_map`.
    - Get the chain table from the record map using `fd_funk_rec_map_shmem_private_chain`.
    - Determine the number of chains using `fd_funk_rec_map_chain_cnt`.
    - Initialize variables `sum`, `min`, and `max` to calculate statistics.
    - Iterate over each chain index from 0 to `chain_cnt` to calculate the length of each chain using `fd_funk_rec_map_private_vcnt_cnt`.
    - Update `sum`, `min`, and `max` with the chain length values.
    - Calculate the mean chain length by dividing `sum` by `chain_cnt`.
    - Initialize `var` to 0.0 to calculate variance.
    - Iterate over each chain index again to calculate the variance by summing the squared differences from the mean.
    - Divide `var` by `chain_cnt` to get the variance.
    - Log the minimum, maximum, mean, variance, and standard deviation of the chain lengths using `FD_LOG_NOTICE`.
- **Output**: No return value; logs statistical information about chain lengths.


---
### main<!-- {{#callable:main}} -->
[View Source →](<../../../../src/funk/bench_funk_index.c#L55>)

Initializes the environment, processes command-line arguments, sets up resources, runs a benchmark, and cleans up before exiting.
- **Inputs**:
    - `argc`: The number of command-line arguments.
    - `argv`: An array of command-line argument strings.
- **Logic and Control Flow**:
    - Call `fd_boot` to initialize the environment with command-line arguments.
    - Extract various configuration parameters from the command-line arguments using `fd_env_strip_cmdline_*` functions.
    - Initialize a random number generator with `fd_rng_new` and `fd_rng_join`.
    - Convert the page size string to a memory page size using `fd_cstr_to_shmem_page_sz`.
    - Calculate the footprint of the funk data structure and estimate the chain count.
    - Check if the funk footprint exceeds available memory and log an error if it does.
    - Attach to an existing workspace or create a new anonymous workspace based on the presence of the `--wksp` argument.
    - Allocate memory for the funk data structure and initialize it with [`fd_funk_new`](<fd_funk.c.md#fd_funk_new>) and [`fd_funk_join`](<fd_funk.c.md#fd_funk_join>).
    - Verify the chain count of the funk record map matches the estimated chain count.
    - Log the start of the insert loop and measure the time taken to run the [`run_benchmark`](<#run_benchmark>) function.
    - Log the number of accounts inserted and the rate of insertion.
    - Call [`stat_chains`](<#stat_chains>) to log statistics about the chain lengths in the funk record map.
    - Measure and log the time taken to clean up resources, including leaving and deleting the funk and workspace.
    - Log a 'pass' message and call `fd_halt` to terminate the program.
- **Output**: Returns 0 to indicate successful execution.
- **Functions Called**:
    - [`fd_funk_footprint`](<fd_funk.c.md#fd_funk_footprint>)
    - [`fd_funk_align`](<fd_funk.c.md#fd_funk_align>)
    - [`fd_funk_join`](<fd_funk.c.md#fd_funk_join>)
    - [`fd_funk_new`](<fd_funk.c.md#fd_funk_new>)
    - [`run_benchmark`](<#run_benchmark>)
    - [`stat_chains`](<#stat_chains>)
    - [`fd_funk_leave`](<fd_funk.c.md#fd_funk_leave>)
    - [`fd_funk_delete_fast`](<fd_funk.c.md#fd_funk_delete_fast>)
    - [`fd_funk_delete`](<fd_funk.c.md#fd_funk_delete>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)