<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Functions for truncating and verifying values in a record within the Firedancer codebase.

# Purpose
The code provides functionality for managing and verifying the size and allocation of values associated with records in a data structure. It includes two main functions: [`fd_funk_val_truncate`](<#fd_funk_val_truncate>) and [`fd_funk_val_verify`](<#fd_funk_val_verify>). The [`fd_funk_val_truncate`](<#fd_funk_val_truncate>) function adjusts the size of a value associated with a record, either truncating it to zero, increasing its size, or simply setting a new size. It handles memory allocation and deallocation using the provided allocator and workspace, ensuring that the value is correctly aligned and does not exceed predefined maximum sizes. The function also returns error codes to indicate success or specific failure conditions, such as invalid input or memory allocation failure.

The [`fd_funk_val_verify`](<#fd_funk_val_verify>) function checks the integrity of the values associated with records in a data structure. It iterates over all records, verifying that the size and allocation of each value are within valid limits and that the memory addresses are correctly tagged. This function ensures that the data structure maintains consistency and that no invalid memory operations occur. The code is part of a larger system, likely involving memory management and data integrity checks, and is intended to be used within a specific context where these records and their associated values are manipulated.
# Imports and Dependencies

---
- `fd_funk_private.h`


# Functions

---
### fd\_funk\_val\_truncate<!-- {{#callable:fd_funk_val_truncate}} -->
[View Source →](<../../../../src/funk/fd_funk_val.c#L3>)

Adjusts the size of a value in a record, reallocating memory if necessary, and handles errors.
- **Inputs**:
    - ``rec``: A pointer to the `fd_funk_rec_t` record whose value size is to be adjusted.
    - ``alloc``: A pointer to the `fd_alloc_t` allocator used for memory allocation.
    - ``wksp``: A pointer to the `fd_wksp_t` workspace used for memory operations.
    - ``align``: An unsigned long specifying the alignment requirement for the memory allocation.
    - ``sz``: An unsigned long specifying the new size for the value in the record.
    - ``opt_err``: An optional pointer to an integer where error codes can be stored.
- **Logic and Control Flow**:
    - Checks if the input arguments are valid, including checking for null pointers and alignment requirements, if `FD_FUNK_HANDHOLDING` is defined.
    - If `sz` is zero, calls [`fd_funk_val_flush`](<fd_funk_val.h.md#fd_funk_val_flush>) to remove the existing value and returns `NULL`.
    - If `sz` is greater than the current maximum size (`val_max`), allocates new memory for the value, copies the existing value to the new memory, and updates the record with the new memory address and size.
    - If memory allocation fails, stores an error code in `opt_err` and returns `NULL`.
    - If `sz` is less than or equal to `val_max`, simply updates the size in the record and returns the current value address.
- **Output**: Returns a pointer to the new or existing value in the record, or `NULL` if an error occurs or if the size is truncated to zero.
- **Functions Called**:
    - [`fd_funk_val_flush`](<fd_funk_val.h.md#fd_funk_val_flush>)


---
### fd\_funk\_val\_verify<!-- {{#callable:fd_funk_val_verify}} -->
[View Source →](<../../../../src/funk/fd_funk_val.c#L77>)

Verifies the integrity and validity of all records in a `fd_funk_t` structure.
- **Inputs**:
    - `funk`: A pointer to a `fd_funk_t` structure that contains the records to verify.
- **Logic and Control Flow**:
    - Retrieve the workspace pointer `wksp` and workspace tag `wksp_tag` from the `funk` structure.
    - Define a macro `TEST` to check conditions and log a warning if a condition fails, returning `FD_FUNK_ERR_INVAL`.
    - Initialize an iterator `iter` to iterate over all records in the `funk` structure.
    - For each record, retrieve the record's size `val_sz`, maximum size `val_max`, and global address `val_gaddr`.
    - Check that `val_sz` is less than or equal to `val_max`.
    - Check that `val_max` is less than or equal to `FD_FUNK_REC_VAL_MAX`.
    - If `val_gaddr` is zero, ensure `val_max` is also zero; otherwise, check that `val_max` is greater than zero and less than or equal to `FD_FUNK_REC_VAL_MAX`, and verify that the workspace tag of `val_gaddr` matches `wksp_tag`.
    - Return `FD_FUNK_SUCCESS` if all records pass the verification.
- **Output**: Returns `FD_FUNK_SUCCESS` if all records are valid, otherwise returns `FD_FUNK_ERR_INVAL` if any record fails verification.
- **Functions Called**:
    - [`fd_funk_wksp`](<fd_funk.h.md#fd_funk_wksp>)
    - [`fd_funk_all_iter_new`](<fd_funk_private.h.md#fd_funk_all_iter_new>)
    - [`fd_funk_all_iter_done`](<fd_funk_private.h.md#fd_funk_all_iter_done>)
    - [`fd_funk_all_iter_next`](<fd_funk_private.h.md#fd_funk_all_iter_next>)
    - [`fd_funk_all_iter_ele_const`](<fd_funk_private.h.md#fd_funk_all_iter_ele_const>)



---
Made with ❤️ by [Driver](https://www.driver.ai/)