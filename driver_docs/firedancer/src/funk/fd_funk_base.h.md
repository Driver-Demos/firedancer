<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Defines data structures and functions for managing key-value records and transactions in a "funk" instance.

# Purpose
The code is a C header file that defines the foundational components and operations for managing a data structure called a "funk instance." A funk instance is designed to store records, where each record is a key-value pair. The keys have a fixed length, while the values are variable-sized binary data. The code provides mechanisms for handling transactions that describe changes to these records. Transactions have unique identifiers and can form a history chain through their parent-child relationships. The code supports operations such as hashing, equality checks, and copying for both record keys and transaction identifiers. It also defines error codes for various operations and provides a function to convert these error codes into human-readable strings.

The header file includes definitions for data types such as `fd_funk_rec_key_t` and `fd_funk_txn_xid_t`, which represent record keys and transaction identifiers, respectively. It also defines structures and functions for handling these data types, including hash functions and equality checks. The code is designed to be used in environments that may support advanced features like 128-bit integers or SIMD instructions, as indicated by conditional compilation directives. The file does not define a public API but provides the necessary components for implementing funk instances and managing their transactions.
# Imports and Dependencies

---
- `../util/fd_util.h`
- `immintrin.h`


# Data Structures

---
### fd\_funk\_rec\_key
- **Type**: `union`
- **Members**:
    - ``uc``: An array of unsigned characters with a size defined by `FD_FUNK_REC_KEY_FOOTPRINT`.
    - ``ui``: An array of unsigned integers with a fixed size of 8.
    - ``ul``: An array of unsigned long integers with a fixed size of 4.
- **Description**: Defines a union that represents a fixed-length key for a funk record, allowing the key to be accessed as an array of unsigned characters, unsigned integers, or unsigned long integers, depending on the required operation or context.


---
### fd\_funk\_rec\_key\_t
- **Type**: `union`
- **Members**:
    - ``uc``: An array of unsigned characters with a size of `FD_FUNK_REC_KEY_FOOTPRINT`.
    - ``ui``: An array of unsigned integers with a size of 8.
    - ``ul``: An array of unsigned long integers with a size of 4.
- **Description**: Identifies a funk record using a compact binary key, which can also be a C-style string (cstr) if it is shorter than `FD_FUNK_REC_KEY_FOOTPRINT` and padded with zeros. The union provides multiple views of the key data, allowing it to be accessed as an array of unsigned characters, integers, or long integers, depending on the use case.


---
### fd\_funk\_txn\_xid
- **Type**: `union`
- **Members**:
    - ``uc``: An array of unsigned characters with a size defined by `FD_FUNK_TXN_XID_FOOTPRINT`.
    - ``ul``: An array of unsigned long integers with a size calculated by dividing `FD_FUNK_TXN_XID_FOOTPRINT` by the size of an unsigned long.
    - ``uf``: An array of 128-bit unsigned integers, available if `FD_HAS_INT128` is defined.
    - ``xmm``: An array of 128-bit SIMD registers, available if `FD_HAS_X86` is defined.
- **Description**: Defines a union for representing a transaction identifier (`fd_funk_txn_xid_t`) in a funk system, allowing multiple representations (byte array, long integer array, 128-bit integer, or SIMD register) depending on the system's capabilities.


---
### fd\_funk\_txn\_xid\_t
- **Type**: `union`
- **Members**:
    - ``uc``: An array of unsigned characters with a size defined by `FD_FUNK_TXN_XID_FOOTPRINT`.
    - ``ul``: An array of unsigned long integers with a size of `FD_FUNK_TXN_XID_FOOTPRINT / sizeof(ulong)`.
    - ``uf``: An array of 128-bit unsigned integers, available if `FD_HAS_INT128` is defined.
    - ``xmm``: An array of 128-bit SIMD registers, available if `FD_HAS_X86` is defined.
- **Description**: Identifies a funk transaction currently in preparation, using a compact binary identifier. The union provides multiple ways to access the transaction ID data, including as an array of unsigned characters, unsigned long integers, 128-bit unsigned integers, or SIMD registers, depending on the system's capabilities. The structure is aligned to `FD_FUNK_TXN_XID_ALIGN` and has a footprint of `FD_FUNK_TXN_XID_FOOTPRINT`, facilitating efficient memory access and operations.


---
### fd\_funk\_xid\_key\_pair
- **Type**: ``struct``
- **Members**:
    - ``xid``: An array of one `fd_funk_txn_xid_t` that represents the transaction identifier.
    - ``key``: An array of one `fd_funk_rec_key_t` that represents the record key.
- **Description**: Combines a transaction identifier and a record key into a single structure, allowing for the identification of a specific record within a transaction in the funk system.


---
### fd\_funk\_xid\_key\_pair\_t
- **Type**: ``struct``
- **Members**:
    - ``xid``: An array containing a single `fd_funk_txn_xid_t` element, representing the transaction identifier.
    - ``key``: An array containing a single `fd_funk_rec_key_t` element, representing the record key.
- **Description**: Combines a transaction identifier (`xid`) and a record key (`key`) into a single structure, facilitating the identification of a specific funk record within a transaction.


---
### fd\_funk\_shmem\_t
- **Type**: ``struct``
- **Description**: Represents the top part of a funk object in shared memory. The `fd_funk_shmem_t` is defined as a typedef for a private structure `fd_funk_shmem_private`, indicating that its internal details are not exposed in the provided code.


---
### fd\_funk\_t
- **Type**: ``struct``
- **Members**:
    - ``fd_funk_private``: Opaque structure representing a funk instance.
- **Description**: `fd_funk_t` is a typedef for a pointer to an opaque structure `fd_funk_private`, which represents a local join handle to a funk instance. This structure is used to manage and interact with funk instances, which store records as key-value pairs and support transactions with unique identifiers and hierarchical relationships. The details of `fd_funk_private` are not exposed, indicating that it is intended for internal use within the funk system.


# Functions

---
### fd\_xxh3\_mul128\_fold64<!-- {{#callable:fd_xxh3_mul128_fold64}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L161>)

Computes a 64-bit folded hash from the 128-bit product of two unsigned long integers.
- **Inputs**:
    - `lhs`: The left-hand side operand of the multiplication, an unsigned long integer.
    - `rhs`: The right-hand side operand of the multiplication, an unsigned long integer.
- **Logic and Control Flow**:
    - Multiply `lhs` and `rhs` to produce a 128-bit product stored in `product`.
    - Extract the lower 64 bits of `product` and XOR it with the upper 64 bits of `product` shifted right by 64 bits.
    - Return the result of the XOR operation as an unsigned long integer.
- **Output**: A 64-bit unsigned long integer resulting from the XOR operation on the 128-bit product of the inputs.


---
### fd\_xxh3\_mix16b<!-- {{#callable:fd_xxh3_mix16b}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L167>)

Computes a 64-bit hash by mixing two 64-bit integers with a seed using a specific folding and multiplication method.
- **Inputs**:
    - `i0`: The first 64-bit integer input to mix.
    - `i1`: The second 64-bit integer input to mix.
    - `s0`: The first 64-bit integer used in the mixing process.
    - `s1`: The second 64-bit integer used in the mixing process.
    - `seed`: A 64-bit integer seed used to influence the mixing process.
- **Logic and Control Flow**:
    - XORs `i0` with the sum of `s0` and `seed`.
    - XORs `i1` with the difference of `s1` and `seed`.
    - Calls [`fd_xxh3_mul128_fold64`](<#fd_xxh3_mul128_fold64>) with the results of the XOR operations to compute the final hash value.
- **Output**: Returns a 64-bit unsigned long integer representing the mixed hash value.
- **Functions Called**:
    - [`fd_xxh3_mul128_fold64`](<#fd_xxh3_mul128_fold64>)


---
### fd\_funk\_rec\_key\_hash1<!-- {{#callable:fd_funk_rec_key_hash1}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L205>)

Computes a hash for a 32-byte key and a record type using a seed value.
- **Inputs**:
    - `key`: A 32-byte array representing the key to hash.
    - `rec_type`: An unsigned long integer representing the record type.
    - `seed`: An unsigned long integer used as the seed for the hash function.
- **Logic and Control Flow**:
    - XORs the `seed` with `rec_type` to modify the seed.
    - Loads four 8-byte segments from the `key` array.
    - Computes a hash for each segment by XORing the modified seed with a shifted constant and the segment value.
    - Combines the four hash values using XOR operations to produce the final hash.
- **Output**: Returns an unsigned long integer representing the computed hash value.


---
### fd\_funk\_rec\_key\_hash<!-- {{#callable:fd_funk_rec_key_hash}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L217>)

Computes a 64-bit hash for a given record key using a specified seed.
- **Inputs**:
    - `k`: A pointer to a `fd_funk_rec_key_t` structure representing the record key to hash.
    - `seed`: A 64-bit unsigned integer used to select the specific hash function.
- **Logic and Control Flow**:
    - Calls the function `fd_funk_rec_key_hash1` with the `uc` field of the record key, a record type of 0, and the provided seed.
    - Returns the result of the `fd_funk_rec_key_hash1` function call.
- **Output**: Returns a 64-bit unsigned integer representing the hash of the record key.


---
### fd\_funk\_rec\_key\_eq<!-- {{#callable:fd_funk_rec_key_eq}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L229>)

Checks if two `fd_funk_rec_key_t` keys are equal by comparing their underlying `ulong` arrays.
- **Inputs**:
    - `ka`: A pointer to the first `fd_funk_rec_key_t` key to compare.
    - `kb`: A pointer to the second `fd_funk_rec_key_t` key to compare.
- **Logic and Control Flow**:
    - Retrieve the `ulong` arrays from the `fd_funk_rec_key_t` structures pointed to by `ka` and `kb`.
    - Perform bitwise XOR operations on corresponding elements of the two `ulong` arrays.
    - Combine the results of the XOR operations using bitwise OR operations.
    - Return 1 if all results are zero (indicating equality), otherwise return 0.
- **Output**: Returns 1 if the keys are equal, otherwise returns 0.


---
### fd\_funk\_rec\_key\_copy<!-- {{#callable:fd_funk_rec_key_copy}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L241>)

Copies the contents of one `fd_funk_rec_key_t` structure to another.
- **Inputs**:
    - `kd`: A pointer to the destination `fd_funk_rec_key_t` where the key will be copied.
    - `ks`: A pointer to the source `fd_funk_rec_key_t` from which the key will be copied.
- **Logic and Control Flow**:
    - Declare pointers `d` and `s` to the `ul` arrays of `kd` and `ks`, respectively.
    - Copy each of the four `ulong` elements from the source `s` to the destination `d`.
    - Return the pointer `kd`.
- **Output**: Returns a pointer to the destination `fd_funk_rec_key_t` (`kd`).


---
### fd\_funk\_txn\_xid\_hash<!-- {{#callable:fd_funk_txn_xid_hash}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L257>)

Computes a 64-bit hash for a given transaction ID using a seed value.
- **Inputs**:
    - `x`: A pointer to a `fd_funk_txn_xid_t` structure representing the transaction ID to hash.
    - `seed`: An unsigned long integer used as the seed for the hash function.
- **Logic and Control Flow**:
    - XOR the `seed` with `1UL<<0` and the first element of `x->ul`, then apply `fd_ulong_hash` to the result.
    - XOR the `seed` with `1UL<<1` and the second element of `x->ul`, then apply `fd_ulong_hash` to the result.
    - XOR the two hash results obtained from the previous steps to produce the final hash value.
- **Output**: Returns a 64-bit unsigned long integer representing the hash of the transaction ID.


---
### fd\_funk\_txn\_xid\_eq<!-- {{#callable:fd_funk_txn_xid_eq}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L267>)

Checks if two transaction identifiers are equal by comparing their underlying `ulong` arrays.
- **Inputs**:
    - `xa`: A pointer to the first `fd_funk_txn_xid_t` transaction identifier to compare.
    - `xb`: A pointer to the second `fd_funk_txn_xid_t` transaction identifier to compare.
- **Logic and Control Flow**:
    - Retrieve the `ulong` arrays from the transaction identifiers `xa` and `xb`.
    - Perform a bitwise XOR operation between corresponding elements of the two arrays.
    - Perform a bitwise OR operation on the results of the XOR operations.
    - Return the negation of the OR operation result, which is 1 if both arrays are identical and 0 otherwise.
- **Output**: Returns 1 if the transaction identifiers are equal, otherwise returns 0.


---
### fd\_funk\_txn\_xid\_copy<!-- {{#callable:fd_funk_txn_xid_copy}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L279>)

Copies a transaction ID from one `fd_funk_txn_xid_t` structure to another.
- **Inputs**:
    - `xd`: A pointer to the destination `fd_funk_txn_xid_t` structure where the transaction ID will be copied.
    - `xs`: A pointer to the source `fd_funk_txn_xid_t` structure from which the transaction ID will be copied.
- **Logic and Control Flow**:
    - Retrieve the `ul` array from the source `xs` and destination `xd` structures.
    - Copy the first element of the `ul` array from `xs` to `xd`.
    - Copy the second element of the `ul` array from `xs` to `xd`.
    - Return the pointer to the destination `fd_funk_txn_xid_t` structure `xd`.
- **Output**: Returns a pointer to the destination `fd_funk_txn_xid_t` structure `xd` after copying the transaction ID.


---
### fd\_funk\_txn\_xid\_st\_atomic<!-- {{#callable:fd_funk_txn_xid_st_atomic}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L288>)

Copies a transaction ID from source to destination using atomic operations if supported by the architecture.
- **Inputs**:
    - ``xd``: A pointer to the destination `fd_funk_txn_xid_t` where the transaction ID will be copied.
    - ``xs``: A pointer to the source `fd_funk_txn_xid_t` from which the transaction ID will be copied.
- **Logic and Control Flow**:
    - If the architecture supports x86, copy the transaction ID using the `xmm` register with volatile semantics.
    - If the architecture supports 128-bit integers, copy the transaction ID using the `uf` field with volatile semantics.
    - If neither x86 nor 128-bit integer support is available, use the [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>) function to copy the transaction ID.
- **Output**: Returns a pointer to the destination `fd_funk_txn_xid_t` after copying the transaction ID.
- **Functions Called**:
    - [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>)


---
### fd\_funk\_txn\_xid\_ld\_atomic<!-- {{#callable:fd_funk_txn_xid_ld_atomic}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L301>)

Loads a transaction ID from a source to a destination atomically, using different methods based on the platform.
- **Inputs**:
    - ``xd``: A pointer to the destination `fd_funk_txn_xid_t` where the transaction ID will be loaded.
    - ``xs``: A pointer to the source `fd_funk_txn_xid_t` from which the transaction ID will be loaded.
- **Logic and Control Flow**:
    - If `FD_HAS_X86` is defined, load the first element of `xs->xmm` into `xd->xmm` using `FD_VOLATILE_CONST` to ensure atomicity.
    - If `FD_HAS_INT128` is defined and `FD_HAS_X86` is not, load the first element of `xs->uf` into `xd->uf` using `FD_VOLATILE_CONST` to ensure atomicity.
    - If neither `FD_HAS_X86` nor `FD_HAS_INT128` is defined, use [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>) to copy the transaction ID from `xs` to `xd`.
    - Return the pointer `xd`.
- **Output**: Returns a pointer to the destination `fd_funk_txn_xid_t` (`xd`) after loading the transaction ID.
- **Functions Called**:
    - [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>)


---
### fd\_funk\_txn\_xid\_eq\_root<!-- {{#callable:fd_funk_txn_xid_eq_root}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L318>)

Checks if a given transaction ID is the root transaction by comparing its components to `ULONG_MAX`.
- **Inputs**:
    - `x`: A pointer to a `fd_funk_txn_xid_t` structure representing the transaction ID to check.
- **Logic and Control Flow**:
    - Retrieve the `ul` array from the transaction ID `x`.
    - Compare the first element of the array to `ULONG_MAX`.
    - Compare the second element of the array to `ULONG_MAX`.
    - Return 1 if both elements are equal to `ULONG_MAX`, otherwise return 0.
- **Output**: Returns 1 if the transaction ID is the root transaction, otherwise returns 0.


---
### fd\_funk\_txn\_xid\_set\_root<!-- {{#callable:fd_funk_txn_xid_set_root}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L328>)

Sets the transaction ID pointed to by `x` to the root transaction.
- **Inputs**:
    - `x`: A pointer to a `fd_funk_txn_xid_t` structure representing a transaction ID.
- **Logic and Control Flow**:
    - Accesses the `ul` array of the `fd_funk_txn_xid_t` structure pointed to by `x`.
    - Sets both elements of the `ul` array to `ULONG_MAX`, marking the transaction ID as the root.
- **Output**: Returns the pointer `x` after setting it to the root transaction.


---
### fd\_funk\_xid\_key\_pair\_hash<!-- {{#callable:fd_funk_xid_key_pair_hash}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L338>)

Computes a 64-bit hash for a `fd_funk_xid_key_pair_t` by hashing only the record key part, ignoring the transaction ID.
- **Inputs**:
    - `p`: A pointer to a `fd_funk_xid_key_pair_t` structure, which contains a transaction ID and a record key.
    - `seed`: A 64-bit unsigned integer used to select the specific hash function.
- **Logic and Control Flow**:
    - Ignores the transaction ID (`xid`) part of the `fd_funk_xid_key_pair_t` to ensure all instances of a given record key are in the same hash chain.
    - Calls `fd_funk_rec_key_hash` with the record key (`p->key`) and the provided `seed` to compute the hash.
- **Output**: Returns a 64-bit unsigned integer representing the hash of the record key.


---
### fd\_funk\_xid\_key\_pair\_eq<!-- {{#callable:fd_funk_xid_key_pair_eq}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L351>)

Checks if two `fd_funk_xid_key_pair_t` structures have equal transaction IDs and record keys.
- **Inputs**:
    - `pa`: A pointer to the first `fd_funk_xid_key_pair_t` structure to compare.
    - `pb`: A pointer to the second `fd_funk_xid_key_pair_t` structure to compare.
- **Logic and Control Flow**:
    - Calls [`fd_funk_txn_xid_eq`](<#fd_funk_txn_xid_eq>) to compare the transaction IDs (`xid`) of `pa` and `pb`.
    - Calls [`fd_funk_rec_key_eq`](<#fd_funk_rec_key_eq>) to compare the record keys (`key`) of `pa` and `pb`.
    - Returns the bitwise AND of the results from [`fd_funk_txn_xid_eq`](<#fd_funk_txn_xid_eq>) and [`fd_funk_rec_key_eq`](<#fd_funk_rec_key_eq>).
- **Output**: Returns 1 if both the transaction IDs and record keys are equal, otherwise returns 0.
- **Functions Called**:
    - [`fd_funk_txn_xid_eq`](<#fd_funk_txn_xid_eq>)
    - [`fd_funk_rec_key_eq`](<#fd_funk_rec_key_eq>)


---
### fd\_funk\_xid\_key\_pair\_copy<!-- {{#callable:fd_funk_xid_key_pair_copy}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L361>)

Copies the transaction ID and record key from one `fd_funk_xid_key_pair_t` structure to another.
- **Inputs**:
    - ``pd``: A pointer to the destination `fd_funk_xid_key_pair_t` structure where the data will be copied.
    - ``ps``: A pointer to the source `fd_funk_xid_key_pair_t` structure from which the data will be copied.
- **Logic and Control Flow**:
    - Call [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>) to copy the transaction ID from `ps->xid` to `pd->xid`.
    - Call [`fd_funk_rec_key_copy`](<#fd_funk_rec_key_copy>) to copy the record key from `ps->key` to `pd->key`.
    - Return the pointer `pd`.
- **Output**: Returns a pointer to the destination `fd_funk_xid_key_pair_t` structure `pd`.
- **Functions Called**:
    - [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>)
    - [`fd_funk_rec_key_copy`](<#fd_funk_rec_key_copy>)


---
### fd\_funk\_xid\_key\_pair\_init<!-- {{#callable:fd_funk_xid_key_pair_init}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L374>)

Initializes a `fd_funk_xid_key_pair_t` structure with a transaction ID and a record key.
- **Inputs**:
    - ``p``: A pointer to a `fd_funk_xid_key_pair_t` structure to initialize.
    - ``x``: A pointer to a `fd_funk_txn_xid_t` structure representing the transaction ID.
    - ``k``: A pointer to a `fd_funk_rec_key_t` structure representing the record key.
- **Logic and Control Flow**:
    - Copy the transaction ID from `x` to the `xid` field of `p` using [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>).
    - Copy the record key from `k` to the `key` field of `p` using [`fd_funk_rec_key_copy`](<#fd_funk_rec_key_copy>).
    - Return the pointer `p`.
- **Output**: Returns the pointer `p` to the initialized `fd_funk_xid_key_pair_t` structure.
- **Functions Called**:
    - [`fd_funk_txn_xid_copy`](<#fd_funk_txn_xid_copy>)
    - [`fd_funk_rec_key_copy`](<#fd_funk_rec_key_copy>)


# Function Declarations (Public API)

---
### fd\_funk\_strerror<!-- {{#callable_declaration:fd_funk_strerror}} -->
[View Source →](<../../../../src/funk/fd_funk_base.h#L387>)

Converts an error code to a human-readable string.
- **Description**: Use this function to obtain a human-readable string that describes the result of an operation based on its error code. This is useful for logging or displaying error messages to users. The function accepts both success and error codes defined by the API. It returns a constant string that corresponds to the provided error code. If the error code is not recognized, it returns "unknown". The returned string is always valid and non-null, and its lifetime is infinite.
- **Inputs**:
    - `err`: An integer representing the error code. Valid values include `FD_FUNK_SUCCESS` and various `FD_FUNK_ERR_*` codes. The function handles unrecognized error codes by returning "unknown".
- **Output**: A constant character pointer to a string describing the error code. The string is non-null and has an infinite lifetime.
- **See Also**: [`fd_funk_strerror`](<fd_funk_base.c.md#fd_funk_strerror>)  (Implementation)



---
Made with ❤️ by [Driver](https://www.driver.ai/)