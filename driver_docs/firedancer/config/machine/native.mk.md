<!--------------------------------------------------------------------------------->
<!-- IMPORTANT: This file is auto-generated by Driver (https://driver.ai). -------->
<!-- Manual edits may be overwritten on future commits. --------------------------->
<!--------------------------------------------------------------------------------->

Configuration file for setting compiler flags and feature detection based on the native architecture.

# Purpose
This Makefile is used to configure the build environment for a software project, specifically targeting the detection and utilization of compiler features and CPU capabilities. It defines macros to check for the presence of specific compiler and CPU features, such as `__clang__`, `__GNUC__`, and various CPU instruction sets like `__SSE4_2__`, `__AVX2__`, and `__AVX512IFMA__`. The file sets the compiler (`CC`) to either `gcc` or `clang` based on the detected environment and includes additional configuration files based on the compiler and architecture. It also adjusts compiler flags (`CPPFLAGS`, `RUSTFLAGS`) to optimize for the native architecture and conditionally includes extra configuration files to enable features like threading and security based on the detected capabilities. The Makefile ensures compatibility with different compiler versions by disabling certain features if the compiler version does not meet the required threshold.
# Content Summary
This configuration file is a Makefile script used to set up the build environment for a software project. It defines and checks various compiler and architecture-specific features to optimize the build process.

1. **Compiler Detection and Configuration**: 
   - The script uses the `CC` variable to determine the compiler, defaulting to `gcc` if not specified. It checks if the compiler is Clang or GNU using the `check-define` function.
   - Depending on the detected compiler, it includes specific configuration files (`with-gcc.mk` or `with-clang.mk`) and sets the compiler commands (`CC`, `CXX`, `LD`) accordingly.
   - The major version of the compiler is extracted to handle specific feature support, such as AVX512.

2. **Feature Detection and Definition**:
   - The `map-define` function is used to define preprocessor flags based on the presence of certain features in the compiler's predefined macros. This includes features like `FD_HAS_SHANI`, `FD_HAS_INT128`, `FD_HAS_SSE`, `FD_HAS_AVX`, `FD_HAS_GFNI`, `FD_HAS_AESNI`, and `FD_IS_X86_64`.
   - The script conditionally enables or disables AVX512 support based on the compiler version, specifically disabling it for GCC versions less than 10.

3. **Build Configuration**:
   - The `BUILDDIR` variable is set to a directory path that includes the compiler name, indicating where the build artifacts will be stored.
   - Compiler flags (`CPPFLAGS`, `RUSTFLAGS`) are set to optimize for the native architecture.

4. **Conditional Inclusions**:
   - Additional configuration files are included based on detected features, such as threading support (`with-threads.mk`) and architecture-specific optimizations (`with-x86-64.mk`).

5. **Informational Output**:
   - The script outputs information about the enabled features, such as SSE, AVX, AVX512, GFNI, SHANI, and AESNI, to inform the user of the build configuration.

This Makefile script is essential for configuring the build environment to leverage specific compiler and hardware capabilities, ensuring optimized performance for the software project.

---
Made with ❤️ by [Driver](https://www.driver.ai/)