# Purpose
The provided code is a C header file, `pb_decode.h`, which is part of a library designed to decode Protocol Buffers (protobuf) messages. This file defines the interface for decoding operations, relying on the implementation details found in a corresponding source file, `pb_decode.c`. The primary function of this header is to declare the structures and functions necessary for decoding protobuf messages into C structures, using the field descriptions generated by `nanopb_generator.py`. The file includes definitions for creating and managing input streams, which are essential for reading data from various sources such as files or network sockets. It also provides several decoding functions, including [`pb_decode`](#pb_decode) and [`pb_decode_ex`](#pb_decode_ex), which handle the conversion of serialized protobuf data into usable C structures, with options for handling different message formats and initialization behaviors.

The header file also defines several utility functions and macros to facilitate the decoding process, such as functions for reading from streams, handling different data types, and managing memory for dynamically allocated fields. It includes mechanisms for error handling and stream manipulation, allowing for robust and flexible decoding operations. The file is structured to support both standard and extended decoding operations, with backward compatibility for older versions of the library. Additionally, it provides a C++ compatibility layer, allowing the functions to be used in C++ projects. Overall, `pb_decode.h` serves as a comprehensive interface for decoding protobuf messages, offering a range of functionalities to accommodate various use cases and integration scenarios.
# Imports and Dependencies

---
- `pb_firedancer.h`


# Data Structures

---
### pb\_istream\_s
- **Type**: `struct`
- **Members**:
    - `callback`: A function pointer used to read bytes from a storage medium, or an int pointer in buffer-only configuration.
    - `state`: A void pointer used by the callback function to store custom data.
    - `bytes_left`: A size_t value indicating the maximum number of bytes remaining in the stream.
    - `errmsg`: A constant character pointer to a string that holds an error message when decoding fails.
- **Description**: The `pb_istream_s` structure is designed to define custom input streams for decoding protocol buffers. It includes a callback function pointer for reading bytes from a storage medium, a state pointer for storing custom data used by the callback, and a bytes_left field to track the remaining bytes in the stream. The structure also optionally includes an errmsg field for error reporting. This structure is essential for handling input streams that may come from various sources such as files or network sockets, and it provides mechanisms to manage stream state and error handling during the decoding process.


# Function Declarations (Public API)

---
### pb\_istream\_from\_buffer<!-- {{#callable_declaration:pb_istream_from_buffer}} -->
Create an input stream for reading from a memory buffer.
- **Description**: This function initializes a `pb_istream_t` structure for reading protocol buffer data from a given memory buffer. It is typically used when you have a message stored in memory and you want to decode it using the nanopb library. The function sets up the stream to read up to `msglen` bytes from the buffer, ensuring that the stream does not read beyond the specified length. This is useful for safely decoding messages without risking buffer overflows. The function should be called before any decoding operations that require an input stream.
- **Inputs**:
    - `buf`: A pointer to the buffer containing the protocol buffer data. The buffer must be valid and contain at least `msglen` bytes. The caller retains ownership of the buffer, and it must remain valid for the duration of the stream's use.
    - `msglen`: The length of the message in bytes. It specifies how many bytes from the buffer should be read by the stream. Must be a non-negative value and should not exceed the actual size of the buffer.
- **Output**: Returns a `pb_istream_t` structure initialized to read from the specified buffer up to the given length.
- **See also**: [`pb_istream_from_buffer`](pb_decode.c.driver.md#pb_istream_from_buffer)  (Implementation)


---
### pb\_decode\_bool<!-- {{#callable_declaration:pb_decode_bool}} -->
Decode a boolean value from a protocol buffer input stream.
- **Description**: Use this function to decode a boolean value from a protocol buffer input stream, storing the result in a provided boolean variable. It is essential to ensure that the input stream is properly initialized and contains a valid varint-encoded boolean value. The function will return false if the decoding process fails, which can occur if the stream does not contain a valid varint or if there is an I/O error. This function is typically used in the context of decoding protocol buffer messages where boolean fields are present.
- **Inputs**:
    - `stream`: A pointer to a pb_istream_t structure representing the input stream from which the boolean value is to be decoded. The stream must be properly initialized and must not be null.
    - `dest`: A pointer to a boolean variable where the decoded value will be stored. The pointer must not be null, and the caller retains ownership of the memory.
- **Output**: Returns true if the boolean value is successfully decoded and stored in the destination variable; returns false if decoding fails.
- **See also**: [`pb_decode_bool`](pb_decode.c.driver.md#pb_decode_bool)  (Implementation)


---
### pb\_decode\_svarint<!-- {{#callable_declaration:pb_decode_svarint}} -->
Decode a signed varint from the input stream.
- **Description**: This function decodes a signed varint from the provided input stream and stores the result in the destination variable. It should be used when you need to decode a signed integer that has been encoded using the zig-zag encoding scheme, which is common in protocol buffers for efficiently encoding negative numbers. The function returns true if the decoding is successful and false if it fails, such as when the input stream does not contain a valid varint. Ensure that the input stream is properly initialized and contains enough data to decode a varint before calling this function.
- **Inputs**:
    - `stream`: A pointer to a pb_istream_t structure representing the input stream from which the varint is to be decoded. The stream must be properly initialized and must not be null. The function will return false if the stream does not contain a valid varint.
    - `dest`: A pointer to a pb_int64_t variable where the decoded signed varint will be stored. This pointer must not be null, and the caller retains ownership of the memory.
- **Output**: Returns true if the signed varint is successfully decoded and stored in the destination variable; otherwise, returns false.
- **See also**: [`pb_decode_svarint`](pb_decode.c.driver.md#pb_decode_svarint)  (Implementation)


---
### pb\_decode\_fixed32<!-- {{#callable_declaration:pb_decode_fixed32}} -->
Decode a fixed32, sfixed32, or float value from the input stream.
- **Description**: Use this function to decode a 32-bit fixed-width value from a protocol buffer input stream into a provided destination. It is essential to ensure that the input stream is properly initialized and contains at least 4 bytes available for reading. The destination must be a pointer to a 4-byte wide C variable, such as a uint32_t. The function returns false if reading from the stream fails, indicating an error in the input stream or insufficient data.
- **Inputs**:
    - `stream`: A pointer to a pb_istream_t structure representing the input stream. It must be properly initialized and have at least 4 bytes available for reading. The caller retains ownership.
    - `dest`: A pointer to a 4-byte wide C variable where the decoded value will be stored. This must not be null, and the caller retains ownership.
- **Output**: Returns true if the value is successfully decoded and stored in the destination; otherwise, returns false if reading from the stream fails.
- **See also**: [`pb_decode_fixed32`](pb_decode.c.driver.md#pb_decode_fixed32)  (Implementation)


---
### pb\_decode\_fixed64<!-- {{#callable_declaration:pb_decode_fixed64}} -->
Decode a fixed64, sfixed64, or double value from the input stream.
- **Description**: Use this function to decode a 64-bit fixed-point or double precision floating-point value from a protocol buffer input stream into a destination variable. It is essential to ensure that the input stream is properly initialized and contains at least 8 bytes of data to read. The function returns a boolean indicating success or failure, where failure typically results from an inability to read the required number of bytes from the stream. This function is useful when working with protocol buffers that include 64-bit fixed-point or double values.
- **Inputs**:
    - `stream`: A pointer to a pb_istream_t structure representing the input stream from which the data is read. The stream must be properly initialized and must not be null. The function will fail if the stream does not have at least 8 bytes available to read.
    - `dest`: A pointer to a memory location where the decoded 64-bit value will be stored. This must be a valid pointer to an 8-byte wide C variable, and it must not be null. The caller retains ownership of the memory pointed to by this parameter.
- **Output**: Returns a boolean value: true if the decoding is successful, false if it fails (e.g., due to insufficient data in the stream).
- **See also**: [`pb_decode_fixed64`](pb_decode.c.driver.md#pb_decode_fixed64)  (Implementation)


---
### pb\_decode\_double\_as\_float<!-- {{#callable_declaration:pb_decode_double_as_float}} -->
Decode a double value from the input stream and store it as a float.
- **Description**: This function reads a double-precision floating-point value from the provided input stream and converts it to a single-precision floating-point value, storing the result in the location pointed to by `dest`. It is useful when you need to handle double values in environments where only float precision is required or supported. The function must be called with a valid input stream and a non-null destination pointer. It returns false if the decoding fails, which can occur due to stream errors or if the input value is not representable as a float.
- **Inputs**:
    - `stream`: A pointer to a `pb_istream_t` structure representing the input stream from which the double value is to be read. The stream must be properly initialized and must not be null.
    - `dest`: A pointer to a float where the decoded value will be stored. This pointer must not be null, and the caller retains ownership of the memory.
- **Output**: Returns true if the double value was successfully decoded and converted to a float; otherwise, returns false.
- **See also**: [`pb_decode_double_as_float`](pb_decode.c.driver.md#pb_decode_double_as_float)  (Implementation)


