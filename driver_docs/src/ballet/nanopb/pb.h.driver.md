# Purpose
This C header file is a core component of the nanopb library, which is a lightweight implementation of Protocol Buffers (protobuf) for embedded systems. The file defines low-level configurations, macros, and data structures that are essential for the operation of nanopb, focusing on the encoding and decoding of protobuf messages. It provides a set of compilation options that can be customized to suit different hardware and software environments, such as enabling dynamic memory allocation, handling unaligned memory access, and supporting various data types and field sizes. These options are crucial for optimizing the library's performance and memory usage on constrained devices.

The file includes definitions for data types, field types, and macros that facilitate the creation and manipulation of protobuf messages. It defines structures like `pb_msgdesc_t` and `pb_field_iter_t` that describe message fields and iterate over them, respectively. Additionally, it provides mechanisms for handling different field types, repetition rules, and allocation types, which are used in the autogenerated code that nanopb produces from .proto files. The file also includes macros for static assertions to ensure compatibility and correctness of the compilation options. Overall, this header file serves as a foundational element of the nanopb library, enabling developers to efficiently encode and decode protobuf messages in resource-constrained environments.
# Imports and Dependencies

---
- `stdint.h`
- `stddef.h`
- `stdbool.h`
- `string.h`
- `limits.h`
- `stdlib.h`
- `avr/pgmspace.h`


# Data Structures

---
### pb\_istream\_t
- **Type**: `typedef struct pb_istream_s pb_istream_t;`
- **Description**: The `pb_istream_t` is a forward declaration of a structure used in the nanopb library, which is a small code-size Protocol Buffers implementation in C. This structure is likely used to represent an input stream for reading serialized data, although the specific fields and methods are not defined in the provided code. The actual definition of `pb_istream_t` would typically include members for managing the state of the input stream, such as pointers to the data buffer, current position, and possibly function pointers for custom stream handling.


---
### pb\_ostream\_t
- **Type**: `typedef struct pb_ostream_s pb_ostream_t;`
- **Members**:
    - `pb_ostream_s`: A forward declaration for the structure used to define the output stream in the nanopb library.
- **Description**: The `pb_ostream_t` is a typedef for a structure used in the nanopb library to represent an output stream. This structure is essential for encoding data into a protocol buffer format, allowing data to be serialized and written to a stream. The actual definition of `pb_ostream_s` is not provided in the given code, indicating that it is likely defined elsewhere in the nanopb library. This abstraction allows for flexibility in handling different types of output streams, such as memory buffers or custom streams, depending on the configuration and needs of the application.


---
### pb\_field\_iter\_t
- **Type**: `struct`
- **Members**:
    - `descriptor`: Pointer to the message descriptor constant.
    - `message`: Pointer to the start of the structure being iterated.
    - `index`: Index of the current field in the message.
    - `field_info_index`: Index to the descriptor's field_info array.
    - `required_field_index`: Index that counts only the required fields.
    - `submessage_index`: Index that counts only submessages.
    - `tag`: Tag of the current field.
    - `data_size`: Size of a single item in the current field.
    - `array_size`: Number of entries in the current array field.
    - `type`: Type of the current field.
    - `pField`: Pointer to the current field in the structure.
    - `pData`: Pointer to the current data contents, different from pField for arrays and pointers.
    - `pSize`: Pointer to the count/has field for the current field.
    - `submsg_desc`: Pointer to the field descriptor for submessage fields.
- **Description**: The `pb_field_iter_t` structure is an iterator used in the nanopb library to traverse through the fields of a protocol buffer message. It holds pointers and indices that allow it to navigate the message's structure, including its fields, submessages, and associated metadata. This iterator is essential for encoding and decoding operations, as it provides access to each field's type, size, and data within the message.


---
### pb\_msgdesc\_t
- **Type**: `struct`
- **Members**:
    - `field_info`: A pointer to an array of uint32_t that contains field information for the message.
    - `submsg_info`: A pointer to an array of pointers to pb_msgdesc_t, representing submessage descriptors.
    - `default_value`: A pointer to a pb_byte_t array that holds the default values for the fields.
    - `field_callback`: A function pointer for a callback function that handles field operations during encoding or decoding.
    - `field_count`: A pb_size_t value indicating the total number of fields in the message.
    - `required_field_count`: A pb_size_t value indicating the number of required fields in the message.
    - `largest_tag`: A pb_size_t value representing the largest tag number used in the message.
- **Description**: The `pb_msgdesc_t` structure is a descriptor for a protocol buffer message in the nanopb library, containing metadata about the fields within a message. It includes pointers to field information, submessage descriptors, and default values, as well as a callback function for field operations. Additionally, it tracks the total number of fields, the number of required fields, and the largest tag number used, facilitating the encoding and decoding processes of protocol buffer messages.


---
### pb\_msgdesc\_s
- **Type**: `struct`
- **Members**:
    - `field_info`: Pointer to an array of field information for the message.
    - `submsg_info`: Pointer to an array of submessage descriptors.
    - `default_value`: Pointer to the default value for the message fields.
    - `field_callback`: Function pointer for a callback to handle field operations during encoding/decoding.
    - `field_count`: Total number of fields in the message.
    - `required_field_count`: Number of required fields in the message.
    - `largest_tag`: The largest tag number used in the message fields.
- **Description**: The `pb_msgdesc_s` structure is a descriptor for a protocol buffer message in the nanopb library. It contains metadata about the fields of a message, including pointers to field information, submessage descriptors, and default values. It also includes a callback function for handling field operations during encoding and decoding processes. The structure tracks the total number of fields, the number of required fields, and the largest tag number used, facilitating efficient message processing and validation.


---
### pb\_field\_iter\_s
- **Type**: `struct`
- **Members**:
    - `descriptor`: Pointer to message descriptor constant.
    - `message`: Pointer to start of the structure.
    - `index`: Index of the field.
    - `field_info_index`: Index to descriptor->field_info array.
    - `required_field_index`: Index that counts only the required fields.
    - `submessage_index`: Index that counts only submessages.
    - `tag`: Tag of current field.
    - `data_size`: Size of a single item.
    - `array_size`: Number of array entries.
    - `type`: Type of current field.
    - `pField`: Pointer to current field in struct.
    - `pData`: Pointer to current data contents, different than pField for arrays and pointers.
    - `pSize`: Pointer to count/has field.
    - `submsg_desc`: For submessage fields, pointer to field descriptor for the submessage.
- **Description**: The `pb_field_iter_s` structure is an iterator used in the nanopb library to traverse through the fields of a protocol buffer message. It holds various indices and pointers that help in identifying and accessing the fields within a message, including their types, sizes, and descriptors. This structure is essential for iterating over fields, especially when dealing with complex messages that include arrays and submessages, allowing for efficient encoding and decoding operations.


---
### pb\_bytes\_array\_s
- **Type**: `struct`
- **Members**:
    - `size`: Stores the number of bytes in the array.
    - `bytes`: An array of bytes with a flexible size, starting with a single byte.
- **Description**: The `pb_bytes_array_s` structure is used to represent a byte array in the nanopb library, which is a lightweight protocol buffers implementation. It contains a `size` field to indicate the number of bytes in the array, and a `bytes` field which is a flexible array member that starts with a single byte but can be extended to accommodate more bytes as needed. This structure is typically used for handling byte arrays in protocol buffer messages, allowing for efficient serialization and deserialization of binary data.


---
### pb\_bytes\_array\_t
- **Type**: `struct`
- **Members**:
    - `size`: Stores the number of bytes in the array.
    - `bytes`: An array of bytes with a flexible length, starting with a single byte.
- **Description**: The `pb_bytes_array_t` structure is used to represent a byte array in the nanopb library, which is a lightweight protocol buffers implementation. It contains a `size` field that indicates the number of bytes in the array, followed by a `bytes` array that holds the actual byte data. The `bytes` array is defined with a flexible length, allowing it to be dynamically allocated to fit the required number of bytes. This structure is typically used for handling 'bytes' fields in protocol buffer messages, where the length of the data can vary.


---
### pb\_callback\_t
- **Type**: `struct`
- **Members**:
    - `funcs`: A union containing function pointers for decode and encode callbacks.
    - `arg`: A void pointer for user-defined data to be used by the callback functions.
- **Description**: The `pb_callback_t` structure is part of the nanopb library and is used to define callback functions for encoding and decoding operations in Protocol Buffers. It contains a union of function pointers, `funcs`, which can point to either a decode or encode function, and a void pointer, `arg`, which can be used to pass user-defined data to these functions. This structure allows for custom handling of fields during the serialization and deserialization processes, providing flexibility in how data is processed.


---
### pb\_callback\_s
- **Type**: `struct`
- **Members**:
    - `funcs`: A union containing function pointers for decode and encode callbacks.
    - `arg`: A void pointer used as an argument for the callback functions.
- **Description**: The `pb_callback_s` structure is designed to facilitate callback mechanisms for encoding and decoding operations in the nanopb library. It contains a union of function pointers, allowing either a decode or encode function to be specified, and a void pointer `arg` that can be used to pass additional data to these callback functions. This structure is integral to handling custom serialization and deserialization logic in nanopb, providing flexibility for users to define how specific fields are processed during these operations.


---
### pb\_wire\_type\_t
- **Type**: `enum`
- **Members**:
    - `PB_WT_VARINT`: Represents a variable-length integer wire type with a value of 0.
    - `PB_WT_64BIT`: Represents a 64-bit wire type with a value of 1.
    - `PB_WT_STRING`: Represents a length-delimited string wire type with a value of 2.
    - `PB_WT_32BIT`: Represents a 32-bit wire type with a value of 5.
    - `PB_WT_PACKED`: An internal marker for packed arrays with a value of 255.
- **Description**: The `pb_wire_type_t` is an enumeration that defines the different wire types used in the nanopb library for encoding protocol buffer messages. Each wire type corresponds to a specific way of encoding data, such as variable-length integers, fixed-size integers, or length-delimited strings. The enumeration also includes an internal marker for packed arrays, which is used internally by the library to handle packed repeated fields.


---
### pb\_extension\_type\_t
- **Type**: `struct`
- **Members**:
    - `decode`: A function pointer for decoding unknown fields in a message.
    - `encode`: A function pointer for encoding unknown fields after regular fields.
    - `arg`: A constant void pointer for use by the callback functions.
- **Description**: The `pb_extension_type_t` structure is used to define the handling of unknown or extension fields in a protocol buffer message. It contains function pointers for decoding and encoding these fields, allowing custom handling of fields that are not part of the standard message definition. The `arg` member provides a way to pass additional data to these callback functions. This structure is typically auto-generated, but can be customized for specific use cases, such as catching all unknown fields.


---
### pb\_extension\_t
- **Type**: `struct`
- **Members**:
    - `type`: A pointer to a pb_extension_type_t structure that describes the extension field.
    - `dest`: A pointer to the destination where the decoded data will be stored, matching the datatype of the extension field.
    - `next`: A pointer to the next pb_extension_t handler, or NULL if there is no next handler.
    - `found`: A boolean flag set to true by the decoder if the extension was found, ignored during encoding.
- **Description**: The `pb_extension_t` structure is used in the nanopb library to handle extension fields in Protocol Buffers. It allows for the dynamic handling of fields that are not known at compile time, providing a mechanism to decode and encode unknown fields. The structure contains a type descriptor, a destination for decoded data, a pointer to the next extension handler, and a flag indicating whether the extension was found during decoding. This setup enables the chaining of multiple extension handlers, allowing for flexible and extensible message processing.


---
### pb\_extension\_type\_s
- **Type**: `struct`
- **Members**:
    - `decode`: A function pointer for handling unknown fields during message decoding.
    - `encode`: A function pointer for handling additional data after regular fields have been encoded.
    - `arg`: A constant void pointer for use by the callback functions.
- **Description**: The `pb_extension_type_s` structure is part of the nanopb library and is used to define how unknown or extension fields in a protocol buffer message are handled. It contains function pointers for decoding and encoding these fields, allowing custom handling of unknown fields during message processing. The `arg` member provides a way to pass additional data to the callback functions, enabling more flexible and context-aware processing.


---
### pb\_extension\_s
- **Type**: `struct`
- **Members**:
    - `type`: A pointer to a pb_extension_type_t structure that describes the extension field.
    - `dest`: A pointer to the destination where the decoded data will be stored, matching the datatype of the extension field.
    - `next`: A pointer to the next pb_extension_t handler, or NULL if there is no next handler.
    - `found`: A boolean flag set to true by the decoder if the extension was found, ignored during encoding.
- **Description**: The `pb_extension_s` structure is part of the nanopb library and is used to handle extension fields in Protocol Buffers. It allows for the dynamic handling of fields that are not known at compile time by linking to a type descriptor and providing a destination for decoded data. The structure supports chaining of multiple extension handlers through the `next` pointer, enabling a sequence of handlers to be processed. The `found` flag indicates whether the extension was successfully located during decoding, providing a mechanism to verify the presence of optional extensions.


# Function Declarations (Public API)

---
### pb\_default\_field\_callback<!-- {{#callable_declaration:pb_default_field_callback}} -->
Handles field callbacks for encoding or decoding in nanopb.
- **Description**: This function is used to handle field callbacks during the encoding or decoding process in nanopb. It should be called when a field with a callback is encountered. The function checks if the field's data size matches the expected size for a callback and if the callback is not null. Depending on whether an input stream or output stream is provided, it will attempt to call the appropriate decode or encode function from the callback. If neither stream is provided or the callback functions are null, the function returns true, indicating success without performing any operation. This function is typically used within the nanopb library's encoding and decoding processes.
- **Inputs**:
    - `istream`: A pointer to a pb_istream_t structure representing the input stream for decoding. Can be null if not decoding.
    - `ostream`: A pointer to a pb_ostream_t structure representing the output stream for encoding. Can be null if not encoding.
    - `field`: A pointer to a pb_field_t structure representing the field being processed. Must not be null and should have a data size matching sizeof(pb_callback_t).
- **Output**: Returns a boolean value: true if the operation was successful or if no operation was performed, false if an error occurred during callback execution.
- **See also**: [`pb_default_field_callback`](pb_common.c.driver.md#pb_default_field_callback)  (Implementation)


