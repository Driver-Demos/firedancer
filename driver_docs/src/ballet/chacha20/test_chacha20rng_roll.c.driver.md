# Purpose
This C source code file is an executable program designed to test and demonstrate the functionality of a ChaCha20-based random number generator (RNG). The program includes several test functions that validate the RNG's output against expected values, which are derived from a Rust implementation of the ChaCha20 RNG. The main function of the program processes command-line arguments to configure the RNG's range, count, and key, and then performs a series of RNG rolls, logging debug information as it executes. The program is structured to ensure that the RNG behaves consistently with the Rust implementation, providing a reliable cross-language validation of the RNG's correctness.

The code is organized into several key components: a usage function that provides command-line instructions, test functions that compare the RNG's output to pre-determined values, and the main function that orchestrates the program's execution. The test functions, such as [`test_matches_rust_sample_single`](#test_matches_rust_sample_single) and [`test_matches_rust_sample`](#test_matches_rust_sample), are crucial for verifying the RNG's accuracy by comparing its output to known results generated by a Rust program. The main function initializes the RNG with parameters specified by the user, performs the RNG operations, and ensures proper cleanup of resources. This file is primarily focused on testing and validating the RNG's functionality rather than providing a broad API or library for external use.
# Imports and Dependencies

---
- `stdio.h`
- `fd_chacha20rng.h`


# Functions

---
### usage<!-- {{#callable:usage}} -->
The `usage` function prints the usage instructions for the `test_chacha20rng_roll` program to the standard error stream and returns an error code.
- **Inputs**: None
- **Control Flow**:
    - The function calls `fprintf` to print a multi-line usage message to the `stderr` stream.
    - The message includes the command syntax and descriptions of the command-line options `--range`, `--count`, and `--key`.
    - The function returns the integer `1` to indicate an error or help request.
- **Output**: The function returns an integer value `1`, indicating an error or help request.


---
### test\_matches\_rust\_sample\_single<!-- {{#callable:test_matches_rust_sample_single}} -->
The function `test_matches_rust_sample_single` tests the ChaCha20 random number generator implementation against a known sequence generated by a Rust program.
- **Inputs**: None
- **Control Flow**:
    - Initialize a ChaCha20 RNG instance with a specific mode and join it.
    - Set up a 32-byte key with all bytes set to 0x41 and initialize the RNG with this key.
    - Perform a series of tests using [`fd_chacha20rng_ulong_roll`](fd_chacha20rng.h.driver.md#fd_chacha20rng_ulong_roll) to generate random numbers within specified ranges and compare them against expected values derived from a Rust program.
    - Verify that the RNG produces the expected sequence of numbers for two different ranges: 0 to 10 and 0 to 4294967231.
    - Clean up by leaving and deleting the RNG instance, ensuring it matches the original memory location.
- **Output**: The function does not return any value; it performs tests and asserts correctness using `FD_TEST` macros.
- **Functions called**:
    - [`fd_chacha20rng_join`](fd_chacha20rng.c.driver.md#fd_chacha20rng_join)
    - [`fd_chacha20rng_new`](fd_chacha20rng.c.driver.md#fd_chacha20rng_new)
    - [`fd_chacha20rng_init`](fd_chacha20rng.c.driver.md#fd_chacha20rng_init)
    - [`fd_chacha20rng_ulong_roll`](fd_chacha20rng.h.driver.md#fd_chacha20rng_ulong_roll)
    - [`fd_chacha20rng_delete`](fd_chacha20rng.c.driver.md#fd_chacha20rng_delete)
    - [`fd_chacha20rng_leave`](fd_chacha20rng.c.driver.md#fd_chacha20rng_leave)


---
### test\_matches\_rust\_sample<!-- {{#callable:test_matches_rust_sample}} -->
The function `test_matches_rust_sample` tests the ChaCha20 random number generator implementation in C against a known output generated by a Rust program using the same seed and parameters.
- **Inputs**: None
- **Control Flow**:
    - Initialize a ChaCha20 RNG instance with a predefined mode and join it to a pointer.
    - Set a 32-byte key with all bytes set to 0x41 and initialize the RNG with this key.
    - Perform a series of tests using [`fd_chacha20rng_ulong_roll`](fd_chacha20rng.h.driver.md#fd_chacha20rng_ulong_roll) to generate random numbers within specified ranges and compare them against expected values derived from a Rust program.
    - Verify that the RNG instance can be properly deleted and its resources freed.
- **Output**: The function does not return any value; it performs tests and assertions to validate the RNG's output.
- **Functions called**:
    - [`fd_chacha20rng_join`](fd_chacha20rng.c.driver.md#fd_chacha20rng_join)
    - [`fd_chacha20rng_new`](fd_chacha20rng.c.driver.md#fd_chacha20rng_new)
    - [`fd_chacha20rng_init`](fd_chacha20rng.c.driver.md#fd_chacha20rng_init)
    - [`fd_chacha20rng_ulong_roll`](fd_chacha20rng.h.driver.md#fd_chacha20rng_ulong_roll)
    - [`fd_chacha20rng_delete`](fd_chacha20rng.c.driver.md#fd_chacha20rng_delete)
    - [`fd_chacha20rng_leave`](fd_chacha20rng.c.driver.md#fd_chacha20rng_leave)


---
### test\_iterated<!-- {{#callable:test_iterated}} -->
The `test_iterated` function tests the ChaCha20 random number generator by iteratively rolling a random number and updating a value, verifying the final result against an expected value.
- **Inputs**: None
- **Control Flow**:
    - Initialize a ChaCha20 RNG instance with a specific mode and join it.
    - Set a 32-byte key with all bytes set to 0x41 and initialize the RNG with this key.
    - Initialize a variable `n` to 100,000,000.
    - Iterate 1,000,000,000 times, updating `n` by rolling a random number in the range [0, n) using the RNG, multiplying the result by 3, and adding 3.
    - Check if the final value of `n` matches the expected value 10620388038139726539UL using an assertion.
- **Output**: The function does not return a value but asserts that the final computed value of `n` matches the expected result.
- **Functions called**:
    - [`fd_chacha20rng_join`](fd_chacha20rng.c.driver.md#fd_chacha20rng_join)
    - [`fd_chacha20rng_new`](fd_chacha20rng.c.driver.md#fd_chacha20rng_new)
    - [`fd_chacha20rng_init`](fd_chacha20rng.c.driver.md#fd_chacha20rng_init)
    - [`fd_chacha20rng_ulong_roll`](fd_chacha20rng.h.driver.md#fd_chacha20rng_ulong_roll)


---
### main<!-- {{#callable:main}} -->
The `main` function initializes a ChaCha20 random number generator, runs built-in tests, processes command-line arguments, and performs a specified number of random number rolls within a given range using a key derived from the command-line input.
- **Inputs**:
    - `argc`: The number of command-line arguments passed to the program.
    - `argv`: An array of strings representing the command-line arguments.
- **Control Flow**:
    - Iterates over command-line arguments to check for the '--help' flag and calls `usage()` if found.
    - Initializes the environment using `fd_boot` and sets logging levels to debug.
    - Runs three test functions: [`test_matches_rust_sample_single`](#test_matches_rust_sample_single), [`test_matches_rust_sample`](#test_matches_rust_sample), and [`test_iterated`](#test_iterated) to verify RNG behavior.
    - Logs a notice indicating that built-in tests have passed.
    - Extracts `--range`, `--count`, and `--key` parameters from the command-line arguments using `fd_env_strip_cmdline_ulong`.
    - Checks if `--range` or `--count` are zero and calls `usage()` if true.
    - Initializes a ChaCha20 RNG with a key derived from the `--key` parameter.
    - Performs `--count` number of random number rolls within the `--range` using the initialized RNG.
    - Cleans up the RNG resources and halts the program.
- **Output**: Returns 0 on successful execution, or 1 if the usage information is displayed due to incorrect input.
- **Functions called**:
    - [`usage`](#usage)
    - [`test_matches_rust_sample_single`](#test_matches_rust_sample_single)
    - [`test_matches_rust_sample`](#test_matches_rust_sample)
    - [`test_iterated`](#test_iterated)
    - [`fd_chacha20rng_join`](fd_chacha20rng.c.driver.md#fd_chacha20rng_join)
    - [`fd_chacha20rng_new`](fd_chacha20rng.c.driver.md#fd_chacha20rng_new)
    - [`fd_chacha20rng_init`](fd_chacha20rng.c.driver.md#fd_chacha20rng_init)
    - [`fd_chacha20rng_ulong_roll`](fd_chacha20rng.h.driver.md#fd_chacha20rng_ulong_roll)
    - [`fd_chacha20rng_delete`](fd_chacha20rng.c.driver.md#fd_chacha20rng_delete)
    - [`fd_chacha20rng_leave`](fd_chacha20rng.c.driver.md#fd_chacha20rng_leave)


