# Purpose
This C source code file is an implementation of arithmetic operations for the Poly1305 cryptographic function, specifically tailored for a 64-bit architecture. The code is auto-generated and provides a set of functions to perform operations such as addition, subtraction, multiplication, squaring, and conditional selection on field elements, which are represented as arrays of 64-bit unsigned integers. The operations are designed to work within the finite field defined by the prime \(2^{130} - 5\), which is characteristic of the Poly1305 algorithm used in cryptographic applications for message authentication.

The file defines several key types and functions, including `fiat_poly1305_loose_field_element` and `fiat_poly1305_tight_field_element` for representing field elements with loose and tight bounds, respectively. Functions like [`fiat_poly1305_addcarryx_u44`](#fiat_poly1305_addcarryx_u44) and [`fiat_poly1305_subborrowx_u44`](#fiat_poly1305_subborrowx_u44) handle addition and subtraction with carry and borrow, while [`fiat_poly1305_carry_mul`](#fiat_poly1305_carry_mul) and [`fiat_poly1305_carry_square`](#fiat_poly1305_carry_square) perform multiplication and squaring with reduction. The code also includes serialization and deserialization functions ([`fiat_poly1305_to_bytes`](#fiat_poly1305_to_bytes) and [`fiat_poly1305_from_bytes`](#fiat_poly1305_from_bytes)) for converting field elements to and from byte arrays. This implementation is intended to be used as a library, providing low-level operations for higher-level cryptographic protocols that utilize the Poly1305 algorithm.
# Imports and Dependencies

---
- `stdint.h`


# Global Variables

---
### fiat\_poly1305\_int128
- **Type**: `typedef signed __int128`
- **Description**: The `fiat_poly1305_int128` is a typedef for a signed 128-bit integer type, utilizing the `__int128` type available in GCC and Clang compilers. This type is used to represent large integers that require more than the standard 64-bit integer size.
- **Use**: This variable is used in arithmetic operations within the Poly1305 cryptographic algorithm to handle large integer calculations.


---
### fiat\_poly1305\_uint128
- **Type**: `unsigned __int128`
- **Description**: The `fiat_poly1305_uint128` is a typedef for an unsigned 128-bit integer type, which is an extension provided by some compilers like GCC and Clang. This type is used to represent large integers that require more than the standard 64-bit integer size.
- **Use**: This variable is used in arithmetic operations within the Poly1305 cryptographic algorithm to handle large integer calculations.


# Functions

---
### fiat\_poly1305\_value\_barrier\_u64<!-- {{#callable:fiat_poly1305_value_barrier_u64}} -->
The function `fiat_poly1305_value_barrier_u64` acts as a compiler barrier to prevent certain optimizations on a 64-bit unsigned integer.
- **Inputs**:
    - `a`: A 64-bit unsigned integer that is passed to the function.
- **Control Flow**:
    - The function uses an inline assembly statement with an empty string to act as a barrier, preventing the compiler from optimizing away the variable 'a'.
    - The assembly statement specifies 'a' as a read-write operand, ensuring that 'a' is treated as being used and modified, even though no actual operation is performed.
    - The function then returns the value of 'a'.
- **Output**: The function returns the same 64-bit unsigned integer that was passed as input.


---
### fiat\_poly1305\_addcarryx\_u44<!-- {{#callable:fiat_poly1305_addcarryx_u44}} -->
The function `fiat_poly1305_addcarryx_u44` performs an addition of three numbers with a carry, and outputs the result modulo 2^44 and the carry bit.
- **Inputs**:
    - `out1`: A pointer to a uint64_t where the result of the addition modulo 2^44 will be stored.
    - `out2`: A pointer to a fiat_poly1305_uint1 where the carry bit resulting from the addition will be stored.
    - `arg1`: A fiat_poly1305_uint1 representing the first addend, which is a carry bit from a previous operation.
    - `arg2`: A uint64_t representing the second addend, which is a 44-bit number.
    - `arg3`: A uint64_t representing the third addend, which is also a 44-bit number.
- **Control Flow**:
    - Calculate the sum of `arg1`, `arg2`, and `arg3` and store it in `x1`.
    - Compute `x2` as `x1` modulo 2^44, which is done by bitwise AND with `0xfffffffffff`.
    - Compute `x3` as the carry bit by right-shifting `x1` by 44 bits.
    - Store `x2` in the location pointed to by `out1`.
    - Store `x3` in the location pointed to by `out2`.
- **Output**: The function outputs the result of the addition modulo 2^44 in `out1` and the carry bit in `out2`.


---
### fiat\_poly1305\_subborrowx\_u44<!-- {{#callable:fiat_poly1305_subborrowx_u44}} -->
The function `fiat_poly1305_subborrowx_u44` performs a subtraction with borrow on 44-bit integers.
- **Inputs**:
    - `out1`: A pointer to a 64-bit unsigned integer where the result of the subtraction will be stored.
    - `out2`: A pointer to a fiat_poly1305_uint1 where the borrow flag will be stored.
    - `arg1`: A fiat_poly1305_uint1 representing the initial borrow (0 or 1).
    - `arg2`: A 64-bit unsigned integer representing the minuend.
    - `arg3`: A 64-bit unsigned integer representing the subtrahend.
- **Control Flow**:
    - Calculate the intermediate result `x1` by subtracting `arg1` and `arg3` from `arg2` and cast it to a signed 64-bit integer.
    - Determine the borrow `x2` by right-shifting `x1` by 44 bits and casting it to a fiat_poly1305_int1.
    - Mask `x1` with `0xfffffffffff` to get the lower 44 bits and store it in `x3`.
    - Store `x3` in the location pointed to by `out1`.
    - Calculate the final borrow flag by subtracting `x2` from 0 and store it in the location pointed to by `out2`.
- **Output**: The function outputs the result of the subtraction in `out1` and the borrow flag in `out2`.


---
### fiat\_poly1305\_addcarryx\_u43<!-- {{#callable:fiat_poly1305_addcarryx_u43}} -->
The function `fiat_poly1305_addcarryx_u43` performs an addition of three numbers with a carry, reducing the result modulo 2^43 and providing the carry as a separate output.
- **Inputs**:
    - `out1`: A pointer to a uint64_t where the result of the addition modulo 2^43 will be stored.
    - `out2`: A pointer to a fiat_poly1305_uint1 where the carry resulting from the addition will be stored.
    - `arg1`: A fiat_poly1305_uint1 representing the first addend, which is either 0 or 1.
    - `arg2`: A uint64_t representing the second addend, which is a 43-bit number.
    - `arg3`: A uint64_t representing the third addend, which is a 43-bit number.
- **Control Flow**:
    - Calculate the sum of `arg1`, `arg2`, and `arg3` and store it in `x1`.
    - Compute `x2` as `x1` modulo 2^43, which is done by bitwise AND with `0x7ffffffffff`.
    - Compute `x3` as the carry by right-shifting `x1` by 43 bits.
    - Store `x2` in the location pointed to by `out1`.
    - Store `x3` in the location pointed to by `out2`.
- **Output**: The function outputs the result of the addition modulo 2^43 in `out1` and the carry in `out2`.


---
### fiat\_poly1305\_subborrowx\_u43<!-- {{#callable:fiat_poly1305_subborrowx_u43}} -->
The function `fiat_poly1305_subborrowx_u43` performs a subtraction with borrow on three inputs, producing a result modulo 2^43 and a borrow indicator.
- **Inputs**:
    - `out1`: A pointer to a uint64_t where the result of the subtraction will be stored.
    - `out2`: A pointer to a fiat_poly1305_uint1 where the borrow indicator will be stored.
    - `arg1`: A fiat_poly1305_uint1 representing the initial borrow value.
    - `arg2`: A uint64_t representing the minuend.
    - `arg3`: A uint64_t representing the subtrahend.
- **Control Flow**:
    - Calculate the intermediate result `x1` by subtracting `arg1` and `arg3` from `arg2`, casting to int64_t to handle potential negative values.
    - Compute the borrow `x2` by right-shifting `x1` by 43 bits, indicating if a borrow occurred.
    - Mask `x1` with `0x7ffffffffff` to get the result modulo 2^43, storing it in `x3`.
    - Store `x3` in the location pointed to by `out1`.
    - Store the negated value of `x2` in the location pointed to by `out2`, indicating the borrow status.
- **Output**: The function outputs the result of the subtraction modulo 2^43 in `out1` and a borrow indicator in `out2`.


---
### fiat\_poly1305\_cmovznz\_u64<!-- {{#callable:fiat_poly1305_cmovznz_u64}} -->
The function `fiat_poly1305_cmovznz_u64` performs a conditional move operation on two 64-bit integers based on a single-bit condition.
- **Inputs**:
    - `out1`: A pointer to a 64-bit unsigned integer where the result will be stored.
    - `arg1`: A single-bit unsigned integer (fiat_poly1305_uint1) that acts as the condition for the move operation.
    - `arg2`: A 64-bit unsigned integer that is selected if arg1 is 0.
    - `arg3`: A 64-bit unsigned integer that is selected if arg1 is 1.
- **Control Flow**:
    - The function first evaluates the condition `arg1` to determine if it is non-zero, storing the result in `x1`.
    - It calculates `x2` as the bitwise negation of `x1` subtracted from zero, effectively creating a mask of all 1s if `arg1` is non-zero, or all 0s if `arg1` is zero.
    - The function uses [`fiat_poly1305_value_barrier_u64`](#fiat_poly1305_value_barrier_u64) to apply a value barrier to `x2` and its negation, ensuring that the compiler does not optimize away the conditional logic.
    - It computes `x3` by performing a bitwise AND between `x2` and `arg3`, and between the negation of `x2` and `arg2`, then combines these results with a bitwise OR.
    - Finally, the result `x3` is stored in the location pointed to by `out1`.
- **Output**: The function outputs the value of either `arg2` or `arg3` into `out1`, depending on whether `arg1` is 0 or 1, respectively.
- **Functions called**:
    - [`fiat_poly1305_value_barrier_u64`](#fiat_poly1305_value_barrier_u64)


---
### fiat\_poly1305\_carry\_mul<!-- {{#callable:fiat_poly1305_carry_mul}} -->
The function `fiat_poly1305_carry_mul` multiplies two loose field elements and reduces the result to a tight field element in the context of the Poly1305 cryptographic algorithm.
- **Inputs**:
    - `out1`: A pointer to a `fiat_poly1305_tight_field_element` array where the result will be stored.
    - `arg1`: A `fiat_poly1305_loose_field_element` array representing the first operand.
    - `arg2`: A `fiat_poly1305_loose_field_element` array representing the second operand.
- **Control Flow**:
    - Initialize several `fiat_poly1305_uint128` variables to store intermediate multiplication results.
    - Compute the product of elements from `arg1` and `arg2`, applying specific multipliers (e.g., 0x5, 0xa) to certain terms to account for the field's structure.
    - Sum the computed products to form intermediate results `x10`, `x13`, and `x14`.
    - Perform bitwise shifts and masks to reduce these intermediate results, handling carries appropriately.
    - Combine the reduced results to form the final output, storing it in `out1`.
- **Output**: The function outputs a `fiat_poly1305_tight_field_element` array containing the reduced product of the input field elements.


---
### fiat\_poly1305\_carry\_square<!-- {{#callable:fiat_poly1305_carry_square}} -->
The function `fiat_poly1305_carry_square` computes the square of a field element and reduces the result modulo a specific prime.
- **Inputs**:
    - `out1`: A pointer to a `fiat_poly1305_tight_field_element` array where the result will be stored.
    - `arg1`: A constant pointer to a `fiat_poly1305_loose_field_element` array representing the input field element to be squared.
- **Control Flow**:
    - Calculate intermediate values by multiplying elements of `arg1` with constants and other elements, storing results in 128-bit integers.
    - Perform a series of additions and bitwise operations to combine these intermediate values, ensuring that the results fit within the required bit-widths.
    - Use bitwise shifts and masks to handle carries and reduce the result modulo the prime, ensuring the final result is within the bounds of a tight field element.
    - Store the reduced results in the `out1` array.
- **Output**: The function outputs the reduced square of the input field element in the `out1` array, which is a `fiat_poly1305_tight_field_element`.


---
### fiat\_poly1305\_carry<!-- {{#callable:fiat_poly1305_carry}} -->
The function `fiat_poly1305_carry` reduces a loose field element to a tight field element by performing a series of bitwise operations and modular reductions.
- **Inputs**:
    - `out1`: A pointer to a `fiat_poly1305_tight_field_element` array where the result will be stored.
    - `arg1`: A `fiat_poly1305_loose_field_element` array representing the input field element to be reduced.
- **Control Flow**:
    - Extract the first element of `arg1` into `x1`.
    - Calculate `x2` by right-shifting `x1` by 44 bits and adding the second element of `arg1`.
    - Calculate `x3` by right-shifting `x2` by 43 bits and adding the third element of `arg1`.
    - Calculate `x4` by masking `x1` with `0xfffffffffff` and adding the product of `x3` right-shifted by 43 bits and 5.
    - Calculate `x5` by right-shifting `x4` by 44 bits and adding the masked value of `x2` with `0x7ffffffffff`.
    - Mask `x4` with `0xfffffffffff` to get `x6`.
    - Mask `x5` with `0x7ffffffffff` to get `x7`.
    - Calculate `x8` by right-shifting `x5` by 43 bits and adding the masked value of `x3` with `0x7ffffffffff`.
    - Store `x6`, `x7`, and `x8` in `out1` as the reduced field element.
- **Output**: The function outputs a reduced `fiat_poly1305_tight_field_element` stored in `out1`.


---
### fiat\_poly1305\_add<!-- {{#callable:fiat_poly1305_add}} -->
The function `fiat_poly1305_add` adds two tight field elements and stores the result in a loose field element.
- **Inputs**:
    - `out1`: A fiat_poly1305_loose_field_element array of size 3 where the result of the addition will be stored.
    - `arg1`: A fiat_poly1305_tight_field_element array of size 3 representing the first operand in the addition.
    - `arg2`: A fiat_poly1305_tight_field_element array of size 3 representing the second operand in the addition.
- **Control Flow**:
    - Initialize three uint64_t variables x1, x2, and x3.
    - Compute the sum of the first elements of arg1 and arg2 and store it in x1.
    - Compute the sum of the second elements of arg1 and arg2 and store it in x2.
    - Compute the sum of the third elements of arg1 and arg2 and store it in x3.
    - Assign the values of x1, x2, and x3 to the corresponding elements of out1.
- **Output**: The function does not return a value; it modifies the out1 array in place to contain the sum of arg1 and arg2.


---
### fiat\_poly1305\_sub<!-- {{#callable:fiat_poly1305_sub}} -->
The function `fiat_poly1305_sub` performs subtraction of two tight field elements and stores the result in a loose field element.
- **Inputs**:
    - `out1`: A fiat_poly1305_loose_field_element array of size 3 where the result of the subtraction will be stored.
    - `arg1`: A fiat_poly1305_tight_field_element array of size 3 representing the minuend.
    - `arg2`: A fiat_poly1305_tight_field_element array of size 3 representing the subtrahend.
- **Control Flow**:
    - Initialize three uint64_t variables x1, x2, and x3.
    - Compute x1 as the sum of a constant UINT64_C(0x1ffffffffff6) and the first element of arg1, then subtract the first element of arg2.
    - Compute x2 as the sum of a constant UINT64_C(0xffffffffffe) and the second element of arg1, then subtract the second element of arg2.
    - Compute x3 as the sum of a constant UINT64_C(0xffffffffffe) and the third element of arg1, then subtract the third element of arg2.
    - Store the results x1, x2, and x3 in the respective positions of the out1 array.
- **Output**: The function outputs the result of the subtraction in the out1 array, which is a loose field element.


---
### fiat\_poly1305\_opp<!-- {{#callable:fiat_poly1305_opp}} -->
The function `fiat_poly1305_opp` computes the negation of a field element in the Poly1305 finite field.
- **Inputs**:
    - `out1`: A `fiat_poly1305_loose_field_element` array of size 3 where the result will be stored.
    - `arg1`: A `fiat_poly1305_tight_field_element` array of size 3 representing the field element to be negated.
- **Control Flow**:
    - Calculate the negation of the first element of `arg1` by subtracting it from `0x1ffffffffff6` and store the result in `x1`.
    - Calculate the negation of the second element of `arg1` by subtracting it from `0xffffffffffe` and store the result in `x2`.
    - Calculate the negation of the third element of `arg1` by subtracting it from `0xffffffffffe` and store the result in `x3`.
    - Assign `x1`, `x2`, and `x3` to the corresponding positions in the `out1` array.
- **Output**: The function outputs the negated field element in the `out1` array, which is a `fiat_poly1305_loose_field_element`.


---
### fiat\_poly1305\_selectznz<!-- {{#callable:fiat_poly1305_selectznz}} -->
The function `fiat_poly1305_selectznz` performs a conditional selection between two 3-element arrays based on a single-bit flag.
- **Inputs**:
    - `out1`: A 3-element array of uint64_t where the result of the selection will be stored.
    - `arg1`: A single-bit flag of type fiat_poly1305_uint1 that determines which array to select.
    - `arg2`: A 3-element array of uint64_t representing the first option for selection.
    - `arg3`: A 3-element array of uint64_t representing the second option for selection.
- **Control Flow**:
    - The function initializes three local uint64_t variables x1, x2, and x3.
    - It calls [`fiat_poly1305_cmovznz_u64`](#fiat_poly1305_cmovznz_u64) three times, each time selecting between corresponding elements of `arg2` and `arg3` based on `arg1`, storing the result in x1, x2, and x3 respectively.
    - The selected values x1, x2, and x3 are then assigned to the output array `out1`.
- **Output**: The function outputs a 3-element array `out1` where each element is selected from either `arg2` or `arg3` based on the value of `arg1`.
- **Functions called**:
    - [`fiat_poly1305_cmovznz_u64`](#fiat_poly1305_cmovznz_u64)


---
### fiat\_poly1305\_to\_bytes<!-- {{#callable:fiat_poly1305_to_bytes}} -->
The function `fiat_poly1305_to_bytes` serializes a field element into a 17-byte array in little-endian order.
- **Inputs**:
    - `out1`: A 17-byte array where the serialized output will be stored.
    - `arg1`: A `fiat_poly1305_tight_field_element`, which is an array of three 64-bit unsigned integers representing the field element to be serialized.
- **Control Flow**:
    - Subtracts constants from each element of `arg1` using [`fiat_poly1305_subborrowx_u44`](#fiat_poly1305_subborrowx_u44) and [`fiat_poly1305_subborrowx_u43`](#fiat_poly1305_subborrowx_u43), storing results in `x1`, `x3`, and `x5` with borrow flags `x2`, `x4`, and `x6`.
    - Uses [`fiat_poly1305_cmovznz_u64`](#fiat_poly1305_cmovznz_u64) to conditionally set `x7` based on the borrow flag `x6`.
    - Adds the results of the subtraction back with the conditional value using [`fiat_poly1305_addcarryx_u44`](#fiat_poly1305_addcarryx_u44) and [`fiat_poly1305_addcarryx_u43`](#fiat_poly1305_addcarryx_u43), storing results in `x8`, `x10`, and `x12` with carry flags `x9`, `x11`, and `x13`.
    - Shifts and combines the results to form a series of 8-bit values, storing them in `x16` to `x49`.
    - Assigns these 8-bit values to the `out1` array, completing the serialization.
- **Output**: The function outputs a 17-byte array `out1` containing the serialized representation of the input field element in little-endian order.
- **Functions called**:
    - [`fiat_poly1305_subborrowx_u44`](#fiat_poly1305_subborrowx_u44)
    - [`fiat_poly1305_subborrowx_u43`](#fiat_poly1305_subborrowx_u43)
    - [`fiat_poly1305_cmovznz_u64`](#fiat_poly1305_cmovznz_u64)
    - [`fiat_poly1305_addcarryx_u44`](#fiat_poly1305_addcarryx_u44)
    - [`fiat_poly1305_addcarryx_u43`](#fiat_poly1305_addcarryx_u43)


---
### fiat\_poly1305\_from\_bytes<!-- {{#callable:fiat_poly1305_from_bytes}} -->
The function `fiat_poly1305_from_bytes` deserializes a 17-byte array into a 3-element field element in the Poly1305 finite field.
- **Inputs**:
    - `out1`: A `fiat_poly1305_tight_field_element` array of size 3 that will store the deserialized field element.
    - `arg1`: A 17-byte array of type `uint8_t` representing the serialized field element in little-endian order.
- **Control Flow**:
    - Extracts each byte from the input array `arg1` and shifts them to their respective positions to form 64-bit integers.
    - Combines the first 6 bytes into a 44-bit integer `x22` and stores the lower 44 bits in `x23`.
    - Extracts the carry from `x22` and adds it to the next set of bytes to form another 43-bit integer `x29`, storing the lower 43 bits in `x30`.
    - Extracts the carry from `x29` and adds it to the remaining bytes to form the final 43-bit integer `x37`.
    - Stores the three resulting integers `x23`, `x30`, and `x37` into the output array `out1`.
- **Output**: The function outputs a `fiat_poly1305_tight_field_element` array `out1` containing three 64-bit integers representing the deserialized field element.


---
### fiat\_poly1305\_relax<!-- {{#callable:fiat_poly1305_relax}} -->
The function `fiat_poly1305_relax` converts a tight field element into a loose field element by directly copying its components.
- **Inputs**:
    - `out1`: A `fiat_poly1305_loose_field_element` array of size 3 where the result will be stored.
    - `arg1`: A `fiat_poly1305_tight_field_element` array of size 3 that is the input field element to be converted.
- **Control Flow**:
    - The function begins by declaring three `uint64_t` variables `x1`, `x2`, and `x3`.
    - It assigns the first element of `arg1` to `x1`, the second element to `x2`, and the third element to `x3`.
    - The function then assigns `x1`, `x2`, and `x3` to the corresponding elements of `out1`.
- **Output**: The function does not return a value; it modifies the `out1` array in place to contain the same values as `arg1`.


