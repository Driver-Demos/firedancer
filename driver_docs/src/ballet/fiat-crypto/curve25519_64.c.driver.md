# Purpose
The provided C source code is an implementation of arithmetic operations for the finite field defined by the prime \(2^{255} - 19\), commonly associated with the Curve25519 elliptic curve used in cryptographic applications. This code is part of the Fiat Cryptography library, which focuses on generating efficient and formally verified cryptographic arithmetic. The file includes functions for various field operations such as addition, subtraction, multiplication, squaring, and modular reduction, all tailored to the specific prime modulus. These operations are crucial for implementing elliptic curve cryptography, particularly in the context of Diffie-Hellman key exchange and digital signatures.

The code defines several types and functions that operate on field elements represented as arrays of 64-bit integers. It includes both "tight" and "loose" representations of field elements, which differ in their bounds and are used to optimize performance and ensure correctness during arithmetic operations. The functions are marked as inline and static, indicating they are intended for use within a single compilation unit, likely as part of a larger cryptographic library. The code also includes conditional move operations and byte serialization/deserialization functions, which are essential for securely handling cryptographic data. Overall, this file provides a specialized and efficient implementation of field arithmetic for cryptographic purposes, with a focus on the Curve25519 parameters.
# Imports and Dependencies

---
- `stdint.h`


# Global Variables

---
### fiat\_25519\_int128
- **Type**: ``typedef signed __int128 fiat_25519_int128;``
- **Description**: The `fiat_25519_int128` is a type definition for a signed 128-bit integer, utilizing the `__int128` type available in GCC and Clang compilers. This type is used to represent large integers that require more than the standard 64-bit integer size, allowing for operations on very large numbers.
- **Use**: This variable is used in arithmetic operations within the cryptographic functions of the Fiat-25519 implementation, particularly for handling large intermediate values during calculations.


---
### fiat\_25519\_uint128
- **Type**: `unsigned __int128`
- **Description**: The `fiat_25519_uint128` is a typedef for an unsigned 128-bit integer type, which is an extension type available in some compilers like GCC and Clang. This type is used to represent large integers that require more than the standard 64-bit integer size.
- **Use**: This variable is used in arithmetic operations that require handling of large numbers, such as those involved in cryptographic computations for the 25519 curve.


# Functions

---
### fiat\_25519\_value\_barrier\_u64<!-- {{#callable:fiat_25519_value_barrier_u64}} -->
The function `fiat_25519_value_barrier_u64` acts as a compiler barrier for a 64-bit unsigned integer, ensuring that the value is not optimized away by the compiler.
- **Inputs**:
    - `a`: A 64-bit unsigned integer that is passed to the function.
- **Control Flow**:
    - The function uses inline assembly to create a compiler barrier, which prevents the compiler from optimizing away the variable 'a'.
    - The assembly code is an empty string with a constraint on 'a' to be read and written ('+r'), ensuring 'a' is treated as a volatile variable.
    - The function then returns the value of 'a'.
- **Output**: The function returns the same 64-bit unsigned integer that was passed as input.


---
### fiat\_25519\_addcarryx\_u51<!-- {{#callable:fiat_25519_addcarryx_u51}} -->
The function `fiat_25519_addcarryx_u51` performs addition of two 51-bit integers with an optional carry-in and produces a 51-bit result and a carry-out.
- **Inputs**:
    - `out1`: A pointer to a uint64_t where the 51-bit result of the addition will be stored.
    - `out2`: A pointer to a fiat_25519_uint1 where the carry-out will be stored.
    - `arg1`: A fiat_25519_uint1 representing the carry-in, which can be either 0 or 1.
    - `arg2`: A uint64_t representing the first 51-bit integer to be added.
    - `arg3`: A uint64_t representing the second 51-bit integer to be added.
- **Control Flow**:
    - Calculate the sum of arg1, arg2, and arg3, storing the result in x1.
    - Mask x1 with 0x7ffffffffffff to obtain the 51-bit result, storing it in x2.
    - Shift x1 right by 51 bits to obtain the carry-out, storing it in x3.
    - Store x2 in the location pointed to by out1.
    - Store x3 in the location pointed to by out2.
- **Output**: The function outputs a 51-bit result stored in the location pointed to by out1 and a carry-out stored in the location pointed to by out2.


---
### fiat\_25519\_subborrowx\_u51<!-- {{#callable:fiat_25519_subborrowx_u51}} -->
The function `fiat_25519_subborrowx_u51` performs a subtraction with borrow on three inputs and outputs the result modulo 2^51 and the borrow flag.
- **Inputs**:
    - `out1`: A pointer to a uint64_t where the result of the subtraction will be stored.
    - `out2`: A pointer to a fiat_25519_uint1 where the borrow flag will be stored.
    - `arg1`: A fiat_25519_uint1 representing the first operand, which is subtracted from the second operand.
    - `arg2`: A uint64_t representing the second operand, from which the first operand and the third operand are subtracted.
    - `arg3`: A uint64_t representing the third operand, which is subtracted from the second operand.
- **Control Flow**:
    - Calculate the intermediate result `x1` by subtracting `arg1` and `arg3` from `arg2` and cast it to int64_t.
    - Compute the borrow `x2` by right-shifting `x1` by 51 bits and casting it to fiat_25519_int1.
    - Calculate the result `x3` by masking `x1` with 0x7ffffffffffff to get the lower 51 bits.
    - Store `x3` in the location pointed to by `out1`.
    - Store the negation of `x2` in the location pointed to by `out2`.
- **Output**: The function outputs the result of the subtraction modulo 2^51 in `out1` and the negated borrow flag in `out2`.


---
### fiat\_25519\_cmovznz\_u64<!-- {{#callable:fiat_25519_cmovznz_u64}} -->
The function `fiat_25519_cmovznz_u64` performs a conditional move operation on two 64-bit unsigned integers based on a single-bit condition.
- **Inputs**:
    - `out1`: A pointer to a 64-bit unsigned integer where the result will be stored.
    - `arg1`: A single-bit unsigned integer (fiat_25519_uint1) that acts as the condition for the move operation.
    - `arg2`: A 64-bit unsigned integer that is selected if `arg1` is 0.
    - `arg3`: A 64-bit unsigned integer that is selected if `arg1` is 1.
- **Control Flow**:
    - The function first evaluates `x1` as the logical negation of the negation of `arg1`, effectively converting `arg1` to a boolean value (0 or 1).
    - It calculates `x2` as the bitwise AND of the negation of `x1` (converted to a signed integer and subtracted from 0) with the maximum 64-bit unsigned integer value, resulting in either all bits set or all bits cleared.
    - The function then computes `x3` by using [`fiat_25519_value_barrier_u64`](#fiat_25519_value_barrier_u64) to apply a value barrier to `x2` and its negation, and performs bitwise operations to select between `arg2` and `arg3` based on the value of `x2`.
    - Finally, the result `x3` is stored in the location pointed to by `out1`.
- **Output**: The function outputs the selected 64-bit unsigned integer, either `arg2` or `arg3`, based on the value of `arg1`, and stores it in the location pointed to by `out1`.
- **Functions called**:
    - [`fiat_25519_value_barrier_u64`](#fiat_25519_value_barrier_u64)


---
### fiat\_25519\_carry\_mul<!-- {{#callable:fiat_25519_carry_mul}} -->
The function `fiat_25519_carry_mul` multiplies two field elements and reduces the result modulo 2^255 - 19.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of size 5 that will store the result of the multiplication.
    - `arg1`: A `fiat_25519_loose_field_element` array of size 5 representing the first operand of the multiplication.
    - `arg2`: A `fiat_25519_loose_field_element` array of size 5 representing the second operand of the multiplication.
- **Control Flow**:
    - Initialize 26 `fiat_25519_uint128` variables (x1 to x26) and 10 `uint64_t` variables (x27 to x52) for intermediate calculations.
    - Compute the product of each pair of elements from `arg1` and `arg2`, applying a factor of 0x13 to certain terms to account for the reduction modulo 2^255 - 19, and store these in `fiat_25519_uint128` variables.
    - Sum the computed products to form intermediate results `x26`, `x29`, `x30`, `x31`, and `x32`.
    - Perform a series of right shifts and bitwise AND operations to reduce the intermediate results to 51-bit values, storing the results in `uint64_t` variables `x27` to `x52`.
    - Apply a final reduction step by multiplying the carry from the highest limb by 0x13 and adding it to the lowest limb, ensuring the result fits within the field's bounds.
    - Store the final reduced results in the `out1` array.
- **Output**: The function outputs the reduced product of `arg1` and `arg2` in the `out1` array, which is a `fiat_25519_tight_field_element`.


---
### fiat\_25519\_carry\_square<!-- {{#callable:fiat_25519_carry_square}} -->
The function `fiat_25519_carry_square` computes the square of a field element and reduces the result modulo 2^255 - 19.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of size 5 that will store the result of the squaring operation.
    - `arg1`: A `fiat_25519_loose_field_element` array of size 5 representing the field element to be squared.
- **Control Flow**:
    - Initialize several 64-bit and 128-bit unsigned integers to store intermediate results.
    - Compute intermediate products and sums using the elements of `arg1`, applying specific multipliers and shifts to handle the field's characteristics.
    - Perform a series of additions and carry operations to accumulate the results into a 128-bit integer, ensuring that each step respects the 51-bit limb size of the field representation.
    - Reduce the accumulated results by shifting and masking to fit within the 51-bit limb size, propagating carries as necessary.
    - Adjust the final result to ensure it is within the field's bounds by applying a final reduction step.
    - Store the reduced result in the `out1` array.
- **Output**: The function outputs the squared and reduced field element in the `out1` array, which is a `fiat_25519_tight_field_element`.


---
### fiat\_25519\_carry<!-- {{#callable:fiat_25519_carry}} -->
The function `fiat_25519_carry` reduces a loose field element to a tight field element by performing a series of carry operations to ensure each limb fits within a 51-bit boundary.
- **Inputs**:
    - `out1`: A fiat_25519_tight_field_element array where the result will be stored.
    - `arg1`: A fiat_25519_loose_field_element array representing the input field element to be reduced.
- **Control Flow**:
    - Extract the first element of arg1 into x1.
    - Calculate x2 by adding the second element of arg1 to the right-shifted x1 by 51 bits.
    - Calculate x3 by adding the third element of arg1 to the right-shifted x2 by 51 bits.
    - Calculate x4 by adding the fourth element of arg1 to the right-shifted x3 by 51 bits.
    - Calculate x5 by adding the fifth element of arg1 to the right-shifted x4 by 51 bits.
    - Calculate x6 by adding the lower 51 bits of x1 to the product of the right-shifted x5 by 51 bits and 0x13.
    - Calculate x7 by adding the lower 51 bits of x2 to the right-shifted x6 by 51 bits.
    - Store the lower 51 bits of x6 in out1[0].
    - Store the lower 51 bits of x7 in out1[1].
    - Calculate x10 by adding the lower 51 bits of x3 to the right-shifted x7 by 51 bits.
    - Store the lower 51 bits of x10 in out1[2].
    - Store the lower 51 bits of x4 in out1[3].
    - Store the lower 51 bits of x5 in out1[4].
- **Output**: The function outputs a reduced field element stored in the `out1` array, with each element fitting within a 51-bit boundary.


---
### fiat\_25519\_add<!-- {{#callable:fiat_25519_add}} -->
The function `fiat_25519_add` performs element-wise addition of two 25519 field elements and stores the result in a third field element.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array of size 5 where the result of the addition will be stored.
    - `arg1`: A `fiat_25519_tight_field_element` array of size 5 representing the first operand in the addition.
    - `arg2`: A `fiat_25519_tight_field_element` array of size 5 representing the second operand in the addition.
- **Control Flow**:
    - Initialize five 64-bit unsigned integers x1 to x5.
    - Compute the sum of corresponding elements from `arg1` and `arg2` and store them in x1 to x5.
    - Assign the computed sums to the corresponding elements of `out1`.
- **Output**: The function does not return a value; it modifies the `out1` array in place to contain the result of the addition.


---
### fiat\_25519\_sub<!-- {{#callable:fiat_25519_sub}} -->
The function `fiat_25519_sub` performs subtraction of two field elements in the context of the 25519 curve, with specific constants added to each element to ensure non-negative results.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array of size 5 that will store the result of the subtraction.
    - `arg1`: A `fiat_25519_tight_field_element` array of size 5 representing the minuend in the subtraction.
    - `arg2`: A `fiat_25519_tight_field_element` array of size 5 representing the subtrahend in the subtraction.
- **Control Flow**:
    - Initialize five 64-bit unsigned integers (x1 to x5) to store intermediate subtraction results.
    - For each element in the field element arrays (arg1 and arg2), perform the subtraction: add a constant to the element from arg1 and subtract the corresponding element from arg2.
    - Store the result of each subtraction in the corresponding position in the out1 array.
- **Output**: The function outputs the result of the subtraction in the `out1` array, which is a `fiat_25519_loose_field_element`.


---
### fiat\_25519\_opp<!-- {{#callable:fiat_25519_opp}} -->
The function `fiat_25519_opp` computes the negation of a field element in the context of the 25519 curve.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array of size 5 that will store the result of the negation.
    - `arg1`: A `fiat_25519_tight_field_element` array of size 5 representing the field element to be negated.
- **Control Flow**:
    - Initialize five 64-bit unsigned integers x1 to x5.
    - Compute the negation of each element in `arg1` by subtracting it from a constant value specific to each index, storing the result in x1 to x5.
    - Assign the computed negated values x1 to x5 to the corresponding indices in the `out1` array.
- **Output**: The function outputs the negated field element in the `out1` array, which is a `fiat_25519_loose_field_element`.


---
### fiat\_25519\_selectznz<!-- {{#callable:fiat_25519_selectznz}} -->
The function `fiat_25519_selectznz` performs a conditional selection between two 5-element arrays based on a single-bit flag.
- **Inputs**:
    - `out1`: An array of 5 uint64_t elements where the result of the selection will be stored.
    - `arg1`: A single-bit flag (fiat_25519_uint1) that determines which array to select from; if 0, select from arg2, otherwise select from arg3.
    - `arg2`: A 5-element array of uint64_t values, one of the potential sources for selection.
    - `arg3`: A 5-element array of uint64_t values, the other potential source for selection.
- **Control Flow**:
    - The function initializes five local uint64_t variables (x1 to x5).
    - For each element index from 0 to 4, it calls [`fiat_25519_cmovznz_u64`](#fiat_25519_cmovznz_u64) to conditionally select between the corresponding elements of `arg2` and `arg3` based on `arg1`.
    - The selected values are stored in the local variables x1 to x5.
    - The function then assigns these selected values to the output array `out1`.
- **Output**: The function outputs a 5-element array `out1` where each element is selected from either `arg2` or `arg3` based on the value of `arg1`.
- **Functions called**:
    - [`fiat_25519_cmovznz_u64`](#fiat_25519_cmovznz_u64)


---
### fiat\_25519\_to\_bytes<!-- {{#callable:fiat_25519_to_bytes}} -->
The function `fiat_25519_to_bytes` serializes a 25519 field element into a 32-byte array in little-endian order.
- **Inputs**:
    - `out1`: A 32-byte array where the serialized field element will be stored.
    - `arg1`: A 25519 field element represented as an array of five 64-bit unsigned integers with tight bounds.
- **Control Flow**:
    - Subtracts the field element from a constant to ensure it is within the valid range, using [`fiat_25519_subborrowx_u51`](#fiat_25519_subborrowx_u51) for each element.
    - Uses a conditional move [`fiat_25519_cmovznz_u64`](#fiat_25519_cmovznz_u64) to handle potential underflow by selecting between zero and a maximum value based on the borrow flag.
    - Adds the result back to the original field element using [`fiat_25519_addcarryx_u51`](#fiat_25519_addcarryx_u51) to ensure it is reduced modulo the field prime.
    - Converts the reduced field element into a byte array by extracting each byte from the 64-bit integers and storing them in the output array `out1`.
- **Output**: A 32-byte array `out1` containing the serialized field element in little-endian order.
- **Functions called**:
    - [`fiat_25519_subborrowx_u51`](#fiat_25519_subborrowx_u51)
    - [`fiat_25519_cmovznz_u64`](#fiat_25519_cmovznz_u64)
    - [`fiat_25519_addcarryx_u51`](#fiat_25519_addcarryx_u51)


---
### fiat\_25519\_from\_bytes<!-- {{#callable:fiat_25519_from_bytes}} -->
The function `fiat_25519_from_bytes` deserializes a 32-byte array into a 5-element field element representation in the context of the 25519 elliptic curve.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of 5 elements where the deserialized field element will be stored.
    - `arg1`: A 32-byte array (`uint8_t[32]`) representing the serialized field element in little-endian order.
- **Control Flow**:
    - Initialize 71 variables to store intermediate 64-bit values and 5 variables to store 8-bit values.
    - Extract and shift each byte from the input array `arg1` to form 64-bit integers, applying specific bit shifts to align them according to the field element representation.
    - Combine these 64-bit integers into larger values, ensuring that each resulting value fits within 51 bits by applying bitwise AND with `0x7ffffffffffff`.
    - Store the resulting 5 field elements into the `out1` array.
- **Output**: The function outputs a `fiat_25519_tight_field_element` which is a 5-element array representing the deserialized field element.


---
### fiat\_25519\_relax<!-- {{#callable:fiat_25519_relax}} -->
The function `fiat_25519_relax` converts a tight field element into a loose field element by directly copying its values.
- **Inputs**:
    - `out1`: A `fiat_25519_loose_field_element` array of 5 elements where the result will be stored.
    - `arg1`: A `fiat_25519_tight_field_element` array of 5 elements that is the input to be converted.
- **Control Flow**:
    - The function begins by declaring five `uint64_t` variables `x1` to `x5`.
    - Each of these variables is assigned the corresponding element from the input array `arg1`.
    - The values of `x1` to `x5` are then assigned to the corresponding elements of the output array `out1`.
- **Output**: The function outputs a `fiat_25519_loose_field_element` which is a direct copy of the input `fiat_25519_tight_field_element`.


---
### fiat\_25519\_carry\_scmul\_121666<!-- {{#callable:fiat_25519_carry_scmul_121666}} -->
The function `fiat_25519_carry_scmul_121666` multiplies a field element by the constant 121666 and reduces the result modulo 2^255 - 19.
- **Inputs**:
    - `out1`: A `fiat_25519_tight_field_element` array of size 5 that will store the result of the multiplication and reduction.
    - `arg1`: A `fiat_25519_loose_field_element` array of size 5 representing the input field element to be multiplied by 121666.
- **Control Flow**:
    - Initialize five 128-bit unsigned integers (x1 to x5) to store intermediate multiplication results of each element of `arg1` with 121666.
    - Calculate the carry and the lower 51 bits of x5, storing them in x6 and x7 respectively.
    - Add the carry from the previous step (x6) to x4, calculate the carry and the lower 51 bits, storing them in x9 and x10 respectively.
    - Repeat the carry and reduction process for x3, x2, and x1, updating the carry and lower 51 bits at each step.
    - Multiply the final carry by 19 (x18 * 19) and add it to x7, then calculate the carry and the lower 51 bits, storing them in x22 and x23 respectively.
    - Add the carry from the previous step to x10, calculate the carry and the lower 51 bits, storing them in x25 and x26 respectively.
    - Add the carry from the previous step to x13, storing the result in x27.
    - Store the final reduced values in the `out1` array.
- **Output**: The function outputs a `fiat_25519_tight_field_element` array `out1` containing the reduced result of the multiplication.


