# Purpose
The provided code is a C header file, `fd_f25519.h`, which defines a public API for operations on the base field of the Curve25519 elliptic curve, specifically the finite field defined by the prime \( p = 2^{255} - 19 \). This file is part of a cryptographic library and provides a comprehensive set of functions for arithmetic operations on field elements, such as addition, subtraction, multiplication, and squaring, as well as more complex operations like inversion and square root calculations. The file also includes functions for serialization and deserialization of field elements to and from byte arrays, adhering to the little-endian format specified in RFC 8032.

The header file is structured to support different hardware architectures, with specific implementations for AVX512 and reference backends, ensuring optimized performance on various platforms. It defines several constants and utility functions, including vectorized operations for batch processing of multiple field elements, which can be particularly useful in performance-critical cryptographic applications. The API is designed to be used in cryptographic protocols, with a focus on providing both basic and advanced field operations while maintaining security considerations, such as constant-time execution for certain functions to prevent timing attacks. The file is intended to be included in other C source files, providing a modular and reusable interface for field arithmetic in cryptographic applications.
# Imports and Dependencies

---
- `../fd_ballet_base.h`
- `../../util/rng/fd_rng.h`
- `avx512/fd_f25519.h`
- `ref/fd_f25519.h`


# Global Variables

---
### fd\_f25519\_zero
- **Type**: `fd_f25519_t[1]`
- **Description**: The `fd_f25519_zero` is a constant array of type `fd_f25519_t` with a single element, representing the zero element in the finite field used by the Curve25519 elliptic curve. This field element is used as a constant in various arithmetic operations within the field.
- **Use**: It is used as a constant reference for operations that require the zero element of the field, such as initialization or comparison.


---
### fd\_f25519\_one
- **Type**: `fd_f25519_t[1]`
- **Description**: The `fd_f25519_one` is a constant array of type `fd_f25519_t` with a single element, representing the multiplicative identity in the finite field defined by the modulus 2^255 - 19. This field is used in cryptographic operations related to the Curve25519 elliptic curve.
- **Use**: This variable is used as a constant to represent the value one in field operations, ensuring consistent and efficient calculations in cryptographic algorithms.


---
### fd\_f25519\_minus\_one
- **Type**: `fd_f25519_t`
- **Description**: The variable `fd_f25519_minus_one` is a constant array of type `fd_f25519_t` with a single element. It represents the field element -1 in the base field of curve25519, which is an integer modulo p = 2^255 - 19.
- **Use**: This variable is used as a constant in arithmetic operations within the curve25519 field, particularly when a value of -1 is needed.


---
### fd\_f25519\_two
- **Type**: `fd_f25519_t`
- **Description**: The variable `fd_f25519_two` is a global constant of type `fd_f25519_t`, which represents a field element in the base field of curve25519. It is specifically initialized to the value of 2, as part of a set of predefined constants used in elliptic curve operations.
- **Use**: This variable is used as a constant field element representing the integer 2 in modular arithmetic operations within the curve25519 cryptographic functions.


---
### fd\_f25519\_nine
- **Type**: `fd_f25519_t`
- **Description**: The variable `fd_f25519_nine` is a constant array of type `fd_f25519_t`, which represents a field element in the base field of curve25519. It is specifically initialized to hold the value nine, which is a constant used in various cryptographic operations within the curve25519 context.
- **Use**: This variable is used as a predefined constant for operations involving the number nine in the field arithmetic of curve25519.


---
### fd\_f25519\_k
- **Type**: `fd_f25519_t[1]`
- **Description**: The variable `fd_f25519_k` is a static constant array of type `fd_f25519_t` with a single element. It represents a field element in the finite field defined by the prime 2^255 - 19, which is used in the Curve25519 elliptic curve cryptography.
- **Use**: This variable is used as a constant field element in cryptographic operations involving the Curve25519 elliptic curve.


---
### fd\_f25519\_minus\_k
- **Type**: `fd_f25519_t[1]`
- **Description**: The variable `fd_f25519_minus_k` is a static constant array of type `fd_f25519_t` with a single element. It represents a field element in the base field of curve25519, specifically the negative of a constant value `k`. The exact value of `k` is not defined in the provided code, but it is typically a constant used in elliptic curve computations.
- **Use**: This variable is used as a constant in mathematical operations involving field elements of curve25519, likely in cryptographic algorithms.


---
### fd\_f25519\_d
- **Type**: `fd_f25519_t[1]`
- **Description**: The variable `fd_f25519_d` is a static constant array of type `fd_f25519_t` with a single element. It represents a field constant used in operations related to the base field of curve25519, which is a widely used elliptic curve in cryptography.
- **Use**: This variable is used as a constant in mathematical operations involving the curve25519 field.


---
### fd\_f25519\_sqrtm1
- **Type**: `fd_f25519_t`
- **Description**: The variable `fd_f25519_sqrtm1` is a constant array of type `fd_f25519_t` with a single element. It represents the square root of -1 in the finite field defined by the prime 2^255 - 19, which is used in the context of elliptic curve cryptography, specifically for operations on the Curve25519.
- **Use**: This variable is used as a constant in mathematical operations involving field elements, particularly when calculating square roots in the field.


---
### fd\_f25519\_invsqrt\_a\_minus\_d
- **Type**: `fd_f25519_t[1]`
- **Description**: The variable `fd_f25519_invsqrt_a_minus_d` is a constant array of type `fd_f25519_t` with a single element. It represents a precomputed field element used in the context of the Curve25519 elliptic curve operations, specifically related to the inverse square root of a constant expression involving 'a' and 'd' parameters of the curve.
- **Use**: This variable is used as a constant in mathematical operations involving field elements on the Curve25519 elliptic curve, likely to optimize calculations by avoiding repeated computation of the inverse square root of 'a - d'.


---
### fd\_f25519\_one\_minus\_d\_sq
- **Type**: `fd_f25519_t[1]`
- **Description**: The variable `fd_f25519_one_minus_d_sq` is a constant array of one element of type `fd_f25519_t`, which represents a field element in the finite field defined by the prime 2^255 - 19. This specific variable likely holds the precomputed value of (1 - d)^2, where d is a constant used in the Curve25519 elliptic curve operations.
- **Use**: This variable is used as a constant in cryptographic computations involving the Curve25519 elliptic curve, specifically in operations that require the value of (1 - d)^2.


---
### fd\_f25519\_d\_minus\_one\_sq
- **Type**: `fd_f25519_t[1]`
- **Description**: The variable `fd_f25519_d_minus_one_sq` is a constant array of type `fd_f25519_t` with a single element. It represents a precomputed field element in the finite field defined by the prime 2^255 - 19, specifically the square of the difference between the constant 'd' and one.
- **Use**: This variable is used as a constant in cryptographic operations involving the Curve25519 elliptic curve, providing a precomputed value to optimize calculations.


---
### fd\_f25519\_sqrt\_ad\_minus\_one
- **Type**: `fd_f25519_t`
- **Description**: The variable `fd_f25519_sqrt_ad_minus_one` is a constant array of type `fd_f25519_t` with a single element. It represents a specific precomputed field element in the finite field defined by the prime 2^255 - 19, which is used in the context of the Curve25519 elliptic curve operations.
- **Use**: This variable is used as a constant in mathematical operations involving the Curve25519 elliptic curve, specifically related to the computation of square roots in the field.


---
### fd\_f25519\_sqr
- **Type**: `function pointer`
- **Description**: The `fd_f25519_sqr` is a function that computes the square of a field element in the finite field defined by the prime 2^255 - 19, which is used in the Curve25519 elliptic curve. It takes a pointer to a `fd_f25519_t` type as the result parameter and a constant pointer to a `fd_f25519_t` type as the input parameter, returning the result pointer after computation.
- **Use**: This function is used to perform the squaring operation on a field element, which is a fundamental operation in elliptic curve cryptography.


---
### fd\_f25519\_add
- **Type**: `function pointer`
- **Description**: The `fd_f25519_add` is a function pointer that represents a function for adding two field elements in the finite field defined by the prime 2^255 - 19. It takes three arguments: a pointer to the result field element `r`, and two constant pointers to the field elements `a` and `b` to be added. The function returns a pointer to the result field element `r`.
- **Use**: This function is used to perform addition of two field elements in the finite field of curve25519, storing the result in the provided result pointer.


---
### fd\_f25519\_sub
- **Type**: `function pointer`
- **Description**: `fd_f25519_sub` is a function that computes the subtraction of two field elements, `a` and `b`, in the finite field defined by the prime 2^255 - 19, and stores the result in `r`. The function returns a pointer to `r`, which is of type `fd_f25519_t*`, representing an element in this field.
- **Use**: This function is used to perform subtraction operations on elements of the finite field associated with the curve25519 elliptic curve.


---
### fd\_f25519\_add\_nr
- **Type**: `function pointer`
- **Description**: `fd_f25519_add_nr` is a function that computes the sum of two field elements `a` and `b` of type `fd_f25519_t` and stores the result in `r`. It is important to note that this function does not perform a modular reduction of the result by the prime `p = 2^255 - 19`, which is the modulus for the field elements in the Curve25519 context.
- **Use**: This function is used to add two field elements without reducing the result modulo the field prime, typically as a preliminary step before multiplication or squaring operations.


---
### fd\_f25519\_sub\_nr
- **Type**: `function pointer`
- **Description**: `fd_f25519_sub_nr` is a function that computes the subtraction of two field elements, `a` and `b`, and stores the result in `r`. It operates on elements of the field defined by the prime 2^255 - 19, which is used in the Curve25519 elliptic curve cryptography.
- **Use**: This function is used to perform subtraction of two field elements without reducing the result modulo the field prime, which can be useful in certain cryptographic operations before multiplication or squaring.


---
### fd\_f25519\_neg
- **Type**: `function pointer`
- **Description**: The `fd_f25519_neg` is a function that computes the negation of a field element in the finite field defined by the prime 2^255 - 19, which is used in the Curve25519 elliptic curve. It takes a pointer to a `fd_f25519_t` structure as the result parameter and a constant pointer to a `fd_f25519_t` structure as the input parameter, and returns a pointer to the result structure.
- **Use**: This function is used to compute the negation of a field element, effectively performing the operation r = -a, where 'a' is the input field element.


---
### fd\_f25519\_mul\_121666
- **Type**: `function pointer`
- **Description**: The `fd_f25519_mul_121666` is a function that computes the product of a field element `a` with the constant 121666, returning the result in the field element `r`. It operates within the finite field defined by the prime 2^255 - 19, which is used in the Curve25519 elliptic curve cryptography.
- **Use**: This function is used to perform a specific scalar multiplication operation within the finite field, which is a common operation in elliptic curve cryptography.


---
### fd\_f25519\_frombytes
- **Type**: `fd_f25519_t *`
- **Description**: The `fd_f25519_frombytes` function is a global function that deserializes a 32-byte buffer into a `fd_f25519_t` field element. The buffer is expected to be in little-endian format as per RFC 8032, which is a standard for Ed25519 and Curve25519 cryptographic operations.
- **Use**: This function is used to convert a byte array into a field element suitable for arithmetic operations in the Curve25519 field.


---
### fd\_f25519\_tobytes
- **Type**: `function pointer`
- **Description**: The `fd_f25519_tobytes` function is a global function that serializes a `fd_f25519_t` field element into a 32-byte buffer. This function is part of the public API for operations on the base field of curve25519, and it ensures that the serialized output is in little-endian form, as specified by RFC 8032.
- **Use**: This function is used to convert a field element into a byte array for storage or transmission.


---
### fd\_f25519\_set
- **Type**: `function pointer`
- **Description**: The `fd_f25519_set` function is a global function that copies the value from one field element of type `fd_f25519_t` to another. It takes two parameters: a pointer to the destination field element `r` and a pointer to the source field element `a`. The function returns a pointer to the destination field element `r` after copying the value.
- **Use**: This function is used to set the value of one field element to another in the context of operations on the base field of curve25519.


---
### fd\_f25519\_if
- **Type**: `function pointer`
- **Description**: The `fd_f25519_if` is a function that conditionally assigns one of two `fd_f25519_t` field elements to a result based on a given condition. It takes a pointer to a result field element `r`, a condition `cond` which is an integer (either 0 or 1), and two constant pointers to field elements `a0` and `a1`. The function sets `r` to `a0` if `cond` is true (1), otherwise it sets `r` to `a1`. This operation is performed in constant time to avoid timing attacks.
- **Use**: This function is used to conditionally select between two field elements in a constant-time manner, ensuring security against timing attacks.


---
### fd\_f25519\_rng\_unsafe
- **Type**: `fd_f25519_t *`
- **Description**: The `fd_f25519_rng_unsafe` function is a global function that generates a random field element of type `fd_f25519_t`. It takes a pointer to a `fd_f25519_t` structure and a pointer to a random number generator (`fd_rng_t`) as arguments.
- **Use**: This function is used to generate random field elements for testing purposes, but it is not secure for cryptographic use.


---
### fd\_f25519\_inv
- **Type**: `function pointer`
- **Description**: The `fd_f25519_inv` is a function that computes the multiplicative inverse of a field element in the finite field defined by the prime 2^255 - 19. It takes a pointer to a `fd_f25519_t` structure where the result will be stored and a constant pointer to the `fd_f25519_t` structure representing the element to be inverted.
- **Use**: This function is used to calculate the inverse of a given field element, which is essential for division operations in the field.


---
### fd\_f25519\_pow22523
- **Type**: `function pointer`
- **Description**: The `fd_f25519_pow22523` is a function that computes the power of a field element `a` raised to the exponent 2^252-3 in the finite field defined by the prime 2^255-19. This operation is part of the arithmetic operations on the field elements used in the Curve25519 elliptic curve cryptography.
- **Use**: This function is used to perform a specific exponentiation operation on field elements, which is a common requirement in cryptographic algorithms involving Curve25519.


---
### fd\_f25519\_pow22523\_2
- **Type**: `function pointer`
- **Description**: `fd_f25519_pow22523_2` is a function that computes the power of two field elements `a1` and `a2` to the exponent 2^252-3, storing the results in `r1` and `r2` respectively. This operation is part of the finite field arithmetic over the base field of curve25519, which is used in cryptographic applications.
- **Use**: This function is used to perform exponentiation of two field elements simultaneously, optimizing operations in cryptographic algorithms that require such computations.


# Functions

---
### fd\_f25519\_eq<!-- {{#callable:fd_f25519_eq}} -->
The `fd_f25519_eq` function checks if two field elements, `a` and `b`, are equal by subtracting them and checking if the result is zero.
- **Inputs**:
    - `a`: A pointer to the first field element of type `fd_f25519_t` to be compared.
    - `b`: A pointer to the second field element of type `fd_f25519_t` to be compared.
- **Control Flow**:
    - Declare a temporary field element `r` to store the result of the subtraction.
    - Call `fd_f25519_sub` to compute the difference between `a` and `b`, storing the result in `r`.
    - Call [`fd_f25519_is_zero`](ref/fd_f25519.h.driver.md#fd_f25519_is_zero) to check if the result `r` is zero, indicating that `a` and `b` are equal.
    - Return the result of [`fd_f25519_is_zero`](ref/fd_f25519.h.driver.md#fd_f25519_is_zero), which is 1 if `a` and `b` are equal, and 0 otherwise.
- **Output**: Returns an integer, 1 if the field elements `a` and `b` are equal, and 0 otherwise.
- **Functions called**:
    - [`fd_f25519_is_zero`](ref/fd_f25519.h.driver.md#fd_f25519_is_zero)


---
### fd\_f25519\_is\_nonzero<!-- {{#callable:fd_f25519_is_nonzero}} -->
The function `fd_f25519_is_nonzero` checks if a given field element is non-zero.
- **Inputs**:
    - `a`: A pointer to a constant `fd_f25519_t` field element, which represents an integer modulo 2^255 - 19.
- **Control Flow**:
    - The function calls [`fd_f25519_is_zero`](ref/fd_f25519.h.driver.md#fd_f25519_is_zero) with the input `a` to determine if the field element is zero.
    - It negates the result of [`fd_f25519_is_zero`](ref/fd_f25519.h.driver.md#fd_f25519_is_zero) to return 1 if `a` is non-zero and 0 if `a` is zero.
- **Output**: An integer value: 1 if the field element `a` is non-zero, and 0 if it is zero.
- **Functions called**:
    - [`fd_f25519_is_zero`](ref/fd_f25519.h.driver.md#fd_f25519_is_zero)


---
### fd\_f25519\_sgn<!-- {{#callable:fd_f25519_sgn}} -->
The `fd_f25519_sgn` function returns the least significant bit (LSB) of a field element represented by `fd_f25519_t`.
- **Inputs**:
    - `a`: A pointer to a constant `fd_f25519_t` field element whose sign (LSB) is to be determined.
- **Control Flow**:
    - Declare a 32-byte buffer `buf`.
    - Call [`fd_f25519_tobytes`](ref/fd_f25519.h.driver.md#fd_f25519_tobytes) to serialize the field element `a` into the buffer `buf`.
    - Return the least significant bit of the first byte of `buf` by performing a bitwise AND operation with 1.
- **Output**: The function returns an integer representing the least significant bit of the serialized field element, which is either 0 or 1.
- **Functions called**:
    - [`fd_f25519_tobytes`](ref/fd_f25519.h.driver.md#fd_f25519_tobytes)


---
### fd\_f25519\_inv\_sqrt<!-- {{#callable:fd_f25519_inv_sqrt}} -->
The `fd_f25519_inv_sqrt` function computes the inverse square root of a given field element in the base field of curve25519.
- **Inputs**:
    - `r`: A pointer to an `fd_f25519_t` where the result will be stored.
    - `v`: A constant pointer to an `fd_f25519_t` representing the field element for which the inverse square root is to be computed.
- **Control Flow**:
    - The function calls [`fd_f25519_sqrt_ratio`](fd_f25519.c.driver.md#fd_f25519_sqrt_ratio) with `r`, `fd_f25519_one`, and `v` as arguments.
    - [`fd_f25519_sqrt_ratio`](fd_f25519.c.driver.md#fd_f25519_sqrt_ratio) computes the inverse square root by evaluating the expression `(u * v^3) * (u * v^7)^((p-5)/8)` with `u` set to `fd_f25519_one`.
    - The result of the computation is stored in `r`.
    - The function returns the result of [`fd_f25519_sqrt_ratio`](fd_f25519.c.driver.md#fd_f25519_sqrt_ratio), which is 0 on success and 1 on failure.
- **Output**: The function returns an integer indicating success (0) or failure (1) of the inverse square root computation.
- **Functions called**:
    - [`fd_f25519_sqrt_ratio`](fd_f25519.c.driver.md#fd_f25519_sqrt_ratio)


# Function Declarations (Public API)

---
### fd\_f25519\_inv<!-- {{#callable_declaration:fd_f25519_inv}} -->
Computes the multiplicative inverse of a field element in the base field of curve25519.
- **Description**: Use this function to calculate the multiplicative inverse of a given field element within the base field defined by the modulus 2^255 - 19. This operation is essential in cryptographic algorithms where division in the field is required. The function must be called with a valid field element, and the result is stored in the provided output parameter. Ensure that the input element is non-zero to avoid undefined behavior, as division by zero is not defined in this context.
- **Inputs**:
    - `r`: A pointer to an fd_f25519_t where the result will be stored. Must not be null. The caller retains ownership.
    - `a`: A pointer to a constant fd_f25519_t representing the field element to be inverted. Must not be null and should not be zero to avoid undefined behavior.
- **Output**: Returns a pointer to the result, which is the same as the input parameter r.
- **See also**: [`fd_f25519_inv`](fd_f25519.c.driver.md#fd_f25519_inv)  (Implementation)


---
### fd\_f25519\_pow22523<!-- {{#callable_declaration:fd_f25519_pow22523}} -->
Computes the power of a field element to the exponent 2^252-3.
- **Description**: Use this function to compute the power of a given field element `a` to the exponent 2^252-3 in the finite field defined by the modulus 2^255-19. This operation is useful in cryptographic algorithms that require exponentiation in this specific field. The function requires a valid field element `a` and a pre-allocated field element `r` to store the result. The input `a` must be a valid field element, and the function will return the result in `r`, which is also returned for convenience.
- **Inputs**:
    - `r`: A pointer to a pre-allocated `fd_f25519_t` structure where the result will be stored. The caller retains ownership and must ensure it is not null.
    - `a`: A pointer to a constant `fd_f25519_t` structure representing the field element to be exponentiated. It must not be null and should represent a valid field element.
- **Output**: Returns a pointer to `r`, which contains the result of the exponentiation.
- **See also**: [`fd_f25519_pow22523`](fd_f25519.c.driver.md#fd_f25519_pow22523)  (Implementation)


---
### fd\_f25519\_sqrt\_ratio<!-- {{#callable_declaration:fd_f25519_sqrt_ratio}} -->
Computes the square root ratio of two field elements.
- **Description**: This function calculates the square root of the ratio of two field elements, `u` and `v`, in the finite field defined by the prime 2^255 - 19. It is used when you need to determine if a square root exists for the given ratio and to compute it if possible. The function must be called with valid field elements, and the result is stored in `r`. The function returns 0 if the computation is successful and a square root exists, or 1 if it fails, indicating that no square root exists for the given ratio.
- **Inputs**:
    - `r`: A pointer to an fd_f25519_t where the result will be stored. Must not be null. The caller retains ownership.
    - `u`: A pointer to a constant fd_f25519_t representing the numerator of the ratio. Must not be null. The caller retains ownership.
    - `v`: A pointer to a constant fd_f25519_t representing the denominator of the ratio. Must not be null. The caller retains ownership.
- **Output**: Returns 0 if a square root exists and is successfully computed, or 1 if no square root exists for the given ratio.
- **See also**: [`fd_f25519_sqrt_ratio`](fd_f25519.c.driver.md#fd_f25519_sqrt_ratio)  (Implementation)


