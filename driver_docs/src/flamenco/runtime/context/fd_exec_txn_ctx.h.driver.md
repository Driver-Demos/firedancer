# Purpose
This C header file, `fd_exec_txn_ctx.h`, defines the structures and functions necessary for managing the execution context of a transaction within a larger system, likely related to blockchain or distributed ledger technology. The file provides a comprehensive framework for handling transaction execution, including the management of transaction accounts, instruction execution, and error handling. It defines several key data structures, such as `fd_exec_txn_ctx_t`, which encapsulates all the necessary state and metadata required to execute a transaction, including account information, execution fees, and instruction traces. The file also includes utility functions for setting up, joining, and tearing down transaction contexts, as well as functions for accessing and manipulating transaction accounts.

The header file is part of a larger codebase, as indicated by the inclusion of other header files and the use of macros to integrate with template-based utilities. It provides a narrow but critical functionality focused on transaction execution, with a strong emphasis on performance and correctness, as evidenced by the detailed handling of account states and execution errors. The file does not define a public API for external use but rather serves as an internal component of a larger system, likely intended to be used by other parts of the system that manage transaction processing and execution. The presence of detailed comments and references to external sources suggests that the code is designed to align with specific standards or protocols, possibly related to a blockchain platform like Solana, as inferred from the references to Agave and Solana SDK functions.
# Imports and Dependencies

---
- `fd_exec_instr_ctx.h`
- `../../../util/fd_util_base.h`
- `../../log_collector/fd_log_collector_base.h`
- `../../../ballet/txn/fd_txn.h`
- `../../features/fd_features.h`
- `../fd_acc_mgr.h`
- `../fd_txncache.h`
- `../fd_bank_hash_cmp.h`
- `../../../util/tmpl/fd_pool.c`
- `../../../util/tmpl/fd_map_chain.c`


# Global Variables

---
### fd\_exec\_txn\_ctx\_new
- **Type**: `void *`
- **Description**: The `fd_exec_txn_ctx_new` function is a global function that returns a pointer to a newly created transaction execution context. It takes a single argument, `mem`, which is a pointer to a memory location where the context will be initialized.
- **Use**: This function is used to allocate and initialize a new transaction execution context, which is essential for managing the execution of transactions within the system.


---
### fd\_exec\_txn\_ctx\_join
- **Type**: `fd_exec_txn_ctx_t *`
- **Description**: The `fd_exec_txn_ctx_join` is a function that returns a pointer to an `fd_exec_txn_ctx_t` structure, which represents the context needed to execute a transaction. This context includes various fields such as transaction status, execution parameters, and account information necessary for transaction processing.
- **Use**: This function is used to initialize and return a transaction execution context by joining memory and workspace resources, facilitating the execution of transactions within the system.


---
### fd\_exec\_txn\_ctx\_leave
- **Type**: `function pointer`
- **Description**: The `fd_exec_txn_ctx_leave` is a function pointer that takes a pointer to an `fd_exec_txn_ctx_t` structure as its argument and returns a `void` pointer. This function is likely used to perform cleanup or finalization tasks when leaving a transaction execution context.
- **Use**: This function is used to leave or exit a transaction execution context, possibly performing necessary cleanup operations.


---
### fd\_exec\_txn\_ctx\_delete
- **Type**: `function pointer`
- **Description**: `fd_exec_txn_ctx_delete` is a function pointer that takes a single argument, a void pointer `mem`, and returns a void pointer. It is likely used to delete or deallocate a transaction context in the Firedancer runtime environment.
- **Use**: This function is used to delete or clean up a transaction context, freeing any associated resources.


# Data Structures

---
### fd\_txn\_return\_data
- **Type**: `struct`
- **Members**:
    - `program_id`: A public key identifying the program associated with the transaction.
    - `len`: The length of the data array that contains the return data.
    - `data`: An array of unsigned characters with a maximum size of 1024 bytes, used to store return data from a transaction.
- **Description**: The `fd_txn_return_data` structure is designed to encapsulate the return data from a transaction syscall. It includes a `program_id` to identify the associated program, a `len` field to specify the length of the return data, and a `data` array to hold the actual return data, with a maximum capacity of 1024 bytes. This structure is used to manage and store the output data generated by transaction executions within the system.


---
### fd\_txn\_return\_data\_t
- **Type**: `struct`
- **Members**:
    - `program_id`: Holds the public key of the program associated with the transaction.
    - `len`: Specifies the length of the data array.
    - `data`: An array of 1024 bytes used to store return data from syscalls.
- **Description**: The `fd_txn_return_data_t` structure is designed to encapsulate the return data from syscalls within a transaction execution context. It includes a program identifier (`program_id`), a length field (`len`) indicating the size of the data being returned, and a fixed-size byte array (`data`) to hold the actual return data. This structure is essential for managing and accessing the data returned by syscalls during the execution of a transaction, ensuring that the data is properly associated with the correct program and is of the expected size.


---
### fd\_vote\_account\_cache\_entry
- **Type**: `struct`
- **Members**:
    - `pubkey`: A public key associated with the vote account.
    - `next`: An unsigned long integer used for linking or indexing purposes.
    - `vote_account`: A structure representing the state of a vote account.
- **Description**: The `fd_vote_account_cache_entry` structure is designed to cache deserialized vote accounts, facilitating iteration after replaying a slot, which is essential for fork choice in a blockchain context. It contains a public key (`pubkey`) to identify the vote account, a `next` field likely used for linking entries in a list or chain, and a `vote_account` field that holds the state of the vote account. This structure is part of a larger system that manages transaction execution contexts and supports efficient access and manipulation of vote accounts.


---
### fd\_vote\_account\_cache\_entry\_t
- **Type**: `struct`
- **Members**:
    - `pubkey`: A public key associated with the vote account.
    - `next`: An index or pointer to the next entry in the cache.
    - `vote_account`: The state of the vote account, represented by `fd_vote_state_t`.
- **Description**: The `fd_vote_account_cache_entry_t` structure is used to represent an entry in a cache of deserialized vote accounts. This cache is utilized to support iteration after replaying a slot, which is necessary for making fork choices in a blockchain context. Each entry in the cache contains a public key (`pubkey`) identifying the vote account, a `next` field for linking to subsequent entries, and a `vote_account` field that holds the state of the vote account.


---
### fd\_exec\_instr\_trace\_entry
- **Type**: `struct`
- **Members**:
    - `instr_info`: Pointer to metadata about the instruction.
    - `stack_height`: Represents the stack height when this instruction was pushed onto the stack, including itself.
- **Description**: The `fd_exec_instr_trace_entry` structure is used to represent an entry in an instruction trace, capturing metadata about a specific instruction and the stack height at the time the instruction was added to the stack. This structure is part of a larger context used for executing transactions, where it helps in tracking the execution flow and stack state of instructions within a transaction.


---
### fd\_exec\_instr\_trace\_entry\_t
- **Type**: `struct`
- **Members**:
    - `instr_info`: Pointer to metadata about the instruction.
    - `stack_height`: Represents the stack height when this instruction was pushed onto the stack, including itself.
- **Description**: The `fd_exec_instr_trace_entry_t` structure is used to represent an entry in the instruction trace within a transaction execution context. It contains metadata about a specific instruction and the stack height at the time the instruction was added to the stack. This structure is part of a larger system that manages transaction execution, providing a way to trace and manage the execution of instructions within a transaction.


---
### fd\_exec\_txn\_ctx
- **Type**: `struct`
- **Members**:
    - `magic`: A unique identifier for the transaction context, set to FD_EXEC_TXN_CTX_MAGIC.
    - `flags`: Flags for transaction execution context.
    - `features`: Features enabled for the transaction execution.
    - `status_cache`: Pointer to the transaction status cache.
    - `prev_lamports_per_signature`: Previous lamports per signature value.
    - `enable_exec_recording`: Flag to enable execution recording.
    - `total_epoch_stake`: Total stake for the current epoch.
    - `bank_hash_cmp`: Pointer to bank hash comparison structure.
    - `funk_txn`: Pointer to the transaction in the funk system.
    - `funk`: Array of funk structures.
    - `runtime_pub_wksp`: Pointer to the runtime public workspace.
    - `slot`: Current slot number.
    - `fee_rate_governor`: Fee rate governor for the transaction.
    - `block_hash_queue`: Queue of block hashes.
    - `schedule`: Epoch schedule information.
    - `rent`: Rent information for accounts.
    - `slots_per_year`: Number of slots per year.
    - `stakes`: Stake information for the transaction.
    - `spad`: Pointer to the spad structure for transaction execution.
    - `spad_wksp`: Workspace for the spad.
    - `paid_fees`: Total fees paid for the transaction.
    - `compute_unit_limit`: Limit on compute units for the transaction.
    - `compute_unit_price`: Price per compute unit for the transaction.
    - `compute_meter`: Remaining compute units for the transaction.
    - `heap_size`: Heap size for virtual machines executing the transaction.
    - `loaded_accounts_data_size_limit`: Limit on the size of loaded account data.
    - `loaded_accounts_data_size`: Actual size of loaded account data.
    - `prioritization_fee_type`: Type of prioritization fee used.
    - `txn_descriptor`: Descriptor of the transaction.
    - `_txn_raw`: Raw bytes of the transaction.
    - `custom_err`: Numeric value of a custom error if returned.
    - `instr_stack_sz`: Current depth of the instruction execution stack.
    - `instr_stack`: Stack of instruction execution contexts.
    - `failed_instr`: Pointer to the failed instruction context.
    - `instr_err_idx`: Index of the instruction error.
    - `accounts_cnt`: Number of account public keys accessed by the transaction.
    - `account_keys`: Array of account public keys accessed by the transaction.
    - `executable_cnt`: Number of BPF upgradeable loader accounts.
    - `executable_accounts`: Array of BPF upgradeable loader program data accounts.
    - `accounts`: Array of borrowed accounts accessed by the transaction.
    - `rollback_nonce_account`: Rollback state of the nonce account.
    - `nonce_account_idx_in_txn`: Index of the nonce account in the transaction.
    - `rollback_fee_payer_account`: Rollback state of the fee payer account.
    - `num_instructions`: Counter for the number of instructions in the transaction.
    - `return_data`: Data returned from return_data syscalls.
    - `vote_accounts_map`: Cache of deserialized vote accounts for fork choice.
    - `vote_accounts_pool`: Memory pool for deserialized vote account cache.
    - `accounts_resize_delta`: Tracking for account resizing at the transaction level.
    - `blake_txn_msg_hash`: Hash of the raw transaction message for the status cache.
    - `execution_fee`: Execution fee paid by the fee payer.
    - `priority_fee`: Priority fee paid by the fee payer.
    - `collected_rent`: Rent collected from accounts in the transaction.
    - `dirty_vote_acc`: Flag indicating if a vote account was modified.
    - `dirty_stake_acc`: Flag indicating if a stake account was modified.
    - `capture_ctx`: Pointer to the capture context.
    - `instr_infos`: Array of instruction information for the transaction.
    - `instr_info_cnt`: Count of instruction information entries.
    - `cpi_instr_infos`: Array of CPI instruction information.
    - `cpi_instr_info_cnt`: Count of CPI instruction information entries.
    - `instr_trace`: Trace of instruction execution.
    - `instr_trace_length`: Number of instructions in the trace.
    - `log_collector`: Log collector instance for the transaction.
    - `exec_err`: Execution error code.
    - `exec_err_kind`: Kind of execution error.
    - `current_instr_idx`: Index of the current instruction being executed.
- **Description**: The `fd_exec_txn_ctx` structure is a comprehensive context for executing transactions, encapsulating various parameters and states required during transaction processing. It includes fields for transaction metadata, execution parameters, account management, and error handling. The structure supports features like instruction execution tracing, account rollback, and fee management, making it integral to the transaction execution lifecycle. It is designed to handle complex transaction scenarios, including those involving multiple accounts, compute units, and execution fees, while maintaining detailed logs and error states for robust transaction processing.


# Functions

---
### fd\_exec\_txn\_ctx\_find\_index\_of\_account<!-- {{#callable:fd_exec_txn_ctx_find_index_of_account}} -->
The function `fd_exec_txn_ctx_find_index_of_account` searches for a given public key in the transaction context's account keys and returns its index if found, or -1 if not.
- **Inputs**:
    - `ctx`: A pointer to a constant `fd_exec_txn_ctx_t` structure, which contains the transaction context including account keys.
    - `pubkey`: A pointer to a constant `fd_pubkey_t` structure representing the public key to search for in the account keys.
- **Control Flow**:
    - The function iterates backwards over the account keys in the transaction context, starting from the last account and moving to the first.
    - For each account key, it compares the given public key with the current account key using `memcmp`.
    - If a match is found (i.e., `memcmp` returns 0), the function returns the current index (adjusted to be zero-based).
    - If no match is found after checking all account keys, the function returns -1.
- **Output**: The function returns an integer representing the zero-based index of the account key that matches the given public key, or -1 if no match is found.


# Function Declarations (Public API)

---
### fd\_exec\_txn\_ctx\_new<!-- {{#callable_declaration:fd_exec_txn_ctx_new}} -->
Creates a new transaction execution context.
- **Description**: This function initializes a new transaction execution context using the provided memory. It should be called when a new transaction context is needed, and the memory must be properly aligned and non-null. The function sets up the context with a magic number to indicate successful initialization. If the memory is null or misaligned, the function logs a warning and returns null, indicating failure. This function is typically used in preparation for executing a transaction, ensuring that the context is correctly set up before any transaction operations are performed.
- **Inputs**:
    - `mem`: A pointer to a memory block where the transaction context will be initialized. The memory must be aligned to FD_EXEC_TXN_CTX_ALIGN and must not be null. If these conditions are not met, the function logs a warning and returns null.
- **Output**: Returns the pointer to the initialized memory block if successful, or null if the input memory is null or misaligned.
- **See also**: [`fd_exec_txn_ctx_new`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_new)  (Implementation)


---
### fd\_exec\_txn\_ctx\_join<!-- {{#callable_declaration:fd_exec_txn_ctx_join}} -->
Rejoins a transaction context to a shared memory block.
- **Description**: This function is used to rejoin a transaction context to a shared memory block, allowing the context to be reused or reinitialized with new shared resources. It should be called with a valid memory block that was previously allocated for a transaction context. The function checks the integrity of the memory block using a magic number and logs a warning if the block is invalid or if the magic number does not match. It also updates the context with new shared resources, such as a scratchpad and its workspace, which can be used during transaction execution. This function is typically used in scenarios where transaction contexts need to be reattached to shared resources after being detached or when setting up a context for a new transaction execution.
- **Inputs**:
    - `mem`: A pointer to a memory block that should contain a valid transaction context. Must not be null. The memory block should have been previously initialized with a valid transaction context.
    - `spad`: A pointer to a scratchpad structure that will be associated with the transaction context. Can be null if no scratchpad is needed.
    - `spad_wksp`: A pointer to a workspace structure for the scratchpad. Can be null if no workspace is needed.
- **Output**: Returns a pointer to the transaction context if successful, or null if the memory block is invalid or the magic number does not match.
- **See also**: [`fd_exec_txn_ctx_join`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_join)  (Implementation)


---
### fd\_exec\_txn\_ctx\_leave<!-- {{#callable_declaration:fd_exec_txn_ctx_leave}} -->
Leaves a transaction context and returns a pointer to it.
- **Description**: Use this function to safely exit a transaction context, ensuring that the context is valid before doing so. This function should be called when you are done with a transaction context and wish to leave it, potentially for cleanup or further processing. It checks if the provided context is non-null and has the correct magic number, which indicates a valid transaction context. If these conditions are not met, it logs a warning and returns NULL, indicating an error.
- **Inputs**:
    - `ctx`: A pointer to a fd_exec_txn_ctx_t structure representing the transaction context. It must not be null and must have a valid magic number (FD_EXEC_TXN_CTX_MAGIC). If these conditions are not met, the function logs a warning and returns NULL.
- **Output**: Returns a void pointer to the transaction context if it is valid, or NULL if the context is null or has an incorrect magic number.
- **See also**: [`fd_exec_txn_ctx_leave`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_leave)  (Implementation)


---
### fd\_exec\_txn\_ctx\_delete<!-- {{#callable_declaration:fd_exec_txn_ctx_delete}} -->
Deletes a transaction context if valid.
- **Description**: Use this function to delete a transaction context that was previously created, ensuring that the memory is properly invalidated. This function should be called when the transaction context is no longer needed, and it is important to ensure that the memory pointer provided is not null, is properly aligned, and contains a valid transaction context with the correct magic number. If any of these conditions are not met, the function will log a warning and return null.
- **Inputs**:
    - `mem`: A pointer to the memory location of the transaction context to be deleted. It must not be null, must be aligned to FD_EXEC_TXN_CTX_ALIGN, and must point to a valid transaction context with the correct magic number. If these conditions are not met, the function logs a warning and returns null.
- **Output**: Returns the original memory pointer if the transaction context is successfully deleted; otherwise, returns null if the input is invalid.
- **See also**: [`fd_exec_txn_ctx_delete`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_delete)  (Implementation)


---
### fd\_exec\_txn\_ctx\_setup\_basic<!-- {{#callable_declaration:fd_exec_txn_ctx_setup_basic}} -->
Initializes a transaction context with default values.
- **Description**: Use this function to set up a basic transaction context when you need a default configuration without a transaction descriptor or raw transaction data. This is particularly useful for testing or mocking transaction context objects for instructions. The function initializes various fields of the context structure to predefined default values, ensuring that the context is in a consistent state for further operations. It must be called before using the context in any transaction-related operations.
- **Inputs**:
    - `ctx`: A pointer to an fd_exec_txn_ctx_t structure that will be initialized. Must not be null, and the caller retains ownership of the memory.
- **Output**: None
- **See also**: [`fd_exec_txn_ctx_setup_basic`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_setup_basic)  (Implementation)


---
### fd\_exec\_txn\_ctx\_setup<!-- {{#callable_declaration:fd_exec_txn_ctx_setup}} -->
Sets up a transaction execution context with a transaction descriptor and raw transaction data.
- **Description**: This function initializes a transaction execution context by associating it with a given transaction descriptor and raw transaction data. It should be used when preparing a context for executing a transaction, ensuring that the context is properly linked to the transaction's details. The function must be called with a valid context structure and valid transaction descriptor and raw data pointers. It is essential that the context is already allocated and that the transaction descriptor and raw data are correctly populated before calling this function.
- **Inputs**:
    - `ctx`: A pointer to an fd_exec_txn_ctx_t structure that will be set up. Must not be null and should point to a valid, allocated context structure.
    - `txn_descriptor`: A pointer to a constant fd_txn_t structure representing the transaction descriptor. Must not be null and should point to a valid transaction descriptor.
    - `txn_raw`: A pointer to a constant fd_rawtxn_b_t structure containing the raw transaction data. Must not be null and should point to valid raw transaction data.
- **Output**: None
- **See also**: [`fd_exec_txn_ctx_setup`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_setup)  (Implementation)


---
### fd\_exec\_txn\_ctx\_teardown<!-- {{#callable_declaration:fd_exec_txn_ctx_teardown}} -->
Tears down a transaction execution context.
- **Description**: Use this function to properly release or clean up resources associated with a transaction execution context when it is no longer needed. This function should be called after all operations on the transaction context are complete to ensure that any allocated resources are properly released. It is important to ensure that the context is valid and has been initialized before calling this function.
- **Inputs**:
    - `ctx`: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction execution context to be torn down. The pointer must not be null, and the context should have been previously initialized.
- **Output**: None
- **See also**: [`fd_exec_txn_ctx_teardown`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_teardown)  (Implementation)


---
### fd\_exec\_txn\_ctx\_get\_account\_at\_index<!-- {{#callable_declaration:fd_exec_txn_ctx_get_account_at_index}} -->
Retrieve an account from the transaction context by its index.
- **Description**: This function retrieves an account from the transaction context specified by the given index. It is useful when you need to access a specific account within a transaction context. The function checks if the index is within the valid range of accounts in the context. If a condition function is provided, it will be used to validate the account before returning it. If the index is out of range or the condition function fails, an error code is returned. This function should be called when you need to access and optionally validate an account in a transaction context.
- **Inputs**:
    - `ctx`: A pointer to the transaction context (fd_exec_txn_ctx_t) from which the account is to be retrieved. Must not be null.
    - `idx`: The index of the account to retrieve. Must be less than the number of accounts in the context (ctx->accounts_cnt). If out of range, an error is returned.
    - `account`: A pointer to a pointer where the address of the retrieved account will be stored. Must not be null.
    - `condition`: A pointer to a function that checks conditions on the account. Can be null, in which case no condition check is performed.
- **Output**: Returns FD_ACC_MGR_SUCCESS on success, or FD_ACC_MGR_ERR_UNKNOWN_ACCOUNT if the index is out of range or the condition function fails.
- **See also**: [`fd_exec_txn_ctx_get_account_at_index`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_get_account_at_index)  (Implementation)


---
### fd\_exec\_txn\_ctx\_get\_account\_with\_key<!-- {{#callable_declaration:fd_exec_txn_ctx_get_account_with_key}} -->
Retrieve an account from the transaction context using its public key.
- **Description**: This function is used to obtain a transaction account from the context by its public key. It should be called when you need to access an account's details within a transaction context. The function requires a valid transaction context and a public key to identify the account. If the account is found, it is returned through the provided pointer. An optional condition function can be supplied to enforce preconditions on the account. If the account is not found, an error code is returned.
- **Inputs**:
    - `ctx`: A pointer to a valid fd_exec_txn_ctx_t structure representing the transaction context. Must not be null.
    - `pubkey`: A pointer to a constant fd_pubkey_t structure representing the public key of the account to retrieve. Must not be null.
    - `account`: A pointer to a pointer to fd_txn_account_t where the account details will be stored if found. Must not be null.
    - `condition`: An optional pointer to a function of type fd_txn_account_condition_fn_t to check preconditions on the account. Can be null if no precondition checks are needed.
- **Output**: Returns an integer status code. Returns FD_ACC_MGR_ERR_UNKNOWN_ACCOUNT if the account is not found. On success, the account pointer is updated to point to the retrieved account.
- **See also**: [`fd_exec_txn_ctx_get_account_with_key`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_get_account_with_key)  (Implementation)


---
### fd\_exec\_txn\_ctx\_get\_executable\_account<!-- {{#callable_declaration:fd_exec_txn_ctx_get_executable_account}} -->
Retrieves an executable account by its public key from the transaction context.
- **Description**: This function is used to obtain an executable account associated with a given public key from the transaction context. It first attempts to retrieve the account from the existing borrowed accounts, ensuring that any changes from prior instructions are reflected. If not found, it searches through the list of executable accounts. The function can apply an optional condition function to validate the account before returning it. It is important to ensure that the transaction context and public key are valid and that the account pointer is not null. The function returns an error code if the account cannot be found or if the condition function fails.
- **Inputs**:
    - `ctx`: A pointer to the transaction context (fd_exec_txn_ctx_t) from which the executable account is to be retrieved. Must not be null.
    - `pubkey`: A pointer to the public key (fd_pubkey_t) of the account to be retrieved. Must not be null.
    - `account`: A pointer to a pointer where the address of the retrieved account (fd_txn_account_t) will be stored. Must not be null.
    - `condition`: An optional function pointer to a condition function (fd_txn_account_condition_fn_t) that checks preconditions on the retrieved account. Can be null, in which case no condition is applied.
- **Output**: Returns an integer status code: FD_ACC_MGR_SUCCESS on success, or FD_ACC_MGR_ERR_UNKNOWN_ACCOUNT if the account is not found or the condition fails.
- **See also**: [`fd_exec_txn_ctx_get_executable_account`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_get_executable_account)  (Implementation)


---
### fd\_exec\_txn\_ctx\_get\_key\_of\_account\_at\_index<!-- {{#callable_declaration:fd_exec_txn_ctx_get_key_of_account_at_index}} -->
Retrieve the public key of an account at a specified index from the transaction context.
- **Description**: This function is used to obtain the public key of an account from a transaction context at a given index. It is essential to ensure that the index provided is within the bounds of the available account keys in the transaction context. If the index is out of bounds, the function returns an error code indicating that there are not enough account keys. This function is typically called when there is a need to access account information based on its position in the transaction context.
- **Inputs**:
    - `ctx`: A pointer to a valid fd_exec_txn_ctx_t structure representing the transaction context. Must not be null.
    - `idx`: An unsigned short representing the index of the account key to retrieve. Must be less than the number of account keys in the context.
    - `key`: A pointer to a location where the address of the retrieved fd_pubkey_t will be stored. Must not be null.
- **Output**: Returns an integer status code: FD_EXECUTOR_INSTR_SUCCESS on success, or FD_EXECUTOR_INSTR_ERR_NOT_ENOUGH_ACC_KEYS if the index is out of bounds.
- **See also**: [`fd_exec_txn_ctx_get_key_of_account_at_index`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_get_key_of_account_at_index)  (Implementation)


---
### fd\_exec\_txn\_ctx\_reset\_return\_data<!-- {{#callable_declaration:fd_exec_txn_ctx_reset_return_data}} -->
Resets the return data length in the transaction context.
- **Description**: Use this function to reset the length of the return data in a transaction context to zero. This is typically done to clear any previously stored return data before starting a new transaction or operation that will generate new return data. It is important to ensure that the transaction context is properly initialized before calling this function to avoid undefined behavior.
- **Inputs**:
    - `txn_ctx`: A pointer to a `fd_exec_txn_ctx_t` structure representing the transaction context. This pointer must not be null, and the structure should be properly initialized before use.
- **Output**: None
- **See also**: [`fd_exec_txn_ctx_reset_return_data`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_reset_return_data)  (Implementation)


---
### fd\_exec\_txn\_ctx\_account\_is\_writable\_idx<!-- {{#callable_declaration:fd_exec_txn_ctx_account_is_writable_idx}} -->
Determine if a transaction account is writable by its index.
- **Description**: Use this function to check if a specific account within a transaction context is writable based on its index. This is useful when you need to verify the permissions of an account before performing operations that require write access. The function requires a valid transaction context and an index within the bounds of the account keys array. It returns an integer indicating the writability status of the account at the specified index.
- **Inputs**:
    - `txn_ctx`: A pointer to a constant fd_exec_txn_ctx_t structure representing the transaction context. It must not be null and should be properly initialized before calling this function.
    - `idx`: An unsigned short integer representing the index of the account within the transaction context's account keys array. It must be within the valid range of indices for the account keys array.
- **Output**: Returns an integer indicating whether the account at the specified index is writable. A non-zero value typically indicates writability, while zero indicates non-writability.
- **See also**: [`fd_exec_txn_ctx_account_is_writable_idx`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_ctx_account_is_writable_idx)  (Implementation)


---
### fd\_exec\_txn\_account\_is\_writable\_idx\_flat<!-- {{#callable_declaration:fd_exec_txn_account_is_writable_idx_flat}} -->
Determine if a transaction account is writable based on specific criteria.
- **Description**: This function checks if a transaction account at a given index is writable by evaluating several conditions, such as whether the account is marked as writable in the transaction descriptor, if it is a reserved key, or if it is involved in a BPF upgradeable transaction. It should be used when you need to verify the writability of an account in a transaction context without using the full transaction context structure. Ensure that the provided pointers are valid and that the index is within the bounds of the transaction's account list.
- **Inputs**:
    - `slot`: The current slot number, used to evaluate feature activation. Must be a valid slot number.
    - `idx`: The index of the account within the transaction's account list. Must be within the valid range of indices for the transaction.
    - `addr_at_idx`: A pointer to the public key of the account at the specified index. Must not be null.
    - `txn_descriptor`: A pointer to the transaction descriptor, which contains details about the transaction. Must not be null.
    - `features`: A pointer to the features structure, used to check for active features. Must not be null.
    - `bpf_upgradeable_in_txn`: An unsigned integer indicating if a BPF upgradeable loader account is present in the transaction. Should be 0 or 1.
- **Output**: Returns 1 if the account is writable, otherwise returns 0.
- **See also**: [`fd_exec_txn_account_is_writable_idx_flat`](fd_exec_txn_ctx.c.driver.md#fd_exec_txn_account_is_writable_idx_flat)  (Implementation)


---
### fd\_txn\_account\_has\_bpf\_loader\_upgradeable<!-- {{#callable_declaration:fd_txn_account_has_bpf_loader_upgradeable}} -->
Checks if any account key matches the BPF loader upgradeable program ID.
- **Description**: Use this function to determine if any of the provided account keys correspond to the BPF loader upgradeable program ID. This is useful in contexts where you need to verify the presence of a specific program ID among a list of account keys. The function iterates over the provided account keys and returns a non-zero value if a match is found, otherwise it returns zero. Ensure that the account keys array and the count accurately represent the accounts you wish to check.
- **Inputs**:
    - `account_keys`: A pointer to an array of fd_pubkey_t structures representing the account keys to be checked. The caller retains ownership and must ensure the pointer is valid and not null.
    - `accounts_cnt`: The number of account keys in the array. Must be a non-negative value and should accurately reflect the number of elements in the account_keys array.
- **Output**: Returns 1 if a matching BPF loader upgradeable program ID is found among the account keys, otherwise returns 0.
- **See also**: [`fd_txn_account_has_bpf_loader_upgradeable`](fd_exec_txn_ctx.c.driver.md#fd_txn_account_has_bpf_loader_upgradeable)  (Implementation)


---
### fd\_txn\_account\_check\_exists<!-- {{#callable_declaration:fd_txn_account_check_exists}} -->
Checks if a transaction account exists.
- **Description**: Use this function to verify the existence of a transaction account within a given context. It is typically used as a pre-condition check when accessing accounts in a transaction context. The function does not modify the account or the context, and it does not depend on the index parameter, which is ignored.
- **Inputs**:
    - `acc`: A pointer to the transaction account to be checked. Must not be null, and the account should be properly initialized.
    - `ctx`: A pointer to the transaction execution context. This parameter is not used in the function, but it must be a valid pointer.
    - `idx`: An index representing the position of the account in some context. This parameter is ignored by the function.
- **Output**: Returns a non-zero value if the account exists, otherwise returns zero.
- **See also**: [`fd_txn_account_check_exists`](fd_exec_txn_ctx.c.driver.md#fd_txn_account_check_exists)  (Implementation)


---
### fd\_txn\_account\_check\_is\_writable<!-- {{#callable_declaration:fd_txn_account_check_is_writable}} -->
Checks if a transaction account is writable.
- **Description**: Use this function to determine if a specific account within a transaction context is writable. This is useful when you need to verify the permissions of an account before performing operations that require write access. The function requires a valid transaction context and an index specifying the account to check. It is important to ensure that the index is within the valid range of accounts in the transaction context to avoid undefined behavior.
- **Inputs**:
    - `acc`: A pointer to an fd_txn_account_t structure. This parameter is not used in the function and can be ignored.
    - `ctx`: A pointer to a constant fd_exec_txn_ctx_t structure representing the transaction context. Must not be null.
    - `idx`: An unsigned short integer representing the index of the account to check within the transaction context. Must be within the valid range of accounts in the context.
- **Output**: Returns an integer indicating whether the account at the specified index is writable. A non-zero value indicates the account is writable, while zero indicates it is not.
- **See also**: [`fd_txn_account_check_is_writable`](fd_exec_txn_ctx.c.driver.md#fd_txn_account_check_is_writable)  (Implementation)


---
### fd\_txn\_account\_check\_fee\_payer\_writable<!-- {{#callable_declaration:fd_txn_account_check_fee_payer_writable}} -->
Checks if the fee payer account is writable.
- **Description**: Use this function to verify if the fee payer account in a transaction is writable based on the transaction's context and the specified account index. This check is crucial for ensuring that the fee payer account can be modified as required by the transaction. It should be called when you need to confirm the writability of the fee payer account before performing operations that require account modifications.
- **Inputs**:
    - `acc`: A pointer to an fd_txn_account_t structure representing the account to check. The function does not use this parameter, so it can be NULL.
    - `ctx`: A pointer to a constant fd_exec_txn_ctx_t structure representing the transaction context. Must not be NULL.
    - `idx`: An unsigned short representing the index of the account within the transaction context to check for writability. Must be a valid index within the transaction's account list.
- **Output**: Returns a non-zero value if the account at the specified index is writable; otherwise, returns zero.
- **See also**: [`fd_txn_account_check_fee_payer_writable`](fd_exec_txn_ctx.c.driver.md#fd_txn_account_check_fee_payer_writable)  (Implementation)


---
### fd\_txn\_account\_check\_borrow\_mut<!-- {{#callable_declaration:fd_txn_account_check_borrow_mut}} -->
Checks if an account is mutable and attempts to borrow it mutably.
- **Description**: Use this function to verify if a transaction account is mutable and to attempt to acquire a mutable borrow on it. This is typically used in transaction processing where mutable access to an account is required. The function should be called when you need to ensure that an account can be modified. It is important to release the acquired mutable borrow using the appropriate release function after the modifications are done to avoid resource leaks or deadlocks.
- **Inputs**:
    - `acc`: A pointer to the transaction account to be checked and borrowed. Must not be null. The caller retains ownership and is responsible for ensuring the account is valid.
    - `ctx`: A pointer to the transaction execution context. This parameter is not used in the function, but it must be provided. The caller retains ownership.
    - `idx`: An index representing the position of the account in some context. This parameter is not used in the function, but it must be provided.
- **Output**: Returns a non-zero value if the account is mutable and the mutable borrow is successfully acquired; otherwise, returns zero.
- **See also**: [`fd_txn_account_check_borrow_mut`](fd_exec_txn_ctx.c.driver.md#fd_txn_account_check_borrow_mut)  (Implementation)


