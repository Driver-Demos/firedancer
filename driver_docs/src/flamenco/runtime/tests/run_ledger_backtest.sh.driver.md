# Purpose
This Bash script is designed to automate the process of downloading, configuring, and running a backtest for a specified ledger using the Firedancer development tools. It provides a narrow functionality focused on handling ledger data, including downloading ledger archives from a Google Cloud Storage bucket, setting up necessary configurations, and executing a backtest. The script processes command-line arguments to customize its behavior, such as specifying directories, ledger names, and other parameters. It generates a configuration file in TOML format, manages authentication for Google Cloud services, and executes the backtest using the Firedancer development binaries. The script also includes error handling and logging to ensure that the backtest process is monitored and any issues are reported.
# Global Variables

---
### POSITION\_ARGS
- **Type**: `array`
- **Description**: The `POSITION_ARGS` variable is a global array that is initialized as an empty array. It is used to store positional arguments that are not recognized as options or flags by the script. These are arguments that do not match any of the predefined options in the script's command-line interface.
- **Use**: This variable is used to collect and store any additional command-line arguments that are not explicitly handled by the script's option parsing logic.


---
### OBJDIR
- **Type**: `string`
- **Description**: The `OBJDIR` variable is a global string variable that specifies the directory path where build artifacts are stored. It defaults to 'build/native/gcc' if not already set in the environment.
- **Use**: This variable is used to define paths for storing coverage data and executing binaries within the script.


---
### LEDGER
- **Type**: `string`
- **Description**: The `LEDGER` variable is a global string variable that is initially set to an empty string. It is used to store the name or identifier of a ledger, which is a key component in the script's operations related to data ingestion and replay.
- **Use**: This variable is used to specify the ledger name for downloading resources, configuring paths, and running backtests.


---
### SNAPSHOT
- **Type**: `string`
- **Description**: The `SNAPSHOT` variable is a global string variable that is initially set to an empty string. It is used to store the path to a snapshot file, which is derived from the `LEDGER` variable and a user-provided argument. The snapshot file is used in the replay process of the script.
- **Use**: This variable is used to specify the path to a snapshot file for replaying ledger data.


---
### RESTORE\_ARCHIVE
- **Type**: `string`
- **Description**: The `RESTORE_ARCHIVE` variable is a global string variable that is initially set to an empty string. It is used to store the path to a restore archive file, which is constructed by appending a given path to the `LEDGER` directory path. This variable is set when the `-a` or `--restore-archive` command-line option is provided, indicating that a specific archive should be restored during the script's execution.
- **Use**: This variable is used to specify the path to a restore archive file for the script to process.


---
### END\_SLOT
- **Type**: `string`
- **Description**: The `END_SLOT` variable is a global string variable initialized with the value "1010". It represents a specific slot number used in the configuration of the archiver tile within the script.
- **Use**: This variable is used to specify the end slot for the archiver process in the configuration file generated by the script.


---
### FUNK\_PAGES
- **Type**: `string`
- **Description**: The `FUNK_PAGES` variable is a global string variable initialized with the value "16". It represents the size of the 'funk' in gigabytes, which is used in the configuration of the replay tile in the backtest process.
- **Use**: This variable is used to set the `funk_sz_gb` parameter in the configuration file for the backtest process.


---
### INDEX\_MAX
- **Type**: `string`
- **Description**: `INDEX_MAX` is a global variable defined as a string with a default value of "5000000". It represents the maximum number of records or entries that can be processed or stored in a specific context, likely related to the 'funk' component of the system as indicated by its usage in the configuration file generation.
- **Use**: This variable is used to set the maximum number of records (`funk_rec_max`) in the configuration for the replay tile in the backtest process.


---
### TRASH\_HASH
- **Type**: `string`
- **Description**: The `TRASH_HASH` variable is a global string variable that is initially set to an empty string. It is used to store a command-line option for trash hash, which is specified by the user with the `-t` or `--trash` flag followed by a hash value.
- **Use**: This variable is used to append the `--trash-hash` option and its value to the command line arguments when executing certain operations in the script.


---
### LOG
- **Type**: `string`
- **Description**: The `LOG` variable is a global string variable that holds the path to a temporary log file. The path is constructed using the `/tmp/ledger_log` prefix followed by the process ID (`$$`), ensuring a unique log file for each execution of the script.
- **Use**: This variable is used to specify the file path where log information related to the ledger processing is stored.


---
### TILE\_CPUS
- **Type**: `string`
- **Description**: The `TILE_CPUS` variable is a string that specifies a range of CPU cores to be used for tiling operations. It is initialized with the value `--tile-cpus 5-15`, indicating that CPU cores 5 through 15 are designated for this purpose.
- **Use**: This variable is used to configure the CPU core range for tiling operations in the script.


---
### THREAD\_MEM\_BOUND
- **Type**: `string`
- **Description**: The `THREAD_MEM_BOUND` variable is a global string variable that specifies a command-line option for setting a memory bound for threads. It is initialized with the value `--thread-mem-bound 0`, which indicates that the memory bound is set to zero by default.
- **Use**: This variable is used to configure the memory limit for threads when executing certain commands or scripts.


---
### CLUSTER\_VERSION
- **Type**: `string`
- **Description**: The `CLUSTER_VERSION` variable is a global string variable that is initially set to an empty string. It is used to store the version of the cluster being processed or tested in the script. This variable is populated with a value when the `-c` or `--cluster-version` command-line option is provided, allowing the user to specify the cluster version.
- **Use**: This variable is used to specify the version of the cluster in the configuration for the backtest process.


---
### DUMP\_DIR
- **Type**: `string`
- **Description**: The `DUMP_DIR` variable is a global string variable that specifies the directory path where dump files are stored. It is initialized with a default value of './dump', but can be overridden by a command-line argument using the `-d` or `--dump-dir` option. This variable is used throughout the script to determine where to store and retrieve various files related to the ledger processing.
- **Use**: This variable is used to define the directory path for storing dump files and is referenced in multiple parts of the script for file operations.


---
### ONE\_OFFS
- **Type**: `string`
- **Description**: The `ONE_OFFS` variable is a global string variable initialized to an empty string. It is used to store a list of one-off features that can be enabled during the execution of the script.
- **Use**: This variable is set via the `-o` or `--one-offs` command-line option and is used to specify features to be enabled in the configuration file for the backtest process.


---
### ZST
- **Type**: `integer`
- **Description**: The `ZST` variable is a global integer flag that is set to 1 when the `--zst` command-line option is provided. It is used to determine the format of the file to be downloaded, specifically whether it should be a `.zst` (Zstandard compressed) file or a `.gz` (gzip compressed) file.
- **Use**: This variable is used to decide the file format for downloading resources, affecting the subsequent decompression and extraction process.


---
### DUMP
- **Type**: `string`
- **Description**: The `DUMP` variable is a global string variable that stores the absolute path to the directory specified by the `DUMP_DIR` variable. It is initialized using the `realpath` command to ensure it contains the full path, regardless of how `DUMP_DIR` is set.
- **Use**: This variable is used to define the location where various files and directories related to the ledger and backtest operations are stored and accessed.


# Functions

---
### echo\_notice
The `echo_notice` function prints a message in blue text to the console.
- **Inputs**:
    - `$1`: The message string to be printed in blue text.
- **Control Flow**:
    - The function uses the `echo` command with the `-e` flag to enable interpretation of backslash escapes.
    - It applies ANSI escape codes to change the text color to blue (`\033[34m`) before printing the input message.
    - After the message, it resets the text color to default (`\033[0m`).
- **Output**: The function outputs the input message to the console in blue text.


---
### echo\_error
The `echo_error` function prints an error message in red text to the console.
- **Inputs**:
    - `$1`: The first part of the error message to be displayed.
    - `$2`: The second part of the error message to be displayed, concatenated with the first part.
- **Control Flow**:
    - The function uses the `echo` command with the `-e` flag to enable interpretation of backslash escapes.
    - It applies the ANSI escape code `\033[31m` to change the text color to red.
    - It concatenates the two input arguments `$1` and `$2` and prints them in red.
    - The function resets the text color back to default using `\033[0m`.
- **Output**: The function outputs a concatenated error message in red text to the console.


